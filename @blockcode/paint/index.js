import{addLocalesMessages as K5}from"@blockcode/core";var R1={"paint.contextMenu.duplicate":"duplicate","paint.contextMenu.export":"export","paint.contextMenu.delete":"delete","paint.actionButton.upload":"Upload Image","paint.actionButton.uploadCostume":"Upload Costume","paint.actionButton.uploadBackdrop":"Upload Backdrop","paint.actionButton.uploadError":'Upload "{file}" failed.',"paint.actionButton.surprise":"Surprise","paint.actionButton.paint":"Paint","paint.actionButton.image":"Choose a Image","paint.actionButton.costume":"Choose a Costume","paint.actionButton.backdrop":"Choose a Backdrop","paint.painter.image":"Image","paint.painter.costume":"Costume","paint.painter.backdrop":"Backdrop","paint.painter.name":"name","paint.painter.undo":"Undo","paint.painter.redo":"Redo","paint.painter.pen":"Pen","paint.painter.eraser":"Eraser","paint.painter.fill":"Fill","paint.painter.text":"Text","paint.painter.line":"Line","paint.painter.curve":"Curve","paint.painter.rectangle":"Rectangle","paint.painter.circle":"Circle","paint.painter.isogon":"Isogon","paint.painter.polygon":"Polygon","paint.painter.select":"Select","paint.painter.center":"Center","paint.painter.outline":"Outline","paint.painter.delete":"Delete","paint.painter.flipHorizontal":"Flip Horizontal","paint.painter.flipVertical":"Flip Vertical","paint.painter.copy":"Copy","paint.painter.paste":"Paste","paint.painter.crop":"Auto Crop","paint.colorPicker.color":"Color","paint.colorPicker.saturation":"Saturation","paint.colorPicker.brightness":"Brightness","paint.mode.bitmap":"Convert to Bitmap","paint.mode.tileMap":"Convert to TileMap"};var j1={"paint.contextMenu.duplicate":"复制","paint.contextMenu.export":"导出","paint.contextMenu.delete":"删除","paint.actionButton.upload":"上传图片","paint.actionButton.uploadCostume":"上传造型","paint.actionButton.uploadBackdrop":"上传背景","paint.actionButton.uploadError":"上传“{file}”失败。","paint.actionButton.surprise":"随机","paint.actionButton.paint":"绘制","paint.actionButton.image":"选择一个图片","paint.actionButton.costume":"选择一个造型","paint.actionButton.backdrop":"选择一个背景","paint.painter.image":"图片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤销","paint.painter.redo":"重做","paint.painter.pen":"画笔","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"线段","paint.painter.curve":"曲线","paint.painter.rectangle":"矩形","paint.painter.circle":"圆形","paint.painter.isogon":"正多边形","paint.painter.polygon":"任意多边形","paint.painter.select":"选择","paint.painter.center":"中心","paint.painter.outline":"轮廓","paint.painter.delete":"删除","paint.painter.flipHorizontal":"水平翻转","paint.painter.flipVertical":"垂直翻转","paint.painter.copy":"复制","paint.painter.paste":"粘贴","paint.painter.crop":"自动裁剪","paint.colorPicker.color":"颜色","paint.colorPicker.saturation":"饱和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"转换为位图","paint.mode.tileMap":"转换为拼贴地图"};var V1={"paint.contextMenu.duplicate":"複製","paint.contextMenu.export":"導齣","paint.contextMenu.delete":"刪除","paint.actionButton.upload":"上傳圖片","paint.actionButton.uploadCostume":"上傳造型","paint.actionButton.uploadBackdrop":"上傳背景","paint.actionButton.uploadError":"上傳“{file}”失敗。","paint.actionButton.surprise":"隨機","paint.actionButton.paint":"繪製","paint.actionButton.image":"選擇一個圖片","paint.actionButton.costume":"選擇一個造型","paint.actionButton.backdrop":"選擇一個背景","paint.painter.image":"圖片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤銷","paint.painter.redo":"重做","paint.painter.pen":"畫筆","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"線段","paint.painter.curve":"曲線","paint.painter.rectangle":"矩形","paint.painter.circle":"圓形","paint.painter.isogon":"正多邊形","paint.painter.polygon":"任意多邊形","paint.painter.select":"選擇","paint.painter.center":"中心","paint.painter.outline":"輪廓","paint.painter.delete":"刪除","paint.painter.flipHorizontal":"水平翻轉","paint.painter.flipVertical":"垂直翻轉","paint.painter.copy":"複製","paint.painter.paste":"粘貼","paint.painter.crop":"自動裁剪","paint.colorPicker.color":"顏色","paint.colorPicker.saturation":"飽和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"轉換爲位圖","paint.mode.tileMap":"轉換爲 TileMap"};K5({en:R1,"zh-Hans":j1,"zh-Hant":V1});import{keyMirror as t3}from"@blockcode/utils";var E=t3({Image:null,Costume:null,Backdrop:null,Tile:null,TileMap:null});import{nanoid as e3}from"@blockcode/utils";var J1="image/png",i3=`data:${J1};base64,`.length,C1="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",D1=new Map;function E1(e,t){return new Promise((o)=>{let n=new FileReader;n.readAsDataURL(e),n.addEventListener("load",async()=>{let l=await m1(n.result,1,t);o(l)})})}function u1(e){return new Promise((t)=>{let o=D1.get(e.id);if(!o)o=new Image,D1.set(e.id,o);let n=`data:${e.type};base64,`;o.src=`${n}${e.data}`,o.addEventListener("load",()=>{o.dataset.data=o.src.slice(n.length),t(o)})})}function m1(e,t,o){return new Promise((n)=>{let l=e3(),i=new Image;D1.set(l,i),i.id=l,i.src=e,i.addEventListener("load",()=>{if(i.dataset.data)return n(i);let{width:a,height:p}=i;if(!o)o={width:a,height:p};if(!t)t=1;if(i.width>o.width||i.height>o.height){a=o.width,p=o.height;let N=o.width/i.width,B=o.height/i.height;if(N<B)t=N;else t=B}p=i.height*t,a=i.width*t;let h=document.createElement("canvas");h.width=a,h.height=p,h.getContext("2d").drawImage(i,0,0,a,p);let v=h.toDataURL(J1);if(v==="data:,")return n(null);i.dataset.data=v.slice(i3),i.src=v})})}import{useCallback as o1,useMemo as i6}from"preact/hooks";import{batch as p1}from"@preact/signals";import{nanoid as _1}from"@blockcode/utils";import{useProjectContext as c3,translate as F1,setAlert as e5,delAlert as d3,openAsset as i5,addAsset as z1,delAsset as s3}from"@blockcode/core";import{Text as U,IconSelector as h3,ActionButton as g3}from"@blockcode/core";function z(e){let t=globalThis.document,o=t.createElement("style");o.appendChild(t.createTextNode(e)),t.head.append(o)}z(".bRLzKG_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}.bRLzKG_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}.bRLzKG_selector-item{width:5rem;height:5rem;margin:.5rem auto}.bRLzKG_delete-menu-item:hover{background:var(--error-primary)}.bRLzKG_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.bRLzKG_add-button{margin:.75rem auto}");var t1={selectorWrapper:"bRLzKG_selector-wrapper",addButton:"bRLzKG_add-button",selectorItemsWrapper:"bRLzKG_selector-items-wrapper",deleteMenuItem:"bRLzKG_delete-menu-item",selectorItem:"bRLzKG_selector-item",addButtonWrapper:"bRLzKG_add-button-wrapper"};var $1="./assets/icon-costume-zx9m3hdh.svg";var H1="./assets/icon-backdrop-qvqgzqwj.svg";var X1="./assets/icon-search-6g8kgvdt.svg";var q1="./assets/icon-paint-0h8zs19a.svg";var K1="./assets/icon-surprise-d5t4529a.svg";var t5="./assets/icon-file-upload-0z25chr6.svg";import{jsx as A,jsxs as m3}from"preact/jsx-runtime";var o5={[E.Image]:A(U,{id:"paint.actionButton.image",defaultMessage:"Choose a Image"}),[E.Costume]:A(U,{id:"paint.actionButton.costume",defaultMessage:"Choose a Costume"}),[E.Backdrop]:A(U,{id:"paint.actionButton.backdrop",defaultMessage:"Choose a Backdrop"})},w3={[E.Image]:A(U,{id:"paint.actionButton.upload",defaultMessage:"Upload Image"}),[E.Costume]:A(U,{id:"paint.actionButton.uploadCostume",defaultMessage:"Upload Costume"}),[E.Backdrop]:A(U,{id:"paint.actionButton.uploadBackdrop",defaultMessage:"Upload Backdrop"})},C3=(e)=>{switch(e){case E.Image:return F1("paint.painter.image","Image").toLowerCase();case E.Costume:return F1("paint.painter.costume","Costume").toLowerCase();case E.Backdrop:return F1("paint.painter.backdrop","Backdrop").toLowerCase()}},u3=(e)=>`data:${e.type};base64,${e.data}`;function n5({mode:e,maxSize:t,onImagesFilter:o,onShowLibrary:n,onSurprise:l,onChange:i,onDelete:a}){let{assets:p,assetId:h,modified:s}=c3(),v=o1(()=>{return o().map((c)=>{if(typeof c==="string")return p.value.find((w)=>w.id===c);return c}).filter((c)=>/^image\//.test(c.type))},[s.value,o]),N=o1(()=>{let c=document.createElement("input");c.type="file",c.accept="image/*",c.multiple=!0,c.click(),c.addEventListener("change",async(w)=>{let y=_1();e5("importing",{id:y});let b=[];for(let u of w.target.files){let F=await E1(u,t);if(!F)e5({message:A(U,{id:"paint.actionButton.uploadError",defaultMessage:'Upload "{file}" failed.',file:u.name})},2000),F={dataset:{data:C1},width:1,height:1};F.name=u.name.slice(0,u.name.lastIndexOf(".")),b.push(F)}d3(y),p1(()=>{for(let u of b)if(z1({id:u.id,type:"image/png",name:u.name,data:u.dataset.data,width:u.width,height:u.height,centerX:Math.floor(u.width/2),centerY:Math.floor(u.height/2)}),i)i(u.id)})})},[i]),B=o1(()=>{let c=_1();p1(()=>{if(z1({id:c,type:"image/png",name:C3(e),data:C1,width:1,height:1,centerX:1,centerY:1}),i)i(c)})},[i]),G=o1((c)=>{let w=v(),y=w[c];p1(()=>{let b=h.value;if(y.id===h.value){if(c===0)b=w[1]?.id;else if(c+1<w.length)b=w[c+1].id;else if(c-1>-1)b=w[c-1].id}s3(y.id),i5(b),a(y.id,b)})},[a]),Z=o1((c)=>{let y=v()[c],b=_1();p1(()=>{if(z1({...y,id:b}),i)i(b)})},[i]),D=o1((c,w)=>{p1(()=>{if(i5(w.id),i)i(w.id)})},[i]),g=v();return m3("div",{className:t1.selectorWrapper,children:[A(h3,{displayOrder:!0,id:"doodle-selector",className:t1.selectorItemsWrapper,items:g.map((c,w)=>({...c,details:`${c.width}×${c.height}`,icon:u3(c),order:w,className:t1.selectorItem,contextMenu:[[{label:A(U,{id:"paint.contextMenu.duplicate",defaultMessage:"duplicate"}),onClick:()=>Z(w)},{label:A(U,{id:"paint.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:A(U,{id:"paint.contextMenu.delete",defaultMessage:"delete"}),disabled:g.length<=1,className:t1.deleteMenuItem,onClick:()=>G(w)}]]})),selectedId:h.value,onSelect:D,onDelete:g.length>1&&G}),A("div",{className:t1.addButtonWrapper,children:A(g3,{tooltipPlacement:"right",className:t1.addButton,icon:e===E.Costume?$1:H1,tooltip:o5[e],onClick:n,moreButtons:[{icon:t5,tooltip:w3[e],onClick:N},{icon:K1,tooltip:A(U,{id:"paint.actionButton.surprise",defaultMessage:"Surprise"}),onClick:l},{icon:q1,tooltip:A(U,{id:"paint.actionButton.paint",defaultMessage:"Paint"}),onClick:B},{icon:X1,tooltip:o5[e],onClick:n}]})})]})}import{useCallback as I,useEffect as y0,useMemo as k0}from"preact/hooks";import{batch as c1,useComputed as W1,useSignal as W}from"@preact/signals";import{classNames as O,Color as j5,MathUtils as Y1}from"@blockcode/utils";import{useProjectContext as I0,translate as V,maybeTranslate as N0,setAsset as N1}from"@blockcode/core";import{Text as d1,Label as Q1,BufferedInput as b1,Button as j}from"@blockcode/core";import{useCallback as T,useMemo as M3}from"preact/hooks";import{classNames as e1,Color as v3}from"@blockcode/utils";import{Text as G1,Tooltip as f3}from"@blockcode/core";z('.x5E0hW_color-picker-wrapper{width:3rem;height:2rem;margin-right:var(--space);cursor:pointer;display:flex}.x5E0hW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}.x5E0hW_color-swatch-outline:after{content:"";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}.x5E0hW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}.x5E0hW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}.x5E0hW_tooltip-item{margin:8px}.x5E0hW_tooltip-item-label{font-weight:700}.x5E0hW_tooltip-item-readout{margin-left:10px}.x5E0hW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}.x5E0hW_tooltip-item-slider-handler{background-color:var(--ui-white);width:26px;height:26px;box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;margin-top:-2px;position:absolute;left:100px}.x5E0hW_tooltip-item-toolbar{justify-content:space-between;display:flex}.x5E0hW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}.x5E0hW_tooltip-item-toolbar-button.x5E0hW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}.x5E0hW_button-icon{width:1.5rem;height:1.5rem}');var M={pickerArrow:"x5E0hW_picker-arrow",tooltipItem:"x5E0hW_tooltip-item",colorPickerWrapper:"x5E0hW_color-picker-wrapper",tooltipItemLabel:"x5E0hW_tooltip-item-label",colorSwatch:"x5E0hW_color-swatch",tooltipItemSlider:"x5E0hW_tooltip-item-slider",colorSwatchOutline:"x5E0hW_color-swatch-outline",colorTooltip:"x5E0hW_color-tooltip",tooltipItemSliderHandler:"x5E0hW_tooltip-item-slider-handler",tooltipItemToolbar:"x5E0hW_tooltip-item-toolbar",tooltipItemReadout:"x5E0hW_tooltip-item-readout",tooltipItemToolbarButton:"x5E0hW_tooltip-item-toolbar-button",selected:"x5E0hW_selected",buttonIcon:"x5E0hW_button-icon"};var r5="./assets/icon-picker-2frmfa34.svg";var A1="./assets/icon-clear-gctr9axd.svg";import{jsx as f,jsxs as n1,Fragment as k3}from"preact/jsx-runtime";var y3=[0,0,324,288,252,216,180,144,108,72,36,0,0],X=124,J=(e,t,o,n)=>new v3({h:e,s:t,v:o},n),Z1=(e,t)=>{e.stopPropagation();let o=e.target,n=o.offsetLeft,l=e.clientX,i=(p)=>{p.preventDefault();let h=p.clientX-l+n;if(h>=X)h=X;if(h<=0)h=0;o.style.left=`${h}px`,t(h/X)},a=()=>{document.removeEventListener("pointermove",i),document.removeEventListener("pointerup",a)};document.addEventListener("pointermove",i),document.addEventListener("pointerup",a)},T1=(e,t)=>{let o=e.target.children[0],n=e.offsetX-13;if(n>=X)n=X;if(n<=0)n=0;o.style.left=`${n}px`,t(n/X)};function O1({picking:e,color:t,outline:o,onChange:n,onPickingColor:l}){let i=t.hsv.h,a=t.hsv.s,p=t.hsv.v,h=T((u)=>n(J(Math.round(u*360),a,p)),[a,p,n]),s=T((u)=>n(J(i,u,p)),[i,p,n]),v=T((u)=>n(J(i,a,u)),[i,a,n]),N=T(()=>n(J(i,a,p,!0)),[i,a,p,n]),B=T((u)=>Z1(u,h),[h]),G=T((u)=>Z1(u,s),[s]),Z=T((u)=>Z1(u,v),[v]),D=T((u)=>T1(u,h),[h]),g=T((u)=>T1(u,s),[s]),c=T((u)=>T1(u,v),[v]),w=M3(()=>y3.map((u)=>J(u,a,p).hex),[a,p]),y=T((u)=>u.stopPropagation(),[]),b=T(()=>l(!e),[e,l]);return f(f3,{clickable:!0,placement:"bottom",className:M.colorTooltip,onHide:T(()=>setTimeout(()=>l(!1),50),[l]),content:n1(k3,{children:[n1("div",{className:M.tooltipItem,children:[f("span",{className:M.tooltipItemLabel,children:f(G1,{id:"paint.colorPicker.color",defaultMessage:"Color"})}),f("span",{className:M.tooltipItemReadout,children:Math.round(i/360*100)})]}),f("div",{className:e1(M.tooltipItem,M.tooltipItemSlider),style:{background:`linear-gradient(to left, ${w[0]} 0px, ${w[1]} 13px, ${w[2]}, ${w[3]}, ${w[4]}, ${w[5]}, ${w[6]}, ${w[7]}, ${w[8]}, ${w[9]}, ${w[10]}, ${w[11]} 137px, ${w[12]} 100%)`},onClick:D,children:f("div",{className:M.tooltipItemSliderHandler,style:{left:`${Math.round(i/360*X)}px`},onPointerDown:B,onClick:y})}),n1("div",{className:M.tooltipItem,children:[f("span",{className:M.tooltipItemLabel,children:f(G1,{id:"paint.colorPicker.saturation",defaultMessage:"Saturation"})}),f("span",{className:M.tooltipItemReadout,children:Math.round(a*100)})]}),f("div",{className:e1(M.tooltipItem,M.tooltipItemSlider),style:{background:`linear-gradient(to right, ${J(i,0,p).hex} 0px, ${J(i,1,p).hex} 100%)`},onClick:g,children:f("div",{className:M.tooltipItemSliderHandler,style:{left:`${Math.round(a*X)}px`},onPointerDown:G,onClick:y})}),n1("div",{className:M.tooltipItem,children:[f("span",{className:M.tooltipItemLabel,children:f(G1,{id:"paint.colorPicker.brightness",defaultMessage:"Brightness"})}),f("span",{className:M.tooltipItemReadout,children:Math.round(p*100)})]}),f("div",{className:e1(M.tooltipItem,M.tooltipItemSlider),style:{background:`linear-gradient(to right, ${J(i,a,0).hex} 0px, ${J(i,a,1).hex} 100%)`},onClick:c,children:f("div",{className:M.tooltipItemSliderHandler,style:{left:`${Math.round(p*X)}px`},onPointerDown:Z,onClick:y})}),n1("div",{className:e1(M.tooltipItem,M.tooltipItemToolbar),children:[f("div",{className:e1(M.tooltipItemToolbarButton,{[M.selected]:t.clear}),onClick:N,children:f("img",{src:A1,className:M.buttonIcon})}),f("div",{className:e1(M.tooltipItemToolbarButton,{[M.selected]:e}),onClick:b,children:f("img",{src:r5,className:M.buttonIcon})})]})]}),children:n1("div",{className:M.colorPickerWrapper,children:[f("div",{className:e1(M.colorSwatch,{[M.colorSwatchOutline]:o}),style:{background:t.clear?"var(--ui-white)":J(i,a,p).hex},children:t.clear&&f("img",{src:A1})}),f("div",{className:M.pickerArrow,children:"▾"})]})})}import{useCallback as b3,useEffect as B3}from"preact/hooks";import{useSignal as D3}from"@preact/signals";import{Dropdown as E3}from"@blockcode/core";var I3=[{family:"Sans Serif"},{family:"Serif"},{family:"Handwriting"},{family:"Marker"},{family:"Curly"},{family:"Pixel"},{label:"中文",family:'"Microsoft YaHei", "微软雅黑", STXihei, "华文细黑"'},{label:"日本語",family:'"ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic"'},{label:"한국어",family:"Malgun Gothic"}],N3=(e,t)=>{let o=e.length>t.length?e:t,n=o==e?t:e,l;for(let i=0;i<n.length;i++)for(let a=0,p=n.length-i;p!=n.length+1;a++,p++)if(l=n.substring(a,p),o.indexOf(l)!=-1)return l;return""};async function l5(){try{let e=await window.queryLocalFonts(),t=new Map,o;for(let n of e){if(/demo/i.test(n.family))continue;if(o=n.fullName,t.has(n.family))o=t.get(n.family),o=N3(o,n.fullName);t.set(n.family,o)}return t.entries().toArray().map(([n,l])=>({label:l,family:n}))}catch(e){return I3}}z(".vaJj7G_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;height:2rem;overflow:auto}.vaJj7G_displayed-font-name{font-size:.8rem}");var U1={displayedFontName:"vaJj7G_displayed-font-name",fontSelector:"vaJj7G_font-selector"};import{jsx as a5}from"preact/jsx-runtime";function p5({font:e,onChange:t}){let o=D3(null),n=b3((l)=>()=>t(l),[t]);return B3(async()=>{let l=await l5();if(o.value=l.map((i)=>({label:i.label??i.family,style:{fontFamily:i.family},onClick:n(i)})),!e)o.value[0]?.onClick()},[e,n]),a5(E3,{className:U1.fontSelector,items:o.value,children:a5("span",{className:U1.displayedFontName,style:{fontFamily:e?.family},children:e?.label??e?.family})})}import{useCallback as Y}from"preact/hooks";import{classNames as S,keyMirror as Y3}from"@blockcode/utils";import{translate as Q,Button as P}from"@blockcode/core";z(":root{--paint-tools-box-width:6rem}.a1L2ya_tools-box-wrapper{width:var(--paint-tools-box-width);flex-flow:wrap;place-content:flex-start space-between;display:flex}.a1L2ya_small{width:3rem}.a1L2ya_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.a1L2ya_tool-button.a1L2ya_selected{background:var(--theme-primary)}.a1L2ya_tool-icon{vertical-align:middle;width:2rem;height:2rem}.a1L2ya_tool-button.a1L2ya_selected .a1L2ya_tool-icon{filter:brightness(0)invert()}");var L={small:"a1L2ya_small",toolsBoxWrapper:"a1L2ya_tools-box-wrapper",toolButton:"a1L2ya_tool-button",toolIcon:"a1L2ya_tool-icon",selected:"a1L2ya_selected"};var L1="./assets/icon-pen-vmav54fy.svg";var x1="./assets/icon-eraser-6exvhk0q.svg";var c5="./assets/icon-fill-70s8y3f8.svg";var d5="./assets/icon-text-e5hysycg.svg";var M1="./assets/icon-line-r61p9edw.svg";var v1="./assets/icon-curve-sngqpytw.svg";var s5="./assets/icon-rectangle-yasy0y9k.svg";var h5="./assets/icon-circle-ynejmr8k.svg";var f1="./assets/icon-isogon-dhadjxez.svg";var g5="./assets/icon-polygon-d2x4vbt9.svg";var w5="./assets/icon-select-7g007t5g.svg";import{jsx as k,jsxs as Q3}from"preact/jsx-runtime";var r=Y3({Pen:null,Eraser:null,Fill:null,Text:null,Line:null,Curve:null,Rectangle:null,Circle:null,Isogon:null,Polygon:null,Selector:null,Center:null,ColorPicker:null,OutlineColorPicker:null});function C5({small:e,paintTool:t,onSelect:o}){return Q3("div",{className:S(L.toolsBoxWrapper,{[L.small]:e}),children:[k(P,{className:S(L.toolButton,{[L.selected]:t===r.Pen}),onClick:Y(()=>o(r.Pen),[]),children:k("img",{src:L1,className:L.toolIcon,title:Q("paint.painter.pen","Pen")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Eraser}),onClick:Y(()=>o(r.Eraser),[]),children:k("img",{src:x1,className:L.toolIcon,title:Q("paint.painter.eraser","Eraser")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Fill}),onClick:Y(()=>o(r.Fill),[]),children:k("img",{src:c5,className:L.toolIcon,title:Q("paint.painter.fill","Fill")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Text}),onClick:Y(()=>o(r.Text),[]),children:k("img",{src:d5,className:L.toolIcon,title:Q("paint.painter.text","Text")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Line}),onClick:Y(()=>o(r.Line),[]),children:k("img",{src:M1,className:L.toolIcon,title:Q("paint.painter.line","Line")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Curve}),onClick:Y(()=>o(r.Curve),[]),children:k("img",{src:v1,className:L.toolIcon,title:Q("paint.painter.curve","Curve")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Rectangle}),onClick:Y(()=>o(r.Rectangle),[]),children:k("img",{src:s5,className:L.toolIcon,title:Q("paint.painter.rectangle","Rectangle")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Circle}),onClick:Y(()=>o(r.Circle),[]),children:k("img",{src:h5,className:L.toolIcon,title:Q("paint.painter.circle","Circle")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Isogon}),onClick:Y(()=>o(r.Isogon),[]),children:k("img",{src:f1,className:L.toolIcon,title:Q("paint.painter.isogon","Isogon")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Polygon}),onClick:Y(()=>o(r.Polygon),[]),children:k("img",{src:g5,className:L.toolIcon,title:Q("paint.painter.polygon","Polygon")})}),k(P,{className:S(L.toolButton,{[L.selected]:t===r.Selector}),onClick:Y(()=>o(r.Selector),[]),children:k("img",{src:w5,className:L.toolIcon,title:Q("paint.painter.select","Select")})})]})}import{useEffect as I1,useRef as p0,useCallback as r1}from"preact/hooks";import{useSignal as c0}from"@preact/signals";import{classNames as z5,Konva as R}from"@blockcode/utils";import{useProjectContext as d0,Keys as $}from"@blockcode/core";var P3=(e)=>{let t;for(let o=0;o<e.height;o++){t=o*e.width;for(let n=0;n<e.width;n++){if(e.data[(t<<2)+3]!==0)return o;t++}}return 0},R3=(e,t)=>{let o;for(let n=e.height-1;n>=t;n--){o=n*e.width;for(let l=0;l<e.width;l++){if(e.data[(o<<2)+3]!==0)return n;o++}}return 0},j3=(e,t,o)=>{let n;for(let l=0;l<e.width;l++)for(let i=t;i<=o;i++)if(n=i*e.width+l,e.data[(n<<2)+3]!==0)return l;return 0},V3=(e,t,o,n)=>{let l;for(let i=e.width-1;i>=n;i--)for(let a=t;a<=o;a++)if(l=a*e.width+i,e.data[(l<<2)+3]!==0)return i;return 0};function u5(e){let t=P3(e),o=R3(e,t),n=j3(e,t,o),l=V3(e,t,o,n);return{top:t,left:n,right:l,bottom:o,x:n,y:t,width:l-n+1,height:o-t+1}}var m5="image/png",J3=`data:${m5};base64,`.length;async function L5(e,t){let l=(await e.toCanvas({pixelRatio:1})).getContext("2d").getImageData(0,0,e.width(),e.height()),i=u5(l),p=e.toDataURL({...i,mimeType:m5}).slice(J3),h=t.x-i.x,s=t.y-i.y,v=i.width,N=i.height;return{data:p,centerX:h,centerY:s,width:v,height:N}}z(".vAiLFq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:relative;overflow:hidden}.vAiLFq_draw-container{image-rendering:pixelated;scrollbar-gutter:stable;scrollbar-width:8px;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);margin:0;padding:0;position:absolute;inset:0;overflow:scroll}.vAiLFq_draw-container.vAiLFq_text{cursor:text}.vAiLFq_draw-container.vAiLFq_center{cursor:crosshair}.vAiLFq_draw-container.vAiLFq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}.vAiLFq_center-icon{pointer-events:none;filter:opacity(.7);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.vAiLFq_center-icon.vAiLFq_hidden{display:none}");var K={text:"vAiLFq_text",drawContainer:"vAiLFq_draw-container",center:"vAiLFq_center",picker:"vAiLFq_picker",hidden:"vAiLFq_hidden",centerIcon:"vAiLFq_center-icon",drawBox:"vAiLFq_draw-box"};import{Konva as $3}from"@blockcode/utils";var y1={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new $3.Line({stroke:this.color.hex,strokeWidth:this.size,globalCompositeOperation:this.isEraser?"destination-out":"source-over",lineCap:"round",lineJoin:"round",points:[t.x,t.y,t.x,t.y]}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points().concat([t.x,t.y]);this.poly.points(o)},onEnd(e){this.poly.addName("done"),this.poly=null}};var x5={...y1,isEraser:!0};import{Color as M5,sleepMs as H3,Konva as X3}from"@blockcode/utils";var v5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.pixels=[],this.color=t.color},getIndex(e,t){let o=this.layer.width();return t*o+e<<2},getPos(e){let t=this.layer.width(),o=e>>2,n=Math.floor(o/t);return{x:o-n*t,y:n}},checkPixel(e,t,o){if(e<0||t<0||e>=this.imageData.width||t>=this.imageData.height)return;let n=this.getIndex(e,t);if(this.pixels.includes(n))return;let l=this.imageData.data.slice(n,n+4),i=new M5(Array.from(l));if(i.equals(o)&&i.notEquals(this.color))this.pixels.push(n)},async fill(e){let t=Math.floor(e.x),o=Math.floor(e.y),n=this.color.rgb,l=this.color.clear?0:255,i=this.layer.width(),a=this.layer.height(),h=(await this.layer.toCanvas({pixelRatio:1})).getContext("2d");this.imageData=h.getImageData(0,0,i,a);let s=this.getIndex(t,o),v=this.imageData.data.slice(s,s+4),N=new M5(Array.from(v));this.checkPixel(t,o,N);let B=h.createImageData(i,a);while(this.pixels.length>0)s=this.pixels.shift(),B.data[s+0]=n.r,B.data[s+1]=n.g,B.data[s+2]=n.b,B.data[s+3]=l,this.imageData.data[s+0]=n.r,this.imageData.data[s+1]=n.g,this.imageData.data[s+2]=n.b,this.imageData.data[s+3]=l,e=this.getPos(s),this.checkPixel(e.x-1,e.y,N),this.checkPixel(e.x+1,e.y,N),this.checkPixel(e.x,e.y-1,N),this.checkPixel(e.x,e.y+1,N);return this.imageData=null,h.putImageData(B,0,0),h.canvas.toDataURL()},async onBegin(e){if(this.color.clear)return;this.filling=!0;let t=this.stage.getPointerPosition(),o=await this.fill(t);this.image=new X3.Image({x:0,y:0}),this.layer.add(this.image),m1(o).then((n)=>{this.image.image(n),this.filling=!1})},async onEnd(e){this.pixels.length=0;while(!0){if(!this.filling)break;await H3(50)}this.image.addName("done"),this.image=null}};import{Konva as q3}from"@blockcode/utils";var K3=30,f5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.fontFamily=t.fontFamily,this.color=t.color},cancel(){this.cancelEditbox?.(),this.poly=null},enableEditbox(){this.poly.hide();let e=this.poly.absolutePosition(),t=this.stage.container().getBoundingClientRect(),o={x:t.x+e.x,y:t.y+e.y},n=document.createElement("div");document.body.appendChild(n),n.innerText=this.poly.text(),n.contentEditable="plaintext-only",n.style.position="absolute",n.style.top=o.y+"px",n.style.left=o.x+"px",n.style.minWidth=this.poly.fontSize()+"px",n.style.fontSize=this.poly.fontSize()+"px",n.style.border="none",n.style.padding="0px",n.style.margin="0px",n.style.background="none",n.style.outline="none",n.style.resize="auto",n.style.lineHeight=this.poly.lineHeight(),n.style.fontFamily=this.poly.fontFamily(),n.style.transformOrigin="left top",n.style.textAlign=this.poly.align(),n.style.color=this.poly.fill(),n.focus(),n.addEventListener("blur",()=>n.focus()),this.cancelEditbox=()=>{this.poly.text(n.innerText.trimEnd()),n.parentNode.removeChild(n),this.poly.show()}},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new q3.Text({x:t.x,y:t.y,text:"",fontSize:K3,fontFamily:this.fontFamily,fill:this.color.hex}),this.layer.add(this.poly),this.enableEditbox(this.stage,this.poly)},onDone(e){if(!this.poly)return;if(this.cancelEditbox?.(),this.poly.text().length===0)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null,this.cancelEditbox=null}};import{Konva as t0}from"@blockcode/utils";var y5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new t0.Line({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[t.x,t.y]}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points();o[2]=t.x,o[3]=t.y,this.poly.points(o)},onEnd(e){this.poly.addName("done"),this.poly=null}};import{Konva as e0}from"@blockcode/utils";var k5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},cancel(){if(!this.poly)return;let e=this.poly.getAttr("points");e.pop(),e.pop(),this.poly.setAttr("points",e),this.poly=null},draw(e,t){let o=t.getAttr("points"),n=t.x(),l=t.y();if(e.beginPath(),e.moveTo(o[0]-n,o[1]-l),o.length<6)e.lineTo(o[2]-n,o[3]-l);else{let p=2;for(;p<o.length-4;p+=2){var i=(o[p]-n+(o[p+2]-n))/2,a=(o[p+1]-l+(o[p+3]-l))/2;e.quadraticCurveTo(o[p]-n,o[p+1]-l,i,a)}e.quadraticCurveTo(o[p]-n,o[p+1]-l,o[p+2]-n,o[p+3]-l)}e.fillStrokeShape(t)},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new e0.Shape({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[t.x,t.y],sceneFunc:this.draw}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.getAttr("points"),n=o.length;o[n-2]=t.x,o[n-1]=t.y,this.poly.setAttr("points",o)},onEnd(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.getAttr("points");o.push(t.x),o.push(t.y),this.poly.setAttr("points",o)},onDone(e){this.poly.addName("done"),this.poly=null}};import{Konva as i0}from"@blockcode/utils";var I5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new i0.Rect({x:t.x,y:t.y,width:1,height:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n;this.poly.setAttrs({width:Math.abs(l),height:Math.abs(i),scale:{x:l<0?-1:1,y:i<0?-1:1}})},onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as o0}from"@blockcode/utils";var N5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new o0.Ellipse({x:t.x,y:t.y,radius:{x:1,y:1},fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n,a=e.evt.shiftKey||e.evt.ctrlKey||e.evt.metaKey,p=Math.sqrt(l*l+i*i);this.poly.setAttrs({radius:{x:a?p:Math.abs(l),y:a?p:Math.abs(i)},scale:{x:l<0?-1:1,y:i<0?-1:1}})},onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as n0}from"@blockcode/utils";var b5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.sides=t.sides,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new n0.RegularPolygon({x:t.x,y:t.y,sides:this.sides,radius:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n,a=Math.sqrt(l*l+i*i);this.poly.setAttrs({radius:a,scale:{x:l<0?-1:1,y:i<0?-1:1}})},onEnd(e){if(!this.poly)return;if(this.poly.radius()<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as r0}from"@blockcode/utils";var B5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},cancel(){if(!this.poly)return;let e=this.poly.getAttr("points");e.pop(),e.pop(),this.poly.setAttr("points",e),this.poly=null},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new r0.Line({points:[t.x,t.y],lineCap:"round",lineJoin:"round",closed:!0,fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points(),n=o.length;o[n-2]=t.x,o[n-1]=t.y,this.poly.points(o)},onEnd(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points();o.push(t.x),o.push(t.y),this.poly.points(o)},onDone(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as D5}from"@blockcode/utils";import{themeColors as l0}from"@blockcode/core";var E5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.selectorLayer=this.stage.getLayers().at(-1)},cancel(){this.clipImage?.remove?.(),this.clipImage=null},async clip(){this.poly.setAttr("stroke","transparent"),this.poly.moveTo(this.layer);let e=this.poly.getClientRect(),t=await this.layer.toImage(e);this.clipImage=new D5.Image({image:t,x:e.x,y:e.y,name:"selector",draggable:!0}),this.layer.add(this.clipImage),this.poly.setAttrs({fill:"black",globalCompositeOperation:"destination-out"})},onBegin(e){let t=this.stage.getPointerPosition();this.poly=new D5.Rect({x:t.x,y:t.y,width:1,height:1,dash:[5,5],fill:"transparent",stroke:l0.ui.theme.highlight,strokeWidth:1}),this.selectorLayer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n;this.poly.setAttrs({width:Math.abs(l),height:Math.abs(i),scale:{x:l<0?-1:1,y:i<0?-1:1}})},async onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else await this.clip();this.poly=null}};var _5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.changeCenter=t.onCenterChange},onBegin(e){let t=this.stage.getPointerPosition();this.changeCenter(t)}};import{Color as F5}from"@blockcode/utils";var S1={setup(e,t){this.stage=e.getStage(),this.layer=e,this.ctx=e.getContext(),this.pickColor=t.onPickColor},getIndex(e){let t=this.layer.width(),o=Math.floor(e.x);return Math.floor(e.y)*t+o<<2},onBegin(e){let t=this.layer.width(),o=this.layer.height();this.imageData=this.ctx.getImageData(0,0,t,o);let n=this.stage.getPointerPosition(),l=this.getIndex(n),i=this.imageData.data.slice(l,l+4),a=new F5(Array.from(i));this.pickColor(a)},onDrawing(e){let t=this.stage.getPointerPosition(),o=this.getIndex(t),n=this.imageData.data.slice(o,o+4),l=new F5(Array.from(n));this.pickColor(l)},onEnd(e){this.imageData=null}};var k1="./assets/icon-center-1pm93998.svg";import{jsx as A5,jsxs as h0}from"preact/jsx-runtime";var s0={[r.Pen]:y1,[r.Eraser]:x5,[r.Fill]:v5,[r.Text]:f5,[r.Line]:y5,[r.Curve]:k5,[r.Rectangle]:I5,[r.Circle]:N5,[r.Isogon]:b5,[r.Polygon]:B5,[r.Selector]:E5,[r.Center]:_5,[r.ColorPicker]:S1,[r.OutlineColorPicker]:S1};function G5({zoom:e,maxSize:t,toolOptions:o,onSizeChange:n,onChange:l}){let i=p0(null),{asset:a,assetId:p,modified:h}=d0(),s=c0(null),v=r1(async()=>{if(s.value?.type===r.Center)return;if(i.drawLayer.children.length<=1)return;let g=i.image.position();g.x+=a.value.centerX,g.y+=a.value.centerY;let c=await L5(i.drawLayer,g);l(c)},[l]),N=r1((g)=>{let c=i.image.position(),w=g.x-c.x,y=g.y-c.y;l({centerX:w,centerY:y})},[l]),B=r1(()=>{let g=i.stage.find(".selector");if(g.length>0)return i.transformer.nodes(g),!0},[]),G=r1(()=>{let g=i.transformer.nodes();if(g.length>0)return i.transformer.nodes([]),g.forEach((c)=>{c.removeName("selector"),c.addName("done")}),!0},[]),Z=r1(()=>{i.painting=!1,i.transformer.nodes([]);for(let g of i.drawLayer.children)if(g!==i.image)g.remove();s.value?.cancel?.()},[]),D=r1((g)=>{if(g.target.tagName==="INPUT")return;switch(g.code){case $.ESC:case $.DELETE:case $.BACKSPACE:if(g.code!==$.ESC&&s.value?.type===r.Text)return;g.preventDefault(),Z();return;case $.RETURN:case $.ENTER:if(s.value?.type===r.Text)return;g.preventDefault(),G(),v();return;case $.LEFT:g.preventDefault(),i.transformer.nodes().forEach((c)=>c.x(c.x()-1));return;case $.RIGHT:g.preventDefault(),i.transformer.nodes().forEach((c)=>c.x(c.x()+1));return;case $.UP:g.preventDefault(),i.transformer.nodes().forEach((c)=>c.y(c.y()-1));return;case $.DOWN:g.preventDefault(),i.transformer.nodes().forEach((c)=>c.y(c.y()+1));return}},[Z]);return I1(async()=>{if(!/image\//.test(a.value?.type)||!i.image)return;let g=await u1(a.value);i.image.image(g),i.image.position({x:i.stage.width()/2-a.value.centerX,y:i.stage.height()/2-a.value.centerY}),Z()},[p.value,h.value,Z]),I1(()=>{if(i.stage){let{clientWidth:g,clientHeight:c,scrollLeft:w,scrollTop:y,scrollWidth:b,scrollHeight:u}=i.current,F={top:c/2,left:g/2},H={top:(y+F.top)/u*(c*e)-F.top,left:(w+F.left)/b*(g*e)-F.left,behavior:"instant"};i.stage.content.style.zoom=e,i.current.scrollTo(H)}},[e]),I1(async()=>{if(i.drawLayer){if(s.value?.type!==o.type){if(G())await v();if(Z(),s.value=s0[o.type],s.value)s.value.type=o.type}if(o.type===r.Center)o.onCenterChange=N;s.value?.setup?.(i.drawLayer,o)}},[o,G,N,v]),I1(()=>{if(i.current){let{clientWidth:g,clientHeight:c}=i.current,w=Math.max(t.width,g),y=Math.max(t.height,c);i.stage=new R.Stage({container:i.current,width:w,height:w}),n({width:g,height:c});let b=new R.Layer({listening:!1}),u=new R.Layer;i.drawLayer=new R.Layer,i.stage.add(i.drawLayer,b,u);let F=(w-t.width)/2,H=(y-t.height)/2,l1=new R.Rect({x:0,y:0,width:w,height:H,fill:"black",opacity:0.2}),s1=new R.Rect({x:0,y:y-H,width:g,height:H,fill:"black",opacity:0.2}),h1=new R.Rect({x:0,y:H,width:F,height:t.height,fill:"black",opacity:0.2}),g1=new R.Rect({x:w-F,y:H,width:F,height:t.height,fill:"black",opacity:0.2});if(b.add(l1,s1,h1,g1),i.transformer=new R.Transformer({anchorStyleFunc(x){if(x.cornerRadius(5),x.hasName("top-center")||x.hasName("bottom-center"))x.height(6),x.offsetY(3),x.width(12),x.offsetX(6);if(x.hasName("middle-left")||x.hasName("middle-right"))x.height(12),x.offsetY(6),x.width(6),x.offsetX(3)}}),u.add(i.transformer),i.image=new R.Image,i.drawLayer.add(i.image),a.value)u1(a.value).then((x)=>{i.image.image(x),i.image.position({x:i.stage.width()/2-a.value.centerX,y:i.stage.height()/2-a.value.centerY})});i.painting=!1,i.stage.on("contextmenu",(x)=>x.evt.preventDefault()),i.stage.on("pointerdown",async(x)=>{if(i.painting||x.target.name()==="selector"||x.target.parent instanceof R.Transformer)return;if([r.ColorPicker,r.OutlineColorPicker].includes(s.value?.type))x.evt.stopPropagation();if(G()){await v(),s.value?.cancel?.();return}if(!s.value)return;s.value.onBegin?.(x),i.painting=!0}),i.stage.on("pointermove",(x)=>{if(i.painting)x.evt.preventDefault(),s.value.onDrawing?.(x)}),i.stage.on("pointerup",async(x)=>{if(i.painting){if(i.painting=!!s.value.onDone,await s.value.onEnd?.(x),[r.Curve,r.Text,r.Polygon].includes(s.value.type))return;if([r.Rectangle,r.Circle,r.Isogon,r.Selector].includes(s.value.type))B();else v()}}),i.stage.on("pointerdblclick",async(x)=>{if(i.painting&&[r.Polygon,r.Text,r.Curve].includes(s.value.type))if(i.painting=!1,await s.value.onDone?.(x),[r.Polygon,r.Text].includes(s.value.type))B();else v()}),document.addEventListener("keydown",D),i.resizeObserver=new ResizeObserver(()=>{if(!i.stage)return;let{clientWidth:x,clientHeight:w1}=i.current,q=Math.max(t.width,x),i1=Math.max(t.height,w1);if(i.stage.size({width:q,height:i1}),n({width:x,height:w1}),a.value)i.image.position({x:q/2-a.value.centerX,y:i1/2-a.value.centerY});let a1=(q-t.width)/2,m=(i1-t.height)/2;l1.size({width:q,height:m}),s1.setAttrs({y:i1-m,width:q,height:m}),h1.setAttrs({y:m,width:a1}),g1.setAttrs({x:q-a1,y:m,width:a1})}),i.resizeObserver.observe(i.current)}return()=>{document.removeEventListener("keydown",D),s.value?.cancel?.(),i.resizeObserver.unobserve(i.current),i.stage.destroy(),i.stage=null}},[i]),h0("div",{className:K.drawBox,children:[A5("div",{ref:i,className:z5(K.drawContainer,{[K.text]:s.value?.type===r.Text,[K.center]:s.value?.type===r.Center,[K.picker]:s.value?.type===r.ColorPicker||s.value?.type===r.OutlineColorPicker})}),A5("img",{src:k1,className:z5(K.centerIcon,{[K.hidden]:s.value?.type!==r.Center})})]})}z("._03BnxG_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._03BnxG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._03BnxG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._03BnxG_row-bottom{margin-right:var(--space);margin-left:calc(var(--paint-tools-box-width) + var(--space));justify-content:space-between}._03BnxG_row-bottom>div{display:inline-flex}._03BnxG_row:last-child{min-height:unset;margin-bottom:0}._03BnxG_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._03BnxG_disabled{opacity:.3;pointer-events:none}._03BnxG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._03BnxG_name-input{width:8rem}._03BnxG_large-input{width:4rem}._03BnxG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._03BnxG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._03BnxG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._03BnxG_tile-map-button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);height:calc(2rem + 2px);padding:.375rem}._03BnxG_button-left-icon{margin-right:calc(var(--space))}._03BnxG_button-icon{width:1.5rem;margin:auto}._03BnxG_group-button{border-left:none;border-radius:0}._03BnxG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._03BnxG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._03BnxG_group-button-toggled-off{filter:saturate(0)}._03BnxG_label-button{border:0;font-weight:400}._03BnxG_label-button._03BnxG_selected{background:var(--theme-primary);color:var(--ui-white)}._03BnxG_label-button._03BnxG_selected ._03BnxG_button-icon{filter:brightness(0)invert()}._03BnxG_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}._03BnxG_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;min-height:2rem;max-height:30vh;overflow:auto}._03BnxG_displayed-font-name{font-size:.8rem}");var d={labelButton:"_03BnxG_label-button",groupButtonToggledOff:"_03BnxG_group-button-toggled-off",groupButtonLast:"_03BnxG_group-button-last",toolGroup:"_03BnxG_tool-group",drawBoxWrapper:"_03BnxG_draw-box-wrapper",largeInput:"_03BnxG_large-input",tileMapButton:"_03BnxG_tile-map-button",rowFill:"_03BnxG_row-fill",fontSelector:"_03BnxG_font-selector",rowBottom:"_03BnxG_row-bottom",toolIcon:"_03BnxG_tool-icon",groupButton:"_03BnxG_group-button",row:"_03BnxG_row",painterWrapper:"_03BnxG_painter-wrapper",groupButtonFirst:"_03BnxG_group-button-first",dashedBorder:"_03BnxG_dashed-border",buttonIcon:"_03BnxG_button-icon",displayedFontName:"_03BnxG_displayed-font-name",selected:"_03BnxG_selected",nameInput:"_03BnxG_name-input",labelImage:"_03BnxG_label-image",buttonLeftIcon:"_03BnxG_button-left-icon",button:"_03BnxG_button",disabled:"_03BnxG_disabled"};var Z5="./assets/icon-undo-q4nwvpxj.svg";var T5="./assets/icon-redo-mrvqwv38.svg";var O5="./assets/icon-crop-qqsh68n1.svg";var U5="./assets/icon-zoom-in-s316e3qy.svg";var S5="./assets/icon-zoom-out-y9xmwx8c.svg";var W5="./assets/icon-zoom-reset-xne8n5sw.svg";var Y5="./assets/icon-tilemap-m9n9bthp.svg";var Q5="./assets/icon-delete-97b0qwkk.svg";var P5="./assets/icon-flip-horizontal-kg60c0nb.svg";var R5="./assets/icon-flip-vertical-09q4h4q8.svg";import{jsx as C,jsxs as _,Fragment as B0}from"preact/jsx-runtime";var b0=30,B1=0.5,V5=20,J5=(e)=>{switch(e){case E.Image:return V("paint.painter.image","Image").toLowerCase();case E.Costume:return V("paint.painter.costume","Costume").toLowerCase();case E.Backdrop:return V("paint.painter.backdrop","Backdrop").toLowerCase()}};function P1({mode:e,maxSize:t}){let{asset:o,assetId:n,modified:l}=I0(),i=W(1),a=W(!1),p=W(null),h=W(r.Pen),s=W(10),v=W(2),N=W(6),B=W(null),G=W(new j5([260,0.6,1])),Z=W(new j5([0,1,0])),D=W([]),g=W([]),c=k0(()=>o.value?.name,[n.value,l.value]),w=!/image\//.test(o.value?.type);y0(()=>{c1(()=>{if(p.value=null,D.value=null,g.value=null,D.value=[],g.value=[],o.value)D.value.push(Object.assign({},o.value))})},[n.value]);let y=W1(()=>h.value!==r.Rectangle&&h.value!==r.Circle&&h.value!==r.Isogon&&h.value!==r.Polygon),b=W1(()=>h.value===r.Pen||h.value===r.Eraser||h.value===r.Line||h.value===r.Curve),u=W1(()=>{if(h.value===r.Eraser)return x1;if(h.value===r.Line)return M1;if(h.value===r.Curve)return v1;return L1}),F=I((m)=>N1({name:m}),[]),H=I((m)=>{if(p.value===r.ColorPicker)G.value=m;else if(p.value===r.OutlineColorPicker)Z.value=m},[]),l1=I((m)=>(q5)=>{if(q5)p.value=m;else p.value=null},[]),s1=I((m)=>v.value=Y1.clamp(m,0,100),[]),h1=I((m)=>s.value=Y1.clamp(m,1,100),[]),g1=I((m)=>N.value=Y1.clamp(m,3,20),[]),x=I((m)=>B.value=m,[]),w1=I((m)=>{a.value=a.value?m.width<390:m.width<340},[]),q=I((m)=>{c1(()=>{if(D.value.length>b0)D.value.shift();if(m)g.value.length=0,D.value.push(m),N1(m)})},[]),i1=I(()=>{c1(()=>{p.value=null;let m=D.value.pop();g.value.push(m),m=D.value[D.value.length-1],N1(m)})},[]),a1=I(()=>{c1(()=>{p.value=null;let m=g.value.pop();D.value.push(m),N1(m)})},[]);return _("div",{className:d.painterWrapper,children:[_("div",{className:d.row,children:[C("div",{className:d.toolGroup,children:C(Q1,{text:J5(e),children:C(b1,{disabled:w,className:d.nameInput,placeholder:V("paint.painter.name","name"),onSubmit:F,value:c?N0(c):J5(e)})})}),_("div",{className:d.toolGroup,children:[C(j,{disabled:D.value.length<=1,className:O(d.button,d.groupButtonFirst,{[d.groupButtonToggledOff]:w}),onClick:i1,children:C("img",{src:Z5,className:d.buttonIcon,title:V("paint.painter.undo","Undo")})}),C(j,{disabled:g.value.length===0,className:O(d.button,d.groupButtonLast,{[d.groupButtonToggledOff]:w}),onClick:a1,children:C("img",{src:T5,className:d.buttonIcon,title:V("paint.painter.redo","Redo")})})]}),_("div",{className:d.toolGroup,children:[_(j,{vertical:!0,disabled:e!==E.Costume,className:O(d.labelButton,{[d.selected]:p.value===r.Center}),onClick:I(()=>p.value=p.value!==r.Center?r.Center:null,[]),children:[C("img",{src:k1,className:d.buttonIcon,title:V("paint.painter.center","Center")}),C(d1,{id:"paint.painter.center",defaultMessage:"Center"})]}),_(j,{vertical:!0,disabled:!0,className:d.labelButton,onClick:I(()=>null,[]),children:[C("img",{src:O5,className:d.buttonIcon,title:V("paint.painter.crop","Auto Crop")}),C(d1,{id:"paint.painter.crop",defaultMessage:"Auto Crop"})]})]})]}),_("div",{className:d.row,children:[C("div",{className:d.toolGroup,children:C(Q1,{className:O({[d.disabled]:h.value===r.Eraser||h.value===r.Selector}),text:C(d1,{id:"paint.painter.fill",defaultMessage:"Fill"}),children:C(O1,{picking:p.value===r.ColorPicker,color:G.value,onChange:I((m)=>G.value=m,[]),onPickingColor:l1(r.ColorPicker)})})}),_("div",{className:O(d.toolGroup,d.dashedBorder),children:[C(Q1,{className:O({[d.disabled]:y.value}),text:C(d1,{id:"paint.painter.outline",defaultMessage:"Outline"}),children:C(O1,{outline:!0,picking:p.value===r.OutlineColorPicker,color:Z.value,onChange:I((m)=>Z.value=m,[]),onPickingColor:l1(r.OutlineColorPicker)})}),C(b1,{small:!0,type:"number",className:O(d.largeInput,{[d.disabled]:y.value}),value:v.value,onSubmit:s1})]}),b.value&&_("div",{className:d.toolGroup,children:[C("img",{src:u,className:d.toolIcon}),C(b1,{small:!0,type:"number",className:d.largeInput,value:s.value,onSubmit:h1})]}),h.value===r.Isogon&&_("div",{className:d.toolGroup,children:[C("img",{src:f1,className:d.toolIcon}),C(b1,{small:!0,type:"number",className:d.largeInput,value:N.value,onSubmit:g1})]}),h.value===r.Text&&C(p5,{font:B.value,onChange:x}),h.value===r.Selector&&_(B0,{children:[C("div",{className:O(d.toolGroup,d.dashedBorder),children:C(j,{disabled:!0,className:d.labelButton,onClick:I(()=>{},[]),children:C("img",{src:Q5,className:d.buttonIcon,title:V("paint.painter.delete","Delete")})})}),_("div",{className:d.toolGroup,children:[C(j,{disabled:!0,className:d.labelButton,onClick:I(()=>{},[]),children:C("img",{src:P5,className:d.buttonIcon,title:V("paint.painter.flipHorizontal","Flip Horizontal")})}),C(j,{disabled:!0,className:d.labelButton,onClick:I(()=>{},[]),children:C("img",{src:R5,className:d.buttonIcon,title:V("paint.painter.flipVertical","Flip Vertical")})})]})]})]}),_("div",{className:O(d.row,d.rowFill),children:[C(C5,{small:a.value,paintTool:h.value,onSelect:I((m)=>c1(()=>{h.value=m,p.value=null}),[])}),C("div",{className:d.drawBoxWrapper,children:C(G5,{zoom:i.value,maxSize:t,toolOptions:{type:p.value||h.value,size:s.value,sides:N.value,color:G.value,fontFamily:B.value?.family,outlineWidth:v.value,outlineColor:Z.value,onPickColor:H},onSizeChange:w1,onChange:q})})]}),_("div",{className:O(d.row,d.rowBottom),children:[C("div",{children:e===E.Backdrop&&_(j,{disabled:!0,className:d.tileMapButton,children:[C("img",{className:d.buttonLeftIcon,src:Y5}),C(d1,{id:"paint.mode.tileMap",defaultMessage:"Convert to TileMap"})]})}),_("div",{children:[C(j,{disabled:i.value===1,className:O(d.button,d.groupButtonFirst),onClick:I(()=>i.value-B1>=1&&(i.value=i.value-B1),[]),children:C("img",{src:S5,className:d.buttonIcon})}),C(j,{disabled:i.value===1,className:O(d.button,d.groupButton),onClick:I(()=>i.value=1,[]),children:C("img",{src:W5,className:d.buttonIcon})}),C(j,{disabled:i.value===V5,className:O(d.button,d.groupButtonLast),onClick:I(()=>i.value+B1<V5&&(i.value=i.value+B1),[]),children:C("img",{src:U5,className:d.buttonIcon})})]})]})]})}z(".TDnbAa_pixel-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var $5={pixelEditorWrapper:"TDnbAa_pixel-editor-wrapper"};import{jsx as H5,jsxs as E0}from"preact/jsx-runtime";function D0({mode:e,maxSize:t,onImagesFilter:o,onShowLibrary:n,onSurprise:l,onChange:i,onDelete:a}){return E0("div",{className:$5.pixelEditorWrapper,children:[H5(n5,{mode:e,maxSize:t,onImagesFilter:o,onShowLibrary:n,onSurprise:l,onChange:i,onDelete:a}),H5(P1,{mode:e,maxSize:t})]})}import{Text as F0}from"@blockcode/core";var X5="./assets/icon-paint-fcmp1zp4.svg";import{jsx as A0}from"preact/jsx-runtime";var z0={icon:X5,label:A0(F0,{id:"paint.painter.image",defaultMessage:"Image"})};export{z0 as paintTab,m1 as loadImageFromURL,E1 as loadImageFromFile,u1 as loadImageFromAsset,D0 as PaintEditor,E as EditorModes,C1 as BlankImageData};
