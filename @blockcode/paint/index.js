import{addLocalesMessages as K5}from"@blockcode/core";var j1={"paint.contextMenu.duplicate":"duplicate","paint.contextMenu.export":"export","paint.contextMenu.delete":"delete","paint.actionButton.upload":"Upload Image","paint.actionButton.uploadCostume":"Upload Costume","paint.actionButton.uploadBackdrop":"Upload Backdrop","paint.actionButton.uploadError":'Upload "{file}" failed.',"paint.actionButton.surprise":"Surprise","paint.actionButton.paint":"Paint","paint.actionButton.image":"Choose a Image","paint.actionButton.costume":"Choose a Costume","paint.actionButton.backdrop":"Choose a Backdrop","paint.painter.image":"Image","paint.painter.costume":"Costume","paint.painter.backdrop":"Backdrop","paint.painter.name":"name","paint.painter.undo":"Undo","paint.painter.redo":"Redo","paint.painter.pen":"Pen","paint.painter.eraser":"Eraser","paint.painter.fill":"Fill","paint.painter.text":"Text","paint.painter.line":"Line","paint.painter.curve":"Curve","paint.painter.rectangle":"Rectangle","paint.painter.circle":"Circle","paint.painter.isogon":"Isogon","paint.painter.polygon":"Polygon","paint.painter.select":"Select","paint.painter.center":"Center","paint.painter.outline":"Outline","paint.painter.delete":"Delete","paint.painter.flipHorizontal":"Flip Horizontal","paint.painter.flipVertical":"Flip Vertical","paint.painter.copy":"Copy","paint.painter.paste":"Paste","paint.colorPicker.color":"Color","paint.colorPicker.saturation":"Saturation","paint.colorPicker.brightness":"Brightness","paint.mode.bitmap":"Convert to Bitmap","paint.mode.tileMap":"Convert to TileMap"};var J1={"paint.contextMenu.duplicate":"复制","paint.contextMenu.export":"导出","paint.contextMenu.delete":"删除","paint.actionButton.upload":"上传图片","paint.actionButton.uploadCostume":"上传造型","paint.actionButton.uploadBackdrop":"上传背景","paint.actionButton.uploadError":"上传“{file}”失败。","paint.actionButton.surprise":"随机","paint.actionButton.paint":"绘制","paint.actionButton.image":"选择一个图片","paint.actionButton.costume":"选择一个造型","paint.actionButton.backdrop":"选择一个背景","paint.painter.image":"图片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤销","paint.painter.redo":"重做","paint.painter.pen":"画笔","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"线段","paint.painter.curve":"曲线","paint.painter.rectangle":"矩形","paint.painter.circle":"圆形","paint.painter.isogon":"正多边形","paint.painter.polygon":"任意多边形","paint.painter.select":"选择","paint.painter.center":"中心","paint.painter.outline":"轮廓","paint.painter.delete":"删除","paint.painter.flipHorizontal":"水平翻转","paint.painter.flipVertical":"垂直翻转","paint.painter.copy":"复制","paint.painter.paste":"粘贴","paint.colorPicker.color":"颜色","paint.colorPicker.saturation":"饱和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"转换为位图","paint.mode.tileMap":"转换为拼贴地图"};var V1={"paint.contextMenu.duplicate":"複製","paint.contextMenu.export":"導齣","paint.contextMenu.delete":"刪除","paint.actionButton.upload":"上傳圖片","paint.actionButton.uploadCostume":"上傳造型","paint.actionButton.uploadBackdrop":"上傳背景","paint.actionButton.uploadError":"上傳“{file}”失敗。","paint.actionButton.surprise":"隨機","paint.actionButton.paint":"繪製","paint.actionButton.image":"選擇一個圖片","paint.actionButton.costume":"選擇一個造型","paint.actionButton.backdrop":"選擇一個背景","paint.painter.image":"圖片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤銷","paint.painter.redo":"重做","paint.painter.pen":"畫筆","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"線段","paint.painter.curve":"曲線","paint.painter.rectangle":"矩形","paint.painter.circle":"圓形","paint.painter.isogon":"正多邊形","paint.painter.polygon":"任意多邊形","paint.painter.select":"選擇","paint.painter.center":"中心","paint.painter.outline":"輪廓","paint.painter.delete":"刪除","paint.painter.flipHorizontal":"水平翻轉","paint.painter.flipVertical":"垂直翻轉","paint.painter.copy":"複製","paint.painter.paste":"粘貼","paint.colorPicker.color":"顏色","paint.colorPicker.saturation":"飽和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"轉換爲位圖","paint.mode.tileMap":"轉換爲 TileMap"};K5({en:j1,"zh-Hans":J1,"zh-Hant":V1});import{keyMirror as t0}from"@blockcode/utils";var E=t0({Image:null,Costume:null,Backdrop:null,Tile:null,TileMap:null});import{nanoid as e0}from"@blockcode/utils";var $1="image/png",i0=`data:${$1};base64,`.length,C1="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",E1=new Map;function _1(e,t){return new Promise((o)=>{let n=new FileReader;n.readAsDataURL(e),n.addEventListener("load",async()=>{let l=await m1(n.result,1,t);o(l)})})}function u1(e){return new Promise((t)=>{let o=E1.get(e.id);if(!o)o=new Image,E1.set(e.id,o);let n=`data:${e.type};base64,`;o.src=`${n}${e.data}`,o.addEventListener("load",()=>{o.dataset.data=o.src.slice(n.length),t(o)})})}function m1(e,t,o){return new Promise((n)=>{let l=e0(),i=new Image;E1.set(l,i),i.id=l,i.src=e,i.addEventListener("load",()=>{if(i.dataset.data)return n(i);let{width:a,height:s}=i;if(!o)o={width:a,height:s};if(!t)t=1;if(i.width>o.width||i.height>o.height){a=o.width,s=o.height;let k=o.width/i.width,B=o.height/i.height;if(k<B)t=k;else t=B}s=i.height*t,a=i.width*t;let g=document.createElement("canvas");g.width=a,g.height=s,g.getContext("2d").drawImage(i,0,0,a,s);let f=g.toDataURL($1);if(f==="data:,")return n(null);i.dataset.data=f.slice(i0),i.src=f})})}import{useCallback as n1,useMemo as o4}from"preact/hooks";import{batch as c1}from"@preact/signals";import{nanoid as F1}from"@blockcode/utils";import{useLocalesContext as c0,useProjectContext as d0,translate as z1,setAlert as i5,delAlert as s0,openAsset as o5,addAsset as A1,delAsset as h0}from"@blockcode/core";import{Text as U,IconSelector as g0,ActionButton as w0}from"@blockcode/core";function _(e){let t=globalThis.document,o=t.createElement("style");o.appendChild(t.createTextNode(e)),t.head.append(o)}_(".bRLzKG_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}.bRLzKG_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}.bRLzKG_selector-item{width:5rem;height:5rem;margin:.5rem auto}.bRLzKG_delete-menu-item:hover{background:var(--error-primary)}.bRLzKG_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.bRLzKG_add-button{margin:.75rem auto}");var e1={selectorItem:"bRLzKG_selector-item",selectorItemsWrapper:"bRLzKG_selector-items-wrapper",selectorWrapper:"bRLzKG_selector-wrapper",addButtonWrapper:"bRLzKG_add-button-wrapper",addButton:"bRLzKG_add-button",deleteMenuItem:"bRLzKG_delete-menu-item"};var X1="./assets/icon-costume-zx9m3hdh.svg";var q1="./assets/icon-backdrop-qvqgzqwj.svg";var H1="./assets/icon-search-6g8kgvdt.svg";var K1="./assets/icon-paint-0h8zs19a.svg";var t5="./assets/icon-surprise-d5t4529a.svg";var e5="./assets/icon-file-upload-0z25chr6.svg";import{jsx as F,jsxs as L0}from"preact/jsx-runtime";var n5={[E.Image]:F(U,{id:"paint.actionButton.image",defaultMessage:"Choose a Image"}),[E.Costume]:F(U,{id:"paint.actionButton.costume",defaultMessage:"Choose a Costume"}),[E.Backdrop]:F(U,{id:"paint.actionButton.backdrop",defaultMessage:"Choose a Backdrop"})},C0={[E.Image]:F(U,{id:"paint.actionButton.upload",defaultMessage:"Upload Image"}),[E.Costume]:F(U,{id:"paint.actionButton.uploadCostume",defaultMessage:"Upload Costume"}),[E.Backdrop]:F(U,{id:"paint.actionButton.uploadBackdrop",defaultMessage:"Upload Backdrop"})},u0=(e,t)=>{switch(e){case E.Image:return z1("paint.painter.image","Image",t).toLowerCase();case E.Costume:return z1("paint.painter.costume","Costume",t).toLowerCase();case E.Backdrop:return z1("paint.painter.backdrop","Backdrop",t).toLowerCase()}},m0=(e)=>`data:${e.type};base64,${e.data}`;function r5({mode:e,maxSize:t,onImagesFilter:o,onShowLibrary:n,onSurprise:l,onChange:i,onDelete:a}){let{translator:s}=c0(),{assets:g,assetId:p,modified:f}=d0(),k=n1(()=>{return o().map((d)=>{if(typeof d==="string")return g.value.find((x)=>x.id===d);return d}).filter((d)=>/^image\//.test(d.type))},[f.value,o]),B=n1(()=>{let d=document.createElement("input");d.type="file",d.accept="image/*",d.multiple=!0,d.click(),d.addEventListener("change",async(x)=>{let D=F1();i5("importing",{id:D});let C=[];for(let y of x.target.files){let A=await _1(y,t);if(!A)i5({message:F(U,{id:"paint.actionButton.uploadError",defaultMessage:'Upload "{file}" failed.',file:y.name})},2000),A={dataset:{data:C1},width:1,height:1};A.name=y.name.slice(0,y.name.lastIndexOf(".")),C.push(A)}s0(D),c1(()=>{for(let y of C)if(A1({id:y.id,type:"image/png",name:y.name,data:y.dataset.data,width:y.width,height:y.height,centerX:Math.floor(y.width/2),centerY:Math.floor(y.height/2)}),i)i(y.id)})})},[i]),O=n1(()=>{let d=F1();c1(()=>{if(A1({id:d,type:"image/png",name:u0(e,s),data:C1,width:1,height:1,centerX:1,centerY:1}),i)i(d)})},[i]),z=n1((d)=>{let x=k(),D=x[d];c1(()=>{let C=p.value;if(D.id===p.value){if(d===0)C=x[1]?.id;else if(d+1<x.length)C=x[d+1].id;else if(d-1>-1)C=x[d-1].id}h0(D.id),o5(C),a(D.id,C)})},[a]),Q=n1((d)=>{let D=k()[d],C=F1();c1(()=>{if(A1({...D,id:C}),i)i(C)})},[i]),h=n1((d,x)=>{c1(()=>{if(o5(x.id),i)i(x.id)})},[i]),u=k();return L0("div",{className:e1.selectorWrapper,children:[F(g0,{displayOrder:!0,id:"doodle-selector",className:e1.selectorItemsWrapper,items:u.map((d,x)=>({...d,details:`${d.width}×${d.height}`,icon:m0(d),order:x,className:e1.selectorItem,contextMenu:[[{label:F(U,{id:"paint.contextMenu.duplicate",defaultMessage:"duplicate"}),onClick:()=>Q(x)},{label:F(U,{id:"paint.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:F(U,{id:"paint.contextMenu.delete",defaultMessage:"delete"}),disabled:u.length<=1,className:e1.deleteMenuItem,onClick:()=>z(x)}]]})),selectedId:p.value,onSelect:h,onDelete:u.length>1&&z}),F("div",{className:e1.addButtonWrapper,children:F(w0,{tooltipPlacement:"right",className:e1.addButton,icon:e===E.Costume?X1:q1,tooltip:n5[e],onClick:n,moreButtons:[{icon:e5,tooltip:C0[e],onClick:B},{icon:t5,tooltip:F(U,{id:"paint.actionButton.surprise",defaultMessage:"Surprise"}),onClick:l},{icon:K1,tooltip:F(U,{id:"paint.actionButton.paint",defaultMessage:"Paint"}),onClick:O},{icon:H1,tooltip:n5[e],onClick:n}]})})]})}import{useCallback as N,useEffect as y3,useMemo as k3}from"preact/hooks";import{batch as d1,useComputed as Q1,useSignal as W}from"@preact/signals";import{classNames as T,Color as j5,MathUtils as Y1}from"@blockcode/utils";import{useLocalesContext as I3,useProjectContext as b3,translate as X,maybeTranslate as N3,setAsset as b1}from"@blockcode/core";import{Text as N1,Label as R1,BufferedInput as B1,Button as $}from"@blockcode/core";import{useCallback as Z,useMemo as v0}from"preact/hooks";import{classNames as i1,Color as f0}from"@blockcode/utils";import{Text as Z1,Tooltip as y0}from"@blockcode/core";_('.x5E0hW_color-picker-wrapper{width:3rem;height:2rem;margin-right:var(--space);cursor:pointer;display:flex}.x5E0hW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}.x5E0hW_color-swatch-outline:after{content:"";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}.x5E0hW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}.x5E0hW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}.x5E0hW_tooltip-item{margin:8px}.x5E0hW_tooltip-item-label{font-weight:700}.x5E0hW_tooltip-item-readout{margin-left:10px}.x5E0hW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}.x5E0hW_tooltip-item-slider-handler{background-color:var(--ui-white);width:26px;height:26px;box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;margin-top:-2px;position:absolute;left:100px}.x5E0hW_tooltip-item-toolbar{justify-content:space-between;display:flex}.x5E0hW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}.x5E0hW_tooltip-item-toolbar-button.x5E0hW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}.x5E0hW_button-icon{width:1.5rem;height:1.5rem}');var v={selected:"x5E0hW_selected",tooltipItemSlider:"x5E0hW_tooltip-item-slider",tooltipItemLabel:"x5E0hW_tooltip-item-label",tooltipItemToolbarButton:"x5E0hW_tooltip-item-toolbar-button",buttonIcon:"x5E0hW_button-icon",tooltipItem:"x5E0hW_tooltip-item",pickerArrow:"x5E0hW_picker-arrow",colorTooltip:"x5E0hW_color-tooltip",colorSwatchOutline:"x5E0hW_color-swatch-outline",tooltipItemSliderHandler:"x5E0hW_tooltip-item-slider-handler",colorPickerWrapper:"x5E0hW_color-picker-wrapper",tooltipItemReadout:"x5E0hW_tooltip-item-readout",tooltipItemToolbar:"x5E0hW_tooltip-item-toolbar",colorSwatch:"x5E0hW_color-swatch"};var l5="./assets/icon-picker-2frmfa34.svg";var G1="./assets/icon-clear-gctr9axd.svg";import{jsx as I,jsxs as r1,Fragment as I0}from"preact/jsx-runtime";var k0=[0,0,324,288,252,216,180,144,108,72,36,0,0],q=124,J=(e,t,o,n)=>new f0({h:e,s:t,v:o},n),T1=(e,t)=>{e.stopPropagation();let o=e.target,n=o.offsetLeft,l=e.clientX,i=(s)=>{s.preventDefault();let g=s.clientX-l+n;if(g>=q)g=q;if(g<=0)g=0;o.style.left=`${g}px`,t(g/q)},a=()=>{document.removeEventListener("pointermove",i),document.removeEventListener("pointerup",a)};document.addEventListener("pointermove",i),document.addEventListener("pointerup",a)},O1=(e,t)=>{let o=e.target.children[0],n=e.offsetX-13;if(n>=q)n=q;if(n<=0)n=0;o.style.left=`${n}px`,t(n/q)};function U1({picking:e,color:t,outline:o,onChange:n,onPickingColor:l}){let i=t.hsv.h,a=t.hsv.s,s=t.hsv.v,g=Z((C)=>n(J(Math.round(C*360),a,s)),[a,s,n]),p=Z((C)=>n(J(i,C,s)),[i,s,n]),f=Z((C)=>n(J(i,a,C)),[i,a,n]),k=Z(()=>n(J(i,a,s,!0)),[i,a,s,n]),B=Z((C)=>T1(C,g),[g]),O=Z((C)=>T1(C,p),[p]),z=Z((C)=>T1(C,f),[f]),Q=Z((C)=>O1(C,g),[g]),h=Z((C)=>O1(C,p),[p]),u=Z((C)=>O1(C,f),[f]),d=v0(()=>k0.map((C)=>J(C,a,s).hex),[a,s]),x=Z((C)=>C.stopPropagation(),[]),D=Z(()=>l(!e),[e,l]);return I(y0,{clickable:!0,placement:"bottom",className:v.colorTooltip,onHide:Z(()=>setTimeout(()=>l(!1),50),[l]),content:r1(I0,{children:[r1("div",{className:v.tooltipItem,children:[I("span",{className:v.tooltipItemLabel,children:I(Z1,{id:"paint.colorPicker.color",defaultMessage:"Color"})}),I("span",{className:v.tooltipItemReadout,children:Math.round(i/360*100)})]}),I("div",{className:i1(v.tooltipItem,v.tooltipItemSlider),style:{background:`linear-gradient(to left, ${d[0]} 0px, ${d[1]} 13px, ${d[2]}, ${d[3]}, ${d[4]}, ${d[5]}, ${d[6]}, ${d[7]}, ${d[8]}, ${d[9]}, ${d[10]}, ${d[11]} 137px, ${d[12]} 100%)`},onClick:Q,children:I("div",{className:v.tooltipItemSliderHandler,style:{left:`${Math.round(i/360*q)}px`},onPointerDown:B,onClick:x})}),r1("div",{className:v.tooltipItem,children:[I("span",{className:v.tooltipItemLabel,children:I(Z1,{id:"paint.colorPicker.saturation",defaultMessage:"Saturation"})}),I("span",{className:v.tooltipItemReadout,children:Math.round(a*100)})]}),I("div",{className:i1(v.tooltipItem,v.tooltipItemSlider),style:{background:`linear-gradient(to right, ${J(i,0,s).hex} 0px, ${J(i,1,s).hex} 100%)`},onClick:h,children:I("div",{className:v.tooltipItemSliderHandler,style:{left:`${Math.round(a*q)}px`},onPointerDown:O,onClick:x})}),r1("div",{className:v.tooltipItem,children:[I("span",{className:v.tooltipItemLabel,children:I(Z1,{id:"paint.colorPicker.brightness",defaultMessage:"Brightness"})}),I("span",{className:v.tooltipItemReadout,children:Math.round(s*100)})]}),I("div",{className:i1(v.tooltipItem,v.tooltipItemSlider),style:{background:`linear-gradient(to right, ${J(i,a,0).hex} 0px, ${J(i,a,1).hex} 100%)`},onClick:u,children:I("div",{className:v.tooltipItemSliderHandler,style:{left:`${Math.round(s*q)}px`},onPointerDown:z,onClick:x})}),r1("div",{className:i1(v.tooltipItem,v.tooltipItemToolbar),children:[I("div",{className:i1(v.tooltipItemToolbarButton,{[v.selected]:t.clear}),onClick:k,children:I("img",{src:G1,className:v.buttonIcon})}),I("div",{className:i1(v.tooltipItemToolbarButton,{[v.selected]:e}),onClick:D,children:I("img",{src:l5,className:v.buttonIcon})})]})]}),children:r1("div",{className:v.colorPickerWrapper,children:[I("div",{className:i1(v.colorSwatch,{[v.colorSwatchOutline]:o}),style:{background:t.clear?"var(--ui-white)":J(i,a,s).hex},children:t.clear&&I("img",{src:G1})}),I("div",{className:v.pickerArrow,children:"▾"})]})})}import{useCallback as B0,useEffect as D0}from"preact/hooks";import{useSignal as E0}from"@preact/signals";import{Dropdown as _0}from"@blockcode/core";var b0=[{family:"Sans Serif"},{family:"Serif"},{family:"Handwriting"},{family:"Marker"},{family:"Curly"},{family:"Pixel"},{label:"中文",family:'"Microsoft YaHei", "微软雅黑", STXihei, "华文细黑"'},{label:"日本語",family:'"ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic"'},{label:"한국어",family:"Malgun Gothic"}],N0=(e,t)=>{let o=e.length>t.length?e:t,n=o==e?t:e,l;for(let i=0;i<n.length;i++)for(let a=0,s=n.length-i;s!=n.length+1;a++,s++)if(l=n.substring(a,s),o.indexOf(l)!=-1)return l;return""};async function a5(){try{let e=await window.queryLocalFonts(),t=new Map,o;for(let n of e){if(/demo/i.test(n.family))continue;if(o=n.fullName,t.has(n.family))o=t.get(n.family),o=N0(o,n.fullName);t.set(n.family,o)}return t.entries().toArray().map(([n,l])=>({label:l,family:n}))}catch(e){return b0}}_(".vaJj7G_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;height:2rem;overflow:auto}.vaJj7G_displayed-font-name{font-size:.8rem}");var S1={fontSelector:"vaJj7G_font-selector",displayedFontName:"vaJj7G_displayed-font-name"};import{jsx as p5}from"preact/jsx-runtime";function c5({font:e,onChange:t}){let o=E0(null),n=B0((l)=>()=>t(l),[t]);return D0(async()=>{let l=await a5();if(o.value=l.map((i)=>({label:i.label??i.family,style:{fontFamily:i.family},onClick:n(i)})),!e)o.value[0]?.onClick()},[e,n]),p5(_0,{className:S1.fontSelector,items:o.value,children:p5("span",{className:S1.displayedFontName,style:{fontFamily:e?.family},children:e?.label??e?.family})})}import{useCallback as Y}from"preact/hooks";import{classNames as S,keyMirror as Y0}from"@blockcode/utils";import{translate as R,Button as P}from"@blockcode/core";_(":root{--paint-tools-box-width:6rem}.a1L2ya_tools-box-wrapper{width:var(--paint-tools-box-width);flex-flow:wrap;place-content:flex-start space-between;display:flex}.a1L2ya_small{width:3rem}.a1L2ya_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.a1L2ya_tool-button.a1L2ya_selected{background:var(--theme-primary)}.a1L2ya_tool-icon{vertical-align:middle;width:2rem;height:2rem}.a1L2ya_tool-button.a1L2ya_selected .a1L2ya_tool-icon{filter:brightness(0)invert()}");var m={selected:"a1L2ya_selected",toolsBoxWrapper:"a1L2ya_tools-box-wrapper",toolButton:"a1L2ya_tool-button",toolIcon:"a1L2ya_tool-icon",small:"a1L2ya_small"};var L1="./assets/icon-pen-vmav54fy.svg";var x1="./assets/icon-eraser-6exvhk0q.svg";var d5="./assets/icon-fill-70s8y3f8.svg";var s5="./assets/icon-text-e5hysycg.svg";var M1="./assets/icon-line-r61p9edw.svg";var v1="./assets/icon-curve-sngqpytw.svg";var h5="./assets/icon-rectangle-yasy0y9k.svg";var g5="./assets/icon-circle-ynejmr8k.svg";var f1="./assets/icon-isogon-dhadjxez.svg";var w5="./assets/icon-polygon-d2x4vbt9.svg";var C5="./assets/icon-select-7g007t5g.svg";import{jsx as b,jsxs as R0}from"preact/jsx-runtime";var r=Y0({Pen:null,Eraser:null,Fill:null,Text:null,Line:null,Curve:null,Rectangle:null,Circle:null,Isogon:null,Polygon:null,Selector:null,Center:null,ColorPicker:null,OutlineColorPicker:null});function u5({small:e,paintTool:t,onSelect:o}){return R0("div",{className:S(m.toolsBoxWrapper,{[m.small]:e}),children:[b(P,{className:S(m.toolButton,{[m.selected]:t===r.Pen}),onClick:Y(()=>o(r.Pen),[]),children:b("img",{src:L1,className:m.toolIcon,title:R("paint.painter.pen","Pen")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Eraser}),onClick:Y(()=>o(r.Eraser),[]),children:b("img",{src:x1,className:m.toolIcon,title:R("paint.painter.eraser","Eraser")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Fill}),onClick:Y(()=>o(r.Fill),[]),children:b("img",{src:d5,className:m.toolIcon,title:R("paint.painter.fill","Fill")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Text}),onClick:Y(()=>o(r.Text),[]),children:b("img",{src:s5,className:m.toolIcon,title:R("paint.painter.text","Text")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Line}),onClick:Y(()=>o(r.Line),[]),children:b("img",{src:M1,className:m.toolIcon,title:R("paint.painter.line","Line")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Curve}),onClick:Y(()=>o(r.Curve),[]),children:b("img",{src:v1,className:m.toolIcon,title:R("paint.painter.curve","Curve")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Rectangle}),onClick:Y(()=>o(r.Rectangle),[]),children:b("img",{src:h5,className:m.toolIcon,title:R("paint.painter.rectangle","Rectangle")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Circle}),onClick:Y(()=>o(r.Circle),[]),children:b("img",{src:g5,className:m.toolIcon,title:R("paint.painter.circle","Circle")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Isogon}),onClick:Y(()=>o(r.Isogon),[]),children:b("img",{src:f1,className:m.toolIcon,title:R("paint.painter.isogon","Isogon")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Polygon}),onClick:Y(()=>o(r.Polygon),[]),children:b("img",{src:w5,className:m.toolIcon,title:R("paint.painter.polygon","Polygon")})}),b(P,{className:S(m.toolButton,{[m.selected]:t===r.Selector}),onClick:Y(()=>o(r.Selector),[]),children:b("img",{src:C5,className:m.toolIcon,title:R("paint.painter.select","Select")})})]})}import{useEffect as I1,useRef as c3,useCallback as l1}from"preact/hooks";import{useSignal as d3}from"@preact/signals";import{classNames as A5,Konva as j}from"@blockcode/utils";import{useProjectContext as s3,Keys as V}from"@blockcode/core";var P0=(e)=>{let t;for(let o=0;o<e.height;o++){t=o*e.width;for(let n=0;n<e.width;n++){if(e.data[(t<<2)+3]!==0)return o;t++}}return 0},j0=(e,t)=>{let o;for(let n=e.height-1;n>=t;n--){o=n*e.width;for(let l=0;l<e.width;l++){if(e.data[(o<<2)+3]!==0)return n;o++}}return 0},J0=(e,t,o)=>{let n;for(let l=0;l<e.width;l++)for(let i=t;i<=o;i++)if(n=i*e.width+l,e.data[(n<<2)+3]!==0)return l;return 0},V0=(e,t,o,n)=>{let l;for(let i=e.width-1;i>=n;i--)for(let a=t;a<=o;a++)if(l=a*e.width+i,e.data[(l<<2)+3]!==0)return i;return 0};function m5(e){let t=P0(e),o=j0(e,t),n=J0(e,t,o),l=V0(e,t,o,n);return{top:t,left:n,right:l,bottom:o,x:n,y:t,width:l-n+1,height:o-t+1}}var L5="image/png",$0=`data:${L5};base64,`.length;async function x5(e,t){let l=(await e.toCanvas({pixelRatio:1})).getContext("2d").getImageData(0,0,e.width(),e.height()),i=m5(l),s=e.toDataURL({...i,mimeType:L5}).slice($0),g=t.x-i.x,p=t.y-i.y,f=i.width,k=i.height;return{data:s,centerX:g,centerY:p,width:f,height:k}}_(".vAiLFq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:relative;overflow:hidden}.vAiLFq_draw-container{image-rendering:pixelated;scrollbar-gutter:stable;scrollbar-width:8px;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);margin:0;padding:0;position:absolute;inset:0;overflow:scroll}.vAiLFq_draw-container.vAiLFq_text{cursor:text}.vAiLFq_draw-container.vAiLFq_center{cursor:crosshair}.vAiLFq_draw-container.vAiLFq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}.vAiLFq_center-icon{pointer-events:none;filter:opacity(.7);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.vAiLFq_center-icon.vAiLFq_hidden{display:none}");var K={text:"vAiLFq_text",drawBox:"vAiLFq_draw-box",drawContainer:"vAiLFq_draw-container",centerIcon:"vAiLFq_center-icon",hidden:"vAiLFq_hidden",picker:"vAiLFq_picker",center:"vAiLFq_center"};import{Konva as X0}from"@blockcode/utils";var y1={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new X0.Line({stroke:this.color.hex,strokeWidth:this.size,globalCompositeOperation:this.isEraser?"destination-out":"source-over",lineCap:"round",lineJoin:"round",points:[t.x,t.y,t.x,t.y]}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points().concat([t.x,t.y]);this.poly.points(o)},onEnd(e){this.poly.addName("done"),this.poly=null}};var M5={...y1,isEraser:!0};import{Color as v5,sleepMs as q0,Konva as H0}from"@blockcode/utils";var f5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.pixels=[],this.color=t.color},getIndex(e,t){let o=this.layer.width();return t*o+e<<2},getPos(e){let t=this.layer.width(),o=e>>2,n=Math.floor(o/t);return{x:o-n*t,y:n}},checkPixel(e,t,o){if(e<0||t<0||e>=this.imageData.width||t>=this.imageData.height)return;let n=this.getIndex(e,t);if(this.pixels.includes(n))return;let l=this.imageData.data.slice(n,n+4),i=new v5(Array.from(l));if(i.equals(o)&&i.notEquals(this.color))this.pixels.push(n)},async fill(e){let t=Math.floor(e.x),o=Math.floor(e.y),n=this.color.rgb,l=this.color.clear?0:255,i=this.layer.width(),a=this.layer.height(),g=(await this.layer.toCanvas({pixelRatio:1})).getContext("2d");this.imageData=g.getImageData(0,0,i,a);let p=this.getIndex(t,o),f=this.imageData.data.slice(p,p+4),k=new v5(Array.from(f));this.checkPixel(t,o,k);let B=g.createImageData(i,a);while(this.pixels.length>0)p=this.pixels.shift(),B.data[p+0]=n.r,B.data[p+1]=n.g,B.data[p+2]=n.b,B.data[p+3]=l,this.imageData.data[p+0]=n.r,this.imageData.data[p+1]=n.g,this.imageData.data[p+2]=n.b,this.imageData.data[p+3]=l,e=this.getPos(p),this.checkPixel(e.x-1,e.y,k),this.checkPixel(e.x+1,e.y,k),this.checkPixel(e.x,e.y-1,k),this.checkPixel(e.x,e.y+1,k);return this.imageData=null,g.putImageData(B,0,0),g.canvas.toDataURL()},async onBegin(e){if(this.color.clear)return;this.filling=!0;let t=this.stage.getPointerPosition(),o=await this.fill(t);this.image=new H0.Image({x:0,y:0}),this.layer.add(this.image),m1(o).then((n)=>{this.image.image(n),this.filling=!1})},async onEnd(e){this.pixels.length=0;while(!0){if(!this.filling)break;await q0(50)}this.image.addName("done"),this.image=null}};import{Konva as K0}from"@blockcode/utils";var t3=30,y5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.fontFamily=t.fontFamily,this.color=t.color},cancel(){this.cancelEditbox?.(),this.poly=null},enableEditbox(){this.poly.hide();let e=this.poly.absolutePosition(),t=this.stage.container().getBoundingClientRect(),o={x:t.x+e.x,y:t.y+e.y},n=document.createElement("div");document.body.appendChild(n),n.innerText=this.poly.text(),n.contentEditable="plaintext-only",n.style.position="absolute",n.style.top=o.y+"px",n.style.left=o.x+"px",n.style.minWidth=this.poly.fontSize()+"px",n.style.fontSize=this.poly.fontSize()+"px",n.style.border="none",n.style.padding="0px",n.style.margin="0px",n.style.background="none",n.style.outline="none",n.style.resize="auto",n.style.lineHeight=this.poly.lineHeight(),n.style.fontFamily=this.poly.fontFamily(),n.style.transformOrigin="left top",n.style.textAlign=this.poly.align(),n.style.color=this.poly.fill(),n.focus(),n.addEventListener("blur",()=>n.focus()),this.cancelEditbox=()=>{this.poly.text(n.innerText.trimEnd()),n.parentNode.removeChild(n),this.poly.show()}},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new K0.Text({x:t.x,y:t.y,text:"",fontSize:t3,fontFamily:this.fontFamily,fill:this.color.hex}),this.layer.add(this.poly),this.enableEditbox(this.stage,this.poly)},onDone(e){if(!this.poly)return;if(this.cancelEditbox?.(),this.poly.text().length===0)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null,this.cancelEditbox=null}};import{Konva as e3}from"@blockcode/utils";var k5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new e3.Line({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[t.x,t.y]}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points();o[2]=t.x,o[3]=t.y,this.poly.points(o)},onEnd(e){this.poly.addName("done"),this.poly=null}};import{Konva as i3}from"@blockcode/utils";var I5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},cancel(){if(!this.poly)return;let e=this.poly.getAttr("points");e.pop(),e.pop(),this.poly.setAttr("points",e),this.poly=null},draw(e,t){let o=t.getAttr("points"),n=t.x(),l=t.y();if(e.beginPath(),e.moveTo(o[0]-n,o[1]-l),o.length<6)e.lineTo(o[2]-n,o[3]-l);else{let s=2;for(;s<o.length-4;s+=2){var i=(o[s]-n+(o[s+2]-n))/2,a=(o[s+1]-l+(o[s+3]-l))/2;e.quadraticCurveTo(o[s]-n,o[s+1]-l,i,a)}e.quadraticCurveTo(o[s]-n,o[s+1]-l,o[s+2]-n,o[s+3]-l)}e.fillStrokeShape(t)},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new i3.Shape({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[t.x,t.y],sceneFunc:this.draw}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.getAttr("points"),n=o.length;o[n-2]=t.x,o[n-1]=t.y,this.poly.setAttr("points",o)},onEnd(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.getAttr("points");o.push(t.x),o.push(t.y),this.poly.setAttr("points",o)},onDone(e){this.poly.addName("done"),this.poly=null}};import{Konva as o3}from"@blockcode/utils";var b5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new o3.Rect({x:t.x,y:t.y,width:1,height:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n;this.poly.setAttrs({width:Math.abs(l),height:Math.abs(i),scale:{x:l<0?-1:1,y:i<0?-1:1}})},onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as n3}from"@blockcode/utils";var N5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new n3.Ellipse({x:t.x,y:t.y,radius:{x:1,y:1},fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n,a=e.evt.shiftKey||e.evt.ctrlKey||e.evt.metaKey,s=Math.sqrt(l*l+i*i);this.poly.setAttrs({radius:{x:a?s:Math.abs(l),y:a?s:Math.abs(i)},scale:{x:l<0?-1:1,y:i<0?-1:1}})},onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as r3}from"@blockcode/utils";var B5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.sides=t.sides,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new r3.RegularPolygon({x:t.x,y:t.y,sides:this.sides,radius:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n,a=Math.sqrt(l*l+i*i);this.poly.setAttrs({radius:a,scale:{x:l<0?-1:1,y:i<0?-1:1}})},onEnd(e){if(!this.poly)return;if(this.poly.radius()<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as l3}from"@blockcode/utils";var D5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},cancel(){if(!this.poly)return;let e=this.poly.getAttr("points");e.pop(),e.pop(),this.poly.setAttr("points",e),this.poly=null},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new l3.Line({points:[t.x,t.y],lineCap:"round",lineJoin:"round",closed:!0,fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points(),n=o.length;o[n-2]=t.x,o[n-1]=t.y,this.poly.points(o)},onEnd(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.points();o.push(t.x),o.push(t.y),this.poly.points(o)},onDone(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as E5}from"@blockcode/utils";import{themeColors as a3}from"@blockcode/core";var _5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.selectorLayer=this.stage.getLayers().at(-1)},cancel(){this.clipImage?.remove?.(),this.clipImage=null},async clip(){this.poly.setAttr("stroke","transparent"),this.poly.moveTo(this.layer);let e=this.poly.getClientRect(),t=await this.layer.toImage(e);this.clipImage=new E5.Image({image:t,x:e.x,y:e.y,name:"selector",draggable:!0}),this.layer.add(this.clipImage),this.poly.setAttrs({fill:"black",globalCompositeOperation:"destination-out"})},onBegin(e){let t=this.stage.getPointerPosition();this.poly=new E5.Rect({x:t.x,y:t.y,width:1,height:1,dash:[5,5],fill:"transparent",stroke:a3.ui.theme.highlight,strokeWidth:1}),this.selectorLayer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),o=this.poly.x(),n=this.poly.y(),l=t.x-o,i=t.y-n;this.poly.setAttrs({width:Math.abs(l),height:Math.abs(i),scale:{x:l<0?-1:1,y:i<0?-1:1}})},async onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else await this.clip();this.poly=null}};var F5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.changeCenter=t.onCenterChange},onBegin(e){let t=this.stage.getPointerPosition();this.changeCenter(t)}};import{Color as z5}from"@blockcode/utils";var W1={setup(e,t){this.stage=e.getStage(),this.layer=e,this.ctx=e.getContext(),this.pickColor=t.onPickColor},getIndex(e){let t=this.layer.width(),o=Math.floor(e.x);return Math.floor(e.y)*t+o<<2},onBegin(e){let t=this.layer.width(),o=this.layer.height();this.imageData=this.ctx.getImageData(0,0,t,o);let n=this.stage.getPointerPosition(),l=this.getIndex(n),i=this.imageData.data.slice(l,l+4),a=new z5(Array.from(i));this.pickColor(a)},onDrawing(e){let t=this.stage.getPointerPosition(),o=this.getIndex(t),n=this.imageData.data.slice(o,o+4),l=new z5(Array.from(n));this.pickColor(l)},onEnd(e){this.imageData=null}};var k1="./assets/icon-center-bzxv0qgf.svg";import{jsx as G5,jsxs as g3}from"preact/jsx-runtime";var h3={[r.Pen]:y1,[r.Eraser]:M5,[r.Fill]:f5,[r.Text]:y5,[r.Line]:k5,[r.Curve]:I5,[r.Rectangle]:b5,[r.Circle]:N5,[r.Isogon]:B5,[r.Polygon]:D5,[r.Selector]:_5,[r.Center]:F5,[r.ColorPicker]:W1,[r.OutlineColorPicker]:W1};function Z5({zoom:e,maxSize:t,toolOptions:o,onSizeChange:n,onChange:l}){let i=c3(null),{asset:a,assetId:s,modified:g}=s3(),p=d3(null),f=l1(async()=>{if(p.value?.type===r.Center)return;if(i.drawLayer.children.length<=1)return;let h=i.image.position();h.x+=a.value.centerX,h.y+=a.value.centerY;let u=await x5(i.drawLayer,h);l(u)},[l]),k=l1((h)=>{let u=i.image.position(),d=h.x-u.x,x=h.y-u.y;l({centerX:d,centerY:x})},[l]),B=l1(()=>{let h=i.stage.find(".selector");if(h.length>0)return i.transformer.nodes(h),!0},[]),O=l1(()=>{let h=i.transformer.nodes();if(h.length>0)return i.transformer.nodes([]),h.forEach((u)=>{u.removeName("selector"),u.addName("done")}),!0},[]),z=l1(()=>{i.transformer.nodes([]);for(let h of i.drawLayer.children)if(h!==i.image)h.remove()},[]),Q=l1((h)=>{if(h.target.tagName==="INPUT")return;switch(h.code){case V.ESC:case V.DELETE:case V.BACKSPACE:if(h.code!==V.ESC&&p.value?.type===r.Text)return;h.preventDefault(),i.painting=!1,z(),p.value?.cancel?.();return;case V.RETURN:case V.ENTER:if(p.value?.type===r.Text)return;h.preventDefault(),O(),f();return;case V.LEFT:h.preventDefault(),i.transformer.nodes().forEach((u)=>u.x(u.x()-1));return;case V.RIGHT:h.preventDefault(),i.transformer.nodes().forEach((u)=>u.x(u.x()+1));return;case V.UP:h.preventDefault(),i.transformer.nodes().forEach((u)=>u.y(u.y()-1));return;case V.DOWN:h.preventDefault(),i.transformer.nodes().forEach((u)=>u.y(u.y()+1));return}},[z]);return I1(async()=>{if(!/image\//.test(a.value?.type)||!i.image)return;let h=await u1(a.value);i.image.image(h),i.image.position({x:i.stage.width()/2-a.value.centerX,y:i.stage.height()/2-a.value.centerY}),z()},[s.value,g.value,z]),I1(()=>{if(i.stage){let{clientWidth:h,clientHeight:u,scrollLeft:d,scrollTop:x,scrollWidth:D,scrollHeight:C}=i.current,y={top:u/2,left:h/2},A={top:(x+y.top)/C*(u*e)-y.top,left:(d+y.left)/D*(h*e)-y.left,behavior:"instant"};i.stage.content.style.zoom=e,i.current.scrollTo(A)}},[e]),I1(async()=>{if(i.drawLayer){if(p.value?.type!==o.type){if(O(),i.painting)i.painting=!1,await f();if(p.value=h3[o.type],p.value)p.value.type=o.type}if(o.type===r.Center)o.onCenterChange=k;p.value?.setup?.(i.drawLayer,o)}},[o,O,k,f]),I1(()=>{if(i.current){let{clientWidth:h,clientHeight:u}=i.current,d=Math.max(t.width,h),x=Math.max(t.height,u);i.stage=new j.Stage({container:i.current,width:d,height:d}),n({width:h,height:u});let D=new j.Layer({listening:!1}),C=new j.Layer;i.drawLayer=new j.Layer,i.stage.add(i.drawLayer,D,C);let y=(d-t.width)/2,A=(x-t.height)/2,s1=new j.Rect({x:0,y:0,width:d,height:A,fill:"black",opacity:0.2}),a1=new j.Rect({x:0,y:x-A,width:h,height:A,fill:"black",opacity:0.2}),h1=new j.Rect({x:0,y:A,width:y,height:t.height,fill:"black",opacity:0.2}),g1=new j.Rect({x:d-y,y:A,width:y,height:t.height,fill:"black",opacity:0.2});if(D.add(s1,a1,h1,g1),i.transformer=new j.Transformer({anchorStyleFunc(M){if(M.cornerRadius(5),M.hasName("top-center")||M.hasName("bottom-center"))M.height(6),M.offsetY(3),M.width(12),M.offsetX(6);if(M.hasName("middle-left")||M.hasName("middle-right"))M.height(12),M.offsetY(6),M.width(6),M.offsetX(3)}}),C.add(i.transformer),i.image=new j.Image,i.drawLayer.add(i.image),a.value)u1(a.value).then((M)=>{i.image.image(M),i.image.position({x:i.stage.width()/2-a.value.centerX,y:i.stage.height()/2-a.value.centerY})});i.painting=!1,i.stage.on("pointerdown",async(M)=>{if(i.painting||M.target.name()==="selector"||M.target.parent instanceof j.Transformer)return;if([r.ColorPicker,r.OutlineColorPicker].includes(p.value?.type))M.evt.stopPropagation();if(O()){if(await f(),p.value?.cancel?.(),[r.Text,r.Polygon,r.Selector].includes(p.value?.type))return}if(!p.value)return;p.value.onBegin?.(M),i.painting=!0}),i.stage.on("pointermove",(M)=>{if(i.painting)M.evt.preventDefault(),p.value.onDrawing?.(M)}),i.stage.on("pointerup",async(M)=>{if(i.painting){if(i.painting=!!p.value.onDone,await p.value.onEnd?.(M),[r.Curve,r.Text,r.Polygon].includes(p.value.type))return;if([r.Rectangle,r.Circle,r.Isogon,r.Selector].includes(p.value.type))B();else f()}}),i.stage.on("pointerdblclick",async(M)=>{if(i.painting&&[r.Polygon,r.Text,r.Curve].includes(p.value.type))if(i.painting=!1,await p.value.onDone?.(M),[r.Polygon,r.Text].includes(p.value.type))B();else f()}),document.addEventListener("keydown",Q),i.resizeObserver=new ResizeObserver(()=>{if(!i.stage)return;let{clientWidth:M,clientHeight:w1}=i.current,H=Math.max(t.width,M),o1=Math.max(t.height,w1);if(i.stage.size({width:H,height:o1}),n({width:M,height:w1}),a.value)i.image.position({x:H/2-a.value.centerX,y:o1/2-a.value.centerY});let p1=(H-t.width)/2,t1=(o1-t.height)/2;s1.size({width:H,height:t1}),a1.setAttrs({y:o1-t1,width:H,height:t1}),h1.setAttrs({y:t1,width:p1}),g1.setAttrs({x:H-p1,y:t1,width:p1})}),i.resizeObserver.observe(i.current)}return()=>{document.removeEventListener("keydown",Q),p.value?.cancel?.(),i.resizeObserver.unobserve(i.current),i.stage.destroy(),i.stage=null}},[i]),g3("div",{className:K.drawBox,children:[G5("div",{ref:i,className:A5(K.drawContainer,{[K.text]:p.value?.type===r.Text,[K.center]:p.value?.type===r.Center,[K.picker]:p.value?.type===r.ColorPicker||p.value?.type===r.OutlineColorPicker})}),G5("img",{src:k1,className:A5(K.centerIcon,{[K.hidden]:p.value?.type!==r.Center})})]})}_("._03BnxG_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._03BnxG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._03BnxG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._03BnxG_row-bottom{margin-right:var(--space);margin-left:calc(var(--paint-tools-box-width) + var(--space));justify-content:space-between}._03BnxG_row-bottom>div{display:inline-flex}._03BnxG_row:last-child{min-height:unset;margin-bottom:0}._03BnxG_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._03BnxG_disabled{opacity:.3;pointer-events:none}._03BnxG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._03BnxG_name-input{width:8rem}._03BnxG_large-input{width:4rem}._03BnxG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._03BnxG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._03BnxG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._03BnxG_tile-map-button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);height:calc(2rem + 2px);padding:.375rem}._03BnxG_button-left-icon{margin-right:calc(var(--space))}._03BnxG_button-icon{width:1.5rem;margin:auto}._03BnxG_group-button{border-left:none;border-radius:0}._03BnxG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._03BnxG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._03BnxG_group-button-toggled-off{filter:saturate(0)}._03BnxG_label-button{border:0;font-weight:400}._03BnxG_label-button._03BnxG_selected{background:var(--theme-primary);color:var(--ui-white)}._03BnxG_label-button._03BnxG_selected ._03BnxG_button-icon{filter:brightness(0)invert()}._03BnxG_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}._03BnxG_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;min-height:2rem;max-height:30vh;overflow:auto}._03BnxG_displayed-font-name{font-size:.8rem}");var c={labelImage:"_03BnxG_label-image",rowFill:"_03BnxG_row-fill",groupButtonFirst:"_03BnxG_group-button-first",groupButtonLast:"_03BnxG_group-button-last",groupButtonToggledOff:"_03BnxG_group-button-toggled-off",painterWrapper:"_03BnxG_painter-wrapper",buttonLeftIcon:"_03BnxG_button-left-icon",fontSelector:"_03BnxG_font-selector",row:"_03BnxG_row",nameInput:"_03BnxG_name-input",rowBottom:"_03BnxG_row-bottom",displayedFontName:"_03BnxG_displayed-font-name",button:"_03BnxG_button",buttonIcon:"_03BnxG_button-icon",disabled:"_03BnxG_disabled",selected:"_03BnxG_selected",groupButton:"_03BnxG_group-button",toolGroup:"_03BnxG_tool-group",largeInput:"_03BnxG_large-input",toolIcon:"_03BnxG_tool-icon",labelButton:"_03BnxG_label-button",tileMapButton:"_03BnxG_tile-map-button",dashedBorder:"_03BnxG_dashed-border",drawBoxWrapper:"_03BnxG_draw-box-wrapper"};var T5="./assets/icon-undo-q4nwvpxj.svg";var O5="./assets/icon-redo-mrvqwv38.svg";var U5="./assets/icon-zoom-in-s316e3qy.svg";var S5="./assets/icon-zoom-out-y9xmwx8c.svg";var W5="./assets/icon-zoom-reset-xne8n5sw.svg";var Q5="./assets/icon-tilemap-m9n9bthp.svg";var Y5="./assets/icon-delete-97b0qwkk.svg";var R5="./assets/icon-flip-horizontal-kg60c0nb.svg";var P5="./assets/icon-flip-vertical-09q4h4q8.svg";import{jsx as w,jsxs as G,Fragment as D3}from"preact/jsx-runtime";var B3=30,D1=0.5,J5=20,V5=(e,t)=>{switch(e){case E.Image:return X("paint.painter.image","Image",t).toLowerCase();case E.Costume:return X("paint.painter.costume","Costume",t).toLowerCase();case E.Backdrop:return X("paint.painter.backdrop","Backdrop",t).toLowerCase()}};function P1({mode:e,maxSize:t}){let{translator:o}=I3(),{asset:n,assetId:l,modified:i}=b3(),a=W(1),s=W(!1),g=W(null),p=W(r.Pen),f=W(10),k=W(2),B=W(6),O=W(null),z=W(new j5([260,0.6,1])),Q=W(new j5([0,1,0])),h=W([]),u=W([]),d=k3(()=>n.value?.name,[l.value,i.value]),x=!/image\//.test(n.value?.type);y3(()=>{d1(()=>{if(g.value=null,h.value=null,u.value=null,h.value=[],u.value=[],n.value)h.value.push(Object.assign({},n.value))})},[l.value]);let D=Q1(()=>p.value!==r.Rectangle&&p.value!==r.Circle&&p.value!==r.Isogon&&p.value!==r.Polygon),C=Q1(()=>p.value===r.Pen||p.value===r.Eraser||p.value===r.Line||p.value===r.Curve),y=Q1(()=>{if(p.value===r.Eraser)return x1;if(p.value===r.Line)return M1;if(p.value===r.Curve)return v1;return L1}),A=N((L)=>b1({name:L}),[]),s1=N((L)=>{if(g.value===r.ColorPicker)z.value=L;else if(g.value===r.OutlineColorPicker)Q.value=L},[]),a1=N((L)=>(H5)=>{if(H5)g.value=L;else g.value=null},[]),h1=N((L)=>k.value=Y1.clamp(L,0,100),[]),g1=N((L)=>f.value=Y1.clamp(L,1,100),[]),M=N((L)=>B.value=Y1.clamp(L,3,20),[]),w1=N((L)=>O.value=L,[]),H=N((L)=>{s.value=s.value?L.width<390:L.width<340},[]),o1=N((L)=>{d1(()=>{if(h.value.length>B3)h.value.shift();if(L)u.value.length=0,h.value.push(L),b1(L)})},[]),p1=N(()=>{d1(()=>{g.value=null;let L=h.value.pop();u.value.push(L),L=h.value[h.value.length-1],b1(L)})},[]),t1=N(()=>{d1(()=>{g.value=null;let L=u.value.pop();h.value.push(L),b1(L)})},[]);return G("div",{className:c.painterWrapper,children:[G("div",{className:c.row,children:[w("div",{className:c.toolGroup,children:w(R1,{text:V5(e,o),children:w(B1,{disabled:x,className:c.nameInput,placeholder:X("paint.painter.name","name"),onSubmit:A,value:d?N3(d):V5(e,o)})})}),G("div",{className:c.toolGroup,children:[w($,{disabled:h.value.length<=1,className:T(c.button,c.groupButtonFirst,{[c.groupButtonToggledOff]:x}),onClick:p1,children:w("img",{src:T5,className:c.buttonIcon,title:X("paint.painter.undo","Undo")})}),w($,{disabled:u.value.length===0,className:T(c.button,c.groupButtonLast,{[c.groupButtonToggledOff]:x}),onClick:t1,children:w("img",{src:O5,className:c.buttonIcon,title:X("paint.painter.redo","Redo")})})]}),w("div",{className:c.toolGroup,children:G($,{vertical:!0,disabled:e!==E.Costume,className:T(c.labelButton,{[c.selected]:g.value===r.Center}),onClick:N(()=>g.value=g.value!==r.Center?r.Center:null,[]),children:[w("img",{src:k1,className:c.buttonIcon,title:X("paint.painter.center","Center")}),w(N1,{id:"paint.painter.center",defaultMessage:"Center"})]})})]}),G("div",{className:c.row,children:[w("div",{className:c.toolGroup,children:w(R1,{className:T({[c.disabled]:p.value===r.Eraser||p.value===r.Selector}),text:w(N1,{id:"paint.painter.fill",defaultMessage:"Fill"}),children:w(U1,{picking:g.value===r.ColorPicker,color:z.value,onChange:N((L)=>z.value=L,[]),onPickingColor:a1(r.ColorPicker)})})}),G("div",{className:T(c.toolGroup,c.dashedBorder),children:[w(R1,{className:T({[c.disabled]:D.value}),text:w(N1,{id:"paint.painter.outline",defaultMessage:"Outline"}),children:w(U1,{outline:!0,picking:g.value===r.OutlineColorPicker,color:Q.value,onChange:N((L)=>Q.value=L,[]),onPickingColor:a1(r.OutlineColorPicker)})}),w(B1,{small:!0,type:"number",className:T(c.largeInput,{[c.disabled]:D.value}),value:k.value,onSubmit:h1})]}),C.value&&G("div",{className:c.toolGroup,children:[w("img",{src:y,className:c.toolIcon}),w(B1,{small:!0,type:"number",className:c.largeInput,value:f.value,onSubmit:g1})]}),p.value===r.Isogon&&G("div",{className:c.toolGroup,children:[w("img",{src:f1,className:c.toolIcon}),w(B1,{small:!0,type:"number",className:c.largeInput,value:B.value,onSubmit:M})]}),p.value===r.Text&&w(c5,{font:O.value,onChange:w1}),p.value===r.Selector&&G(D3,{children:[w("div",{className:T(c.toolGroup,c.dashedBorder),children:w($,{disabled:!0,className:c.labelButton,onClick:N(()=>{},[]),children:w("img",{src:Y5,className:c.buttonIcon,title:X("paint.painter.delete","Delete")})})}),G("div",{className:c.toolGroup,children:[w($,{disabled:!0,className:c.labelButton,onClick:N(()=>{},[]),children:w("img",{src:R5,className:c.buttonIcon,title:X("paint.painter.flipHorizontal","Flip Horizontal")})}),w($,{disabled:!0,className:c.labelButton,onClick:N(()=>{},[]),children:w("img",{src:P5,className:c.buttonIcon,title:X("paint.painter.flipVertical","Flip Vertical")})})]})]})]}),G("div",{className:T(c.row,c.rowFill),children:[w(u5,{small:s.value,paintTool:p.value,onSelect:N((L)=>d1(()=>{p.value=L,g.value=null}),[])}),w("div",{className:c.drawBoxWrapper,children:w(Z5,{zoom:a.value,maxSize:t,toolOptions:{type:g.value||p.value,size:f.value,sides:B.value,color:z.value,fontFamily:O.value?.family,outlineWidth:k.value,outlineColor:Q.value,onPickColor:s1},onSizeChange:H,onChange:o1})})]}),G("div",{className:T(c.row,c.rowBottom),children:[w("div",{children:e===E.Backdrop&&G($,{disabled:!0,className:c.tileMapButton,children:[w("img",{className:c.buttonLeftIcon,src:Q5}),w(N1,{id:"paint.mode.tileMap",defaultMessage:"Convert to TileMap"})]})}),G("div",{children:[w($,{disabled:a.value===1,className:T(c.button,c.groupButtonFirst),onClick:N(()=>a.value-D1>=1&&(a.value=a.value-D1),[]),children:w("img",{src:S5,className:c.buttonIcon})}),w($,{disabled:a.value===1,className:T(c.button,c.groupButton),onClick:N(()=>a.value=1,[]),children:w("img",{src:W5,className:c.buttonIcon})}),w($,{disabled:a.value===J5,className:T(c.button,c.groupButtonLast),onClick:N(()=>a.value+D1<J5&&(a.value=a.value+D1),[]),children:w("img",{src:U5,className:c.buttonIcon})})]})]})]})}_(".TDnbAa_pixel-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var $5={pixelEditorWrapper:"TDnbAa_pixel-editor-wrapper"};import{jsx as X5,jsxs as _3}from"preact/jsx-runtime";function E3({mode:e,maxSize:t,onImagesFilter:o,onShowLibrary:n,onSurprise:l,onChange:i,onDelete:a}){return _3("div",{className:$5.pixelEditorWrapper,children:[X5(r5,{mode:e,maxSize:t,onImagesFilter:o,onShowLibrary:n,onSurprise:l,onChange:i,onDelete:a}),X5(P1,{mode:e,maxSize:t})]})}import{Text as z3}from"@blockcode/core";var q5="./assets/icon-paint-fcmp1zp4.svg";import{jsx as G3}from"preact/jsx-runtime";var A3={icon:q5,label:G3(z3,{id:"paint.painter.image",defaultMessage:"Image"})};export{A3 as paintTab,m1 as loadImageFromURL,_1 as loadImageFromFile,u1 as loadImageFromAsset,E3 as PaintEditor,E as EditorModes,C1 as BlankImageData};
