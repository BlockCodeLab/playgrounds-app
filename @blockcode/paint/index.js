var uh=Object.create;var{getPrototypeOf:gh,defineProperty:bn,getOwnPropertyNames:fh}=Object;var ph=Object.prototype.hasOwnProperty;var Pt=(t,e,i)=>{i=t!=null?uh(gh(t)):{};let r=e||!t||!t.__esModule?bn(i,"default",{value:t,enumerable:!0}):i;for(let n of fh(t))if(!ph.call(r,n))bn(r,n,{get:()=>t[n],enumerable:!0});return r};var N=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var I=N((Kn)=>{Object.defineProperty(Kn,"__esModule",{value:!0});Kn._registerNode=Kn.Konva=Kn.glob=void 0;var o5=Math.PI/180;function a5(){return typeof window!=="undefined"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}Kn.glob=typeof global!=="undefined"?global:typeof window!=="undefined"?window:typeof WorkerGlobalScope!=="undefined"?self:{};Kn.Konva={_global:Kn.glob,version:"9.3.18",isBrowser:a5(),isUnminified:/param/.test(function(t){}.toString()),dblClickWindow:400,getAngle(t){return Kn.Konva.angleDeg?t*o5:t},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window!=="undefined"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return Kn.Konva.DD.isDragging},isTransforming(){var t;return(t=Kn.Konva.Transformer)===null||t===void 0?void 0:t.isTransforming()},isDragReady(){return!!Kn.Konva.DD.node},releaseCanvasOnDestroy:!0,document:Kn.glob.document,_injectGlobal(t){Kn.glob.Konva=t}};var h5=(t)=>{Kn.Konva[t.prototype.getClassName()]=t};Kn._registerNode=h5;Kn.Konva._injectGlobal(Kn.Konva)});var J=N((Jn)=>{Object.defineProperty(Jn,"__esModule",{value:!0});Jn.Util=Jn.Transform=void 0;var yr=I();class xr{constructor(t=[1,0,0,1,0,0]){this.dirty=!1,this.m=t&&t.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new xr(this.m)}copyInto(t){t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5]}point(t){let e=this.m;return{x:e[0]*t.x+e[2]*t.y+e[4],y:e[1]*t.x+e[3]*t.y+e[5]}}translate(t,e){return this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e,this}scale(t,e){return this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e,this}rotate(t){let e=Math.cos(t),i=Math.sin(t),r=this.m[0]*e+this.m[2]*i,n=this.m[1]*e+this.m[3]*i,s=this.m[0]*-i+this.m[2]*e,o=this.m[1]*-i+this.m[3]*e;return this.m[0]=r,this.m[1]=n,this.m[2]=s,this.m[3]=o,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(t,e){let i=this.m[0]+this.m[2]*e,r=this.m[1]+this.m[3]*e,n=this.m[2]+this.m[0]*t,s=this.m[3]+this.m[1]*t;return this.m[0]=i,this.m[1]=r,this.m[2]=n,this.m[3]=s,this}multiply(t){let e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],r=this.m[0]*t.m[2]+this.m[2]*t.m[3],n=this.m[1]*t.m[2]+this.m[3]*t.m[3],s=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],o=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];return this.m[0]=e,this.m[1]=i,this.m[2]=r,this.m[3]=n,this.m[4]=s,this.m[5]=o,this}invert(){let t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,r=-this.m[2]*t,n=this.m[0]*t,s=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),o=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=e,this.m[1]=i,this.m[2]=r,this.m[3]=n,this.m[4]=s,this.m[5]=o,this}getMatrix(){return this.m}decompose(){let t=this.m[0],e=this.m[1],i=this.m[2],r=this.m[3],n=this.m[4],s=this.m[5],o=t*r-e*i,a={x:n,y:s,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!=0||e!=0){let h=Math.sqrt(t*t+e*e);a.rotation=e>0?Math.acos(t/h):-Math.acos(t/h),a.scaleX=h,a.scaleY=o/h,a.skewX=(t*i+e*r)/o,a.skewY=0}else if(i!=0||r!=0){let h=Math.sqrt(i*i+r*r);a.rotation=Math.PI/2-(r>0?Math.acos(-i/h):-Math.acos(i/h)),a.scaleX=o/h,a.scaleY=h,a.skewX=0,a.skewY=(t*i+e*r)/o}return a.rotation=Jn.Util._getRotation(a.rotation),a}}Jn.Transform=xr;var l5="[object Array]",c5="[object Number]",d5="[object String]",u5="[object Boolean]",g5=Math.PI/180,f5=180/Math.PI,Cr="#",p5="",m5="0",_5="Konva warning: ",Qn="Konva error: ",y5="rgb(",wr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},C5=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,yi=[],w5=typeof requestAnimationFrame!=="undefined"&&requestAnimationFrame||function(t){setTimeout(t,60)};Jn.Util={_isElement(t){return!!(t&&t.nodeType==1)},_isFunction(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isPlainObject(t){return!!t&&t.constructor===Object},_isArray(t){return Object.prototype.toString.call(t)===l5},_isNumber(t){return Object.prototype.toString.call(t)===c5&&!isNaN(t)&&isFinite(t)},_isString(t){return Object.prototype.toString.call(t)===d5},_isBoolean(t){return Object.prototype.toString.call(t)===u5},isObject(t){return t instanceof Object},isValidSelector(t){if(typeof t!=="string")return!1;let e=t[0];return e==="#"||e==="."||e===e.toUpperCase()},_sign(t){if(t===0)return 1;if(t>0)return 1;else return-1},requestAnimFrame(t){if(yi.push(t),yi.length===1)w5(function(){let e=yi;yi=[],e.forEach(function(i){i()})})},createCanvasElement(){let t=document.createElement("canvas");try{t.style=t.style||{}}catch(e){}return t},createImageElement(){return document.createElement("img")},_isInDocument(t){while(t=t.parentNode)if(t==document)return!0;return!1},_urlToImage(t,e){let i=Jn.Util.createImageElement();i.onload=function(){e(i)},i.src=t},_rgbToHex(t,e,i){return(16777216+(t<<16)+(e<<8)+i).toString(16).slice(1)},_hexToRgb(t){t=t.replace(Cr,p5);let e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:e&255}},getRandomColor(){let t=(Math.random()*16777215<<0).toString(16);while(t.length<6)t=m5+t;return Cr+t},getRGB(t){let e;if(t in wr)return e=wr[t],{r:e[0],g:e[1],b:e[2]};else if(t[0]===Cr)return this._hexToRgb(t.substring(1));else if(t.substr(0,4)===y5)return e=C5.exec(t.replace(/ /g,"")),{r:parseInt(e[1],10),g:parseInt(e[2],10),b:parseInt(e[3],10)};else return{r:0,g:0,b:0}},colorToRGBA(t){return t=t||"black",Jn.Util._namedColorToRBA(t)||Jn.Util._hex3ColorToRGBA(t)||Jn.Util._hex4ColorToRGBA(t)||Jn.Util._hex6ColorToRGBA(t)||Jn.Util._hex8ColorToRGBA(t)||Jn.Util._rgbColorToRGBA(t)||Jn.Util._rgbaColorToRGBA(t)||Jn.Util._hslColorToRGBA(t)},_namedColorToRBA(t){let e=wr[t.toLowerCase()];if(!e)return null;return{r:e[0],g:e[1],b:e[2],a:1}},_rgbColorToRGBA(t){if(t.indexOf("rgb(")===0){t=t.match(/rgb\(([^)]+)\)/)[1];let e=t.split(/ *, */).map(Number);return{r:e[0],g:e[1],b:e[2],a:1}}},_rgbaColorToRGBA(t){if(t.indexOf("rgba(")===0){t=t.match(/rgba\(([^)]+)\)/)[1];let e=t.split(/ *, */).map((i,r)=>{if(i.slice(-1)==="%")return r===3?parseInt(i)/100:parseInt(i)/100*255;return Number(i)});return{r:e[0],g:e[1],b:e[2],a:e[3]}}},_hex8ColorToRGBA(t){if(t[0]==="#"&&t.length===9)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:parseInt(t.slice(7,9),16)/255}},_hex6ColorToRGBA(t){if(t[0]==="#"&&t.length===7)return{r:parseInt(t.slice(1,3),16),g:parseInt(t.slice(3,5),16),b:parseInt(t.slice(5,7),16),a:1}},_hex4ColorToRGBA(t){if(t[0]==="#"&&t.length===5)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:parseInt(t[4]+t[4],16)/255}},_hex3ColorToRGBA(t){if(t[0]==="#"&&t.length===4)return{r:parseInt(t[1]+t[1],16),g:parseInt(t[2]+t[2],16),b:parseInt(t[3]+t[3],16),a:1}},_hslColorToRGBA(t){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(t)){let[e,...i]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(t),r=Number(i[0])/360,n=Number(i[1])/100,s=Number(i[2])/100,o,a,h;if(n===0)return h=s*255,{r:Math.round(h),g:Math.round(h),b:Math.round(h),a:1};if(s<0.5)o=s*(1+n);else o=s+n-s*n;let l=2*s-o,c=[0,0,0];for(let d=0;d<3;d++){if(a=r+0.3333333333333333*-(d-1),a<0)a++;if(a>1)a--;if(6*a<1)h=l+(o-l)*6*a;else if(2*a<1)h=o;else if(3*a<2)h=l+(o-l)*(0.6666666666666666-a)*6;else h=l;c[d]=h*255}return{r:Math.round(c[0]),g:Math.round(c[1]),b:Math.round(c[2]),a:1}}},haveIntersection(t,e){return!(e.x>t.x+t.width||e.x+e.width<t.x||e.y>t.y+t.height||e.y+e.height<t.y)},cloneObject(t){let e={};for(let i in t)if(this._isPlainObject(t[i]))e[i]=this.cloneObject(t[i]);else if(this._isArray(t[i]))e[i]=this.cloneArray(t[i]);else e[i]=t[i];return e},cloneArray(t){return t.slice(0)},degToRad(t){return t*g5},radToDeg(t){return t*f5},_degToRad(t){return Jn.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),Jn.Util.degToRad(t)},_radToDeg(t){return Jn.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),Jn.Util.radToDeg(t)},_getRotation(t){return yr.Konva.angleDeg?Jn.Util.radToDeg(t):t},_capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)},throw(t){throw new Error(Qn+t)},error(t){console.error(Qn+t)},warn(t){if(!yr.Konva.showWarnings)return;console.warn(_5+t)},each(t,e){for(let i in t)e(i,t[i])},_inRange(t,e,i){return e<=t&&t<i},_getProjectionToSegment(t,e,i,r,n,s){let o,a,h,l=(t-i)*(t-i)+(e-r)*(e-r);if(l==0)o=t,a=e,h=(n-i)*(n-i)+(s-r)*(s-r);else{let c=((n-t)*(i-t)+(s-e)*(r-e))/l;if(c<0)o=t,a=e,h=(t-n)*(t-n)+(e-s)*(e-s);else if(c>1)o=i,a=r,h=(i-n)*(i-n)+(r-s)*(r-s);else o=t+c*(i-t),a=e+c*(r-e),h=(o-n)*(o-n)+(a-s)*(a-s)}return[o,a,h]},_getProjectionToLine(t,e,i){let r=Jn.Util.cloneObject(t),n=Number.MAX_VALUE;return e.forEach(function(s,o){if(!i&&o===e.length-1)return;let a=e[(o+1)%e.length],h=Jn.Util._getProjectionToSegment(s.x,s.y,a.x,a.y,t.x,t.y),l=h[0],c=h[1],d=h[2];if(d<n)r.x=l,r.y=c,n=d}),r},_prepareArrayForTween(t,e,i){let r=[],n=[];if(t.length>e.length){let o=e;e=t,t=o}for(let o=0;o<t.length;o+=2)r.push({x:t[o],y:t[o+1]});for(let o=0;o<e.length;o+=2)n.push({x:e[o],y:e[o+1]});let s=[];return n.forEach(function(o){let a=Jn.Util._getProjectionToLine(o,r,i);s.push(a.x),s.push(a.y)}),s},_prepareToStringify(t){let e;t.visitedByCircularReferenceRemoval=!0;for(let i in t){if(!(t.hasOwnProperty(i)&&t[i]&&typeof t[i]=="object"))continue;if(e=Object.getOwnPropertyDescriptor(t,i),t[i].visitedByCircularReferenceRemoval||Jn.Util._isElement(t[i]))if(e.configurable)delete t[i];else return null;else if(Jn.Util._prepareToStringify(t[i])===null)if(e.configurable)delete t[i];else return null}return delete t.visitedByCircularReferenceRemoval,t},_assign(t,e){for(let i in e)t[i]=e[i];return t},_getFirstPointerId(t){if(!t.touches)return t.pointerId||999;else return t.changedTouches[0].identifier},releaseCanvas(...t){if(!yr.Konva.releaseCanvasOnDestroy)return;t.forEach((e)=>{e.width=0,e.height=0})},drawRoundedRectPath(t,e,i,r){let n=0,s=0,o=0,a=0;if(typeof r==="number")n=s=o=a=Math.min(r,e/2,i/2);else n=Math.min(r[0]||0,e/2,i/2),s=Math.min(r[1]||0,e/2,i/2),a=Math.min(r[2]||0,e/2,i/2),o=Math.min(r[3]||0,e/2,i/2);t.moveTo(n,0),t.lineTo(e-s,0),t.arc(e-s,s,s,Math.PI*3/2,0,!1),t.lineTo(e,i-a),t.arc(e-a,i-a,a,0,Math.PI/2,!1),t.lineTo(o,i),t.arc(o,i-o,o,Math.PI/2,Math.PI,!1),t.lineTo(0,n),t.arc(n,n,n,Math.PI,Math.PI*3/2,!1)}}});var R=N(($n)=>{Object.defineProperty($n,"__esModule",{value:!0});$n.RGBComponent=b5;$n.alphaComponent=v5;$n.getNumberValidator=S5;$n.getNumberOrArrayOfNumbersValidator=M5;$n.getNumberOrAutoValidator=k5;$n.getStringValidator=L5;$n.getStringOrGradientValidator=E5;$n.getFunctionValidator=N5;$n.getNumberArrayValidator=A5;$n.getBooleanValidator=F5;$n.getComponentValidator=P5;var Xt=I(),rt=J();function Kt(t){if(rt.Util._isString(t))return'"'+t+'"';if(Object.prototype.toString.call(t)==="[object Number]")return t;if(rt.Util._isBoolean(t))return t;return Object.prototype.toString.call(t)}function b5(t){if(t>255)return 255;else if(t<0)return 0;return Math.round(t)}function v5(t){if(t>1)return 1;else if(t<0.0001)return 0.0001;return t}function S5(){if(Xt.Konva.isUnminified)return function(t,e){if(!rt.Util._isNumber(t))rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a number.');return t}}function M5(t){if(Xt.Konva.isUnminified)return function(e,i){let r=rt.Util._isNumber(e),n=rt.Util._isArray(e)&&e.length==t;if(!r&&!n)rt.Util.warn(Kt(e)+' is a not valid value for "'+i+'" attribute. The value should be a number or Array<number>('+t+")");return e}}function k5(){if(Xt.Konva.isUnminified)return function(t,e){var i=rt.Util._isNumber(t),r=t==="auto";if(!(i||r))rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a number or "auto".');return t}}function L5(){if(Xt.Konva.isUnminified)return function(t,e){if(!rt.Util._isString(t))rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a string.');return t}}function E5(){if(Xt.Konva.isUnminified)return function(t,e){let i=rt.Util._isString(t),r=Object.prototype.toString.call(t)==="[object CanvasGradient]"||t&&t.addColorStop;if(!(i||r))rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a string or a native gradient.');return t}}function N5(){if(Xt.Konva.isUnminified)return function(t,e){if(!rt.Util._isFunction(t))rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a function.');return t}}function A5(){if(Xt.Konva.isUnminified)return function(t,e){let i=Int8Array?Object.getPrototypeOf(Int8Array):null;if(i&&t instanceof i)return t;if(!rt.Util._isArray(t))rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a array of numbers.');else t.forEach(function(r){if(!rt.Util._isNumber(r))rt.Util.warn('"'+e+'" attribute has non numeric element '+r+". Make sure that all elements are numbers.")});return t}}function F5(){if(Xt.Konva.isUnminified)return function(t,e){var i=t===!0||t===!1;if(!i)rt.Util.warn(Kt(t)+' is a not valid value for "'+e+'" attribute. The value should be a boolean.');return t}}function P5(t){if(Xt.Konva.isUnminified)return function(e,i){if(e===void 0||e===null)return e;if(!rt.Util.isObject(e))rt.Util.warn(Kt(e)+' is a not valid value for "'+i+'" attribute. The value should be an object with properties '+t);return e}}});var G=N((ts)=>{Object.defineProperty(ts,"__esModule",{value:!0});ts.Factory=void 0;var bt=J(),W5=R(),Ue="get",qe="set";ts.Factory={addGetterSetter(t,e,i,r,n){ts.Factory.addGetter(t,e,i),ts.Factory.addSetter(t,e,r,n),ts.Factory.addOverloadedGetterSetter(t,e)},addGetter(t,e,i){var r=Ue+bt.Util._capitalize(e);t.prototype[r]=t.prototype[r]||function(){let n=this.attrs[e];return n===void 0?i:n}},addSetter(t,e,i,r){var n=qe+bt.Util._capitalize(e);if(!t.prototype[n])ts.Factory.overWriteSetter(t,e,i,r)},overWriteSetter(t,e,i,r){var n=qe+bt.Util._capitalize(e);t.prototype[n]=function(s){if(i&&s!==void 0&&s!==null)s=i.call(this,s,e);if(this._setAttr(e,s),r)r.call(this);return this}},addComponentsGetterSetter(t,e,i,r,n){let s=i.length,o=bt.Util._capitalize,a=Ue+o(e),h=qe+o(e);t.prototype[a]=function(){let c={};for(let d=0;d<s;d++){let u=i[d];c[u]=this.getAttr(e+o(u))}return c};let l=W5.getComponentValidator(i);t.prototype[h]=function(c){let d=this.attrs[e];if(r)c=r.call(this,c,e);if(l)l.call(this,c,e);for(let u in c){if(!c.hasOwnProperty(u))continue;this._setAttr(e+o(u),c[u])}if(!c)i.forEach((u)=>{this._setAttr(e+o(u),void 0)});if(this._fireChangeEvent(e,d,c),n)n.call(this);return this},ts.Factory.addOverloadedGetterSetter(t,e)},addOverloadedGetterSetter(t,e){var i=bt.Util._capitalize(e),r=qe+i,n=Ue+i;t.prototype[e]=function(){if(arguments.length)return this[r](arguments[0]),this;return this[n]()}},addDeprecatedGetterSetter(t,e,i,r){bt.Util.error("Adding deprecated "+e);let n=Ue+bt.Util._capitalize(e),s=e+" property is deprecated and will be removed soon. Look at Konva change log for more information.";t.prototype[n]=function(){bt.Util.error(s);let o=this.attrs[e];return o===void 0?i:o},ts.Factory.addSetter(t,e,r,function(){bt.Util.error(s)}),ts.Factory.addOverloadedGetterSetter(t,e)},backCompat(t,e){bt.Util.each(e,function(i,r){let n=t.prototype[r],s=Ue+bt.Util._capitalize(i),o=qe+bt.Util._capitalize(i);function a(){n.apply(this,arguments),bt.Util.error('"'+i+'" method is deprecated and will be removed soon. Use ""'+r+'" instead.')}t.prototype[i]=a,t.prototype[s]=a,t.prototype[o]=a})},afterSetFilter(){this._filterUpToDate=!1}}});var br=N((os)=>{Object.defineProperty(os,"__esModule",{value:!0});os.HitContext=os.SceneContext=os.Context=void 0;var rs=J(),H5=I();function Y5(t){let e=[],i=t.length,r=rs.Util;for(let n=0;n<i;n++){let s=t[n];if(r._isNumber(s))s=Math.round(s*1000)/1000;else if(!r._isString(s))s=s+"";e.push(s)}return e}var es=",",j5="(",X5=")",K5="([",Z5="])",Q5=";",J5="()",$5="=",is=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],tl=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"],el=100;class ze{constructor(t){if(this.canvas=t,H5.Konva.enableTrace)this.traceArr=[],this._enableTrace()}fillShape(t){if(t.fillEnabled())this._fill(t)}_fill(t){}strokeShape(t){if(t.hasStroke())this._stroke(t)}_stroke(t){}fillStrokeShape(t){if(t.attrs.fillAfterStrokeEnabled)this.strokeShape(t),this.fillShape(t);else this.fillShape(t),this.strokeShape(t)}getTrace(t,e){let i=this.traceArr,r=i.length,n="",s,o,a,h;for(s=0;s<r;s++){if(o=i[s],a=o.method,a)if(h=o.args,n+=a,t)n+=J5;else if(rs.Util._isArray(h[0]))n+=K5+h.join(es)+Z5;else{if(e)h=h.map((l)=>typeof l==="number"?Math.floor(l):l);n+=j5+h.join(es)+X5}else if(n+=o.property,!t)n+=$5+o.val;n+=Q5}return n}clearTrace(){this.traceArr=[]}_trace(t){let e=this.traceArr,i;if(e.push(t),i=e.length,i>=el)e.shift()}reset(){let t=this.getCanvas().getPixelRatio();this.setTransform(1*t,0,0,1*t,0,0)}getCanvas(){return this.canvas}clear(t){let e=this.getCanvas();if(t)this.clearRect(t.x||0,t.y||0,t.width||0,t.height||0);else this.clearRect(0,0,e.getWidth()/e.pixelRatio,e.getHeight()/e.pixelRatio)}_applyLineCap(t){let e=t.attrs.lineCap;if(e)this.setAttr("lineCap",e)}_applyOpacity(t){let e=t.getAbsoluteOpacity();if(e!==1)this.setAttr("globalAlpha",e)}_applyLineJoin(t){let e=t.attrs.lineJoin;if(e)this.setAttr("lineJoin",e)}setAttr(t,e){this._context[t]=e}arc(t,e,i,r,n,s){this._context.arc(t,e,i,r,n,s)}arcTo(t,e,i,r,n){this._context.arcTo(t,e,i,r,n)}beginPath(){this._context.beginPath()}bezierCurveTo(t,e,i,r,n,s){this._context.bezierCurveTo(t,e,i,r,n,s)}clearRect(t,e,i,r){this._context.clearRect(t,e,i,r)}clip(...t){this._context.clip.apply(this._context,t)}closePath(){this._context.closePath()}createImageData(t,e){let i=arguments;if(i.length===2)return this._context.createImageData(t,e);else if(i.length===1)return this._context.createImageData(t)}createLinearGradient(t,e,i,r){return this._context.createLinearGradient(t,e,i,r)}createPattern(t,e){return this._context.createPattern(t,e)}createRadialGradient(t,e,i,r,n,s){return this._context.createRadialGradient(t,e,i,r,n,s)}drawImage(t,e,i,r,n,s,o,a,h){let l=arguments,c=this._context;if(l.length===3)c.drawImage(t,e,i);else if(l.length===5)c.drawImage(t,e,i,r,n);else if(l.length===9)c.drawImage(t,e,i,r,n,s,o,a,h)}ellipse(t,e,i,r,n,s,o,a){this._context.ellipse(t,e,i,r,n,s,o,a)}isPointInPath(t,e,i,r){if(i)return this._context.isPointInPath(i,t,e,r);return this._context.isPointInPath(t,e,r)}fill(...t){this._context.fill.apply(this._context,t)}fillRect(t,e,i,r){this._context.fillRect(t,e,i,r)}strokeRect(t,e,i,r){this._context.strokeRect(t,e,i,r)}fillText(t,e,i,r){if(r)this._context.fillText(t,e,i,r);else this._context.fillText(t,e,i)}measureText(t){return this._context.measureText(t)}getImageData(t,e,i,r){return this._context.getImageData(t,e,i,r)}lineTo(t,e){this._context.lineTo(t,e)}moveTo(t,e){this._context.moveTo(t,e)}rect(t,e,i,r){this._context.rect(t,e,i,r)}roundRect(t,e,i,r,n){this._context.roundRect(t,e,i,r,n)}putImageData(t,e,i){this._context.putImageData(t,e,i)}quadraticCurveTo(t,e,i,r){this._context.quadraticCurveTo(t,e,i,r)}restore(){this._context.restore()}rotate(t){this._context.rotate(t)}save(){this._context.save()}scale(t,e){this._context.scale(t,e)}setLineDash(t){if(this._context.setLineDash)this._context.setLineDash(t);else if("mozDash"in this._context)this._context.mozDash=t;else if("webkitLineDash"in this._context)this._context.webkitLineDash=t}getLineDash(){return this._context.getLineDash()}setTransform(t,e,i,r,n,s){this._context.setTransform(t,e,i,r,n,s)}stroke(t){if(t)this._context.stroke(t);else this._context.stroke()}strokeText(t,e,i,r){this._context.strokeText(t,e,i,r)}transform(t,e,i,r,n,s){this._context.transform(t,e,i,r,n,s)}translate(t,e){this._context.translate(t,e)}_enableTrace(){let t=this,e=is.length,i=this.setAttr,r,n,s=function(o){let a=t[o],h;t[o]=function(){return n=Y5(Array.prototype.slice.call(arguments,0)),h=a.apply(t,arguments),t._trace({method:o,args:n}),h}};for(r=0;r<e;r++)s(is[r]);t.setAttr=function(){i.apply(t,arguments);let o=arguments[0],a=arguments[1];if(o==="shadowOffsetX"||o==="shadowOffsetY"||o==="shadowBlur")a=a/this.canvas.getPixelRatio();t._trace({property:o,val:a})}}_applyGlobalCompositeOperation(t){let e=t.attrs.globalCompositeOperation;if(!(!e||e==="source-over"))this.setAttr("globalCompositeOperation",e)}}os.Context=ze;tl.forEach(function(t){Object.defineProperty(ze.prototype,t,{get(){return this._context[t]},set(e){this._context[t]=e}})});class ns extends ze{constructor(t,{willReadFrequently:e=!1}={}){super(t);this._context=t._canvas.getContext("2d",{willReadFrequently:e})}_fillColor(t){let e=t.fill();this.setAttr("fillStyle",e),t._fillFunc(this)}_fillPattern(t){this.setAttr("fillStyle",t._getFillPattern()),t._fillFunc(this)}_fillLinearGradient(t){let e=t._getLinearGradient();if(e)this.setAttr("fillStyle",e),t._fillFunc(this)}_fillRadialGradient(t){let e=t._getRadialGradient();if(e)this.setAttr("fillStyle",e),t._fillFunc(this)}_fill(t){let e=t.fill(),i=t.getFillPriority();if(e&&i==="color"){this._fillColor(t);return}let r=t.getFillPatternImage();if(r&&i==="pattern"){this._fillPattern(t);return}let n=t.getFillLinearGradientColorStops();if(n&&i==="linear-gradient"){this._fillLinearGradient(t);return}let s=t.getFillRadialGradientColorStops();if(s&&i==="radial-gradient"){this._fillRadialGradient(t);return}if(e)this._fillColor(t);else if(r)this._fillPattern(t);else if(n)this._fillLinearGradient(t);else if(s)this._fillRadialGradient(t)}_strokeLinearGradient(t){let e=t.getStrokeLinearGradientStartPoint(),i=t.getStrokeLinearGradientEndPoint(),r=t.getStrokeLinearGradientColorStops(),n=this.createLinearGradient(e.x,e.y,i.x,i.y);if(r){for(let s=0;s<r.length;s+=2)n.addColorStop(r[s],r[s+1]);this.setAttr("strokeStyle",n)}}_stroke(t){let e=t.dash(),i=t.getStrokeScaleEnabled();if(t.hasStroke()){if(!i){this.save();let n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}if(this._applyLineCap(t),e&&t.dashEnabled())this.setLineDash(e),this.setAttr("lineDashOffset",t.dashOffset());if(this.setAttr("lineWidth",t.strokeWidth()),!t.getShadowForStrokeEnabled())this.setAttr("shadowColor","rgba(0,0,0,0)");if(t.getStrokeLinearGradientColorStops())this._strokeLinearGradient(t);else this.setAttr("strokeStyle",t.stroke());if(t._strokeFunc(this),!i)this.restore()}}_applyShadow(t){var e,i,r;let n=(e=t.getShadowRGBA())!==null&&e!==void 0?e:"black",s=(i=t.getShadowBlur())!==null&&i!==void 0?i:5,o=(r=t.getShadowOffset())!==null&&r!==void 0?r:{x:0,y:0},a=t.getAbsoluteScale(),h=this.canvas.getPixelRatio(),l=a.x*h,c=a.y*h;this.setAttr("shadowColor",n),this.setAttr("shadowBlur",s*Math.min(Math.abs(l),Math.abs(c))),this.setAttr("shadowOffsetX",o.x*l),this.setAttr("shadowOffsetY",o.y*c)}}os.SceneContext=ns;class ss extends ze{constructor(t){super(t);this._context=t._canvas.getContext("2d",{willReadFrequently:!0})}_fill(t){this.save(),this.setAttr("fillStyle",t.colorKey),t._fillFuncHit(this),this.restore()}strokeShape(t){if(t.hasHitStroke())this._stroke(t)}_stroke(t){if(t.hasHitStroke()){let e=t.getStrokeScaleEnabled();if(!e){this.save();let n=this.getCanvas().getPixelRatio();this.setTransform(n,0,0,n,0,0)}this._applyLineCap(t);let i=t.hitStrokeWidth(),r=i==="auto"?t.strokeWidth():i;if(this.setAttr("lineWidth",r),this.setAttr("strokeStyle",t.colorKey),t._strokeFuncHit(this),!e)this.restore()}}}os.HitContext=ss});var We=N((us)=>{Object.defineProperty(us,"__esModule",{value:!0});us.HitCanvas=us.SceneCanvas=us.Canvas=void 0;var wi=J(),hs=br(),ls=I(),nl=G(),sl=R(),Ci;function ol(){if(Ci)return Ci;let t=wi.Util.createCanvasElement(),e=t.getContext("2d");return Ci=function(){let i=ls.Konva._global.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return i/r}(),wi.Util.releaseCanvas(t),Ci}class Ve{constructor(t){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;let i=(t||{}).pixelRatio||ls.Konva.pixelRatio||ol();this.pixelRatio=i,this._canvas=wi.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(t){let e=this.pixelRatio;this.pixelRatio=t,this.setSize(this.getWidth()/e,this.getHeight()/e)}setWidth(t){this.width=this._canvas.width=t*this.pixelRatio,this._canvas.style.width=t+"px";let e=this.pixelRatio;this.getContext()._context.scale(e,e)}setHeight(t){this.height=this._canvas.height=t*this.pixelRatio,this._canvas.style.height=t+"px";let e=this.pixelRatio;this.getContext()._context.scale(e,e)}getWidth(){return this.width}getHeight(){return this.height}setSize(t,e){this.setWidth(t||0),this.setHeight(e||0)}toDataURL(t,e){try{return this._canvas.toDataURL(t,e)}catch(i){try{return this._canvas.toDataURL()}catch(r){return wi.Util.error("Unable to get data URL. "+r.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}}us.Canvas=Ve;nl.Factory.addGetterSetter(Ve,"pixelRatio",void 0,sl.getNumberValidator());class cs extends Ve{constructor(t={width:0,height:0,willReadFrequently:!1}){super(t);this.context=new hs.SceneContext(this,{willReadFrequently:t.willReadFrequently}),this.setSize(t.width,t.height)}}us.SceneCanvas=cs;class ds extends Ve{constructor(t={width:0,height:0}){super(t);this.hitCanvas=!0,this.context=new hs.HitContext(this),this.setSize(t.width,t.height)}}us.HitCanvas=ds});var xi=N((fs)=>{Object.defineProperty(fs,"__esModule",{value:!0});fs.DD=void 0;var He=I(),ll=J();fs.DD={get isDragging(){let t=!1;return fs.DD._dragElements.forEach((e)=>{if(e.dragStatus==="dragging")t=!0}),t},justDragged:!1,get node(){let t;return fs.DD._dragElements.forEach((e)=>{t=e.node}),t},_dragElements:new Map,_drag(t){let e=[];fs.DD._dragElements.forEach((i,r)=>{let{node:n}=i,s=n.getStage();if(s.setPointersPositions(t),i.pointerId===void 0)i.pointerId=ll.Util._getFirstPointerId(t);let o=s._changedPointerPositions.find((a)=>a.id===i.pointerId);if(!o)return;if(i.dragStatus!=="dragging"){let a=n.dragDistance();if(Math.max(Math.abs(o.x-i.startPointerPos.x),Math.abs(o.y-i.startPointerPos.y))<a)return;if(n.startDrag({evt:t}),!n.isDragging())return}n._setDragPosition(t,i),e.push(n)}),e.forEach((i)=>{i.fire("dragmove",{type:"dragmove",target:i,evt:t},!0)})},_endDragBefore(t){let e=[];fs.DD._dragElements.forEach((i)=>{let{node:r}=i,n=r.getStage();if(t)n.setPointersPositions(t);if(!n._changedPointerPositions.find((a)=>a.id===i.pointerId))return;if(i.dragStatus==="dragging"||i.dragStatus==="stopped")fs.DD.justDragged=!0,He.Konva._mouseListenClick=!1,He.Konva._touchListenClick=!1,He.Konva._pointerListenClick=!1,i.dragStatus="stopped";let o=i.node.getLayer()||i.node instanceof He.Konva.Stage&&i.node;if(o&&e.indexOf(o)===-1)e.push(o)}),e.forEach((i)=>{i.draw()})},_endDragAfter(t){fs.DD._dragElements.forEach((e,i)=>{if(e.dragStatus==="stopped")e.node.fire("dragend",{type:"dragend",target:e.node,evt:t},!0);if(e.dragStatus!=="dragging")fs.DD._dragElements.delete(i)})}};if(He.Konva.isBrowser)window.addEventListener("mouseup",fs.DD._endDragBefore,!0),window.addEventListener("touchend",fs.DD._endDragBefore,!0),window.addEventListener("touchcancel",fs.DD._endDragBefore,!0),window.addEventListener("mousemove",fs.DD._drag),window.addEventListener("touchmove",fs.DD._drag),window.addEventListener("mouseup",fs.DD._endDragAfter,!1),window.addEventListener("touchend",fs.DD._endDragAfter,!1),window.addEventListener("touchcancel",fs.DD._endDragAfter,!1)});var nt=N((xs)=>{Object.defineProperty(xs,"__esModule",{value:!0});xs.Node=void 0;var B=J(),je=G(),Ye=We(),oe=I(),kt=xi(),st=R(),vi="absoluteOpacity",bi="allEventListeners",Qt="absoluteTransform",ps="absoluteScale",Ce="canvas",cl="Change",dl="children",ul="konva",vr="listening",ms="mouseenter",_s="mouseleave",ys="set",Cs="Shape",Si=" ",ws="stage",ae="transform",gl="Stage",Sr="visible",fl=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(Si),pl=1;class D{constructor(t){this._id=pl++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(t),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(t){if((t===ae||t===Qt)&&this._cache.get(t))this._cache.get(t).dirty=!0;else if(t)this._cache.delete(t);else this._cache.clear()}_getCache(t,e){let i=this._cache.get(t);if(i===void 0||(t===ae||t===Qt)&&i.dirty===!0)i=e.call(this),this._cache.set(t,i);return i}_calculate(t,e,i){if(!this._attachedDepsListeners.get(t)){let r=e.map((n)=>n+"Change.konva").join(Si);this.on(r,()=>{this._clearCache(t)}),this._attachedDepsListeners.set(t,!0)}return this._getCache(t,i)}_getCanvasCache(){return this._cache.get(Ce)}_clearSelfAndDescendantCache(t){if(this._clearCache(t),t===Qt)this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(Ce)){let{scene:t,filter:e,hit:i}=this._cache.get(Ce);B.Util.releaseCanvas(t,e,i),this._cache.delete(Ce)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(t){let e=t||{},i={};if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)i=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0});let r=Math.ceil(e.width||i.width),n=Math.ceil(e.height||i.height),s=e.pixelRatio,o=e.x===void 0?Math.floor(i.x):e.x,a=e.y===void 0?Math.floor(i.y):e.y,h=e.offset||0,l=e.drawBorder||!1,c=e.hitCanvasPixelRatio||1;if(!r||!n){B.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}let d=Math.abs(Math.round(i.x)-o)>0.5?1:0,u=Math.abs(Math.round(i.y)-a)>0.5?1:0;r+=h*2+d,n+=h*2+u,o-=h,a-=h;let g=new Ye.SceneCanvas({pixelRatio:s,width:r,height:n}),p=new Ye.SceneCanvas({pixelRatio:s,width:0,height:0,willReadFrequently:!0}),m=new Ye.HitCanvas({pixelRatio:c,width:r,height:n}),f=g.getContext(),_=m.getContext();if(m.isCache=!0,g.isCache=!0,this._cache.delete(Ce),this._filterUpToDate=!1,e.imageSmoothingEnabled===!1)g.getContext()._context.imageSmoothingEnabled=!1,p.getContext()._context.imageSmoothingEnabled=!1;if(f.save(),_.save(),f.translate(-o,-a),_.translate(-o,-a),this._isUnderCache=!0,this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(ps),this.drawScene(g,this),this.drawHit(m,this),this._isUnderCache=!1,f.restore(),_.restore(),l)f.save(),f.beginPath(),f.rect(0,0,r,n),f.closePath(),f.setAttr("strokeStyle","red"),f.setAttr("lineWidth",5),f.stroke(),f.restore();return this._cache.set(Ce,{scene:g,filter:p,hit:m,x:o,y:a}),this._requestDraw(),this}isCached(){return this._cache.has(Ce)}getClientRect(t){throw new Error('abstract "getClientRect" method call')}_transformedRect(t,e){let i=[{x:t.x,y:t.y},{x:t.x+t.width,y:t.y},{x:t.x+t.width,y:t.y+t.height},{x:t.x,y:t.y+t.height}],r=1/0,n=1/0,s=-1/0,o=-1/0,a=this.getAbsoluteTransform(e);return i.forEach(function(h){let l=a.point(h);if(r===void 0)r=s=l.x,n=o=l.y;r=Math.min(r,l.x),n=Math.min(n,l.y),s=Math.max(s,l.x),o=Math.max(o,l.y)}),{x:r,y:n,width:s-r,height:o-n}}_drawCachedSceneCanvas(t){t.save(),t._applyOpacity(this),t._applyGlobalCompositeOperation(this);let e=this._getCanvasCache();t.translate(e.x,e.y);let i=this._getCachedSceneCanvas(),r=i.pixelRatio;t.drawImage(i._canvas,0,0,i.width/r,i.height/r),t.restore()}_drawCachedHitCanvas(t){let e=this._getCanvasCache(),i=e.hit;t.save(),t.translate(e.x,e.y),t.drawImage(i._canvas,0,0,i.width/i.pixelRatio,i.height/i.pixelRatio),t.restore()}_getCachedSceneCanvas(){let t=this.filters(),e=this._getCanvasCache(),i=e.scene,r=e.filter,n=r.getContext(),s,o,a,h;if(t){if(!this._filterUpToDate){let l=i.pixelRatio;r.setSize(i.width/i.pixelRatio,i.height/i.pixelRatio);try{s=t.length,n.clear(),n.drawImage(i._canvas,0,0,i.getWidth()/l,i.getHeight()/l),o=n.getImageData(0,0,r.getWidth(),r.getHeight());for(a=0;a<s;a++){if(h=t[a],typeof h!=="function"){B.Util.error("Filter should be type of function, but got "+typeof h+" instead. Please check correct filters");continue}h.call(this,o),n.putImageData(o,0,0)}}catch(c){B.Util.error("Unable to apply filter. "+c.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return r}return i}on(t,e){if(this._cache&&this._cache.delete(bi),arguments.length===3)return this._delegate.apply(this,arguments);let i=t.split(Si),r=i.length,n,s,o,a,h;for(n=0;n<r;n++){if(s=i[n],o=s.split("."),a=o[0],h=o[1]||"",!this.eventListeners[a])this.eventListeners[a]=[];this.eventListeners[a].push({name:h,handler:e})}return this}off(t,e){let i=(t||"").split(Si),r=i.length,n,s,o,a,h,l;if(this._cache&&this._cache.delete(bi),!t)for(s in this.eventListeners)this._off(s);for(n=0;n<r;n++)if(o=i[n],a=o.split("."),h=a[0],l=a[1],h){if(this.eventListeners[h])this._off(h,l,e)}else for(s in this.eventListeners)this._off(s,l,e);return this}dispatchEvent(t){let e={target:this,type:t.type,evt:t};return this.fire(t.type,e),this}addEventListener(t,e){return this.on(t,function(i){e.call(this,i.evt)}),this}removeEventListener(t){return this.off(t),this}_delegate(t,e,i){let r=this;this.on(t,function(n){let s=n.target.findAncestors(e,!0,r);for(let o=0;o<s.length;o++)n=B.Util.cloneObject(n),n.currentTarget=s[o],i.call(s[o],n)})}remove(){if(this.isDragging())this.stopDrag();return kt.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(Qt),this._clearSelfAndDescendantCache(vi),this._clearSelfAndDescendantCache(ps),this._clearSelfAndDescendantCache(ws),this._clearSelfAndDescendantCache(Sr),this._clearSelfAndDescendantCache(vr)}_remove(){this._clearCaches();let t=this.getParent();if(t&&t.children)t.children.splice(this.index,1),t._setChildrenIndices(),this.parent=null}destroy(){return this.remove(),this.clearCache(),this}getAttr(t){let e="get"+B.Util._capitalize(t);if(B.Util._isFunction(this[e]))return this[e]();return this.attrs[t]}getAncestors(){let t=this.getParent(),e=[];while(t)e.push(t),t=t.getParent();return e}getAttrs(){return this.attrs||{}}setAttrs(t){return this._batchTransformChanges(()=>{let e,i;if(!t)return this;for(e in t){if(e===dl)continue;if(i=ys+B.Util._capitalize(e),B.Util._isFunction(this[i]))this[i](t[e]);else this._setAttr(e,t[e])}}),this}isListening(){return this._getCache(vr,this._isListening)}_isListening(t){if(!this.listening())return!1;let i=this.getParent();if(i&&i!==t&&this!==t)return i._isListening(t);else return!0}isVisible(){return this._getCache(Sr,this._isVisible)}_isVisible(t){if(!this.visible())return!1;let i=this.getParent();if(i&&i!==t&&this!==t)return i._isVisible(t);else return!0}shouldDrawHit(t,e=!1){if(t)return this._isVisible(t)&&this._isListening(t);let i=this.getLayer(),r=!1;kt.DD._dragElements.forEach((s)=>{if(s.dragStatus!=="dragging")return;else if(s.node.nodeType==="Stage")r=!0;else if(s.node.getLayer()===i)r=!0});let n=!e&&!oe.Konva.hitOnDragEnabled&&(r||oe.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!n}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){let t=this.getDepth(),e=this,i=0,r,n,s,o;function a(l){r=[],n=l.length;for(s=0;s<n;s++){if(o=l[s],i++,o.nodeType!==Cs)r=r.concat(o.getChildren().slice());if(o._id===e._id)s=n}if(r.length>0&&r[0].getDepth()<=t)a(r)}let h=this.getStage();if(e.nodeType!==gl&&h)a(h.getChildren());return i}getDepth(){let t=0,e=this.parent;while(e)t++,e=e.parent;return t}_batchTransformChanges(t){if(this._batchingTransformChange=!0,t(),this._batchingTransformChange=!1,this._needClearTransformCache)this._clearCache(ae),this._clearSelfAndDescendantCache(Qt);this._needClearTransformCache=!1}setPosition(t){return this._batchTransformChanges(()=>{this.x(t.x),this.y(t.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){let t=this.getStage();if(!t)return null;let e=t.getPointerPosition();if(!e)return null;let i=this.getAbsoluteTransform().copy();return i.invert(),i.point(e)}getAbsolutePosition(t){let e=!1,i=this.parent;while(i){if(i.isCached()){e=!0;break}i=i.parent}if(e&&!t)t=!0;let r=this.getAbsoluteTransform(t).getMatrix(),n=new B.Transform,s=this.offset();return n.m=r.slice(),n.translate(s.x,s.y),n.getTranslation()}setAbsolutePosition(t){let{x:e,y:i,...r}=this._clearTransform();this.attrs.x=e,this.attrs.y=i,this._clearCache(ae);let n=this._getAbsoluteTransform().copy();return n.invert(),n.translate(t.x,t.y),t={x:this.attrs.x+n.getTranslation().x,y:this.attrs.y+n.getTranslation().y},this._setTransform(r),this.setPosition({x:t.x,y:t.y}),this._clearCache(ae),this._clearSelfAndDescendantCache(Qt),this}_setTransform(t){let e;for(e in t)this.attrs[e]=t[e]}_clearTransform(){let t={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,t}move(t){let{x:e,y:i}=t,r=this.x(),n=this.y();if(e!==void 0)r+=e;if(i!==void 0)n+=i;return this.setPosition({x:r,y:n}),this}_eachAncestorReverse(t,e){let i=[],r=this.getParent(),n,s;if(e&&e._id===this._id)return;i.unshift(this);while(r&&(!e||r._id!==e._id))i.unshift(r),r=r.parent;n=i.length;for(s=0;s<n;s++)t(i[s])}rotate(t){return this.rotation(this.rotation()+t),this}moveToTop(){if(!this.parent)return B.Util.warn("Node has no parent. moveToTop function is ignored."),!1;let t=this.index,e=this.parent.getChildren().length;if(t<e-1)return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0;return!1}moveUp(){if(!this.parent)return B.Util.warn("Node has no parent. moveUp function is ignored."),!1;let t=this.index,e=this.parent.getChildren().length;if(t<e-1)return this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0;return!1}moveDown(){if(!this.parent)return B.Util.warn("Node has no parent. moveDown function is ignored."),!1;let t=this.index;if(t>0)return this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0;return!1}moveToBottom(){if(!this.parent)return B.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;let t=this.index;if(t>0)return this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0;return!1}setZIndex(t){if(!this.parent)return B.Util.warn("Node has no parent. zIndex parameter is ignored."),this;if(t<0||t>=this.parent.children.length)B.Util.warn("Unexpected value "+t+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");let e=this.index;return this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(vi,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){let t=this.opacity(),e=this.getParent();if(e&&!e._isUnderCache)t*=e.getAbsoluteOpacity();return t}moveTo(t){if(this.getParent()!==t)this._remove(),t.add(this);return this}toObject(){let t=this.getAttrs(),e,i,r,n,s,o={attrs:{},className:this.getClassName()};for(e in t){if(i=t[e],s=B.Util.isObject(i)&&!B.Util._isPlainObject(i)&&!B.Util._isArray(i),s)continue;if(r=typeof this[e]==="function"&&this[e],delete t[e],n=r?r.call(this):null,t[e]=i,n!==i)o.attrs[e]=i}return B.Util._prepareToStringify(o)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(t,e,i){let r=[];if(e&&this._isMatch(t))r.push(this);let n=this.parent;while(n){if(n===i)return r;if(n._isMatch(t))r.push(n);n=n.parent}return r}isAncestorOf(t){return!1}findAncestor(t,e,i){return this.findAncestors(t,e,i)[0]}_isMatch(t){if(!t)return!1;if(typeof t==="function")return t(this);let e=t.replace(/ /g,"").split(","),i=e.length,r,n;for(r=0;r<i;r++){if(n=e[r],!B.Util.isValidSelector(n))B.Util.warn('Selector "'+n+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),B.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),B.Util.warn("Konva is awesome, right?");if(n.charAt(0)==="#"){if(this.id()===n.slice(1))return!0}else if(n.charAt(0)==="."){if(this.hasName(n.slice(1)))return!0}else if(this.className===n||this.nodeType===n)return!0}return!1}getLayer(){let t=this.getParent();return t?t.getLayer():null}getStage(){return this._getCache(ws,this._getStage)}_getStage(){let t=this.getParent();if(t)return t.getStage();else return null}fire(t,e={},i){if(e.target=e.target||this,i)this._fireAndBubble(t,e);else this._fire(t,e);return this}getAbsoluteTransform(t){if(t)return this._getAbsoluteTransform(t);else return this._getCache(Qt,this._getAbsoluteTransform)}_getAbsoluteTransform(t){let e;if(t)return e=new B.Transform,this._eachAncestorReverse(function(i){let r=i.transformsEnabled();if(r==="all")e.multiply(i.getTransform());else if(r==="position")e.translate(i.x()-i.offsetX(),i.y()-i.offsetY())},t),e;else{if(e=this._cache.get(Qt)||new B.Transform,this.parent)this.parent.getAbsoluteTransform().copyInto(e);else e.reset();let i=this.transformsEnabled();if(i==="all")e.multiply(this.getTransform());else if(i==="position"){let r=this.attrs.x||0,n=this.attrs.y||0,s=this.attrs.offsetX||0,o=this.attrs.offsetY||0;e.translate(r-s,n-o)}return e.dirty=!1,e}}getAbsoluteScale(t){let e=this;while(e){if(e._isUnderCache)t=e;e=e.getParent()}let r=this.getAbsoluteTransform(t).decompose();return{x:r.scaleX,y:r.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(ae,this._getTransform)}_getTransform(){var t,e;let i=this._cache.get(ae)||new B.Transform;i.reset();let r=this.x(),n=this.y(),s=oe.Konva.getAngle(this.rotation()),o=(t=this.attrs.scaleX)!==null&&t!==void 0?t:1,a=(e=this.attrs.scaleY)!==null&&e!==void 0?e:1,h=this.attrs.skewX||0,l=this.attrs.skewY||0,c=this.attrs.offsetX||0,d=this.attrs.offsetY||0;if(r!==0||n!==0)i.translate(r,n);if(s!==0)i.rotate(s);if(h!==0||l!==0)i.skew(h,l);if(o!==1||a!==1)i.scale(o,a);if(c!==0||d!==0)i.translate(-1*c,-1*d);return i.dirty=!1,i}clone(t){let e=B.Util.cloneObject(this.attrs),i,r,n,s,o;for(i in t)e[i]=t[i];let a=new this.constructor(e);for(i in this.eventListeners){r=this.eventListeners[i],n=r.length;for(s=0;s<n;s++)if(o=r[s],o.name.indexOf(ul)<0){if(!a.eventListeners[i])a.eventListeners[i]=[];a.eventListeners[i].push(o)}}return a}_toKonvaCanvas(t){t=t||{};let e=this.getClientRect(),i=this.getStage(),r=t.x!==void 0?t.x:Math.floor(e.x),n=t.y!==void 0?t.y:Math.floor(e.y),s=t.pixelRatio||1,o=new Ye.SceneCanvas({width:t.width||Math.ceil(e.width)||(i?i.width():0),height:t.height||Math.ceil(e.height)||(i?i.height():0),pixelRatio:s}),a=o.getContext(),h=new Ye.SceneCanvas({width:o.width/o.pixelRatio+Math.abs(r),height:o.height/o.pixelRatio+Math.abs(n),pixelRatio:o.pixelRatio});if(t.imageSmoothingEnabled===!1)a._context.imageSmoothingEnabled=!1;if(a.save(),r||n)a.translate(-1*r,-1*n);return this.drawScene(o,void 0,h),a.restore(),o}toCanvas(t){return this._toKonvaCanvas(t)._canvas}toDataURL(t){t=t||{};let e=t.mimeType||null,i=t.quality||null,r=this._toKonvaCanvas(t).toDataURL(e,i);if(t.callback)t.callback(r);return r}toImage(t){return new Promise((e,i)=>{try{let r=t===null||t===void 0?void 0:t.callback;if(r)delete t.callback;B.Util._urlToImage(this.toDataURL(t),function(n){e(n),r===null||r===void 0||r(n)})}catch(r){i(r)}})}toBlob(t){return new Promise((e,i)=>{try{let r=t===null||t===void 0?void 0:t.callback;if(r)delete t.callback;this.toCanvas(t).toBlob((n)=>{e(n),r===null||r===void 0||r(n)},t===null||t===void 0?void 0:t.mimeType,t===null||t===void 0?void 0:t.quality)}catch(r){i(r)}})}setSize(t){return this.width(t.width),this.height(t.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){if(this.attrs.dragDistance!==void 0)return this.attrs.dragDistance;else if(this.parent)return this.parent.getDragDistance();else return oe.Konva.dragDistance}_off(t,e,i){let r=this.eventListeners[t],n,s,o;for(n=0;n<r.length;n++)if(s=r[n].name,o=r[n].handler,(s!=="konva"||e==="konva")&&(!e||s===e)&&(!i||i===o)){if(r.splice(n,1),r.length===0){delete this.eventListeners[t];break}n--}}_fireChangeEvent(t,e,i){this._fire(t+cl,{oldVal:e,newVal:i})}addName(t){if(!this.hasName(t)){let e=this.name(),i=e?e+" "+t:t;this.name(i)}return this}hasName(t){if(!t)return!1;let e=this.name();if(!e)return!1;return(e||"").split(/\s/g).indexOf(t)!==-1}removeName(t){let e=(this.name()||"").split(/\s/g),i=e.indexOf(t);if(i!==-1)e.splice(i,1),this.name(e.join(" "));return this}setAttr(t,e){let i=this[ys+B.Util._capitalize(t)];if(B.Util._isFunction(i))i.call(this,e);else this._setAttr(t,e);return this}_requestDraw(){if(oe.Konva.autoDrawEnabled){let t=this.getLayer()||this.getStage();t===null||t===void 0||t.batchDraw()}}_setAttr(t,e){let i=this.attrs[t];if(i===e&&!B.Util.isObject(e))return;if(e===void 0||e===null)delete this.attrs[t];else this.attrs[t]=e;if(this._shouldFireChangeEvents)this._fireChangeEvent(t,i,e);this._requestDraw()}_setComponentAttr(t,e,i){let r;if(i!==void 0){if(r=this.attrs[t],!r)this.attrs[t]=this.getAttr(t);this.attrs[t][e]=i,this._fireChangeEvent(t,r,i)}}_fireAndBubble(t,e,i){if(e&&this.nodeType===Cs)e.target=this;if(!((t===ms||t===_s)&&(i&&(this===i||this.isAncestorOf&&this.isAncestorOf(i))||this.nodeType==="Stage"&&!i))){this._fire(t,e);let n=(t===ms||t===_s)&&i&&i.isAncestorOf&&i.isAncestorOf(this)&&!i.isAncestorOf(this.parent);if((e&&!e.cancelBubble||!e)&&this.parent&&this.parent.isListening()&&!n)if(i&&i.parent)this._fireAndBubble.call(this.parent,t,e,i);else this._fireAndBubble.call(this.parent,t,e)}}_getProtoListeners(t){var e,i,r;let n=(e=this._cache.get(bi))!==null&&e!==void 0?e:{},s=n===null||n===void 0?void 0:n[t];if(s===void 0){s=[];let o=Object.getPrototypeOf(this);while(o){let a=(r=(i=o.eventListeners)===null||i===void 0?void 0:i[t])!==null&&r!==void 0?r:[];s.push(...a),o=Object.getPrototypeOf(o)}n[t]=s,this._cache.set(bi,n)}return s}_fire(t,e){e=e||{},e.currentTarget=this,e.type=t;let i=this._getProtoListeners(t);if(i)for(var r=0;r<i.length;r++)i[r].handler.call(this,e);let n=this.eventListeners[t];if(n)for(var r=0;r<n.length;r++)n[r].handler.call(this,e)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(t){let e=t?t.pointerId:void 0,i=this.getStage(),r=this.getAbsolutePosition();if(!i)return;let n=i._getPointerById(e)||i._changedPointerPositions[0]||r;kt.DD._dragElements.set(this._id,{node:this,startPointerPos:n,offset:{x:n.x-r.x,y:n.y-r.y},dragStatus:"ready",pointerId:e})}startDrag(t,e=!0){if(!kt.DD._dragElements.has(this._id))this._createDragElement(t);let i=kt.DD._dragElements.get(this._id);i.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:t&&t.evt},e)}_setDragPosition(t,e){let i=this.getStage()._getPointerById(e.pointerId);if(!i)return;let r={x:i.x-e.offset.x,y:i.y-e.offset.y},n=this.dragBoundFunc();if(n!==void 0){let s=n.call(this,r,t);if(!s)B.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.");else r=s}if(!this._lastPos||this._lastPos.x!==r.x||this._lastPos.y!==r.y)this.setAbsolutePosition(r),this._requestDraw();this._lastPos=r}stopDrag(t){let e=kt.DD._dragElements.get(this._id);if(e)e.dragStatus="stopped";kt.DD._endDragBefore(t),kt.DD._endDragAfter(t)}setDraggable(t){this._setAttr("draggable",t),this._dragChange()}isDragging(){let t=kt.DD._dragElements.get(this._id);return t?t.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(t){if(!(t.evt.button===void 0||oe.Konva.dragButtons.indexOf(t.evt.button)>=0))return;if(this.isDragging())return;let r=!1;if(kt.DD._dragElements.forEach((n)=>{if(this.isAncestorOf(n.node))r=!0}),!r)this._createDragElement(t)})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{if(this._dragCleanup(),!this.getStage())return;let e=kt.DD._dragElements.get(this._id),i=e&&e.dragStatus==="dragging",r=e&&e.dragStatus==="ready";if(i)this.stopDrag();else if(r)kt.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(t={x:0,y:0}){let e=this.getStage();if(!e)return!1;let i={x:-t.x,y:-t.y,width:e.width()+2*t.x,height:e.height()+2*t.y};return B.Util.haveIntersection(i,this.getClientRect())}static create(t,e){if(B.Util._isString(t))t=JSON.parse(t);return this._createNode(t,e)}static _createNode(t,e){let i=D.prototype.getClassName.call(t),r=t.children,n,s,o;if(e)t.attrs.container=e;if(!oe.Konva[i])B.Util.warn('Can not find a node with class name "'+i+'". Fallback to "Shape".'),i="Shape";if(n=new oe.Konva[i](t.attrs),r){s=r.length;for(o=0;o<s;o++)n.add(D._createNode(r[o]))}return n}}xs.Node=D;D.prototype.nodeType="Node";D.prototype._attrsAffectingSize=[];D.prototype.eventListeners={};D.prototype.on.call(D.prototype,fl,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(ae),this._clearSelfAndDescendantCache(Qt)});D.prototype.on.call(D.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(Sr)});D.prototype.on.call(D.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(vr)});D.prototype.on.call(D.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(vi)});var K=je.Factory.addGetterSetter;K(D,"zIndex");K(D,"absolutePosition");K(D,"position");K(D,"x",0,st.getNumberValidator());K(D,"y",0,st.getNumberValidator());K(D,"globalCompositeOperation","source-over",st.getStringValidator());K(D,"opacity",1,st.getNumberValidator());K(D,"name","",st.getStringValidator());K(D,"id","",st.getStringValidator());K(D,"rotation",0,st.getNumberValidator());je.Factory.addComponentsGetterSetter(D,"scale",["x","y"]);K(D,"scaleX",1,st.getNumberValidator());K(D,"scaleY",1,st.getNumberValidator());je.Factory.addComponentsGetterSetter(D,"skew",["x","y"]);K(D,"skewX",0,st.getNumberValidator());K(D,"skewY",0,st.getNumberValidator());je.Factory.addComponentsGetterSetter(D,"offset",["x","y"]);K(D,"offsetX",0,st.getNumberValidator());K(D,"offsetY",0,st.getNumberValidator());K(D,"dragDistance",void 0,st.getNumberValidator());K(D,"width",0,st.getNumberValidator());K(D,"height",0,st.getNumberValidator());K(D,"listening",!0,st.getBooleanValidator());K(D,"preventDefault",!0,st.getBooleanValidator());K(D,"filters",void 0,function(t){return this._filterUpToDate=!1,t});K(D,"visible",!0,st.getBooleanValidator());K(D,"transformsEnabled","all",st.getStringValidator());K(D,"size");K(D,"dragBoundFunc");K(D,"draggable",!1,st.getBooleanValidator());je.Factory.backCompat(D,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"})});var Xe=N((vs)=>{Object.defineProperty(vs,"__esModule",{value:!0});vs.Container=void 0;var Ne=G(),Mr=nt(),Mi=R();class he extends Mr.Node{constructor(){super(...arguments);this.children=[]}getChildren(t){if(!t)return this.children||[];let e=this.children||[],i=[];return e.forEach(function(r){if(t(r))i.push(r)}),i}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach((t)=>{t.parent=null,t.index=0,t.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach((t)=>{t.parent=null,t.index=0,t.destroy()}),this.children=[],this._requestDraw(),this}add(...t){if(t.length===0)return this;if(t.length>1){for(let i=0;i<t.length;i++)this.add(t[i]);return this}let e=t[0];if(e.getParent())return e.moveTo(this),this;return this._validateAdd(e),e.index=this.getChildren().length,e.parent=this,e._clearCaches(),this.getChildren().push(e),this._fire("add",{child:e}),this._requestDraw(),this}destroy(){if(this.hasChildren())this.destroyChildren();return super.destroy(),this}find(t){return this._generalFind(t,!1)}findOne(t){let e=this._generalFind(t,!0);return e.length>0?e[0]:void 0}_generalFind(t,e){let i=[];return this._descendants((r)=>{let n=r._isMatch(t);if(n)i.push(r);if(n&&e)return!0;return!1}),i}_descendants(t){let e=!1,i=this.getChildren();for(let r of i){if(e=t(r),e)return!0;if(!r.hasChildren())continue;if(e=r._descendants(t),e)return!0}return!1}toObject(){let t=Mr.Node.prototype.toObject.call(this);return t.children=[],this.getChildren().forEach((e)=>{t.children.push(e.toObject())}),t}isAncestorOf(t){let e=t.getParent();while(e){if(e._id===this._id)return!0;e=e.getParent()}return!1}clone(t){let e=Mr.Node.prototype.clone.call(this,t);return this.getChildren().forEach(function(i){e.add(i.clone())}),e}getAllIntersections(t){let e=[];return this.find("Shape").forEach((i)=>{if(i.isVisible()&&i.intersects(t))e.push(i)}),e}_clearSelfAndDescendantCache(t){var e;if(super._clearSelfAndDescendantCache(t),this.isCached())return;(e=this.children)===null||e===void 0||e.forEach(function(i){i._clearSelfAndDescendantCache(t)})}_setChildrenIndices(){var t;(t=this.children)===null||t===void 0||t.forEach(function(e,i){e.index=i}),this._requestDraw()}drawScene(t,e,i){let r=this.getLayer(),n=t||r&&r.getCanvas(),s=n&&n.getContext(),o=this._getCanvasCache(),a=o&&o.scene,h=n&&n.isCache;if(!this.isVisible()&&!h)return this;if(a){s.save();let l=this.getAbsoluteTransform(e).getMatrix();s.transform(l[0],l[1],l[2],l[3],l[4],l[5]),this._drawCachedSceneCanvas(s),s.restore()}else this._drawChildren("drawScene",n,e,i);return this}drawHit(t,e){if(!this.shouldDrawHit(e))return this;let i=this.getLayer(),r=t||i&&i.hitCanvas,n=r&&r.getContext(),s=this._getCanvasCache();if(s&&s.hit){n.save();let a=this.getAbsoluteTransform(e).getMatrix();n.transform(a[0],a[1],a[2],a[3],a[4],a[5]),this._drawCachedHitCanvas(n),n.restore()}else this._drawChildren("drawHit",r,e);return this}_drawChildren(t,e,i,r){var n;let s=e&&e.getContext(),o=this.clipWidth(),a=this.clipHeight(),h=this.clipFunc(),l=typeof o==="number"&&typeof a==="number"||h,c=i===this;if(l){s.save();let u=this.getAbsoluteTransform(i),g=u.getMatrix();s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),s.beginPath();let p;if(h)p=h.call(this,s,this);else{let m=this.clipX(),f=this.clipY();s.rect(m||0,f||0,o,a)}s.clip.apply(s,p),g=u.copy().invert().getMatrix(),s.transform(g[0],g[1],g[2],g[3],g[4],g[5])}let d=!c&&this.globalCompositeOperation()!=="source-over"&&t==="drawScene";if(d)s.save(),s._applyGlobalCompositeOperation(this);if((n=this.children)===null||n===void 0||n.forEach(function(u){u[t](e,i,r)}),d)s.restore();if(l)s.restore()}getClientRect(t={}){var e;let{skipTransform:i,relativeTo:r}=t,n,s,o,a,h={x:1/0,y:1/0,width:0,height:0},l=this;(e=this.children)===null||e===void 0||e.forEach(function(u){if(!u.visible())return;let g=u.getClientRect({relativeTo:l,skipShadow:t.skipShadow,skipStroke:t.skipStroke});if(g.width===0&&g.height===0)return;if(n===void 0)n=g.x,s=g.y,o=g.x+g.width,a=g.y+g.height;else n=Math.min(n,g.x),s=Math.min(s,g.y),o=Math.max(o,g.x+g.width),a=Math.max(a,g.y+g.height)});let c=this.find("Shape"),d=!1;for(let u=0;u<c.length;u++)if(c[u]._isVisible(this)){d=!0;break}if(d&&n!==void 0)h={x:n,y:s,width:o-n,height:a-s};else h={x:0,y:0,width:0,height:0};if(!i)return this._transformedRect(h,r);return h}}vs.Container=he;Ne.Factory.addComponentsGetterSetter(he,"clip",["x","y","width","height"]);Ne.Factory.addGetterSetter(he,"clipX",void 0,Mi.getNumberValidator());Ne.Factory.addGetterSetter(he,"clipY",void 0,Mi.getNumberValidator());Ne.Factory.addGetterSetter(he,"clipWidth",void 0,Mi.getNumberValidator());Ne.Factory.addGetterSetter(he,"clipHeight",void 0,Mi.getNumberValidator());Ne.Factory.addGetterSetter(he,"clipFunc")});var Lr=N((Ls)=>{Object.defineProperty(Ls,"__esModule",{value:!0});Ls.getCapturedShape=_l;Ls.createEvent=kr;Ls.hasPointerCapture=yl;Ls.setPointerCapture=Cl;Ls.releaseCapture=ks;var ml=I(),Ke=new Map,Ms=ml.Konva._global.PointerEvent!==void 0;function _l(t){return Ke.get(t)}function kr(t){return{evt:t,pointerId:t.pointerId}}function yl(t,e){return Ke.get(t)===e}function Cl(t,e){if(ks(t),!e.getStage())return;if(Ke.set(t,e),Ms)e._fire("gotpointercapture",kr(new PointerEvent("gotpointercapture")))}function ks(t,e){let i=Ke.get(t);if(!i)return;let r=i.getStage();if(r&&r.content);if(Ke.delete(t),Ms)i._fire("lostpointercapture",kr(new PointerEvent("lostpointercapture")))}});var Vs=N((qs)=>{Object.defineProperty(qs,"__esModule",{value:!0});qs.Stage=qs.stages=void 0;var qt=J(),Ml=G(),Es=Xe(),ot=I(),Er=We(),Nr=xi(),kl=I(),Jt=Lr(),Ll="Stage",El="string",Ns="px",Nl="mouseout",Fs="mouseleave",Ps="mouseover",Ds="mouseenter",Ts="mousemove",Is="mousedown",Gs="mouseup",Ze="pointermove",Qe="pointerdown",Fe="pointerup",Je="pointercancel",Al="lostpointercapture",ki="pointerout",Li="pointerleave",Ei="pointerover",Ni="pointerenter",Fr="contextmenu",Rs="touchstart",Os="touchend",Bs="touchmove",Us="touchcancel",Pr="wheel",Fl=5,Pl=[[Ds,"_pointerenter"],[Is,"_pointerdown"],[Ts,"_pointermove"],[Gs,"_pointerup"],[Fs,"_pointerleave"],[Rs,"_pointerdown"],[Bs,"_pointermove"],[Os,"_pointerup"],[Us,"_pointercancel"],[Ps,"_pointerover"],[Pr,"_wheel"],[Fr,"_contextmenu"],[Qe,"_pointerdown"],[Ze,"_pointermove"],[Fe,"_pointerup"],[Je,"_pointercancel"],[Al,"_lostpointercapture"]],Ar={mouse:{[ki]:Nl,[Li]:Fs,[Ei]:Ps,[Ni]:Ds,[Ze]:Ts,[Qe]:Is,[Fe]:Gs,[Je]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[ki]:"touchout",[Li]:"touchleave",[Ei]:"touchover",[Ni]:"touchenter",[Ze]:Bs,[Qe]:Rs,[Fe]:Os,[Je]:Us,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[ki]:ki,[Li]:Li,[Ei]:Ei,[Ni]:Ni,[Ze]:Ze,[Qe]:Qe,[Fe]:Fe,[Je]:Je,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},$e=(t)=>{if(t.indexOf("pointer")>=0)return"pointer";if(t.indexOf("touch")>=0)return"touch";return"mouse"},Ae=(t)=>{let e=$e(t);if(e==="pointer")return ot.Konva.pointerEventsEnabled&&Ar.pointer;if(e==="touch")return Ar.touch;if(e==="mouse")return Ar.mouse};function As(t={}){if(t.clipFunc||t.clipWidth||t.clipHeight)qt.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups.");return t}var Dl="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";qs.stages=[];class ei extends Es.Container{constructor(t){super(As(t));this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),qs.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{As(this.attrs)}),this._checkVisibility()}_validateAdd(t){let e=t.getType()==="Layer",i=t.getType()==="FastLayer";if(!(e||i))qt.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;let t=this.visible()?"":"none";this.content.style.display=t}setContainer(t){if(typeof t===El){if(t.charAt(0)==="."){let i=t.slice(1);t=document.getElementsByClassName(i)[0]}else{var e;if(t.charAt(0)!=="#")e=t;else e=t.slice(1);t=document.getElementById(e)}if(!t)throw"Can not find container in document with id "+e}if(this._setAttr("container",t),this.content){if(this.content.parentElement)this.content.parentElement.removeChild(this.content);t.appendChild(this.content)}return this}shouldDrawHit(){return!0}clear(){let t=this.children,e=t.length;for(let i=0;i<e;i++)t[i].clear();return this}clone(t){if(!t)t={};return t.container=typeof document!=="undefined"&&document.createElement("div"),Es.Container.prototype.clone.call(this,t)}destroy(){super.destroy();let t=this.content;if(t&&qt.Util._isInDocument(t))this.container().removeChild(t);let e=qs.stages.indexOf(this);if(e>-1)qs.stages.splice(e,1);return qt.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){let t=this._pointerPositions[0]||this._changedPointerPositions[0];if(!t)return qt.Util.warn(Dl),null;return{x:t.x,y:t.y}}_getPointerById(t){return this._pointerPositions.find((e)=>e.id===t)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(t){t=t||{},t.x=t.x||0,t.y=t.y||0,t.width=t.width||this.width(),t.height=t.height||this.height();let e=new Er.SceneCanvas({width:t.width,height:t.height,pixelRatio:t.pixelRatio||1}),i=e.getContext()._context,r=this.children;if(t.x||t.y)i.translate(-1*t.x,-1*t.y);return r.forEach(function(n){if(!n.isVisible())return;let s=n._toKonvaCanvas(t);i.drawImage(s._canvas,t.x,t.y,s.getWidth()/s.getPixelRatio(),s.getHeight()/s.getPixelRatio())}),e}getIntersection(t){if(!t)return null;let e=this.children,i=e.length,r=i-1;for(let n=r;n>=0;n--){let s=e[n].getIntersection(t);if(s)return s}return null}_resizeDOM(){let t=this.width(),e=this.height();if(this.content)this.content.style.width=t+Ns,this.content.style.height=e+Ns;this.bufferCanvas.setSize(t,e),this.bufferHitCanvas.setSize(t,e),this.children.forEach((i)=>{i.setSize({width:t,height:e}),i.draw()})}add(t,...e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.add(arguments[r]);return this}super.add(t);let i=this.children.length;if(i>Fl)qt.Util.warn("The stage has "+i+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.");if(t.setSize({width:this.width(),height:this.height()}),t.draw(),ot.Konva.isBrowser)this.content.appendChild(t.canvas._canvas);return this}getParent(){return null}getLayer(){return null}hasPointerCapture(t){return Jt.hasPointerCapture(t,this)}setPointerCapture(t){Jt.setPointerCapture(t,this)}releaseCapture(t){Jt.releaseCapture(t,this)}getLayers(){return this.children}_bindContentEvents(){if(!ot.Konva.isBrowser)return;Pl.forEach(([t,e])=>{this.content.addEventListener(t,(i)=>{this[e](i)},{passive:!1})})}_pointerenter(t){this.setPointersPositions(t);let e=Ae(t.type);if(e)this._fire(e.pointerenter,{evt:t,target:this,currentTarget:this})}_pointerover(t){this.setPointersPositions(t);let e=Ae(t.type);if(e)this._fire(e.pointerover,{evt:t,target:this,currentTarget:this})}_getTargetShape(t){let e=this[t+"targetShape"];if(e&&!e.getStage())e=null;return e}_pointerleave(t){let e=Ae(t.type),i=$e(t.type);if(!e)return;this.setPointersPositions(t);let r=this._getTargetShape(i),n=!(ot.Konva.isDragging()||ot.Konva.isTransforming())||ot.Konva.hitOnDragEnabled;if(r&&n)r._fireAndBubble(e.pointerout,{evt:t}),r._fireAndBubble(e.pointerleave,{evt:t}),this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this[i+"targetShape"]=null;else if(n)this._fire(e.pointerleave,{evt:t,target:this,currentTarget:this}),this._fire(e.pointerout,{evt:t,target:this,currentTarget:this});this.pointerPos=null,this._pointerPositions=[]}_pointerdown(t){let e=Ae(t.type),i=$e(t.type);if(!e)return;this.setPointersPositions(t);let r=!1;if(this._changedPointerPositions.forEach((n)=>{let s=this.getIntersection(n);if(Nr.DD.justDragged=!1,ot.Konva["_"+i+"ListenClick"]=!0,!s||!s.isListening()){this[i+"ClickStartShape"]=void 0;return}if(ot.Konva.capturePointerEventsEnabled)s.setPointerCapture(n.id);this[i+"ClickStartShape"]=s,s._fireAndBubble(e.pointerdown,{evt:t,pointerId:n.id}),r=!0;let o=t.type.indexOf("touch")>=0;if(s.preventDefault()&&t.cancelable&&o)t.preventDefault()}),!r)this._fire(e.pointerdown,{evt:t,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}_pointermove(t){let e=Ae(t.type),i=$e(t.type);if(!e)return;if(ot.Konva.isDragging()&&Nr.DD.node.preventDefault()&&t.cancelable)t.preventDefault();if(this.setPointersPositions(t),!(!(ot.Konva.isDragging()||ot.Konva.isTransforming())||ot.Konva.hitOnDragEnabled))return;let n={},s=!1,o=this._getTargetShape(i);if(this._changedPointerPositions.forEach((a)=>{let h=Jt.getCapturedShape(a.id)||this.getIntersection(a),l=a.id,c={evt:t,pointerId:l},d=o!==h;if(d&&o)o._fireAndBubble(e.pointerout,{...c},h),o._fireAndBubble(e.pointerleave,{...c},h);if(h){if(n[h._id])return;n[h._id]=!0}if(h&&h.isListening()){if(s=!0,d)h._fireAndBubble(e.pointerover,{...c},o),h._fireAndBubble(e.pointerenter,{...c},o),this[i+"targetShape"]=h;h._fireAndBubble(e.pointermove,{...c})}else if(o)this._fire(e.pointerover,{evt:t,target:this,currentTarget:this,pointerId:l}),this[i+"targetShape"]=null}),!s)this._fire(e.pointermove,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(t){let e=Ae(t.type),i=$e(t.type);if(!e)return;this.setPointersPositions(t);let r=this[i+"ClickStartShape"],n=this[i+"ClickEndShape"],s={},o=!1;if(this._changedPointerPositions.forEach((a)=>{let h=Jt.getCapturedShape(a.id)||this.getIntersection(a);if(h){if(h.releaseCapture(a.id),s[h._id])return;s[h._id]=!0}let l=a.id,c={evt:t,pointerId:l},d=!1;if(ot.Konva["_"+i+"InDblClickWindow"])d=!0,clearTimeout(this[i+"DblTimeout"]);else if(!Nr.DD.justDragged)ot.Konva["_"+i+"InDblClickWindow"]=!0,clearTimeout(this[i+"DblTimeout"]);if(this[i+"DblTimeout"]=setTimeout(function(){ot.Konva["_"+i+"InDblClickWindow"]=!1},ot.Konva.dblClickWindow),h&&h.isListening()){if(o=!0,this[i+"ClickEndShape"]=h,h._fireAndBubble(e.pointerup,{...c}),ot.Konva["_"+i+"ListenClick"]&&r&&r===h){if(h._fireAndBubble(e.pointerclick,{...c}),d&&n&&n===h)h._fireAndBubble(e.pointerdblclick,{...c})}}else{if(this[i+"ClickEndShape"]=null,ot.Konva["_"+i+"ListenClick"])this._fire(e.pointerclick,{evt:t,target:this,currentTarget:this,pointerId:l});if(d)this._fire(e.pointerdblclick,{evt:t,target:this,currentTarget:this,pointerId:l})}}),!o)this._fire(e.pointerup,{evt:t,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id});if(ot.Konva["_"+i+"ListenClick"]=!1,t.cancelable&&i!=="touch"&&i!=="pointer")t.preventDefault()}_contextmenu(t){this.setPointersPositions(t);let e=this.getIntersection(this.getPointerPosition());if(e&&e.isListening())e._fireAndBubble(Fr,{evt:t});else this._fire(Fr,{evt:t,target:this,currentTarget:this})}_wheel(t){this.setPointersPositions(t);let e=this.getIntersection(this.getPointerPosition());if(e&&e.isListening())e._fireAndBubble(Pr,{evt:t});else this._fire(Pr,{evt:t,target:this,currentTarget:this})}_pointercancel(t){this.setPointersPositions(t);let e=Jt.getCapturedShape(t.pointerId)||this.getIntersection(this.getPointerPosition());if(e)e._fireAndBubble(Fe,Jt.createEvent(t));Jt.releaseCapture(t.pointerId)}_lostpointercapture(t){Jt.releaseCapture(t.pointerId)}setPointersPositions(t){let e=this._getContentPosition(),i=null,r=null;if(t=t?t:window.event,t.touches!==void 0)this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(t.touches,(n)=>{this._pointerPositions.push({id:n.identifier,x:(n.clientX-e.left)/e.scaleX,y:(n.clientY-e.top)/e.scaleY})}),Array.prototype.forEach.call(t.changedTouches||t.touches,(n)=>{this._changedPointerPositions.push({id:n.identifier,x:(n.clientX-e.left)/e.scaleX,y:(n.clientY-e.top)/e.scaleY})});else i=(t.clientX-e.left)/e.scaleX,r=(t.clientY-e.top)/e.scaleY,this.pointerPos={x:i,y:r},this._pointerPositions=[{x:i,y:r,id:qt.Util._getFirstPointerId(t)}],this._changedPointerPositions=[{x:i,y:r,id:qt.Util._getFirstPointerId(t)}]}_setPointerPosition(t){qt.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(t)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};let t=this.content.getBoundingClientRect();return{top:t.top,left:t.left,scaleX:t.width/this.content.clientWidth||1,scaleY:t.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new Er.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new Er.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!ot.Konva.isBrowser)return;let t=this.container();if(!t)throw"Stage has no container. A container is required.";t.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),t.appendChild(this.content),this._resizeDOM()}cache(){return qt.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(t){t.batchDraw()}),this}}qs.Stage=ei;ei.prototype.nodeType=Ll;kl._registerNode(ei);Ml.Factory.addGetterSetter(ei,"container");if(ot.Konva.isBrowser)document.addEventListener("visibilitychange",()=>{qs.stages.forEach((t)=>{t.batchDraw()})})});var ct=N((Zs)=>{Object.defineProperty(Zs,"__esModule",{value:!0});Zs.Shape=Zs.shapes=void 0;var Tl=I(),zt=J(),E=G(),Ws=nt(),ht=R(),Il=I(),Dr=Lr(),Hs="hasShadow",Ys="shadowRGBA",js="patternImage",Xs="linearGradient",Ks="radialGradient",Ai;function Tr(){if(Ai)return Ai;return Ai=zt.Util.createCanvasElement().getContext("2d"),Ai}Zs.shapes={};function Gl(t){let e=this.attrs.fillRule;if(e)t.fill(e);else t.fill()}function Rl(t){t.stroke()}function Ol(t){let e=this.attrs.fillRule;if(e)t.fill(e);else t.fill()}function Bl(t){t.stroke()}function Ul(){this._clearCache(Hs)}function ql(){this._clearCache(Ys)}function zl(){this._clearCache(js)}function Vl(){this._clearCache(Xs)}function Wl(){this._clearCache(Ks)}class M extends Ws.Node{constructor(t){super(t);let e;while(!0)if(e=zt.Util.getRandomColor(),e&&!(e in Zs.shapes))break;this.colorKey=e,Zs.shapes[e]=this}getContext(){return zt.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return zt.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(Hs,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(js,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){let e=Tr().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(e&&e.setTransform){let i=new zt.Transform;i.translate(this.fillPatternX(),this.fillPatternY()),i.rotate(Tl.Konva.getAngle(this.fillPatternRotation())),i.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),i.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());let r=i.getMatrix(),n=typeof DOMMatrix==="undefined"?{a:r[0],b:r[1],c:r[2],d:r[3],e:r[4],f:r[5]}:new DOMMatrix(r);e.setTransform(n)}return e}}_getLinearGradient(){return this._getCache(Xs,this.__getLinearGradient)}__getLinearGradient(){let t=this.fillLinearGradientColorStops();if(t){let e=Tr(),i=this.fillLinearGradientStartPoint(),r=this.fillLinearGradientEndPoint(),n=e.createLinearGradient(i.x,i.y,r.x,r.y);for(let s=0;s<t.length;s+=2)n.addColorStop(t[s],t[s+1]);return n}}_getRadialGradient(){return this._getCache(Ks,this.__getRadialGradient)}__getRadialGradient(){let t=this.fillRadialGradientColorStops();if(t){let e=Tr(),i=this.fillRadialGradientStartPoint(),r=this.fillRadialGradientEndPoint(),n=e.createRadialGradient(i.x,i.y,this.fillRadialGradientStartRadius(),r.x,r.y,this.fillRadialGradientEndRadius());for(let s=0;s<t.length;s+=2)n.addColorStop(t[s],t[s+1]);return n}}getShadowRGBA(){return this._getCache(Ys,this._getShadowRGBA)}_getShadowRGBA(){if(!this.hasShadow())return;let t=zt.Util.colorToRGBA(this.shadowColor());if(t)return"rgba("+t.r+","+t.g+","+t.b+","+t.a*(this.shadowOpacity()||1)+")"}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>{return this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())})}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>{return this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops())})}hasHitStroke(){let t=this.hitStrokeWidth();if(t==="auto")return this.hasStroke();return this.strokeEnabled()&&!!t}intersects(t){let e=this.getStage();if(!e)return!1;let i=e.bufferHitCanvas;return i.getContext().clear(),this.drawHit(i,void 0,!0),i.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0}destroy(){return Ws.Node.prototype.destroy.call(this),delete Zs.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(t){var e;if(!((e=this.attrs.perfectDrawEnabled)!==null&&e!==void 0?e:!0))return!1;let r=t||this.hasFill(),n=this.hasStroke(),s=this.getAbsoluteOpacity()!==1;if(r&&n&&s)return!0;let o=this.hasShadow(),a=this.shadowForStrokeEnabled();if(r&&n&&o&&a)return!0;return!1}setStrokeHitEnabled(t){if(zt.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),t)this.hitStrokeWidth("auto");else this.hitStrokeWidth(0)}getStrokeHitEnabled(){if(this.hitStrokeWidth()===0)return!1;else return!0}getSelfRect(){let t=this.size();return{x:this._centroid?-t.width/2:0,y:this._centroid?-t.height/2:0,width:t.width,height:t.height}}getClientRect(t={}){let e=!1,i=this.getParent();while(i){if(i.isCached()){e=!0;break}i=i.getParent()}let r=t.skipTransform,n=t.relativeTo||e&&this.getStage()||void 0,s=this.getSelfRect(),a=!t.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,h=s.width+a,l=s.height+a,c=!t.skipShadow&&this.hasShadow(),d=c?this.shadowOffsetX():0,u=c?this.shadowOffsetY():0,g=h+Math.abs(d),p=l+Math.abs(u),m=c&&this.shadowBlur()||0,f=g+m*2,_=p+m*2,y={width:f,height:_,x:-(a/2+m)+Math.min(d,0)+s.x,y:-(a/2+m)+Math.min(u,0)+s.y};if(!r)return this._transformedRect(y,n);return y}drawScene(t,e,i){let r=this.getLayer(),n=t||r.getCanvas(),s=n.getContext(),o=this._getCanvasCache(),a=this.getSceneFunc(),h=this.hasShadow(),l,c,d=n.isCache,u=e===this;if(!this.isVisible()&&!u)return this;if(o){s.save();let p=this.getAbsoluteTransform(e).getMatrix();return s.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedSceneCanvas(s),s.restore(),this}if(!a)return this;if(s.save(),this._useBufferCanvas()&&!d){l=this.getStage();let p=i||l.bufferCanvas;c=p.getContext(),c.clear(),c.save(),c._applyLineJoin(this);var g=this.getAbsoluteTransform(e).getMatrix();c.transform(g[0],g[1],g[2],g[3],g[4],g[5]),a.call(this,c,this),c.restore();let m=p.pixelRatio;if(h)s._applyShadow(this);s._applyOpacity(this),s._applyGlobalCompositeOperation(this),s.drawImage(p._canvas,0,0,p.width/m,p.height/m)}else{if(s._applyLineJoin(this),!u){var g=this.getAbsoluteTransform(e).getMatrix();s.transform(g[0],g[1],g[2],g[3],g[4],g[5]),s._applyOpacity(this),s._applyGlobalCompositeOperation(this)}if(h)s._applyShadow(this);a.call(this,s,this)}return s.restore(),this}drawHit(t,e,i=!1){if(!this.shouldDrawHit(e,i))return this;let r=this.getLayer(),n=t||r.hitCanvas,s=n&&n.getContext(),o=this.hitFunc()||this.sceneFunc(),a=this._getCanvasCache(),h=a&&a.hit;if(!this.colorKey)zt.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()");if(h){s.save();let c=this.getAbsoluteTransform(e).getMatrix();return s.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this._drawCachedHitCanvas(s),s.restore(),this}if(!o)return this;if(s.save(),s._applyLineJoin(this),this!==e){let c=this.getAbsoluteTransform(e).getMatrix();s.transform(c[0],c[1],c[2],c[3],c[4],c[5])}return o.call(this,s,this),s.restore(),this}drawHitFromCache(t=0){let e=this._getCanvasCache(),i=this._getCachedSceneCanvas(),r=e.hit,n=r.getContext(),s=r.getWidth(),o=r.getHeight();n.clear(),n.drawImage(i._canvas,0,0,s,o);try{let a=n.getImageData(0,0,s,o),h=a.data,l=h.length,c=zt.Util._hexToRgb(this.colorKey);for(let d=0;d<l;d+=4)if(h[d+3]>t)h[d]=c.r,h[d+1]=c.g,h[d+2]=c.b,h[d+3]=255;else h[d+3]=0;n.putImageData(a,0,0)}catch(a){zt.Util.error("Unable to draw hit graph from cached scene canvas. "+a.message)}return this}hasPointerCapture(t){return Dr.hasPointerCapture(t,this)}setPointerCapture(t){Dr.setPointerCapture(t,this)}releaseCapture(t){Dr.releaseCapture(t,this)}}Zs.Shape=M;M.prototype._fillFunc=Gl;M.prototype._strokeFunc=Rl;M.prototype._fillFuncHit=Ol;M.prototype._strokeFuncHit=Bl;M.prototype._centroid=!1;M.prototype.nodeType="Shape";Il._registerNode(M);M.prototype.eventListeners={};M.prototype.on.call(M.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",Ul);M.prototype.on.call(M.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",ql);M.prototype.on.call(M.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",zl);M.prototype.on.call(M.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",Vl);M.prototype.on.call(M.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",Wl);E.Factory.addGetterSetter(M,"stroke",void 0,ht.getStringOrGradientValidator());E.Factory.addGetterSetter(M,"strokeWidth",2,ht.getNumberValidator());E.Factory.addGetterSetter(M,"fillAfterStrokeEnabled",!1);E.Factory.addGetterSetter(M,"hitStrokeWidth","auto",ht.getNumberOrAutoValidator());E.Factory.addGetterSetter(M,"strokeHitEnabled",!0,ht.getBooleanValidator());E.Factory.addGetterSetter(M,"perfectDrawEnabled",!0,ht.getBooleanValidator());E.Factory.addGetterSetter(M,"shadowForStrokeEnabled",!0,ht.getBooleanValidator());E.Factory.addGetterSetter(M,"lineJoin");E.Factory.addGetterSetter(M,"lineCap");E.Factory.addGetterSetter(M,"sceneFunc");E.Factory.addGetterSetter(M,"hitFunc");E.Factory.addGetterSetter(M,"dash");E.Factory.addGetterSetter(M,"dashOffset",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"shadowColor",void 0,ht.getStringValidator());E.Factory.addGetterSetter(M,"shadowBlur",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"shadowOpacity",1,ht.getNumberValidator());E.Factory.addComponentsGetterSetter(M,"shadowOffset",["x","y"]);E.Factory.addGetterSetter(M,"shadowOffsetX",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"shadowOffsetY",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"fillPatternImage");E.Factory.addGetterSetter(M,"fill",void 0,ht.getStringOrGradientValidator());E.Factory.addGetterSetter(M,"fillPatternX",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"fillPatternY",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"fillLinearGradientColorStops");E.Factory.addGetterSetter(M,"strokeLinearGradientColorStops");E.Factory.addGetterSetter(M,"fillRadialGradientStartRadius",0);E.Factory.addGetterSetter(M,"fillRadialGradientEndRadius",0);E.Factory.addGetterSetter(M,"fillRadialGradientColorStops");E.Factory.addGetterSetter(M,"fillPatternRepeat","repeat");E.Factory.addGetterSetter(M,"fillEnabled",!0);E.Factory.addGetterSetter(M,"strokeEnabled",!0);E.Factory.addGetterSetter(M,"shadowEnabled",!0);E.Factory.addGetterSetter(M,"dashEnabled",!0);E.Factory.addGetterSetter(M,"strokeScaleEnabled",!0);E.Factory.addGetterSetter(M,"fillPriority","color");E.Factory.addComponentsGetterSetter(M,"fillPatternOffset",["x","y"]);E.Factory.addGetterSetter(M,"fillPatternOffsetX",0,ht.getNumberValidator());E.Factory.addGetterSetter(M,"fillPatternOffsetY",0,ht.getNumberValidator());E.Factory.addComponentsGetterSetter(M,"fillPatternScale",["x","y"]);E.Factory.addGetterSetter(M,"fillPatternScaleX",1,ht.getNumberValidator());E.Factory.addGetterSetter(M,"fillPatternScaleY",1,ht.getNumberValidator());E.Factory.addComponentsGetterSetter(M,"fillLinearGradientStartPoint",["x","y"]);E.Factory.addComponentsGetterSetter(M,"strokeLinearGradientStartPoint",["x","y"]);E.Factory.addGetterSetter(M,"fillLinearGradientStartPointX",0);E.Factory.addGetterSetter(M,"strokeLinearGradientStartPointX",0);E.Factory.addGetterSetter(M,"fillLinearGradientStartPointY",0);E.Factory.addGetterSetter(M,"strokeLinearGradientStartPointY",0);E.Factory.addComponentsGetterSetter(M,"fillLinearGradientEndPoint",["x","y"]);E.Factory.addComponentsGetterSetter(M,"strokeLinearGradientEndPoint",["x","y"]);E.Factory.addGetterSetter(M,"fillLinearGradientEndPointX",0);E.Factory.addGetterSetter(M,"strokeLinearGradientEndPointX",0);E.Factory.addGetterSetter(M,"fillLinearGradientEndPointY",0);E.Factory.addGetterSetter(M,"strokeLinearGradientEndPointY",0);E.Factory.addComponentsGetterSetter(M,"fillRadialGradientStartPoint",["x","y"]);E.Factory.addGetterSetter(M,"fillRadialGradientStartPointX",0);E.Factory.addGetterSetter(M,"fillRadialGradientStartPointY",0);E.Factory.addComponentsGetterSetter(M,"fillRadialGradientEndPoint",["x","y"]);E.Factory.addGetterSetter(M,"fillRadialGradientEndPointX",0);E.Factory.addGetterSetter(M,"fillRadialGradientEndPointY",0);E.Factory.addGetterSetter(M,"fillPatternRotation",0);E.Factory.addGetterSetter(M,"fillRule",void 0,ht.getStringValidator());E.Factory.backCompat(M,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})});var Rr=N((t1)=>{Object.defineProperty(t1,"__esModule",{value:!0});t1.Layer=void 0;var $t=J(),Ir=Xe(),Pe=nt(),Gr=G(),Js=We(),Hl=R(),Yl=ct(),jl=I(),Xl="#",Kl="beforeDraw",Zl="draw",$s=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],Ql=$s.length;class we extends Ir.Container{constructor(t){super(t);this.canvas=new Js.SceneCanvas,this.hitCanvas=new Js.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(t){return this.getContext().clear(t),this.getHitCanvas().getContext().clear(t),this}setZIndex(t){super.setZIndex(t);let e=this.getStage();if(e&&e.content)if(e.content.removeChild(this.getNativeCanvasElement()),t<e.children.length-1)e.content.insertBefore(this.getNativeCanvasElement(),e.children[t+1].getCanvas()._canvas);else e.content.appendChild(this.getNativeCanvasElement());return this}moveToTop(){Pe.Node.prototype.moveToTop.call(this);let t=this.getStage();if(t&&t.content)t.content.removeChild(this.getNativeCanvasElement()),t.content.appendChild(this.getNativeCanvasElement());return!0}moveUp(){if(!Pe.Node.prototype.moveUp.call(this))return!1;let e=this.getStage();if(!e||!e.content)return!1;if(e.content.removeChild(this.getNativeCanvasElement()),this.index<e.children.length-1)e.content.insertBefore(this.getNativeCanvasElement(),e.children[this.index+1].getCanvas()._canvas);else e.content.appendChild(this.getNativeCanvasElement());return!0}moveDown(){if(Pe.Node.prototype.moveDown.call(this)){let t=this.getStage();if(t){let e=t.children;if(t.content)t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[this.index+1].getCanvas()._canvas)}return!0}return!1}moveToBottom(){if(Pe.Node.prototype.moveToBottom.call(this)){let t=this.getStage();if(t){let e=t.children;if(t.content)t.content.removeChild(this.getNativeCanvasElement()),t.content.insertBefore(this.getNativeCanvasElement(),e[1].getCanvas()._canvas)}return!0}return!1}getLayer(){return this}remove(){let t=this.getNativeCanvasElement();if(Pe.Node.prototype.remove.call(this),t&&t.parentNode&&$t.Util._isInDocument(t))t.parentNode.removeChild(t);return this}getStage(){return this.parent}setSize({width:t,height:e}){return this.canvas.setSize(t,e),this.hitCanvas.setSize(t,e),this._setSmoothEnabled(),this}_validateAdd(t){let e=t.getType();if(e!=="Group"&&e!=="Shape")$t.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(t){return t=t||{},t.width=t.width||this.getWidth(),t.height=t.height||this.getHeight(),t.x=t.x!==void 0?t.x:this.x(),t.y=t.y!==void 0?t.y:this.y(),Pe.Node.prototype._toKonvaCanvas.call(this,t)}_checkVisibility(){if(this.visible())this.canvas._canvas.style.display="block";else this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){$t.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){$t.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){if(!this._waitingForDraw)this._waitingForDraw=!0,$t.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1});return this}getIntersection(t){if(!this.isListening()||!this.isVisible())return null;let e=1,i=!1;while(!0){for(let r=0;r<Ql;r++){let n=$s[r],s=this._getIntersection({x:t.x+n.x*e,y:t.y+n.y*e}),o=s.shape;if(o)return o;if(i=!!s.antialiased,!s.antialiased)break}if(i)e+=1;else return null}}_getIntersection(t){let e=this.hitCanvas.pixelRatio,i=this.hitCanvas.context.getImageData(Math.round(t.x*e),Math.round(t.y*e),1,1).data,r=i[3];if(r===255){let n=$t.Util._rgbToHex(i[0],i[1],i[2]),s=Yl.shapes[Xl+n];if(s)return{shape:s};return{antialiased:!0}}else if(r>0)return{antialiased:!0};return{}}drawScene(t,e){let i=this.getLayer(),r=t||i&&i.getCanvas();if(this._fire(Kl,{node:this}),this.clearBeforeDraw())r.getContext().clear();return Ir.Container.prototype.drawScene.call(this,r,e),this._fire(Zl,{node:this}),this}drawHit(t,e){let i=this.getLayer(),r=t||i&&i.hitCanvas;if(i&&i.clearBeforeDraw())i.getHitCanvas().getContext().clear();return Ir.Container.prototype.drawHit.call(this,r,e),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(t){$t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(t)}getHitGraphEnabled(t){return $t.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!this.parent||!this.parent.content)return;let t=this.parent;if(!!this.hitCanvas._canvas.parentNode)t.content.removeChild(this.hitCanvas._canvas);else t.content.appendChild(this.hitCanvas._canvas)}destroy(){return $t.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}}t1.Layer=we;we.prototype.nodeType="Layer";jl._registerNode(we);Gr.Factory.addGetterSetter(we,"imageSmoothingEnabled",!0);Gr.Factory.addGetterSetter(we,"clearBeforeDraw",!0);Gr.Factory.addGetterSetter(we,"hitGraphEnabled",!0,Hl.getBooleanValidator())});var n1=N((i1)=>{Object.defineProperty(i1,"__esModule",{value:!0});i1.FastLayer=void 0;var Jl=J(),$l=Rr(),t3=I();class Pi extends $l.Layer{constructor(t){super(t);this.listening(!1),Jl.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}}i1.FastLayer=Pi;Pi.prototype.nodeType="FastLayer";t3._registerNode(Pi)});var Ti=N((s1)=>{Object.defineProperty(s1,"__esModule",{value:!0});s1.Group=void 0;var e3=J(),i3=Xe(),r3=I();class Di extends i3.Container{_validateAdd(t){let e=t.getType();if(e!=="Group"&&e!=="Shape")e3.Util.throw("You may only add groups and shapes to groups.")}}s1.Group=Di;Di.prototype.nodeType="Group";r3._registerNode(Di)});var Ii=N((h1)=>{Object.defineProperty(h1,"__esModule",{value:!0});h1.Animation=void 0;var Or=I(),a1=J(),Br=function(){if(Or.glob.performance&&Or.glob.performance.now)return function(){return Or.glob.performance.now()};return function(){return new Date().getTime()}}();class Vt{constructor(t,e){this.id=Vt.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:Br(),frameRate:0},this.func=t,this.setLayers(e)}setLayers(t){let e=[];if(t)e=Array.isArray(t)?t:[t];return this.layers=e,this}getLayers(){return this.layers}addLayer(t){let e=this.layers,i=e.length;for(let r=0;r<i;r++)if(e[r]._id===t._id)return!1;return this.layers.push(t),!0}isRunning(){let e=Vt.animations,i=e.length;for(let r=0;r<i;r++)if(e[r].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=Br(),Vt._addAnimation(this),this}stop(){return Vt._removeAnimation(this),this}_updateFrameObject(t){this.frame.timeDiff=t-this.frame.lastTime,this.frame.lastTime=t,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1000/this.frame.timeDiff}static _addAnimation(t){this.animations.push(t),this._handleAnimation()}static _removeAnimation(t){let e=t.id,i=this.animations,r=i.length;for(let n=0;n<r;n++)if(i[n].id===e){this.animations.splice(n,1);break}}static _runFrames(){let t={},e=this.animations;for(let i=0;i<e.length;i++){let r=e[i],n=r.layers,s=r.func;r._updateFrameObject(Br());let o=n.length,a;if(s)a=s.call(r,r.frame)!==!1;else a=!0;if(!a)continue;for(let h=0;h<o;h++){let l=n[h];if(l._id!==void 0)t[l._id]=l}}for(let i in t){if(!t.hasOwnProperty(i))continue;t[i].batchDraw()}}static _animationLoop(){let t=Vt;if(t.animations.length)t._runFrames(),a1.Util.requestAnimFrame(t._animationLoop);else t.animRunning=!1}static _handleAnimation(){if(!this.animRunning)this.animRunning=!0,a1.Util.requestAnimFrame(this._animationLoop)}}h1.Animation=Vt;Vt.animations=[];Vt.animIdCounter=0;Vt.animRunning=!1});var p1=N((f1)=>{Object.defineProperty(f1,"__esModule",{value:!0});f1.Easings=f1.Tween=void 0;var te=J(),n3=Ii(),s3=nt(),o3=I(),a3={node:1,duration:1,easing:1,onFinish:1,yoyo:1},h3=1,c1=2,d1=3,u1=["fill","stroke","shadowColor"],l3=0;class g1{constructor(t,e,i,r,n,s,o){this.prop=t,this.propFunc=e,this.begin=r,this._pos=r,this.duration=s,this._change=0,this.prevPos=0,this.yoyo=o,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=i,this._change=n-this.begin,this.pause()}fire(t){let e=this[t];if(e)e()}setTime(t){if(t>this.duration)if(this.yoyo)this._time=this.duration,this.reverse();else this.finish();else if(t<0)if(this.yoyo)this._time=0,this.play();else this.reset();else this._time=t,this.update()}getTime(){return this._time}setPosition(t){this.prevPos=this._pos,this.propFunc(t),this._pos=t}getPosition(t){if(t===void 0)t=this._time;return this.func(t,this.begin,this._change,this.duration)}play(){this.state=c1,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=d1,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(t){this.pause(),this._time=t,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){let t=this.getTimer()-this._startTime;if(this.state===c1)this.setTime(t);else if(this.state===d1)this.setTime(this.duration-t)}pause(){this.state=h3,this.fire("onPause")}getTimer(){return new Date().getTime()}}class at{constructor(t){let e=this,i=t.node,r=i._id,n=t.easing||f1.Easings.Linear,s=!!t.yoyo,o,a;if(typeof t.duration==="undefined")o=0.3;else if(t.duration===0)o=0.001;else o=t.duration;this.node=i,this._id=l3++;let h=i.getLayer()||(i instanceof o3.Konva.Stage?i.getLayers():null);if(!h)te.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first.");if(this.anim=new n3.Animation(function(){e.tween.onEnterFrame()},h),this.tween=new g1(a,function(l){e._tweenFunc(l)},n,0,1,o*1000,s),this._addListeners(),!at.attrs[r])at.attrs[r]={};if(!at.attrs[r][this._id])at.attrs[r][this._id]={};if(!at.tweens[r])at.tweens[r]={};for(a in t)if(a3[a]===void 0)this._addAttr(a,t[a]);this.reset(),this.onFinish=t.onFinish,this.onReset=t.onReset,this.onUpdate=t.onUpdate}_addAttr(t,e){let i=this.node,r=i._id,n,s,o,a,h,l=at.tweens[r][t];if(l)delete at.attrs[r][l][t];let c=i.getAttr(t);if(te.Util._isArray(e)){if(n=[],s=Math.max(e.length,c.length),t==="points"&&e.length!==c.length)if(e.length>c.length)a=c,c=te.Util._prepareArrayForTween(c,e,i.closed());else o=e,e=te.Util._prepareArrayForTween(e,c,i.closed());if(t.indexOf("fill")===0)for(let d=0;d<s;d++)if(d%2===0)n.push(e[d]-c[d]);else{let u=te.Util.colorToRGBA(c[d]);h=te.Util.colorToRGBA(e[d]),c[d]=u,n.push({r:h.r-u.r,g:h.g-u.g,b:h.b-u.b,a:h.a-u.a})}else for(let d=0;d<s;d++)n.push(e[d]-c[d])}else if(u1.indexOf(t)!==-1)c=te.Util.colorToRGBA(c),h=te.Util.colorToRGBA(e),n={r:h.r-c.r,g:h.g-c.g,b:h.b-c.b,a:h.a-c.a};else n=e-c;at.attrs[r][this._id][t]={start:c,diff:n,end:e,trueEnd:o,trueStart:a},at.tweens[r][t]=this._id}_tweenFunc(t){let e=this.node,i=at.attrs[e._id][this._id],r,n,s,o,a,h,l,c;for(r in i){if(n=i[r],s=n.start,o=n.diff,c=n.end,te.Util._isArray(s))if(a=[],l=Math.max(s.length,c.length),r.indexOf("fill")===0)for(h=0;h<l;h++)if(h%2===0)a.push((s[h]||0)+o[h]*t);else a.push("rgba("+Math.round(s[h].r+o[h].r*t)+","+Math.round(s[h].g+o[h].g*t)+","+Math.round(s[h].b+o[h].b*t)+","+(s[h].a+o[h].a*t)+")");else for(h=0;h<l;h++)a.push((s[h]||0)+o[h]*t);else if(u1.indexOf(r)!==-1)a="rgba("+Math.round(s.r+o.r*t)+","+Math.round(s.g+o.g*t)+","+Math.round(s.b+o.b*t)+","+(s.a+o.a*t)+")";else a=s+o*t;e.setAttr(r,a)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{let t=this.node,e=at.attrs[t._id][this._id];if(e.points&&e.points.trueEnd)t.setAttr("points",e.points.trueEnd);if(this.onFinish)this.onFinish.call(this)},this.tween.onReset=()=>{let t=this.node,e=at.attrs[t._id][this._id];if(e.points&&e.points.trueStart)t.points(e.points.trueStart);if(this.onReset)this.onReset()},this.tween.onUpdate=()=>{if(this.onUpdate)this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(t){return this.tween.seek(t*1000),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){let t=this.node._id,e=this._id,i=at.tweens[t];this.pause();for(let r in i)delete at.tweens[t][r];delete at.attrs[t][e]}}f1.Tween=at;at.attrs={};at.tweens={};s3.Node.prototype.to=function(t){let e=t.onFinish;t.node=this,t.onFinish=function(){if(this.destroy(),e)e()},new at(t).play()};f1.Easings={BackEaseIn(t,e,i,r){return i*(t/=r)*t*(2.70158*t-1.70158)+e},BackEaseOut(t,e,i,r){return i*((t=t/r-1)*t*(2.70158*t+1.70158)+1)+e},BackEaseInOut(t,e,i,r){let n=1.70158;if((t/=r/2)<1)return i/2*(t*t*(((n*=1.525)+1)*t-n))+e;return i/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+e},ElasticEaseIn(t,e,i,r,n,s){let o=0;if(t===0)return e;if((t/=r)===1)return e+i;if(!s)s=r*0.3;if(!n||n<Math.abs(i))n=i,o=s/4;else o=s/(2*Math.PI)*Math.asin(i/n);return-(n*Math.pow(2,10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/s))+e},ElasticEaseOut(t,e,i,r,n,s){let o=0;if(t===0)return e;if((t/=r)===1)return e+i;if(!s)s=r*0.3;if(!n||n<Math.abs(i))n=i,o=s/4;else o=s/(2*Math.PI)*Math.asin(i/n);return n*Math.pow(2,-10*t)*Math.sin((t*r-o)*(2*Math.PI)/s)+i+e},ElasticEaseInOut(t,e,i,r,n,s){let o=0;if(t===0)return e;if((t/=r/2)===2)return e+i;if(!s)s=r*0.44999999999999996;if(!n||n<Math.abs(i))n=i,o=s/4;else o=s/(2*Math.PI)*Math.asin(i/n);if(t<1)return-0.5*(n*Math.pow(2,10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/s))+e;return n*Math.pow(2,-10*(t-=1))*Math.sin((t*r-o)*(2*Math.PI)/s)*0.5+i+e},BounceEaseOut(t,e,i,r){if((t/=r)<0.36363636363636365)return i*(7.5625*t*t)+e;else if(t<0.7272727272727273)return i*(7.5625*(t-=0.5454545454545454)*t+0.75)+e;else if(t<0.9090909090909091)return i*(7.5625*(t-=0.8181818181818182)*t+0.9375)+e;else return i*(7.5625*(t-=0.9545454545454546)*t+0.984375)+e},BounceEaseIn(t,e,i,r){return i-f1.Easings.BounceEaseOut(r-t,0,i,r)+e},BounceEaseInOut(t,e,i,r){if(t<r/2)return f1.Easings.BounceEaseIn(t*2,0,i,r)*0.5+e;else return f1.Easings.BounceEaseOut(t*2-r,0,i,r)*0.5+i*0.5+e},EaseIn(t,e,i,r){return i*(t/=r)*t+e},EaseOut(t,e,i,r){return-i*(t/=r)*(t-2)+e},EaseInOut(t,e,i,r){if((t/=r/2)<1)return i/2*t*t+e;return-i/2*(--t*(t-2)-1)+e},StrongEaseIn(t,e,i,r){return i*(t/=r)*t*t*t*t+e},StrongEaseOut(t,e,i,r){return i*((t=t/r-1)*t*t*t*t+1)+e},StrongEaseInOut(t,e,i,r){if((t/=r/2)<1)return i/2*t*t*t*t*t+e;return i/2*((t-=2)*t*t*t*t+2)+e},Linear(t,e,i,r){return i*t/r+e}}});var w1=N((C1)=>{Object.defineProperty(C1,"__esModule",{value:!0});C1.Konva=void 0;var d3=I(),Ur=J(),u3=nt(),g3=Xe(),m1=Vs(),f3=Rr(),p3=n1(),m3=Ti(),_3=xi(),_1=ct(),y3=Ii(),y1=p1(),C3=br(),w3=We();C1.Konva=Ur.Util._assign(d3.Konva,{Util:Ur.Util,Transform:Ur.Transform,Node:u3.Node,Container:g3.Container,Stage:m1.Stage,stages:m1.stages,Layer:f3.Layer,FastLayer:p3.FastLayer,Group:m3.Group,DD:_3.DD,Shape:_1.Shape,shapes:_1.shapes,Animation:y3.Animation,Tween:y1.Tween,Easings:y1.Easings,Context:C3.Context,Canvas:w3.Canvas});C1.default=C1.Konva});var S1=N((b1)=>{Object.defineProperty(b1,"__esModule",{value:!0});b1.Arc=void 0;var Gi=G(),b3=ct(),x1=I(),Ri=R(),v3=I();class Wt extends b3.Shape{_sceneFunc(t){let e=x1.Konva.getAngle(this.angle()),i=this.clockwise();t.beginPath(),t.arc(0,0,this.outerRadius(),0,e,i),t.arc(0,0,this.innerRadius(),e,0,!i),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}getSelfRect(){let t=this.innerRadius(),e=this.outerRadius(),i=this.clockwise(),r=x1.Konva.getAngle(i?360-this.angle():this.angle()),n=Math.cos(Math.min(r,Math.PI)),s=1,o=Math.sin(Math.min(Math.max(Math.PI,r),3*Math.PI/2)),a=Math.sin(Math.min(r,Math.PI/2)),h=n*(n>0?t:e),l=1*e,c=o*(o>0?t:e),d=a*(a>0?e:t);return{x:h,y:i?-1*d:c,width:l-h,height:d-c}}}b1.Arc=Wt;Wt.prototype._centroid=!0;Wt.prototype.className="Arc";Wt.prototype._attrsAffectingSize=["innerRadius","outerRadius"];v3._registerNode(Wt);Gi.Factory.addGetterSetter(Wt,"innerRadius",0,Ri.getNumberValidator());Gi.Factory.addGetterSetter(Wt,"outerRadius",0,Ri.getNumberValidator());Gi.Factory.addGetterSetter(Wt,"angle",0,Ri.getNumberValidator());Gi.Factory.addGetterSetter(Wt,"clockwise",!1,Ri.getBooleanValidator())});var Vr=N((L1)=>{Object.defineProperty(L1,"__esModule",{value:!0});L1.Line=void 0;var Oi=G(),S3=I(),M3=ct(),k1=R();function zr(t,e,i,r,n,s,o){let a=Math.sqrt(Math.pow(i-t,2)+Math.pow(r-e,2)),h=Math.sqrt(Math.pow(n-i,2)+Math.pow(s-r,2)),l=o*a/(a+h),c=o*h/(a+h),d=i-l*(n-t),u=r-l*(s-e),g=i+c*(n-t),p=r+c*(s-e);return[d,u,g,p]}function M1(t,e){let i=t.length,r=[];for(let n=2;n<i-2;n+=2){let s=zr(t[n-2],t[n-1],t[n],t[n+1],t[n+2],t[n+3],e);if(isNaN(s[0]))continue;r.push(s[0]),r.push(s[1]),r.push(t[n]),r.push(t[n+1]),r.push(s[2]),r.push(s[3])}return r}class ee extends M3.Shape{constructor(t){super(t);this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(t){let e=this.points(),i=e.length,r=this.tension(),n=this.closed(),s=this.bezier(),o,a,h;if(!i)return;if(t.beginPath(),t.moveTo(e[0],e[1]),r!==0&&i>4){if(o=this.getTensionPoints(),a=o.length,h=n?0:4,!n)t.quadraticCurveTo(o[0],o[1],o[2],o[3]);while(h<a-2)t.bezierCurveTo(o[h++],o[h++],o[h++],o[h++],o[h++],o[h++]);if(!n)t.quadraticCurveTo(o[a-2],o[a-1],e[i-2],e[i-1])}else if(s){h=2;while(h<i)t.bezierCurveTo(e[h++],e[h++],e[h++],e[h++],e[h++],e[h++])}else for(h=2;h<i;h+=2)t.lineTo(e[h],e[h+1]);if(n)t.closePath(),t.fillStrokeShape(this);else t.strokeShape(this)}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){if(this.closed())return this._getTensionPointsClosed();else return M1(this.points(),this.tension())}_getTensionPointsClosed(){let t=this.points(),e=t.length,i=this.tension(),r=zr(t[e-2],t[e-1],t[0],t[1],t[2],t[3],i),n=zr(t[e-4],t[e-3],t[e-2],t[e-1],t[0],t[1],i),s=M1(t,i);return[r[2],r[3]].concat(s).concat([n[0],n[1],t[e-2],t[e-1],n[2],n[3],r[0],r[1],t[0],t[1]])}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){let t=this.points();if(t.length<4)return{x:t[0]||0,y:t[1]||0,width:0,height:0};if(this.tension()!==0)t=[t[0],t[1],...this._getTensionPoints(),t[t.length-2],t[t.length-1]];else t=this.points();let e=t[0],i=t[0],r=t[1],n=t[1],s,o;for(let a=0;a<t.length/2;a++)s=t[a*2],o=t[a*2+1],e=Math.min(e,s),i=Math.max(i,s),r=Math.min(r,o),n=Math.max(n,o);return{x:e,y:r,width:i-e,height:n-r}}}L1.Line=ee;ee.prototype.className="Line";ee.prototype._attrsAffectingSize=["points","bezier","tension"];S3._registerNode(ee);Oi.Factory.addGetterSetter(ee,"closed",!1);Oi.Factory.addGetterSetter(ee,"bezier",!1);Oi.Factory.addGetterSetter(ee,"tension",0,k1.getNumberValidator());Oi.Factory.addGetterSetter(ee,"points",[],k1.getNumberArrayValidator())});var T1=N((N1)=>{Object.defineProperty(N1,"__esModule",{value:!0});N1.t2length=N1.getQuadraticArcLength=N1.getCubicArcLength=N1.binomialCoefficients=N1.cValues=N1.tValues=void 0;N1.tValues=[[],[],[-0.5773502691896257,0.5773502691896257],[0,-0.7745966692414834,0.7745966692414834],[-0.33998104358485626,0.33998104358485626,-0.8611363115940526,0.8611363115940526],[0,-0.5384693101056831,0.5384693101056831,-0.906179845938664,0.906179845938664],[0.6612093864662645,-0.6612093864662645,-0.2386191860831969,0.2386191860831969,-0.932469514203152,0.932469514203152],[0,0.4058451513773972,-0.4058451513773972,-0.7415311855993945,0.7415311855993945,-0.9491079123427585,0.9491079123427585],[-0.1834346424956498,0.1834346424956498,-0.525532409916329,0.525532409916329,-0.7966664774136267,0.7966664774136267,-0.9602898564975363,0.9602898564975363],[0,-0.8360311073266358,0.8360311073266358,-0.9681602395076261,0.9681602395076261,-0.3242534234038089,0.3242534234038089,-0.6133714327005904,0.6133714327005904],[-0.14887433898163122,0.14887433898163122,-0.4333953941292472,0.4333953941292472,-0.6794095682990244,0.6794095682990244,-0.8650633666889845,0.8650633666889845,-0.9739065285171717,0.9739065285171717],[0,-0.26954315595234496,0.26954315595234496,-0.5190961292068118,0.5190961292068118,-0.7301520055740494,0.7301520055740494,-0.8870625997680953,0.8870625997680953,-0.978228658146057,0.978228658146057],[-0.1252334085114689,0.1252334085114689,-0.3678314989981802,0.3678314989981802,-0.5873179542866175,0.5873179542866175,-0.7699026741943047,0.7699026741943047,-0.9041172563704749,0.9041172563704749,-0.9815606342467192,0.9815606342467192],[0,-0.2304583159551348,0.2304583159551348,-0.44849275103644687,0.44849275103644687,-0.6423493394403402,0.6423493394403402,-0.8015780907333099,0.8015780907333099,-0.9175983992229779,0.9175983992229779,-0.9841830547185881,0.9841830547185881],[-0.10805494870734367,0.10805494870734367,-0.31911236892788974,0.31911236892788974,-0.5152486363581541,0.5152486363581541,-0.6872929048116855,0.6872929048116855,-0.827201315069765,0.827201315069765,-0.9284348836635735,0.9284348836635735,-0.9862838086968123,0.9862838086968123],[0,-0.20119409399743451,0.20119409399743451,-0.3941513470775634,0.3941513470775634,-0.5709721726085388,0.5709721726085388,-0.7244177313601701,0.7244177313601701,-0.8482065834104272,0.8482065834104272,-0.937273392400706,0.937273392400706,-0.9879925180204854,0.9879925180204854],[-0.09501250983763744,0.09501250983763744,-0.2816035507792589,0.2816035507792589,-0.45801677765722737,0.45801677765722737,-0.6178762444026438,0.6178762444026438,-0.755404408355003,0.755404408355003,-0.8656312023878318,0.8656312023878318,-0.9445750230732326,0.9445750230732326,-0.9894009349916499,0.9894009349916499],[0,-0.17848418149584785,0.17848418149584785,-0.3512317634538763,0.3512317634538763,-0.5126905370864769,0.5126905370864769,-0.6576711592166907,0.6576711592166907,-0.7815140038968014,0.7815140038968014,-0.8802391537269859,0.8802391537269859,-0.9506755217687678,0.9506755217687678,-0.9905754753144174,0.9905754753144174],[-0.0847750130417353,0.0847750130417353,-0.2518862256915055,0.2518862256915055,-0.41175116146284263,0.41175116146284263,-0.5597708310739475,0.5597708310739475,-0.6916870430603532,0.6916870430603532,-0.8037049589725231,0.8037049589725231,-0.8926024664975557,0.8926024664975557,-0.9558239495713977,0.9558239495713977,-0.9915651684209309,0.9915651684209309],[0,-0.16035864564022537,0.16035864564022537,-0.31656409996362983,0.31656409996362983,-0.46457074137596094,0.46457074137596094,-0.600545304661681,0.600545304661681,-0.7209661773352294,0.7209661773352294,-0.8227146565371428,0.8227146565371428,-0.9031559036148179,0.9031559036148179,-0.96020815213483,0.96020815213483,-0.9924068438435844,0.9924068438435844],[-0.07652652113349734,0.07652652113349734,-0.22778585114164507,0.22778585114164507,-0.37370608871541955,0.37370608871541955,-0.5108670019508271,0.5108670019508271,-0.636053680726515,0.636053680726515,-0.7463319064601508,0.7463319064601508,-0.8391169718222188,0.8391169718222188,-0.912234428251326,0.912234428251326,-0.9639719272779138,0.9639719272779138,-0.9931285991850949,0.9931285991850949],[0,-0.1455618541608951,0.1455618541608951,-0.2880213168024011,0.2880213168024011,-0.4243421202074388,0.4243421202074388,-0.5516188358872198,0.5516188358872198,-0.6671388041974123,0.6671388041974123,-0.7684399634756779,0.7684399634756779,-0.8533633645833173,0.8533633645833173,-0.9200993341504008,0.9200993341504008,-0.9672268385663063,0.9672268385663063,-0.9937521706203895,0.9937521706203895],[-0.06973927331972223,0.06973927331972223,-0.20786042668822127,0.20786042668822127,-0.34193582089208424,0.34193582089208424,-0.469355837986757,0.469355837986757,-0.5876404035069116,0.5876404035069116,-0.6944872631866827,0.6944872631866827,-0.7878168059792081,0.7878168059792081,-0.8658125777203002,0.8658125777203002,-0.926956772187174,0.926956772187174,-0.9700604978354287,0.9700604978354287,-0.9942945854823992,0.9942945854823992],[0,-0.1332568242984661,0.1332568242984661,-0.26413568097034495,0.26413568097034495,-0.3903010380302908,0.3903010380302908,-0.5095014778460075,0.5095014778460075,-0.6196098757636461,0.6196098757636461,-0.7186613631319502,0.7186613631319502,-0.8048884016188399,0.8048884016188399,-0.8767523582704416,0.8767523582704416,-0.9329710868260161,0.9329710868260161,-0.9725424712181152,0.9725424712181152,-0.9947693349975522,0.9947693349975522],[-0.06405689286260563,0.06405689286260563,-0.1911188674736163,0.1911188674736163,-0.3150426796961634,0.3150426796961634,-0.4337935076260451,0.4337935076260451,-0.5454214713888396,0.5454214713888396,-0.6480936519369755,0.6480936519369755,-0.7401241915785544,0.7401241915785544,-0.820001985973903,0.820001985973903,-0.8864155270044011,0.8864155270044011,-0.9382745520027328,0.9382745520027328,-0.9747285559713095,0.9747285559713095,-0.9951872199970213,0.9951872199970213]];N1.cValues=[[],[],[1,1],[0.8888888888888888,0.5555555555555556,0.5555555555555556],[0.6521451548625461,0.6521451548625461,0.34785484513745385,0.34785484513745385],[0.5688888888888889,0.47862867049936647,0.47862867049936647,0.23692688505618908,0.23692688505618908],[0.3607615730481386,0.3607615730481386,0.46791393457269104,0.46791393457269104,0.17132449237917036,0.17132449237917036],[0.4179591836734694,0.3818300505051189,0.3818300505051189,0.27970539148927664,0.27970539148927664,0.1294849661688697,0.1294849661688697],[0.362683783378362,0.362683783378362,0.31370664587788727,0.31370664587788727,0.22238103445337448,0.22238103445337448,0.10122853629037626,0.10122853629037626],[0.3302393550012598,0.1806481606948574,0.1806481606948574,0.08127438836157441,0.08127438836157441,0.31234707704000286,0.31234707704000286,0.26061069640293544,0.26061069640293544],[0.29552422471475287,0.29552422471475287,0.26926671930999635,0.26926671930999635,0.21908636251598204,0.21908636251598204,0.1494513491505806,0.1494513491505806,0.06667134430868814,0.06667134430868814],[0.2729250867779006,0.26280454451024665,0.26280454451024665,0.23319376459199048,0.23319376459199048,0.18629021092773426,0.18629021092773426,0.1255803694649046,0.1255803694649046,0.05566856711617366,0.05566856711617366],[0.24914704581340277,0.24914704581340277,0.2334925365383548,0.2334925365383548,0.20316742672306592,0.20316742672306592,0.16007832854334622,0.16007832854334622,0.10693932599531843,0.10693932599531843,0.04717533638651183,0.04717533638651183],[0.2325515532308739,0.22628318026289723,0.22628318026289723,0.2078160475368885,0.2078160475368885,0.17814598076194574,0.17814598076194574,0.13887351021978725,0.13887351021978725,0.09212149983772845,0.09212149983772845,0.04048400476531588,0.04048400476531588],[0.2152638534631578,0.2152638534631578,0.2051984637212956,0.2051984637212956,0.18553839747793782,0.18553839747793782,0.15720316715819355,0.15720316715819355,0.12151857068790319,0.12151857068790319,0.08015808715976021,0.08015808715976021,0.03511946033175186,0.03511946033175186],[0.2025782419255613,0.19843148532711158,0.19843148532711158,0.1861610000155622,0.1861610000155622,0.16626920581699392,0.16626920581699392,0.13957067792615432,0.13957067792615432,0.10715922046717194,0.10715922046717194,0.07036604748810812,0.07036604748810812,0.03075324199611727,0.03075324199611727],[0.1894506104550685,0.1894506104550685,0.18260341504492358,0.18260341504492358,0.16915651939500254,0.16915651939500254,0.14959598881657674,0.14959598881657674,0.12462897125553388,0.12462897125553388,0.09515851168249279,0.09515851168249279,0.062253523938647894,0.062253523938647894,0.027152459411754096,0.027152459411754096],[0.17944647035620653,0.17656270536699264,0.17656270536699264,0.16800410215645004,0.16800410215645004,0.15404576107681028,0.15404576107681028,0.13513636846852548,0.13513636846852548,0.11188384719340397,0.11188384719340397,0.08503614831717918,0.08503614831717918,0.0554595293739872,0.0554595293739872,0.02414830286854793,0.02414830286854793],[0.1691423829631436,0.1691423829631436,0.16427648374583273,0.16427648374583273,0.15468467512626524,0.15468467512626524,0.14064291467065065,0.14064291467065065,0.12255520671147846,0.12255520671147846,0.10094204410628717,0.10094204410628717,0.07642573025488905,0.07642573025488905,0.0497145488949698,0.0497145488949698,0.02161601352648331,0.02161601352648331],[0.1610544498487837,0.15896884339395434,0.15896884339395434,0.15276604206585967,0.15276604206585967,0.1426067021736066,0.1426067021736066,0.12875396253933621,0.12875396253933621,0.11156664554733399,0.11156664554733399,0.09149002162245,0.09149002162245,0.06904454273764123,0.06904454273764123,0.0448142267656996,0.0448142267656996,0.019461788229726478,0.019461788229726478],[0.15275338713072584,0.15275338713072584,0.14917298647260374,0.14917298647260374,0.14209610931838204,0.14209610931838204,0.13168863844917664,0.13168863844917664,0.11819453196151841,0.11819453196151841,0.10193011981724044,0.10193011981724044,0.08327674157670475,0.08327674157670475,0.06267204833410907,0.06267204833410907,0.04060142980038694,0.04060142980038694,0.017614007139152118,0.017614007139152118],[0.14608113364969041,0.14452440398997005,0.14452440398997005,0.13988739479107315,0.13988739479107315,0.13226893863333747,0.13226893863333747,0.12183141605372853,0.12183141605372853,0.10879729916714838,0.10879729916714838,0.09344442345603386,0.09344442345603386,0.0761001136283793,0.0761001136283793,0.057134425426857205,0.057134425426857205,0.036953789770852494,0.036953789770852494,0.016017228257774335,0.016017228257774335],[0.13925187285563198,0.13925187285563198,0.13654149834601517,0.13654149834601517,0.13117350478706238,0.13117350478706238,0.12325237681051242,0.12325237681051242,0.11293229608053922,0.11293229608053922,0.10041414444288096,0.10041414444288096,0.08594160621706773,0.08594160621706773,0.06979646842452049,0.06979646842452049,0.052293335152683286,0.052293335152683286,0.03377490158481415,0.03377490158481415,0.0146279952982722,0.0146279952982722],[0.13365457218610619,0.1324620394046966,0.1324620394046966,0.12890572218808216,0.12890572218808216,0.12304908430672953,0.12304908430672953,0.11499664022241136,0.11499664022241136,0.10489209146454141,0.10489209146454141,0.09291576606003515,0.09291576606003515,0.07928141177671895,0.07928141177671895,0.06423242140852585,0.06423242140852585,0.04803767173108467,0.04803767173108467,0.030988005856979445,0.030988005856979445,0.013411859487141771,0.013411859487141771],[0.12793819534675216,0.12793819534675216,0.1258374563468283,0.1258374563468283,0.12167047292780339,0.12167047292780339,0.1155056680537256,0.1155056680537256,0.10744427011596563,0.10744427011596563,0.09761865210411388,0.09761865210411388,0.08619016153195327,0.08619016153195327,0.0733464814110803,0.0733464814110803,0.05929858491543678,0.05929858491543678,0.04427743881741981,0.04427743881741981,0.028531388628933663,0.028531388628933663,0.0123412297999872,0.0123412297999872]];N1.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];var k3=(t,e,i)=>{let r,n,s=20,o=i/2;r=0;for(let a=0;a<20;a++)n=o*N1.tValues[20][a]+o,r+=N1.cValues[20][a]*E3(t,e,n);return o*r};N1.getCubicArcLength=k3;var L3=(t,e,i)=>{if(i===void 0)i=1;let r=t[0]-2*t[1]+t[2],n=e[0]-2*e[1]+e[2],s=2*t[1]-2*t[0],o=2*e[1]-2*e[0],a=4*(r*r+n*n),h=4*(r*s+n*o),l=s*s+o*o;if(a===0)return i*Math.sqrt(Math.pow(t[2]-t[0],2)+Math.pow(e[2]-e[0],2));let c=h/(2*a),d=l/a,u=i+c,g=d-c*c,p=u*u+g>0?Math.sqrt(u*u+g):0,m=c*c+g>0?Math.sqrt(c*c+g):0,f=c+Math.sqrt(c*c+g)!==0?g*Math.log(Math.abs((u+p)/(c+m))):0;return Math.sqrt(a)/2*(u*p-c*m+f)};N1.getQuadraticArcLength=L3;function E3(t,e,i){let r=Wr(1,i,t),n=Wr(1,i,e),s=r*r+n*n;return Math.sqrt(s)}var Wr=(t,e,i)=>{let r=i.length-1,n,s;if(r===0)return 0;if(t===0){s=0;for(let o=0;o<=r;o++)s+=N1.binomialCoefficients[r][o]*Math.pow(1-e,r-o)*Math.pow(e,o)*i[o];return s}else{n=new Array(r);for(let o=0;o<r;o++)n[o]=r*(i[o+1]-i[o]);return Wr(t-1,e,n)}},N3=(t,e,i)=>{let r=1,n=t/e,s=(t-i(n))/e,o=0;while(r>0.001){let a=i(n+s),h=Math.abs(t-a)/e;if(h<r)r=h,n+=s;else{let l=i(n-s),c=Math.abs(t-l)/e;if(c<r)r=c,n-=s;else s/=2}if(o++,o>500)break}return n};N1.t2length=N3});var Bi=N((I1)=>{Object.defineProperty(I1,"__esModule",{value:!0});I1.Path=void 0;var P3=G(),D3=ct(),T3=I(),Te=T1();class dt extends D3.Shape{constructor(t){super(t);this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=dt.parsePathData(this.data()),this.pathLength=dt.getPathLength(this.dataArray)}_sceneFunc(t){let e=this.dataArray;t.beginPath();let i=!1;for(let p=0;p<e.length;p++){let m=e[p].command,f=e[p].points;switch(m){case"L":t.lineTo(f[0],f[1]);break;case"M":t.moveTo(f[0],f[1]);break;case"C":t.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":t.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var r=f[0],n=f[1],s=f[2],o=f[3],a=f[4],h=f[5],l=f[6],c=f[7],d=s>o?s:o,u=s>o?1:s/o,g=s>o?o/s:1;t.translate(r,n),t.rotate(l),t.scale(u,g),t.arc(0,0,d,a,a+h,1-c),t.scale(1/u,1/g),t.rotate(-l),t.translate(-r,-n);break;case"z":i=!0,t.closePath();break}}if(!i&&!this.hasFill())t.strokeShape(this);else t.fillStrokeShape(this)}getSelfRect(){let t=[];this.dataArray.forEach(function(a){if(a.command==="A"){let h=a.points[4],l=a.points[5],c=a.points[4]+l,d=Math.PI/180;if(Math.abs(h-c)<d)d=Math.abs(h-c);if(l<0)for(let u=h-d;u>c;u-=d){let g=dt.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],u,0);t.push(g.x,g.y)}else for(let u=h+d;u<c;u+=d){let g=dt.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],u,0);t.push(g.x,g.y)}}else if(a.command==="C")for(let h=0;h<=1;h+=0.01){let l=dt.getPointOnCubicBezier(h,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);t.push(l.x,l.y)}else t=t.concat(a.points)});let e=t[0],i=t[0],r=t[1],n=t[1],s,o;for(let a=0;a<t.length/2;a++){if(s=t[a*2],o=t[a*2+1],!isNaN(s))e=Math.min(e,s),i=Math.max(i,s);if(!isNaN(o))r=Math.min(r,o),n=Math.max(n,o)}return{x:e,y:r,width:i-e,height:n-r}}getLength(){return this.pathLength}getPointAtLength(t){return dt.getPointAtLengthOfDataArray(t,this.dataArray)}static getLineLength(t,e,i,r){return Math.sqrt((i-t)*(i-t)+(r-e)*(r-e))}static getPathLength(t){let e=0;for(let i=0;i<t.length;++i)e+=t[i].pathLength;return e}static getPointAtLengthOfDataArray(t,e){let i,r=0,n=e.length;if(!n)return null;while(r<n&&t>e[r].pathLength)t-=e[r].pathLength,++r;if(r===n)return i=e[r-1].points.slice(-2),{x:i[0],y:i[1]};if(t<0.01)return i=e[r].points.slice(0,2),{x:i[0],y:i[1]};let s=e[r],o=s.points;switch(s.command){case"L":return dt.getPointOnLine(t,s.start.x,s.start.y,o[0],o[1]);case"C":return dt.getPointOnCubicBezier(Te.t2length(t,dt.getPathLength(e),(p)=>{return Te.getCubicArcLength([s.start.x,o[0],o[2],o[4]],[s.start.y,o[1],o[3],o[5]],p)}),s.start.x,s.start.y,o[0],o[1],o[2],o[3],o[4],o[5]);case"Q":return dt.getPointOnQuadraticBezier(Te.t2length(t,dt.getPathLength(e),(p)=>{return Te.getQuadraticArcLength([s.start.x,o[0],o[2]],[s.start.y,o[1],o[3]],p)}),s.start.x,s.start.y,o[0],o[1],o[2],o[3]);case"A":var a=o[0],h=o[1],l=o[2],c=o[3],d=o[4],u=o[5],g=o[6];return d+=u*t/s.pathLength,dt.getPointOnEllipticalArc(a,h,l,c,d,g)}return null}static getPointOnLine(t,e,i,r,n,s,o){s=s!==null&&s!==void 0?s:e,o=o!==null&&o!==void 0?o:i;let a=this.getLineLength(e,i,r,n);if(a<0.0000000001)return{x:e,y:i};if(r===e)return{x:s,y:o+(n>i?t:-t)};let h=(n-i)/(r-e),l=Math.sqrt(t*t/(1+h*h))*(r<e?-1:1),c=h*l;if(Math.abs(o-i-h*(s-e))<0.0000000001)return{x:s+l,y:o+c};let d=((s-e)*(r-e)+(o-i)*(n-i))/(a*a),u=e+d*(r-e),g=i+d*(n-i),p=this.getLineLength(s,o,u,g),m=Math.sqrt(t*t-p*p),f=Math.sqrt(m*m/(1+h*h))*(r<e?-1:1),_=h*f;return{x:u+f,y:g+_}}static getPointOnCubicBezier(t,e,i,r,n,s,o,a,h){function l(m){return m*m*m}function c(m){return 3*m*m*(1-m)}function d(m){return 3*m*(1-m)*(1-m)}function u(m){return(1-m)*(1-m)*(1-m)}let g=a*l(t)+s*c(t)+r*d(t)+e*u(t),p=h*l(t)+o*c(t)+n*d(t)+i*u(t);return{x:g,y:p}}static getPointOnQuadraticBezier(t,e,i,r,n,s,o){function a(u){return u*u}function h(u){return 2*u*(1-u)}function l(u){return(1-u)*(1-u)}let c=s*a(t)+r*h(t)+e*l(t),d=o*a(t)+n*h(t)+i*l(t);return{x:c,y:d}}static getPointOnEllipticalArc(t,e,i,r,n,s){let o=Math.cos(s),a=Math.sin(s),h={x:i*Math.cos(n),y:r*Math.sin(n)};return{x:t+(h.x*o-h.y*a),y:e+(h.x*a+h.y*o)}}static parsePathData(t){if(!t)return[];let e=t,i=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];e=e.replace(new RegExp(" ","g"),",");for(var r=0;r<i.length;r++)e=e.replace(new RegExp(i[r],"g"),"|"+i[r]);let n=e.split("|"),s=[],o=[],a=0,h=0,l=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,c;for(r=1;r<n.length;r++){let A=n[r],F=A.charAt(0);A=A.slice(1),o.length=0;while(c=l.exec(A))o.push(c[0]);let C=[];for(let L=0,S=o.length;L<S;L++){if(o[L]==="00"){C.push(0,0);continue}let z=parseFloat(o[L]);if(!isNaN(z))C.push(z);else C.push(0)}while(C.length>0){if(isNaN(C[0]))break;let L="",S=[],z=a,pt=h;var d,u,g,p,m,f,_,y,w,v;switch(F){case"l":a+=C.shift(),h+=C.shift(),L="L",S.push(a,h);break;case"L":a=C.shift(),h=C.shift(),S.push(a,h);break;case"m":var b=C.shift(),x=C.shift();if(a+=b,h+=x,L="M",s.length>2&&s[s.length-1].command==="z"){for(let X=s.length-2;X>=0;X--)if(s[X].command==="M"){a=s[X].points[0]+b,h=s[X].points[1]+x;break}}S.push(a,h),F="l";break;case"M":a=C.shift(),h=C.shift(),L="M",S.push(a,h),F="L";break;case"h":a+=C.shift(),L="L",S.push(a,h);break;case"H":a=C.shift(),L="L",S.push(a,h);break;case"v":h+=C.shift(),L="L",S.push(a,h);break;case"V":h=C.shift(),L="L",S.push(a,h);break;case"C":S.push(C.shift(),C.shift(),C.shift(),C.shift()),a=C.shift(),h=C.shift(),S.push(a,h);break;case"c":S.push(a+C.shift(),h+C.shift(),a+C.shift(),h+C.shift()),a+=C.shift(),h+=C.shift(),L="C",S.push(a,h);break;case"S":if(u=a,g=h,d=s[s.length-1],d.command==="C")u=a+(a-d.points[2]),g=h+(h-d.points[3]);S.push(u,g,C.shift(),C.shift()),a=C.shift(),h=C.shift(),L="C",S.push(a,h);break;case"s":if(u=a,g=h,d=s[s.length-1],d.command==="C")u=a+(a-d.points[2]),g=h+(h-d.points[3]);S.push(u,g,a+C.shift(),h+C.shift()),a+=C.shift(),h+=C.shift(),L="C",S.push(a,h);break;case"Q":S.push(C.shift(),C.shift()),a=C.shift(),h=C.shift(),S.push(a,h);break;case"q":S.push(a+C.shift(),h+C.shift()),a+=C.shift(),h+=C.shift(),L="Q",S.push(a,h);break;case"T":if(u=a,g=h,d=s[s.length-1],d.command==="Q")u=a+(a-d.points[0]),g=h+(h-d.points[1]);a=C.shift(),h=C.shift(),L="Q",S.push(u,g,a,h);break;case"t":if(u=a,g=h,d=s[s.length-1],d.command==="Q")u=a+(a-d.points[0]),g=h+(h-d.points[1]);a+=C.shift(),h+=C.shift(),L="Q",S.push(u,g,a,h);break;case"A":p=C.shift(),m=C.shift(),f=C.shift(),_=C.shift(),y=C.shift(),w=a,v=h,a=C.shift(),h=C.shift(),L="A",S=this.convertEndpointToCenterParameterization(w,v,a,h,_,y,p,m,f);break;case"a":p=C.shift(),m=C.shift(),f=C.shift(),_=C.shift(),y=C.shift(),w=a,v=h,a+=C.shift(),h+=C.shift(),L="A",S=this.convertEndpointToCenterParameterization(w,v,a,h,_,y,p,m,f);break}s.push({command:L||F,points:S,start:{x:z,y:pt},pathLength:this.calcLength(z,pt,L||F,S)})}if(F==="z"||F==="Z")s.push({command:"z",points:[],start:void 0,pathLength:0})}return s}static calcLength(t,e,i,r){let n,s,o,a,h=dt;switch(i){case"L":return h.getLineLength(t,e,r[0],r[1]);case"C":return Te.getCubicArcLength([t,r[0],r[2],r[4]],[e,r[1],r[3],r[5]],1);case"Q":return Te.getQuadraticArcLength([t,r[0],r[2]],[e,r[1],r[3]],1);case"A":n=0;var l=r[4],c=r[5],d=r[4]+c,u=Math.PI/180;if(Math.abs(l-d)<u)u=Math.abs(l-d);if(s=h.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],l,0),c<0)for(a=l-u;a>d;a-=u)o=h.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],a,0),n+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;else for(a=l+u;a<d;a+=u)o=h.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],a,0),n+=h.getLineLength(s.x,s.y,o.x,o.y),s=o;return o=h.getPointOnEllipticalArc(r[0],r[1],r[2],r[3],d,0),n+=h.getLineLength(s.x,s.y,o.x,o.y),n}return 0}static convertEndpointToCenterParameterization(t,e,i,r,n,s,o,a,h){let l=h*(Math.PI/180),c=Math.cos(l)*(t-i)/2+Math.sin(l)*(e-r)/2,d=-1*Math.sin(l)*(t-i)/2+Math.cos(l)*(e-r)/2,u=c*c/(o*o)+d*d/(a*a);if(u>1)o*=Math.sqrt(u),a*=Math.sqrt(u);let g=Math.sqrt((o*o*(a*a)-o*o*(d*d)-a*a*(c*c))/(o*o*(d*d)+a*a*(c*c)));if(n===s)g*=-1;if(isNaN(g))g=0;let p=g*o*d/a,m=g*-a*c/o,f=(t+i)/2+Math.cos(l)*p-Math.sin(l)*m,_=(e+r)/2+Math.sin(l)*p+Math.cos(l)*m,y=function(C){return Math.sqrt(C[0]*C[0]+C[1]*C[1])},w=function(C,L){return(C[0]*L[0]+C[1]*L[1])/(y(C)*y(L))},v=function(C,L){return(C[0]*L[1]<C[1]*L[0]?-1:1)*Math.acos(w(C,L))},b=v([1,0],[(c-p)/o,(d-m)/a]),x=[(c-p)/o,(d-m)/a],A=[(-1*c-p)/o,(-1*d-m)/a],F=v(x,A);if(w(x,A)<=-1)F=Math.PI;if(w(x,A)>=1)F=0;if(s===0&&F>0)F=F-2*Math.PI;if(s===1&&F<0)F=F+2*Math.PI;return[f,_,o,a,b,F,l,s]}}I1.Path=dt;dt.prototype.className="Path";dt.prototype._attrsAffectingSize=["data"];T3._registerNode(dt);P3.Factory.addGetterSetter(dt,"data")});var q1=N((B1)=>{Object.defineProperty(B1,"__esModule",{value:!0});B1.Arrow=void 0;var Ui=G(),I3=Vr(),O1=R(),G3=I(),R1=Bi();class le extends I3.Line{_sceneFunc(t){super._sceneFunc(t);let e=Math.PI*2,i=this.points(),r=i,n=this.tension()!==0&&i.length>4;if(n)r=this.getTensionPoints();let s=this.pointerLength(),o=i.length,a,h;if(n){let d=[r[r.length-4],r[r.length-3],r[r.length-2],r[r.length-1],i[o-2],i[o-1]],u=R1.Path.calcLength(r[r.length-4],r[r.length-3],"C",d),g=R1.Path.getPointOnQuadraticBezier(Math.min(1,1-s/u),d[0],d[1],d[2],d[3],d[4],d[5]);a=i[o-2]-g.x,h=i[o-1]-g.y}else a=i[o-2]-i[o-4],h=i[o-1]-i[o-3];let l=(Math.atan2(h,a)+e)%e,c=this.pointerWidth();if(this.pointerAtEnding())t.save(),t.beginPath(),t.translate(i[o-2],i[o-1]),t.rotate(l),t.moveTo(0,0),t.lineTo(-s,c/2),t.lineTo(-s,-c/2),t.closePath(),t.restore(),this.__fillStroke(t);if(this.pointerAtBeginning()){if(t.save(),t.beginPath(),t.translate(i[0],i[1]),n)a=(r[0]+r[2])/2-i[0],h=(r[1]+r[3])/2-i[1];else a=i[2]-i[0],h=i[3]-i[1];t.rotate((Math.atan2(-h,-a)+e)%e),t.moveTo(0,0),t.lineTo(-s,c/2),t.lineTo(-s,-c/2),t.closePath(),t.restore(),this.__fillStroke(t)}}__fillStroke(t){let e=this.dashEnabled();if(e)this.attrs.dashEnabled=!1,t.setLineDash([]);if(t.fillStrokeShape(this),e)this.attrs.dashEnabled=!0}getSelfRect(){let t=super.getSelfRect(),e=this.pointerWidth()/2;return{x:t.x,y:t.y-e,width:t.width,height:t.height+e*2}}}B1.Arrow=le;le.prototype.className="Arrow";G3._registerNode(le);Ui.Factory.addGetterSetter(le,"pointerLength",10,O1.getNumberValidator());Ui.Factory.addGetterSetter(le,"pointerWidth",10,O1.getNumberValidator());Ui.Factory.addGetterSetter(le,"pointerAtBeginning",!1);Ui.Factory.addGetterSetter(le,"pointerAtEnding",!0)});var W1=N((z1)=>{Object.defineProperty(z1,"__esModule",{value:!0});z1.Circle=void 0;var R3=G(),O3=ct(),B3=R(),U3=I();class xe extends O3.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){if(this.radius()!==t/2)this.radius(t/2)}setHeight(t){if(this.radius()!==t/2)this.radius(t/2)}}z1.Circle=xe;xe.prototype._centroid=!0;xe.prototype.className="Circle";xe.prototype._attrsAffectingSize=["radius"];U3._registerNode(xe);R3.Factory.addGetterSetter(xe,"radius",0,B3.getNumberValidator())});var X1=N((Y1)=>{Object.defineProperty(Y1,"__esModule",{value:!0});Y1.Ellipse=void 0;var Hr=G(),q3=ct(),H1=R(),z3=I();class ie extends q3.Shape{_sceneFunc(t){let e=this.radiusX(),i=this.radiusY();if(t.beginPath(),t.save(),e!==i)t.scale(1,i/e);t.arc(0,0,e,0,Math.PI*2,!1),t.restore(),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(t){this.radiusX(t/2)}setHeight(t){this.radiusY(t/2)}}Y1.Ellipse=ie;ie.prototype.className="Ellipse";ie.prototype._centroid=!0;ie.prototype._attrsAffectingSize=["radiusX","radiusY"];z3._registerNode(ie);Hr.Factory.addComponentsGetterSetter(ie,"radius",["x","y"]);Hr.Factory.addGetterSetter(ie,"radiusX",0,H1.getNumberValidator());Hr.Factory.addGetterSetter(ie,"radiusY",0,H1.getNumberValidator())});var Q1=N((K1)=>{Object.defineProperty(K1,"__esModule",{value:!0});K1.Image=void 0;var Yr=J(),be=G(),V3=ct(),W3=I(),ii=R();class Lt extends V3.Shape{constructor(t){super(t);this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){let t=this.image();if(t&&t.complete)return;if(t&&t.readyState===4)return;if(t&&t.addEventListener)t.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){let t=!!this.cornerRadius(),e=this.hasShadow();if(t&&e)return!0;return super._useBufferCanvas(!0)}_sceneFunc(t){let e=this.getWidth(),i=this.getHeight(),r=this.cornerRadius(),n=this.attrs.image,s;if(n){let o=this.attrs.cropWidth,a=this.attrs.cropHeight;if(o&&a)s=[n,this.cropX(),this.cropY(),o,a,0,0,e,i];else s=[n,0,0,e,i]}if(this.hasFill()||this.hasStroke()||r)t.beginPath(),r?Yr.Util.drawRoundedRectPath(t,e,i,r):t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this);if(n){if(r)t.clip();t.drawImage.apply(t,s)}}_hitFunc(t){let e=this.width(),i=this.height(),r=this.cornerRadius();if(t.beginPath(),!r)t.rect(0,0,e,i);else Yr.Util.drawRoundedRectPath(t,e,i,r);t.closePath(),t.fillStrokeShape(this)}getWidth(){var t,e;return(t=this.attrs.width)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.width}getHeight(){var t,e;return(t=this.attrs.height)!==null&&t!==void 0?t:(e=this.image())===null||e===void 0?void 0:e.height}static fromURL(t,e,i=null){let r=Yr.Util.createImageElement();r.onload=function(){let n=new Lt({image:r});e(n)},r.onerror=i,r.crossOrigin="Anonymous",r.src=t}}K1.Image=Lt;Lt.prototype.className="Image";W3._registerNode(Lt);be.Factory.addGetterSetter(Lt,"cornerRadius",0,ii.getNumberOrArrayOfNumbersValidator(4));be.Factory.addGetterSetter(Lt,"image");be.Factory.addComponentsGetterSetter(Lt,"crop",["x","y","width","height"]);be.Factory.addGetterSetter(Lt,"cropX",0,ii.getNumberValidator());be.Factory.addGetterSetter(Lt,"cropY",0,ii.getNumberValidator());be.Factory.addGetterSetter(Lt,"cropWidth",0,ii.getNumberValidator());be.Factory.addGetterSetter(Lt,"cropHeight",0,ii.getNumberValidator())});var io=N((to)=>{Object.defineProperty(to,"__esModule",{value:!0});to.Tag=to.Label=void 0;var qi=G(),H3=ct(),Y3=Ti(),Qr=R(),J1=I(),$1=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],j3="Change.konva",X3="none",jr="up",Xr="right",Kr="down",Zr="left",K3=$1.length;class zi extends Y3.Group{constructor(t){super(t);this.on("add.konva",function(e){this._addListeners(e.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(t){let e=this,i,r=function(){e._sync()};for(i=0;i<K3;i++)t.on($1[i]+j3,r)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){let t=this.getText(),e=this.getTag(),i,r,n,s,o,a,h;if(t&&e){switch(i=t.width(),r=t.height(),n=e.pointerDirection(),s=e.pointerWidth(),h=e.pointerHeight(),o=0,a=0,n){case jr:o=i/2,a=-1*h;break;case Xr:o=i+s,a=r/2;break;case Kr:o=i/2,a=r+h;break;case Zr:o=-1*s,a=r/2;break}e.setAttrs({x:-1*o,y:-1*a,width:i,height:r}),t.setAttrs({x:-1*o,y:-1*a})}}}to.Label=zi;zi.prototype.className="Label";J1._registerNode(zi);class ce extends H3.Shape{_sceneFunc(t){let e=this.width(),i=this.height(),r=this.pointerDirection(),n=this.pointerWidth(),s=this.pointerHeight(),o=this.cornerRadius(),a=0,h=0,l=0,c=0;if(typeof o==="number")a=h=l=c=Math.min(o,e/2,i/2);else a=Math.min(o[0]||0,e/2,i/2),h=Math.min(o[1]||0,e/2,i/2),c=Math.min(o[2]||0,e/2,i/2),l=Math.min(o[3]||0,e/2,i/2);if(t.beginPath(),t.moveTo(a,0),r===jr)t.lineTo((e-n)/2,0),t.lineTo(e/2,-1*s),t.lineTo((e+n)/2,0);if(t.lineTo(e-h,0),t.arc(e-h,h,h,Math.PI*3/2,0,!1),r===Xr)t.lineTo(e,(i-s)/2),t.lineTo(e+n,i/2),t.lineTo(e,(i+s)/2);if(t.lineTo(e,i-c),t.arc(e-c,i-c,c,0,Math.PI/2,!1),r===Kr)t.lineTo((e+n)/2,i),t.lineTo(e/2,i+s),t.lineTo((e-n)/2,i);if(t.lineTo(l,i),t.arc(l,i-l,l,Math.PI/2,Math.PI,!1),r===Zr)t.lineTo(0,(i+s)/2),t.lineTo(-1*n,i/2),t.lineTo(0,(i-s)/2);t.lineTo(0,a),t.arc(a,a,a,Math.PI,Math.PI*3/2,!1),t.closePath(),t.fillStrokeShape(this)}getSelfRect(){let t=0,e=0,i=this.pointerWidth(),r=this.pointerHeight(),n=this.pointerDirection(),s=this.width(),o=this.height();if(n===jr)e-=r,o+=r;else if(n===Kr)o+=r;else if(n===Zr)t-=i*1.5,s+=i;else if(n===Xr)s+=i*1.5;return{x:t,y:e,width:s,height:o}}}to.Tag=ce;ce.prototype.className="Tag";J1._registerNode(ce);qi.Factory.addGetterSetter(ce,"pointerDirection",X3);qi.Factory.addGetterSetter(ce,"pointerWidth",0,Qr.getNumberValidator());qi.Factory.addGetterSetter(ce,"pointerHeight",0,Qr.getNumberValidator());qi.Factory.addGetterSetter(ce,"cornerRadius",0,Qr.getNumberOrArrayOfNumbersValidator(4))});var Jr=N((ro)=>{Object.defineProperty(ro,"__esModule",{value:!0});ro.Rect=void 0;var Q3=G(),J3=ct(),$3=I(),t4=J(),e4=R();class ri extends J3.Shape{_sceneFunc(t){let e=this.cornerRadius(),i=this.width(),r=this.height();if(t.beginPath(),!e)t.rect(0,0,i,r);else t4.Util.drawRoundedRectPath(t,i,r,e);t.closePath(),t.fillStrokeShape(this)}}ro.Rect=ri;ri.prototype.className="Rect";$3._registerNode(ri);Q3.Factory.addGetterSetter(ri,"cornerRadius",0,e4.getNumberOrArrayOfNumbersValidator(4))});var lo=N((ao)=>{Object.defineProperty(ao,"__esModule",{value:!0});ao.RegularPolygon=void 0;var so=G(),i4=ct(),oo=R(),r4=I();class de extends i4.Shape{_sceneFunc(t){let e=this._getPoints();t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let i=1;i<e.length;i++)t.lineTo(e[i].x,e[i].y);t.closePath(),t.fillStrokeShape(this)}_getPoints(){let t=this.attrs.sides,e=this.attrs.radius||0,i=[];for(let r=0;r<t;r++)i.push({x:e*Math.sin(r*2*Math.PI/t),y:-1*e*Math.cos(r*2*Math.PI/t)});return i}getSelfRect(){let t=this._getPoints(),e=t[0].x,i=t[0].y,r=t[0].x,n=t[0].y;return t.forEach((s)=>{e=Math.min(e,s.x),i=Math.max(i,s.x),r=Math.min(r,s.y),n=Math.max(n,s.y)}),{x:e,y:r,width:i-e,height:n-r}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}ao.RegularPolygon=de;de.prototype.className="RegularPolygon";de.prototype._centroid=!0;de.prototype._attrsAffectingSize=["radius"];r4._registerNode(de);so.Factory.addGetterSetter(de,"radius",0,oo.getNumberValidator());so.Factory.addGetterSetter(de,"sides",0,oo.getNumberValidator())});var mo=N((fo)=>{Object.defineProperty(fo,"__esModule",{value:!0});fo.Ring=void 0;var uo=G(),n4=ct(),go=R(),s4=I(),co=Math.PI*2;class ue extends n4.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.innerRadius(),0,co,!1),t.moveTo(this.outerRadius(),0),t.arc(0,0,this.outerRadius(),co,0,!0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}fo.Ring=ue;ue.prototype.className="Ring";ue.prototype._centroid=!0;ue.prototype._attrsAffectingSize=["innerRadius","outerRadius"];s4._registerNode(ue);uo.Factory.addGetterSetter(ue,"innerRadius",0,go.getNumberValidator());uo.Factory.addGetterSetter(ue,"outerRadius",0,go.getNumberValidator())});var wo=N((yo)=>{Object.defineProperty(yo,"__esModule",{value:!0});yo.Sprite=void 0;var ve=G(),o4=ct(),a4=Ii(),_o=R(),h4=I();class Gt extends o4.Shape{constructor(t){super(t);this._updated=!0,this.anim=new a4.Animation(()=>{let e=this._updated;return this._updated=!1,e}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){if(!this.anim.isRunning())return;clearInterval(this.interval),this._setInterval()})}_sceneFunc(t){let e=this.animation(),i=this.frameIndex(),r=i*4,n=this.animations()[e],s=this.frameOffsets(),o=n[r+0],a=n[r+1],h=n[r+2],l=n[r+3],c=this.image();if(this.hasFill()||this.hasStroke())t.beginPath(),t.rect(0,0,h,l),t.closePath(),t.fillStrokeShape(this);if(c)if(s){let d=s[e],u=i*2;t.drawImage(c,o,a,h,l,d[u+0],d[u+1],h,l)}else t.drawImage(c,o,a,h,l,0,0,h,l)}_hitFunc(t){let e=this.animation(),i=this.frameIndex(),r=i*4,n=this.animations()[e],s=this.frameOffsets(),o=n[r+2],a=n[r+3];if(t.beginPath(),s){let h=s[e],l=i*2;t.rect(h[l+0],h[l+1],o,a)}else t.rect(0,0,o,a);t.closePath(),t.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){let t=this;this.interval=setInterval(function(){t._updateIndex()},1000/this.frameRate())}start(){if(this.isRunning())return;let t=this.getLayer();this.anim.setLayers(t),this._setInterval(),this.anim.start()}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){let t=this.frameIndex(),e=this.animation(),i=this.animations(),r=i[e],n=r.length/4;if(t<n-1)this.frameIndex(t+1);else this.frameIndex(0)}}yo.Sprite=Gt;Gt.prototype.className="Sprite";h4._registerNode(Gt);ve.Factory.addGetterSetter(Gt,"animation");ve.Factory.addGetterSetter(Gt,"animations");ve.Factory.addGetterSetter(Gt,"frameOffsets");ve.Factory.addGetterSetter(Gt,"image");ve.Factory.addGetterSetter(Gt,"frameIndex",0,_o.getNumberValidator());ve.Factory.addGetterSetter(Gt,"frameRate",17,_o.getNumberValidator());ve.Factory.backCompat(Gt,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"})});var vo=N((xo)=>{Object.defineProperty(xo,"__esModule",{value:!0});xo.Star=void 0;var $r=G(),l4=ct(),tn=R(),c4=I();class re extends l4.Shape{_sceneFunc(t){let e=this.innerRadius(),i=this.outerRadius(),r=this.numPoints();t.beginPath(),t.moveTo(0,0-i);for(let n=1;n<r*2;n++){let s=n%2===0?i:e,o=s*Math.sin(n*Math.PI/r),a=-1*s*Math.cos(n*Math.PI/r);t.lineTo(o,a)}t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(t){this.outerRadius(t/2)}setHeight(t){this.outerRadius(t/2)}}xo.Star=re;re.prototype.className="Star";re.prototype._centroid=!0;re.prototype._attrsAffectingSize=["innerRadius","outerRadius"];c4._registerNode(re);$r.Factory.addGetterSetter(re,"numPoints",5,tn.getNumberValidator());$r.Factory.addGetterSetter(re,"innerRadius",0,tn.getNumberValidator());$r.Factory.addGetterSetter(re,"outerRadius",0,tn.getNumberValidator())});var on=N((Po)=>{Object.defineProperty(Po,"__esModule",{value:!0});Po.Text=void 0;Po.stringToArray=Se;var sn=J(),mt=G(),d4=ct(),en=I(),ge=R(),u4=I();function Se(t){return[...t].reduce((e,i,r,n)=>{if(/\p{Emoji}/u.test(i)){let s=n[r+1];if(s&&/\p{Emoji_Modifier}|\u200D/u.test(s))e.push(i+s),n[r+1]="";else e.push(i)}else if(/\p{Regional_Indicator}{2}/u.test(i+(n[r+1]||"")))e.push(i+n[r+1]);else if(r>0&&/\p{Mn}|\p{Me}|\p{Mc}/u.test(i))e[e.length-1]+=i;else if(i)e.push(i);return e},[])}var Ie="auto",g4="center",Eo="inherit",ni="justify",f4="Change.konva",p4="2d",So="-",No="left",m4="text",_4="Text",y4="top",C4="bottom",Mo="middle",Ao="normal",w4="px ",Vi=" ",x4="right",ko="rtl",b4="word",v4="char",Lo="none",rn="…",Fo=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],S4=Fo.length;function M4(t){return t.split(",").map((e)=>{e=e.trim();let i=e.indexOf(" ")>=0,r=e.indexOf('"')>=0||e.indexOf("'")>=0;if(i&&!r)e=`"${e}"`;return e}).join(", ")}var Wi;function nn(){if(Wi)return Wi;return Wi=sn.Util.createCanvasElement().getContext(p4),Wi}function k4(t){t.fillText(this._partialText,this._partialTextX,this._partialTextY)}function L4(t){t.setAttr("miterLimit",2),t.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function E4(t){if(t=t||{},!t.fillLinearGradientColorStops&&!t.fillRadialGradientColorStops&&!t.fillPatternImage)t.fill=t.fill||"black";return t}class $ extends d4.Shape{constructor(t){super(E4(t));this._partialTextX=0,this._partialTextY=0;for(let e=0;e<S4;e++)this.on(Fo[e]+f4,this._setTextData);this._setTextData()}_sceneFunc(t){let e=this.textArr,i=e.length;if(!this.text())return;let r=this.padding(),n=this.fontSize(),s=this.lineHeight()*n,o=this.verticalAlign(),a=this.direction(),h=0,l=this.align(),c=this.getWidth(),d=this.letterSpacing(),u=this.fill(),g=this.textDecoration(),p=g.indexOf("underline")!==-1,m=g.indexOf("line-through")!==-1,f;a=a===Eo?t.direction:a;let _=s/2,y=Mo;if(en.Konva._fixTextRendering){let z=this.measureSize("M");y="alphabetic",_=(z.fontBoundingBoxAscent-z.fontBoundingBoxDescent)/2+s/2}var w=0,v=0;if(a===ko)t.setAttr("direction",a);if(t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",y),t.setAttr("textAlign",No),o===Mo)h=(this.getHeight()-i*s-r*2)/2;else if(o===C4)h=this.getHeight()-i*s-r*2;t.translate(r,h+r);for(f=0;f<i;f++){var w=0,v=0,b=e[f],x=b.text,A=b.width,F=b.lastInParagraph,C,L,S;if(t.save(),l===x4)w+=c-A-r*2;else if(l===g4)w+=(c-A-r*2)/2;if(p){t.save(),t.beginPath();let X=en.Konva._fixTextRendering?Math.round(n/4):Math.round(n/2),Z=w,V=_+v+X;t.moveTo(Z,V),C=x.split(" ").length-1,L=C===0,S=l===ni&&!F?c-r*2:A,t.lineTo(Z+Math.round(S),V),t.lineWidth=n/15;let Ct=this._getLinearGradient();t.strokeStyle=Ct||u,t.stroke(),t.restore()}if(m){t.save(),t.beginPath();let X=en.Konva._fixTextRendering?-Math.round(n/4):0;t.moveTo(w,_+v+X),C=x.split(" ").length-1,L=C===0,S=l===ni&&!F?c-r*2:A,t.lineTo(w+Math.round(S),_+v+X),t.lineWidth=n/15;let Z=this._getLinearGradient();t.strokeStyle=Z||u,t.stroke(),t.restore()}if(a!==ko&&(d!==0||l===ni)){C=x.split(" ").length-1;let X=Se(x);for(let Z=0;Z<X.length;Z++){let V=X[Z];if(V===" "&&!F&&l===ni)w+=(c-r*2-A)/C;this._partialTextX=w,this._partialTextY=_+v,this._partialText=V,t.fillStrokeShape(this),w+=this.measureSize(V).width+d}}else{if(d!==0)t.setAttr("letterSpacing",`${d}px`);this._partialTextX=w,this._partialTextY=_+v,this._partialText=x,t.fillStrokeShape(this)}if(t.restore(),i>1)_+=s}}_hitFunc(t){let e=this.getWidth(),i=this.getHeight();t.beginPath(),t.rect(0,0,e,i),t.closePath(),t.fillStrokeShape(this)}setText(t){let e=sn.Util._isString(t)?t:t===null||t===void 0?"":t+"";return this._setAttr(m4,e),this}getWidth(){return this.attrs.width===Ie||this.attrs.width===void 0?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){return this.attrs.height===Ie||this.attrs.height===void 0?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return sn.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(t){var e,i,r,n,s,o,a,h,l,c,d;let u=nn(),g=this.fontSize(),p;u.save(),u.font=this._getContextFont(),p=u.measureText(t),u.restore();let m=g/100;return{actualBoundingBoxAscent:(e=p.actualBoundingBoxAscent)!==null&&e!==void 0?e:71.58203125*m,actualBoundingBoxDescent:(i=p.actualBoundingBoxDescent)!==null&&i!==void 0?i:0,actualBoundingBoxLeft:(r=p.actualBoundingBoxLeft)!==null&&r!==void 0?r:-7.421875*m,actualBoundingBoxRight:(n=p.actualBoundingBoxRight)!==null&&n!==void 0?n:75.732421875*m,alphabeticBaseline:(s=p.alphabeticBaseline)!==null&&s!==void 0?s:0,emHeightAscent:(o=p.emHeightAscent)!==null&&o!==void 0?o:100*m,emHeightDescent:(a=p.emHeightDescent)!==null&&a!==void 0?a:-20*m,fontBoundingBoxAscent:(h=p.fontBoundingBoxAscent)!==null&&h!==void 0?h:91*m,fontBoundingBoxDescent:(l=p.fontBoundingBoxDescent)!==null&&l!==void 0?l:21*m,hangingBaseline:(c=p.hangingBaseline)!==null&&c!==void 0?c:72.80000305175781*m,ideographicBaseline:(d=p.ideographicBaseline)!==null&&d!==void 0?d:-21*m,width:p.width,height:g}}_getContextFont(){return this.fontStyle()+Vi+this.fontVariant()+Vi+(this.fontSize()+w4)+M4(this.fontFamily())}_addTextLine(t){if(this.align()===ni)t=t.trim();let i=this._getTextWidth(t);return this.textArr.push({text:t,width:i,lastInParagraph:!1})}_getTextWidth(t){let e=this.letterSpacing(),i=t.length;return nn().measureText(t).width+e*i}_setTextData(){let t=this.text().split(`
`),e=+this.fontSize(),i=0,r=this.lineHeight()*e,n=this.attrs.width,s=this.attrs.height,o=n!==Ie&&n!==void 0,a=s!==Ie&&s!==void 0,h=this.padding(),l=n-h*2,c=s-h*2,d=0,u=this.wrap(),g=u!==Lo,p=u!==v4&&g,m=this.ellipsis();this.textArr=[],nn().font=this._getContextFont();let f=m?this._getTextWidth(rn):0;for(let _=0,y=t.length;_<y;++_){let w=t[_],v=this._getTextWidth(w);if(o&&v>l)while(w.length>0){let b=0,x=Se(w).length,A="",F=0;while(b<x){let C=b+x>>>1,L=Se(w),S=L.slice(0,C+1).join(""),z=this._getTextWidth(S)+f;if(z<=l)b=C+1,A=S,F=z;else x=C}if(A){if(p){let S=Se(w),z=Se(A),pt=S[z.length],X=pt===Vi||pt===So,Z;if(X&&F<=l)Z=z.length;else{let V=z.lastIndexOf(Vi),Ct=z.lastIndexOf(So);Z=Math.max(V,Ct)+1}if(Z>0)b=Z,A=S.slice(0,b).join(""),F=this._getTextWidth(A)}if(A=A.trimRight(),this._addTextLine(A),i=Math.max(i,F),d+=r,this._shouldHandleEllipsis(d)){this._tryToAddEllipsisToLastLine();break}if(w=Se(w).slice(b).join("").trimLeft(),w.length>0){if(v=this._getTextWidth(w),v<=l){this._addTextLine(w),d+=r,i=Math.max(i,v);break}}}else break}else if(this._addTextLine(w),d+=r,i=Math.max(i,v),this._shouldHandleEllipsis(d)&&_<y-1)this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1])this.textArr[this.textArr.length-1].lastInParagraph=!0;if(a&&d+r>c)break}this.textHeight=e,this.textWidth=i}_shouldHandleEllipsis(t){let e=+this.fontSize(),i=this.lineHeight()*e,r=this.attrs.height,n=r!==Ie&&r!==void 0,s=this.padding(),o=r-s*2;return this.wrap()===Lo||n&&t+i>o}_tryToAddEllipsisToLastLine(){let t=this.attrs.width,e=t!==Ie&&t!==void 0,i=this.padding(),r=t-i*2,n=this.ellipsis(),s=this.textArr[this.textArr.length-1];if(!s||!n)return;if(e){if(!(this._getTextWidth(s.text+rn)<r))s.text=s.text.slice(0,s.text.length-3)}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(s.text+rn)}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){let t=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,e=this.hasShadow();if(t&&e)return!0;return super._useBufferCanvas()}}Po.Text=$;$.prototype._fillFunc=k4;$.prototype._strokeFunc=L4;$.prototype.className=_4;$.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"];u4._registerNode($);mt.Factory.overWriteSetter($,"width",ge.getNumberOrAutoValidator());mt.Factory.overWriteSetter($,"height",ge.getNumberOrAutoValidator());mt.Factory.addGetterSetter($,"direction",Eo);mt.Factory.addGetterSetter($,"fontFamily","Arial");mt.Factory.addGetterSetter($,"fontSize",12,ge.getNumberValidator());mt.Factory.addGetterSetter($,"fontStyle",Ao);mt.Factory.addGetterSetter($,"fontVariant",Ao);mt.Factory.addGetterSetter($,"padding",0,ge.getNumberValidator());mt.Factory.addGetterSetter($,"align",No);mt.Factory.addGetterSetter($,"verticalAlign",y4);mt.Factory.addGetterSetter($,"lineHeight",1,ge.getNumberValidator());mt.Factory.addGetterSetter($,"wrap",b4);mt.Factory.addGetterSetter($,"ellipsis",!1,ge.getBooleanValidator());mt.Factory.addGetterSetter($,"letterSpacing",0,ge.getNumberValidator());mt.Factory.addGetterSetter($,"text","",ge.getStringValidator());mt.Factory.addGetterSetter($,"textDecoration","")});var Uo=N((Oo)=>{Object.defineProperty(Oo,"__esModule",{value:!0});Oo.TextPath=void 0;var an=J(),Rt=G(),A4=ct(),si=Bi(),hn=on(),To=R(),F4=I(),P4="",Io="normal";function Go(t){t.fillText(this.partialText,0,0)}function Ro(t){t.strokeText(this.partialText,0,0)}class lt extends A4.Shape{constructor(t){super(t);this.dummyCanvas=an.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return si.Path.getPathLength(this.dataArray)}_getPointAtLength(t){if(!this.attrs.data)return null;let e=this.pathLength;if(t-1>e)return null;return si.Path.getPointAtLengthOfDataArray(t,this.dataArray)}_readDataAttribute(){this.dataArray=si.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(t){t.setAttr("font",this._getContextFont()),t.setAttr("textBaseline",this.textBaseline()),t.setAttr("textAlign","left"),t.save();let e=this.textDecoration(),i=this.fill(),r=this.fontSize(),n=this.glyphInfo;if(e==="underline")t.beginPath();for(let s=0;s<n.length;s++){t.save();let o=n[s].p0;if(t.translate(o.x,o.y),t.rotate(n[s].rotation),this.partialText=n[s].text,t.fillStrokeShape(this),e==="underline"){if(s===0)t.moveTo(0,r/2+1);t.lineTo(r,r/2+1)}t.restore()}if(e==="underline")t.strokeStyle=i,t.lineWidth=r/20,t.stroke();t.restore()}_hitFunc(t){t.beginPath();let e=this.glyphInfo;if(e.length>=1){let i=e[0].p0;t.moveTo(i.x,i.y)}for(let i=0;i<e.length;i++){let r=e[i].p1;t.lineTo(r.x,r.y)}t.setAttr("lineWidth",this.fontSize()),t.setAttr("strokeStyle",this.colorKey),t.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return an.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(t){return hn.Text.prototype.setText.call(this,t)}_getContextFont(){return hn.Text.prototype._getContextFont.call(this)}_getTextSize(t){let i=this.dummyCanvas.getContext("2d");i.save(),i.font=this._getContextFont();let r=i.measureText(t);return i.restore(),{width:r.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){let{width:t,height:e}=this._getTextSize(this.attrs.text);if(this.textWidth=t,this.textHeight=e,this.glyphInfo=[],!this.attrs.data)return null;let i=this.letterSpacing(),r=this.align(),n=this.kerningFunc(),s=Math.max(this.textWidth+((this.attrs.text||"").length-1)*i,0),o=0;if(r==="center")o=Math.max(0,this.pathLength/2-s/2);if(r==="right")o=Math.max(0,this.pathLength-s);let a=hn.stringToArray(this.text()),h=o;for(let l=0;l<a.length;l++){let c=this._getPointAtLength(h);if(!c)return;let d=this._getTextSize(a[l]).width+i;if(a[l]===" "&&r==="justify"){let _=this.text().split(" ").length-1;d+=(this.pathLength-s)/_}let u=this._getPointAtLength(h+d);if(!u)return;let g=si.Path.getLineLength(c.x,c.y,u.x,u.y),p=0;if(n)try{p=n(a[l-1],a[l])*this.fontSize()}catch(_){p=0}c.x+=p,u.x+=p,this.textWidth+=p;let m=si.Path.getPointOnLine(p+g/2,c.x,c.y,u.x,u.y),f=Math.atan2(u.y-c.y,u.x-c.x);this.glyphInfo.push({transposeX:m.x,transposeY:m.y,text:a[l],rotation:f,p0:c,p1:u}),h+=d}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};let t=[];this.glyphInfo.forEach(function(h){t.push(h.p0.x),t.push(h.p0.y),t.push(h.p1.x),t.push(h.p1.y)});let e=t[0]||0,i=t[0]||0,r=t[1]||0,n=t[1]||0,s,o;for(let h=0;h<t.length/2;h++)s=t[h*2],o=t[h*2+1],e=Math.min(e,s),i=Math.max(i,s),r=Math.min(r,o),n=Math.max(n,o);let a=this.fontSize();return{x:e-a/2,y:r-a/2,width:i-e+a,height:n-r+a}}destroy(){return an.Util.releaseCanvas(this.dummyCanvas),super.destroy()}}Oo.TextPath=lt;lt.prototype._fillFunc=Go;lt.prototype._strokeFunc=Ro;lt.prototype._fillFuncHit=Go;lt.prototype._strokeFuncHit=Ro;lt.prototype.className="TextPath";lt.prototype._attrsAffectingSize=["text","fontSize","data"];F4._registerNode(lt);Rt.Factory.addGetterSetter(lt,"data");Rt.Factory.addGetterSetter(lt,"fontFamily","Arial");Rt.Factory.addGetterSetter(lt,"fontSize",12,To.getNumberValidator());Rt.Factory.addGetterSetter(lt,"fontStyle",Io);Rt.Factory.addGetterSetter(lt,"align","left");Rt.Factory.addGetterSetter(lt,"letterSpacing",0,To.getNumberValidator());Rt.Factory.addGetterSetter(lt,"textBaseline","middle");Rt.Factory.addGetterSetter(lt,"fontVariant",Io);Rt.Factory.addGetterSetter(lt,"text",P4);Rt.Factory.addGetterSetter(lt,"textDecoration","");Rt.Factory.addGetterSetter(lt,"kerningFunc",void 0)});var Ko=N((jo)=>{Object.defineProperty(jo,"__esModule",{value:!0});jo.Transformer=void 0;var j=J(),H=G(),qo=nt(),D4=ct(),T4=Jr(),zo=Ti(),Ot=I(),fe=R(),I4=I(),Ho="tr-konva",G4=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map((t)=>t+`.${Ho}`).join(" "),Vo="nodesRect",R4=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],O4={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135},B4="ontouchstart"in Ot.Konva._global;function U4(t,e,i){if(t==="rotater")return i;e+=j.Util.degToRad(O4[t]||0);let r=(j.Util.radToDeg(e)%360+360)%360;if(j.Util._inRange(r,337.5,360)||j.Util._inRange(r,0,22.5))return"ns-resize";else if(j.Util._inRange(r,22.5,67.5))return"nesw-resize";else if(j.Util._inRange(r,67.5,112.5))return"ew-resize";else if(j.Util._inRange(r,112.5,157.5))return"nwse-resize";else if(j.Util._inRange(r,157.5,202.5))return"ns-resize";else if(j.Util._inRange(r,202.5,247.5))return"nesw-resize";else if(j.Util._inRange(r,247.5,292.5))return"ew-resize";else if(j.Util._inRange(r,292.5,337.5))return"nwse-resize";else return j.Util.error("Transformer has unknown angle for cursor detection: "+r),"pointer"}var Hi=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],Wo=1e8;function q4(t){return{x:t.x+t.width/2*Math.cos(t.rotation)+t.height/2*Math.sin(-t.rotation),y:t.y+t.height/2*Math.cos(t.rotation)+t.width/2*Math.sin(t.rotation)}}function Yo(t,e,i){let r=i.x+(t.x-i.x)*Math.cos(e)-(t.y-i.y)*Math.sin(e),n=i.y+(t.x-i.x)*Math.sin(e)+(t.y-i.y)*Math.cos(e);return{...t,rotation:t.rotation+e,x:r,y:n}}function z4(t,e){let i=q4(t);return Yo(t,e,i)}function V4(t,e,i){let r=e;for(let n=0;n<t.length;n++){let s=Ot.Konva.getAngle(t[n]),o=Math.abs(s-e)%(Math.PI*2);if(Math.min(o,Math.PI*2-o)<i)r=s}return r}var ln=0;class U extends zo.Group{constructor(t){super(t);if(this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(G4,this.update),this.getNode())this.update()}attachTo(t){return this.setNode(t),this}setNode(t){return j.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([t])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return Ho+this._id}setNodes(t=[]){if(this._nodes&&this._nodes.length)this.detach();let e=t.filter((r)=>{if(r.isAncestorOf(this))return j.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1;return!0});if(this._nodes=t=e,t.length===1&&this.useSingleNodeRotation())this.rotation(t[0].getAbsoluteRotation());else this.rotation(0);if(this._nodes.forEach((r)=>{let n=()=>{if(this.nodes().length===1&&this.useSingleNodeRotation())this.rotation(this.nodes()[0].getAbsoluteRotation());if(this._resetTransformCache(),!this._transforming&&!this.isDragging())this.update()},s=r._attrsAffectingSize.map((o)=>o+"Change."+this._getEventNamespace()).join(" ");r.on(s,n),r.on(R4.map((o)=>o+`.${this._getEventNamespace()}`).join(" "),n),r.on(`absoluteTransformChange.${this._getEventNamespace()}`,n),this._proxyDrag(r)}),this._resetTransformCache(),!!this.findOne(".top-left"))this.update();return this}_proxyDrag(t){let e;t.on(`dragstart.${this._getEventNamespace()}`,(i)=>{if(e=t.getAbsolutePosition(),!this.isDragging()&&t!==this.findOne(".back"))this.startDrag(i,!1)}),t.on(`dragmove.${this._getEventNamespace()}`,(i)=>{if(!e)return;let r=t.getAbsolutePosition(),n=r.x-e.x,s=r.y-e.y;this.nodes().forEach((o)=>{if(o===t)return;if(o.isDragging())return;let a=o.getAbsolutePosition();o.setAbsolutePosition({x:a.x+n,y:a.y+s}),o.startDrag(i)}),e=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){if(this._nodes)this._nodes.forEach((t)=>{t.off("."+this._getEventNamespace())});this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(Vo),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(Vo,this.__getNodeRect)}__getNodeShape(t,e=this.rotation(),i){let r=t.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),n=t.getAbsoluteScale(i),s=t.getAbsolutePosition(i),o=r.x*n.x-t.offsetX()*n.x,a=r.y*n.y-t.offsetY()*n.y,h=(Ot.Konva.getAngle(t.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),l={x:s.x+o*Math.cos(h)+a*Math.sin(-h),y:s.y+a*Math.cos(h)+o*Math.sin(h),width:r.width*n.x,height:r.height*n.y,rotation:h};return Yo(l,-Ot.Konva.getAngle(e),{x:0,y:0})}__getNodeRect(){if(!this.getNode())return{x:-Wo,y:-Wo,width:0,height:0,rotation:0};let e=[];this.nodes().map((h)=>{let l=h.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),c=[{x:l.x,y:l.y},{x:l.x+l.width,y:l.y},{x:l.x+l.width,y:l.y+l.height},{x:l.x,y:l.y+l.height}],d=h.getAbsoluteTransform();c.forEach(function(u){let g=d.point(u);e.push(g)})});let i=new j.Transform;i.rotate(-Ot.Konva.getAngle(this.rotation()));let r=1/0,n=1/0,s=-1/0,o=-1/0;e.forEach(function(h){let l=i.point(h);if(r===void 0)r=s=l.x,n=o=l.y;r=Math.min(r,l.x),n=Math.min(n,l.y),s=Math.max(s,l.x),o=Math.max(o,l.y)}),i.invert();let a=i.point({x:r,y:n});return{x:a.x,y:a.y,width:s-r,height:o-n,rotation:Ot.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),Hi.forEach((t)=>{this._createAnchor(t)}),this._createAnchor("rotater")}_createAnchor(t){let e=new T4.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:t+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:B4?10:"auto"}),i=this;e.on("mousedown touchstart",function(r){i._handleMouseDown(r)}),e.on("dragstart",(r)=>{e.stopDrag(),r.cancelBubble=!0}),e.on("dragend",(r)=>{r.cancelBubble=!0}),e.on("mouseenter",()=>{let r=Ot.Konva.getAngle(this.rotation()),n=this.rotateAnchorCursor(),s=U4(t,r,n);e.getStage().content&&(e.getStage().content.style.cursor=s),this._cursorChange=!0}),e.on("mouseout",()=>{e.getStage().content&&(e.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(e)}_createBack(){let t=new D4.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(e,i){let r=i.getParent(),n=r.padding();if(e.beginPath(),e.rect(-n,-n,i.width()+n*2,i.height()+n*2),e.moveTo(i.width()/2,-n),r.rotateEnabled()&&r.rotateLineVisible())e.lineTo(i.width()/2,-r.rotateAnchorOffset()*j.Util._sign(i.height())-n);e.fillStrokeShape(i)},hitFunc:(e,i)=>{if(!this.shouldOverdrawWholeArea())return;let r=this.padding();e.beginPath(),e.rect(-r,-r,i.width()+r*2,i.height()+r*2),e.fillStrokeShape(i)}});this.add(t),this._proxyDrag(t),t.on("dragstart",(e)=>{e.cancelBubble=!0}),t.on("dragmove",(e)=>{e.cancelBubble=!0}),t.on("dragend",(e)=>{e.cancelBubble=!0}),this.on("dragmove",(e)=>{this.update()})}_handleMouseDown(t){if(this._transforming)return;this._movingAnchorName=t.target.name().split(" ")[0];let e=this._getNodeRect(),i=e.width,r=e.height,n=Math.sqrt(Math.pow(i,2)+Math.pow(r,2));if(this.sin=Math.abs(r/n),this.cos=Math.abs(i/n),typeof window!=="undefined")window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0);this._transforming=!0;let s=t.target.getAbsolutePosition(),o=t.target.getStage().getPointerPosition();this._anchorDragOffset={x:o.x-s.x,y:o.y-s.y},ln++,this._fire("transformstart",{evt:t.evt,target:this.getNode()}),this._nodes.forEach((a)=>{a._fire("transformstart",{evt:t.evt,target:a})})}_handleMouseMove(t){let e,i,r,n=this.findOne("."+this._movingAnchorName),s=n.getStage();s.setPointersPositions(t);let o=s.getPointerPosition(),a={x:o.x-this._anchorDragOffset.x,y:o.y-this._anchorDragOffset.y},h=n.getAbsolutePosition();if(this.anchorDragBoundFunc())a=this.anchorDragBoundFunc()(h,a,t);n.setAbsolutePosition(a);let l=n.getAbsolutePosition();if(h.x===l.x&&h.y===l.y)return;if(this._movingAnchorName==="rotater"){let v=this._getNodeRect();e=n.x()-v.width/2,i=-n.y()+v.height/2;let b=Math.atan2(-i,e)+Math.PI/2;if(v.height<0)b-=Math.PI;let A=Ot.Konva.getAngle(this.rotation())+b,F=Ot.Konva.getAngle(this.rotationSnapTolerance()),L=V4(this.rotationSnaps(),A,F)-v.rotation,S=z4(v,L);this._fitNodesInto(S,t);return}let c=this.shiftBehavior(),d;if(c==="inverted")d=this.keepRatio()&&!t.shiftKey;else if(c==="none")d=this.keepRatio();else d=this.keepRatio()||t.shiftKey;var f=this.centeredScaling()||t.altKey;if(this._movingAnchorName==="top-left"){if(d){var u=f?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};r=Math.sqrt(Math.pow(u.x-n.x(),2)+Math.pow(u.y-n.y(),2));var g=this.findOne(".top-left").x()>u.x?-1:1,p=this.findOne(".top-left").y()>u.y?-1:1;e=r*this.cos*g,i=r*this.sin*p,this.findOne(".top-left").x(u.x-e),this.findOne(".top-left").y(u.y-i)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(n.y());else if(this._movingAnchorName==="top-right"){if(d){var u=f?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};r=Math.sqrt(Math.pow(n.x()-u.x,2)+Math.pow(u.y-n.y(),2));var g=this.findOne(".top-right").x()<u.x?-1:1,p=this.findOne(".top-right").y()>u.y?-1:1;e=r*this.cos*g,i=r*this.sin*p,this.findOne(".top-right").x(u.x+e),this.findOne(".top-right").y(u.y-i)}var m=n.position();this.findOne(".top-left").y(m.y),this.findOne(".bottom-right").x(m.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(n.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(n.x());else if(this._movingAnchorName==="bottom-left"){if(d){var u=f?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};r=Math.sqrt(Math.pow(u.x-n.x(),2)+Math.pow(n.y()-u.y,2));var g=u.x<n.x()?-1:1,p=n.y()<u.y?-1:1;e=r*this.cos*g,i=r*this.sin*p,n.x(u.x-e),n.y(u.y+i)}m=n.position(),this.findOne(".top-left").x(m.x),this.findOne(".bottom-right").y(m.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(n.y());else if(this._movingAnchorName==="bottom-right"){if(d){var u=f?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};r=Math.sqrt(Math.pow(n.x()-u.x,2)+Math.pow(n.y()-u.y,2));var g=this.findOne(".bottom-right").x()<u.x?-1:1,p=this.findOne(".bottom-right").y()<u.y?-1:1;e=r*this.cos*g,i=r*this.sin*p,this.findOne(".bottom-right").x(u.x+e),this.findOne(".bottom-right").y(u.y+i)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var f=this.centeredScaling()||t.altKey;if(f){let v=this.findOne(".top-left"),b=this.findOne(".bottom-right"),x=v.x(),A=v.y(),F=this.getWidth()-b.x(),C=this.getHeight()-b.y();b.move({x:-x,y:-A}),v.move({x:F,y:C})}let _=this.findOne(".top-left").getAbsolutePosition();e=_.x,i=_.y;let y=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),w=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:e,y:i,width:y,height:w,rotation:Ot.Konva.getAngle(this.rotation())},t)}_handleMouseUp(t){this._removeEvents(t)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(t){var e;if(this._transforming){if(this._transforming=!1,typeof window!=="undefined")window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0);let i=this.getNode();if(ln--,this._fire("transformend",{evt:t,target:i}),(e=this.getLayer())===null||e===void 0||e.batchDraw(),i)this._nodes.forEach((r)=>{var n;r._fire("transformend",{evt:t,target:r}),(n=r.getLayer())===null||n===void 0||n.batchDraw()});this._movingAnchorName=null}}_fitNodesInto(t,e){let i=this._getNodeRect(),r=1;if(j.Util._inRange(t.width,-this.padding()*2-1,1)){this.update();return}if(j.Util._inRange(t.height,-this.padding()*2-1,1)){this.update();return}let n=new j.Transform;if(n.rotate(Ot.Konva.getAngle(this.rotation())),this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("left")>=0){let d=n.point({x:-this.padding()*2,y:0});t.x+=d.x,t.y+=d.y,t.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=d.x,this._anchorDragOffset.y-=d.y}else if(this._movingAnchorName&&t.width<0&&this._movingAnchorName.indexOf("right")>=0){let d=n.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=d.x,this._anchorDragOffset.y-=d.y,t.width+=this.padding()*2}if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("top")>=0){let d=n.point({x:0,y:-this.padding()*2});t.x+=d.x,t.y+=d.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=d.x,this._anchorDragOffset.y-=d.y,t.height+=this.padding()*2}else if(this._movingAnchorName&&t.height<0&&this._movingAnchorName.indexOf("bottom")>=0){let d=n.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=d.x,this._anchorDragOffset.y-=d.y,t.height+=this.padding()*2}if(this.boundBoxFunc()){let d=this.boundBoxFunc()(i,t);if(d)t=d;else j.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}let s=1e7,o=new j.Transform;o.translate(i.x,i.y),o.rotate(i.rotation),o.scale(i.width/s,i.height/s);let a=new j.Transform,h=t.width/s,l=t.height/s;if(this.flipEnabled()===!1)a.translate(t.x,t.y),a.rotate(t.rotation),a.translate(t.width<0?t.width:0,t.height<0?t.height:0),a.scale(Math.abs(h),Math.abs(l));else a.translate(t.x,t.y),a.rotate(t.rotation),a.scale(h,l);let c=a.multiply(o.invert());this._nodes.forEach((d)=>{var u;let g=d.getParent().getAbsoluteTransform(),p=d.getTransform().copy();p.translate(d.offsetX(),d.offsetY());let m=new j.Transform;m.multiply(g.copy().invert()).multiply(c).multiply(g).multiply(p);let f=m.decompose();d.setAttrs(f),(u=d.getLayer())===null||u===void 0||u.batchDraw()}),this.rotation(j.Util._getRotation(t.rotation)),this._nodes.forEach((d)=>{this._fire("transform",{evt:e,target:d}),d._fire("transform",{evt:e,target:d})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(t,e){this.findOne(t).setAttrs(e)}update(){var t;let e=this._getNodeRect();this.rotation(j.Util._getRotation(e.rotation));let{width:i,height:r}=e,n=this.enabledAnchors(),s=this.resizeEnabled(),o=this.padding(),a=this.anchorSize(),h=this.find("._anchor");h.forEach((c)=>{c.setAttrs({width:a,height:a,offsetX:a/2,offsetY:a/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:a/2+o,offsetY:a/2+o,visible:s&&n.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:i/2,y:0,offsetY:a/2+o,visible:s&&n.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:i,y:0,offsetX:a/2-o,offsetY:a/2+o,visible:s&&n.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:r/2,offsetX:a/2+o,visible:s&&n.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:i,y:r/2,offsetX:a/2-o,visible:s&&n.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:r,offsetX:a/2+o,offsetY:a/2-o,visible:s&&n.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:i/2,y:r,offsetY:a/2-o,visible:s&&n.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:i,y:r,offsetX:a/2-o,offsetY:a/2-o,visible:s&&n.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:i/2,y:-this.rotateAnchorOffset()*j.Util._sign(r)-o,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:i,height:r,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});let l=this.anchorStyleFunc();if(l)h.forEach((c)=>{l(c)});(t=this.getLayer())===null||t===void 0||t.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();let t=this.findOne("."+this._movingAnchorName);if(t)t.stopDrag()}}destroy(){if(this.getStage()&&this._cursorChange)this.getStage().content&&(this.getStage().content.style.cursor="");return zo.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return qo.Node.prototype.toObject.call(this)}clone(t){return qo.Node.prototype.clone.call(this,t)}getClientRect(){if(this.nodes().length>0)return super.getClientRect();else return{x:0,y:0,width:0,height:0}}}jo.Transformer=U;U.isTransforming=()=>{return ln>0};function W4(t){if(!(t instanceof Array))j.Util.warn("enabledAnchors value should be an array");if(t instanceof Array)t.forEach(function(e){if(Hi.indexOf(e)===-1)j.Util.warn("Unknown anchor name: "+e+". Available names are: "+Hi.join(", "))});return t||[]}U.prototype.className="Transformer";I4._registerNode(U);H.Factory.addGetterSetter(U,"enabledAnchors",Hi,W4);H.Factory.addGetterSetter(U,"flipEnabled",!0,fe.getBooleanValidator());H.Factory.addGetterSetter(U,"resizeEnabled",!0);H.Factory.addGetterSetter(U,"anchorSize",10,fe.getNumberValidator());H.Factory.addGetterSetter(U,"rotateEnabled",!0);H.Factory.addGetterSetter(U,"rotateLineVisible",!0);H.Factory.addGetterSetter(U,"rotationSnaps",[]);H.Factory.addGetterSetter(U,"rotateAnchorOffset",50,fe.getNumberValidator());H.Factory.addGetterSetter(U,"rotateAnchorCursor","crosshair");H.Factory.addGetterSetter(U,"rotationSnapTolerance",5,fe.getNumberValidator());H.Factory.addGetterSetter(U,"borderEnabled",!0);H.Factory.addGetterSetter(U,"anchorStroke","rgb(0, 161, 255)");H.Factory.addGetterSetter(U,"anchorStrokeWidth",1,fe.getNumberValidator());H.Factory.addGetterSetter(U,"anchorFill","white");H.Factory.addGetterSetter(U,"anchorCornerRadius",0,fe.getNumberValidator());H.Factory.addGetterSetter(U,"borderStroke","rgb(0, 161, 255)");H.Factory.addGetterSetter(U,"borderStrokeWidth",1,fe.getNumberValidator());H.Factory.addGetterSetter(U,"borderDash");H.Factory.addGetterSetter(U,"keepRatio",!0);H.Factory.addGetterSetter(U,"shiftBehavior","default");H.Factory.addGetterSetter(U,"centeredScaling",!1);H.Factory.addGetterSetter(U,"ignoreStroke",!1);H.Factory.addGetterSetter(U,"padding",0,fe.getNumberValidator());H.Factory.addGetterSetter(U,"nodes");H.Factory.addGetterSetter(U,"node");H.Factory.addGetterSetter(U,"boundBoxFunc");H.Factory.addGetterSetter(U,"anchorDragBoundFunc");H.Factory.addGetterSetter(U,"anchorStyleFunc");H.Factory.addGetterSetter(U,"shouldOverdrawWholeArea",!1);H.Factory.addGetterSetter(U,"useSingleNodeRotation",!0);H.Factory.backCompat(U,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"})});var $o=N((Qo)=>{Object.defineProperty(Qo,"__esModule",{value:!0});Qo.Wedge=void 0;var Yi=G(),H4=ct(),Y4=I(),Zo=R(),j4=I();class Ht extends H4.Shape{_sceneFunc(t){t.beginPath(),t.arc(0,0,this.radius(),0,Y4.Konva.getAngle(this.angle()),this.clockwise()),t.lineTo(0,0),t.closePath(),t.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(t){this.radius(t/2)}setHeight(t){this.radius(t/2)}}Qo.Wedge=Ht;Ht.prototype.className="Wedge";Ht.prototype._centroid=!0;Ht.prototype._attrsAffectingSize=["radius"];j4._registerNode(Ht);Yi.Factory.addGetterSetter(Ht,"radius",0,Zo.getNumberValidator());Yi.Factory.addGetterSetter(Ht,"angle",0,Zo.getNumberValidator());Yi.Factory.addGetterSetter(Ht,"clockwise",!1);Yi.Factory.backCompat(Ht,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"})});var na=N((ia)=>{Object.defineProperty(ia,"__esModule",{value:!0});ia.Blur=void 0;var ta=G(),X4=nt(),K4=R();function ea(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var Z4=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],Q4=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function J4(t,e){let{data:i,width:r,height:n}=t,s,o,a,h,l,c,d,u,g,p,m,f,_,y,w,v,b,x,A,F,C,L,S,z,pt=e+e+1,X=r-1,Z=n-1,V=e+1,Ct=V*(V+1)/2,T=new ea,Bt=Z4[e],ne=Q4[e],sr=null,Y=T,tt=null,wt=null;for(a=1;a<pt;a++)if(Y=Y.next=new ea,a===V)sr=Y;Y.next=T,d=c=0;for(o=0;o<n;o++){v=b=x=A=u=g=p=m=0,f=V*(F=i[c]),_=V*(C=i[c+1]),y=V*(L=i[c+2]),w=V*(S=i[c+3]),u+=Ct*F,g+=Ct*C,p+=Ct*L,m+=Ct*S,Y=T;for(a=0;a<V;a++)Y.r=F,Y.g=C,Y.b=L,Y.a=S,Y=Y.next;for(a=1;a<V;a++)h=c+((X<a?X:a)<<2),u+=(Y.r=F=i[h])*(z=V-a),g+=(Y.g=C=i[h+1])*z,p+=(Y.b=L=i[h+2])*z,m+=(Y.a=S=i[h+3])*z,v+=F,b+=C,x+=L,A+=S,Y=Y.next;tt=T,wt=sr;for(s=0;s<r;s++){if(i[c+3]=S=m*Bt>>ne,S!==0)S=255/S,i[c]=(u*Bt>>ne)*S,i[c+1]=(g*Bt>>ne)*S,i[c+2]=(p*Bt>>ne)*S;else i[c]=i[c+1]=i[c+2]=0;u-=f,g-=_,p-=y,m-=w,f-=tt.r,_-=tt.g,y-=tt.b,w-=tt.a,h=d+((h=s+e+1)<X?h:X)<<2,v+=tt.r=i[h],b+=tt.g=i[h+1],x+=tt.b=i[h+2],A+=tt.a=i[h+3],u+=v,g+=b,p+=x,m+=A,tt=tt.next,f+=F=wt.r,_+=C=wt.g,y+=L=wt.b,w+=S=wt.a,v-=F,b-=C,x-=L,A-=S,wt=wt.next,c+=4}d+=r}for(s=0;s<r;s++){b=x=A=v=g=p=m=u=0,c=s<<2,f=V*(F=i[c]),_=V*(C=i[c+1]),y=V*(L=i[c+2]),w=V*(S=i[c+3]),u+=Ct*F,g+=Ct*C,p+=Ct*L,m+=Ct*S,Y=T;for(a=0;a<V;a++)Y.r=F,Y.g=C,Y.b=L,Y.a=S,Y=Y.next;l=r;for(a=1;a<=e;a++)if(c=l+s<<2,u+=(Y.r=F=i[c])*(z=V-a),g+=(Y.g=C=i[c+1])*z,p+=(Y.b=L=i[c+2])*z,m+=(Y.a=S=i[c+3])*z,v+=F,b+=C,x+=L,A+=S,Y=Y.next,a<Z)l+=r;c=s,tt=T,wt=sr;for(o=0;o<n;o++){if(h=c<<2,i[h+3]=S=m*Bt>>ne,S>0)S=255/S,i[h]=(u*Bt>>ne)*S,i[h+1]=(g*Bt>>ne)*S,i[h+2]=(p*Bt>>ne)*S;else i[h]=i[h+1]=i[h+2]=0;u-=f,g-=_,p-=y,m-=w,f-=tt.r,_-=tt.g,y-=tt.b,w-=tt.a,h=s+((h=o+V)<Z?h:Z)*r<<2,u+=v+=tt.r=i[h],g+=b+=tt.g=i[h+1],p+=x+=tt.b=i[h+2],m+=A+=tt.a=i[h+3],tt=tt.next,f+=F=wt.r,_+=C=wt.g,y+=L=wt.b,w+=S=wt.a,v-=F,b-=C,x-=L,A-=S,wt=wt.next,c+=r}}}var $4=function t(e){let i=Math.round(this.blurRadius());if(i>0)J4(e,i)};ia.Blur=$4;ta.Factory.addGetterSetter(X4.Node,"blurRadius",0,K4.getNumberValidator(),ta.Factory.afterSetFilter)});var ha=N((oa)=>{Object.defineProperty(oa,"__esModule",{value:!0});oa.Brighten=void 0;var sa=G(),t2=nt(),e2=R(),i2=function(t){let e=this.brightness()*255,i=t.data,r=i.length;for(let n=0;n<r;n+=4)i[n]+=e,i[n+1]+=e,i[n+2]+=e};oa.Brighten=i2;sa.Factory.addGetterSetter(t2.Node,"brightness",0,e2.getNumberValidator(),sa.Factory.afterSetFilter)});var ua=N((ca)=>{Object.defineProperty(ca,"__esModule",{value:!0});ca.Contrast=void 0;var la=G(),r2=nt(),n2=R(),s2=function(t){let e=Math.pow((this.contrast()+100)/100,2),i=t.data,r=i.length,n=150,s=150,o=150;for(let a=0;a<r;a+=4)n=i[a],s=i[a+1],o=i[a+2],n/=255,n-=0.5,n*=e,n+=0.5,n*=255,s/=255,s-=0.5,s*=e,s+=0.5,s*=255,o/=255,o-=0.5,o*=e,o+=0.5,o*=255,n=n<0?0:n>255?255:n,s=s<0?0:s>255?255:s,o=o<0?0:o>255?255:o,i[a]=n,i[a+1]=s,i[a+2]=o};ca.Contrast=s2;la.Factory.addGetterSetter(r2.Node,"contrast",0,n2.getNumberValidator(),la.Factory.afterSetFilter)});var ma=N((fa)=>{Object.defineProperty(fa,"__esModule",{value:!0});fa.Emboss=void 0;var pe=G(),ji=nt(),o2=J(),ga=R(),a2=function(t){let e=this.embossStrength()*10,i=this.embossWhiteLevel()*255,r=this.embossDirection(),n=this.embossBlend(),s=t.data,o=t.width,a=t.height,h=o*4,l=0,c=0,d=a;switch(r){case"top-left":l=-1,c=-1;break;case"top":l=-1,c=0;break;case"top-right":l=-1,c=1;break;case"right":l=0,c=1;break;case"bottom-right":l=1,c=1;break;case"bottom":l=1,c=0;break;case"bottom-left":l=1,c=-1;break;case"left":l=0,c=-1;break;default:o2.Util.error("Unknown emboss direction: "+r)}do{let u=(d-1)*h,g=l;if(d+g<1)g=0;if(d+g>a)g=0;let p=(d-1+g)*o*4,m=o;do{let f=u+(m-1)*4,_=c;if(m+_<1)_=0;if(m+_>o)_=0;let y=p+(m-1+_)*4,w=s[f]-s[y],v=s[f+1]-s[y+1],b=s[f+2]-s[y+2],x=w,A=x>0?x:-x,F=v>0?v:-v,C=b>0?b:-b;if(F>A)x=v;if(C>A)x=b;if(x*=e,n){let L=s[f]+x,S=s[f+1]+x,z=s[f+2]+x;s[f]=L>255?255:L<0?0:L,s[f+1]=S>255?255:S<0?0:S,s[f+2]=z>255?255:z<0?0:z}else{let L=i-x;if(L<0)L=0;else if(L>255)L=255;s[f]=s[f+1]=s[f+2]=L}}while(--m)}while(--d)};fa.Emboss=a2;pe.Factory.addGetterSetter(ji.Node,"embossStrength",0.5,ga.getNumberValidator(),pe.Factory.afterSetFilter);pe.Factory.addGetterSetter(ji.Node,"embossWhiteLevel",0.5,ga.getNumberValidator(),pe.Factory.afterSetFilter);pe.Factory.addGetterSetter(ji.Node,"embossDirection","top-left",void 0,pe.Factory.afterSetFilter);pe.Factory.addGetterSetter(ji.Node,"embossBlend",!1,void 0,pe.Factory.afterSetFilter)});var wa=N((ya)=>{Object.defineProperty(ya,"__esModule",{value:!0});ya.Enhance=void 0;var _a=G(),h2=nt(),l2=R();function cn(t,e,i,r,n){let s=i-e,o=n-r;if(s===0)return r+o/2;if(o===0)return r;let a=(t-e)/s;return a=o*a+r,a}var c2=function(t){let e=t.data,i=e.length,r=e[0],n=r,s,o=e[1],a=o,h,l=e[2],c=l,d,u=this.enhance();if(u===0)return;for(let x=0;x<i;x+=4){if(s=e[x+0],s<r)r=s;else if(s>n)n=s;if(h=e[x+1],h<o)o=h;else if(h>a)a=h;if(d=e[x+2],d<l)l=d;else if(d>c)c=d}if(n===r)n=255,r=0;if(a===o)a=255,o=0;if(c===l)c=255,l=0;let g,p,m,f,_,y,w,v,b;if(u>0)p=n+u*(255-n),m=r-u*(r-0),_=a+u*(255-a),y=o-u*(o-0),v=c+u*(255-c),b=l-u*(l-0);else g=(n+r)*0.5,p=n+u*(n-g),m=r+u*(r-g),f=(a+o)*0.5,_=a+u*(a-f),y=o+u*(o-f),w=(c+l)*0.5,v=c+u*(c-w),b=l+u*(l-w);for(let x=0;x<i;x+=4)e[x+0]=cn(e[x+0],r,n,m,p),e[x+1]=cn(e[x+1],o,a,y,_),e[x+2]=cn(e[x+2],l,c,b,v)};ya.Enhance=c2;_a.Factory.addGetterSetter(h2.Node,"enhance",0,l2.getNumberValidator(),_a.Factory.afterSetFilter)});var va=N((xa)=>{Object.defineProperty(xa,"__esModule",{value:!0});xa.Grayscale=void 0;var d2=function(t){let e=t.data,i=e.length;for(let r=0;r<i;r+=4){let n=0.34*e[r]+0.5*e[r+1]+0.16*e[r+2];e[r]=n,e[r+1]=n,e[r+2]=n}};xa.Grayscale=d2});var ka=N((Sa)=>{Object.defineProperty(Sa,"__esModule",{value:!0});Sa.HSL=void 0;var Ge=G(),dn=nt(),un=R();Ge.Factory.addGetterSetter(dn.Node,"hue",0,un.getNumberValidator(),Ge.Factory.afterSetFilter);Ge.Factory.addGetterSetter(dn.Node,"saturation",0,un.getNumberValidator(),Ge.Factory.afterSetFilter);Ge.Factory.addGetterSetter(dn.Node,"luminance",0,un.getNumberValidator(),Ge.Factory.afterSetFilter);var u2=function(t){let e=t.data,i=e.length,n=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=this.luminance()*127,a=1*n*Math.cos(s*Math.PI/180),h=1*n*Math.sin(s*Math.PI/180),l=0.299+0.701*a+0.167*h,c=0.587-0.587*a+0.33*h,d=0.114-0.114*a-0.497*h,u=0.299-0.299*a-0.328*h,g=0.587+0.413*a+0.035*h,p=0.114-0.114*a+0.293*h,m=0.299-0.3*a+1.25*h,f=0.587-0.586*a-1.05*h,_=0.114+0.886*a-0.2*h,y,w,v,b;for(let x=0;x<i;x+=4)y=e[x+0],w=e[x+1],v=e[x+2],b=e[x+3],e[x+0]=l*y+c*w+d*v+o,e[x+1]=u*y+g*w+p*v+o,e[x+2]=m*y+f*w+_*v+o,e[x+3]=b};Sa.HSL=u2});var Na=N((La)=>{Object.defineProperty(La,"__esModule",{value:!0});La.HSV=void 0;var Re=G(),gn=nt(),fn=R(),g2=function(t){let e=t.data,i=e.length,r=Math.pow(2,this.value()),n=Math.pow(2,this.saturation()),s=Math.abs(this.hue()+360)%360,o=r*n*Math.cos(s*Math.PI/180),a=r*n*Math.sin(s*Math.PI/180),h=0.299*r+0.701*o+0.167*a,l=0.587*r-0.587*o+0.33*a,c=0.114*r-0.114*o-0.497*a,d=0.299*r-0.299*o-0.328*a,u=0.587*r+0.413*o+0.035*a,g=0.114*r-0.114*o+0.293*a,p=0.299*r-0.3*o+1.25*a,m=0.587*r-0.586*o-1.05*a,f=0.114*r+0.886*o-0.2*a,_,y,w,v;for(let b=0;b<i;b+=4)_=e[b+0],y=e[b+1],w=e[b+2],v=e[b+3],e[b+0]=h*_+l*y+c*w,e[b+1]=d*_+u*y+g*w,e[b+2]=p*_+m*y+f*w,e[b+3]=v};La.HSV=g2;Re.Factory.addGetterSetter(gn.Node,"hue",0,fn.getNumberValidator(),Re.Factory.afterSetFilter);Re.Factory.addGetterSetter(gn.Node,"saturation",0,fn.getNumberValidator(),Re.Factory.afterSetFilter);Re.Factory.addGetterSetter(gn.Node,"value",0,fn.getNumberValidator(),Re.Factory.afterSetFilter)});var Pa=N((Aa)=>{Object.defineProperty(Aa,"__esModule",{value:!0});Aa.Invert=void 0;var f2=function(t){let e=t.data,i=e.length;for(let r=0;r<i;r+=4)e[r]=255-e[r],e[r+1]=255-e[r+1],e[r+2]=255-e[r+2]};Aa.Invert=f2});var Oa=N((Ga)=>{Object.defineProperty(Ga,"__esModule",{value:!0});Ga.Kaleidoscope=void 0;var Xi=G(),Ta=nt(),Da=J(),Ia=R(),p2=function(t,e,i){let r=t.data,n=e.data,s=t.width,o=t.height,a=i.polarCenterX||s/2,h=i.polarCenterY||o/2,l=Math.sqrt(a*a+h*h),c=s-a,d=o-h,u=Math.sqrt(c*c+d*d);l=u>l?u:l;let g=o,p=s,m=360/p*Math.PI/180;for(let f=0;f<p;f+=1){let _=Math.sin(f*m),y=Math.cos(f*m);for(let w=0;w<g;w+=1){c=Math.floor(a+l*w/g*y),d=Math.floor(h+l*w/g*_);let v=(d*s+c)*4,b=r[v+0],x=r[v+1],A=r[v+2],F=r[v+3];v=(f+w*s)*4,n[v+0]=b,n[v+1]=x,n[v+2]=A,n[v+3]=F}}},m2=function(t,e,i){let r=t.data,n=e.data,s=t.width,o=t.height,a=i.polarCenterX||s/2,h=i.polarCenterY||o/2,l=Math.sqrt(a*a+h*h),c=s-a,d=o-h,u=Math.sqrt(c*c+d*d);l=u>l?u:l;let g=o,p=s,m=i.polarRotation||0,f,_;for(c=0;c<s;c+=1)for(d=0;d<o;d+=1){let y=c-a,w=d-h,v=Math.sqrt(y*y+w*w)*g/l,b=(Math.atan2(w,y)*180/Math.PI+360+m)%360;b=b*p/360,f=Math.floor(b),_=Math.floor(v);let x=(_*s+f)*4,A=r[x+0],F=r[x+1],C=r[x+2],L=r[x+3];x=(d*s+c)*4,n[x+0]=A,n[x+1]=F,n[x+2]=C,n[x+3]=L}},_2=function(t){let{width:e,height:i}=t,r,n,s,o,a,h,l,c,d,u,g=Math.round(this.kaleidoscopePower()),p=Math.round(this.kaleidoscopeAngle()),m=Math.floor(e*(p%360)/360);if(g<1)return;let f=Da.Util.createCanvasElement();f.width=e,f.height=i;let _=f.getContext("2d").getImageData(0,0,e,i);Da.Util.releaseCanvas(f),p2(t,_,{polarCenterX:e/2,polarCenterY:i/2});let y=e/Math.pow(2,g);while(y<=8)y=y*2,g-=1;y=Math.ceil(y);let w=y,v=0,b=w,x=1;if(m+y>e)v=w,b=0,x=-1;for(n=0;n<i;n+=1)for(r=v;r!==b;r+=x)s=Math.round(r+m)%e,d=(e*n+s)*4,a=_.data[d+0],h=_.data[d+1],l=_.data[d+2],c=_.data[d+3],u=(e*n+r)*4,_.data[u+0]=a,_.data[u+1]=h,_.data[u+2]=l,_.data[u+3]=c;for(n=0;n<i;n+=1){w=Math.floor(y);for(o=0;o<g;o+=1){for(r=0;r<w+1;r+=1)d=(e*n+r)*4,a=_.data[d+0],h=_.data[d+1],l=_.data[d+2],c=_.data[d+3],u=(e*n+w*2-r-1)*4,_.data[u+0]=a,_.data[u+1]=h,_.data[u+2]=l,_.data[u+3]=c;w*=2}}m2(_,t,{polarRotation:0})};Ga.Kaleidoscope=_2;Xi.Factory.addGetterSetter(Ta.Node,"kaleidoscopePower",2,Ia.getNumberValidator(),Xi.Factory.afterSetFilter);Xi.Factory.addGetterSetter(Ta.Node,"kaleidoscopeAngle",0,Ia.getNumberValidator(),Xi.Factory.afterSetFilter)});var za=N((Ua)=>{Object.defineProperty(Ua,"__esModule",{value:!0});Ua.Mask=void 0;var Ba=G(),y2=nt(),C2=R();function Ki(t,e,i){let r=(i*t.width+e)*4,n=[];return n.push(t.data[r++],t.data[r++],t.data[r++],t.data[r++]),n}function oi(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2))}function w2(t){let e=[0,0,0];for(let i=0;i<t.length;i++)e[0]+=t[i][0],e[1]+=t[i][1],e[2]+=t[i][2];return e[0]/=t.length,e[1]/=t.length,e[2]/=t.length,e}function x2(t,e){let i=Ki(t,0,0),r=Ki(t,t.width-1,0),n=Ki(t,0,t.height-1),s=Ki(t,t.width-1,t.height-1),o=e||10;if(oi(i,r)<o&&oi(r,s)<o&&oi(s,n)<o&&oi(n,i)<o){let a=w2([r,i,s,n]),h=[];for(let l=0;l<t.width*t.height;l++){let c=oi(a,[t.data[l*4],t.data[l*4+1],t.data[l*4+2]]);h[l]=c<o?0:255}return h}}function b2(t,e){for(let i=0;i<t.width*t.height;i++)t.data[4*i+3]=e[i]}function v2(t,e,i){let r=[1,1,1,1,0,1,1,1,1],n=Math.round(Math.sqrt(r.length)),s=Math.floor(n/2),o=[];for(let a=0;a<i;a++)for(let h=0;h<e;h++){let l=a*e+h,c=0;for(let d=0;d<n;d++)for(let u=0;u<n;u++){let g=a+d-s,p=h+u-s;if(g>=0&&g<i&&p>=0&&p<e){let m=g*e+p,f=r[d*n+u];c+=t[m]*f}}o[l]=c===2040?255:0}return o}function S2(t,e,i){let r=[1,1,1,1,1,1,1,1,1],n=Math.round(Math.sqrt(r.length)),s=Math.floor(n/2),o=[];for(let a=0;a<i;a++)for(let h=0;h<e;h++){let l=a*e+h,c=0;for(let d=0;d<n;d++)for(let u=0;u<n;u++){let g=a+d-s,p=h+u-s;if(g>=0&&g<i&&p>=0&&p<e){let m=g*e+p,f=r[d*n+u];c+=t[m]*f}}o[l]=c>=1020?255:0}return o}function M2(t,e,i){let r=[0.1111111111111111,0.1111111111111111,0.1111111111111111,0.1111111111111111,0.1111111111111111,0.1111111111111111,0.1111111111111111,0.1111111111111111,0.1111111111111111],n=Math.round(Math.sqrt(r.length)),s=Math.floor(n/2),o=[];for(let a=0;a<i;a++)for(let h=0;h<e;h++){let l=a*e+h,c=0;for(let d=0;d<n;d++)for(let u=0;u<n;u++){let g=a+d-s,p=h+u-s;if(g>=0&&g<i&&p>=0&&p<e){let m=g*e+p,f=r[d*n+u];c+=t[m]*f}}o[l]=c}return o}var k2=function(t){let e=this.threshold(),i=x2(t,e);if(i)i=v2(i,t.width,t.height),i=S2(i,t.width,t.height),i=M2(i,t.width,t.height),b2(t,i);return t};Ua.Mask=k2;Ba.Factory.addGetterSetter(y2.Node,"threshold",0,C2.getNumberValidator(),Ba.Factory.afterSetFilter)});var Ya=N((Wa)=>{Object.defineProperty(Wa,"__esModule",{value:!0});Wa.Noise=void 0;var Va=G(),L2=nt(),E2=R(),N2=function(t){let e=this.noise()*255,i=t.data,r=i.length,n=e/2;for(let s=0;s<r;s+=4)i[s+0]+=n-2*n*Math.random(),i[s+1]+=n-2*n*Math.random(),i[s+2]+=n-2*n*Math.random()};Wa.Noise=N2;Va.Factory.addGetterSetter(L2.Node,"noise",0.2,E2.getNumberValidator(),Va.Factory.afterSetFilter)});var Za=N((Xa)=>{Object.defineProperty(Xa,"__esModule",{value:!0});Xa.Pixelate=void 0;var ja=G(),A2=J(),F2=nt(),P2=R(),D2=function(t){let e=Math.ceil(this.pixelSize()),i=t.width,r=t.height,n,s,o,a,h,l,c,d=Math.ceil(i/e),u=Math.ceil(r/e),g,p,m,f,_,y,w,v=t.data;if(e<=0){A2.Util.error("pixelSize value can not be <= 0");return}for(_=0;_<d;_+=1)for(y=0;y<u;y+=1){a=0,h=0,l=0,c=0,g=_*e,p=g+e,m=y*e,f=m+e,w=0;for(n=g;n<p;n+=1){if(n>=i)continue;for(s=m;s<f;s+=1){if(s>=r)continue;o=(i*s+n)*4,a+=v[o+0],h+=v[o+1],l+=v[o+2],c+=v[o+3],w+=1}}a=a/w,h=h/w,l=l/w,c=c/w;for(n=g;n<p;n+=1){if(n>=i)continue;for(s=m;s<f;s+=1){if(s>=r)continue;o=(i*s+n)*4,v[o+0]=a,v[o+1]=h,v[o+2]=l,v[o+3]=c}}}};Xa.Pixelate=D2;ja.Factory.addGetterSetter(F2.Node,"pixelSize",8,P2.getNumberValidator(),ja.Factory.afterSetFilter)});var t0=N((Ja)=>{Object.defineProperty(Ja,"__esModule",{value:!0});Ja.Posterize=void 0;var Qa=G(),T2=nt(),I2=R(),G2=function(t){let e=Math.round(this.levels()*254)+1,i=t.data,r=i.length,n=255/e;for(let s=0;s<r;s+=1)i[s]=Math.floor(i[s]/n)*n};Ja.Posterize=G2;Qa.Factory.addGetterSetter(T2.Node,"levels",0.5,I2.getNumberValidator(),Qa.Factory.afterSetFilter)});var r0=N((e0)=>{Object.defineProperty(e0,"__esModule",{value:!0});e0.RGB=void 0;var Zi=G(),pn=nt(),R2=R(),O2=function(t){let e=t.data,i=e.length,r=this.red(),n=this.green(),s=this.blue();for(let o=0;o<i;o+=4){let a=(0.34*e[o]+0.5*e[o+1]+0.16*e[o+2])/255;e[o]=a*r,e[o+1]=a*n,e[o+2]=a*s,e[o+3]=e[o+3]}};e0.RGB=O2;Zi.Factory.addGetterSetter(pn.Node,"red",0,function(t){if(this._filterUpToDate=!1,t>255)return 255;else if(t<0)return 0;else return Math.round(t)});Zi.Factory.addGetterSetter(pn.Node,"green",0,function(t){if(this._filterUpToDate=!1,t>255)return 255;else if(t<0)return 0;else return Math.round(t)});Zi.Factory.addGetterSetter(pn.Node,"blue",0,R2.RGBComponent,Zi.Factory.afterSetFilter)});var o0=N((n0)=>{Object.defineProperty(n0,"__esModule",{value:!0});n0.RGBA=void 0;var ai=G(),Qi=nt(),B2=R(),U2=function(t){let e=t.data,i=e.length,r=this.red(),n=this.green(),s=this.blue(),o=this.alpha();for(let a=0;a<i;a+=4){let h=1-o;e[a]=r*o+e[a]*h,e[a+1]=n*o+e[a+1]*h,e[a+2]=s*o+e[a+2]*h}};n0.RGBA=U2;ai.Factory.addGetterSetter(Qi.Node,"red",0,function(t){if(this._filterUpToDate=!1,t>255)return 255;else if(t<0)return 0;else return Math.round(t)});ai.Factory.addGetterSetter(Qi.Node,"green",0,function(t){if(this._filterUpToDate=!1,t>255)return 255;else if(t<0)return 0;else return Math.round(t)});ai.Factory.addGetterSetter(Qi.Node,"blue",0,B2.RGBComponent,ai.Factory.afterSetFilter);ai.Factory.addGetterSetter(Qi.Node,"alpha",1,function(t){if(this._filterUpToDate=!1,t>1)return 1;else if(t<0)return 0;else return t})});var l0=N((a0)=>{Object.defineProperty(a0,"__esModule",{value:!0});a0.Sepia=void 0;var q2=function(t){let e=t.data,i=e.length;for(let r=0;r<i;r+=4){let n=e[r+0],s=e[r+1],o=e[r+2];e[r+0]=Math.min(255,n*0.393+s*0.769+o*0.189),e[r+1]=Math.min(255,n*0.349+s*0.686+o*0.168),e[r+2]=Math.min(255,n*0.272+s*0.534+o*0.131)}};a0.Sepia=q2});var u0=N((c0)=>{Object.defineProperty(c0,"__esModule",{value:!0});c0.Solarize=void 0;var z2=function(t){let{data:e,width:i,height:r}=t,n=i*4,s=r;do{let o=(s-1)*n,a=i;do{let h=o+(a-1)*4,l=e[h],c=e[h+1],d=e[h+2];if(l>127)l=255-l;if(c>127)c=255-c;if(d>127)d=255-d;e[h]=l,e[h+1]=c,e[h+2]=d}while(--a)}while(--s)};c0.Solarize=z2});var m0=N((f0)=>{Object.defineProperty(f0,"__esModule",{value:!0});f0.Threshold=void 0;var g0=G(),V2=nt(),W2=R(),H2=function(t){let e=this.threshold()*255,i=t.data,r=i.length;for(let n=0;n<r;n+=1)i[n]=i[n]<e?0:255};f0.Threshold=H2;g0.Factory.addGetterSetter(V2.Node,"threshold",0.5,W2.getNumberValidator(),g0.Factory.afterSetFilter)});var x0=N((C0)=>{Object.defineProperty(C0,"__esModule",{value:!0});C0.Konva=void 0;var _0=w1(),Y2=S1(),j2=q1(),X2=W1(),K2=X1(),Z2=Q1(),y0=io(),Q2=Vr(),J2=Bi(),$2=Jr(),t6=lo(),e6=mo(),i6=wo(),r6=vo(),n6=on(),s6=Uo(),o6=Ko(),a6=$o(),h6=na(),l6=ha(),c6=ua(),d6=ma(),u6=wa(),g6=va(),f6=ka(),p6=Na(),m6=Pa(),_6=Oa(),y6=za(),C6=Ya(),w6=Za(),x6=t0(),b6=r0(),v6=o0(),S6=l0(),M6=u0(),k6=m0();C0.Konva=_0.Konva.Util._assign(_0.Konva,{Arc:Y2.Arc,Arrow:j2.Arrow,Circle:X2.Circle,Ellipse:K2.Ellipse,Image:Z2.Image,Label:y0.Label,Tag:y0.Tag,Line:Q2.Line,Path:J2.Path,Rect:$2.Rect,RegularPolygon:t6.RegularPolygon,Ring:e6.Ring,Sprite:i6.Sprite,Star:r6.Star,Text:n6.Text,TextPath:s6.TextPath,Transformer:o6.Transformer,Wedge:a6.Wedge,Filters:{Blur:h6.Blur,Brighten:l6.Brighten,Contrast:c6.Contrast,Emboss:d6.Emboss,Enhance:u6.Enhance,Grayscale:g6.Grayscale,HSL:f6.HSL,HSV:p6.HSV,Invert:m6.Invert,Kaleidoscope:_6.Kaleidoscope,Mask:y6.Mask,Noise:C6.Noise,Pixelate:w6.Pixelate,Posterize:x6.Posterize,RGB:b6.RGB,RGBA:v6.RGBA,Sepia:S6.Sepia,Solarize:M6.Solarize,Threshold:k6.Threshold}})});var Et=N((b0,v0)=>{Object.defineProperty(b0,"__esModule",{value:!0});var L6=x0();v0.exports=L6.Konva});import{addLocalesMessages as mh}from"@blockcode/core";var vn={"paint.contextMenu.duplicate":"duplicate","paint.contextMenu.export":"export","paint.contextMenu.delete":"delete","paint.actionButton.upload":"Upload Image","paint.actionButton.uploadCostume":"Upload Costume","paint.actionButton.uploadBackdrop":"Upload Backdrop","paint.actionButton.uploadError":'Upload "{file}" failed.',"paint.actionButton.surprise":"Surprise","paint.actionButton.paint":"Paint","paint.actionButton.image":"Choose a Image","paint.actionButton.costume":"Choose a Costume","paint.actionButton.backdrop":"Choose a Backdrop","paint.painter.image":"Image","paint.painter.costume":"Costume","paint.painter.backdrop":"Backdrop","paint.painter.name":"name","paint.painter.undo":"Undo","paint.painter.redo":"Redo","paint.painter.pen":"Pen","paint.painter.eraser":"Eraser","paint.painter.fill":"Fill","paint.painter.text":"Text","paint.painter.line":"Line","paint.painter.curve":"Curve","paint.painter.rectangle":"Rectangle","paint.painter.circle":"Circle","paint.painter.isogon":"Isogon","paint.painter.polygon":"Polygon","paint.painter.select":"Select","paint.painter.center":"Center","paint.painter.outline":"Outline","paint.colorPicker.color":"Color","paint.colorPicker.saturation":"Saturation","paint.colorPicker.brightness":"Brightness","paint.mode.bitmap":"Convert to Bitmap","paint.mode.tileMap":"Convert to TileMap"};var Sn={"paint.contextMenu.duplicate":"复制","paint.contextMenu.export":"导出","paint.contextMenu.delete":"删除","paint.actionButton.upload":"上传图片","paint.actionButton.uploadCostume":"上传造型","paint.actionButton.uploadBackdrop":"上传背景","paint.actionButton.uploadError":"上传“{file}”失败。","paint.actionButton.surprise":"随机","paint.actionButton.paint":"绘制","paint.actionButton.image":"选择一个图片","paint.actionButton.costume":"选择一个造型","paint.actionButton.backdrop":"选择一个背景","paint.painter.image":"图片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤销","paint.painter.redo":"重做","paint.painter.pen":"画笔","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"线段","paint.painter.curve":"曲线","paint.painter.rectangle":"矩形","paint.painter.circle":"圆形","paint.painter.isogon":"正多边形","paint.painter.polygon":"任意多边形","paint.painter.select":"选择","paint.painter.center":"中心","paint.painter.outline":"轮廓","paint.colorPicker.color":"颜色","paint.colorPicker.saturation":"饱和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"转换为位图","paint.mode.tileMap":"转换为拼贴地图"};var Mn={"paint.contextMenu.duplicate":"複製","paint.contextMenu.export":"導齣","paint.contextMenu.delete":"刪除","paint.actionButton.upload":"上傳圖片","paint.actionButton.uploadCostume":"上傳造型","paint.actionButton.uploadBackdrop":"上傳背景","paint.actionButton.uploadError":"上傳“{file}”失敗。","paint.actionButton.surprise":"隨機","paint.actionButton.paint":"繪製","paint.actionButton.image":"選擇一個圖片","paint.actionButton.costume":"選擇一個造型","paint.actionButton.backdrop":"選擇一個背景","paint.painter.image":"圖片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤銷","paint.painter.redo":"重做","paint.painter.pen":"畫筆","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"線段","paint.painter.curve":"曲線","paint.painter.rectangle":"矩形","paint.painter.circle":"圓形","paint.painter.isogon":"正多邊形","paint.painter.polygon":"任意多邊形","paint.painter.select":"選擇","paint.painter.center":"中心","paint.painter.outline":"輪廓","paint.colorPicker.color":"顏色","paint.colorPicker.saturation":"飽和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"轉換爲位圖","paint.mode.tileMap":"轉換爲 TileMap"};mh({en:vn,"zh-Hans":Sn,"zh-Hant":Mn});import{keyMirror as _h}from"@blockcode/utils";var ut=_h({Image:null,Costume:null,Backdrop:null,Tile:null,TileMap:null});import{nanoid as kn}from"@blockcode/utils";var or="image/png",Ln=`data:${or};base64,`.length,ci="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",li=new Map;function ar(t,e){return new Promise((i)=>{let r=new FileReader;r.readAsDataURL(t),r.addEventListener("load",()=>{let n=kn(),s=new Image;li.set(n,s),s.id=n,s.src=r.result,s.addEventListener("load",()=>{if(s.dataset.data)return i(s);let{width:o,height:a}=s;if(s.width>e.width||s.height>e.height){o=e.width,a=e.height;let d=s.width/e.width,u=s.height/e.height;if(d>u)a=s.height/d;else o=s.width/u}let h=document.createElement("canvas");h.width=o,h.height=a,h.getContext("2d").drawImage(s,0,0,o,a);let c=h.toDataURL(or);if(c==="data:,")return i(null);s.dataset.data=c.slice(Ln),s.src=c})})})}function di(t){return new Promise((e)=>{let i=li.get(t.id);if(!i)i=new Image,li.set(t.id,i);let r=`data:${t.type};base64,`;i.src=`${r}${t.data}`,i.addEventListener("load",()=>{i.dataset.data=i.src.slice(r.length),e(i)})})}function hr(t){return new Promise((e)=>{let i=kn(),r=new Image;li.set(i,r),r.id=i,r.src=t,r.addEventListener("load",()=>{let n=document.createElement("canvas");n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0,r.width,r.height);let o=n.toDataURL(or);r.dataset.data=o.slice(Ln),e(r)})})}import{useCallback as Le,useMemo as L9}from"preact/hooks";import{batch as Be}from"@preact/signals";import{nanoid as lr}from"@blockcode/utils";import{useLocalesContext as Sh,useProjectContext as Mh,translate as cr,setAlert as Tn,delAlert as kh,openAsset as In,addAsset as dr,delAsset as Lh}from"@blockcode/core";import{Text as St,IconSelector as Eh,ActionButton as Nh}from"@blockcode/core";function _t(t){let e=globalThis.document,i=e.createElement("style");i.appendChild(e.createTextNode(t)),e.head.append(i)}_t(".bRLzKG_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}.bRLzKG_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}.bRLzKG_selector-item{width:5rem;height:5rem;margin:.5rem auto}.bRLzKG_delete-menu-item:hover{background:var(--error-primary)}.bRLzKG_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.bRLzKG_add-button{margin:.75rem auto}");var _e={addButton:"bRLzKG_add-button",selectorWrapper:"bRLzKG_selector-wrapper",deleteMenuItem:"bRLzKG_delete-menu-item",selectorItemsWrapper:"bRLzKG_selector-items-wrapper",selectorItem:"bRLzKG_selector-item",addButtonWrapper:"bRLzKG_add-button-wrapper"};var En="./assets/icon-costume-zx9m3hdh.svg";var Nn="./assets/icon-backdrop-qvqgzqwj.svg";var An="./assets/icon-search-6g8kgvdt.svg";var Fn="./assets/icon-paint-0h8zs19a.svg";var Pn="./assets/icon-surprise-d5t4529a.svg";var Dn="./assets/icon-file-upload-0z25chr6.svg";import{jsx as yt,jsxs as Dh}from"preact/jsx-runtime";var Gn={[ut.Image]:yt(St,{id:"paint.actionButton.image",defaultMessage:"Choose a Image"}),[ut.Costume]:yt(St,{id:"paint.actionButton.costume",defaultMessage:"Choose a Costume"}),[ut.Backdrop]:yt(St,{id:"paint.actionButton.backdrop",defaultMessage:"Choose a Backdrop"})},Ah={[ut.Image]:yt(St,{id:"paint.actionButton.upload",defaultMessage:"Upload Image"}),[ut.Costume]:yt(St,{id:"paint.actionButton.uploadCostume",defaultMessage:"Upload Costume"}),[ut.Backdrop]:yt(St,{id:"paint.actionButton.uploadBackdrop",defaultMessage:"Upload Backdrop"})},Fh=(t,e)=>{switch(t){case ut.Image:return cr("paint.painter.image","Image",e).toLowerCase();case ut.Costume:return cr("paint.painter.costume","Costume",e).toLowerCase();case ut.Backdrop:return cr("paint.painter.backdrop","Backdrop",e).toLowerCase()}},Ph=(t)=>`data:${t.type};base64,${t.data}`;function Rn({mode:t,maxSize:e,onImagesFilter:i,onShowLibrary:r,onSurprise:n,onChange:s,onDelete:o}){let{translator:a}=Sh(),{assets:h,assetId:l,modified:c}=Mh(),d=Le(()=>{return h.value.filter((y)=>{if(!/^image\//.test(y.type))return!1;if(!i)return!0;return i(y)})},[c.value,i]),u=Le(()=>{let y=document.createElement("input");y.type="file",y.accept="image/*",y.multiple=!0,y.click(),y.addEventListener("change",async(w)=>{let v=lr();Tn("importing",{id:v});let b=[];for(let x of w.target.files){let A=await ar(x,e);if(!A)Tn({message:yt(St,{id:"paint.actionButton.uploadError",defaultMessage:'Upload "{file}" failed.',file:x.name})},2000),A={dataset:{data:ci},width:1,height:1};A.name=x.name.slice(0,x.name.lastIndexOf(".")),b.push(A)}kh(v),Be(()=>{for(let x of b)if(dr({id:x.id,type:"image/png",name:x.name,data:x.dataset.data,width:x.width,height:x.height,centerX:Math.floor(x.width/2),centerY:Math.floor(x.height/2)}),s)s(x.id)})})},[s]),g=Le(()=>{let y=lr();Be(()=>{if(dr({id:y,type:"image/png",name:Fh(t,a),data:ci,width:1,height:1,centerX:1,centerY:1}),s)s(y)})},[s]),p=Le((y)=>{let w=d(),v=w[y];Be(()=>{let b=l.value;if(v.id===l.value){if(y===0)b=w[1]?.id;else if(y+1<w.length)b=w[y+1].id;else if(y-1>-1)b=w[y-1].id}Lh(v.id),In(b),o(v.id,b)})},[o]),m=Le((y)=>{let v=d()[y],b=lr();Be(()=>{if(dr({...v,id:b}),s)s(b)})},[s]),f=Le((y,w)=>{Be(()=>{if(In(w.id),s)s(w.id)})},[s]),_=d();return Dh("div",{className:_e.selectorWrapper,children:[yt(Eh,{displayOrder:!0,id:"doodle-selector",className:_e.selectorItemsWrapper,items:_.map((y,w)=>({...y,details:`${y.width}×${y.height}`,icon:Ph(y),order:w,className:_e.selectorItem,contextMenu:[[{label:yt(St,{id:"paint.contextMenu.duplicate",defaultMessage:"duplicate"}),onClick:()=>m(w)},{label:yt(St,{id:"paint.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:yt(St,{id:"paint.contextMenu.delete",defaultMessage:"delete"}),disabled:_.length<=1,className:_e.deleteMenuItem,onClick:()=>p(w)}]]})),selectedId:l.value,onSelect:f,onDelete:_.length>1&&p}),yt("div",{className:_e.addButtonWrapper,children:yt(Nh,{tooltipPlacement:"right",className:_e.addButton,icon:t===ut.Costume?En:Nn,tooltip:Gn[t],onClick:r,moreButtons:[{icon:Dn,tooltip:Ah[t],onClick:u},{icon:Pn,tooltip:yt(St,{id:"paint.actionButton.surprise",defaultMessage:"Surprise"}),onClick:n},{icon:Fn,tooltip:yt(St,{id:"paint.actionButton.paint",defaultMessage:"Paint"}),onClick:g},{icon:An,tooltip:Gn[t],onClick:r}]})})]})}import{useCallback as gt,useEffect as j6,useMemo as X6}from"preact/hooks";import{batch as hi,useComputed as yn,useSignal as Nt}from"@preact/signals";import{classNames as At,Color as oh,MathUtils as Cn}from"@blockcode/utils";import{useLocalesContext as K6,useProjectContext as Z6,translate as ke,maybeTranslate as Q6,setAsset as er}from"@blockcode/core";import{Text as ir,Label as wn,BufferedInput as rr,Button as Me}from"@blockcode/core";import{useCallback as xt,useMemo as Gh}from"preact/hooks";import{classNames as ye,Color as Rh}from"@blockcode/utils";import{Text as gr,Tooltip as Oh}from"@blockcode/core";_t('.x5E0hW_color-picker-wrapper{width:3rem;height:2rem;margin-right:var(--space);cursor:pointer;display:flex}.x5E0hW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}.x5E0hW_color-swatch-outline:after{content:"";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}.x5E0hW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}.x5E0hW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}.x5E0hW_tooltip-item{margin:8px}.x5E0hW_tooltip-item-label{font-weight:700}.x5E0hW_tooltip-item-readout{margin-left:10px}.x5E0hW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}.x5E0hW_tooltip-item-slider-handler{background-color:var(--ui-white);width:26px;height:26px;box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;margin-top:-2px;position:absolute;left:100px}.x5E0hW_tooltip-item-toolbar{justify-content:space-between;display:flex}.x5E0hW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}.x5E0hW_tooltip-item-toolbar-button.x5E0hW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}.x5E0hW_button-icon{width:1.5rem;height:1.5rem}');var W={tooltipItemSlider:"x5E0hW_tooltip-item-slider",buttonIcon:"x5E0hW_button-icon",tooltipItem:"x5E0hW_tooltip-item",tooltipItemToolbarButton:"x5E0hW_tooltip-item-toolbar-button",colorSwatch:"x5E0hW_color-swatch",colorSwatchOutline:"x5E0hW_color-swatch-outline",colorTooltip:"x5E0hW_color-tooltip",tooltipItemReadout:"x5E0hW_tooltip-item-readout",tooltipItemToolbar:"x5E0hW_tooltip-item-toolbar",selected:"x5E0hW_selected",pickerArrow:"x5E0hW_picker-arrow",tooltipItemLabel:"x5E0hW_tooltip-item-label",colorPickerWrapper:"x5E0hW_color-picker-wrapper",tooltipItemSliderHandler:"x5E0hW_tooltip-item-slider-handler"};var On="./assets/icon-picker-2frmfa34.svg";var ur="./assets/icon-clear-gctr9axd.svg";import{jsx as Q,jsxs as Ee,Fragment as Uh}from"preact/jsx-runtime";var Bh=[0,0,324,288,252,216,180,144,108,72,36,0,0],jt=124,Ut=(t,e,i,r)=>new Rh({h:t,s:e,v:i},r),fr=(t,e)=>{t.stopPropagation();let i=t.target,r=i.offsetLeft,n=t.clientX,s=(a)=>{a.preventDefault();let h=a.clientX-n+r;if(h>=jt)h=jt;if(h<=0)h=0;i.style.left=`${h}px`,e(h/jt)},o=()=>{document.removeEventListener("pointermove",s),document.removeEventListener("pointerup",o)};document.addEventListener("pointermove",s),document.addEventListener("pointerup",o)},pr=(t,e)=>{let i=t.target.children[0],r=t.offsetX-13;if(r>=jt)r=jt;if(r<=0)r=0;i.style.left=`${r}px`,e(r/jt)};function mr({picking:t,color:e,outline:i,onChange:r,onPickingColor:n}){let s=e.hsv.h,o=e.hsv.s,a=e.hsv.v,h=xt((b)=>r(Ut(Math.round(b*360),o,a)),[o,a,r]),l=xt((b)=>r(Ut(s,b,a)),[s,a,r]),c=xt((b)=>r(Ut(s,o,b)),[s,o,r]),d=xt(()=>r(Ut(s,o,a,!0)),[s,o,a,r]),u=xt((b)=>fr(b,h),[h]),g=xt((b)=>fr(b,l),[l]),p=xt((b)=>fr(b,c),[c]),m=xt((b)=>pr(b,h),[h]),f=xt((b)=>pr(b,l),[l]),_=xt((b)=>pr(b,c),[c]),y=Gh(()=>Bh.map((b)=>Ut(b,o,a).hex),[o,a]),w=xt((b)=>b.stopPropagation(),[]),v=xt(()=>n(!t),[t,n]);return Q(Oh,{clickable:!0,placement:"bottom",className:W.colorTooltip,onHide:xt(()=>setTimeout(()=>n(!1),50),[n]),content:Ee(Uh,{children:[Ee("div",{className:W.tooltipItem,children:[Q("span",{className:W.tooltipItemLabel,children:Q(gr,{id:"paint.colorPicker.color",defaultMessage:"Color"})}),Q("span",{className:W.tooltipItemReadout,children:Math.round(s/360*100)})]}),Q("div",{className:ye(W.tooltipItem,W.tooltipItemSlider),style:{background:`linear-gradient(to left, ${y[0]} 0px, ${y[1]} 13px, ${y[2]}, ${y[3]}, ${y[4]}, ${y[5]}, ${y[6]}, ${y[7]}, ${y[8]}, ${y[9]}, ${y[10]}, ${y[11]} 137px, ${y[12]} 100%)`},onClick:m,children:Q("div",{className:W.tooltipItemSliderHandler,style:{left:`${Math.round(s/360*jt)}px`},onPointerDown:u,onClick:w})}),Ee("div",{className:W.tooltipItem,children:[Q("span",{className:W.tooltipItemLabel,children:Q(gr,{id:"paint.colorPicker.saturation",defaultMessage:"Saturation"})}),Q("span",{className:W.tooltipItemReadout,children:Math.round(o*100)})]}),Q("div",{className:ye(W.tooltipItem,W.tooltipItemSlider),style:{background:`linear-gradient(to right, ${Ut(s,0,a).hex} 0px, ${Ut(s,1,a).hex} 100%)`},onClick:f,children:Q("div",{className:W.tooltipItemSliderHandler,style:{left:`${Math.round(o*jt)}px`},onPointerDown:g,onClick:w})}),Ee("div",{className:W.tooltipItem,children:[Q("span",{className:W.tooltipItemLabel,children:Q(gr,{id:"paint.colorPicker.brightness",defaultMessage:"Brightness"})}),Q("span",{className:W.tooltipItemReadout,children:Math.round(a*100)})]}),Q("div",{className:ye(W.tooltipItem,W.tooltipItemSlider),style:{background:`linear-gradient(to right, ${Ut(s,o,0).hex} 0px, ${Ut(s,o,1).hex} 100%)`},onClick:_,children:Q("div",{className:W.tooltipItemSliderHandler,style:{left:`${Math.round(a*jt)}px`},onPointerDown:p,onClick:w})}),Ee("div",{className:ye(W.tooltipItem,W.tooltipItemToolbar),children:[Q("div",{className:ye(W.tooltipItemToolbarButton,{[W.selected]:e.clear}),onClick:d,children:Q("img",{src:ur,className:W.buttonIcon})}),Q("div",{className:ye(W.tooltipItemToolbarButton,{[W.selected]:t}),onClick:v,children:Q("img",{src:On,className:W.buttonIcon})})]})]}),children:Ee("div",{className:W.colorPickerWrapper,children:[Q("div",{className:ye(W.colorSwatch,{[W.colorSwatchOutline]:i}),style:{background:e.clear?"var(--ui-white)":Ut(s,o,a).hex},children:e.clear&&Q("img",{src:ur})}),Q("div",{className:W.pickerArrow,children:"▾"})]})})}import{useCallback as Vh,useEffect as Wh}from"preact/hooks";import{useSignal as Hh}from"@preact/signals";import{Dropdown as Yh}from"@blockcode/core";var qh=[{family:"Sans Serif"},{family:"Serif"},{family:"Handwriting"},{family:"Marker"},{family:"Curly"},{family:"Pixel"},{label:"中文",family:'"Microsoft YaHei", "微软雅黑", STXihei, "华文细黑"'},{label:"日本語",family:'"ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic"'},{label:"한국어",family:"Malgun Gothic"}],zh=(t,e)=>{let i=t.length>e.length?t:e,r=i==t?e:t,n;for(let s=0;s<r.length;s++)for(let o=0,a=r.length-s;a!=r.length+1;o++,a++)if(n=r.substring(o,a),i.indexOf(n)!=-1)return n;return""};async function Bn(){try{let t=await window.queryLocalFonts(),e=new Map,i;for(let r of t){if(/demo/i.test(r.family))continue;if(i=r.fullName,e.has(r.family))i=e.get(r.family),i=zh(i,r.fullName);e.set(r.family,i)}return e.entries().toArray().map(([r,n])=>({label:n,family:r}))}catch(t){return qh}}_t(".vaJj7G_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;height:2rem;overflow:auto}.vaJj7G_displayed-font-name{font-size:.8rem}");var _r={fontSelector:"vaJj7G_font-selector",displayedFontName:"vaJj7G_displayed-font-name"};import{jsx as Un}from"preact/jsx-runtime";function qn({font:t,onChange:e}){let i=Hh(null),r=Vh((n)=>()=>e(n),[e]);return Wh(async()=>{let n=await Bn();if(i.value=n.map((s)=>({label:s.label??s.family,style:{fontFamily:s.family},onClick:r(s)})),!t)i.value[0]?.onClick()},[t,r]),Un(Yh,{className:_r.fontSelector,items:i.value,children:Un("span",{className:_r.displayedFontName,style:{fontFamily:t?.family},children:t?.label??t?.family})})}import{useCallback as Dt}from"preact/hooks";import{classNames as Mt,keyMirror as n5}from"@blockcode/utils";import{translate as Tt,Button as It}from"@blockcode/core";_t(":root{--paint-tools-box-width:6rem}.a1L2ya_tools-box-wrapper{width:var(--paint-tools-box-width);flex-flow:wrap;place-content:flex-start space-between;display:flex}.a1L2ya_small{width:3rem}.a1L2ya_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.a1L2ya_tool-button.a1L2ya_selected{background:var(--theme-primary)}.a1L2ya_tool-icon{vertical-align:middle;width:2rem;height:2rem}.a1L2ya_tool-button.a1L2ya_selected .a1L2ya_tool-icon{filter:brightness(0)invert()}");var O={selected:"a1L2ya_selected",toolIcon:"a1L2ya_tool-icon",toolsBoxWrapper:"a1L2ya_tools-box-wrapper",toolButton:"a1L2ya_tool-button",small:"a1L2ya_small"};var ui="./assets/icon-pen-vmav54fy.svg";var gi="./assets/icon-eraser-6exvhk0q.svg";var zn="./assets/icon-fill-70s8y3f8.svg";var Vn="./assets/icon-text-e5hysycg.svg";var fi="./assets/icon-line-r61p9edw.svg";var pi="./assets/icon-curve-sngqpytw.svg";var Wn="./assets/icon-rectangle-yasy0y9k.svg";var Hn="./assets/icon-circle-ynejmr8k.svg";var mi="./assets/icon-isogon-dhadjxez.svg";var Yn="./assets/icon-polygon-d2x4vbt9.svg";var jn="./assets/icon-select-7g007t5g.svg";import{jsx as et,jsxs as s5}from"preact/jsx-runtime";var k=n5({Pen:null,Eraser:null,Fill:null,Text:null,Line:null,Curve:null,Rectangle:null,Circle:null,Isogon:null,Polygon:null,Selector:null,Center:null,ColorPicker:null,OutlineColorPicker:null});function Xn({small:t,paintTool:e,onSelect:i}){return s5("div",{className:Mt(O.toolsBoxWrapper,{[O.small]:t}),children:[et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Pen}),onClick:Dt(()=>i(k.Pen),[]),children:et("img",{src:ui,className:O.toolIcon,title:Tt("paint.painter.pen","Pen")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Eraser}),onClick:Dt(()=>i(k.Eraser),[]),children:et("img",{src:gi,className:O.toolIcon,title:Tt("paint.painter.eraser","Eraser")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Fill}),onClick:Dt(()=>i(k.Fill),[]),children:et("img",{src:zn,className:O.toolIcon,title:Tt("paint.painter.fill","Fill")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Text}),onClick:Dt(()=>i(k.Text),[]),children:et("img",{src:Vn,className:O.toolIcon,title:Tt("paint.painter.text","Text")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Line}),onClick:Dt(()=>i(k.Line),[]),children:et("img",{src:fi,className:O.toolIcon,title:Tt("paint.painter.line","Line")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Curve}),onClick:Dt(()=>i(k.Curve),[]),children:et("img",{src:pi,className:O.toolIcon,title:Tt("paint.painter.curve","Curve")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Rectangle}),onClick:Dt(()=>i(k.Rectangle),[]),children:et("img",{src:Wn,className:O.toolIcon,title:Tt("paint.painter.rectangle","Rectangle")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Circle}),onClick:Dt(()=>i(k.Circle),[]),children:et("img",{src:Hn,className:O.toolIcon,title:Tt("paint.painter.circle","Circle")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Isogon}),onClick:Dt(()=>i(k.Isogon),[]),children:et("img",{src:mi,className:O.toolIcon,title:Tt("paint.painter.isogon","Isogon")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Polygon}),onClick:Dt(()=>i(k.Polygon),[]),children:et("img",{src:Yn,className:O.toolIcon,title:Tt("paint.painter.polygon","Polygon")})}),et(It,{className:Mt(O.toolButton,{[O.selected]:e===k.Selector}),onClick:Dt(()=>i(k.Selector),[]),children:et("img",{src:jn,className:O.toolIcon,title:Tt("paint.painter.select","Select")})})]})}var vt=Pt(Et(),1);import{useEffect as tr,useRef as I6,useCallback as Oe}from"preact/hooks";import{useSignal as G6}from"@preact/signals";import{classNames as Q0,sleepMs as R6}from"@blockcode/utils";import{useProjectContext as O6,Keys as Yt}from"@blockcode/core";var E6=(t)=>{let e;for(let i=0;i<t.height;i++){e=i*t.width;for(let r=0;r<t.width;r++){if(t.data[(e<<2)+3]!==0)return i;e++}}return 0},N6=(t,e)=>{let i;for(let r=t.height-1;r>=e;r--){i=r*t.width;for(let n=0;n<t.width;n++){if(t.data[(i<<2)+3]!==0)return r;i++}}return 0},A6=(t,e,i)=>{let r;for(let n=0;n<t.width;n++)for(let s=e;s<=i;s++)if(r=s*t.width+n,t.data[(r<<2)+3]!==0)return n;return 0},F6=(t,e,i,r)=>{let n;for(let s=t.width-1;s>=r;s--)for(let o=e;o<=i;o++)if(n=o*t.width+s,t.data[(n<<2)+3]!==0)return s;return 0};function S0(t){let e=E6(t),i=N6(t,e),r=A6(t,e,i),n=F6(t,e,i,r);return{top:e,left:r,right:n,bottom:i,x:r,y:e,width:n-r+1,height:i-e+1}}var M0="image/png",P6=`data:${M0};base64,`.length;function k0(t,e){let r=t.getContext().getImageData(0,0,t.width(),t.height()),n=S0(r),o=t.toDataURL({...n,mimeType:M0}).slice(P6),a=e.x-n.x,h=e.y-n.y,l=n.width,c=n.height;return{data:o,centerX:a,centerY:h,width:l,height:c}}_t(".vAiLFq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:relative;overflow:hidden}.vAiLFq_draw-container{image-rendering:pixelated;scrollbar-gutter:stable;scrollbar-width:8px;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);margin:0;padding:0;position:absolute;inset:0;overflow:scroll}.vAiLFq_draw-container.vAiLFq_text{cursor:text}.vAiLFq_draw-container.vAiLFq_center{cursor:crosshair}.vAiLFq_draw-container.vAiLFq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}.vAiLFq_center-icon{pointer-events:none;filter:opacity(.7);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.vAiLFq_center-icon.vAiLFq_hidden{display:none}");var me={centerIcon:"vAiLFq_center-icon",hidden:"vAiLFq_hidden",picker:"vAiLFq_picker",drawBox:"vAiLFq_draw-box",text:"vAiLFq_text",center:"vAiLFq_center",drawContainer:"vAiLFq_draw-container"};var L0=Pt(Et(),1),Ji={setup(t,e){this.stage=t.getStage(),this.layer=t,this.size=e.size,this.color=e.color},onBegin(t){if(this.color.clear)return;let e=this.stage.getPointerPosition();this.poly=new L0.default.Line({stroke:this.color.hex,strokeWidth:this.size,globalCompositeOperation:this.isEraser?"destination-out":"source-over",lineCap:"round",lineJoin:"round",points:[e.x,e.y,e.x,e.y]}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.points().concat([e.x,e.y]);this.poly.points(i)},onEnd(t){this.poly=null}};var E0={...Ji,isEraser:!0};var F0=Pt(Et(),1);import{Color as N0,sleepMs as A0}from"@blockcode/utils";var P0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.pixels=[],this.color=e.color},getIndex(t,e){let i=this.layer.width();return e*i+t<<2},getPos(t){let e=this.layer.width(),i=t>>2,r=Math.floor(i/e);return{x:i-r*e,y:r}},checkPixel(t,e,i){if(t<0||e<0||t>=this.imageData.width||e>=this.imageData.height)return;let r=this.getIndex(t,e);if(this.pixels.includes(r))return;let n=this.imageData.data.slice(r,r+4),s=new N0(Array.from(n));if(s.equals(i)&&s.notEquals(this.color))this.pixels.push(r)},fill(t){let e=Math.floor(t.x),i=Math.floor(t.y),r=this.color.rgb,n=this.color.clear?0:255,s=this.layer.width(),o=this.layer.height(),a=this.layer.getContext();this.imageData=a.getImageData(0,0,s,o);let h=this.getIndex(e,i),l=this.imageData.data.slice(h,h+4),c=new N0(Array.from(l));this.checkPixel(e,i,c);let d=a.createImageData(s,o);while(this.pixels.length>0)h=this.pixels.shift(),d.data[h+0]=r.r,d.data[h+1]=r.g,d.data[h+2]=r.b,d.data[h+3]=n,this.imageData.data[h+0]=r.r,this.imageData.data[h+1]=r.g,this.imageData.data[h+2]=r.b,this.imageData.data[h+3]=n,t=this.getPos(h),this.checkPixel(t.x-1,t.y,c),this.checkPixel(t.x+1,t.y,c),this.checkPixel(t.x,t.y-1,c),this.checkPixel(t.x,t.y+1,c);return this.imageData=null,a.putImageData(d,0,0),a.canvas.toDataURL()},onBegin(t){if(this.color.clear)return;this.filling=!0;let e=this.stage.getPointerPosition(),i=this.fill(e),r=new F0.default.Image({x:0,y:0});this.layer.add(r),hr(i).then((n)=>{r.image(n),this.filling=!1})},async onEnd(t){this.pixels.length=0;while(!0){if(!this.fileing)break;await A0(50)}await A0(100)}};var T0=Pt(Et(),1),D0=30,I0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.fontFamily=e.fontFamily,this.color=e.color},cancel(){this.cancelEditbox?.(),this.poly=null,this.cancelEditbox=null},enableEditbox(){this.poly.hide();let t=this.poly.absolutePosition(),e=this.stage.container().getBoundingClientRect(),i={x:e.x+t.x,y:e.y+t.y},r=document.createElement("div");document.body.appendChild(r),r.innerText=this.poly.text(),r.contentEditable="plaintext-only",r.style.position="absolute",r.style.top=i.y+"px",r.style.left=i.x+"px",r.style.minWidth=this.poly.fontSize()+"px",r.style.fontSize=this.poly.fontSize()+"px",r.style.border="none",r.style.padding="0px",r.style.margin="0px",r.style.background="none",r.style.outline="none",r.style.resize="auto",r.style.lineHeight=this.poly.lineHeight(),r.style.fontFamily=this.poly.fontFamily(),r.style.transformOrigin="left top",r.style.textAlign=this.poly.align(),r.style.color=this.poly.fill(),r.focus(),r.addEventListener("blur",()=>r.focus()),this.cancelEditbox=()=>{this.poly.text(r.innerText.trimEnd()),r.parentNode.removeChild(r),this.poly.show()}},onBegin(t){if(this.color.clear)return;let e=this.stage.getPointerPosition();this.poly=new T0.default.Text({x:e.x,y:e.y-D0/2,text:"",fontSize:D0,fontFamily:this.fontFamily,fill:this.color.hex}),this.layer.add(this.poly),this.enableEditbox(this.stage,this.poly)},onDone(t){if(!this.poly)return;if(this.cancelEditbox(),this.poly.text().length===0)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null,this.cancelEditbox=null}};var G0=Pt(Et(),1),R0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.size=e.size,this.color=e.color},onBegin(t){if(this.color.clear)return;let e=this.stage.getPointerPosition();this.poly=new G0.default.Line({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[e.x,e.y]}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.points();i[2]=e.x,i[3]=e.y,this.poly.points(i)},onEnd(t){this.poly=null}};var O0=Pt(Et(),1),B0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.size=e.size,this.color=e.color},cancel(){if(!this.poly)return;let t=this.poly.getAttr("points");t.pop(),t.pop(),this.poly.setAttr("points",t),this.poly=null},draw(t,e){let i=e.getAttr("points"),r=e.x(),n=e.y();if(t.beginPath(),t.moveTo(i[0]-r,i[1]-n),i.length<6)t.lineTo(i[2]-r,i[3]-n);else{let a=2;for(;a<i.length-4;a+=2){var s=(i[a]-r+(i[a+2]-r))/2,o=(i[a+1]-n+(i[a+3]-n))/2;t.quadraticCurveTo(i[a]-r,i[a+1]-n,s,o)}t.quadraticCurveTo(i[a]-r,i[a+1]-n,i[a+2]-r,i[a+3]-n)}t.fillStrokeShape(e)},onBegin(t){if(this.color.clear)return;let e=this.stage.getPointerPosition();this.poly=new O0.default.Shape({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[e.x,e.y],sceneFunc:this.draw}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.getAttr("points"),r=i.length;i[r-2]=e.x,i[r-1]=e.y,this.poly.setAttr("points",i)},onEnd(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.getAttr("points");i.push(e.x),i.push(e.y),this.poly.setAttr("points",i)},onDone(t){this.poly=null}};var U0=Pt(Et(),1),q0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.color=e.color,this.outlineWidth=e.outlineWidth,this.outlineColor=e.outlineColor},onBegin(t){if(this.color.clear&&this.outlineColor.clear)return;let e=this.stage.getPointerPosition();this.poly=new U0.default.Rect({x:e.x,y:e.y,width:1,height:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.x(),r=this.poly.y(),n=e.x-i,s=e.y-r;this.poly.setAttrs({width:Math.abs(n),height:Math.abs(s),scale:{x:n<0?-1:1,y:s<0?-1:1}})},onEnd(t){if(!this.poly)return;let e=this.poly.size();if(e.width<10&&e.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};var z0=Pt(Et(),1),V0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.color=e.color,this.outlineWidth=e.outlineWidth,this.outlineColor=e.outlineColor},onBegin(t){if(this.color.clear&&this.outlineColor.clear)return;let e=this.stage.getPointerPosition();this.poly=new z0.default.Ellipse({x:e.x,y:e.y,radius:{x:1,y:1},fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.x(),r=this.poly.y(),n=e.x-i,s=e.y-r,o=t.evt.shiftKey||t.evt.ctrlKey||t.evt.metaKey,a=Math.sqrt(n*n+s*s);this.poly.setAttrs({radius:{x:o?a:Math.abs(n),y:o?a:Math.abs(s)},scale:{x:n<0?-1:1,y:s<0?-1:1}})},onEnd(t){if(!this.poly)return;let e=this.poly.size();if(e.width<10&&e.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};var W0=Pt(Et(),1),H0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.sides=e.sides,this.color=e.color,this.outlineWidth=e.outlineWidth,this.outlineColor=e.outlineColor},onBegin(t){if(this.color.clear&&this.outlineColor.clear)return;let e=this.stage.getPointerPosition();this.poly=new W0.default.RegularPolygon({x:e.x,y:e.y,sides:this.sides,radius:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.x(),r=this.poly.y(),n=e.x-i,s=e.y-r,o=Math.sqrt(n*n+s*s);this.poly.setAttrs({radius:o,scale:{x:n<0?-1:1,y:s<0?-1:1}})},onEnd(t){if(!this.poly)return;if(this.poly.radius()<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};var Y0=Pt(Et(),1),j0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.size=e.size,this.color=e.color,this.outlineWidth=e.outlineWidth,this.outlineColor=e.outlineColor},cancel(){if(!this.poly)return;let t=this.poly.getAttr("points");t.pop(),t.pop(),this.poly.setAttr("points",t),this.poly=null},onBegin(t){if(this.color.clear)return;let e=this.stage.getPointerPosition();this.poly=new Y0.default.Line({points:[e.x,e.y],lineCap:"round",lineJoin:"round",closed:!0,fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.points(),r=i.length;i[r-2]=e.x,i[r-1]=e.y,this.poly.points(i)},onEnd(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.points();i.push(e.x),i.push(e.y),this.poly.points(i)},onDone(t){if(!this.poly)return;let e=this.poly.size();if(e.width<10&&e.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};var mn=Pt(Et(),1);import{sleepMs as hd}from"@blockcode/utils";import{themeColors as D6}from"@blockcode/core";var X0={setup(t,e){this.stage=t.getStage(),this.layer=t},cancel(){this.clipImage?.remove?.(),this.clipImage=null},async clip(){this.poly.setAttr("stroke","transparent");let t=this.poly.getClientRect(),e=await this.layer.toImage(t);this.clipImage=new mn.default.Image({image:e,x:t.x,y:t.y,name:"selector",draggable:!0}),this.layer.add(this.clipImage),this.poly.setAttrs({fill:"black",globalCompositeOperation:"destination-out"})},onBegin(t){this.cancel();let e=this.stage.getPointerPosition();this.poly=new mn.default.Rect({x:e.x,y:e.y,width:1,height:1,dash:[5,5],fill:"transparent",stroke:D6.ui.theme.highlight,strokeWidth:1}),this.layer.add(this.poly)},onDrawing(t){if(!this.poly)return;let e=this.stage.getPointerPosition(),i=this.poly.x(),r=this.poly.y(),n=e.x-i,s=e.y-r;this.poly.setAttrs({width:Math.abs(n),height:Math.abs(s),scale:{x:n<0?-1:1,y:s<0?-1:1}})},async onEnd(t){if(!this.poly)return;let e=this.poly.size();if(e.width<10&&e.height<10)this.poly.remove();else await this.clip();this.poly=null}};var K0={setup(t,e){this.stage=t.getStage(),this.layer=t,this.changeCenter=e.onCenterChange},onBegin(t){let e=this.stage.getPointerPosition();this.changeCenter(e)}};import{Color as Z0}from"@blockcode/utils";var _n={setup(t,e){this.stage=t.getStage(),this.layer=t,this.ctx=t.getContext(),this.pickColor=e.onPickColor},getIndex(t){let e=this.layer.width(),i=Math.floor(t.x);return Math.floor(t.y)*e+i<<2},onBegin(t){let e=this.layer.width(),i=this.layer.height();this.imageData=this.ctx.getImageData(0,0,e,i);let r=this.stage.getPointerPosition(),n=this.getIndex(r),s=this.imageData.data.slice(n,n+4),o=new Z0(Array.from(s));this.pickColor(o)},onDrawing(t){let e=this.stage.getPointerPosition(),i=this.getIndex(e),r=this.imageData.data.slice(i,i+4),n=new Z0(Array.from(r));this.pickColor(n)},onEnd(t){this.imageData=null}};var $i="./assets/icon-center-bzxv0qgf.svg";import{jsx as J0,jsxs as U6}from"preact/jsx-runtime";var B6={[k.Pen]:Ji,[k.Eraser]:E0,[k.Fill]:P0,[k.Text]:I0,[k.Line]:R0,[k.Curve]:B0,[k.Rectangle]:q0,[k.Circle]:V0,[k.Isogon]:H0,[k.Polygon]:j0,[k.Selector]:X0,[k.Center]:K0,[k.ColorPicker]:_n,[k.OutlineColorPicker]:_n};function $0({zoom:t,maxSize:e,toolOptions:i,onSizeChange:r,onChange:n}){let s=I6(null),{asset:o,assetId:a,modified:h}=O6(),l=G6(null),c=Oe(()=>{if(l.value?.type===k.Center)return;if(s.drawLayer.children.length<=2)return;let f=s.image.position();f.x+=o.value.centerX,f.y+=o.value.centerY;let _=k0(s.drawLayer,f);n(_)},[n]),d=Oe((f)=>{let _=s.image.position(),y=f.x-_.x,w=f.y-_.y;n({centerX:y,centerY:w})},[n]),u=Oe(()=>{let f=s.stage.find(".selector");if(f.length>0)s.transformer.zIndex(s.drawLayer.children.length-1),s.transformer.nodes(f);else c()},[c]),g=Oe(()=>{if(s.transformer.nodes().length>0)s.transformer.nodes([]),c()},[c]),p=Oe(()=>{s.transformer.nodes([]);for(let f of s.drawLayer.children){if(f===s.image||f instanceof vt.default.Transformer)continue;f.remove()}},[]),m=Oe((f)=>{switch(f.code){case Yt.ESC:case Yt.DELETE:case Yt.BACKSPACE:if(f.code!==Yt.ESC&&l.value?.type===k.Text)return;s.painting=!1,l.value?.cancel?.(),p();return;case Yt.RETURN:case Yt.ENTER:g();return;case Yt.LEFT:s.transformer.nodes().forEach((_)=>_.x(_.x()-1));return;case Yt.RIGHT:s.transformer.nodes().forEach((_)=>_.x(_.x()+1));return;case Yt.UP:s.transformer.nodes().forEach((_)=>_.y(_.y()-1));return;case Yt.DOWN:s.transformer.nodes().forEach((_)=>_.y(_.y()+1));return}},[p]);return tr(async()=>{if(!/image\//.test(o.value?.type)||!s.image)return;let f=await di(o.value);s.image.image(f),s.image.position({x:s.stage.width()/2-o.value.centerX,y:s.stage.height()/2-o.value.centerY}),p()},[a.value,h.value,p]),tr(()=>{if(s.stage){let{clientWidth:f,clientHeight:_,scrollLeft:y,scrollTop:w,scrollWidth:v,scrollHeight:b}=s.current,x={top:_/2,left:f/2},A={top:(w+x.top)/b*(_*t)-x.top,left:(y+x.left)/v*(f*t)-x.left,behavior:"instant"};s.stage.content.style.zoom=t,s.current.scrollTo(A)}},[t]),tr(()=>{if(s.drawLayer){if(l.value?.type!==i.type){if(s.painting)s.painting=!1,l.value?.cancel?.(),c();if(g(),l.value=B6[i.type],l.value)l.value.type=i.type}if(i.type===k.Center)i.onCenterChange=d;l.value?.setup?.(s.drawLayer,i)}},[i,g,d,c]),tr(()=>{if(s.current){let{clientWidth:f,clientHeight:_}=s.current,y=Math.max(e.width,f),w=Math.max(e.height,_);vt.default.pixelRatio=1,s.stage=new vt.default.Stage({container:s.current,width:y,height:y}),r({width:f,height:_});let v=new vt.default.Layer({listening:!1});s.drawLayer=new vt.default.Layer,s.stage.add(s.drawLayer,v);let b=(y-e.width)/2,x=(w-e.height)/2,A=new vt.default.Rect({x:0,y:0,width:y,height:x,fill:"black",opacity:0.2}),F=new vt.default.Rect({x:0,y:w-x,width:f,height:x,fill:"black",opacity:0.2}),C=new vt.default.Rect({x:0,y:x,width:b,height:e.height,fill:"black",opacity:0.2}),L=new vt.default.Rect({x:y-b,y:x,width:b,height:e.height,fill:"black",opacity:0.2});if(v.add(A,F,C,L),s.transformer=new vt.default.Transformer,s.drawLayer.add(s.transformer),s.image=new vt.default.Image,s.drawLayer.add(s.image),o.value)di(o.value).then((S)=>{s.image.image(S),s.image.position({x:s.stage.width()/2-o.value.centerX,y:s.stage.height()/2-o.value.centerY})});s.painting=!1,s.stage.on("pointerdown",async(S)=>{if(s.painting||S.target.name()==="selector"||S.target.parent instanceof vt.default.Transformer)return;if(l.value?.type===k.ColorPicker||l.value?.type===k.OutlineColorPicker)S.evt.stopPropagation();if(g(),await R6(30),l.value)s.painting=!0,l.value.onBegin?.(S)}),s.stage.on("pointermove",(S)=>{if(s.painting)S.evt.preventDefault(),l.value.onDrawing?.(S)}),s.stage.on("pointerup",async(S)=>{if(s.painting){if(s.painting=!!l.value.onDone,await l.value.onEnd?.(S),!l.value.onDone)u()}}),s.stage.on("pointerdblclick",async(S)=>{if(s.painting)s.painting=!1,await l.value.onDone?.(S),u()}),s.stage.on("pointerclick",async(S)=>{if(s.painting&&l.value?.type===k.Text)s.painting=!1,await l.value.onDone?.(S),u()}),document.addEventListener("keydown",m),s.resizeObserver=new ResizeObserver(()=>{if(!s.stage)return;let{clientWidth:S,clientHeight:z}=s.current,pt=Math.max(e.width,S),X=Math.max(e.height,z);if(s.stage.size({width:pt,height:X}),r({width:S,height:z}),o.value)s.image.position({x:pt/2-o.value.centerX,y:X/2-o.value.centerY});let Z=(pt-e.width)/2,V=(X-e.height)/2;A.size({width:pt,height:V}),F.setAttrs({y:X-V,width:pt,height:V}),C.setAttrs({y:V,width:Z}),L.setAttrs({x:pt-Z,y:V,width:Z})}),s.resizeObserver.observe(s.current)}return()=>{document.removeEventListener("keydown",m),l.value?.cancelEditbox?.(),s.resizeObserver.unobserve(s.current),s.stage.destroy(),s.stage=null}},[s]),U6("div",{className:me.drawBox,children:[J0("div",{ref:s,className:Q0(me.drawContainer,{[me.text]:l.value?.type===k.Text,[me.center]:l.value?.type===k.Center,[me.picker]:l.value?.type===k.ColorPicker||l.value?.type===k.OutlineColorPicker})}),J0("img",{src:$i,className:Q0(me.centerIcon,{[me.hidden]:l.value?.type!==k.Center})})]})}_t("._03BnxG_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._03BnxG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._03BnxG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._03BnxG_row-bottom{margin-right:var(--space);margin-left:calc(var(--paint-tools-box-width) + var(--space));justify-content:space-between}._03BnxG_row-bottom>div{display:inline-flex}._03BnxG_row:last-child{min-height:unset;margin-bottom:0}._03BnxG_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._03BnxG_disabled{opacity:.3;pointer-events:none}._03BnxG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._03BnxG_name-input{width:8rem}._03BnxG_large-input{width:4rem}._03BnxG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._03BnxG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._03BnxG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._03BnxG_tile-map-button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);height:calc(2rem + 2px);padding:.375rem}._03BnxG_button-left-icon{margin-right:calc(var(--space))}._03BnxG_button-icon{width:1.5rem;margin:auto}._03BnxG_group-button{border-left:none;border-radius:0}._03BnxG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._03BnxG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._03BnxG_group-button-toggled-off{filter:saturate(0)}._03BnxG_label-button{border:0;font-weight:400}._03BnxG_label-button._03BnxG_selected{background:var(--theme-primary);color:var(--ui-white)}._03BnxG_label-button._03BnxG_selected ._03BnxG_button-icon{filter:brightness(0)invert()}._03BnxG_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}._03BnxG_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;min-height:2rem;max-height:30vh;overflow:auto}._03BnxG_displayed-font-name{font-size:.8rem}");var P={labelImage:"_03BnxG_label-image",tileMapButton:"_03BnxG_tile-map-button",painterWrapper:"_03BnxG_painter-wrapper",toolGroup:"_03BnxG_tool-group",row:"_03BnxG_row",toolIcon:"_03BnxG_tool-icon",buttonLeftIcon:"_03BnxG_button-left-icon",groupButtonFirst:"_03BnxG_group-button-first",disabled:"_03BnxG_disabled",labelButton:"_03BnxG_label-button",groupButtonLast:"_03BnxG_group-button-last",button:"_03BnxG_button",groupButtonToggledOff:"_03BnxG_group-button-toggled-off",dashedBorder:"_03BnxG_dashed-border",rowBottom:"_03BnxG_row-bottom",nameInput:"_03BnxG_name-input",selected:"_03BnxG_selected",drawBoxWrapper:"_03BnxG_draw-box-wrapper",rowFill:"_03BnxG_row-fill",displayedFontName:"_03BnxG_displayed-font-name",groupButton:"_03BnxG_group-button",buttonIcon:"_03BnxG_button-icon",fontSelector:"_03BnxG_font-selector",largeInput:"_03BnxG_large-input"};var th="./assets/icon-undo-q4nwvpxj.svg";var eh="./assets/icon-redo-mrvqwv38.svg";var ih="./assets/icon-zoom-in-s316e3qy.svg";var rh="./assets/icon-zoom-out-y9xmwx8c.svg";var nh="./assets/icon-zoom-reset-xne8n5sw.svg";var sh="./assets/icon-tilemap-m9n9bthp.svg";import{jsx as q,jsxs as Ft}from"preact/jsx-runtime";var J6=30,nr=0.5,ah=20,hh=(t,e)=>{switch(t){case ut.Image:return ke("paint.painter.image","Image",e).toLowerCase();case ut.Costume:return ke("paint.painter.costume","Costume",e).toLowerCase();case ut.Backdrop:return ke("paint.painter.backdrop","Backdrop",e).toLowerCase()}};function xn({mode:t,maxSize:e}){let{translator:i}=K6(),{asset:r,assetId:n,modified:s}=Z6(),o=Nt(1),a=Nt(!1),h=Nt(null),l=Nt(k.Pen),c=Nt(10),d=Nt(2),u=Nt(6),g=Nt(null),p=Nt(new oh([260,0.6,1])),m=Nt(new oh([0,1,0])),f=Nt([]),_=Nt([]),y=X6(()=>r.value?.name,[n.value,s.value]),w=!/image\//.test(r.value?.type);j6(()=>{hi(()=>{if(h.value=null,f.value=null,_.value=null,f.value=[],_.value=[],r.value)f.value.push(Object.assign({},r.value))})},[n.value]);let v=yn(()=>l.value!==k.Rectangle&&l.value!==k.Circle&&l.value!==k.Isogon&&l.value!==k.Polygon),b=yn(()=>l.value===k.Pen||l.value===k.Eraser||l.value===k.Line||l.value===k.Curve),x=yn(()=>{if(l.value===k.Eraser)return gi;if(l.value===k.Line)return fi;if(l.value===k.Curve)return pi;return ui}),A=gt((T)=>er({name:T}),[]),F=gt((T)=>{if(h.value===k.ColorPicker)p.value=T;else if(h.value===k.OutlineColorPicker)m.value=T},[]),C=gt((T)=>(Bt)=>{if(Bt)h.value=T;else h.value=null},[]),L=gt((T)=>d.value=Cn.clamp(T,0,100),[]),S=gt((T)=>c.value=Cn.clamp(T,1,100),[]),z=gt((T)=>u.value=Cn.clamp(T,3,20),[]),pt=gt((T)=>g.value=T,[]),X=gt((T)=>{a.value=a.value?T.width<390:T.width<340},[]),Z=gt((T)=>{hi(()=>{if(f.value.length>J6)f.value.shift();if(T)_.value.length=0,f.value.push(T),er(T)})},[]),V=gt(()=>{hi(()=>{h.value=null;let T=f.value.pop();_.value.push(T),T=f.value[f.value.length-1],er(T)})},[]),Ct=gt(()=>{hi(()=>{h.value=null;let T=_.value.pop();f.value.push(T),er(T)})},[]);return Ft("div",{className:P.painterWrapper,children:[Ft("div",{className:P.row,children:[q("div",{className:P.toolGroup,children:q(wn,{text:hh(t,i),children:q(rr,{disabled:w,className:P.nameInput,placeholder:ke("paint.painter.name","name"),onSubmit:A,value:y?Q6(y):hh(t,i)})})}),Ft("div",{className:P.toolGroup,children:[q(Me,{disabled:f.value.length<=1,className:At(P.button,P.groupButtonFirst,{[P.groupButtonToggledOff]:w}),onClick:V,children:q("img",{src:th,className:P.buttonIcon,title:ke("paint.painter.undo","Undo")})}),q(Me,{disabled:_.value.length===0,className:At(P.button,P.groupButtonLast,{[P.groupButtonToggledOff]:w}),onClick:Ct,children:q("img",{src:eh,className:P.buttonIcon,title:ke("paint.painter.redo","Redo")})})]}),q("div",{className:P.toolGroup,children:Ft(Me,{vertical:!0,disabled:t!==ut.Costume,className:At(P.labelButton,{[P.selected]:h.value===k.Center}),onClick:gt(()=>h.value=h.value!==k.Center?k.Center:null,[]),children:[q("img",{src:$i,className:P.buttonIcon,title:ke("paint.painter.center","Center")}),q(ir,{id:"paint.painter.center",defaultMessage:"Center"})]})})]}),Ft("div",{className:P.row,children:[q("div",{className:P.toolGroup,children:q(wn,{className:At({[P.disabled]:l.value===k.Eraser||l.value===k.Selector}),text:q(ir,{id:"paint.painter.fill",defaultMessage:"Fill"}),children:q(mr,{picking:h.value===k.ColorPicker,color:p.value,onChange:gt((T)=>p.value=T,[]),onPickingColor:C(k.ColorPicker)})})}),Ft("div",{className:At(P.toolGroup,P.dashedBorder),children:[q(wn,{className:At({[P.disabled]:v.value}),text:q(ir,{id:"paint.painter.outline",defaultMessage:"Outline"}),children:q(mr,{outline:!0,picking:h.value===k.OutlineColorPicker,color:m.value,onChange:gt((T)=>m.value=T,[]),onPickingColor:C(k.OutlineColorPicker)})}),q(rr,{small:!0,type:"number",className:At(P.largeInput,{[P.disabled]:v.value}),value:d.value,onSubmit:L})]}),b.value&&Ft("div",{className:P.toolGroup,children:[q("img",{src:x,className:P.toolIcon}),q(rr,{small:!0,type:"number",className:P.largeInput,value:c.value,onSubmit:S})]}),l.value===k.Isogon&&Ft("div",{className:P.toolGroup,children:[q("img",{src:mi,className:P.toolIcon}),q(rr,{small:!0,type:"number",className:P.largeInput,value:u.value,onSubmit:z})]}),l.value===k.Text&&q(qn,{font:g.value,onChange:pt})]}),Ft("div",{className:At(P.row,P.rowFill),children:[q(Xn,{small:a.value,paintTool:l.value,onSelect:gt((T)=>hi(()=>{l.value=T,h.value=null}),[])}),q("div",{className:P.drawBoxWrapper,children:q($0,{zoom:o.value,maxSize:e,toolOptions:{type:h.value||l.value,size:c.value,sides:u.value,color:p.value,fontFamily:g.value?.family,outlineWidth:d.value,outlineColor:m.value,onPickColor:F},onSizeChange:X,onChange:Z})})]}),Ft("div",{className:At(P.row,P.rowBottom),children:[q("div",{children:t===ut.Backdrop&&Ft(Me,{disabled:!0,className:P.tileMapButton,children:[q("img",{className:P.buttonLeftIcon,src:sh}),q(ir,{id:"paint.mode.tileMap",defaultMessage:"Convert to TileMap"})]})}),Ft("div",{children:[q(Me,{disabled:o.value===1,className:At(P.button,P.groupButtonFirst),onClick:gt(()=>o.value-nr>=1&&(o.value=o.value-nr),[]),children:q("img",{src:rh,className:P.buttonIcon})}),q(Me,{disabled:o.value===1,className:At(P.button,P.groupButton),onClick:gt(()=>o.value=1,[]),children:q("img",{src:nh,className:P.buttonIcon})}),q(Me,{disabled:o.value===ah,className:At(P.button,P.groupButtonLast),onClick:gt(()=>o.value+nr<ah&&(o.value=o.value+nr),[]),children:q("img",{src:ih,className:P.buttonIcon})})]})]})]})}_t(".TDnbAa_pixel-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var lh={pixelEditorWrapper:"TDnbAa_pixel-editor-wrapper"};import{jsx as ch,jsxs as t9}from"preact/jsx-runtime";function $6({mode:t,maxSize:e,onImagesFilter:i,onShowLibrary:r,onSurprise:n,onChange:s,onDelete:o}){return t9("div",{className:lh.pixelEditorWrapper,children:[ch(Rn,{mode:t,maxSize:e,onImagesFilter:i,onShowLibrary:r,onSurprise:n,onChange:s,onDelete:o}),ch(xn,{mode:t,maxSize:e})]})}import{Text as i9}from"@blockcode/core";var dh="./assets/icon-paint-fcmp1zp4.svg";import{jsx as n9}from"preact/jsx-runtime";var r9={icon:dh,label:n9(i9,{id:"paint.painter.image",defaultMessage:"Image"})};export{r9 as paintTab,hr as loadImageFromURL,ar as loadImageFromFile,di as loadImageFromAsset,$6 as PaintEditor,ut as EditorModes,ci as BlankImageData};
