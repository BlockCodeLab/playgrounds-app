import{addLocalesMessages as c3}from"@blockcode/core";var X1={"paint.contextMenu.duplicate":"duplicate","paint.contextMenu.export":"export","paint.contextMenu.delete":"delete","paint.actionButton.upload":"Upload Image","paint.actionButton.uploadCostume":"Upload Costume","paint.actionButton.uploadBackdrop":"Upload Backdrop","paint.actionButton.uploadError":'Upload "{file}" failed.',"paint.actionButton.surprise":"Surprise","paint.actionButton.paint":"Paint","paint.actionButton.image":"Choose a Image","paint.actionButton.costume":"Choose a Costume","paint.actionButton.backdrop":"Choose a Backdrop","paint.painter.image":"Image","paint.painter.costume":"Costume","paint.painter.backdrop":"Backdrop","paint.painter.name":"name","paint.painter.undo":"Undo","paint.painter.redo":"Redo","paint.painter.pen":"Pen","paint.painter.eraser":"Eraser","paint.painter.fill":"Fill","paint.painter.text":"Text","paint.painter.line":"Line","paint.painter.curve":"Curve","paint.painter.rectangle":"Rectangle","paint.painter.circle":"Circle","paint.painter.isogon":"Isogon","paint.painter.polygon":"Polygon","paint.painter.select":"Select","paint.painter.center":"Center","paint.painter.outline":"Outline","paint.painter.delete":"Delete","paint.painter.flipHorizontal":"Flip Horizontal","paint.painter.flipVertical":"Flip Vertical","paint.painter.copy":"Copy","paint.painter.paste":"Paste","paint.painter.crop":"Auto Crop","paint.painter.resize":"Resize","paint.colorPicker.color":"Color","paint.colorPicker.saturation":"Saturation","paint.colorPicker.brightness":"Brightness","paint.mode.bitmap":"Convert to Bitmap","paint.mode.tileMap":"Convert to TileMap"};var $1={"paint.contextMenu.duplicate":"复制","paint.contextMenu.export":"导出","paint.contextMenu.delete":"删除","paint.actionButton.upload":"上传图片","paint.actionButton.uploadCostume":"上传造型","paint.actionButton.uploadBackdrop":"上传背景","paint.actionButton.uploadError":"上传“{file}”失败。","paint.actionButton.surprise":"随机","paint.actionButton.paint":"绘制","paint.actionButton.image":"选择一个图片","paint.actionButton.costume":"选择一个造型","paint.actionButton.backdrop":"选择一个背景","paint.painter.image":"图片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤销","paint.painter.redo":"重做","paint.painter.pen":"画笔","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"线段","paint.painter.curve":"曲线","paint.painter.rectangle":"矩形","paint.painter.circle":"圆形","paint.painter.isogon":"正多边形","paint.painter.polygon":"任意多边形","paint.painter.select":"选择","paint.painter.center":"中心","paint.painter.outline":"轮廓","paint.painter.delete":"删除","paint.painter.flipHorizontal":"水平翻转","paint.painter.flipVertical":"垂直翻转","paint.painter.copy":"复制","paint.painter.paste":"粘贴","paint.painter.crop":"自动裁剪","paint.painter.resize":"大小","paint.colorPicker.color":"颜色","paint.colorPicker.saturation":"饱和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"转换为位图","paint.mode.tileMap":"转换为拼贴地图"};var H1={"paint.contextMenu.duplicate":"複製","paint.contextMenu.export":"導齣","paint.contextMenu.delete":"刪除","paint.actionButton.upload":"上傳圖片","paint.actionButton.uploadCostume":"上傳造型","paint.actionButton.uploadBackdrop":"上傳背景","paint.actionButton.uploadError":"上傳“{file}”失敗。","paint.actionButton.surprise":"隨機","paint.actionButton.paint":"繪製","paint.actionButton.image":"選擇一個圖片","paint.actionButton.costume":"選擇一個造型","paint.actionButton.backdrop":"選擇一個背景","paint.painter.image":"圖片","paint.painter.costume":"造型","paint.painter.backdrop":"背景","paint.painter.name":"名字","paint.painter.undo":"撤銷","paint.painter.redo":"重做","paint.painter.pen":"畫筆","paint.painter.eraser":"橡皮擦","paint.painter.fill":"填充","paint.painter.text":"文本","paint.painter.line":"線段","paint.painter.curve":"曲線","paint.painter.rectangle":"矩形","paint.painter.circle":"圓形","paint.painter.isogon":"正多邊形","paint.painter.polygon":"任意多邊形","paint.painter.select":"選擇","paint.painter.center":"中心","paint.painter.outline":"輪廓","paint.painter.delete":"刪除","paint.painter.flipHorizontal":"水平翻轉","paint.painter.flipVertical":"垂直翻轉","paint.painter.copy":"複製","paint.painter.paste":"粘貼","paint.painter.crop":"自動裁剪","paint.painter.resize":"大小","paint.colorPicker.color":"顏色","paint.colorPicker.saturation":"飽和度","paint.colorPicker.brightness":"亮度","paint.mode.bitmap":"轉換爲位圖","paint.mode.tileMap":"轉換爲 TileMap"};c3({en:X1,"zh-Hans":$1,"zh-Hant":H1});import{keyMirror as d3}from"@blockcode/utils";var D=d3({Image:null,Costume:null,Backdrop:null,Tile:null,TileMap:null});import{nanoid as s3}from"@blockcode/utils";var q1="image/png",h3=`data:${q1};base64,`.length,x1="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUGFdjYAACAAAFAAGq1chRAAAAAElFTkSuQmCC",F1=new Map;function A1(e,t){return new Promise((i)=>{let n=new FileReader;n.readAsDataURL(e),n.addEventListener("load",async()=>{let r=await n1(n.result,1,t);i(r)})})}function M1(e){return new Promise((t)=>{let i=F1.get(e.id);if(!i)i=new Image,F1.set(e.id,i);let n=`data:${e.type};base64,`;i.src=`${n}${e.data}`,i.addEventListener("load",()=>{i.dataset.data=i.src.slice(n.length),t(i)})})}function n1(e,t,i){return new Promise((n)=>{let r=s3(),o=new Image;F1.set(r,o),o.id=r,o.src=e,o.addEventListener("load",()=>{if(o.dataset.data)return n(o);let{width:a,height:p}=o;if(!i)i={width:a,height:p};if(!t)t=1;if(o.width>i.width||o.height>i.height){a=i.width,p=i.height;let N=i.width/o.width,B=i.height/o.height;if(N<B)t=N;else t=B}p=o.height*t,a=o.width*t;let g=document.createElement("canvas");g.width=a,g.height=p,g.getContext("2d").drawImage(o,0,0,a,p);let v=g.toDataURL(q1);if(v==="data:,")return n(null);o.dataset.data=v.slice(h3),o.src=v})})}import{useCallback as r1,useMemo as g6}from"preact/hooks";import{batch as s1}from"@preact/signals";import{nanoid as G1}from"@blockcode/utils";import{useProjectContext as x3,translate as Z1,setAlert as r5,delAlert as M3,openAsset as l5,addAsset as T1,delAsset as v3}from"@blockcode/core";import{Text as U,IconSelector as f3,ActionButton as y3}from"@blockcode/core";function F(e){let t=globalThis.document,i=t.createElement("style");i.appendChild(t.createTextNode(e)),t.head.append(i)}F(".bRLzKG_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}.bRLzKG_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}.bRLzKG_selector-item{width:5rem;height:5rem;margin:.5rem auto}.bRLzKG_delete-menu-item:hover{background:var(--error-primary)}.bRLzKG_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}.bRLzKG_add-button{margin:.75rem auto}");var i1={selectorItem:"bRLzKG_selector-item",addButtonWrapper:"bRLzKG_add-button-wrapper",addButton:"bRLzKG_add-button",selectorItemsWrapper:"bRLzKG_selector-items-wrapper",deleteMenuItem:"bRLzKG_delete-menu-item",selectorWrapper:"bRLzKG_selector-wrapper"};var K1="./assets/icon-costume-zx9m3hdh.svg";var t5="./assets/icon-backdrop-qvqgzqwj.svg";var e5="./assets/icon-search-6g8kgvdt.svg";var i5="./assets/icon-paint-0h8zs19a.svg";var o5="./assets/icon-surprise-d5t4529a.svg";var n5="./assets/icon-file-upload-0z25chr6.svg";import{jsx as A,jsxs as b3}from"preact/jsx-runtime";var a5={[D.Image]:A(U,{id:"paint.actionButton.image",defaultMessage:"Choose a Image"}),[D.Costume]:A(U,{id:"paint.actionButton.costume",defaultMessage:"Choose a Costume"}),[D.Backdrop]:A(U,{id:"paint.actionButton.backdrop",defaultMessage:"Choose a Backdrop"})},k3={[D.Image]:A(U,{id:"paint.actionButton.upload",defaultMessage:"Upload Image"}),[D.Costume]:A(U,{id:"paint.actionButton.uploadCostume",defaultMessage:"Upload Costume"}),[D.Backdrop]:A(U,{id:"paint.actionButton.uploadBackdrop",defaultMessage:"Upload Backdrop"})},I3=(e)=>{switch(e){case D.Image:return Z1("paint.painter.image","Image").toLowerCase();case D.Costume:return Z1("paint.painter.costume","Costume").toLowerCase();case D.Backdrop:return Z1("paint.painter.backdrop","Backdrop").toLowerCase()}},N3=(e)=>`data:${e.type};base64,${e.data}`;function p5({mode:e,maxSize:t,onImagesFilter:i,onShowLibrary:n,onSurprise:r,onChange:o,onDelete:a}){let{assets:p,assetId:g,modified:s}=x3(),v=r1(()=>{return i().map((c)=>{if(typeof c==="string")return p.value.find((C)=>C.id===c);return c}).filter((c)=>/^image\//.test(c.type))},[s.value,i]),N=r1(()=>{let c=document.createElement("input");c.type="file",c.accept="image/*",c.multiple=!0,c.click(),c.addEventListener("change",async(C)=>{let f=G1();r5("importing",{id:f});let b=[];for(let u of C.target.files){let z=await A1(u,t);if(!z)r5({message:A(U,{id:"paint.actionButton.uploadError",defaultMessage:'Upload "{file}" failed.',file:u.name})},2000),z={dataset:{data:x1},width:1,height:1};z.name=u.name.slice(0,u.name.lastIndexOf(".")),b.push(z)}M3(f),s1(()=>{for(let u of b)if(T1({id:u.id,type:"image/png",name:u.name,data:u.dataset.data,width:u.width,height:u.height,centerX:Math.floor(u.width/2),centerY:Math.floor(u.height/2)}),o)o(u.id)})})},[o]),B=r1(()=>{let c=G1();s1(()=>{if(T1({id:c,type:"image/png",name:I3(e),data:x1,width:1,height:1,centerX:1,centerY:1}),o)o(c)})},[o]),G=r1((c)=>{let C=v(),f=C[c];s1(()=>{let b=g.value;if(f.id===g.value){if(c===0)b=C[1]?.id;else if(c+1<C.length)b=C[c+1].id;else if(c-1>-1)b=C[c-1].id}v3(f.id),l5(b),a(f.id,b)})},[a]),_=r1((c)=>{let f=v()[c],b=G1();s1(()=>{if(T1({...f,id:b}),o)o(b)})},[o]),Y=r1((c,C)=>{s1(()=>{if(l5(C.id),o)o(C.id)})},[o]),h=v();return b3("div",{className:i1.selectorWrapper,children:[A(f3,{displayOrder:!0,id:"doodle-selector",className:i1.selectorItemsWrapper,items:h.map((c,C)=>({...c,details:`${c.width}×${c.height}`,icon:N3(c),order:C,className:i1.selectorItem,contextMenu:[[{label:A(U,{id:"paint.contextMenu.duplicate",defaultMessage:"duplicate"}),onClick:()=>_(C)},{label:A(U,{id:"paint.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:A(U,{id:"paint.contextMenu.delete",defaultMessage:"delete"}),disabled:h.length<=1,className:i1.deleteMenuItem,onClick:()=>G(C)}]]})),selectedId:g.value,onSelect:Y,onDelete:h.length>1&&G}),A("div",{className:i1.addButtonWrapper,children:A(y3,{tooltipPlacement:"right",className:i1.addButton,icon:e===D.Costume?K1:t5,tooltip:a5[e],onClick:n,moreButtons:[{icon:n5,tooltip:k3[e],onClick:N},{icon:o5,tooltip:A(U,{id:"paint.actionButton.surprise",defaultMessage:"Surprise"}),onClick:r},{icon:i5,tooltip:A(U,{id:"paint.actionButton.paint",defaultMessage:"Paint"}),onClick:B},{icon:e5,tooltip:a5[e],onClick:n}]})})]})}import{useCallback as y,useEffect as A0,useMemo as G0}from"preact/hooks";import{batch as h1,useComputed as j1,useSignal as T}from"@preact/signals";import{classNames as O,Color as X5,MathUtils as J1}from"@blockcode/utils";import{useProjectContext as Z0,translate as W,maybeTranslate as T0,setAsset as D1}from"@blockcode/core";import{Text as g1,Label as E1,BufferedInput as w1,Button as J}from"@blockcode/core";import{useCallback as Z,useMemo as E3}from"preact/hooks";import{classNames as o1,Color as _3}from"@blockcode/utils";import{Text as U1,Tooltip as z3}from"@blockcode/core";F('.x5E0hW_color-picker-wrapper{width:3rem;height:2rem;margin-right:var(--space);cursor:pointer;display:flex}.x5E0hW_color-swatch{border:1px solid var(--ui-black-transparent);border-top-left-radius:var(--form-radius);border-bottom-left-radius:var(--form-radius);flex-shrink:0;flex-basis:2rem;height:100%;display:flex;position:relative}.x5E0hW_color-swatch-outline:after{content:"";background:var(--ui-white);border:1px solid var(--ui-black-transparent);z-index:1;width:.75rem;height:.75rem;position:absolute;top:.5rem;left:.5rem}.x5E0hW_picker-arrow{user-select:none;border:1px solid var(--ui-black-transparent);border-top-right-radius:var(--form-radius);border-bottom-right-radius:var(--form-radius);border-left:0;flex-shrink:0;flex-basis:1rem;justify-content:center;align-items:center;height:100%;font-size:.75rem;display:flex}.x5E0hW_color-tooltip{background:var(--ui-white);color:var(--text-primary);padding:calc(var(--space)/2)}.x5E0hW_tooltip-item{margin:8px}.x5E0hW_tooltip-item-label{font-weight:700}.x5E0hW_tooltip-item-readout{margin-left:10px}.x5E0hW_tooltip-item-slider{border-radius:11px;outline:none;width:150px;height:22px;margin-bottom:20px;position:relative}.x5E0hW_tooltip-item-slider-handler{background-color:var(--ui-white);width:26px;height:26px;box-shadow:0 0 0 4px var(--ui-black-transparent);touch-action:none;border-radius:100%;margin-top:-2px;position:absolute;left:100px}.x5E0hW_tooltip-item-toolbar{justify-content:space-between;display:flex}.x5E0hW_tooltip-item-toolbar-button{border:1px solid var(--ui-black-transparent);border-radius:var(--form-radius);cursor:pointer;width:calc(1.5rem + 2px);height:calc(1.5rem + 2px)}.x5E0hW_tooltip-item-toolbar-button.x5E0hW_selected{border:1px solid #855cd6;box-shadow:0 0 0 3px #855cd659}.x5E0hW_button-icon{width:1.5rem;height:1.5rem}');var M={selected:"x5E0hW_selected",buttonIcon:"x5E0hW_button-icon",tooltipItemReadout:"x5E0hW_tooltip-item-readout",tooltipItemSlider:"x5E0hW_tooltip-item-slider",tooltipItemLabel:"x5E0hW_tooltip-item-label",pickerArrow:"x5E0hW_picker-arrow",tooltipItemToolbar:"x5E0hW_tooltip-item-toolbar",colorSwatch:"x5E0hW_color-swatch",tooltipItemSliderHandler:"x5E0hW_tooltip-item-slider-handler",colorSwatchOutline:"x5E0hW_color-swatch-outline",tooltipItemToolbarButton:"x5E0hW_tooltip-item-toolbar-button",tooltipItem:"x5E0hW_tooltip-item",colorTooltip:"x5E0hW_color-tooltip",colorPickerWrapper:"x5E0hW_color-picker-wrapper"};var c5="./assets/icon-picker-2frmfa34.svg";var O1="./assets/icon-clear-gctr9axd.svg";import{jsx as k,jsxs as l1,Fragment as A3}from"preact/jsx-runtime";var F3=[0,0,324,288,252,216,180,144,108,72,36,0,0],H=124,V=(e,t,i,n)=>new _3({h:e,s:t,v:i},n),S1=(e,t)=>{e.stopPropagation();let i=e.target,n=i.offsetLeft,r=e.clientX,o=(p)=>{p.preventDefault();let g=p.clientX-r+n;if(g>=H)g=H;if(g<=0)g=0;i.style.left=`${g}px`,t(g/H)},a=()=>{document.removeEventListener("pointermove",o),document.removeEventListener("pointerup",a)};document.addEventListener("pointermove",o),document.addEventListener("pointerup",a)},W1=(e,t)=>{let i=e.target.children[0],n=e.offsetX-13;if(n>=H)n=H;if(n<=0)n=0;i.style.left=`${n}px`,t(n/H)};function Y1({picking:e,color:t,outline:i,onChange:n,onPickingColor:r}){let o=t.hsv.h,a=t.hsv.s,p=t.hsv.v,g=Z((u)=>n(V(Math.round(u*360),a,p)),[a,p,n]),s=Z((u)=>n(V(o,u,p)),[o,p,n]),v=Z((u)=>n(V(o,a,u)),[o,a,n]),N=Z(()=>n(V(o,a,p,!0)),[o,a,p,n]),B=Z((u)=>S1(u,g),[g]),G=Z((u)=>S1(u,s),[s]),_=Z((u)=>S1(u,v),[v]),Y=Z((u)=>W1(u,g),[g]),h=Z((u)=>W1(u,s),[s]),c=Z((u)=>W1(u,v),[v]),C=E3(()=>F3.map((u)=>V(u,a,p).hex),[a,p]),f=Z((u)=>u.stopPropagation(),[]),b=Z(()=>r(!e),[e,r]);return k(z3,{clickable:!0,placement:"bottom",className:M.colorTooltip,onHide:Z(()=>setTimeout(()=>r(!1),50),[r]),content:l1(A3,{children:[l1("div",{className:M.tooltipItem,children:[k("span",{className:M.tooltipItemLabel,children:k(U1,{id:"paint.colorPicker.color",defaultMessage:"Color"})}),k("span",{className:M.tooltipItemReadout,children:Math.round(o/360*100)})]}),k("div",{className:o1(M.tooltipItem,M.tooltipItemSlider),style:{background:`linear-gradient(to left, ${C[0]} 0px, ${C[1]} 13px, ${C[2]}, ${C[3]}, ${C[4]}, ${C[5]}, ${C[6]}, ${C[7]}, ${C[8]}, ${C[9]}, ${C[10]}, ${C[11]} 137px, ${C[12]} 100%)`},onClick:Y,children:k("div",{className:M.tooltipItemSliderHandler,style:{left:`${Math.round(o/360*H)}px`},onPointerDown:B,onClick:f})}),l1("div",{className:M.tooltipItem,children:[k("span",{className:M.tooltipItemLabel,children:k(U1,{id:"paint.colorPicker.saturation",defaultMessage:"Saturation"})}),k("span",{className:M.tooltipItemReadout,children:Math.round(a*100)})]}),k("div",{className:o1(M.tooltipItem,M.tooltipItemSlider),style:{background:`linear-gradient(to right, ${V(o,0,p).hex} 0px, ${V(o,1,p).hex} 100%)`},onClick:h,children:k("div",{className:M.tooltipItemSliderHandler,style:{left:`${Math.round(a*H)}px`},onPointerDown:G,onClick:f})}),l1("div",{className:M.tooltipItem,children:[k("span",{className:M.tooltipItemLabel,children:k(U1,{id:"paint.colorPicker.brightness",defaultMessage:"Brightness"})}),k("span",{className:M.tooltipItemReadout,children:Math.round(p*100)})]}),k("div",{className:o1(M.tooltipItem,M.tooltipItemSlider),style:{background:`linear-gradient(to right, ${V(o,a,0).hex} 0px, ${V(o,a,1).hex} 100%)`},onClick:c,children:k("div",{className:M.tooltipItemSliderHandler,style:{left:`${Math.round(p*H)}px`},onPointerDown:_,onClick:f})}),l1("div",{className:o1(M.tooltipItem,M.tooltipItemToolbar),children:[k("div",{className:o1(M.tooltipItemToolbarButton,{[M.selected]:t.clear}),onClick:N,children:k("img",{src:O1,className:M.buttonIcon})}),k("div",{className:o1(M.tooltipItemToolbarButton,{[M.selected]:e}),onClick:b,children:k("img",{src:c5,className:M.buttonIcon})})]})]}),children:l1("div",{className:M.colorPickerWrapper,children:[k("div",{className:o1(M.colorSwatch,{[M.colorSwatchOutline]:i}),style:{background:t.clear?"var(--ui-white)":V(o,a,p).hex},children:t.clear&&k("img",{src:O1})}),k("div",{className:M.pickerArrow,children:"▾"})]})})}import{useCallback as T3,useEffect as O3}from"preact/hooks";import{useSignal as U3}from"@preact/signals";import{Dropdown as S3}from"@blockcode/core";var G3=[{family:"Sans Serif"},{family:"Serif"},{family:"Handwriting"},{family:"Marker"},{family:"Curly"},{family:"Pixel"},{label:"中文",family:'"Microsoft YaHei", "微软雅黑", STXihei, "华文细黑"'},{label:"日本語",family:'"ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "メイリオ", Meiryo, "ＭＳ Ｐゴシック", "MS PGothic"'},{label:"한국어",family:"Malgun Gothic"}],Z3=(e,t)=>{let i=e.length>t.length?e:t,n=i==e?t:e,r;for(let o=0;o<n.length;o++)for(let a=0,p=n.length-o;p!=n.length+1;a++,p++)if(r=n.substring(a,p),i.indexOf(r)!=-1)return r;return""};async function d5(){try{let e=await window.queryLocalFonts(),t=new Map,i;for(let n of e){if(/demo/i.test(n.family))continue;if(i=n.fullName,t.has(n.family))i=t.get(n.family),i=Z3(i,n.fullName);t.set(n.family,i)}return t.entries().toArray().map(([n,r])=>({label:r,family:n}))}catch(e){return G3}}F(".vaJj7G_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;height:2rem;overflow:auto}.vaJj7G_displayed-font-name{font-size:.8rem}");var Q1={fontSelector:"vaJj7G_font-selector",displayedFontName:"vaJj7G_displayed-font-name"};import{jsx as s5}from"preact/jsx-runtime";function h5({font:e,onChange:t}){let i=U3(null),n=T3((r)=>()=>t(r),[t]);return O3(async()=>{let r=await d5();if(i.value=r.map((o)=>({label:o.label??o.family,style:{fontFamily:o.family},onClick:n(o)})),!e)i.value[0]?.onClick()},[e,n]),s5(S3,{className:Q1.fontSelector,items:i.value,children:s5("span",{className:Q1.displayedFontName,style:{fontFamily:e?.family},children:e?.label??e?.family})})}import{useCallback as Q}from"preact/hooks";import{classNames as S,keyMirror as q3}from"@blockcode/utils";import{translate as R,Button as P}from"@blockcode/core";F(":root{--paint-tools-box-width:6rem}.a1L2ya_tools-box-wrapper{width:var(--paint-tools-box-width);flex-flow:wrap;place-content:flex-start space-between;display:flex}.a1L2ya_small{width:3rem}.a1L2ya_tool-button{margin:calc(var(--space)/2);border-radius:calc(var(--space)/2);padding:calc(var(--space)/2);user-select:none;background:0 0;border:none;outline:none;transition:all .2s;display:inline-block}.a1L2ya_tool-button.a1L2ya_selected{background:var(--theme-primary)}.a1L2ya_tool-icon{vertical-align:middle;width:2rem;height:2rem}.a1L2ya_tool-button.a1L2ya_selected .a1L2ya_tool-icon{filter:brightness(0)invert()}");var L={selected:"a1L2ya_selected",small:"a1L2ya_small",toolButton:"a1L2ya_tool-button",toolIcon:"a1L2ya_tool-icon",toolsBoxWrapper:"a1L2ya_tools-box-wrapper"};var v1="./assets/icon-pen-vmav54fy.svg";var f1="./assets/icon-eraser-6exvhk0q.svg";var g5="./assets/icon-fill-70s8y3f8.svg";var w5="./assets/icon-text-e5hysycg.svg";var y1="./assets/icon-line-r61p9edw.svg";var k1="./assets/icon-curve-sngqpytw.svg";var C5="./assets/icon-rectangle-yasy0y9k.svg";var u5="./assets/icon-circle-ynejmr8k.svg";var I1="./assets/icon-isogon-dhadjxez.svg";var m5="./assets/icon-polygon-d2x4vbt9.svg";var L5="./assets/icon-select-7g007t5g.svg";import{jsx as I,jsxs as K3}from"preact/jsx-runtime";var l=q3({Pen:null,Eraser:null,Fill:null,Text:null,Line:null,Curve:null,Rectangle:null,Circle:null,Isogon:null,Polygon:null,Selector:null,Center:null,ColorPicker:null,OutlineColorPicker:null});function x5({small:e,paintTool:t,onSelect:i}){return K3("div",{className:S(L.toolsBoxWrapper,{[L.small]:e}),children:[I(P,{className:S(L.toolButton,{[L.selected]:t===l.Pen}),onClick:Q(()=>i(l.Pen),[]),children:I("img",{src:v1,className:L.toolIcon,title:R("paint.painter.pen","Pen")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Eraser}),onClick:Q(()=>i(l.Eraser),[]),children:I("img",{src:f1,className:L.toolIcon,title:R("paint.painter.eraser","Eraser")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Fill}),onClick:Q(()=>i(l.Fill),[]),children:I("img",{src:g5,className:L.toolIcon,title:R("paint.painter.fill","Fill")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Text}),onClick:Q(()=>i(l.Text),[]),children:I("img",{src:w5,className:L.toolIcon,title:R("paint.painter.text","Text")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Line}),onClick:Q(()=>i(l.Line),[]),children:I("img",{src:y1,className:L.toolIcon,title:R("paint.painter.line","Line")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Curve}),onClick:Q(()=>i(l.Curve),[]),children:I("img",{src:k1,className:L.toolIcon,title:R("paint.painter.curve","Curve")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Rectangle}),onClick:Q(()=>i(l.Rectangle),[]),children:I("img",{src:C5,className:L.toolIcon,title:R("paint.painter.rectangle","Rectangle")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Circle}),onClick:Q(()=>i(l.Circle),[]),children:I("img",{src:u5,className:L.toolIcon,title:R("paint.painter.circle","Circle")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Isogon}),onClick:Q(()=>i(l.Isogon),[]),children:I("img",{src:I1,className:L.toolIcon,title:R("paint.painter.isogon","Isogon")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Polygon}),onClick:Q(()=>i(l.Polygon),[]),children:I("img",{src:m5,className:L.toolIcon,title:R("paint.painter.polygon","Polygon")})}),I(P,{className:S(L.toolButton,{[L.selected]:t===l.Selector}),onClick:Q(()=>i(l.Selector),[]),children:I("img",{src:L5,className:L.toolIcon,title:R("paint.painter.select","Select")})})]})}import{useEffect as B1,useRef as L0,useCallback as a1}from"preact/hooks";import{batch as x0,useSignal as M0}from"@preact/signals";import{classNames as Z5,Konva as j}from"@blockcode/utils";import{useProjectContext as v0,Keys as X}from"@blockcode/core";var t0=(e)=>{let t;for(let i=0;i<e.height;i++){t=i*e.width;for(let n=0;n<e.width;n++){if(e.data[(t<<2)+3]!==0)return i;t++}}return 0},e0=(e,t)=>{let i;for(let n=e.height-1;n>=t;n--){i=n*e.width;for(let r=0;r<e.width;r++){if(e.data[(i<<2)+3]!==0)return n;i++}}return 0},i0=(e,t,i)=>{let n;for(let r=0;r<e.width;r++)for(let o=t;o<=i;o++)if(n=o*e.width+r,e.data[(n<<2)+3]!==0)return r;return 0},o0=(e,t,i,n)=>{let r;for(let o=e.width-1;o>=n;o--)for(let a=t;a<=i;a++)if(r=a*e.width+o,e.data[(r<<2)+3]!==0)return o;return 0};function M5(e){let t=t0(e),i=e0(e,t),n=i0(e,t,i),r=o0(e,t,i,n);return{top:t,left:n,right:r,bottom:i,x:n,y:t,width:r-n+1,height:i-t+1}}var v5="image/png",n0=`data:${v5};base64,`.length;async function f5(e,t){let r=(await e.toCanvas({pixelRatio:1})).getContext("2d").getImageData(0,0,e.width(),e.height()),o=M5(r),p=e.toDataURL({...o,mimeType:v5}).slice(n0),g=t.x-o.x,s=t.y-o.y,v=o.width,N=o.height;return{data:p,centerX:g,centerY:s,width:v,height:N}}F(".vAiLFq_draw-box{background:var(--ui-secondary);width:100%;height:100%;display:flex;position:relative;overflow:hidden}.vAiLFq_draw-container{image-rendering:pixelated;scrollbar-gutter:stable;scrollbar-width:8px;background:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjwhLS0gQ3JlYXRlZCB3aXRoIFZlY3Rvcm5hdG9yIChodHRwOi8vdmVjdG9ybmF0b3IuaW8vKSAtLT4KPHN2ZyBoZWlnaHQ9IjMwIiB3aWR0aD0iMzAiIHN0cm9rZS1taXRlcmxpbWl0PSIxMCIgc3R5bGU9ImZpbGwtcnVsZTpub256ZXJvO2NsaXAtcnVsZTpldmVub2RkO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDsiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDQwIDQwIiB4bWw6c3BhY2U9InByZXNlcnZlIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KPGRlZnMvPgo8Zz4KPHBhdGggZD0iTTAgMEw0MCAwTDQwIDQwTDAgNDBMMCAwWiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTAgMEwyMCAwTDIwIDIwTDAgMjBMMCAwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPHBhdGggZD0iTTIwIDIwTDQwIDIwTDQwIDQwTDIwIDQwTDIwIDIwWiIgZmlsbD0iI2VhZjBmOCIgZmlsbC1ydWxlPSJub256ZXJvIiBvcGFjaXR5PSIxIiBzdHJva2U9Im5vbmUiLz4KPC9nPgo8L3N2Zz4K);margin:0;padding:0;position:absolute;inset:0;overflow:scroll}.vAiLFq_draw-container.vAiLFq_text{cursor:text}.vAiLFq_draw-container.vAiLFq_center{cursor:crosshair}.vAiLFq_draw-container.vAiLFq_picker{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjBweCIgdmlld0JveD0iMCAwIDIwIDIwIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA0My4yICgzOTA2OSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+ZXllLWRyb3BwZXI8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZGVmcz48L2RlZnM+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iZXllLWRyb3BwZXIiIGZpbGw9IiM1NzVFNzUiPgogICAgICAgICAgICA8cGF0aCBkPSJNOS4xNTMzNDYwNSwxMi40ODI0OTYyIEM5LjAzMzk0MDQ0LDEyLjYxODg3MzcgOC44ODA0MTg5NSwxMi43MDQxMDk2IDguNjA3NDkxODYsMTIuNzcyMjk4MyBDNy45MDgxMTYxOCwxMi45MjU3MjMgNy4yNDI4NTYzOSwxMy41NTY0Njg4IDcuMDM4MTYxMDcsMTQuMjU1NDAzMyBDNi45Njk5MjkzLDE0LjQ3NzAxNjcgNi43NDgxNzYwMywxNC43MTU2NzczIDYuNTA5MzY0ODMsMTQuODM1MDA3NiBMNC43MzUzMzg3MSwxNS42NzAzMTk2IEM0LjY1MDA0OSwxNS43MDQ0MTQgNC41ODE4MTcyMiwxNS43MjE0NjEyIDQuNTQ3NzAxMzQsMTUuNzIxNDYxMiBMNC4yNzQ3NzQyNCwxNS40NjU3NTM0IEM0LjI3NDc3NDI0LDE1LjQ0ODcwNjIgNC4yNzQ3NzQyNCwxNS4zODA1MTc1IDQuMzI1OTQ4MDcsMTUuMjYxMTg3MiBMNS4xNjE3ODczLDEzLjQ3MTIzMjkgQzUuMjY0MTM0OTYsMTMuMjQ5NjE5NSA1LjUwMjk0NjE3LDEzLjAyODAwNjEgNS43NDE3NTczNywxMi45NTk4MTc0IEM2LjQ0MTEzMzA1LDEyLjczODIwNCA3LjA3MjI3Njk2LDEyLjA5MDQxMSA3LjI1OTkxNDMzLDExLjIzODA1MTggQzcuMjk0MDMwMjIsMTEuMTAxNjc0MyA3LjM3OTMxOTk0LDEwLjk2NTI5NjggNy40OTg3MjU1NCwxMC44Mjg5MTkzIEwxMS40MzkxMTA1LDYuOTA4MDY2OTcgTDEzLjA5MzczMSw4LjU2MTY0Mzg0IEw5LjE1MzM0NjA1LDEyLjQ4MjQ5NjIgWiBNMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IEMxNi44NjM1MzY1LDUuMDMyODc2NzEgMTcsNC42NzQ4ODU4NCAxNyw0LjMzMzk0MjE2IEMxNywzLjk5Mjk5ODQ4IDE2Ljg2MzUzNjUsMy42NTIwNTQ3OSAxNi42MDc2NjczLDMuMzk2MzQ3MDMgQzE2LjA3ODg3MTEsMi44Njc4ODQzMiAxNS4yNDMwMzE4LDIuODY3ODg0MzIgMTQuNzE0MjM1NiwzLjM5NjM0NzAzIEwxMy4yMzAxOTQ1LDQuODc5NDUyMDUgTDEzLjA1OTYxNTEsNC43MDg5ODAyMSBMMTIuNTEzNzYwOSw0LjE2MzQ3MDMyIEMxMi4xNzI2MDIsMy44MjI1MjY2NCAxMS42MDk2ODk5LDMuODIyNTI2NjQgMTEuMjY4NTMxLDQuMTYzNDcwMzIgTDEwLjYwMzI3MTIsNC44MTEyNjMzMiBDMTAuMjc5MTcwMyw1LjE1MjIwNyAxMC4yNjIxMTI0LDUuNjQ2NTc1MzQgMTAuNTUyMDk3NCw1Ljk4NzUxOTAzIEw2LjU5NDY1NDU0LDkuOTI1NDE4NTcgQzYuMzA0NjY5NTEsMTAuMjMyMjY3OSA2LjA5OTk3NDE4LDEwLjU5MDI1ODggNS45ODA1Njg1OCwxMS4xMDE2NzQzIEM1LjkyOTM5NDc1LDExLjM1NzM4MiA1LjYzOTQwOTcxLDExLjY0NzE4NDIgNS4zNjY0ODI2MiwxMS43MzI0MjAxIEM0LjgwMzU3MDQ5LDExLjkwMjg5MTkgNC4yNTc3MTYzLDEyLjM4MDIxMzEgNC4wMDE4NDcxNSwxMi45NDI3NzAyIEwzLjE2NjAwNzkyLDE0LjcxNTY3NzMgQzIuODkzMDgwODMsMTUuMzEyMzI4OCAyLjk2MTMxMjYsMTUuOTI2MDI3NCAzLjMzNjU4NzM2LDE2LjMxODExMjYgTDMuNjc3NzQ2MjMsMTYuNjU5MDU2MyBDMy44OTk0OTk0OSwxNi44ODA2Njk3IDQuMjA2NTQyNDcsMTcgNC41NDc3MDEzNCwxNyBDNC43Njk0NTQ2LDE3IDUuMDI1MzIzNzUsMTYuOTMxODExMyA1LjI2NDEzNDk2LDE2LjgyOTUyODIgTDcuMDU1MjE5MDEsMTUuOTk0MjE2MSBDNy42MTgxMzExNCwxNS43MjE0NjEyIDguMDk1NzUzNTYsMTUuMTkyOTk4NSA4LjI2NjMzMjk5LDE0LjYzMDQ0MTQgQzguMzM0NTY0NzcsMTQuMzU3Njg2NSA4LjY0MTYwNzc1LDE0LjA2Nzg4NDMgOS4wNTA5OTgzOSwxMy45ODI2NDg0IEM5LjQwOTIxNTIsMTMuODk3NDEyNSA5Ljc2NzQzMjAxLDEzLjY5Mjg0NjMgMTAuMDU3NDE3LDEzLjM4NTk5NyBMMTQuMDE0ODU5OSw5LjQ0ODA5NzQxIEMxNC4zNTYwMTg4LDkuNzM3ODk5NTQgMTQuODY3NzU3MSw5LjcwMzgwNTE4IDE1LjE3NDgwMDEsOS4zNzk5MDg2OCBMMTUuODQwMDU5OSw4LjczMjExNTY4IEMxNi4xODEyMTg3LDguMzkxMTcxOTkgMTYuMTgxMjE4Nyw3LjgyODYxNDkyIDE1Ljg0MDA1OTksNy40ODc2NzEyMyBMMTUuMjYwMDg5OCw2LjkwODA2Njk3IEwxNS4xMjM2MjYyLDYuNzcxNjg5NSBMMTYuNjA3NjY3Myw1LjI4ODU4NDQ3IFoiIGlkPSJleWUtZHJvcHBlci1pY29uIj48L3BhdGg+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4=) 4 15,crosshair}.vAiLFq_center-icon{pointer-events:none;filter:opacity(.7);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.vAiLFq_center-icon.vAiLFq_hidden{display:none}");var K={drawBox:"vAiLFq_draw-box",drawContainer:"vAiLFq_draw-container",center:"vAiLFq_center",hidden:"vAiLFq_hidden",text:"vAiLFq_text",picker:"vAiLFq_picker",centerIcon:"vAiLFq_center-icon"};import{Konva as r0}from"@blockcode/utils";var N1={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new r0.Line({stroke:this.color.hex,strokeWidth:this.size,globalCompositeOperation:this.isEraser?"destination-out":"source-over",lineCap:"round",lineJoin:"round",points:[t.x,t.y,t.x,t.y]}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.points().concat([t.x,t.y]);this.poly.points(i)},onEnd(e){this.poly.addName("done"),this.poly=null}};var y5={...N1,isEraser:!0};import{Color as k5,sleepMs as l0,Konva as a0}from"@blockcode/utils";var I5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.pixels=[],this.color=t.color},getIndex(e,t){let i=this.layer.width();return t*i+e<<2},getPos(e){let t=this.layer.width(),i=e>>2,n=Math.floor(i/t);return{x:i-n*t,y:n}},checkPixel(e,t,i){if(e<0||t<0||e>=this.imageData.width||t>=this.imageData.height)return;let n=this.getIndex(e,t);if(this.pixels.includes(n))return;let r=this.imageData.data.slice(n,n+4),o=new k5(Array.from(r));if(o.equals(i)&&o.notEquals(this.color))this.pixels.push(n)},async fill(e){let t=Math.floor(e.x),i=Math.floor(e.y),n=this.color.rgb,r=this.color.clear?0:255,o=this.layer.width(),a=this.layer.height(),g=(await this.layer.toCanvas({pixelRatio:1})).getContext("2d");this.imageData=g.getImageData(0,0,o,a);let s=this.getIndex(t,i),v=this.imageData.data.slice(s,s+4),N=new k5(Array.from(v));this.checkPixel(t,i,N);let B=g.createImageData(o,a);while(this.pixels.length>0)s=this.pixels.shift(),B.data[s+0]=n.r,B.data[s+1]=n.g,B.data[s+2]=n.b,B.data[s+3]=r,this.imageData.data[s+0]=n.r,this.imageData.data[s+1]=n.g,this.imageData.data[s+2]=n.b,this.imageData.data[s+3]=r,e=this.getPos(s),this.checkPixel(e.x-1,e.y,N),this.checkPixel(e.x+1,e.y,N),this.checkPixel(e.x,e.y-1,N),this.checkPixel(e.x,e.y+1,N);return this.imageData=null,g.putImageData(B,0,0),g.canvas.toDataURL()},async onBegin(e){if(this.color.clear)return;this.filling=!0;let t=this.stage.getPointerPosition(),i=await this.fill(t);this.image=new a0.Image({x:0,y:0}),this.layer.add(this.image),n1(i).then((n)=>{this.image.image(n),this.filling=!1})},async onEnd(e){this.pixels.length=0;while(!0){if(!this.filling)break;await l0(50)}this.image.addName("done"),this.image=null}};import{Konva as p0}from"@blockcode/utils";var c0=30,N5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.fontFamily=t.fontFamily,this.color=t.color},cancel(){this.cancelEditbox?.(),this.poly=null},enableEditbox(){this.poly.hide();let e=this.poly.absolutePosition(),t=this.stage.container().getBoundingClientRect(),i={x:t.x+e.x,y:t.y+e.y},n=document.createElement("div");document.body.appendChild(n),n.innerText=this.poly.text(),n.contentEditable="plaintext-only",n.style.position="absolute",n.style.top=i.y+"px",n.style.left=i.x+"px",n.style.minWidth=this.poly.fontSize()+"px",n.style.fontSize=this.poly.fontSize()+"px",n.style.border="none",n.style.padding="0px",n.style.margin="0px",n.style.background="none",n.style.outline="none",n.style.resize="auto",n.style.lineHeight=this.poly.lineHeight(),n.style.fontFamily=this.poly.fontFamily(),n.style.transformOrigin="left top",n.style.textAlign=this.poly.align(),n.style.color=this.poly.fill(),n.focus(),n.addEventListener("blur",()=>n.focus()),this.cancelEditbox=()=>{this.poly.text(n.innerText.trimEnd()),n.parentNode.removeChild(n),this.poly.show()}},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new p0.Text({x:t.x,y:t.y,text:"",fontSize:c0,fontFamily:this.fontFamily,fill:this.color.hex}),this.layer.add(this.poly),this.enableEditbox(this.stage,this.poly)},onDone(e){if(!this.poly)return;if(this.cancelEditbox?.(),this.poly.text().length===0)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null,this.cancelEditbox=null}};import{Konva as d0}from"@blockcode/utils";var b5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new d0.Line({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[t.x,t.y]}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.points();i[2]=t.x,i[3]=t.y,this.poly.points(i)},onEnd(e){this.poly.addName("done"),this.poly=null}};import{Konva as s0}from"@blockcode/utils";var B5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color},cancel(){if(!this.poly)return;let e=this.poly.getAttr("points");e.pop(),e.pop(),this.poly.setAttr("points",e),this.poly=null},draw(e,t){let i=t.getAttr("points"),n=t.x(),r=t.y();if(e.beginPath(),e.moveTo(i[0]-n,i[1]-r),i.length<6)e.lineTo(i[2]-n,i[3]-r);else{let p=2;for(;p<i.length-4;p+=2){var o=(i[p]-n+(i[p+2]-n))/2,a=(i[p+1]-r+(i[p+3]-r))/2;e.quadraticCurveTo(i[p]-n,i[p+1]-r,o,a)}e.quadraticCurveTo(i[p]-n,i[p+1]-r,i[p+2]-n,i[p+3]-r)}e.fillStrokeShape(t)},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new s0.Shape({stroke:this.color.hex,strokeWidth:this.size,lineCap:"round",lineJoin:"round",points:[t.x,t.y],sceneFunc:this.draw}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.getAttr("points"),n=i.length;i[n-2]=t.x,i[n-1]=t.y,this.poly.setAttr("points",i)},onEnd(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.getAttr("points");i.push(t.x),i.push(t.y),this.poly.setAttr("points",i)},onDone(e){this.poly.addName("done"),this.poly=null}};import{Konva as h0}from"@blockcode/utils";var D5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new h0.Rect({x:t.x,y:t.y,width:1,height:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.x(),n=this.poly.y(),r=t.x-i,o=t.y-n;this.poly.setAttrs({width:Math.abs(r),height:Math.abs(o),scale:{x:r<0?-1:1,y:o<0?-1:1}})},onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as g0}from"@blockcode/utils";var E5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new g0.Ellipse({x:t.x,y:t.y,radius:{x:1,y:1},fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.x(),n=this.poly.y(),r=t.x-i,o=t.y-n,a=e.evt.shiftKey||e.evt.ctrlKey||e.evt.metaKey,p=Math.sqrt(r*r+o*o);this.poly.setAttrs({radius:{x:a?p:Math.abs(r),y:a?p:Math.abs(o)},scale:{x:r<0?-1:1,y:o<0?-1:1}})},onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as w0}from"@blockcode/utils";var _5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.sides=t.sides,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},onBegin(e){if(this.color.clear&&this.outlineColor.clear)return;let t=this.stage.getPointerPosition();this.poly=new w0.RegularPolygon({x:t.x,y:t.y,sides:this.sides,radius:1,lineCap:"round",lineJoin:"round",fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.x(),n=this.poly.y(),r=t.x-i,o=t.y-n,a=Math.sqrt(r*r+o*o);this.poly.setAttrs({radius:a,scale:{x:r<0?-1:1,y:o<0?-1:1}})},onEnd(e){if(!this.poly)return;if(this.poly.radius()<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as C0}from"@blockcode/utils";var z5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.size=t.size,this.color=t.color,this.outlineWidth=t.outlineWidth,this.outlineColor=t.outlineColor},cancel(){if(!this.poly)return;let e=this.poly.getAttr("points");e.pop(),e.pop(),this.poly.setAttr("points",e),this.poly=null},onBegin(e){if(this.color.clear)return;let t=this.stage.getPointerPosition();this.poly=new C0.Line({points:[t.x,t.y],lineCap:"round",lineJoin:"round",closed:!0,fill:this.color.clear?"transparent":this.color.hex,stroke:this.outlineWidth===0||this.outlineColor.clear?"transparent":this.outlineColor.hex,strokeWidth:this.outlineColor.clear?0:this.outlineWidth}),this.layer.add(this.poly)},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.points(),n=i.length;i[n-2]=t.x,i[n-1]=t.y,this.poly.points(i)},onEnd(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.points();i.push(t.x),i.push(t.y),this.poly.points(i)},onDone(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.remove();else this.poly.setAttrs({name:"selector",draggable:!0});this.poly=null}};import{Konva as R1}from"@blockcode/utils";import{themeColors as u0}from"@blockcode/core";var F5={setup(e,t,i){this.stage=e.getStage(),this.layer=e,this.selectorLayer=this.stage.getLayers().at(-1),this.updateImage=i,t.onToolProxy(this)},cancel(){this.clipImage?.remove?.(),this.clipImage=null,this.cliped=!1},async delete(){if(this.clipImage)this.cancel();else this.layer.children[0].image(null);await this.updateImage()},flip(e,t){let i=this.clipImage;if(!i){let r=this.layer.children[0],o=r.width()/2,a=r.height()/2;i=new R1.Image({offsetX:o,offsetY:a,image:r.image(),x:r.x()+o,y:r.y()+a}),this.layer.add(i),r.image(null)}let n=i.scale();if(i.scale({x:Math.sign(e)*n.x,y:Math.sign(t)*n.y}),!this.clipImage)this.updateImage()},async clip(){this.poly.setAttr("stroke","transparent"),this.poly.moveTo(this.layer);let e=this.poly.getClientRect(),t=await this.layer.toImage(e),i=t.width/2,n=t.height/2;this.clipImage=new R1.Image({image:t,offsetX:i,offsetY:n,x:e.x+i,y:e.y+n,name:"selector",draggable:!0}),this.clipImage.on("dragmove",()=>this.changed=!0),this.layer.add(this.clipImage),this.changed=!1,this.cliped=!0,this.poly.setAttrs({fill:"black",globalCompositeOperation:"destination-out"})},onBegin(e){let t=this.stage.getPointerPosition();this.poly=new R1.Rect({x:t.x,y:t.y,width:1,height:1,dash:[5,5],fill:"transparent",stroke:u0.ui.theme.highlight,strokeWidth:1}),this.selectorLayer.add(this.poly),this.cliped=!1},onDrawing(e){if(!this.poly)return;let t=this.stage.getPointerPosition(),i=this.poly.x(),n=this.poly.y(),r=t.x-i,o=t.y-n;this.poly.setAttrs({width:Math.abs(r),height:Math.abs(o),scale:{x:r<0?-1:1,y:o<0?-1:1}})},async onEnd(e){if(!this.poly)return;let t=this.poly.size();if(t.width<10&&t.height<10)this.poly.destroy();else await this.clip();this.poly=null}};var A5={setup(e,t){this.stage=e.getStage(),this.layer=e,this.changeCenter=t.onCenterChange},onBegin(e){let t=this.stage.getPointerPosition();this.changeCenter(t)}};import{Color as G5}from"@blockcode/utils";var P1={setup(e,t){this.stage=e.getStage(),this.layer=e,this.pickColor=t.onPickColor},getIndex(e){let t=this.layer.width(),i=Math.floor(e.x);return Math.floor(e.y)*t+i<<2},async onBegin(e){let t=this.layer.width(),i=this.layer.height(),r=(await this.layer.toCanvas({pixelRatio:1})).getContext("2d");this.imageData=r.getImageData(0,0,t,i);let o=this.stage.getPointerPosition(),a=this.getIndex(o),p=this.imageData.data.slice(a,a+4),g=new G5(Array.from(p));this.pickColor(g)},onDrawing(e){if(!this.imageData)return;let t=this.stage.getPointerPosition(),i=this.getIndex(t),n=this.imageData.data.slice(i,i+4),r=new G5(Array.from(n));this.pickColor(r)},onEnd(e){this.imageData=null}};var b1="./assets/icon-center-1pm93998.svg";import{jsx as T5,jsxs as y0}from"preact/jsx-runtime";var f0={[l.Pen]:N1,[l.Eraser]:y5,[l.Fill]:I5,[l.Text]:N5,[l.Line]:b5,[l.Curve]:B5,[l.Rectangle]:D5,[l.Circle]:E5,[l.Isogon]:_5,[l.Polygon]:z5,[l.Selector]:F5,[l.Center]:A5,[l.ColorPicker]:P1,[l.OutlineColorPicker]:P1};function O5({zoom:e,maxSize:t,toolOptions:i,onSizeChange:n,onChange:r}){let o=L0(null),{asset:a,assetId:p,modified:g}=v0(),s=M0(null),v=a1(async()=>{if(s.value?.type===l.Center)return;if(!o.drawLayer.children.length)return;let h=o.image.position();h.x+=a.value.centerX,h.y+=a.value.centerY;let c=await f5(o.drawLayer,h);r(c)},[r]),N=a1((h)=>{let c=o.image.position(),C=h.x-c.x,f=h.y-c.y;r({centerX:C,centerY:f})},[r]),B=a1(()=>{let h=o.stage.find(".selector");if(h.length>0)return o.transformer.nodes(h),!0},[]),G=a1(()=>{let h=o.transformer.nodes();if(h.length>0)return o.transformer.nodes([]),h.forEach((c)=>{c.removeName("selector"),c.addName("done")}),!0},[]),_=a1(()=>{o.painting=!1,o.transformer.nodes([]);for(let h of o.drawLayer.children)if(h!==o.image)h.remove();s.value?.cancel?.()},[]),Y=a1((h)=>{if(h.target.tagName==="INPUT")return;switch(h.code){case X.ESC:case X.DELETE:case X.BACKSPACE:if(h.code!==X.ESC&&s.value?.type===l.Text)return;h.preventDefault(),_();return;case X.RETURN:case X.ENTER:if(s.value?.type===l.Text)return;h.preventDefault(),G(),v();return;case X.LEFT:h.preventDefault(),o.transformer.nodes().forEach((c)=>c.x(c.x()-1));return;case X.RIGHT:h.preventDefault(),o.transformer.nodes().forEach((c)=>c.x(c.x()+1));return;case X.UP:h.preventDefault(),o.transformer.nodes().forEach((c)=>c.y(c.y()-1));return;case X.DOWN:h.preventDefault(),o.transformer.nodes().forEach((c)=>c.y(c.y()+1));return}},[_]);return B1(async()=>{if(!/image\//.test(a.value?.type)||!o.image)return;let h=await M1(a.value);o.image.setAttrs({image:h,x:o.stage.width()/2-a.value.centerX,y:o.stage.height()/2-a.value.centerY}),_()},[p.value,g.value,_]),B1(()=>{if(o.stage){let{clientWidth:h,clientHeight:c,scrollLeft:C,scrollTop:f,scrollWidth:b,scrollHeight:u}=o.current,z={top:c/2,left:h/2},$={top:(f+z.top)/u*(c*e)-z.top,left:(C+z.left)/b*(h*e)-z.left,behavior:"instant"};o.stage.content.style.zoom=e,o.current.scrollTo($)}},[e]),B1(async()=>{if(o.drawLayer){if(s.value?.type!==i.type){if(G())await v();if(_(),s.value=f0[i.type],s.value)s.value.type=i.type}if(i.type===l.Center)i.onCenterChange=N;x0(()=>{i.onToolProxy(null),s.value?.setup(o.drawLayer,i,v)})}},[i,G,N,v]),B1(()=>{if(o.current){let{clientWidth:h,clientHeight:c}=o.current,C=Math.max(t.width,h),f=Math.max(t.height,c);o.stage=new j.Stage({container:o.current,width:C,height:C}),n({width:h,height:c});let b=new j.Layer({listening:!1}),u=new j.Layer;o.drawLayer=new j.Layer,o.stage.add(o.drawLayer,b,u);let z=(C-t.width)/2,$=(f-t.height)/2,C1=new j.Rect({x:0,y:0,width:C,height:$,fill:"black",opacity:0.2}),p1=new j.Rect({x:0,y:f-$,width:h,height:$,fill:"black",opacity:0.2}),u1=new j.Rect({x:0,y:$,width:z,height:t.height,fill:"black",opacity:0.2}),m1=new j.Rect({x:C-z,y:$,width:z,height:t.height,fill:"black",opacity:0.2});if(b.add(C1,p1,u1,m1),o.transformer=new j.Transformer({anchorStyleFunc(x){if(x.cornerRadius(5),x.hasName("top-center")||x.hasName("bottom-center"))x.height(6),x.offsetY(3),x.width(12),x.offsetX(6);if(x.hasName("middle-left")||x.hasName("middle-right"))x.height(12),x.offsetY(6),x.width(6),x.offsetX(3)}}),u.add(o.transformer),o.image=new j.Image,o.drawLayer.add(o.image),/image\//.test(a.value?.type))M1(a.value).then((x)=>{o.image.image(x),o.image.position({x:o.stage.width()/2-a.value.centerX,y:o.stage.height()/2-a.value.centerY})});o.painting=!1,o.stage.on("contextmenu",(x)=>x.evt.preventDefault()),o.stage.on("pointerdown",async(x)=>{if(o.painting||x.target.name()==="selector"||x.target.parent instanceof j.Transformer)return;if([l.ColorPicker,l.OutlineColorPicker].includes(s.value?.type))x.evt.stopPropagation();if(s.value.type===l.Selector&&s.value.cliped&&!s.value.changed){_();return}if(G()){await v(),s.value?.cancel?.();return}if(!s.value)return;s.value.onBegin?.(x),o.painting=!0}),o.stage.on("pointermove",(x)=>{if(o.painting)x.evt.preventDefault(),s.value.onDrawing?.(x)}),o.stage.on("pointerup",async(x)=>{if(o.painting){if(o.painting=!!s.value.onDone,await s.value.onEnd?.(x),[l.Curve,l.Text,l.Polygon].includes(s.value.type))return;if([l.Rectangle,l.Circle,l.Isogon,l.Selector].includes(s.value.type))B();else v()}}),o.stage.on("pointerdblclick",async(x)=>{if(o.painting&&[l.Polygon,l.Text,l.Curve].includes(s.value.type))if(o.painting=!1,await s.value.onDone?.(x),[l.Polygon,l.Text].includes(s.value.type))B();else v()}),document.addEventListener("keydown",Y),o.resizeObserver=new ResizeObserver(()=>{if(!o.stage)return;let{clientWidth:x,clientHeight:L1}=o.current,q=Math.max(t.width,x),t1=Math.max(t.height,L1);if(o.stage.size({width:q,height:t1}),n({width:x,height:L1}),a.value)o.image.position({x:q/2-a.value.centerX,y:t1/2-a.value.centerY});let c1=(q-t.width)/2,e1=(t1-t.height)/2;C1.size({width:q,height:e1}),p1.setAttrs({y:t1-e1,width:q,height:e1}),u1.setAttrs({y:e1,width:c1}),m1.setAttrs({x:q-c1,y:e1,width:c1})}),o.resizeObserver.observe(o.current)}return()=>{document.removeEventListener("keydown",Y),s.value?.cancel?.(),o.resizeObserver.unobserve(o.current),o.stage.destroy(),o.stage=null}},[]),y0("div",{className:K.drawBox,children:[T5("div",{ref:o,className:Z5(K.drawContainer,{[K.text]:s.value?.type===l.Text,[K.center]:s.value?.type===l.Center,[K.picker]:s.value?.type===l.ColorPicker||s.value?.type===l.OutlineColorPicker})}),T5("img",{src:b1,className:Z5(K.centerIcon,{[K.hidden]:s.value?.type!==l.Center})})]})}F("._03BnxG_painter-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._03BnxG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._03BnxG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._03BnxG_row-bottom{margin-right:var(--space);margin-left:calc(var(--paint-tools-box-width) + var(--space));justify-content:space-between}._03BnxG_row-bottom>div{display:inline-flex}._03BnxG_row:last-child{min-height:unset;margin-bottom:0}._03BnxG_tool-group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._03BnxG_disabled{opacity:.3;pointer-events:none}._03BnxG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._03BnxG_name-input{width:8rem}._03BnxG_large-input{width:4rem}._03BnxG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._03BnxG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._03BnxG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._03BnxG_tile-map-button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);height:calc(2rem + 2px);padding:.375rem}._03BnxG_button-left-icon{margin-right:calc(var(--space))}._03BnxG_button-icon{width:1.5rem;margin:auto}._03BnxG_group-button{border-left:none;border-radius:0}._03BnxG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._03BnxG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._03BnxG_group-button-toggled-off{filter:saturate(0)}._03BnxG_label-button{border:0;font-weight:400}._03BnxG_label-button._03BnxG_selected{background:var(--theme-primary);color:var(--ui-white)}._03BnxG_label-button._03BnxG_selected ._03BnxG_button-icon{filter:brightness(0)invert()}._03BnxG_draw-box-wrapper{margin:0 var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)/2);flex:1;position:relative;overflow:hidden}._03BnxG_font-selector{color:var(--text-primary);align-self:center;min-width:10rem;min-height:2rem;max-height:30vh;overflow:auto}._03BnxG_displayed-font-name{font-size:.8rem}");var d={groupButtonLast:"_03BnxG_group-button-last",nameInput:"_03BnxG_name-input",row:"_03BnxG_row",largeInput:"_03BnxG_large-input",toolIcon:"_03BnxG_tool-icon",groupButtonToggledOff:"_03BnxG_group-button-toggled-off",selected:"_03BnxG_selected",toolGroup:"_03BnxG_tool-group",buttonIcon:"_03BnxG_button-icon",dashedBorder:"_03BnxG_dashed-border",labelImage:"_03BnxG_label-image",button:"_03BnxG_button",groupButton:"_03BnxG_group-button",drawBoxWrapper:"_03BnxG_draw-box-wrapper",rowBottom:"_03BnxG_row-bottom",fontSelector:"_03BnxG_font-selector",rowFill:"_03BnxG_row-fill",tileMapButton:"_03BnxG_tile-map-button",groupButtonFirst:"_03BnxG_group-button-first",buttonLeftIcon:"_03BnxG_button-left-icon",painterWrapper:"_03BnxG_painter-wrapper",labelButton:"_03BnxG_label-button",displayedFontName:"_03BnxG_displayed-font-name",disabled:"_03BnxG_disabled"};var U5="./assets/icon-undo-q4nwvpxj.svg";var S5="./assets/icon-redo-mrvqwv38.svg";var W5="./assets/icon-crop-qqsh68n1.svg";var Y5="./assets/icon-zoom-in-s316e3qy.svg";var Q5="./assets/icon-zoom-out-y9xmwx8c.svg";var R5="./assets/icon-zoom-reset-xne8n5sw.svg";var P5="./assets/icon-tilemap-m9n9bthp.svg";var j5="./assets/icon-delete-97b0qwkk.svg";var J5="./assets/icon-flip-horizontal-kg60c0nb.svg";var V5="./assets/icon-flip-vertical-09q4h4q8.svg";import{jsx as w,jsxs as E,Fragment as U0}from"preact/jsx-runtime";var O0=30,_1=0.5,$5=20,H5=(e)=>{switch(e){case D.Image:return W("paint.painter.image","Image");case D.Costume:return W("paint.painter.costume","Costume");case D.Backdrop:return W("paint.painter.backdrop","Backdrop")}};function V1({mode:e,maxSize:t}){let{asset:i,assetId:n,modified:r}=Z0(),o=T(1),a=T(!1),p=T(null),g=T(l.Pen),s=T(null),v=T(10),N=T(2),B=T(6),G=T(null),_=T(new X5([260,0.6,1])),Y=T(new X5([0,1,0])),h=T([]),c=T([]),C=G0(()=>i.value?.name,[n.value,r.value]),f=!/image\//.test(i.value?.type);A0(()=>{h1(()=>{if(p.value=null,h.value=null,c.value=null,h.value=[],c.value=[],i.value)h.value.push(Object.assign({},i.value))})},[n.value]);let b=j1(()=>g.value!==l.Rectangle&&g.value!==l.Circle&&g.value!==l.Isogon&&g.value!==l.Polygon),u=j1(()=>g.value===l.Pen||g.value===l.Eraser||g.value===l.Line||g.value===l.Curve),z=j1(()=>{if(g.value===l.Eraser)return f1;if(g.value===l.Line)return y1;if(g.value===l.Curve)return k1;return v1}),$=y((m)=>D1({name:m}),[]),C1=y((m)=>{if(p.value===l.ColorPicker)_.value=m;else if(p.value===l.OutlineColorPicker)Y.value=m},[]),p1=y((m)=>(d1)=>{if(d1)p.value=m;else p.value=null},[]),u1=y((m)=>N.value=J1.clamp(m,0,100),[]),m1=y((m)=>v.value=J1.clamp(m,1,100),[]),x=y((m)=>B.value=J1.clamp(m,3,20),[]),L1=y((m)=>G.value=m,[]),q=y((m)=>{a.value=a.value?m.width<390:m.width<340},[]),t1=y((m)=>{h1(()=>{if(h.value.length>O0)h.value.shift();if(m)c.value.length=0,h.value.push(m),D1(m)})},[]),c1=y(()=>{h1(()=>{p.value=null;let m=h.value.pop();c.value.push(m),m=h.value[h.value.length-1],D1(m)})},[]),e1=y(()=>{h1(()=>{p.value=null;let m=c.value.pop();h.value.push(m),D1(m)})},[]),e3=y(async(m)=>{if(i.value){let d1=m/100,a3=`data:${i.value.type};base64,${i.value.data}`,z1=await n1(a3,d1),p3={data:z1.dataset.data,width:z1.width,height:z1.height,centerX:Math.round(i.value.centerX*d1),centerY:Math.round(i.value.centerY*d1)};t1(p3)}},[]),i3=y(()=>p.value=p.value!==l.Center?l.Center:null,[]),o3=y((m)=>s.value=m,[]),n3=y(()=>s.value?.delete?.(),[]),r3=y(()=>s.value?.flip?.(-1,1),[]),l3=y(()=>s.value?.flip?.(1,-1),[]);return E("div",{className:d.painterWrapper,children:[E("div",{className:d.row,children:[w("div",{className:d.toolGroup,children:w(E1,{text:H5(e),children:w(w1,{disabled:f,className:d.nameInput,placeholder:W("paint.painter.name","name"),onSubmit:$,value:C?T0(C):H5(e)})})}),E("div",{className:d.toolGroup,children:[w(J,{disabled:h.value.length<=1,className:O(d.button,d.groupButtonFirst,{[d.groupButtonToggledOff]:f}),onClick:c1,children:w("img",{src:U5,className:d.buttonIcon,title:W("paint.painter.undo","Undo")})}),w(J,{disabled:c.value.length===0,className:O(d.button,d.groupButtonLast,{[d.groupButtonToggledOff]:f}),onClick:e1,children:w("img",{src:S5,className:d.buttonIcon,title:W("paint.painter.redo","Redo")})})]}),E("div",{className:d.toolGroup,children:[E(J,{vertical:!0,disabled:e!==D.Costume,className:O(d.labelButton,{[d.selected]:p.value===l.Center}),onClick:i3,children:[w("img",{src:b1,className:d.buttonIcon,title:W("paint.painter.center","Center")}),w(g1,{id:"paint.painter.center",defaultMessage:"Center"})]}),E(J,{vertical:!0,disabled:!0,className:d.labelButton,onClick:y(()=>null,[]),children:[w("img",{src:W5,className:d.buttonIcon,title:W("paint.painter.crop","Auto Crop")}),w(g1,{id:"paint.painter.crop",defaultMessage:"Auto Crop"})]})]}),w("div",{className:d.toolGroup,children:w(E1,{text:W("paint.painter.resize","Resize"),children:w(w1,{small:!0,type:"number",disabled:f,className:d.largeInput,onSubmit:e3,value:100})})})]}),E("div",{className:d.row,children:[w("div",{className:d.toolGroup,children:w(E1,{className:O({[d.disabled]:g.value===l.Eraser||g.value===l.Selector}),text:w(g1,{id:"paint.painter.fill",defaultMessage:"Fill"}),children:w(Y1,{picking:p.value===l.ColorPicker,color:_.value,onChange:y((m)=>_.value=m,[]),onPickingColor:p1(l.ColorPicker)})})}),E("div",{className:O(d.toolGroup,d.dashedBorder),children:[w(E1,{className:O({[d.disabled]:b.value}),text:w(g1,{id:"paint.painter.outline",defaultMessage:"Outline"}),children:w(Y1,{outline:!0,picking:p.value===l.OutlineColorPicker,color:Y.value,onChange:y((m)=>Y.value=m,[]),onPickingColor:p1(l.OutlineColorPicker)})}),w(w1,{small:!0,type:"number",className:O(d.largeInput,{[d.disabled]:b.value}),value:N.value,onSubmit:u1})]}),u.value&&E("div",{className:d.toolGroup,children:[w("img",{src:z,className:d.toolIcon}),w(w1,{small:!0,type:"number",className:d.largeInput,value:v.value,onSubmit:m1})]}),g.value===l.Isogon&&E("div",{className:d.toolGroup,children:[w("img",{src:I1,className:d.toolIcon}),w(w1,{small:!0,type:"number",className:d.largeInput,value:B.value,onSubmit:x})]}),g.value===l.Text&&w(h5,{font:G.value,onChange:L1}),g.value===l.Selector&&E(U0,{children:[w("div",{className:O(d.toolGroup,d.dashedBorder),children:w(J,{className:d.labelButton,onClick:n3,children:w("img",{src:j5,className:d.buttonIcon,title:W("paint.painter.delete","Delete")})})}),E("div",{className:d.toolGroup,children:[w(J,{className:d.labelButton,onClick:r3,children:w("img",{src:J5,className:d.buttonIcon,title:W("paint.painter.flipHorizontal","Flip Horizontal")})}),w(J,{className:d.labelButton,onClick:l3,children:w("img",{src:V5,className:d.buttonIcon,title:W("paint.painter.flipVertical","Flip Vertical")})})]})]})]}),E("div",{className:O(d.row,d.rowFill),children:[w(x5,{small:a.value,paintTool:g.value,onSelect:y((m)=>h1(()=>{g.value=m,p.value=null}),[])}),w("div",{className:d.drawBoxWrapper,children:w(O5,{zoom:o.value,maxSize:t,toolOptions:{type:p.value||g.value,size:v.value,sides:B.value,color:_.value,fontFamily:G.value?.family,outlineWidth:N.value,outlineColor:Y.value,onPickColor:C1,onToolProxy:o3},onSizeChange:q,onChange:t1})})]}),E("div",{className:O(d.row,d.rowBottom),children:[w("div",{children:e===D.Backdrop&&E(J,{disabled:!0,className:d.tileMapButton,children:[w("img",{className:d.buttonLeftIcon,src:P5}),w(g1,{id:"paint.mode.tileMap",defaultMessage:"Convert to TileMap"})]})}),E("div",{children:[w(J,{disabled:o.value===1,className:O(d.button,d.groupButtonFirst),onClick:y(()=>o.value-_1>=1&&(o.value=o.value-_1),[]),children:w("img",{src:Q5,className:d.buttonIcon})}),w(J,{disabled:o.value===1,className:O(d.button,d.groupButton),onClick:y(()=>o.value=1,[]),children:w("img",{src:R5,className:d.buttonIcon})}),w(J,{disabled:o.value===$5,className:O(d.button,d.groupButtonLast),onClick:y(()=>o.value+_1<$5&&(o.value=o.value+_1),[]),children:w("img",{src:Y5,className:d.buttonIcon})})]})]})]})}F(".TDnbAa_pixel-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var q5={pixelEditorWrapper:"TDnbAa_pixel-editor-wrapper"};import{jsx as K5,jsxs as W0}from"preact/jsx-runtime";function S0({mode:e,maxSize:t,onImagesFilter:i,onShowLibrary:n,onSurprise:r,onChange:o,onDelete:a}){return W0("div",{className:q5.pixelEditorWrapper,children:[K5(p5,{mode:e,maxSize:t,onImagesFilter:i,onShowLibrary:n,onSurprise:r,onChange:o,onDelete:a}),K5(V1,{mode:e,maxSize:t})]})}import{Text as Q0}from"@blockcode/core";var t3="./assets/icon-paint-fcmp1zp4.svg";import{jsx as P0}from"preact/jsx-runtime";var R0={icon:t3,label:P0(Q0,{id:"paint.painter.image",defaultMessage:"Image"})};export{R0 as paintTab,n1 as loadImageFromURL,A1 as loadImageFromFile,M1 as loadImageFromAsset,S0 as PaintEditor,D as EditorModes,x1 as BlankImageData};
