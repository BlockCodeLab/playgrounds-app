import{addLocalesMessages as Q}from"@blockcode/core";var u={"mpyblocks.name":"Electronic Blocks","mpyblocks.menubar.device":"Device","mpyblocks.menubar.device.connect":"Connect","mpyblocks.menubar.device.disconnect":"Disconnect","mpyblocks.menubar.device.sync":"Sync blocks"};var _={"mpyblocks.name":"电子积木","mpyblocks.menubar.device":"设备","mpyblocks.menubar.device.connect":"连接","mpyblocks.menubar.device.disconnect":"断开连接","mpyblocks.menubar.device.sync":"同步脚本"};var i={"mpyblocks.name":"電子積木","mpyblocks.menubar.device":"設備","mpyblocks.menubar.device.connect":"連接","mpyblocks.menubar.device.disconnect":"斷開連接","mpyblocks.menubar.device.sync":"同步腳本"};Q({en:u,"zh-Hans":_,"zh-Hant":i});import{svgAsDataUri as Y}from"@blockcode/utils";import{ScratchBlocks as y,MPYGenerator as w,blocksTab as x,codeReviewTab as M1}from"@blockcode/blocks";import{Text as S}from"@blockcode/core";import{BlocksEditor as a,CodeReview as $1}from"@blockcode/blocks";import{useAppContext as W}from"@blockcode/core";var E="./assets/icon-device-9de6fxnz.svg";var M="./assets/icon-device-connected-3gcajtt2.svg";import{jsx as N}from"preact/jsx-runtime";function O(){let{appState:C}=W();return C.value?.device?N("img",{src:M}):N("img",{src:E})}import{nanoid as X}from"@blockcode/utils";import{useProjectContext as k,setAlert as Z,delAlert as t,openPromptModal as F}from"@blockcode/core";import{MPYUtils as f}from"@blockcode/board";import{Spinner as T,Text as h,MenuSection as c,MenuItem as U}from"@blockcode/core";import{jsx as n,Fragment as P}from"preact/jsx-runtime";var b=null,o=()=>{t(b),b=null},$=(C)=>{if(!b)b=X();if(C<100)Z({id:b,icon:n(T,{level:"success"}),message:n(h,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:C})});else Z("downloadCompleted",{id:b}),setTimeout(o,2000)},g=(C)=>{if(C==="NotFoundError")return;Z("connectionError",1000)};function q({itemClassName:C}){let{key:L,files:v,assets:H}=k();return n(P,{children:n(c,{children:n(U,{disabled:b,className:C,label:n(h,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(b)return;let m;try{m=await f.connect([])}catch(p){g(p.name)}if(!m)return;let K=f.check(m).catch(()=>{g(),o()}),d=[].concat(v.value,H.value).map((p)=>({...p,id:p.id.startsWith("lib/")?p.id:`proj${L.value}/${p.id}`}));$(0);try{if(!await f.flashFree(m,d))F({title:n(h,{id:"blocks.menu.device.name",defaultMessage:"Device"}),label:n(h,{id:"blocks.downloadPrompt.flashOutSpace",defaultMessage:"The flash is running out of space."})});else await f.write(m,d,$),await f.config(m,{"latest-project":L}),m.hardReset()}catch(p){g(p.name)}o(),K.cancel()}})})})}import{nanoid as I}from"@blockcode/utils";var G=I(),B=`
from blocks import *
import ${G}
start()
`,J={assets:[{id:"main",type:"text/x-python",content:B}],files:[{id:G,type:"text/x-python"}]};import{jsx as z}from"preact/jsx-runtime";var D=new w,A=()=>["mpy"],K1={onNew(){return J},onSave(C,L){let v=[];return C=C.map((m)=>{return v.push(m.extensions),{id:m.id,type:m.type,xml:m.xml}}),{meta:{extensions:Array.from(new Set(v.flat()))},files:C,assets:L}},async onThumb(){let C=y.getMainWorkspace();if(C){let L=C.getCanvas();if(L)return await Y(L,{})}},onUndo(C){if(C instanceof MouseEvent)y.getMainWorkspace()?.undo?.(!1)},onRedo(C){if(C instanceof MouseEvent)y.getMainWorkspace()?.undo?.(!0)},onEnableUndo(){let C=y.getMainWorkspace();return C?.undoStack_&&C.undoStack_.length!==0},onEnableRedo(){let C=y.getMainWorkspace();return C?.redoStack_&&C.redoStack_.length!==0},menuItems:[{icon:z(O,{}),label:z(S,{id:"mpyblocks.menubar.device",defaultMessage:"Device"}),Menu:q}],tabs:[{...x,Content:()=>{return y.Blocks.event_whenflagclicked={init(){this.jsonInit({message0:y.Msg.EVENT_WHENPROGRAMSTART,category:y.Categories.event,extensions:["colours_event","shape_hat"]})}},z(a,{generator:D,onExtensionsFilter:A})}}].concat([])};export{K1 as default};
