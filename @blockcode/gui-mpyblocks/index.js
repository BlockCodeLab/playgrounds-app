import{addLocalesMessages as K}from"@blockcode/core";var u={"mpyblocks.menubar.device":"Device","mpyblocks.menubar.device.connect":"Connect","mpyblocks.menubar.device.disconnect":"Disconnect","mpyblocks.menubar.device.sync":"Sync blocks"};var _={"mpyblocks.menubar.device":"设备","mpyblocks.menubar.device.connect":"连接","mpyblocks.menubar.device.disconnect":"断开连接","mpyblocks.menubar.device.sync":"同步脚本"};var G={"mpyblocks.menubar.device":"設備","mpyblocks.menubar.device.connect":"連接","mpyblocks.menubar.device.disconnect":"斷開連接","mpyblocks.menubar.device.sync":"同步腳本"};K({en:u,"zh-Hans":_,"zh-Hant":G});import{svgAsDataUri as S}from"@blockcode/utils";import{ScratchBlocks as y,MicroPythonGenerator as Y,blocksTab as w,codeReviewTab as N1}from"@blockcode/blocks";import{Text as x}from"@blockcode/core";import{BlocksEditor as a,CodeReview as c1}from"@blockcode/blocks";import{useAppContext as V}from"@blockcode/core";var M="./assets/icon-device-9de6fxnz.svg";var N="./assets/icon-device-connected-3gcajtt2.svg";import{jsx as O}from"preact/jsx-runtime";function $(){let{appState:C}=V();return C.value?.device?O("img",{src:N}):O("img",{src:M})}import{nanoid as W}from"@blockcode/utils";import{useProjectContext as X,setAlert as Z,delAlert as i,openPromptModal as F}from"@blockcode/core";import{MPYUtils as f}from"@blockcode/board";import{Spinner as T,Text as v,MenuSection as k,MenuItem as U}from"@blockcode/core";import{jsx as b,Fragment as B}from"preact/jsx-runtime";var n=null,z=()=>{i(n),n=null},c=(C)=>{if(!n)n=W();if(C<100)Z({id:n,icon:b(T,{level:"success"}),message:b(v,{id:"blocks.alert.downloading",defaultMessage:"Downloading...{progress}%",progress:C})});else Z("downloadCompleted",{id:n}),setTimeout(z,2000)},g=(C)=>{if(C==="NotFoundError")return;Z("connectionError",1000)};function q({itemClassName:C}){let{key:m,files:h,assets:d}=X();return b(B,{children:b(k,{children:b(U,{disabled:n,className:C,label:b(v,{id:"blocks.menu.device.download",defaultMessage:"Download program"}),onClick:async()=>{if(n)return;let L;try{L=await f.connect([])}catch(p){g(p.name)}if(!L)return;let J=f.check(L).catch(()=>{g(),z()}),o=[].concat(h.value,d.value).map((p)=>({...p,id:p.id.startsWith("lib/")?p.id:`proj${m.value}/${p.id}`}));c(0);try{if(!await f.flashFree(L,o))F({title:b(v,{id:"blocks.menu.device.name",defaultMessage:"Device"}),label:b(v,{id:"blocks.downloadPrompt.flashOutSpace",defaultMessage:"The flash is running out of space."})});else await f.write(L,o,c),await f.config(L,{"latest-project":m}),L.hardReset()}catch(p){g(p.name)}z(),J.cancel()}})})})}import{nanoid as P}from"@blockcode/utils";var t=P(),I=`
from blocks import *
import ${t}
start()
`,E={assets:[{id:"main",type:"text/x-python",content:I}],files:[{id:t,type:"text/x-python"}]};import{jsx as H}from"preact/jsx-runtime";var D=new Y,A=()=>["device"],J1={onNew(){return E},onSave(C,m){let h=[];return C=C.map((L)=>{return h.push(L.extensions),{id:L.id,type:L.type,xml:L.xml}}),{meta:{extensions:Array.from(new Set(h.flat()))},files:C,assets:m}},async onThumb(){let C=y.getMainWorkspace();if(C){let m=C.getCanvas();if(m)return await S(m,{})}},onUndo(C){if(C instanceof MouseEvent)y.getMainWorkspace()?.undo?.(!1)},onRedo(C){if(C instanceof MouseEvent)y.getMainWorkspace()?.undo?.(!0)},onEnableUndo(){let C=y.getMainWorkspace();return C?.undoStack_&&C.undoStack_.length!==0},onEnableRedo(){let C=y.getMainWorkspace();return C?.redoStack_&&C.redoStack_.length!==0},menuItems:[{icon:H($,{}),label:H(x,{id:"mpyblocks.menubar.device",defaultMessage:"Device"}),Menu:q}],tabs:[{...w,Content:()=>H(a,{disableMonitor:!0,generator:D,onExtensionsFilter:A})}].concat([])};export{J1 as default};
