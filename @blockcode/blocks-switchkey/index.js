import{addLocalesMessages as P,Text as h}from"@blockcode/core";import{changeCase as y}from"@blockcode/utils";import{Text as c}from"@blockcode/core";import{jsx as f}from"preact/jsx-runtime";var k=(t)=>[{id:"whenKey",text:f(c,{id:"blocks.switchkey.whenKey",defaultMessage:"when pin [PIN] [STATE]"}),hat:!0,inputs:{PIN:t.boardPins?{menu:t.boardPins.in}:{type:"positive_integer",defaultValue:"1"},STATE:{menu:"StateOption"}},ino(e){let r=t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE),i=e.getFieldValue("STATE"),l=`_1button_${r}`,n="buttonTick";if(this.definitions_.include_timerone="#include <TimerOne.h>",this.definitions_.declare_buttonTick="void buttonTick();",!this.definitions_.buttonTick)this.definitions_.buttonTick=`void buttonTick() {
}`;this.definitions_.buttonTick=this.definitions_.buttonTick.replace(`
}`,`
  ${l}.tick();
}`),this.definitions_.include_onebutton="#include <OneButton.h>",this.definitions_[`variable_${l}`]=`OneButton ${l}(${r});`;let s=`${l}_${i}`,_=this.statementToCode(e)||"";if(this.definitions_[`declare_${s}`]=`void ${s}();`,this.definitions_[s]=`void ${s}() {
${_}}`,this.definitions_[`setup_${s}`]=`${l}.attach${i}(${s});`,this.definitions_.setup_timerone)delete this.definitions_.setup_timerone,delete this.definitions_.setup_buttonTick;this.definitions_.setup_timerone="Timer1.initialize(10000);",this.definitions_.setup_buttonTick="Timer1.attachInterrupt(buttonTick);"},mpy(e){let r=t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE),i=y.snakeCase(e.getFieldValue("STATE")),l=`_1button_${r}`;this.definitions_.import_onebutton="from onebutton import OneButton",this.definitions_[l]=`${l} = OneButton(${r})`;let n=this.createName("_1button_flag");this.definitions_[n]=`${n} = asyncio.ThreadSafeFlag()`;let s=this.statementToCode(e)||"",_="";_+=`while True:
`,_+=`${this.INDENT}await ${n}.wait()
`,_+=s;let u=this.createName(`${l}_${i}`);s=this.prefixLines(_,this.INDENT),s=this.addEventTrap(s,"1button_callback"),_=`@_tasks__.append
`,_+=s,_+=`${l}.on_${i}(lambda: ${n}.set())
`,this.definitions_[u]=_}},{id:"keyState",text:f(c,{id:"blocks.switchkey.keyState",defaultMessage:"pin [PIN] is pressed?"}),output:"boolean",inputs:{PIN:t.boardPins?{menu:t.boardPins.in}:{type:"positive_integer",defaultValue:"1"}},ino(e){return[`(digitalRead(${t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE)}) == LOW)`,this.ORDER_ATOMIC]},mpy(e){let r=t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE),i=`_1button_${r}`;return this.definitions_.import_onebutton="from onebutton import OneButton",this.definitions_[i]=`${i} = OneButton(${r})`,[`${i}.is_pressed()`,this.ORDER_FUNCTION_CALL]}}],o={StateOption:{items:[[f(c,{id:"blocks.switchkey.keyClick",defaultMessage:"click"}),"Click"],[f(c,{id:"blocks.switchkey.keyDoubleClick",defaultMessage:"doubel click"}),"DoubleClick"],[f(c,{id:"blocks.switchkey.keyLongPressed",defaultMessage:"long pressed"}),"LongPressStart"],[f(c,{id:"blocks.switchkey.keyDuringLongPressed",defaultMessage:"long pressed (during)"}),"DuringLongPress"]]}};var a={en:{"blocks.switchkey.name":"Key Input","blocks.switchkey.whenKey":"when pin [PIN] [STATE]","blocks.switchkey.keyState":"pin [PIN] is pressed?","blocks.switchkey.keyPressed":"pressed","blocks.switchkey.keyClick":"click","blocks.switchkey.keyDoubleClick":"doubel click","blocks.switchkey.keyLongPressed":"long pressed","blocks.switchkey.keyDuringLongPressed":"long pressed (during)"},"zh-Hans":{"blocks.switchkey.name":"按键输入","blocks.switchkey.whenKey":"当引脚 [PIN] 被 [STATE]","blocks.switchkey.keyState":"按下引脚 [PIN]？","blocks.switchkey.keyClick":"单击","blocks.switchkey.keyDoubleClick":"双击","blocks.switchkey.keyLongPressed":"长按","blocks.switchkey.keyDuringLongPressed":"长按（持续）"},"zh-Hant":{"blocks.switchkey.name":"按鍵輸入","blocks.switchkey.whenKey":"當引腳 [PIN] 被 [STATE]","blocks.switchkey.keyState":"按下引腳 [PIN]？","blocks.switchkey.keyClick":"單擊","blocks.switchkey.keyDoubleClick":"雙擊","blocks.switchkey.keyLongPressed":"長按","blocks.switchkey.keyDuringLongPressed":"長按（持續）"}};var d="./assets/icon-3d98sx44.png";var p="./assets/onebutton-qdw4a1gg.py";import{jsx as w}from"preact/jsx-runtime";P(a);var T={icon:d,name:w(h,{id:"blocks.switchkey.name",defaultMessage:"Key Input"}),files(t){if(t.editor!=="@blockcode/gui-arduino")return[{name:"onebutton",common:!0,type:"text/x-python",uri:p}];return[]},blocks:k,menus:o};export{T as default};
