import{addLocalesMessages as g,Text as h}from"@blockcode/core";import{Text as f}from"@blockcode/core";import{jsx as n}from"preact/jsx-runtime";var k=(i)=>[{id:"whenKey",text:n(f,{id:"blocks.switchkey.whenKey",defaultMessage:"when pin [PIN] [STATE]"}),hat:!0,inputs:{PIN:i.boardPins?{menu:i.boardPins.in}:{type:"positive_integer",defaultValue:"1"},STATE:{menu:"StateOption"}},ino(s){let c=i.boardPins?s.getFieldValue("PIN"):this.valueToCode(s,"PIN",this.ORDER_NONE),_=s.getFieldValue("STATE"),l=`_1button_${c}`;this.definitions_.include_onebutton="#include <OneButton.h>",this.definitions_[`variable_${l}`]=`OneButton ${l}(${c});`;let t=`${l}_${_}`,r=this.statementToCode(s)||"";this.definitions_[`declare_${t}`]=`void ${t}();`,this.definitions_[t]=`void ${t}() {
${r}}`,this.definitions_[`setup_${t}`]=`${l}.attach${_}(${t});`;let e="msTimer_10";if(this.definitions_.include_mstimer2="#include <MsTimer2.h>",this.definitions_[`declare_${e}`]=`void ${e}();`,this.definitions_[e]=`void ${e}() {
  ${l}.tick();
}`,this.definitions_[`setup_${e}`])delete this.definitions_[`setup_${e}`],delete this.definitions_[`setup_${e}_start`];this.definitions_[`setup_${e}`]=`MsTimer2::set(10, ${e});`,this.definitions_[`setup_${e}_start`]="MsTimer2::start();"},mpy(s){let c=i.boardPins?s.getFieldValue("PIN"):this.valueToCode(s,"PIN",this.ORDER_NONE),_=s.getFieldValue("STATE").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase(),l=`_1button_${c}`;this.definitions_.import_onebutton="from onebutton import OneButton",this.definitions_[l]=`${l} = OneButton(${c})`;let t=this.createName("_1button_flag");this.definitions_[t]=`${t} = asyncio.ThreadSafeFlag()`;let r=this.statementToCode(s)||"",e="";e+=`while True:
`,e+=`${this.INDENT}await ${t}.wait()
`,e+=r;let p=this.createName(`${l}_${_}`);r=this.prefixLines(e,this.INDENT),r=this.addEventTrap(r,"1button_callback"),e=`@_tasks__.append
`,e+=r,e+=`${l}.on_${_}(lambda: ${t}.set())
`,this.definitions_[p]=e}},{id:"keyState",text:n(f,{id:"blocks.switchkey.keyState",defaultMessage:"pin [PIN] is pressed?"}),output:"boolean",inputs:{PIN:i.boardPins?{menu:i.boardPins.in}:{type:"positive_integer",defaultValue:"1"}},ino(s){return[`(digitalRead(${i.boardPins?s.getFieldValue("PIN"):this.valueToCode(s,"PIN",this.ORDER_NONE)}) == LOW)`,this.ORDER_ATOMIC]},mpy(s){let c=i.boardPins?s.getFieldValue("PIN"):this.valueToCode(s,"PIN",this.ORDER_NONE),_=`_1button_${c}`;return this.definitions_.import_onebutton="from onebutton import OneButton",this.definitions_[_]=`${_} = OneButton(${c})`,[`${_}.is_pressed()`,this.ORDER_FUNCTION_CALL]}}],o={StateOption:{items:[[n(f,{id:"blocks.switchkey.keyClick",defaultMessage:"click"}),"Click"],[n(f,{id:"blocks.switchkey.keyDoubleClick",defaultMessage:"doubel click"}),"DoubleClick"],[n(f,{id:"blocks.switchkey.keyLongPressed",defaultMessage:"long pressed"}),"LongPressStart"],[n(f,{id:"blocks.switchkey.keyDuringLongPressed",defaultMessage:"long pressed (during)"}),"DuringLongPress"]]}};var d={en:{"blocks.switchkey.name":"Key Input","blocks.switchkey.whenKey":"when pin [PIN] [STATE]","blocks.switchkey.keyState":"pin [PIN] is pressed?","blocks.switchkey.keyPressed":"pressed","blocks.switchkey.keyClick":"click","blocks.switchkey.keyDoubleClick":"doubel click","blocks.switchkey.keyLongPressed":"long pressed","blocks.switchkey.keyDuringLongPressed":"long pressed (during)","blocks.switchkey.adcKeyPressed":"pin [PIN] adc keyboard [KEY] key is pressed?"},"zh-Hans":{"blocks.switchkey.name":"按键输入","blocks.switchkey.whenKey":"当引脚 [PIN] 被 [STATE]","blocks.switchkey.keyState":"引脚 [PIN] 被按下？","blocks.switchkey.keyPressed":"按下","blocks.switchkey.keyClick":"单击","blocks.switchkey.keyDoubleClick":"双击","blocks.switchkey.keyLongPressed":"长按","blocks.switchkey.keyDuringLongPressed":"长按（持续）","blocks.switchkey.adcKeyPressed":"按下引脚 [PIN] ADC 按键的 [KEY] 键？"},"zh-Hant":{"blocks.switchkey.name":"按鍵輸入","blocks.switchkey.whenKey":"當引腳 [PIN] 被 [STATE]","blocks.switchkey.keyState":"引腳 [PIN] 被按下？","blocks.switchkey.keyPressed":"按下","blocks.switchkey.keyClick":"單擊","blocks.switchkey.keyDoubleClick":"雙擊","blocks.switchkey.keyLongPressed":"長按","blocks.switchkey.keyDuringLongPressed":"長按（持續）","blocks.switchkey.adcKeyPressed":"按下引腳 [PIN] ADC 按鍵的 [KEY] 鍵？"}};var a="./assets/icon-3d98sx44.png";var y="./assets/onebutton-qdw4a1gg.py";import{jsx as I}from"preact/jsx-runtime";g(d);var K={icon:a,name:I(h,{id:"blocks.switchkey.name",defaultMessage:"Key Input"}),files(i){if(i.editor!=="@blockcode/gui-arduino")return[{name:"onebutton",common:!0,type:"text/x-python",uri:y}];return[]},blocks:k,menus:o};export{K as default};
