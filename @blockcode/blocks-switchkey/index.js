import{addLocalesMessages as P,Text as h}from"@blockcode/core";import{changeCase as y}from"@blockcode/utils";import{Text as f}from"@blockcode/core";import{jsx as n}from"preact/jsx-runtime";var k=(t)=>[{id:"whenKey",text:n(f,{id:"blocks.switchkey.whenKey",defaultMessage:"when pin [PIN] [STATE]"}),hat:!0,inputs:{PIN:t.boardPins?{menu:t.boardPins.in}:{type:"positive_integer",defaultValue:"1"},STATE:{menu:"StateOption"}},ino(e){let _=t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE),i=e.getFieldValue("STATE"),s=`_1button_${_}`;this.definitions_[`tick_${s}`]=`${s}.tick();`,this.definitions_.include_onebutton="#include <OneButton.h>",this.definitions_[`variable_${s}`]=`OneButton ${s}(${_});`;let l=`${s}_${i}`,c=this.statementToCode(e)||"";this.definitions_[`declare_${l}`]=`void ${l}();`,this.definitions_[l]=`void ${l}() {
${c}}`,this.definitions_[`setup_${l}`]=`${s}.attach${i}(${l});`},mpy(e){let _=t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE),i=y.snakeCase(e.getFieldValue("STATE")),s=`_1button_${_}`;this.definitions_.import_onebutton="from onebutton import OneButton",this.definitions_[s]=`${s} = OneButton(${_})`;let l=this.createName("_1button_flag");this.definitions_[l]=`${l} = asyncio.ThreadSafeFlag()`;let c=this.statementToCode(e)||"",r="";r+=`while True:
`,r+=`${this.INDENT}await ${l}.wait()
`,r+=c;let u=this.createName(`${s}_${i}`);c=this.prefixLines(r,this.INDENT),c=this.addEventTrap(c,"1button_callback"),r=`@_tasks__.append
`,r+=c,r+=`${s}.on_${i}(lambda: ${l}.set())
`,this.definitions_[u]=r}},{id:"keyState",text:n(f,{id:"blocks.switchkey.keyState",defaultMessage:"pin [PIN] is pressed?"}),output:"boolean",inputs:{PIN:t.boardPins?{menu:t.boardPins.in}:{type:"positive_integer",defaultValue:"1"}},ino(e){return[`(digitalRead(${t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE)}) == LOW)`,this.ORDER_ATOMIC]},mpy(e){let _=t.boardPins?e.getFieldValue("PIN"):this.valueToCode(e,"PIN",this.ORDER_NONE),i=`_1button_${_}`;return this.definitions_.import_onebutton="from onebutton import OneButton",this.definitions_[i]=`${i} = OneButton(${_})`,[`${i}.is_pressed()`,this.ORDER_FUNCTION_CALL]}}],o={StateOption:{items:[[n(f,{id:"blocks.switchkey.keyClick",defaultMessage:"click"}),"Click"],[n(f,{id:"blocks.switchkey.keyDoubleClick",defaultMessage:"doubel click"}),"DoubleClick"],[n(f,{id:"blocks.switchkey.keyLongPressed",defaultMessage:"long pressed"}),"LongPressStart"],[n(f,{id:"blocks.switchkey.keyDuringLongPressed",defaultMessage:"long pressed (during)"}),"DuringLongPress"]]}};var a={en:{"blocks.switchkey.name":"Key Input","blocks.switchkey.whenKey":"when pin [PIN] [STATE]","blocks.switchkey.keyState":"pin [PIN] is pressed?","blocks.switchkey.keyPressed":"pressed","blocks.switchkey.keyClick":"click","blocks.switchkey.keyDoubleClick":"doubel click","blocks.switchkey.keyLongPressed":"long pressed","blocks.switchkey.keyDuringLongPressed":"long pressed (during)"},"zh-Hans":{"blocks.switchkey.name":"按键输入","blocks.switchkey.whenKey":"当引脚 [PIN] 被 [STATE]","blocks.switchkey.keyState":"按下引脚 [PIN]？","blocks.switchkey.keyClick":"单击","blocks.switchkey.keyDoubleClick":"双击","blocks.switchkey.keyLongPressed":"长按","blocks.switchkey.keyDuringLongPressed":"长按（持续）"},"zh-Hant":{"blocks.switchkey.name":"按鍵輸入","blocks.switchkey.whenKey":"當引腳 [PIN] 被 [STATE]","blocks.switchkey.keyState":"按下引腳 [PIN]？","blocks.switchkey.keyClick":"單擊","blocks.switchkey.keyDoubleClick":"雙擊","blocks.switchkey.keyLongPressed":"長按","blocks.switchkey.keyDuringLongPressed":"長按（持續）"}};var d="./assets/icon-3d98sx44.png";var p="./assets/onebutton-qdw4a1gg.py";import{jsx as w}from"preact/jsx-runtime";P(a);var T={icon:d,name:w(h,{id:"blocks.switchkey.name",defaultMessage:"Key Input"}),files(t){if(t.editor!=="@blockcode/gui-arduino")return[{name:"onebutton",common:!0,type:"text/x-python",uri:p}];return[]},blocks:k,menus:o};export{T as default};
