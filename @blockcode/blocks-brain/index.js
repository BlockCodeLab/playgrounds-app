import{getUserConfig as ae,setUserConfig as te}from"@blockcode/utils";import{addLocalesMessages as W,openPromptModal as oe,Text as H}from"@blockcode/core";import{fetchSpark as S,getUserConfig as c}from"@blockcode/utils";var N=6,E="https://spark-api-open.xf-yun.com/v1/chat/completions",o="qQIJHdBFkpbHDoMnPqnW:oeanHZdXCBHIHTOYvVim",M="db45f79e",A="MWFiNjVmNDA4YjNhODFkZGE0MGQ1YWRj",O="6a3dfe79b9e9ec588ca65bf3b9d9c847",q=(t=o)=>({"Content-Type":"application/json",Authorization:`Bearer ${t}`}),R=(t,e={})=>({model:e.model??"lite",user:e.user??"default",messages:t,temperature:0.4,top_k:3,max_tokens:70,stream:!1});function p(t){return{get key(){return"brain"},getHistory(e){return t.getData(e,"brain.history")??[]},addHistory(e,a){let s=this.getHistory(e);if(s.push(a),s.length>N)s.shift();t.setData(e,"brain.history",s)},getPrompts(e){return t.getData(e,"brain.prompts")??[]},addPrompt(e,a){let s=this.getPrompts(e);s.push(a),t.setData(e,"brain.prompts",s)},clear(e){t.setData(e,"brain.history",null),t.setData(e,"brain.prompts",null),t.setData(e,"brain.result",null)},getAnswer(e){return t.getData(e,"brain.result")??""},async askSpark(e,a,s="lite"){let d=c("SparkAI.APIPassword")||o,f=c("SparkAI.APPID")||M,y=c("SparkAI.APISecret")||A,w=c("SparkAI.APIKey")||O,g=e.id();this.addHistory(e,{role:"user",content:`${a}`});let P=this.getPrompts(e),T=[].concat({role:"system",content:`你的话不多，擅长总结归纳，回总是简明扼要。。${P.join("；")}。`},this.getHistory(e)),n;try{n=await S(E,{method:"POST",mode:"no-cors",headers:q(d),body:JSON.stringify(R(T,{model:s,user:g})),auth:{appId:f,apiSecret:y,apiKey:w}}),n=await n.json()}catch(I){console.error(I)}if(n?.choices[0]?.message.content)this.addHistory(e,n.choices[0].message),t.setData(e,"brain.result",n.choices[0].message.content)}}}import{getUserConfig as r}from"@blockcode/utils";import{Text as l}from"@blockcode/core";import{jsx as i}from"preact/jsx-runtime";var u=(t)=>[{id:"addPrompt",text:i(l,{id:"blocks.brain.addPrompt",defaultMessage:"add [PROMPT] prompt to Brain"}),inputs:{PROMPT:{type:"string",defaultValue:i(l,{id:"blocks.brain.prompt",defaultMessage:"your role is a cat"})}},emu(e){return`runtime.extensions.brain.addPrompt(target, ${this.valueToCode(e,"PROMPT",this.ORDER_NONE)||""});
`},mpy(e){let a=this.quote_(r("SparkAI.Model")??"lite"),s=this.quote_(r("SparkAI.APIPassword")??o);return this.definitions_.my_brain=`my_brain = brain.Brain(${s}, ${a})`,`my_brain.add_prompt(${this.valueToCode(e,"PROMPT",this.ORDER_NONE)||""})
`}},{id:"askQuestion",text:i(l,{id:"blocks.brain.askQuestion",defaultMessage:"ask Brain [QUESTION] and wait"}),inputs:{QUESTION:{type:"string",defaultValue:i(l,{id:"blocks.brain.question",defaultMessage:"Who are you?"})}},emu(e){return`await runtime.extensions.brain.askSpark(target, ${this.valueToCode(e,"QUESTION",this.ORDER_NONE)||'""'})
`},mpy(e){let a=this.quote_(r("SparkAI.Model")??"lite"),s=this.quote_(r("SparkAI.APIPassword")??o);return this.definitions_.my_brain=`my_brain = brain.Brain(${s}, ${a})`,`await my_brain.ask(${this.valueToCode(e,"QUESTION",this.ORDER_NONE)||'""'})
`}},{id:"answer",text:i(l,{id:"blocks.brain.answer",defaultMessage:"answer"}),output:"string",emu(e){return["runtime.extensions.brain.getAnswer(target)",this.ORDER_FUNCTION_CALL]},mpy(e){let a=this.quote_(r("SparkAI.Model")??"lite"),s=this.quote_(r("SparkAI.APIPassword")??o);return this.definitions_.my_brain=`my_brain = brain.Brain(${s}, ${a})`,["my_brain.result",this.ORDER_MEMBER]}},"---",{id:"clearPrompt",text:i(l,{id:"blocks.brain.clearHistory",defaultMessage:"delete all history"}),emu(e){return`runtime.extensions.brain.clear(target);
`},mpy(e){let a=this.quote_(r("SparkAI.Model")??"lite"),s=this.quote_(r("SparkAI.APIPassword")??o);return this.definitions_.my_brain=`my_brain = brain.Brain(${s}, ${a})`,`my_brain.clear()
`}}];var _="./assets/brain-zkyk4h4s.py";var h="./assets/aiohttp-0qva3nva.py";var m="./assets/aiohttp_ws-cykkq64e.py";var b="./assets/sparkai-gnvbpvrd.py";var C={en:{"blocks.brain.name":"Brain","blocks.brain.openplatform":"iFLYTEK Open Platform authorization","blocks.brain.openplatform.APIPassword":"HTTP authorization APIPassword","blocks.brain.openplatform.APPID":"WebSocket authorization APPID","blocks.brain.openplatform.APISecret":"WebSocket authorization APISecret","blocks.brain.openplatform.APIKey":"WebSocket authorization APIKey","blocks.brain.openplatform.description1":"Please register your own ","blocks.brain.openplatform.description2":"iFLYTEK Open Platform (Chinese)","blocks.brain.openplatform.description3":" account, the test account we provide does not guarantee that every request will be successful.","blocks.brain.addPrompt":"add prompt [PROMPT] to Brain","blocks.brain.prompt":"dialogue with the character of a cat","blocks.brain.clearHistory":"delete prompts and result","blocks.brain.askQuestion":"ask Brain [QUESTION] and wait","blocks.brain.question":"hello","blocks.brain.answer":"answer"},"zh-Hans":{"blocks.brain.name":"智脑","blocks.brain.openplatform":"讯飞开放平台认证信息","blocks.brain.openplatform.APIPassword":"HTTP 服务鉴权 APIPassword","blocks.brain.openplatform.APPID":"WebSocket 服务鉴权 APPID","blocks.brain.openplatform.APISecret":"WebSocket 服务鉴权 APISecret","blocks.brain.openplatform.APIKey":"WebSocket 服务鉴权 APIKey","blocks.brain.openplatform.description1":"请注册您自己的","blocks.brain.openplatform.description2":"讯飞开放平台","blocks.brain.openplatform.description3":"账号，我们提供的测试账号不保证每次请求都成功。","blocks.brain.addPrompt":"将指令说明 [PROMPT] 加入智脑","blocks.brain.prompt":"用一只猫的性格对话","blocks.brain.clearHistory":"删除指令和结果","blocks.brain.askQuestion":"询问智脑 [QUESTION] 并等待","blocks.brain.question":"你好","blocks.brain.answer":"回答"},"zh-Hant":{"blocks.brain.name":"智腦","blocks.brain.openplatform":"訊飛開放平台認證信息","blocks.brain.openplatform.APIPassword":"HTTP 服務鑒權 APIPassword","blocks.brain.openplatform.APPID":"WebSocket 服務鑒權 APPID","blocks.brain.openplatform.APISecret":"WebSocket 服務鑒權 APISecret","blocks.brain.openplatform.APIKey":"WebSocket 服務鑒權 APIKey","blocks.brain.openplatform.description1":"請註冊您自己的","blocks.brain.openplatform.description2":"訊飛開放平台","blocks.brain.openplatform.description3":"賬號，我們提供的測試賬號不保證每次請求都成功。","blocks.brain.addPrompt":"將指令說明 [PROMPT] 加入智腦","blocks.brain.prompt":"用一隻貓的性格對話","blocks.brain.clearHistory":"刪除指令和結果","blocks.brain.askQuestion":"詢問智腦 [QUESTION] 並等待","blocks.brain.question":"你好","blocks.brain.answer":"回答"}};var k="./assets/icon-xdp12efg.svg";import{jsx as D}from"preact/jsx-runtime";W(C);var _e={icon:k,name:D(H,{id:"blocks.brain.name",defaultMessage:"Brain"}),files:[{name:"brain",type:"text/x-python",uri:_},{name:"_aiohttp/__init__",type:"text/x-python",uri:h},{name:"_aiohttp/aiohttp_ws",type:"text/x-python",uri:m},{name:"_sparkai",type:"text/x-python",uri:b}],emulator:p,blocks:u};export{_e as default};
