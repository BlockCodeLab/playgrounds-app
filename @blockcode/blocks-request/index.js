import{addLocalesMessages as q,Text as N}from"@blockcode/core";import{MathUtils as _}from"@blockcode/utils";var f=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"];function E(e){return{get key(){return"request"},getOptions(t){let s=e.getData(t,"request.options");if(!s)s={headers:Object.create(null),params:Object.create(null),body:Object.create(null)};return s},async fetch(t,s,o){let{headers:n,params:r,body:d}=this.getOptions(t),a={method:f.includes(s)?s:"GET",headers:n};if(r)o+=`?${Object.entries(r).map(([l,p])=>`${encodeURIComponent(l)}=${encodeURIComponent(p)}`).join("&")}`;if(a.method!=="GET"&&a.method!=="HEAD"&&d)a.body=JSON.stringify(d);await fetch(`${o}`,a).then((l)=>{e.setData(t,"request.response",l),e.run("request.success")}).catch((l)=>{e.run("request.fails")}).finally(()=>{e.setData(t,"request.options",null)})},async getData(t){let s=e.getData(t,"request.response");if(s instanceof Response){s={text:await s.text(),json:{},status:s.status};try{s.json=JSON.parse(s.text)}catch(o){}e.setData(t,"request.response",s)}return s},async getText(t){return(await this.getData(t))?.text??""},async getJson(t,s){let o=await this.getData(t);if(!o?.json)return"";let n=o.json;s=`${s}`.split(".");for(let r of s)if(n=Array.isArray(n)?n.at(_.serialToIndex(r,n.length)):n[r],n!==0&&!n)return"";return n},getStatusCode(t){return e.getData(t,"request.response")?.status??0},setHeaders(t,s,o){let n=this.getOptions(t);n.headers[s]=o,e.setData(t,"request.options",n)},setParams(t,s,o){let n=this.getOptions(t);n.params[s]=o,e.setData(t,"request.options",n)},setBody(t,s,o){let n=this.getOptions(t);n.body[s]=o,e.setData(t,"request.options",n)},clear(t){e.setData(t,"request.options",null),e.setData(t,"request.response",null)}}}import{Text as i}from"@blockcode/core";import{jsx as u}from"preact/jsx-runtime";var c=[{id:"request",text:u(i,{id:"blocks.request.request",defaultMessage:"request content [MOTHOD] to [URL]"}),inputs:{MOTHOD:{type:"string",defaultValue:"GET",menu:[["GET","GET"],["POST","POST"],["PUT","PUT"],["PATCH","PATCH"],["DELETE","DELETE"],["HEAD","HEAD"],["OPTIONS","OPTIONS"]]},URL:{type:"string",defaultValue:"https://make.blockcode.fun/hello.txt"}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.quote_(e.getFieldValue("MOTHOD"))||'"GET"',o=this.valueToCode(e,"URL",this.ORDER_NONE)||'""';return t+=`await request.afetch(str(${s}), str(${o}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.quote_(e.getFieldValue("MOTHOD"))||'"GET"',o=this.valueToCode(e,"URL",this.ORDER_NONE)||'""';return t+=`await runtime.extensions.request.fetch(target, ${s}, ${o});
`,t}},{id:"clear_cache",text:u(i,{id:"blocks.request.clearCache",defaultMessage:"clear request cache"}),mpy(){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,block);return e+=`request.clear_cache()
`,e},emu(){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,block);return e+=`runtime.extensions.request.clear(target);
`,e}},{id:"get_content",text:u(i,{id:"blocks.request.getContent",defaultMessage:"item [PATH] of content"}),inputs:{PATH:{type:"string",defaultValue:"path.2.item"}},output:"string",mpy(e){return[`request.get_content(${this.valueToCode(e,"PATH",this.ORDER_NONE)||'""'})`,this.ORDER_FUNCTION_CALL]},emu(e){return[`(await runtime.extensions.request.getJson(target, ${this.valueToCode(e,"PATH",this.ORDER_NONE)||'""'}))`,this.ORDER_FUNCTION_CALL]}},{id:"get_text",text:u(i,{id:"blocks.request.getText",defaultMessage:"text content"}),output:"string",mpy(){return["request.get_content()",this.ORDER_FUNCTION_CALL]},emu(){return["(await runtime.extensions.request.getText(target))",this.ORDER_FUNCTION_CALL]}},"---",{id:"when_responds",text:u(i,{id:"blocks.request.whenResponds",defaultMessage:"when a site responds"}),hat:!0,mpy(){return`@when(request.REQUEST_SUCCESS, target)
${this.eventToCode("request_success","False","target")}`},emu(){return`runtime.when('request.success', ${this.HAT_CALLBACK});
`}},{id:"when_fails",text:u(i,{id:"blocks.request.whenFails",defaultMessage:"when a request fails"}),hat:!0,mpy(){return`@when(request.REQUEST_FAILS)
${this.eventToCode("request_fails","False")}`},emu(){return`runtime.when('request.fails', ${this.HAT_CALLBACK});
`}},{id:"is_responds",text:u(i,{id:"blocks.request.isResponds",defaultMessage:"site responds?"}),output:"boolean",mpy(){return["bool(request.response)",this.ORDER_FUNCTION_CALL]},emu(){return["Boolean(runtime.extensions.request.getStatusCode(target))",this.ORDER_FUNCTION_CALL]}},{id:"status_code",text:u(i,{id:"blocks.request.statusCode",defaultMessage:"status code"}),output:"number",mpy(){return["(request.response.status if request.response else 0)",this.ORDER_FUNCTION_CALL]},emu(){return["runtime.extensions.request.getStatusCode(target)",this.ORDER_FUNCTION_CALL]}},"---",{id:"set_content_type",text:u(i,{id:"blocks.request.setContentType",defaultMessage:"set content type to [CONTENTTYPE]"}),inputs:{CONTENTTYPE:{type:"string",defaultValue:"text/plain",menu:[["application/json","application/json"],["text/plain","text/plain"]]}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.quote_(e.getFieldValue("CONTENTTYPE")||"text/plain");return t+=`request.set_header('Content-Type', str(${s}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.quote_(e.getFieldValue("CONTENTTYPE"))||'"text/plain"';return t+=`runtime.extensions.request.setHeaders(target, 'Content-Type', ${s});
`,t}},{id:"set_header",text:u(i,{id:"blocks.request.setHeader",defaultMessage:"set headers [HEADER] to [VALUE]"}),inputs:{HEADER:{type:"string",defaultValue:"Content-Type"},VALUE:{type:"string",defaultValue:"text/plain"}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.valueToCode(e,"HEADER",this.ORDER_NONE)||'""',o=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`request.set_header(str(${s}), str(${o}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.valueToCode(e,"HEADER",this.ORDER_NONE)||'""',o=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`runtime.extensions.request.setHeaders(target, ${key}, ${o});
`,t}},{id:"set_param",text:u(i,{id:"blocks.request.setParam",defaultMessage:"set param [KEY] to [VALUE]"}),inputs:{KEY:{type:"string",defaultValue:u(i,{id:"blocks.request.key",defaultMessage:"key"})},VALUE:{type:"string",defaultValue:u(i,{id:"blocks.request.value",defaultMessage:"value"})}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',o=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`request.set_param(str(${s}), str(${o}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',o=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`runtime.extensions.request.setParams(target, ${s}, ${o});
`,t}},{id:"set_body",text:u(i,{id:"blocks.request.setBody",defaultMessage:"set body [KEY] to [VALUE]"}),inputs:{KEY:{type:"string",defaultValue:u(i,{id:"blocks.request.key",defaultMessage:"key"})},VALUE:{type:"string",defaultValue:u(i,{id:"blocks.request.value",defaultMessage:"value"})}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',o=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`request.set_body(str(${s}), str(${o}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let s=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',o=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`runtime.extensions.request.setBody(target, ${s}, ${o});
`,t}}];var T={en:{"blocks.request.name":"HTTP Request","blocks.request.request":"send [MOTHOD] request to [URL]","blocks.request.getText":"text content","blocks.request.getContent":"item [PATH] of responds","blocks.request.clearCache":"clear request cache","blocks.request.whenResponds":"when a site responds","blocks.request.whenFails":"when a request fails","blocks.request.statusCode":"status code","blocks.request.isResponds":"site responds?","blocks.request.setHeader":"set headers [HEADER] to [VALUE]","blocks.request.setContentType":"set content type to [CONTENTTYPE]","blocks.request.setParam":"set param [KEY] to [VALUE]","blocks.request.setBody":"set body [KEY] to [VALUE]","blocks.request.key":"key","blocks.request.value":"value"},"zh-Hans":{"blocks.request.name":"HTTP 请求","blocks.request.request":"用 [MOTHOD] 方法从 [URL] 请求数据","blocks.request.getText":"文本数据内容","blocks.request.getContent":"数据路径 [PATH] 的内容","blocks.request.clearCache":"清除请求应答缓存","blocks.request.whenResponds":"当网站有应答","blocks.request.whenFails":"当请求失败","blocks.request.statusCode":"应答状态码","blocks.request.isResponds":"网站有应答？","blocks.request.setHeader":"将标头 [HEADER] 设为 [VALUE]","blocks.request.setContentType":"将内容类型设为 [CONTENTTYPE]","blocks.request.setParam":"将请求参数 [KEY] 设为 [VALUE]","blocks.request.setBody":"将提交数据 [KEY] 设为 [VALUE]","blocks.request.key":"键","blocks.request.value":"值"},"zh-Hant":{"blocks.request.name":"HTTP 請求","blocks.request.request":"用 [MOTHOD] 方法從 [URL] 請求數據","blocks.request.getText":"文本數據內容","blocks.request.getContent":"數據路徑 [PATH] 的內容","blocks.request.clearCache":"清除請求應答緩存","blocks.request.whenResponds":"當網站有應答","blocks.request.whenFails":"當請求失敗","blocks.request.statusCode":"應答狀態碼","blocks.request.isResponds":"網站有應答？","blocks.request.setHeader":"將標頭 [HEADER] 信息設為 [VALUE]","blocks.request.setContentType":"將內容類型設為 [CONTENTTYPE]","blocks.request.setParam":"將請求參數項 [KEY] 設為 [VALUE]","blocks.request.setBody":"將請求數據項 [KEY] 設為 [VALUE]","blocks.request.key":"鍵","blocks.request.value":"值"}};var h="./assets/icon-hvra75p0.svg";var C="./assets/request-q7xk578b.py";import{jsx as A}from"preact/jsx-runtime";q(T);var D={icon:h,name:A(N,{id:"blocks.request.name",defaultMessage:"Request"}),files:[{name:"request",type:"text/x-python",uri:C}],emulator:E,blocks:c};export{D as default};
