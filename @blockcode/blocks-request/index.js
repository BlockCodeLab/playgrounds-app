import{addLocalesMessages as R,Text as q}from"@blockcode/core";import{MathUtils as p}from"@blockcode/utils";var _=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS"];function d(e){return{get key(){return"request"},getOptions(){let t=e.getData("request.options");if(!t)t={headers:Object.create(null),params:Object.create(null),body:Object.create(null)};return t},async fetch(t,o){let{headers:s,params:i,body:l}=this.getOptions(),a={method:_.includes(t)?t:"GET",headers:s};if(i)o+=`?${Object.entries(i).map(([u,C])=>`${encodeURIComponent(u)}=${encodeURIComponent(C)}`).join("&")}`;if(a.method!=="GET"&&a.method!=="HEAD"&&l)a.body=JSON.stringify(l);await fetch(`${o}`,a).then((u)=>{e.setData("request.response",u),e.run("request.success")}).catch((u)=>{e.run("request.fails")}).finally(()=>{e.setData("request.options",null)})},async getData(){let t=e.getData("request.response");if(t instanceof Response){t={text:await t.text(),json:{},status:t.status};try{t.json=JSON.parse(t.text)}catch(o){}e.setData("request.response",t)}return t},async getText(){return(await this.getData())?.text??""},async getJson(t){let o=await this.getData();if(!o?.json)return"";let s=o.json;t=`${t}`.split(".");for(let i of t)if(s=Array.isArray(s)?s.at(p.serialToIndex(i,s.length)):s[i],s!==0&&!s)return"";return s},get statusCode(){return e.getData("request.response")?.status??0},setHeaders(t,o){let s=this.getOptions();s.headers[t]=o,e.setData("request.options",s)},setParams(t,o){let s=this.getOptions();s.params[t]=o,e.setData("request.options",s)},setBody(t,o){let s=this.getOptions();s.body[t]=o,e.setData("request.options",s)},clear(){e.setData("request.options",null),e.setData("request.response",null)}}}import{Text as n}from"@blockcode/core";import{jsx as r}from"preact/jsx-runtime";var E=[{id:"request",text:r(n,{id:"blocks.request.request",defaultMessage:"request content [MOTHOD] to [URL]"}),inputs:{MOTHOD:{type:"string",defaultValue:"GET",menu:[["GET","GET"],["POST","POST"],["PUT","PUT"],["PATCH","PATCH"],["DELETE","DELETE"],["HEAD","HEAD"],["OPTIONS","OPTIONS"]]},URL:{type:"string",defaultValue:"https://make.blockcode.fun/hello.txt"}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.quote_(e.getFieldValue("MOTHOD"))||'"GET"',s=this.valueToCode(e,"URL",this.ORDER_NONE)||'""';return t+=`await request.afetch(str(${o}), str(${s}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.quote_(e.getFieldValue("MOTHOD"))||'"GET"',s=this.valueToCode(e,"URL",this.ORDER_NONE)||'""';return t+=`await runtime.extensions.request.fetch(${o}, ${s});
`,t}},{id:"clear_cache",text:r(n,{id:"blocks.request.clearCache",defaultMessage:"clear request cache"}),mpy(){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,block);return e+=`request.clear_cache()
`,e},emu(){let e="";if(this.STATEMENT_PREFIX)e+=this.injectId(this.STATEMENT_PREFIX,block);return e+=`runtime.extensions.request.clear();
`,e}},{id:"get_content",text:r(n,{id:"blocks.request.getContent",defaultMessage:"item [PATH] of content"}),inputs:{PATH:{type:"string",defaultValue:"path.2.item"}},output:"string",mpy(e){return[`request.get_content(${this.valueToCode(e,"PATH",this.ORDER_NONE)||'""'})`,this.ORDER_FUNCTION_CALL]},emu(e){return[`(await runtime.extensions.request.getJson(${this.valueToCode(e,"PATH",this.ORDER_NONE)||'""'}))`,this.ORDER_FUNCTION_CALL]}},{id:"get_text",text:r(n,{id:"blocks.request.getText",defaultMessage:"text content"}),output:"string",mpy(){return["request.get_content()",this.ORDER_FUNCTION_CALL]},emu(){return["(await runtime.extensions.request.getText())",this.ORDER_FUNCTION_CALL]}},"---",{id:"when_responds",text:r(n,{id:"blocks.request.whenResponds",defaultMessage:"when a site responds"}),hat:!0,mpy(){return`@when(request.REQUEST_SUCCESS, target)
${this.eventToCode("request_success","False","target")}`},emu(){return`runtime.when('request.success', ${this.HAT_CALLBACK});
`}},{id:"when_fails",text:r(n,{id:"blocks.request.whenFails",defaultMessage:"when a request fails"}),hat:!0,mpy(){return`@when(request.REQUEST_FAILS)
${this.eventToCode("request_fails","False")}`},emu(){return`runtime.when('request.fails', ${this.HAT_CALLBACK});
`}},{id:"is_responds",text:r(n,{id:"blocks.request.isResponds",defaultMessage:"site responds?"}),output:"boolean",mpy(){return["bool(request.response)",this.ORDER_FUNCTION_CALL]},emu(){return["Boolean(runtime.extensions.request.statusCode)",this.ORDER_FUNCTION_CALL]}},{id:"status_code",text:r(n,{id:"blocks.request.statusCode",defaultMessage:"status code"}),output:"number",mpy(){return["(request.response.status if request.response else 0)",this.ORDER_FUNCTION_CALL]},emu(){return["runtime.extensions.request.statusCode",this.ORDER_FUNCTION_CALL]}},"---",{id:"set_content_type",text:r(n,{id:"blocks.request.setContentType",defaultMessage:"set content type to [CONTENTTYPE]"}),inputs:{CONTENTTYPE:{type:"string",defaultValue:"text/plain",menu:[["application/json","application/json"],["text/plain","text/plain"]]}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.quote_(e.getFieldValue("CONTENTTYPE")||"text/plain");return t+=`request.set_header('Content-Type', str(${o}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.quote_(e.getFieldValue("CONTENTTYPE"))||'"text/plain"';return t+=`runtime.extensions.request.setHeaders('Content-Type', ${o});
`,t}},{id:"set_header",text:r(n,{id:"blocks.request.setHeader",defaultMessage:"set headers [HEADER] to [VALUE]"}),inputs:{HEADER:{type:"string",defaultValue:"Content-Type"},VALUE:{type:"string",defaultValue:"text/plain"}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.valueToCode(e,"HEADER",this.ORDER_NONE)||'""',s=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`request.set_header(str(${o}), str(${s}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.valueToCode(e,"HEADER",this.ORDER_NONE)||'""',s=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`runtime.extensions.request.setHeaders(${key}, ${s});
`,t}},{id:"set_param",text:r(n,{id:"blocks.request.setParam",defaultMessage:"set param [KEY] to [VALUE]"}),inputs:{KEY:{type:"string",defaultValue:r(n,{id:"blocks.request.key",defaultMessage:"key"})},VALUE:{type:"string",defaultValue:r(n,{id:"blocks.request.value",defaultMessage:"value"})}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',s=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`request.set_param(str(${o}), str(${s}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',s=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`runtime.extensions.request.setParams(${o}, ${s});
`,t}},{id:"set_body",text:r(n,{id:"blocks.request.setBody",defaultMessage:"set body [KEY] to [VALUE]"}),inputs:{KEY:{type:"string",defaultValue:r(n,{id:"blocks.request.key",defaultMessage:"key"})},VALUE:{type:"string",defaultValue:r(n,{id:"blocks.request.value",defaultMessage:"value"})}},mpy(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',s=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`request.set_body(str(${o}), str(${s}))
`,t},emu(e){let t="";if(this.STATEMENT_PREFIX)t+=this.injectId(this.STATEMENT_PREFIX,e);let o=this.valueToCode(e,"KEY",this.ORDER_NONE)||'""',s=this.valueToCode(e,"VALUE",this.ORDER_NONE)||'""';return t+=`runtime.extensions.request.setBody(${o}, ${s});
`,t}}];var c={en:{"blocks.request.name":"HTTP Request","blocks.request.request":"send [MOTHOD] request to [URL]","blocks.request.getText":"text content","blocks.request.getContent":"item [PATH] of responds","blocks.request.clearCache":"clear request cache","blocks.request.whenResponds":"when a site responds","blocks.request.whenFails":"when a request fails","blocks.request.statusCode":"status code","blocks.request.isResponds":"site responds?","blocks.request.setHeader":"set headers [HEADER] to [VALUE]","blocks.request.setContentType":"set content type to [CONTENTTYPE]","blocks.request.setParam":"set param [KEY] to [VALUE]","blocks.request.setBody":"set body [KEY] to [VALUE]","blocks.request.key":"key","blocks.request.value":"value"},"zh-Hans":{"blocks.request.name":"HTTP 请求","blocks.request.request":"用 [MOTHOD] 方法从 [URL] 请求数据","blocks.request.getText":"文本数据内容","blocks.request.getContent":"数据路径 [PATH] 的内容","blocks.request.clearCache":"清除请求应答缓存","blocks.request.whenResponds":"当网站有应答","blocks.request.whenFails":"当请求失败","blocks.request.statusCode":"应答状态码","blocks.request.isResponds":"网站有应答？","blocks.request.setHeader":"将标头 [HEADER] 设为 [VALUE]","blocks.request.setContentType":"将内容类型设为 [CONTENTTYPE]","blocks.request.setParam":"将请求参数 [KEY] 设为 [VALUE]","blocks.request.setBody":"将提交数据 [KEY] 设为 [VALUE]","blocks.request.key":"键","blocks.request.value":"值"},"zh-Hant":{"blocks.request.name":"HTTP 請求","blocks.request.request":"用 [MOTHOD] 方法從 [URL] 請求數據","blocks.request.getText":"文本數據內容","blocks.request.getContent":"數據路徑 [PATH] 的內容","blocks.request.clearCache":"清除請求應答緩存","blocks.request.whenResponds":"當網站有應答","blocks.request.whenFails":"當請求失敗","blocks.request.statusCode":"應答狀態碼","blocks.request.isResponds":"網站有應答？","blocks.request.setHeader":"將標頭 [HEADER] 信息設為 [VALUE]","blocks.request.setContentType":"將內容類型設為 [CONTENTTYPE]","blocks.request.setParam":"將請求參數項 [KEY] 設為 [VALUE]","blocks.request.setBody":"將請求數據項 [KEY] 設為 [VALUE]","blocks.request.key":"鍵","blocks.request.value":"值"}};var T="./assets/icon-hvra75p0.svg";var h="./assets/request-q7xk578b.py";import{jsx as N}from"preact/jsx-runtime";R(c);var F={icon:T,name:N(q,{id:"blocks.request.name",defaultMessage:"Request"}),files:[{name:"request",type:"text/x-python",uri:h}],emulator:d,blocks:E};export{F as default};
