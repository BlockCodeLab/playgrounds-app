import{addLocalesMessages as ht}from"@blockcode/core";var Te={"arduino.menubar.device":"Arduino","arduino.menubar.device.uno":"Arduino Uno","arduino.menubar.device.unoR4":"Arduino Uno R4","arduino.menubar.device.nano":"Arduino Nano","arduino.menubar.device.nulllab":"NULLLAB","arduino.menubar.device.bleuno":"BLE-UNO","arduino.menubar.device.blenano":"BLE-NANO","arduino.menubar.device.changeBaudrate":"Change baudrate","arduino.menubar.device.baudrate":"Baudrate {baudrate}","arduino.logs.changeBaudrate":"Baudrate changed to {baudrate}","arduino.menubar.edit.classicEventsOpen":"Turn on Classic Event Blocks","arduino.menubar.edit.classicEventsClose":"Turn off Classic Event Blocks","arduino.tabs.serialPort":"Serial","arduino.extension.tags.controllers":"Controllers","arduino.extension.tags.sensors":"Sensors","arduino.extension.tags.actuators":"Actuators","arduino.extension.tags.displays":"Displays","arduino.extension.tags.modules":"Modules","arduino.extension.tags.communication":"Communication","arduino.extension.tags.kits":"Kits","arduino.blocks.classicEventsLabel":"Classic events turned on from Edit.","arduino.blocks.displayMatrix":"display %1","arduino.blocks.clearDisplay":"clear display","arduino.blocks.wait":"wait %1 milliseconds","arduino.blocks.break":"break","arduino.blocks.continue":"continue","arduino.blocks.elseif":"else if %1 then","arduino.blocks.else":"else","arduino.blocks.runtime":"run time %1","arduino.blocks.runtimeMilliseconds":"milliseconds","arduino.blocks.runtimeSeconds":"seconds","arduino.blocks.dataConvert":"convert %1 to %2","arduino.blocks.dataLengthOf":"length of %1","arduino.blocks.dataConstrain":"constrain %1 between %2 to %3","arduino.blocks.dataMap":"map %1 from %2 - %3 to %4 - %5","arduino.blocks.whensetup":"when Arduino setup","arduino.blocks.whenloop":"when Arduino loop","arduino.blocks.timerset":"trigger timer per %1 milliseconds","arduino.blocks.timeroff":"stop timer","arduino.blocks.operatorLarger":"larger of %1 and %2","arduino.blocks.operatorSmaller":"smaller of %1 and %2","arduino.blocks.pin":"Pins","arduino.blocks.setmode":"set pin %1 mode to %2","arduino.blocks.inputMode":"input","arduino.blocks.ouputMode":"output","arduino.blocks.inputPullUpMode":"input pull-up","arduino.blocks.setdigital":"set pin %1 to %2","arduino.blocks.digitalHigh":"high","arduino.blocks.digitalLow":"low","arduino.blocks.setanalog":"set pin %1 pwm to %2","arduino.blocks.isDigitalHigh":"pin %1 is high?","arduino.blocks.analogValue":"pin %1 analog value","arduino.blocks.attachinterrupt":"attach pin %1 interrupt to %2","arduino.blocks.interruptRising":"rising","arduino.blocks.interruptFalling":"falling","arduino.blocks.interruptChange":"change","arduino.blocks.interruptHigh":"high","arduino.blocks.interruptLow":"low","arduino.blocks.detachinterrupt":"detach pin %1 interrupt","arduino.blocks.protocols":"Protocols","arduino.blocks.serial":"Serial","arduino.blocks.serialBaudrate":"set baudrate to %1","arduino.blocks.serialTimeout":"set timeout to %1 milliseconds","arduino.blocks.serialPrint":"print %1 with %2","arduino.blocks.serialPrintWarp":"warp","arduino.blocks.serialPrintNoWarp":"no-warp","arduino.blocks.serialPrintHEX":"hex","arduino.blocks.serialPrintOCT":"oct","arduino.blocks.serialPrintBIN":"bin","arduino.blocks.serialPrintNumber":"print %1","arduino.blocks.serialAvailable":"available data?","arduino.blocks.serialAvailableLength":"available data length","arduino.blocks.serialReadString":"read a String","arduino.blocks.serialReadStringUntil":"read a String until %1","arduino.blocks.serialReadParse":"read a %1 number","arduino.blocks.serialReadParseInteger":"int","arduino.blocks.serialReadParseFloat":"float","arduino.blocks.serialRead":"read a byte","arduino.blocks.serialReadBytes":"read %1 bytes","arduino.blocks.text":"Text","arduino.blocks.textEquals":"%1 equals %2 (not case-sensitive)?","arduino.blocks.textRemove":"remove letters from %1 to %2 of %3","arduino.blocks.textReplace":"replace %1 of %2 with %3","arduino.blocks.textReplaceLetter":"replace letter %1 of %2 with %3","arduino.blocks.textSubstring":"substring of %1 from %2 to %3","arduino.blocks.textWith":"%1 %2 with %3?","arduino.blocks.textStartsWith":"starts","arduino.blocks.textEndsWith":"ends","arduino.blocks.textCase":"get %1 of %2","arduino.blocks.textLowerCase":"lower-case","arduino.blocks.textUpperCase":"upper-case","arduino.blocks.textTrim":"remove %1 leading and trailing whitespace","arduino.blocks.textConvert":"convert %1 to %2","arduino.blocks.textConvertFrom":"convert %1 to String","arduino.blocks.textChar":"char %1"};var ve={"arduino.menubar.device":"Arduino","arduino.menubar.device.uno":"Arduino Uno","arduino.menubar.device.unoR4":"Arduino Uno R4","arduino.menubar.device.nano":"Arduino Nano","arduino.menubar.device.nulllab":"NULLLAB","arduino.menubar.device.bleuno":"BLE-UNO","arduino.menubar.device.blenano":"BLE-NANO","arduino.menubar.device.changeBaudrate":"更改波特率","arduino.menubar.device.baudrate":"波特率 {baudrate}","arduino.logs.changeBaudrate":"波特率已更改为 {baudrate}","arduino.menubar.edit.classicEventsOpen":"打开经典事件积木","arduino.menubar.edit.classicEventsClose":"关闭经典事件积木","arduino.tabs.serialPort":"串口","arduino.extension.tags.controllers":"输入模块","arduino.extension.tags.sensors":"传感器","arduino.extension.tags.actuators":"执行器","arduino.extension.tags.displays":"显示模块","arduino.extension.tags.modules":"智能模块","arduino.extension.tags.communication":"通讯","arduino.extension.tags.kits":"套件","arduino.blocks.classicEventsLabel":"经典事件积木请从“编辑”菜单开启。","arduino.blocks.displayMatrix":"显示 %1","arduino.blocks.clearDisplay":"清除显示","arduino.blocks.wait":"等待 %1 毫秒","arduino.blocks.break":"跳出重复执行","arduino.blocks.continue":"跳到下一次执行","arduino.blocks.elseif":"否则，如果 %1 那么","arduino.blocks.else":"否则","arduino.blocks.runtime":"运行时长 %1","arduino.blocks.runtimeMilliseconds":"毫秒","arduino.blocks.runtimeSeconds":"秒","arduino.blocks.dataConvert":"将 %1 类型转为 %2","arduino.blocks.dataLengthOf":"%1 长度","arduino.blocks.dataConstrain":"约束 %1 在 %2 和 %3 之间","arduino.blocks.dataMap":"映射 %1 从 %2 - %3 到 %4 - %5","arduino.blocks.whensetup":"当 Arduino 启动时","arduino.blocks.whenloop":"当 Arduino 重复执行时","arduino.blocks.timerset":"定时器每间隔 %1 毫秒执行","arduino.blocks.timeroff":"关闭定时器","arduino.blocks.operatorLarger":"%1 和 %2 之中最大","arduino.blocks.operatorSmaller":"%1 和 %2 之中最小","arduino.blocks.pin":"引脚","arduino.blocks.setmode":"将引脚 %1 设为 %2 模式","arduino.blocks.inputMode":"输入","arduino.blocks.ouputMode":"输出","arduino.blocks.inputPullUpMode":"上拉输入","arduino.blocks.setdigital":"将引脚 %1 设为 %2","arduino.blocks.digitalHigh":"高电平","arduino.blocks.digitalLow":"低电平","arduino.blocks.setanalog":"将引脚 %1 PWM 值设为 %2","arduino.blocks.isDigitalHigh":"引脚 %1 是高电平？","arduino.blocks.analogValue":"引脚 %1 模拟值","arduino.blocks.attachinterrupt":"将引脚 %1 中断模式设为 %2","arduino.blocks.interruptRising":"电平上升","arduino.blocks.interruptFalling":"电平下降","arduino.blocks.interruptChange":"电平改变","arduino.blocks.interruptHigh":"高电平","arduino.blocks.interruptLow":"低电平","arduino.blocks.detachinterrupt":"取消引脚 %1 中断","arduino.blocks.protocols":"协议","arduino.blocks.serial":"串口","arduino.blocks.serialBaudrate":"将波特率设为 %1","arduino.blocks.serialTimeout":"将超时设为 %1 毫秒","arduino.blocks.serialPrint":"用 %2 模式打印 %1","arduino.blocks.serialPrintWarp":"换行","arduino.blocks.serialPrintNoWarp":"不换行","arduino.blocks.serialPrintHEX":"16进制","arduino.blocks.serialPrintOCT":"8进制","arduino.blocks.serialPrintBIN":"2进制","arduino.blocks.serialPrintNumber":"打印 %1","arduino.blocks.serialAvailable":"存在可读取数据?","arduino.blocks.serialAvailableLength":"可读取数据长度","arduino.blocks.serialReadString":"读取 String","arduino.blocks.serialReadStringUntil":"读取 String 直到 %1","arduino.blocks.serialReadParse":"读取 %1","arduino.blocks.serialReadParseInteger":"int","arduino.blocks.serialReadParseFloat":"float","arduino.blocks.serialRead":"读取 1 byte","arduino.blocks.serialReadBytes":"读取 %1 bytes","arduino.blocks.text":"文本","arduino.blocks.textEquals":"%1 和 %2 相同（忽视大小写）？","arduino.blocks.textRemove":"删除 %3 从第 %1 个到第 %2 个字符","arduino.blocks.textReplace":"将 %2 中的 %1 替换为 %3","arduino.blocks.textReplaceLetter":"将 %2 中的第 %1 个字符替换为 %3","arduino.blocks.textSubstring":"截取 %1 从第 %2 个到第 %3 个字符","arduino.blocks.textWith":"%1 %2 %3?","arduino.blocks.textStartsWith":"开始于","arduino.blocks.textEndsWith":"结束于","arduino.blocks.textCase":"将 %2 字母转为 %1","arduino.blocks.textLowerCase":"小写","arduino.blocks.textUpperCase":"大写","arduino.blocks.textTrim":"清除 %1 前后空白字符","arduino.blocks.textConvert":"将 %1 转为 %2","arduino.blocks.textConvertFrom":"将 %1 转为 String","arduino.blocks.textChar":"char %1"};var Ce={"arduino.menubar.device":"Arduino","arduino.menubar.device.uno":"Arduino Uno","arduino.menubar.device.unoR4":"Arduino Uno R4","arduino.menubar.device.nano":"Arduino Nano","arduino.menubar.device.nulllab":"NULLLAB","arduino.menubar.device.bleuno":"BLE-UNO","arduino.menubar.device.blenano":"BLE-NANO","arduino.menubar.device.changeBaudrate":"改變波特率","arduino.menubar.device.baudrate":"波特率 {baudrate}","arduino.logs.changeBaudrate":"波特率已變为 {baudrate}","arduino.menubar.edit.classicEventsOpen":"開啟舊樣式事件積木","arduino.menubar.edit.classicEventsClose":"關閉舊樣式事件積木","arduino.tabs.serialPort":"串口","arduino.extension.tags.controllers":"輸入模組","arduino.extension.tags.sensors":"傳感器","arduino.extension.tags.actuators":"執行器","arduino.extension.tags.displays":"顯示模組","arduino.extension.tags.modules":"智能模組","arduino.extension.tags.communication":"通訊","arduino.extension.tags.kits":"套件","arduino.blocks.classicEventsLabel":"经典事件積木請從「編輯」菜單開啟。","arduino.blocks.displayMatrix":"顯示圖示 %1","arduino.blocks.clearDisplay":"清空畫面","arduino.blocks.wait":"等待 %1 毫秒","arduino.blocks.break":"跳出重複","arduino.blocks.continue":"跳到下一次","arduino.blocks.elseif":"否則，如果 %1 那麼","arduino.blocks.else":"否則","arduino.blocks.runtime":"運行時長 %1","arduino.blocks.runtimeMilliseconds":"毫秒","arduino.blocks.runtimeSeconds":"秒","arduino.blocks.dataConvert":"將 %1 類型轉為 %2","arduino.blocks.dataLengthOf":"%1 長度","arduino.blocks.dataConstrain":"約束 %1 在 %2 和 %3 之間","arduino.blocks.dataMap":"映射 %1 從 %2 - %3 到 %4 - %5","arduino.blocks.whensetup":"當 Arduino 開始","arduino.blocks.whenloop":"當 Arduino 重複運行時","arduino.blocks.timerset":"定時器每間隔 %2 毫秒執行","arduino.blocks.timeroff":"關閉定時器","arduino.blocks.operatorLarger":"%1 和 %2 之中最大","arduino.blocks.operatorSmaller":"%1 和 %2 之中最小","arduino.blocks.pin":"引腳","arduino.blocks.setmode":"將引腳 %1 設為 %2 模式","arduino.blocks.inputMode":"輸入","arduino.blocks.ouputMode":"輸出","arduino.blocks.inputPullUpMode":"上拉輸入","arduino.blocks.setdigital":"將引腳 %1 設為 %2","arduino.blocks.digitalHigh":"高電平","arduino.blocks.digitalLow":"低電平","arduino.blocks.setanalog":"將引腳 %1 PWM 值設為 %2","arduino.blocks.isDigitalHigh":"引腳 %1 是高電平？","arduino.blocks.analogValue":"引腳 %1 模擬值","arduino.blocks.attachinterrupt":"將引腳 %1 中斷模式設為 %2","arduino.blocks.interruptRising":"電平上升","arduino.blocks.interruptFalling":"電平下降","arduino.blocks.interruptChange":"電平改變","arduino.blocks.interruptHigh":"高電平","arduino.blocks.interruptLow":"低電平","arduino.blocks.detachinterrupt":"取消引腳 %1 中斷","arduino.blocks.protocols":"協議","arduino.blocks.serial":"串口","arduino.blocks.serialBaudrate":"將波特率設為 %1","arduino.blocks.serialTimeout":"將超時設為 %1 毫秒","arduino.blocks.serialPrint":"用 %2 模式打印 %1","arduino.blocks.serialPrintWarp":"換行","arduino.blocks.serialPrintNoWarp":"不換行","arduino.blocks.serialPrintHEX":"16進制","arduino.blocks.serialPrintOCT":"8進制","arduino.blocks.serialPrintBIN":"2進制","arduino.blocks.serialPrintNumber":"打印 %1","arduino.blocks.serialAvailable":"存在可讀取數據?","arduino.blocks.serialAvailableLength":"可讀取數據長度","arduino.blocks.serialReadString":"讀取 String","arduino.blocks.serialReadStringUntil":"讀取 String 直到 %1","arduino.blocks.serialReadParse":"讀取 %1","arduino.blocks.serialReadParseInteger":"int","arduino.blocks.serialReadParseFloat":"float","arduino.blocks.serialRead":"讀取 1 byte","arduino.blocks.serialReadBytes":"讀取 %1 bytes","arduino.blocks.text":"文本","arduino.blocks.textEquals":"%1 和 %2 相同（忽視大小寫）？","arduino.blocks.textRemove":"刪除 %3 從第 %1 個到第 %2 個字符","arduino.blocks.textReplace":"將 %2 中的 %1 替換為 %3","arduino.blocks.textReplaceLetter":"將 %2 中的第 %1 個字符替換為 %3","arduino.blocks.textSubstring":"截取 %1 從第 %2 個到第 %3 個字符","arduino.blocks.textWith":"%1 %2 %3?","arduino.blocks.textStartsWith":"開始於","arduino.blocks.textEndsWith":"結束於","arduino.blocks.textCase":"將 %2 字母轉為 %1","arduino.blocks.textLowerCase":"小寫","arduino.blocks.textUpperCase":"大寫","arduino.blocks.textTrim":"清除 %1 前後空白字符","arduino.blocks.textConvert":"將 %1 轉為 %2","arduino.blocks.textConvertFrom":"將 %1 轉為 String","arduino.blocks.textChar":"char %1"};ht({en:Te,"zh-Hans":ve,"zh-Hant":Ce});import{svgAsDataUri as _i}from"@blockcode/utils";import{Text as Ti}from"@blockcode/core";import{ScratchBlocks as Y,blocksTab as vi,CodeReview as Ci}from"@blockcode/blocks";import{codeTab as ki,terminalTab as dt}from"@blockcode/code";import{monaco as Rt}from"@blockcode/code";var $i=Rt.languages.CompletionItemKind,ke=()=>["void","unsignedchar","byte","char","int","word","long","float","string","array","double","volatile","const","min","max","abs","constrain","map","pow","sqrt","ceil","exp","fabs","floor","fma","fmax","fmin","fmod","ldexp","log","log10","round","signbit","sq","square","trunc","sin","cos","tan","atan2","cosh","degrees","hypot","radians","sinh","tanh","randomSeed","random","pinMode","digitalWrite","digitalRead","analogReference","analogRead","analogWrite","tone","noTone","shifOut","shiftln","pulseln","delay","millis","micros","lowByte","highBye","bitRead","bitWrite","bitSet","bitClear","bit","attachlnterrupt","detachlnterrupt","interrupts","nolnterrupts","Serial","available","begin","end","find","findUntil","flush","parseFloat","parselnt","read","readBytes","readBytesUntil","setTimeout","write","SerialEvent","Stream","Mouse","Keyboard","include"];import{useCallback as Fe,useEffect as xt}from"preact/hooks";import{useAppContext as yt,useProjectContext as $t,setMeta as Pt}from"@blockcode/core";import{BlocksEditor as Vt}from"@blockcode/blocks";import{translate as h,themeColors as oe}from"@blockcode/core";import{keyMirror as gt}from"@blockcode/utils";var s=gt({BLEUNO:null,BLENANO:null,ArduinoUno:null,ArduinoUnoR4:null,ArduinoNano:null});var mt=(e)=>[s.BLEUNO,s.BLENANO].includes(e),Ot=(e)=>[s.ArduinoNano,s.BLENANO].includes(e),re=(e)=>e===s.ArduinoUnoR4,bt=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","A0","A1","A2","A3","A4","A5"],Et=["0","1","2","3","4","5","6","7","8","9","10","11","12","13","A0","A1","A2","A3","A4","A5","A6","A7"],ft=["3","5","6","9","10","11"],Nt=["3","5","6","9","10","11","A0"],_t=["A0","A1","A2","A3","A4","A5"],Tt=["A0","A1","A2","A3","A4","A5","A6","A7"],ae=(e)=>{let t=bt,i=_t,n=ft;if(mt(e)||Ot(e))t=Et,i=Tt;if(re(e))n=Nt;return{all:t,adc:i,pwm:n,in:t,out:t}},Se=(e)=>{let t=ae(e);return{id:"pin",name:h("arduino.blocks.pin","Pins"),themeColor:oe.blocks.motion.primary,inputColor:oe.blocks.motion.secondary,otherColor:oe.blocks.motion.tertiary,order:0,blocks:[{id:"setmode",text:h("arduino.blocks.setmode","set pin %1 mode to %2"),inputs:{PIN:{menu:t.all},MODE:{menu:[[h("arduino.blocks.inputMode","input"),"INPUT"],[h("arduino.blocks.ouputMode","output"),"OUTPUT"],[h("arduino.blocks.inputPullUpMode","input pull-up"),"INPUT_PULLUP"]]}},ino(i){let n=i.getFieldValue("PIN")||0,o=i.getFieldValue("MODE")||"INPUT";return`pinMode(${n}, ${o});
`}},"---",{id:"setdigital",text:h("arduino.blocks.setdigital","set digital pin %1 to %2"),inputs:{PIN:{menu:t.out},VALUE:{inputMode:!0,type:"number",defaultValue:"1",menu:[[h("arduino.blocks.digitalHigh","high"),"1"],[h("arduino.blocks.digitalLow","low"),"0"]]}},ino(i){let n=i.getFieldValue("PIN")||0,o=this.valueToCode(i,"VALUE",this.ORDER_NONE);return`digitalWrite(${n}, ${o});
`}},{id:"setanalog",text:h("arduino.blocks.setanalog","set pwm pin %1 to %2"),inputs:{PIN:{menu:t.pwm},VALUE:{shadow:"slider255"}},ino(i){let n=i.getFieldValue("PIN")||0,o=this.valueToCode(i,"VALUE",this.ORDER_NONE);return`analogWrite(${n}, ${o});
`}},{id:"slider255",shadow:!0,output:"number",inputs:{VALUE:{type:"slider",min:0,max:255,step:1,defaultValue:128}},ino(i){return[i.getFieldValue("VALUE")||0,this.ORDER_ATOMIC]}},{id:"digital",text:h("arduino.blocks.isDigitalHigh","digital pin %1 is high?"),output:"boolean",inputs:{PIN:{menu:t.in}},ino(i){return[`digitalRead(${i.getFieldValue("PIN")||0}) == HIGH`,this.ORDER_ATOMIC]}},{id:"analog",text:h("arduino.blocks.analogValue","pin %1 analog value"),output:"number",inputs:{PIN:{menu:t.adc}},ino(i){return[`analogRead(${i.getFieldValue("PIN")||0})`,this.ORDER_ATOMIC]}},"---",{id:"attachinterrupt",text:h("arduino.blocks.attachinterrupt","attach pin %1 interrupt to %2"),substack:!0,inputs:{PIN:{menu:t.in},INTERRUPT:{menu:[[h("arduino.blocks.interruptRising","rising"),"RISING"],[h("arduino.blocks.interruptFalling","falling"),"FALLING"],[h("arduino.blocks.interruptChange","change"),"CHANGE"],[h("arduino.blocks.interruptLow","low"),"LOW"]]}},ino(i){let n=i.getFieldValue("PIN")||0,o=i.getFieldValue("INTERRUPT")||"RISING",r=`interrupt_${n}_${o}`,a=this.statementToCode(i,"SUBSTACK")||"";return this.definitions_[`declare_${r}`]=`void ${r}();`,this.definitions_[r]=`void ${r}() {
${a}}`,`attachInterrupt(digitalPinToInterrupt(${n}), ${r}, ${o});
`}},{id:"detachinterrupt",text:h("arduino.blocks.detachinterrupt","detach pin %1 interrupt"),inputs:{PIN:{menu:t.in}},ino(i){return`detachInterrupt(digitalPinToInterrupt(${i.getFieldValue("PIN")||0}));
`}},"---",{id:"setMatrix",hidden:!re(e),text:h("arduino.blocks.displayMatrix","display [MATRIX]"),inputs:{MATRIX:{shadow:"matrixR4"}},ino(i){this.definitions_.include_Arduino_LED_Matrix='#include "Arduino_LED_Matrix.h"',this.definitions_.variable_matrix="ArduinoLEDMatrix _matrix;",this.definitions_.variable_matrix_frame="uint32_t _MATRIX_FRAME_[] = {0x0,0x0,0x0};",this.definitions_.setup_matrix="_matrix.begin();";let n=this.valueToCode(i,"MATRIX",this.ORDER_NONE).split(","),o="";return o+=`_MATRIX_FRAME_[0] = 0x${n[0]};
`,o+=`_MATRIX_FRAME_[1] = 0x${n[1]};
`,o+=`_MATRIX_FRAME_[2] = 0x${n[2]};
`,o+=`_matrix.loadFrame(_MATRIX_FRAME_);
`,o}},{id:"clearMatrix",hidden:!re(e),text:h("arduino.blocks.clearDisplay","clear display"),ino(i){this.definitions_.include_Arduino_LED_Matrix='#include "Arduino_LED_Matrix.h"',this.definitions_.variable_matrix="ArduinoLEDMatrix _matrix;",this.definitions_.variable_matrix_frame="uint32_t _MATRIX_FRAME_[] = {0x0,0x0,0x0};",this.definitions_.setup_matrix="_matrix.begin();";let n="";return n+=`_MATRIX_FRAME_[0] = 0x0;
`,n+=`_MATRIX_FRAME_[1] = 0x0;
`,n+=`_MATRIX_FRAME_[2] = 0x0;
`,n+=`_matrix.loadFrame(_MATRIX_FRAME_);
`,n}},{id:"matrixR4",shadow:!0,output:"string",inputs:{MATRIX:{type:"matrix",width:12,height:8}},ino(i){let n=i.getFieldValue("MATRIX"),o=[];for(let r=0;r<3;r++){let a=n.slice(r*32,(r+1)*32),l=parseInt(a,2).toString(16);o.push(l)}return[o.join(","),this.ORDER_ATOMIC]}}]}};import{changeCase as vt}from"@blockcode/utils";import{translate as g,themeColors as se}from"@blockcode/core";import{ScratchBlocks as q}from"@blockcode/blocks";var D=(e,t,...i)=>`${e.replace(/;$/,"")} {
  str.${t}(${i.join(", ")});
  return str;
}`,Ae=()=>({id:"text",name:g("arduino.blocks.text","Text"),themeColor:se.blocks.text.primary,inputColor:se.blocks.text.secondary,otherColor:se.blocks.text.tertiary,order:7,blocks:[{id:"join",text:q.Msg.OPERATORS_JOIN,output:"string",inputs:{STRING1:{type:"string",defaultValue:"hello"},STRING2:{type:"string",defaultValue:"arduino"}},ino(e){let t=this.valueToCode(e,"STRING1",this.ORDER_NONE),i=this.valueToCode(e,"STRING2",this.ORDER_NONE);return[`(${t} + ${i})`,this.ORDER_ADDITION]}},{id:"letter_of",text:q.Msg.OPERATORS_LETTEROF,output:"string",inputs:{LETTER:{type:"integer",defaultValue:1},STRING:{type:"string",defaultValue:"arduino"}},ino(e){let t=this.getAdjusted(e,"LETTER");return[`${this.valueToCode(e,"STRING",this.ORDER_NONE)}.charAt(${t})`,this.ORDER_FUNCTION_CALL]}},{id:"length",text:q.Msg.OPERATORS_LENGTH,output:"number",inputs:{STRING:{type:"string",defaultValue:"arduino"}},ino(e){let t=this.valueToCode(e,"STRING",this.ORDER_NONE);return code+=`${t}.length()`,[code,this.ORDER_FUNCTION_CALL]}},{id:"contains",text:q.Msg.OPERATORS_CONTAINS,output:"boolean",inputs:{STRING1:{type:"string",defaultValue:"arduino"},STRING2:{type:"string",defaultValue:"ino"}},ino(e){let t=this.valueToCode(e,"STRING1",this.ORDER_NONE),i=this.valueToCode(e,"STRING2",this.ORDER_NONE);return code+=`(${t}.indexOf(${i}) != -1)`,[code,this.ORDER_EQUALITY]}},{id:"equals",text:g("arduino.blocks.textEquals","%1 equals %2 (not case-sensitive)?"),output:"boolean",inputs:{STRING1:{type:"string",defaultValue:"arduino"},STRING2:{type:"string",defaultValue:"Arduino"}},ino(e){let t=this.valueToCode(e,"STRING1",this.ORDER_NONE),i=this.valueToCode(e,"STRING2",this.ORDER_NONE);return code+=`${t}.equalsIgnoreCase(${i})
`,[code,this.ORDER_EQUALITY]}},"---",{id:"remove",text:g("arduino.blocks.textRemove","remove letters from %1 to %2 of %3"),output:"string",inputs:{FROM:{type:"integer",defaultValue:1},TO:{type:"integer",defaultValue:2},STRING:{type:"string",defaultValue:"arduino"}},ino(e){let t=this.getAdjusted(e,"FROM"),i=this.valueToCode(e,"TO",this.ORDER_NONE),n=this.valueToCode(e,"STRING",this.ORDER_NONE);return this.definitions_.declare_removeString="String removeString(String str, unsigned int index, unsigned int count);",this.definitions_.removeString=D(this.definitions_.declare_removeString,"remove","index","count"),[`removeString(${n}, ${t}, (${i} - ${t}))`,this.ORDER_FUNCTION_CALL]}},{id:"replace",text:g("arduino.blocks.textReplace","replace %1 of %2 with %3"),output:"string",inputs:{STRING1:{type:"string",defaultValue:"a"},STRING2:{type:"string",defaultValue:"arduino"},STRING3:{type:"string",defaultValue:"The A"}},ino(e){let t=this.valueToCode(e,"STRING1",this.ORDER_NONE),i=this.valueToCode(e,"STRING2",this.ORDER_NONE),n=this.valueToCode(e,"STRING3",this.ORDER_NONE);return this.definitions_.declare_replaceString="String replaceString(String str, String str1, String str2);",this.definitions_.replaceString=D(this.definitions_.declare_replaceString,"replace","str1","str2"),[`replaceString(${t}, ${i}, ${n})`,this.ORDER_FUNCTION_CALL]}},{id:"replace_letter",text:g("arduino.blocks.textReplaceLetter","replace letter %1 of %2 with %3"),output:"string",inputs:{INDEX:{type:"integer",defaultValue:1},STRING:{type:"string",defaultValue:"arduino"},LETTER:{type:"string",defaultValue:"A"}},ino(e){let t=this.getAdjusted(e,"INDEX",this.ORDER_NONE),i=this.valueToCode(e,"STRING",this.ORDER_NONE),n=this.valueToCode(e,"LETTER",this.ORDER_NONE);return this.definitions_.declare_replaceCharAt="String replaceCharAt(String str, unsigned int index, char letter);",this.definitions_.replaceCharAt=D(this.definitions_.declare_replaceCharAt,"setCharAt","index","letter"),[`replaceCharAt(${i}, ${t}, '${n.replace(/^['"]|['"]$/g,"")[0]}')`,this.ORDER_FUNCTION_CALL]}},{id:"substring",text:g("arduino.blocks.textSubstring","substring of %1 from %2 to %3"),output:"string",inputs:{STRING:{type:"string",defaultValue:"arduino"},FROM:{type:"integer",defaultValue:5},TO:{type:"integer",defaultValue:7}},ino(e){let t=this.getAdjusted(e,"FROM",this.ORDER_NONE),i=this.valueToCode(e,"TO",this.ORDER_NONE),n=this.valueToCode(e,"STRING",this.ORDER_NONE);return this.definitions_.declare_substringString="String substringString(String str, unsigned int from, unsigned int to);",this.definitions_.substringString=D(this.definitions_.declare_substringString,"substring","index","count"),[`substringString(${n}, ${t}, ${i})`,this.ORDER_FUNCTION_CALL]}},{id:"with",text:g("arduino.blocks.textWith","%1 %2 with %3 ?"),output:"boolean",inputs:{STRING1:{type:"string",defaultValue:"arduino"},WITH:{type:"string",menu:[[g("arduino.blocks.textStartsWith","starts"),"START"],[g("arduino.blocks.textEndsWith","ends"),"END"]]},STRING2:{type:"string",defaultValue:"a"}},ino(e){let t=this.valueToCode(e,"STRING1",this.ORDER_NONE),i=this.valueToCode(e,"STRING2",this.ORDER_NONE),n=e.getFieldValue("WITH")||"START";return[`${t}.${n.toLowerCase()}sWith(${i})`,this.ORDER_FUNCTION_CALL]}},"---",{id:"case",text:g("arduino.blocks.textCase","get %1 case of %2"),output:"string",inputs:{WITH:{menu:[[g("arduino.blocks.textLowerCase","lower"),"lower"],[g("arduino.blocks.textUpperCase","upper"),"upper"]]},STRING:{type:"string",defaultValue:"Arduino"}},ino(e){let t=e.getFieldValue("WITH")||"lower",i=this.valueToCode(e,"STRING",this.ORDER_NONE);return this.definitions_[`declare_${t}String`]=`String ${t}String(String str);`,this.definitions_[`${t}String`]=D(this.definitions_[`declare_${t}String`],`to${vt.pascalCase(t)}Case`),[`${t}String(${i})`,this.ORDER_FUNCTION_CALL]}},{id:"trim",text:g("arduino.blocks.textTrim","remove %1 leading and trailing whitespace"),output:"string",inputs:{STRING:{type:"string",defaultValue:"arduino"}},ino(e){let t=this.valueToCode(e,"STRING",this.ORDER_NONE);return this.definitions_.declare_trimString="String trimString(String str);",this.definitions_.trimString=D(this.definitions_.declare_trimString,"trim"),[`trimString(${t})`,this.ORDER_FUNCTION_CALL]}},"---",{id:"convert",text:g("arduino.blocks.textConvert","convert %1 to %2"),output:"string",inputs:{STRING:{type:"string",defaultValue:"a"},TYPE:{menu:["int","float","char array","byte array"]}},ino(e){let t=this.valueToCode(e,"STRING",this.ORDER_NONE),i=e.getFieldValue("TYPE")||"int",n=`String(${t})`;if(i==="int")n+=".toInt()";else if(i==="float")n+=".toFloat()";else if(i==="char array")n+=".toCharArray()";else if(i==="byte array")n+=".getBytes()";return[n,this.ORDER_FUNCTION_CALL]}},{id:"convert_from",text:g("arduino.blocks.textConvertFrom","convert %1 to String"),output:"string",inputs:{NUM:{type:"number",defaultValue:1}},ino(e){return[`String(${this.valueToCode(e,"NUM",this.ORDER_NONE)})`,this.ORDER_FUNCTION_CALL]}},"---",{id:"char",text:g("arduino.blocks.textChar","char %1"),output:"string",inputs:{CHAR:{type:"string",defaultValue:"\\0"}},ino(e){return[`'${this.valueToCode(e,"CHAR",this.ORDER_NONE).replace(/^['"]|['"]$/g,"")}'`,this.ORDER_ATOMIC]}}]});import{translate as R,themeColors as ue}from"@blockcode/core";var De=()=>({id:"serial",name:R("arduino.blocks.serial","Serial"),themeColor:ue.blocks.looks.primary,inputColor:ue.blocks.looks.secondary,otherColor:ue.blocks.looks.tertiary,order:1,blocks:[{id:"baudrate",text:R("arduino.blocks.serialBaudrate","set baudrate to %1"),inputs:{BAUDRATE:{menu:{items:["115200","57600","38400","19200","9600"]}}},ino(e){let t=e.getFieldValue("BAUDRATE");return this.definitions_.setup_serial_baudrate=`Serial.begin(${t});`,""}},{id:"timeout",text:R("arduino.blocks.serialTimeout","set timeout to %1 milliseconds"),inputs:{TIMEOUT:{type:"integer",defaultValue:1000}},ino(e){return`Serial.setTimeout(${this.valueToCode(e,"TIMEOUT",this.ORDER_NONE)});
`}},"---",{id:"print",text:R("arduino.blocks.serialPrint","print %1 with %2"),inputs:{STRING:{type:"string",defaultValue:"hello"},MODE:{menu:[[R("arduino.blocks.serialPrintWarp","warp"),"WARP"],[R("arduino.blocks.serialPrintNoWarp","no-warp"),"NOWARP"],[R("arduino.blocks.serialPrintHEX","hex"),"HEX"],[R("arduino.blocks.serialPrintOCT","oct"),"OCT"],[R("arduino.blocks.serialPrintBIN","bin"),"BIN"]]}},ino(e){let t=this.valueToCode(e,"STRING",this.ORDER_NONE),i=e.getFieldValue("MODE")||"WARP";if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";let n="Serial";if(i==="WARP")if(t.length===0)n+=`.println();
`;else n+=`.println(${t});
`;else if(i==="NOWARP")n+=`.print(${t});
`;else n+=`.print(${t}, ${i});
`;return n}},"---",{id:"available",text:R("arduino.blocks.serialAvailable","available data?"),output:"boolean",ino(e){if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";return["(Serial.available() > 0)",this.ORDER_RELATIONAL]}},{id:"available_length",text:R("arduino.blocks.serialAvailableLength","available data length"),output:"number",ino(e){if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";return["Serial.available()",this.ORDER_FUNCTION_CALL]}},"---",{id:"read_string",text:R("arduino.blocks.serialReadString","read a string"),output:"string",ino(e){if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";return["Serial.readString()",this.ORDER_FUNCTION_CALL]}},{id:"read_string_until",text:R("arduino.blocks.serialReadStringUntil","read a string until %1"),output:"string",inputs:{CHAR:{type:"string",defaultValue:"a"}},ino(e){let t=this.valueToCode(e,"CHAR",this.ORDER_NONE);if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";return[`Serial.readStringUntil(${t})`,this.ORDER_FUNCTION_CALL]}},{id:"read_parse",text:R("arduino.blocks.serialReadParse","read a %1 number"),output:"number",inputs:{TYPE:{menu:[[R("arduino.blocks.serialReadParseInteger","int"),"INT"],[R("arduino.blocks.serialReadParseFloat","float"),"FLOAT"]]}},ino(e){let t=e.getFieldValue("TYPE")||"INT";if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";let i="Serial";if(t==="INT")i+=`.parseInt()
`;else if(t==="FLOAT")i+=`.parseFloat()
`;return[i,this.ORDER_FUNCTION_CALL]}},"---",{id:"read",text:R("arduino.blocks.serialRead","read a byte"),output:!0,ino(e){if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";return["Serial.readBytes(1)",this.ORDER_FUNCTION_CALL]}},{id:"read_bytes",text:R("arduino.blocks.serialReadBytes","read %1 bytes"),output:!0,inputs:{LEN:{type:"integer",defaultValue:2}},ino(e){let t=this.valueToCode(e,"LEN",this.ORDER_NONE);if(!this.definitions_.setup_serial_baudrate)this.definitions_.setup_serial_baudrate="Serial.begin(115200);";return[`Serial.readBytes(${t})`,this.ORDER_FUNCTION_CALL]}}]});import{translate as I,themeColors as le}from"@blockcode/core";import{ScratchBlocks as Ie}from"@blockcode/blocks";var Le=(e)=>{return Ie.Blocks.event_whensetuploop={init(){this.jsonInit({message0:I("arduino.blocks.whensetup","when Arduino setup"),message1:"%1",message2:Ie.Msg.CONTROL_FOREVER,message3:"%1",message4:"%1",lastDummyAlign4:"RIGHT",args1:[{type:"input_statement",name:"SUBSTACK1"}],args3:[{type:"input_statement",name:"SUBSTACK2"}],args4:[{type:"field_image",src:"./assets/blocks-media/repeat.svg",width:24,height:24,alt:"*",flip_rtl:!0}],category:"event",extensions:["colours_event"]}),this.setPreviousStatement(!1),this.setNextStatement(!1)}},{id:"event",name:"%{BKY_CATEGORY_EVENTS}",themeColor:le.blocks.events.primary,inputColor:le.blocks.events.secondary,otherColor:le.blocks.events.tertiary,blocks:[{label:I("arduino.blocks.classicEventsLabel","Classic events turned on from Edit."),hidden:e},{id:"whensetuploop",custom:!0,hidden:!e,ino(t){let i=this.statementToCode(t,"SUBSTACK1")||"";this.setup_+=i;let n=this.statementToCode(t,"SUBSTACK2")||"";this.loop_+=n}},"---",{id:"whensetup",text:I("arduino.blocks.whensetup","when Arduino setup"),hat:!0,ino(t){let i=this.statementToCode(t)||"";this.setup_+=i}},{id:"whenloop",text:I("arduino.blocks.whenloop","when Arduino loop"),hat:!0,ino(t){let i=this.statementToCode(t)||"";this.loop_+=i}},"---",{id:"timerset",text:I("arduino.blocks.timerset","trigger timer per %1 milliseconds"),substack:!0,inputs:{TIME:{type:"integer",defaultValue:500}},ino(t){this.definitions_.include_mstimer2="#include <MsTimer2.h>";let i=this.valueToCode(t,"TIME",this.ORDER_NONE)||500,n=`msTimer_${i}`,o=this.statementToCode(t,"SUBSTACK")||"";this.definitions_[`declare_${n}`]=`void ${n}();`,this.definitions_[n]=`void ${n}() {
${o}}`;let r="";return r+=`MsTimer2::set(${i}, ${n});
`,r+=`MsTimer2::start();
`,r}},{id:"timeroff",text:I("arduino.blocks.timeroff","stop timer"),ino(t){return this.definitions_.include_mstimer2="#include <MsTimer2.h>",`MsTimer2::stop();
`}}]}};import{translate as V,themeColors as de}from"@blockcode/core";import{ScratchBlocks as U}from"@blockcode/blocks";var Me=()=>({id:"control",name:"%{BKY_CATEGORY_CONTROL}",themeColor:de.blocks.control.primary,inputColor:de.blocks.control.secondary,otherColor:de.blocks.control.tertiary,blocks:[{id:"wait",text:V("arduino.blocks.wait","wait %1 milliseconds"),inputs:{MS:{type:"integer",defaultValue:1000}},ino(e){return`delay(${this.valueToCode(e,"MS",this.ORDER_NONE)});
`}},"---",{id:"repeat",text:U.Msg.CONTROL_REPEAT,repeat:!0,inputs:{TIMES:{type:"integer",defaultValue:10}},ino(e){let t=this.valueToCode(e,"TIMES",this.ORDER_NONE),i=this.statementToCode(e,"SUBSTACK");i=this.addLoopTrap(i,e.id);let n="",o=this.createLoopName();return n+=`for (int ${o} = 0; ${o} < ${t}; ${o}++) {
`,n+=i,n+=`}
`,n}},{id:"forever",text:U.Msg.CONTROL_FOREVER,repeat:!0,end:!0,ino(e){let t=this.statementToCode(e,"SUBSTACK");t=this.addLoopTrap(t,e.id);let i="";return i+=`while (true) {
`,i+=t,i+=`}
`,i}},"---",{id:"if",text:U.Msg.CONTROL_IF,substack:!0,inputs:{CONDITION:{type:"boolean"}},ino(e){let t=this.valueToCode(e,"CONDITION",this.ORDER_NONE)||"false",i=this.statementToCode(e,"SUBSTACK"),n="";return n+=`if (${t}) {
`,n+=i,n+=`}
`,n}},{id:"elseif",text:V("arduino.blocks.elseif","else if %1 then"),substack:!0,inputs:{CONDITION:{type:"boolean"}},ino(e){let t=this.valueToCode(e,"CONDITION",this.ORDER_NONE)||"false",i=this.statementToCode(e,"SUBSTACK"),n="";return n+=`else if (${t}) {
`,n+=i,n+=`}
`,n}},{id:"else",text:V("arduino.blocks.else","else"),substack:!0,ino(e){let t=this.statementToCode(e,"SUBSTACK"),i="";return i+=`else {
`,i+=t,i+=`}
`,i}},"---",{id:"repeat_until",text:U.Msg.CONTROL_REPEATUNTIL,repeat:!0,inputs:{CONDITION:{type:"boolean"}},ino(e){let t=this.valueToCode(e,"CONDITION",this.ORDER_NONE)||"true",i=this.statementToCode(e,"SUBSTACK");i=this.addLoopTrap(i,e.id);let n="";return n+=`while (!(${t})) {
`,n+=i,n+=`}
`,n}},{id:"while",text:U.Msg.CONTROL_WHILE,repeat:!0,inputs:{CONDITION:{type:"boolean"}},ino(e){let t=this.valueToCode(e,"CONDITION",this.ORDER_NONE)||"true",i=this.statementToCode(e,"SUBSTACK");i=this.addLoopTrap(i,e.id);let n="";return n+=`while (${t}) {
`,n+=i,n+=`}
`,n}},{id:"continue",text:V("arduino.blocks.continue","continue"),end:!0,ino(e){let t="";return t+=`continue;
`,t}},{id:"break",text:V("arduino.blocks.break","break"),end:!0,ino(e){let t="";return t+=`break;
`,t}}]});import{translate as Ct,themeColors as ce}from"@blockcode/core";import{ScratchBlocks as nn}from"@blockcode/blocks";var xe=()=>({id:"protocol",name:Ct("arduino.blocks.protocols","Protocols"),themeColor:ce.blocks.sounds.primary,inputColor:ce.blocks.sounds.secondary,otherColor:ce.blocks.sounds.tertiary,order:2,blocks:[]});import{translate as L,themeColors as pe}from"@blockcode/core";import{ScratchBlocks as c}from"@blockcode/blocks";var ye=()=>({id:"operator",name:"%{BKY_CATEGORY_OPERATORS}",themeColor:pe.blocks.operators.primary,inputColor:pe.blocks.operators.secondary,otherColor:pe.blocks.operators.tertiary,blocks:[{id:"calculate",text:"%1 %2 %3",output:"number",inputs:{NUM1:{type:"number",defaultValue:0},SYMBOL:{menu:[["+","+"],["-","-"],["×","*"],["÷","/"]]},NUM2:{type:"number",defaultValue:0}},ino(e){let t=this.valueToCode(e,"NUM1",this.ORDER_NONE),i=this.valueToCode(e,"NUM2",this.ORDER_NONE),n=e.getFieldValue("SYMBOL")||"+",o={"+":this.ORDER_ADDITION,"-":this.ORDER_SUBTRACTION,"*":this.ORDER_MULTIPLICATION,"/":this.ORDER_DIVISION};return[`(${t} ${n} ${i})`,o[n]]}},"---",{id:"random",text:c.Msg.OPERATORS_RANDOM,output:"number",inputs:{FROM:{type:"integer",defaultValue:1},TO:{type:"integer",defaultValue:10}},ino(e){let t=this.valueToCode(e,"FROM",this.ORDER_NONE),i=this.valueToCode(e,"TO",this.ORDER_NONE);return[`random(${t}, ${i})`,this.ORDER_FUNCTION_CALL]}},"---",{id:"compare",text:"%1 %2 %3",output:"boolean",inputs:{NUM1:{type:"number",defaultValue:0},SYMBOL:{menu:[[">",">"],["<","<"],["=","=="],["≥",">="],["≤","<="],["≠","!="]]},NUM2:{type:"number",defaultValue:0}},ino(e){let t=this.valueToCode(e,"NUM1",this.ORDER_NONE),i=this.valueToCode(e,"NUM2",this.ORDER_NONE),n=e.getFieldValue("SYMBOL")||">",o={">":this.ORDER_RELATIONAL,"<":this.ORDER_RELATIONAL,"==":this.ORDER_EQUALITY,">=":this.ORDER_RELATIONAL,"<=":this.ORDER_RELATIONAL,"!=":this.ORDER_EQUALITY};return[`(${t} ${n} ${i})`,o[n]]}},"---",{id:"and",text:c.Msg.OPERATORS_AND,output:"boolean",inputs:{OPERAND1:{type:"boolean"},OPERAND2:{type:"boolean"}},ino(e){let t=this.valueToCode(e,"OPERAND1",this.ORDER_NONE),i=this.valueToCode(e,"OPERAND2",this.ORDER_NONE);return[`(${t} && ${i})`,this.ORDER_LOGICAL_AND]}},{id:"or",text:c.Msg.OPERATORS_OR,output:"boolean",inputs:{OPERAND1:{type:"boolean"},OPERAND2:{type:"boolean"}},ino(e){let t=this.valueToCode(e,"OPERAND1",this.ORDER_NONE),i=this.valueToCode(e,"OPERAND2",this.ORDER_NONE);return[`(${t} || ${i})`,this.ORDER_LOGICAL_OR]}},{id:"not",text:c.Msg.OPERATORS_NOT,output:"boolean",inputs:{OPERAND:{type:"boolean"}},ino(e){return[`(!${this.valueToCode(e,"OPERAND",this.ORDER_NONE)})`,this.ORDER_LOGICAL_NOT]}},"---",{id:"bitwise",text:"%1 %2 %3",output:"number",inputs:{NUM1:{type:"integer",defaultValue:0},SYMBOL:{menu:[["&","&"],["|","|"],["^","^"],["<<","<<"],[">>",">>"]]},NUM2:{type:"integer",defaultValue:0}},ino(e){let t=this.valueToCode(e,"NUM1",this.ORDER_NONE),i=this.valueToCode(e,"NUM2",this.ORDER_NONE),n=e.getFieldValue("SYMBOL")||"&",o={"&":this.ORDER_BITWISE_AND,"|":this.ORDER_BITWISE_OR,"^":this.ORDER_BITWISE_XOR,"<<":this.ORDER_BITWISE_SHIFT,">>":this.ORDER_BITWISE_SHIFT};return[`(${t} ${n} ${i})`,o[n]]}},{id:"bitwise_not",text:"~ %1",output:"number",inputs:{NUM:{type:"integer",defaultValue:0}},ino(e){return[`(~${this.valueToCode(e,"NUM",this.ORDER_NONE)})`,this.ORDER_BITWISE_NOT]}},"---",{id:"larger",text:L("arduino.blocks.operatorLarger","larger of %1 and %2"),output:"number",inputs:{NUM1:{type:"number",defaultValue:0},NUM2:{type:"number",defaultValue:0}},ino(e){let t=this.valueToCode(e,"NUM1",this.ORDER_NONE),i=this.valueToCode(e,"NUM2",this.ORDER_NONE);return[`max(${t}, ${i})`,this.ORDER_FUNCTION_CALL]}},{id:"smaller",text:L("arduino.blocks.operatorSmaller","smaller of %1 and %2"),output:"number",inputs:{NUM1:{type:"number",defaultValue:0},NUM2:{type:"number",defaultValue:0}},ino(e){let t=this.valueToCode(e,"NUM1",this.ORDER_NONE),i=this.valueToCode(e,"NUM2",this.ORDER_NONE);return[`min(${t}, ${i})`,this.ORDER_FUNCTION_CALL]}},{id:"mod",text:c.Msg.OPERATORS_MOD,output:"number",inputs:{NUM1:{type:"integer",defaultValue:0},NUM2:{type:"integer",defaultValue:0}},ino(e){let t=this.valueToCode(e,"NUM1",this.ORDER_NONE),i=this.valueToCode(e,"NUM2",this.ORDER_NONE);return[`(${t} % ${i})`,this.ORDER_MODULUS]}},{id:"round",text:c.Msg.OPERATORS_ROUND,output:"number",inputs:{NUM:{type:"number",defaultValue:0}},ino(e){return[`round(${this.valueToCode(e,"NUM",this.ORDER_NONE)})`,this.ORDER_FUNCTION_CALL]}},"---",{id:"mathop",text:c.Msg.MATHOP,output:"number",inputs:{OPERATOR:{menu:[[c.Msg.OPERATORS_MATHOP_ABS,"abs"],[c.Msg.OPERATORS_MATHOP_FLOOR,"floor"],[c.Msg.OPERATORS_MATHOP_CEILING,"ceiling"],[c.Msg.OPERATORS_MATHOP_SQRT,"sqrt"],[c.Msg.OPERATORS_MATHOP_SIN,"sin"],[c.Msg.OPERATORS_MATHOP_COS,"cos"],[c.Msg.OPERATORS_MATHOP_TAN,"tan"],[c.Msg.OPERATORS_MATHOP_ASIN,"asin"],[c.Msg.OPERATORS_MATHOP_ACOS,"acos"],[c.Msg.OPERATORS_MATHOP_ATAN,"atan"],[c.Msg.OPERATORS_MATHOP_LN,"log"],[c.Msg.OPERATORS_MATHOP_LOG,"log10"],[c.Msg.OPERATORS_MATHOP_EEXP,"exp"],[c.Msg.OPERATORS_MATHOP_10EXP,"pow10"]]},NUM:{type:"integer",defaultValue:0}},ino(e){let t=e.getFieldValue("OPERATOR")||"abs",i=this.valueToCode(e,"NUM",this.ORDER_NONE),n="";if(t==="pow10")n+=`pow(10, ${i})`;else n+=`${t}(${i})`;return[n,this.ORDER_FUNCTION_CALL]}},"---",{id:"convert",text:L("arduino.blocks.dataConvert","convert %1 to %2"),output:!0,inputs:{DATA:{type:"string",defaultValue:"3.1415"},TYPE:{menu:["int","float","String"]}},ino(e){let t=this.valueToCode(e,"DATA",this.ORDER_NONE),i=e.getFieldValue("TYPE")||"int",n=`String(${t})`;switch(i){case"int":n+=".toInt()";break;case"float":n+=".toFloat()";break;case"String":break}return[n,this.ORDER_FUNCTION_CALL]}},"---",{id:"sizeof",text:L("arduino.blocks.dataLengthOf","length of %1"),output:"number",inputs:{DATA:{type:"string",defaultValue:"arduino"}},ino(e){return[`strlen(${this.valueToCode(e,"DATA",this.ORDER_NONE)})`,this.ORDER_FUNCTION_CALL]}},"---",{id:"constrain",text:L("arduino.blocks.dataConstrain","constrain %1 between %2 to %3"),output:"number",inputs:{DATA:{type:"integer",defaultValue:0},FROM:{type:"integer",defaultValue:0},TO:{type:"integer",defaultValue:255}},ino(e){let t=this.valueToCode(e,"DATA",this.ORDER_NONE),i=this.valueToCode(e,"FROM",this.ORDER_NONE),n=this.valueToCode(e,"TO",this.ORDER_NONE);return[`constrain(${t}, ${i}, ${n})`,this.ORDER_FUNCTION_CALL]}},{id:"map",text:L("arduino.blocks.dataMap","map %1 from %2 - %3 to %4 - %5"),output:"number",inputs:{DATA:{type:"integer",defaultValue:0},FROMLOW:{type:"integer",defaultValue:0},FROMHIGH:{type:"integer",defaultValue:1023},TOLOW:{type:"integer",defaultValue:0},TOHIGHT:{type:"integer",defaultValue:255}},ino(e){let t=this.valueToCode(e,"DATA",this.ORDER_NONE),i=this.valueToCode(e,"FROMLOW",this.ORDER_NONE),n=this.valueToCode(e,"FROMHIGH",this.ORDER_NONE),o=this.valueToCode(e,"TOLOW",this.ORDER_NONE),r=this.valueToCode(e,"TOHIGHT",this.ORDER_NONE);return[`map(${t}, ${i}, ${n}, ${o}, ${r})`,this.ORDER_FUNCTION_CALL]}}]});var he=["int","float","boolean","char","byte","String"],$e=()=>({id:"data",skipXML:!0,blocks:[{id:"setvariableto",ino(e){let t=e.getFieldValue("TYPE")||"int",i=this.getVariableName(e.getFieldValue("VARIABLE")),n=`${t} ${i};`;if(e.getRootBlock().type==="event_whensetup")return this.definitions_[`variable_${i}`]=n,"";return n+`
`}},{id:"changevariableby",ino(e){let t=this.getVariableName(e.getFieldValue("VARIABLE")),i=this.valueToCode(e,"VALUE",this.ORDER_NONE);return`${t} = ${i};
`}},{id:"variable",ino(e){return[this.getVariableName(e.getFieldValue("VARIABLE")),this.ORDER_ATOMIC]}},{id:"insertatlist",ino(e){let t=e.getFieldValue("TYPE")||"int",i="arr"+this.getVariableName(e.getFieldValue("LIST")),n=this.valueToCode(e,"INDEX",this.ORDER_NONE),o=`${t} ${i}[${n}];`;if(e.getRootBlock().type==="event_whensetup")return this.definitions_[`variable_${i}`]=o,"";return o+`
`}},{id:"replaceitemoflist",ino(e){let t="arr"+this.getVariableName(e.getFieldValue("LIST")),i=this.valueToCode(e,"ITEM",this.ORDER_NONE),n=this.valueToCode(e,"INDEX",this.ORDER_NONE);return`${t}[${n}] = ${i};
`}},{id:"listcontents",ino(e){return["arr"+this.getVariableName(e.getFieldValue("LIST")),this.ORDER_ATOMIC]}},{id:"itemoflist",ino(e){let t="arr"+this.getVariableName(e.getFieldValue("LIST")),i=this.valueToCode(e,"INDEX",this.ORDER_NONE);return[`${t}[${i}]`,this.ORDER_MEMBER]}},{id:"lengthoflist",ino(e){let t="arr"+this.getVariableName(e.getFieldValue("LIST"));return[`(sizeof(${t}) / sizeof(${t}[0]))`,this.ORDER_DIVIDE]}}]});import{ScratchBlocks as dn}from"@blockcode/blocks";var kt={argument_reporter_string_number:"String",argument_reporter_boolean:"bool",argument_reporter_number:"float"},Pe=0,St=1,At=2,Dt=3,It={[Pe]:"void",[St]:"bool",[At]:"float",[Dt]:"String"},Ve=()=>({id:"procedures",skipXML:!0,blocks:[{id:"definition",ino(e){let t=e.childBlocks_[0],i=this.getFunctionName(t.getProcCode()),n=this.statementToCode(e),o=t.childBlocks_.map((l)=>`${kt[l.type]} ${this.getVariableName(l.getFieldValue("VALUE"))}`),r=It[t.return_??Pe];this.definitions_[`declare_${i}`]=`${r} ${i}();`;let a="";a+=`${i}(${o.join(", ")}) {
`,a+=n,a+="}",this.definitions_[i]=`${r} ${a}`}},{id:"call",ino(e){let t=this.getFunctionName(e.getProcCode()),i=e.argumentIds_.map((o)=>this.valueToCode(e,o,this.ORDER_NONE)||"false"),n=`${t}(${i.join(", ")})`;if(e.return_)return[n,this.ORDER_FUNCTION_CALL];return n+`;
`}},{id:"return",ino(e){return`return ${this.valueToCode(e,"VALUE",this.ORDER_NONE)};
`}},{id:"return_string",ino(e){return`return String(${this.valueToCode(e,"STR",this.ORDER_NONE)});
`}}]});import{themeColors as Re,translate as ge}from"@blockcode/core";import{ScratchBlocks as Rn}from"@blockcode/blocks";var Ue=()=>({id:"sensing",name:"%{BKY_CATEGORY_SENSING}",themeColor:Re.blocks.sensing.primary,inputColor:Re.blocks.sensing.secondary,otherColor:Re.blocks.sensing.tertiary,blocks:[{id:"runtime",text:ge("arduino.blocks.runtime","run time %1"),output:"number",inputs:{UNIT:{menu:[[ge("arduino.blocks.runtimeMilliseconds","milliseconds"),"MS"],[ge("arduino.blocks.runtimeSeconds","seconds"),"SEC"]]}},ino(e){return[`(millis()${e.getFieldValue("UNIT")==="SEC"?"/1000":""})`,this.ORDER_FUNCTION_CALL]}}]});import{ClangGenerator as Lt}from"@blockcode/blocks";var Mt=`/* Generate by BlockCode */
`;class Q extends Lt{constructor(){super("INO")}init(e){super.init(e),this.definitions_.include_arduino="#include <Arduino.h>",this.setup_="",this.loop_="",this.onDefinitions?.()}finish(e){let t=[],i=[],n=[],o=[],r=[],a=[],l=[],d=[];for(let b in this.definitions_){let E=this.definitions_[b];if(b.startsWith("include_"))t.push(E);else if(b.startsWith("declare_"))i.push(E);else if(b.startsWith("define_"))n.push(E);else if(b.startsWith("variable_"))o.push(E);else if(b.startsWith("setup_"))a.push(E);else if(b.startsWith("loop_"))l.push(E);else if(b.startsWith("tick_"))d.push(E);else r.push(E)}if(d.length>0)t.push("#include <TimerOne.h>"),i.push("void _time10msTicks();"),r.push(`void _time10msTicks() {
  ${d.join(`
${this.INDENT}`)}
}`),a.push("Timer1.initialize(10000);","Timer1.attachInterrupt(_time10msTicks);");let m="";if(t.length>0)m+=t.join(`
`)+`

`;if(i.length>0)m+=i.join(`
`)+`

`;if(n.length>0)m+=n.join(`
`)+`

`;if(o.length>0)m+=o.join(`
`)+`

`;if(a.length>0)this.setup_=this.INDENT+a.join(`
${this.INDENT}`)+`
${this.setup_}`;if(l.length>0)this.loop_=this.INDENT+l.join(`
${this.INDENT}`)+`
${this.loop_}`;let f=`void setup() {
${this.setup_}}

void loop() {
${this.loop_||this.INDENT+`delay(100);
`}}

`+r.join(`

`);return delete this.definitions_,delete this.names_,delete this.setup_,delete this.loop_,this.variableDB_.reset(),Mt+m.replace(/\n\n+/g,`

`)+e+f.replace(/\n\n+/g,`

`)}}function we(e,t){let i=Se(e),n=Ae(),o=De(),r=Le(t),a=Me(),l=xe(),d=ye(),m=Ue(),f=$e(),b=Ve();return[i,o,l,r,a,m,d,n,f,b]}import{Text as _}from"@blockcode/core";import{jsx as T}from"preact/jsx-runtime";var Be=[{tag:"controller",label:T(_,{id:"arduino.extension.tags.controllers",defaultMessage:"Controllers"})},{tag:"sensor",label:T(_,{id:"arduino.extension.tags.sensors",defaultMessage:"Sensors"})},{tag:"actuator",label:T(_,{id:"arduino.extension.tags.actuators",defaultMessage:"Actuators"})},{tag:"display",label:T(_,{id:"arduino.extension.tags.displays",defaultMessage:"Displays"})},{tag:"module",label:T(_,{id:"arduino.extension.tags.modules",defaultMessage:"Modules"})},{tag:"communication",label:T(_,{id:"arduino.extension.tags.communication",defaultMessage:"Communication"})},{tag:"kit",label:T(_,{id:"arduino.extension.tags.kits",defaultMessage:"Kits"})}];import{jsx as Bt}from"preact/jsx-runtime";var Ut=new Q,wt=()=>["arduino"];function Ge(){let{tabIndex:e}=yt(),{meta:t}=$t();xt(()=>{Pt("boardPins",ae(t.value.boardType))},[t.value.boardType]);let i=Fe(()=>{return we(t.value.boardType,t.value.classicEvents)},[t.value.boardType,t.value.classicEvents]),n=Fe((o,r,a,l)=>{for(let d in a)for(let m of a[d])if(m.header)r(`include_${d}_${m.name}`,`#include "${m.name}"`)},[]);return Bt(Vt,{enableCodePreview:!0,enableProcedureExecute:!0,enableProcedureReturns:!0,disableSensingBlocks:!0,extensionTags:Be,disableGenerateCode:e.value!==0,variableTypes:he,generator:Ut,onDefinitions:n,onBuildinExtensions:i,onExtensionsFilter:wt})}function me(e){let t=globalThis.document,i=t.createElement("style");i.appendChild(t.createTextNode(e)),t.head.append(i)}me(".CNbKOG_device-icon{width:20px;height:20px}.CNbKOG_check-icon{margin-right:calc(var(--space)/2);visibility:hidden;width:14px}.CNbKOG_check-icon.CNbKOG_checked{visibility:visible}.CNbKOG_blank-check-item>div{padding-left:calc(14px + var(--space)/2)}");var p={checked:"CNbKOG_checked",deviceIcon:"CNbKOG_device-icon",blankCheckItem:"CNbKOG_blank-check-item",checkIcon:"CNbKOG_check-icon"};var He="./assets/icon-device-sma7ahy6.png";import{jsx as Gt}from"preact/jsx-runtime";function We(){return Gt("img",{className:p.deviceIcon,src:He})}import{useProjectContext as Ht,Text as w}from"@blockcode/core";import{jsx as B}from"preact/jsx-runtime";function Ye(){let{meta:e}=Ht();if(e.value.boardType===s.BLEUNO)return B(w,{id:"arduino.menubar.device.bleuno",defaultMessage:"BLE-UNO"});if(e.value.boardType===s.BLENANO)return B(w,{id:"arduino.menubar.device.blenano",defaultMessage:"BLE-NANO"});if(e.value.boardType===s.ArduinoUnoR4)return B(w,{id:"arduino.menubar.device.unoR4",defaultMessage:"Arduino Uno R4"});if(e.value.boardType===s.ArduinoNano)return B(w,{id:"arduino.menubar.device.nano",defaultMessage:"Arduino Nano"});return B(w,{id:"arduino.menubar.device.uno",defaultMessage:"Arduino Uno"})}import{useCallback as x,useEffect as ri}from"preact/hooks";import{useSignal as ai,useComputed as Ze}from"@preact/signals";import{nanoid as si,classNames as y,sleepMs as ui}from"@blockcode/utils";import{useAppContext as li,useProjectContext as di,setAlert as ie,setAppState as $,translate as G,logger as H}from"@blockcode/core";import{ArduinoUtils as je}from"@blockcode/board";import{setAlert as M,delAlert as Ee,setAppState as qt,translate as C,logger as v}from"@blockcode/core";import{ArduinoUtils as Xe}from"@blockcode/board";import{Base64Utils as Oe}from"@blockcode/utils";import{setFile as Wt}from"@blockcode/core";var Yt="https://arduino.blockcode.fun/cli/compile",Kt=/^(?:[A-Za-z]:)?[^:]*[\\/]([^\\/:]+\.\w+)(?=:)/gm,Xt={[s.ArduinoUno]:"arduino:avr:uno",[s.ArduinoNano]:"arduino:avr:nano",[s.BLEUNO]:"arduino:avr:uno",[s.BLENANO]:"arduino:avr:nano"},zt=(e)=>{if(e instanceof ArrayBuffer)return Oe.arrayBufferToBase64(e);else if(e instanceof Uint8Array)return Oe.arrayBufferToBase64(e.buffer);return Oe.stringToBase64(e)};async function Ke(e,t){let i={fqbn:Xt[e],sketch:t.map(({name:a,content:l})=>({name:a,content:zt(l)})),resultType:"json"},n=JSON.stringify({json:JSON.stringify(i)}),o;if(window.electron?.arduinoCompile){let a=await window.electron?.arduinoCompile(n);o=JSON.parse(a)}else o=await(await fetch(Yt,{method:"POST",headers:{"Content-Type":"application/json"},body:n})).json();if(o.sketchName)Wt({name:o.sketchName});if(o?.success&&o?.hex)return atob(o.hex);let r=o?.message??o?.error??"";throw r=r.replace(Kt,"$1").replaceAll(/sketch_[^\.]+\.ino:[ ]*/g,""),Error(r.trim())}var Qt=(e)=>{M("compileError",{id:e,button:{label:C("gui.alert.compileViewError","View Message"),onClick(){qt("panelBoxId","Logs"),Ee(e)}},onClose(){Ee(e)}})},be=(e,t)=>{if(t<100)M("downloading",{id:e,progress:t});else M("downloadCompleted",{id:e}),setTimeout(()=>Ee(e),1000)},J=async(e,t,i,n)=>{M("compiling",{id:e}),v.log(C("gui.logs.compiling","Compiling..."));let o;try{o=await Ke(i,n)}catch(r){Qt(e),v.error(r.message)}if(!o)return;be(e,0),v.log(C("gui.logs.downloading","Downloading..."));try{await Xe.write(t,o,be.bind(null,e)),v.success(C("gui.logs.downloaded","Download completed"))}catch(r){if(t.type==="ble")try{await Xe.write(t,o,be.bind(null,e)),v.success(C("gui.logs.downloaded","Download completed"))}catch(a){M("downloadError",{id:e},1000),v.error(C("gui.logs.downloadError","Download failed")+": "+a.message)}else M("downloadError",{id:e},1000),v.error(C("gui.logs.downloadError","Download failed")+": "+r.message)}};import{Text as P,MenuSection as et,MenuItem as W}from"@blockcode/core";import{useEffect as Zt,useCallback as jt}from"preact/hooks";import{batch as ei}from"@preact/signals";import{classNames as Z}from"@blockcode/utils";import{useAppContext as ti,useProjectContext as ii,setMeta as ze,logger as qe,translate as S,setAppState as ni,Text as F,MenuSection as Qe,MenuItem as j}from"@blockcode/core";var k="./assets/icon-check-f984n1c2.svg";import{jsx as N,jsxs as A,Fragment as oi}from"preact/jsx-runtime";function Je({disabled:e,itemClassName:t}){let{appState:i}=ti(),{meta:n}=ii();Zt(()=>{if(!n.value.boardType)ze("boardType",s.BLEUNO)},[]);let o=jt((r)=>()=>{if(r===n.value.boardType)return;ei(()=>{if(i.value?.device)i.value.device.disconnect(),qe.warn(S("gui.logs.disconnected","Device disconnected"));ni("device",null),ze({boardType:r});let a="";switch(r){case s.ArduinoUno:a=S("arduino.menubar.device.uno","Arduino Uno");break;case s.ArduinoUnoR4:a=S("arduino.menubar.device.unoR4","Arduino Uno R4");break;case s.ArduinoNano:a=S("arduino.menubar.device.nano","Arduino Nano");break;case s.BLEUNO:a=S("arduino.menubar.device.bleuno","BLE-UNO");break;case s.BLENANO:a=S("arduino.menubar.device.blenano","BLE-NANO");break}qe.info(S("gui.logs.changeDevice","Device changed to {device}",{device:a}))})},[]);return A(oi,{children:[A(Qe,{disabled:e,children:[A(j,{className:t,onClick:o(s.ArduinoUno),children:[N("img",{className:Z(p.checkIcon,{[p.checked]:n.value.boardType===s.ArduinoUno}),src:k}),N(F,{id:"arduino.menubar.device.uno",defaultMessage:"Arduino Uno"})]}),A(j,{className:t,onClick:o(s.ArduinoNano),children:[N("img",{className:Z(p.checkIcon,{[p.checked]:n.value.boardType===s.ArduinoNano}),src:k}),N(F,{id:"arduino.menubar.device.nano",defaultMessage:"Arduino Nano"})]})]}),A(Qe,{disabled:e,titleClassName:p.blankCheckItem,title:N(F,{id:"arduino.menubar.device.nulllab",defaultMessage:"NULLLAB"}),children:[A(j,{className:t,onClick:o(s.BLEUNO),children:[N("img",{className:Z(p.checkIcon,{[p.checked]:n.value.boardType===s.BLEUNO}),src:k}),N(F,{id:"arduino.menubar.device.bleuno",defaultMessage:"BLE-UNO"})]}),A(j,{className:t,onClick:o(s.BLENANO),children:[N("img",{className:Z(p.checkIcon,{[p.checked]:n.value.boardType===s.BLENANO}),src:k}),N(F,{id:"arduino.menubar.device.blenano",defaultMessage:"BLE-NANO"})]})]})]})}import{jsx as O,jsxs as te,Fragment as ee}from"preact/jsx-runtime";var fe=(e,t)=>{if(e.name==="NotFoundError")return;if(e.name==="NetworkError")ie("connectionBusy",{id:t},1000);else ie("connectionError",{id:t},1000)};function tt({className:e,itemClassName:t}){let{appState:i}=li(),{meta:n,file:o,assets:r}=di(),a=ai(i.value?.device?.baudRate),l=Ze(()=>i.value?.device),d=Ze(()=>i.value?.deviceAlertId),m=x(async()=>{if(!l.value)return;if(d.value)return;let u=si();$("deviceAlertId",u),await J(u,l.value,n.value.boardType,[].concat({name:`${o.value.name??"main"}.ino`,content:o.value.content},r.value.map(({id:X,content:z})=>({name:X,content:z})))),$("deviceAlertId",null)},[]),f=x(async(u)=>{if(u===l.value)return;await l.value?.disconnect(),await ui(500);let X=()=>f(u),z=(ne)=>{if(ne)fe(ne,d.value),H.warn(G("gui.logs.disconnected","Device disconnected")+": "+ne.message);$("device",null),$("deviceAlertId",null),u.off("connect",X),u.off("disconnect",z)};u.on("connect",X),u.on("disconnect",z),$("device",u),a.value=u.baudRate},[]),b=x(async()=>{if(d.value)return;try{let u=await je.connect();f(u),ie("connected",1000),H.success(G("gui.logs.connectedType","Device connected with {type}",{type:"USB"}))}catch(u){fe(u,d.value)}},[]),E=x(async()=>{if(d.value)return;try{let u=await je.connectBLE();f(u),ie("connected",1000),H.success(G("gui.logs.connectedType","Device connected with {type}",{type:"BLE"}))}catch(u){fe(u,d.value)}},[]),ct=x(()=>{if(d.value)return;l.value?.disconnect(),H.warn(G("gui.logs.disconnected","Device disconnected"))},[]),pt=x((u)=>()=>{if(u===a.value)return;l.value.reconnect({baudRate:u}),a.value=u,H.info(G("arduino.logs.changeBaudrate","Baudrate changed to {baudrate}",{baudrate:u}))},[]);return ri(()=>{if(d.value&&!l.value)$("deviceAlertId",null)},[l.value]),te(ee,{children:[O(et,{disabled:d.value||!l.value,children:O(W,{className:y(t,p.blankCheckItem),label:O(P,{id:"gui.menubar.device.download",defaultMessage:"Download program"}),onClick:m})}),O(et,{disabled:d.value,children:l.value?te(ee,{children:[O(W,{className:y(t,p.blankCheckItem),label:O(P,{id:"gui.menubar.device.disconnect",defaultMessage:"Disconnect device"}),onClick:ct}),O(W,{menuClassName:e,className:y(t,p.blankCheckItem),label:O(P,{id:"arduino.menubar.device.changeBaudrate",defaultMessage:"Change baudrate"}),items:[115200,57600,38400,19200,9600].map((u)=>({className:t,label:te(ee,{children:[O("img",{className:y(p.checkIcon,{[p.checked]:a.value===u}),src:k}),O(P,{id:"arduino.menubar.device.baudrate",defaultMessage:"Baudrate {baudrate}",baudrate:u})]}),onClick:pt(u)}))})]}):te(ee,{children:[O(W,{disabled:d.value,className:y(t,p.blankCheckItem),label:O(P,{id:"gui.menubar.device.connectUsb",defaultMessage:"Connect device with USB..."}),onClick:b}),n.value.boardType===s.BLEUNO&&O(W,{disabled:d.value,className:y(t,p.blankCheckItem),label:O(P,{id:"gui.menubar.device.connectBle",defaultMessage:"Connect device with Bluetooth (BLE)..."}),onClick:E})]})}),O(Je,{disabled:d.value,itemClassName:t})]})}import{useEffect as ci,useCallback as pi}from"preact/hooks";import{useProjectContext as hi,setMeta as it,Text as nt,MenuItem as Ri}from"@blockcode/core";import{jsx as Ne}from"preact/jsx-runtime";function ot({itemClassName:e}){let{meta:t}=hi();ci(()=>{if(!t.value.classicEvents)it("classicEvents",!1)},[]);let i=pi(()=>{let n=!t.value.classicEvents;it({classicEvents:n})},[]);return Ne(Ri,{className:e,onClick:i,children:t.value.classicEvents?Ne(nt,{id:"arduino.menubar.edit.classicEventsClose",defaultMessage:"Turn off Classic Event Blocks"}):Ne(nt,{id:"arduino.menubar.edit.classicEventsOpen",defaultMessage:"Turn on Classic Event Blocks"})})}import{useCallback as mi}from"preact/hooks";import{useComputed as at}from"@preact/signals";import{nanoid as Oi}from"@blockcode/utils";import{useAppContext as bi,useProjectContext as Ei,setAppState as st,Text as fi}from"@blockcode/core";var rt="./assets/icon-download-09b2xh4b.svg";import{jsx as _e,jsxs as Ni}from"preact/jsx-runtime";function ut({className:e}){let{appState:t}=bi(),{meta:i,file:n,assets:o}=Ei(),r=at(()=>t.value?.device),a=at(()=>t.value?.deviceAlertId),l=mi(async()=>{if(!r.value)return;if(a.value)return;let d=Oi();st("deviceAlertId",d),await J(d,r.value,i.value.boardType,[].concat({name:`${n.value.name??"main"}.ino`,content:n.value.content},o.value.map(({id:m,content:f})=>({name:m,content:f})))),st("deviceAlertId",null)},[]);return Ni("label",{disabled:a.value||!r.value,className:e,onClick:l,children:[_e("img",{src:rt}),_e("span",{children:_e(fi,{id:"gui.menubar.device.download",defaultMessage:"Download program"})})]})}var lt={files:[{id:"main",type:"text/x-c"}]};import{jsx as K}from"preact/jsx-runtime";var ar={onNew(){return lt},onSave(e,t,i){return{assets:t,files:e.map((n)=>({...n,name:void 0})),meta:{boardType:i.boardType??s.ArduinoUno,classicEvents:i.classicEvents??!1}}},async onThumb(){let e=Y.getMainWorkspace();if(e){let t=e.getCanvas();if(t)return await _i(t,{})}},onUndo(e){if(e instanceof MouseEvent)Y.getMainWorkspace()?.undo(!1)},onRedo(e){if(e instanceof MouseEvent)Y.getMainWorkspace()?.undo(!0)},onEnableUndo(){let e=Y.getMainWorkspace();return e?.undoStack_&&e.undoStack_.length!==0},onEnableRedo(){let e=Y.getMainWorkspace();return e?.redoStack_&&e.redoStack_.length!==0},menuItems:[{id:"edit",Menu:ot},{id:"view",disabledFiles:!0,autoDisplayPanel:!0},{icon:K(We,{}),label:K(Ye,{}),Menu:tt}],barItems:[{Label:ut}],tabs:[{...vi,Content:Ge},{...ki,Content:()=>K(Ci,{onRegisterCompletionItems:ke})},{...dt,label:K(Ti,{id:"arduino.tabs.serialPort",defaultMessage:"Serial"}),Content:()=>{let e=dt.Content;return K(e,{disabledREPL:!0})}}]};export{ar as default};
