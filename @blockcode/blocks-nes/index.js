import{nanoid as g}from"@blockcode/utils";import{addLocalesMessages as w,setAlert as s,delAlert as k,Text as c,Spinner as b}from"@blockcode/core";import{MPYUtils as a}from"@blockcode/board";var m={en:{"blocks.nes.name":"NES emulator","blocks.nes.download":"Download ROM to Arcade"},"zh-Hans":{"blocks.nes.name":"NES 模拟器","blocks.nes.download":"下载 ROM 到游戏机"},"zh-Hant":{"blocks.nes.name":"NES 模擬器","blocks.nes.download":"下載 ROM 到遊戲機"}};var M="./assets/icon-jj2v9ggp.png";import{jsx as r}from"preact/jsx-runtime";w(m);var o,I=[{usbVendorId:12346,usbProductId:32769}],p=()=>{k(o),o=null},h=(e)=>{if(!o)o=g();if(e<100)s({id:o,icon:r(b,{level:"success"}),message:r(c,{id:"gui.alert.downloadingProgress",defaultMessage:"Downloading...{progress}%",progress:e})});else s("downloadCompleted",{id:o}),setTimeout(p,2000)},f=(e)=>{if(e==="NotFoundError")return;s("connectionError",1000)},E={icon:M,name:r(c,{id:"blocks.nes.name",defaultMessage:"NES emulator"}),blocks:[{button:"DOWNLOAD_ROM",text:r(c,{id:"blocks.nes.download",defaultMessage:"Download ROM to Arcade"}),async onClick(){if(o)return;let e;try{e=await a.connect(I),await a.enterDownloadMode(e)}catch(l){f(l.name)}if(!e)return;let n=document.createElement("input");n.type="file",n.accept=".nes",n.multiple=!0,n.click(),n.addEventListener("change",async({target:l})=>{let i=[],d="";for(let t of l.files)i.push({id:`nes/${t.name}`,content:await t.arrayBuffer()}),d=t.name;try{await a.write(e,i,h),await a.config(e,{"latest-game":d}),e.hardReset()}catch(t){f(t.name),p()}})}}]};export{E as default};
