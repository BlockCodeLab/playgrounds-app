import{nanoid as w}from"@blockcode/utils";import{addLocalesMessages as k,setAlert as r,delAlert as b,Text as m,Spinner as L}from"@blockcode/core";import{MPYUtils as a}from"@blockcode/board";var s={en:{"blocks.nes.name":"NES emulator","blocks.nes.download":"Download ROM to Arcade"},"zh-Hans":{"blocks.nes.name":"NES 模拟器","blocks.nes.download":"下载 ROM 到游戏机"},"zh-Hant":{"blocks.nes.name":"NES 模擬器","blocks.nes.download":"下載 ROM 到遊戲機"}};var d="./assets/icon-jj2v9ggp.png";import{jsx as f}from"preact/jsx-runtime";k(s);var o,I=[{usbVendorId:12346,usbProductId:32769}],p=()=>{b(o),o=null},h=(e)=>{if(!o)o=w();if(e<100)r("downloading",{id:o,progress:e});else r("downloadCompleted",{id:o}),setTimeout(p,2000)},M=(e)=>{if(e==="NotFoundError")return;r("connectionError",1000)},N={icon:d,name:f(m,{id:"blocks.nes.name",defaultMessage:"NES emulator"}),blocks:[{button:"DOWNLOAD_ROM",text:f(m,{id:"blocks.nes.download",defaultMessage:"Download ROM to Arcade"}),async onClick(){if(o)return;let e;try{e=await a.connect(I),await a.enterDownloadMode(e)}catch(l){M(l.name)}if(!e)return;let n=document.createElement("input");n.type="file",n.accept=".nes",n.multiple=!0,n.click(),n.addEventListener("change",async({target:l})=>{let c=[],i="";for(let t of l.files)c.push({filename:`nes/${t.name}`,content:await t.arrayBuffer()}),i=t.name;try{await a.write(e,c,h),await a.config(e,{"latest-game":i}),e.hardReset()}catch(t){M(t.name),p()}})}}]};export{N as default};
