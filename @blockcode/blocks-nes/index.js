import{nanoid as g}from"@blockcode/utils";import{addLocalesMessages as w,setAlert as r,delAlert as k,Text as m,Spinner as D}from"@blockcode/core";import{MPYUtils as a}from"@blockcode/board";var s={en:{"blocks.nes.name":"NES emulator","blocks.nes.download":"Download ROM to Arcade"},"zh-Hans":{"blocks.nes.name":"NES 模拟器","blocks.nes.download":"下载 ROM 到游戏机"},"zh-Hant":{"blocks.nes.name":"NES 模擬器","blocks.nes.download":"下載 ROM 到遊戲機"}};var d="./assets/icon-jj2v9ggp.png";import{jsx as M}from"preact/jsx-runtime";w(s);var o,b=[{usbVendorId:12346,usbProductId:32769}],p=()=>{k(o),o=null},x=(e)=>{if(!o)o=g();if(e<100)r("downloading",{id:o,progress:e});else r("downloadCompleted",{id:o}),setTimeout(p,2000)},f=(e)=>{if(e==="NotFoundError")return;r("connectionError",1000)},E={icon:d,name:M(m,{id:"blocks.nes.name",defaultMessage:"NES emulator"}),blocks:[{button:"DOWNLOAD_ROM",text:M(m,{id:"blocks.nes.download",defaultMessage:"Download ROM to Arcade"}),async onClick(){if(o)return;let e;try{e=await a.connect(b),await a.enterDownloadMode(e)}catch(l){f(l.name)}if(!e)return;let n=document.createElement("input");n.type="file",n.accept=".nes",n.multiple=!0,n.click(),n.addEventListener("change",async({target:l})=>{let c=[],i="";for(let t of l.files)c.push({filename:`nes/${t.name}`,content:await t.arrayBuffer()}),i=t.name;try{await a.write(e,c,x),await a.config(e,{"latest-game":i}),e.hardReset()}catch(t){f(t.name),p()}})}}]};export{E as default};
