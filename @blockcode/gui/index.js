import{addLocalesMessages as na}from"@blockcode/core";var Er={"gui.name":"BlockCode Playgrounds","gui.alert.importing":"Importing...","gui.alert.downloading":"Downloading...{progress}%","gui.alert.downloadCompleted":"Download completed.","gui.alert.connecting":"Connecting...","gui.alert.connected":"Connected.","gui.alert.connectionCancel":"Connection cancel.","gui.alert.connectionError":"Connection error or connection was lost.","gui.alert.erasing":"Erasing...","gui.alert.restoring":"Firmware restoring...{progress}%","gui.alert.recovering":"Recovering...","gui.alert.restoreCompleted":"Firmware resotre completed! Now press RESET key","gui.alert.reseting":"Reseting...","gui.alert.compiling":"Compiling...","gui.alert.compileCompleted":"Compilation completed.","gui.alert.compileError":"Compilation failed.","gui.alert.compileViewError":"View Message.","gui.alert.saving":"Saving project...","gui.alert.saved":"Saved.","gui.alert.savedComputer":"Saved to your computer.","gui.alert.saveAbortError":"Abort saving.","gui.alert.saveError":"Failed save.","gui.home.my":"My projects","gui.home.all":"View all","gui.home.allCounts":"View all ({counts})","gui.home.new":"Create new project","gui.home.examples":"Wonderful {label} projects","gui.home.slideshow.desktop.title":"The desktop application is here!","gui.home.slideshow.desktop.button":"Download","gui.home.slideshow.tankwar.title":"The Tank War is coming! Join us!","gui.home.slideshow.tankwar.button":"Join us","gui.home.slideshow.arcade.title":"The next game, create your own!","gui.home.slideshow.arcade.button":"Create now","gui.splash.loading":"Loading project...","gui.splash.errorTitle":"Error occurred","gui.splash.errorLabel":"Please refresh the page and reopen it.","gui.menubar.courses":"Courses","gui.menubar.tutorials":"Tutorials","gui.menubar.titlePlaceholder":"Project title here","gui.menubar.file":"File","gui.menubar.file.newProject":"New","gui.menubar.file.openProject":"Open...","gui.menubar.file.saveProject":"Save","gui.menubar.file.uploadProject":"Load from your computer...","gui.menubar.file.downloadProject":"save to your computer...","gui.menubar.edit":"Edit","gui.menubar.edit.undo":"Undo","gui.menubar.edit.redo":"Redo","gui.menubar.edit.openManualCoding":"Turn on coding mode","gui.menubar.edit.closeManualCoding":"Turn off coding mode","gui.menubar.view":"View","gui.menubar.view.log":"Log panel","gui.menubar.view.serial":"Serial panel","gui.menubar.view.files":"Files panel","gui.menubar.view.openAutoDisplayPanel":"Turn on auto display panel","gui.menubar.view.closeAutoDisplayPanel":"Turn off auto display panel","gui.menubar.device":"Device","gui.menubar.device.sync":"Sync program","gui.menubar.device.download":"Download program","gui.menubar.device.reset":"Reset device","gui.menubar.device.connect":"Connect device...","gui.menubar.device.connectUsb":"Connect device with USB...","gui.menubar.device.connectBle":"Connect device with Bluetooth (BLE)...","gui.menubar.device.disconnect":"Disconnect device","gui.menubar.device.firmware":"Restore firmware...","gui.menubar.device.firmwareVersion":"Restore v{version} firmware...","gui.menubar.device.caching":"Caching latest firmware...","gui.project.name":"Untitled Project","gui.project.shortname":"Untitled","gui.library.search":"Search","gui.library.projects.empty":"No project!","gui.library.projects.rename":"rename","gui.library.projects.duplicate":"duplicate","gui.library.projects.delete":"delete","gui.library.projects.notSaved":"Not saved","gui.library.projects.close":"Close current project?","gui.library.projects.deleteConfirm":'Do you want to delete the project "{name}"?',"gui.library.projects.replace":"Replace contents of the current project?","gui.library.projects.errorEditor":'This project is not currently editor creation, please switch to "{workspace}" and open it.',"gui.library.projects.notFoundEditor":'Not Found the "{editor}" Editor.',"gui.library.examples.interconnect":"The project requires two devices to work properly.","gui.library.tutorial.course":"Choose a course","gui.library.tutorial.tutorial":"Choose a tutorial","gui.tutorials.shrink":"Shrink","gui.tutorials.expand":"Expand","gui.tutorials.close":"Close","gui.tutorials.moreTry":"More things to try!","gui.tutorials.seeMore":"See more","gui.prompt.ok":"OK","gui.prompt.close":"Close","gui.prompt.cancel":"Cancel","gui.prompt.reconnect":"Reconnect","gui.connection.device":"Device Connection","gui.connection.search":"Start Searching","gui.connection.searching":"Searching...","gui.connection.connect":"Start Connecting","gui.connection.deviceName":"Device name","gui.about.title":"About...","gui.about.main":"Main program","gui.terms.title":"Terms of Use","gui.terms.content":`<b>Terms of Use</b>
`,"gui.privacy.title":"Privacy","gui.privacy.content":`<b>Privacy</b>
`};var Zr={"gui.name":"BlockCode Playgrounds","gui.alert.importing":"载入中…","gui.alert.downloading":"正在下载…{progress}%","gui.alert.downloadCompleted":"下载完成。","gui.alert.connecting":"正在连接…","gui.alert.connected":"已连接。","gui.alert.connectionCancel":"连接取消。","gui.alert.connectionError":"连接发生错误，或已断开。","gui.alert.erasing":"正在清除…","gui.alert.restoring":"正在恢复固件…{progress}%","gui.alert.recovering":"恢复设备…","gui.alert.restoreCompleted":"恢复固件完成，请按下 RESET 键。","gui.alert.reseting":"正在复位…","gui.alert.compiling":"正在编译…","gui.alert.compileCompleted":"编译完成。","gui.alert.compileError":"编译失败。","gui.alert.compileViewError":"查看信息","gui.alert.saving":"正在保存作品…","gui.alert.saved":"已保存。","gui.alert.savedComputer":"已保存到电脑。","gui.alert.saveAbortError":"取消保存。","gui.alert.saveError":"保存作品失败。","gui.home.my":"我的作品","gui.home.all":"查看全部","gui.home.allCounts":"查看全部（{counts}）","gui.home.new":"开始新作品","gui.home.examples":"{label} 精彩作品","gui.home.slideshow.desktop.title":"桌面端程序已就绪，快来下载！","gui.home.slideshow.desktop.button":"立即下载","gui.home.slideshow.tankwar.title":"战争一触即发，赶紧来战吧！","gui.home.slideshow.tankwar.button":"加入战斗","gui.home.slideshow.arcade.title":"玩的下一个游戏，就要自己创作！","gui.home.slideshow.arcade.button":"开始创作","gui.splash.loading":"加载作品…","gui.splash.errorTitle":"发生错误","gui.splash.errorLabel":"请刷新页面重新打开。","gui.menubar.courses":"课程","gui.menubar.tutorials":"教程","gui.menubar.titlePlaceholder":"在此填写作品标题","gui.menubar.file":"文件","gui.menubar.file.newProject":"新作品","gui.menubar.file.openProject":"打开…","gui.menubar.file.saveProject":"保存","gui.menubar.file.uploadProject":"从电脑中打开…","gui.menubar.file.downloadProject":"保存到电脑…","gui.menubar.edit":"编辑","gui.menubar.edit.undo":"撤销","gui.menubar.edit.redo":"重做","gui.menubar.edit.openManualCoding":"打开代码编程","gui.menubar.edit.closeManualCoding":"关闭代码编程","gui.menubar.view":"查看","gui.menubar.view.log":"日志","gui.menubar.view.serial":"串口","gui.menubar.view.files":"文件管理","gui.menubar.view.openAutoDisplayPanel":"打开自动显示","gui.menubar.view.closeAutoDisplayPanel":"关闭自动显示","gui.menubar.device":"设备","gui.menubar.device.sync":"同步程序","gui.menubar.device.download":"下载程序","gui.menubar.device.reset":"复位","gui.menubar.device.connect":"连接…","gui.menubar.device.connectUsb":"通过 USB 连接…","gui.menubar.device.connectBle":"通过蓝牙（BLE）连接…","gui.menubar.device.disconnect":"断开连接","gui.menubar.device.firmware":"恢复固件…","gui.menubar.device.firmwareVersion":"恢复 v{version} 固件…","gui.menubar.device.caching":"正在缓存最新固件…","gui.project.name":"未命名作品","gui.project.shortname":"未命名","gui.library.search":"搜索","gui.library.projects.empty":"没有作品！","gui.library.projects.rename":"重命名","gui.library.projects.duplicate":"复制","gui.library.projects.delete":"删除","gui.library.projects.notSaved":"未保存作品","gui.library.projects.close":"要关闭当前作品吗？","gui.library.projects.deleteConfirm":"要删除“《{name}》”作品吗？","gui.library.projects.replace":"要创建新作品替换当前作品吗？","gui.library.projects.errorEditor":"这个作品不是当前编辑器创作，请切换至“{editor}”编辑器然后打开。","gui.library.projects.notFoundEditor":"没有发现“{editor}”编辑器。","gui.library.examples.interconnect":"该作品需要两台设备联机才能正常运行。","gui.library.tutorials.course":"选择一个课程","gui.library.tutorials.tutorial":"选择一个教程","gui.tutorials.shrink":"收起","gui.tutorials.expand":"展开","gui.tutorials.close":"关闭","gui.tutorials.moreTry":"再试试这些！","gui.tutorials.seeMore":"更多技巧","gui.prompt.ok":"确认","gui.prompt.close":"关闭","gui.prompt.cancel":"取消","gui.prompt.reconnect":"重新连接","gui.connection.device":"硬件连接","gui.connection.search":"开始搜索","gui.connection.searching":"正在搜索…","gui.connection.connect":"开始连接","gui.connection.deviceName":"硬件名称","gui.about.title":"版本信息","gui.about.main":"主程序","gui.terms.title":"使用条款","gui.terms.content":`<b>使用条款</b>
`,"gui.privacy.title":"隐私","gui.privacy.content":`<b>隐私</b>
`};var Qr={"gui.name":"BlockCode Playgrounds","gui.alert.importing":"載入中…","gui.alert.downloading":"正在下載…{progress}%","gui.alert.downloadCompleted":"下載完成。","gui.alert.connecting":"正在連接…","gui.alert.connected":"已連接。","gui.alert.connectionCancel":"連接取消。","gui.alert.connectionError":"連接發生錯誤，或已斷開。","gui.alert.erasing":"正在清除…","gui.alert.restoring":"正在還原固件…{progress}%","gui.alert.recovering":"恢復設備…","gui.alert.restoreCompleted":"還原固件完成，請按下 RESET 鍵。","gui.alert.reseting":"正在重置…","gui.alert.compiling":"正在編譯…","gui.alert.compileCompleted":"編譯完成。","gui.alert.compileError":"編譯失敗。","gui.alert.compileViewError":"查看信息","gui.alert.saving":"正在保存專案…","gui.alert.saved":"已保存。","gui.alert.savedComputer":"已保存到電腦。","gui.alert.saveAbortError":"取消保存。","gui.alert.saveError":"保存專案失敗。","gui.home.my":"我的專案","gui.home.all":"查看全部","gui.home.allCounts":"查看全部（{counts}）","gui.home.new":"開始新專案","gui.home.examples":"{label} 精彩專案","gui.home.slideshow.desktop.title":"桌面端程序已就緒，快來下載！","gui.home.slideshow.desktop.button":"立即下載","gui.home.slideshow.tankwar.title":"戰爭一觸即髮，趕緊來戰吧！","gui.home.slideshow.tankwar.button":"加入戰鬥","gui.home.slideshow.arcade.title":"玩的下一個遊戲，就要自己創作！","gui.home.slideshow.arcade.button":"開始創作","gui.splash.loading":"加載專案…","gui.splash.errorTitle":"發生錯誤","gui.splash.errorLabel":"請刷新頁面重新打開。","gui.menubar.courses":"課程","gui.menubar.tutorials":"教程","gui.menubar.titlePlaceholder":"在此填寫專案標題","gui.menubar.file":"文檔","gui.menubar.file.newProject":"新專案","gui.menubar.file.openProject":"打開…","gui.menubar.file.saveProject":"保存","gui.menubar.file.uploadProject":"從電腦中打開…","gui.menubar.file.downloadProject":"保存到電腦…","gui.menubar.edit":"編輯","gui.menubar.edit.undo":"撤銷","gui.menubar.edit.redo":"重做","gui.menubar.edit.openManualCoding":"打開代碼編程","gui.menubar.edit.closeManualCoding":"關閉代碼編程","gui.menubar.view":"查看","gui.menubar.view.log":"日誌","gui.menubar.view.serial":"串口","gui.menubar.view.files":"文檔管理","gui.menubar.view.openAutoDisplayPanel":"打開自動顯示","gui.menubar.view.closeAutoDisplayPanel":"關閉自動顯示","gui.menubar.device":"設備","gui.menubar.device.sync":"同步程序","gui.menubar.device.download":"下載程序","gui.menubar.device.reset":"重置","gui.menubar.device.connect":"連接…","gui.menubar.device.connectUsb":"通過 USB 連接…","gui.menubar.device.connectBle":"通過藍牙（BLE）連接…","gui.menubar.device.disconnect":"斷開連接","gui.menubar.device.firmware":"還原固件…","gui.menubar.device.firmwareVersion":"還原 v{version} 固件…","gui.menubar.device.caching":"正在緩存最新固件…","gui.project.name":"未命名專案","gui.project.shortname":"未命名","gui.library.search":"搜索","gui.library.projects.empty":"沒有專案！","gui.library.projects.rename":"重命名","gui.library.projects.duplicate":"複製","gui.library.projects.delete":"刪除","gui.library.projects.notSaved":"未保存專案","gui.library.projects.close":"要關閉當前專案嗎？","gui.library.projects.deleteConfirm":"要刪除“《{name}》”專案嗎？","gui.library.projects.replace":"要創建新專案替換當前專案嗎？","gui.library.projects.errorEditor":"這個專案不是當前編輯器創作，請切換至“{editor}”編輯器然後打開。","gui.library.projects.notFoundEditor":"沒有發現「{editor}」編輯器。","gui.library.examples.interconnect":"該專案需要兩枱設備聯機纔能正常運行。","gui.library.tutorials.course":"選擇一個課程","gui.library.tutorials.tutorial":"選擇一個教程","gui.tutorials.shrink":"收起","gui.tutorials.expand":"展開","gui.tutorials.close":"關閉","gui.tutorials.moreTry":"再試試這些！","gui.tutorials.seeMore":"更多技巧","gui.prompt.ok":"確認","gui.prompt.close":"關閉","gui.prompt.cancel":"取消","gui.prompt.reconnect":"重新連接","gui.connection.device":"硬件連接","gui.connection.search":"開始搜索","gui.connection.searching":"正在搜索…","gui.connection.connect":"開始連接","gui.connection.deviceName":"硬件名稱","gui.about.title":"版本信息","gui.about.main":"主程式","gui.terms.title":"使用條款","gui.terms.content":`<b>使用條款</b>
`,"gui.privacy.title":"隱私","gui.privacy.content":`<b>隱私</b>
`};na({en:Er,"zh-Hans":Zr,"zh-Hant":Qr});import{render as po}from"preact";import{LocalesProvider as so,AppProvider as ho,ProjectProvider as fo}from"@blockcode/core";import{useCallback as O,useEffect as Yi,useErrorBoundary as Nn}from"preact/hooks";import{batch as se,useComputed as Vn,useSignal as He,useSignalEffect as Jn}from"@preact/signals";import{isElectron as yr,classNames as Gn,keyMirror as Yn,openProjectFromURL as Kn}from"@blockcode/utils";import{useAppContext as jn,useLocalesContext as eo,useProjectContext as ro,translate as io,maybeTranslate as ao,showSplash as Ki,hideSplash as to,openPromptModal as Xe,closePromptModal as ji,openLayout as no,closeLayout as oo,openTab as ea,openProject as lo,closeProject as co,setAlert as uo,delAlert as mo,setAppState as go}from"@blockcode/core";import{Text as Ke,MenuSection as o1,MenuItem as l1}from"@blockcode/core";import{useCallback as Fe}from"preact/hooks";import{batch as oa}from"@preact/signals";import{isElectron as $r,isMac as Ne,putProject as la,openProjectFromComputer as ca,saveProjectToComputer as ua,sleepMs as ma}from"@blockcode/utils";import{useProjectContext as ga,setAlert as Ge,openUserStorage as pa,setFile as da,setModified as sa,ModifyTypes as ha,Keys as G}from"@blockcode/core";import{Text as N,MenuSection as Ve,MenuItem as be}from"@blockcode/core";function w(e){let i=globalThis.document,r=i.createElement("style");r.appendChild(i.createTextNode(e)),i.head.append(r)}w(".cbXT-q_menu-bar{box-sizing:border-box;height:var(--menu-bar-height);font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:var(--menu-bar-standard-font-size);background-color:var(--theme-primary);color:var(--ui-white);-webkit-user-select:none;-webkit-app-region:drag;flex-flow:row;justify-content:space-between;font-weight:700;display:flex;box-shadow:0 0 3px #00000040}.cbXT-q_menu-bar-item{color:var(--ui-white);user-select:none;white-space:nowrap;height:var(--menu-bar-height);align-self:center;align-items:center;padding:0 .25rem;text-decoration:none;display:flex;position:relative}.cbXT-q_menu-bar-item.cbXT-q_growable{max-width:var(--menu-bar-item-max-width);flex:1}.cbXT-q_main-menu{-webkit-app-region:no-drag;flex-flow:row;justify-content:flex-start;align-items:center;gap:.25rem;display:flex}.cbXT-q_main-menu.cbXT-q_electron{margin-left:72px}.cbXT-q_right-menu{-webkit-app-region:no-drag;flex-flow:row;justify-content:flex-start;align-items:center;gap:.25rem;display:flex}.cbXT-q_menu-label{padding:0 .75rem}.cbXT-q_menu-label img{margin-right:.25rem}.cbXT-q_language-label{width:var(--language-selector-width);padding:0 .5rem}input.cbXT-q_menu-label{display:none}input.cbXT-q_menu-label+.cbXT-q_menu-bar-item:hover{cursor:pointer;background:var(--ui-black-transparent)}input.cbXT-q_menu-label:checked+.cbXT-q_menu-bar-item{background:var(--ui-black-transparent)}.cbXT-q_menu{top:var(--menu-bar-height);z-index:var(--z-index-menu-bar);border-radius:0 0 var(--space)var(--space);color:var(--ui-white);background:var(--theme-primary);min-width:186px;display:none}.cbXT-q_menu-item{font-weight:700}.cbXT-q_menu-item:hover{background:var(--ui-black-transparent)}.cbXT-q_language-icon{vertical-align:middle;height:1.5rem}.cbXT-q_check-icon{margin-right:calc(var(--space)/2);visibility:hidden;width:14px}.cbXT-q_check-icon.cbXT-q_checked{visibility:visible}.cbXT-q_divider{border-right:1px dashed var(--ui-black-transparent);height:34px;margin:0 .7rem}.cbXT-q_hoverable:hover{cursor:pointer;background:var(--ui-black-transparent)}.cbXT-q_tutorials-icon{margin-right:.35rem}.cbXT-q_title-field{border:1px dashed var(--ui-black-transparent);border-radius:var(--form-radius);-webkit-border-radius:var(--form-radius);-moz-border-radius:var(--form-radius);background-color:var(--ui-white-transparent);height:auto;color:var(--ui-white);-webkit-background-clip:padding-box;background-clip:padding-box;padding:.5rem;font-size:.8rem;font-weight:700}.cbXT-q_title-field::placeholder{color:var(--ui-white);font-size:.8rem;font-style:italic;font-weight:400}.cbXT-q_title-field:hover{background-color:#ffffff80}.cbXT-q_title-field:focus{border:1px solid var(--ui-transparent);-webkit-box-shadow:0 0 0 calc(var(--space)*.5)var(--ui-white-transparent);box-shadow:0 0 0 calc(var(--space)*.5)var(--ui-white-transparent);background-color:var(--ui-white);color:var(--text-primary);outline:none}.cbXT-q_home-icon,.cbXT-q_closeIcon{padding:0 .35rem}.cbXT-q_blank-check-item>div{padding-left:calc(14px + var(--space)/2)}");var p={divider:"cbXT-q_divider",rightMenu:"cbXT-q_right-menu",menuLabel:"cbXT-q_menu-label",menuBarItem:"cbXT-q_menu-bar-item",languageLabel:"cbXT-q_language-label",closeIcon:"cbXT-q_closeIcon",languageIcon:"cbXT-q_language-icon",menuBar:"cbXT-q_menu-bar",menuItem:"cbXT-q_menu-item",checkIcon:"cbXT-q_check-icon",checked:"cbXT-q_checked",growable:"cbXT-q_growable",hoverable:"cbXT-q_hoverable",homeIcon:"cbXT-q_home-icon",mainMenu:"cbXT-q_main-menu",menu:"cbXT-q_menu",tutorialsIcon:"cbXT-q_tutorials-icon",blankCheckItem:"cbXT-q_blank-check-item",electron:"cbXT-q_electron",titleField:"cbXT-q_title-field"};import{jsx as $,jsxs as Je,Fragment as fa}from"preact/jsx-runtime";var Fr=(e=!1)=>Ge({message:$(N,{id:"gui.alert.saving",defaultMessage:"Saving project..."})},e),Lr=(e,i=!1)=>Ge({id:e,message:i?$(N,{id:"gui.alert.savedComputer",defaultMessage:"Saved to your computer."}):$(N,{id:"gui.alert.saved",defaultMessage:"Saved to local storage."})},2000),Ar=(e,i=!1)=>Ge({id:e,mode:"warn",message:i?$(N,{id:"gui.alert.saveAbortError",defaultMessage:"Abort saving."}):$(N,{id:"gui.alert.saveError",defaultMessage:"Failed save."})},i?1000:2000);function Wr({onNew:e,onOpen:i,onSave:r,onThumb:t,ExtendedMenu:n}){let{meta:a,key:o,name:l,files:c,assets:u}=ga(),g=Fe(async()=>{await ma(0);for(let A in a.value.monitors)if(a.value.monitors[A].deleting)a.value.monitors.splice(A,1);let m=[],s=c.value.map((A)=>{return m.push(A.extensions),Object.fromEntries(Object.entries(A).filter(([re,Te])=>{if(["xmlDom","script","extensions"].includes(re))return!1;if(!a.value.manualCoding&&re==="content")return!1;return!0}))}),M=u.value?.filter((A)=>!A.uri),Q=await r(s,M,a.value);return console.log(a.value),Q.meta=Object.assign(Q.meta??{},{editor:a.value.editor,version:a.value.version,monitors:a.value.monitors,extensions:Array.from(new Set(m.flat())).filter(Boolean),manualCoding:a.value.manualCoding,users:a.value.users}),Q.name=l.value,Q},[r]),C=Fe(async()=>{let m=Fr(),s=await g();s.key=o.value;let M=await la(s,t);oa(()=>{if(s.key!==M)da({key:M});sa(ha.Saved)}),Lr(m)},[g]),f=Fe(async()=>{let m=Fr($r?1000:!1),s=await g(),M=await ua(s);if($r)return;if(M.success)Lr(m,!0);else if(M.error==="AbortError")Ar(m,!0);else Ar(m)},[g]),b=Fe(async()=>{let m=await ca();await i(m)},[i]);return Je(fa,{children:[$(Ve,{children:$(be,{className:p.menuItem,label:$(N,{id:"gui.menubar.file.newProject",defaultMessage:"New"}),hotkey:[Ne?G.COMMAND:G.CONTROL,G.N],onClick:e})}),Je(Ve,{children:[$(be,{className:p.menuItem,label:$(N,{id:"gui.menubar.file.openProject",defaultMessage:"Open"}),hotkey:[Ne?G.COMMAND:G.CONTROL,G.O],onClick:pa}),$(be,{className:p.menuItem,label:$(N,{id:"gui.menubar.file.saveProject",defaultMessage:"Save"}),hotkey:[Ne?G.COMMAND:G.CONTROL,G.S],onClick:C})]}),Je(Ve,{children:[$(be,{className:p.menuItem,label:$(N,{id:"gui.menubar.file.uploadProject",defaultMessage:"Load from your computer"}),onClick:b}),$(be,{className:p.menuItem,label:$(N,{id:"gui.menubar.file.downloadProject",defaultMessage:"save to your computer"}),onClick:f})]}),n&&$(n,{itemClassName:p.menuItem,onOpen:i,onSave:g})]})}import{useCallback as ba,useEffect as va}from"preact/hooks";import{batch as ka,useSignal as xr}from"@preact/signals";import{isMac as Ir}from"@blockcode/utils";import{useProjectContext as _a,Keys as K,setMeta as wa}from"@blockcode/core";import{Text as Le,MenuSection as Dr,MenuItem as Ye}from"@blockcode/core";import{jsx as Y,jsxs as Sr,Fragment as ya}from"preact/jsx-runtime";function Rr({enableCoding:e,onUndo:i,onRedo:r,onEnableUndo:t,onEnableRedo:n,ExtendedMenu:a}){let{meta:o,key:l,fileId:c,modified:u}=_a(),g=xr(!0),C=xr(!0);va(()=>{ka(()=>{g.value=!t(),C.value=!n()})},[l.value,c.value,u.value]);let f=ba(()=>{wa("manualCoding",!o.value.manualCoding)},[]);return Sr(ya,{children:[Sr(Dr,{children:[Y(Ye,{disabled:g.value,className:p.menuItem,label:Y(Le,{id:"gui.menubar.edit.undo",defaultMessage:"Undo"}),hotkey:[Ir?K.COMMAND:K.CONTROL,K.Z],onClick:i}),Y(Ye,{disabled:C.value,className:p.menuItem,label:Y(Le,{id:"gui.menubar.edit.redo",defaultMessage:"Redo"}),hotkey:Ir?[K.SHIFT,K.COMMAND,K.Z]:[K.CONTROL,K.Y],onClick:r})]}),e&&Y(Dr,{children:Y(Ye,{className:p.menuItem,label:o.value.manualCoding?Y(Le,{id:"gui.menubar.edit.closeManualCoding",defaultMessage:"Turn off coding mode"}):Y(Le,{id:"gui.menubar.edit.openManualCoding",defaultMessage:"Turn on coding mode"}),onClick:f})}),a&&Y(a,{itemClassName:p.menuItem})]})}import{useEffect as qa,useCallback as Ma}from"preact/hooks";import{batch as Vo,useSignal as Ba}from"@preact/signals";import{classNames as Ae,getAutoDisplayPanel as Ea,setAutoDisplayPanel as Za}from"@blockcode/utils";import{Keys as ce}from"@blockcode/core";import{Text as ve,MenuSection as Pr,MenuItem as We}from"@blockcode/core";var le="./assets/icon-check-f984n1c2.svg";import{jsx as H,jsxs as ke,Fragment as Qa}from"preact/jsx-runtime";function Ur({ExtendedMenu:e}){let i=Ba(!0);qa(()=>{i.value=Ea()??!0},[]);let r=Ma(()=>{i.value=!i.value,Za(i.value)},[]);return ke(Qa,{children:[ke(Pr,{children:[ke(We,{className:p.menuItem,hotkey:[ce.CONTROL,ce.D1],children:[H("img",{className:Ae(p.checkIcon,{[p.checked]:!1}),src:le}),H(ve,{id:"gui.menubar.view.log",defaultMessage:"Log panel"})]}),ke(We,{className:p.menuItem,hotkey:[ce.CONTROL,ce.D2],children:[H("img",{className:Ae(p.checkIcon,{[p.checked]:!1}),src:le}),H(ve,{id:"gui.menubar.view.serial",defaultMessage:"Serial panel"})]}),ke(We,{disabled:!0,className:p.menuItem,hotkey:[ce.CONTROL,ce.D3],children:[H("img",{className:Ae(p.checkIcon,{[p.checked]:!1}),src:le}),H(ve,{id:"gui.menubar.view.files",defaultMessage:"Files panel"})]})]}),e&&H(e,{itemClassName:p.menuItem}),H(Pr,{children:H(We,{className:Ae(p.menuItem,p.blankCheckItem),label:i.value?H(ve,{id:"gui.menubar.view.closeAutoDisplayPanel",defaultMessage:"Turn off auto display panel"}):H(ve,{id:"gui.menubar.view.openAutoDisplayPanel",defaultMessage:"Turn on auto display panel"}),onClick:r})})]})}var Hr="./assets/icon-file-egaz1kfx.svg";var Xr="./assets/icon-edit-jejnm7yb.svg";var Tr="./assets/icon-view-c3skbdpn.svg";import{jsx as ue}from"preact/jsx-runtime";function zr(e,i,r){let t=(c)=>r(c,i.editor),n=e.menuItems?.find((c)=>c.id==="file"),a=e.menuItems?.find((c)=>c.id==="edit"),o=e.menuItems?.find((c)=>c.id==="view"),l=async()=>{let c=JSON.parse(JSON.stringify(await e.onNew()));if(!c.meta)c.meta=i;if(!c.meta.editor)c.meta.editor=i.editor,c.meta.version=i.version;t(c,i.editor)};return[{icon:Hr,label:ue(Ke,{id:"gui.menubar.file",defaultMessage:"File"}),Menu:()=>ue(Wr,{ExtendedMenu:n?.Menu,onNew:l,onOpen:t,onSave:e.onSave,onThumb:e.onThumb})},{icon:Xr,label:ue(Ke,{id:"gui.menubar.edit",defaultMessage:"Edit"}),Menu:()=>ue(Rr,{enableCoding:a?.disabledCoding!==!0,ExtendedMenu:a?.Menu,onUndo:e.onUndo,onRedo:e.onRedo,onEnableUndo:e.onEnableUndo,onEnableRedo:e.onEnableRedo})},o?.disabled!==!0&&{icon:Tr,label:ue(Ke,{id:"gui.menubar.view",defaultMessage:"View"}),Menu:()=>ue(Ur,{ExtendedMenu:o?.Menu})}].concat(e.menuItems?.filter((c)=>!["file","edit","view"].includes(c.id))??[]).filter(Boolean)}import{Text as he}from"@blockcode/core";import{classNames as Wa}from"@blockcode/utils";import{maybeTranslate as xa,Button as Nr}from"@blockcode/core";w(".lkaaPa_alerts-wrapper{width:100%;z-index:var(--z-index-alerts);top:calc(var(--menu-bar-height) + var(--space));pointer-events:none;flex-direction:column;justify-content:center;align-items:center;display:flex;position:absolute}.lkaaPa_alert-wrapper{pointer-events:all;background:var(--ui-light);border:1px solid var(--blocks-tertiary);min-width:200px;max-width:548px;min-height:1.5rem;box-shadow:0px 0px 0px 2px var(--ui-light);border-radius:.5rem;flex-direction:row;justify-content:flex-start;align-items:center;margin-bottom:7px;padding:.875rem 1rem;display:flex;overflow:hidden}.lkaaPa_warn{border:1px solid var(--error-primary)}.lkaaPa_icon{min-width:1.25rem;min-height:1.25rem;padding-right:1rem;display:flex}.lkaaPa_message{justify-content:flex-end;align-items:center;padding-right:.5rem;font-size:.8125rem;font-weight:700;line-height:.875rem;display:flex}.lkaaPa_warn .lkaaPa_message{color:var(--error-secondary)}.lkaaPa_success .lkaaPa_message{color:#555}.lkaaPa_button{color:var(--ui-white);margin-left:var(--space);padding:var(--space)calc(var(--space)*2.5);background:#ff8c1a;border:#ff8c1a}.lkaaPa_close-button{width:1.75rem;height:1.75rem;margin-left:calc(var(--space)*2);background:#ff861433;border:0;border-radius:50%;padding:0;transition:all .15s ease-out;box-shadow:0 0 0 2px #ff861433}.lkaaPa_close-button:hover{transform:scale(1.1);box-shadow:0 0 0 4px #ff861433}.lkaaPa_close-button img{margin:0 auto}");var V={success:"lkaaPa_success",message:"lkaaPa_message",alertsWrapper:"lkaaPa_alerts-wrapper",closeButton:"lkaaPa_close-button",button:"lkaaPa_button",alertWrapper:"lkaaPa_alert-wrapper",warn:"lkaaPa_warn",icon:"lkaaPa_icon"};var Or="./assets/icon-close-bazpdng8.svg";import{jsx as me,jsxs as Ia}from"preact/jsx-runtime";function Vr({mode:e,icon:i,message:r,options:t,button:n,onClose:a}){return Ia("div",{className:Wa(V.alertWrapper,{[V.success]:e==="success",[V.warn]:e==="warn"}),children:[me("div",{className:V.icon,children:typeof i==="string"?me("img",{src:i}):i}),me("div",{className:V.message,children:xa(r,t)}),n&&me(Nr,{className:V.button,onClick:n.onClick,children:n.label}),a&&me(Nr,{className:V.closeButton,onClick:a,children:me("img",{src:Or})})]})}import{jsx as Jr}from"preact/jsx-runtime";function Gr({items:e}){return Jr("div",{className:V.alertsWrapper,children:e.map(({id:i,mode:r,icon:t,message:n,button:a,onClose:o,...l})=>Jr(Vr,{mode:r??"success",icon:t,message:n,options:l,button:a,onClose:o},i))})}import{useCallback as Sa}from"preact/hooks";import{useSignal as Ra}from"@preact/signals";import{classNames as xe}from"@blockcode/utils";import{Text as _e,Button as Kr,Modal as Pa}from"@blockcode/core";w(".Zq10BW_prompt-modal{width:480px}.Zq10BW_prompt-header{background:var(--blocks-primary)}.Zq10BW_prompt-content{background:var(--ui-white)}.Zq10BW_device-list{background:var(--theme-light-transparent);width:100%;height:170px;padding:.5rem;overflow-y:auto}.Zq10BW_device-search{justify-content:center;align-items:center;width:100%;height:100%;display:flex}.Zq10BW_device-search-icon{width:120px;height:120px}@keyframes Zq10BW_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.Zq10BW_device-searching-icon{animation:1.5s linear infinite Zq10BW_spin}.Zq10BW_device-item{background:var(--ui-white);border-radius:calc(var(--space)/2);border:2px solid var(--ui-white);flex-direction:row;justify-content:space-between;align-items:center;width:100%;height:50px;margin-bottom:.5rem;padding:10px;display:flex}.Zq10BW_device-item.Zq10BW_selected{border:2px solid var(--theme-primary)}.Zq10BW_device-name-bar{align-items:center;display:flex}.Zq10BW_device-image{width:40px;margin-right:.5rem}.Zq10BW_device-name-wrapper{flex-direction:column;justify-content:center;align-items:flex-start;display:flex}.Zq10BW_device-name-label{font-size:.625rem;font-weight:700}.Zq10BW_device-name-text{font-size:.875rem}.Zq10BW_button-row{text-align:right;text-align:center;padding:1.5rem 2.25rem;font-weight:bolder}.Zq10BW_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}.Zq10BW_ok-button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);margin-left:var(--space)}");var Z={promptModal:"Zq10BW_prompt-modal",deviceNameText:"Zq10BW_device-name-text",buttonRow:"Zq10BW_button-row",deviceSearch:"Zq10BW_device-search",deviceNameLabel:"Zq10BW_device-name-label",deviceSearchingIcon:"Zq10BW_device-searching-icon",deviceImage:"Zq10BW_device-image",button:"Zq10BW_button",deviceSearchIcon:"Zq10BW_device-search-icon",deviceItem:"Zq10BW_device-item",promptHeader:"Zq10BW_prompt-header",okButton:"Zq10BW_ok-button",spin:"Zq10BW_spin",deviceList:"Zq10BW_device-list",deviceNameWrapper:"Zq10BW_device-name-wrapper",selected:"Zq10BW_selected",deviceNameBar:"Zq10BW_device-name-bar",promptContent:"Zq10BW_prompt-content"};var Yr="./assets/searching-tt57cegv.png";import{jsx as L,jsxs as Ie}from"preact/jsx-runtime";function jr({title:e,icon:i,devices:r,onClose:t,onSearch:n,onConnect:a}){let o=Ra(""),l=Sa(()=>{if(!o.value)return;a(o.value),o.value=""},[a]);return L(Pa,{title:e??L(_e,{id:"gui.connection.device",defaultMessage:"Device"}),className:Z.promptModal,headerClassName:Z.header,onClose:t,children:Ie("div",{className:Z.promptContent,children:[L("div",{className:Z.deviceList,children:Array.isArray(r)&&r.length>0?r.map((c)=>Ie("div",{className:xe(Z.deviceItem,{[Z.selected]:c.id===o.value}),onClick:()=>o.value=c.id,children:[Ie("div",{className:Z.deviceNameBar,children:[i&&L("img",{}),Ie("div",{className:Z.deviceNameWrapper,children:[L("div",{className:Z.deviceNameLabel,children:L(_e,{id:"gui.connection.deviceName",defaultMessage:"Device name"})}),L("div",{className:Z.deviceNameText,children:c.name})]})]}),c.rssi&&L("div",{className:Z.deviceSignalBar})]})):L("div",{className:Z.deviceSearch,children:L("img",{className:xe(Z.deviceSearchIcon,{[Z.deviceSearchingIcon]:Array.isArray(r)}),src:Yr})})}),L("div",{className:Z.buttonRow,children:r===!0?L(Kr,{className:xe(Z.button,Z.okButton),onClick:()=>n(),children:L(_e,{id:"gui.connection.search",defaultMessage:"Start Searching"})}):L(Kr,{disabled:!o.value,className:xe(Z.button,Z.okButton),onClick:l,children:!o.value?L(_e,{id:"gui.connection.searching",defaultMessage:"Searching"}):L(_e,{id:"gui.connection.connect",defaultMessage:"Start Connecting"})})})]})})}import{useEffect as ot,useCallback as Ce}from"preact/hooks";import{batch as lt,useSignal as Se,useSignalEffect as ct}from"@preact/signals";import{classNames as qe,getProjectsThumbs as ut,getProject as mt,cloneProject as gt,renameProject as pt,delProject as dt,openProjectFromURL as st}from"@blockcode/utils";import{maybeTranslate as tr,setAlert as ht,delAlert as ft,openPromptModal as nr,openUserStorage as bt}from"@blockcode/core";var je="1.2.0";import{Text as F,ContextMenu as vt,LibraryItem as or}from"@blockcode/core";import{useEffect as Ha}from"preact/hooks";import{useSignal as Xa}from"@preact/signals";import{classNames as ei}from"@blockcode/utils";import{Button as Ta}from"@blockcode/core";w(".tyiNqW_cover-wrapper{width:100%;position:relative}.tyiNqW_cover{opacity:1;background-position:50%;background-repeat:no-repeat;background-size:cover;flex-direction:row;justify-content:space-between;align-items:center;width:100%;height:100%;padding:0 2rem;transition:opacity 1s;display:flex;position:absolute;top:0;left:0}.tyiNqW_cover.tyiNqW_hidden{opacity:0;pointer-events:none}.tyiNqW_title{color:#000;padding-right:1.5rem;font-size:2rem;font-weight:600}.tyiNqW_button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);margin-top:calc(2*var(--space));padding:.75rem 1rem;font-size:.85rem;font-weight:600}.tyiNqW_feature{max-height:90%;margin-right:5%}");var ae={hidden:"tyiNqW_hidden",feature:"tyiNqW_feature",cover:"tyiNqW_cover",title:"tyiNqW_title",coverWrapper:"tyiNqW_cover-wrapper",button:"tyiNqW_button"};import{jsx as De,jsxs as ri}from"preact/jsx-runtime";function ii({pages:e,className:i}){let r=Xa(0);return Ha(()=>{setInterval(()=>r.value=(r.value+1)%e.length,7000)},[]),De("div",{className:ei(ae.coverWrapper,i),children:e.map((t,n)=>ri("div",{className:ei(ae.cover,{[ae.hidden]:n!==r.value}),style:{backgroundImage:`url(${t.backgroundImage})`},children:[ri("div",{children:[De("div",{className:ae.title,children:t.title}),De(Ta,{className:ae.button,onClick:t.onClick,children:t.buttonText})]}),De("img",{className:ae.feature,src:t.featureImage})]},n))})}w("._9IQa7q_home-wrapper{background:var(--ui-secondary);top:var(--menu-bar-height);width:100%;height:calc(100% - var(--menu-bar-height));z-index:calc(var(--z-index-alerts) - 10);user-select:none;position:absolute;overflow:hidden auto}._9IQa7q_getting-started{height:240px;margin-bottom:1.5rem}._9IQa7q_link{cursor:pointer;color:var(--theme-primary)}._9IQa7q_view-all{font-weight:400;font-size:var(--standard-font-size);margin-left:1.5rem}._9IQa7q_delete-menu-item:hover{background:var(--error-primary)}._9IQa7q_footer{color:var(--text-primary);font-size:var(--small-font-size);padding:3.5rem 0 var(--space);text-align:center}._9IQa7q_footer-item{padding:0 var(--space)}._9IQa7q_footer-item:not(:first-child){border-left:1px solid var(--ui-black-transparent)}._9IQa7q_library-grid{background:var(--ui-secondary);flex-wrap:wrap;flex-grow:1;place-content:flex-start;align-items:flex-start;height:auto;padding:.5rem;display:flex;overflow-y:auto}._9IQa7q_library-label{color:var(--text-primary);padding:1.5rem calc(.5rem + var(--space)).5rem;font-weight:800}._9IQa7q_about-version-content{width:300px}._9IQa7q_about-version-row{margin:var(--space)0;justify-content:space-between;display:flex}");var y={footer:"_9IQa7q_footer",homeWrapper:"_9IQa7q_home-wrapper",libraryGrid:"_9IQa7q_library-grid",gettingStarted:"_9IQa7q_getting-started",aboutVersionContent:"_9IQa7q_about-version-content",viewAll:"_9IQa7q_view-all",libraryLabel:"_9IQa7q_library-label",deleteMenuItem:"_9IQa7q_delete-menu-item",aboutVersionRow:"_9IQa7q_about-version-row",link:"_9IQa7q_link",footerItem:"_9IQa7q_footer-item"};import{Text as ni}from"@blockcode/core";var ai="./assets/arcade-rd4cktbf.png";var ti="./assets/arcade-bg-fajmd34e.jpg";import{jsx as oi}from"preact/jsx-runtime";function er(e){return{title:oi(ni,{id:"gui.home.slideshow.arcade.title",defaultMessage:"The Tank War is coming! Join us! NOW!"}),backgroundImage:ti,featureImage:ai,buttonText:oi(ni,{id:"gui.home.slideshow.arcade.button",defaultMessage:"Play now"}),onClick:()=>e("@blockcode/gui-arcade")}}import{Text as ui}from"@blockcode/core";var li="./assets/desktop-s3hfwbpz.png";var ci="./assets/desktop-bg-pqrd17t9.jpg";import{jsx as mi}from"preact/jsx-runtime";var gi={title:mi(ui,{id:"gui.home.slideshow.desktop.title",defaultMessage:"The desktop application is here!"}),backgroundImage:ci,featureImage:li,buttonText:mi(ui,{id:"gui.home.slideshow.desktop.button",defaultMessage:"Download"}),onClick:()=>window.open("//app.blockcode.fun/#/?id=download")};function rr(e,i){return[gi,er(e)]}async function ir(e){let i=await fetch("https://hub.blockcode.fun/home.json").then((r)=>r.json());return Promise.all(i.filter((r)=>r.editor?e.find((t)=>t.id===r.editor):!0).map(async(r)=>{let t=e.find((a)=>a.id===r.editor),n=await fetch(`https://hub.blockcode.fun/${r.import}`).then((a)=>a.json());return{name:t?.name,examples:n.filter((a)=>e.find((o)=>o.id===a.editor)).map((a)=>({...a,file:`https://hub.blockcode.fun/${a.file}`,thumb:`https://hub.blockcode.fun/${a.thumb}`}))}}))}function J(e){if(typeof e!=="string")throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function pi(e,i){var r="",t=0,n=-1,a=0,o;for(var l=0;l<=e.length;++l){if(l<e.length)o=e.charCodeAt(l);else if(o===47)break;else o=47;if(o===47){if(n===l-1||a===1);else if(n!==l-1&&a===2){if(r.length<2||t!==2||r.charCodeAt(r.length-1)!==46||r.charCodeAt(r.length-2)!==46){if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){if(c===-1)r="",t=0;else r=r.slice(0,c),t=r.length-1-r.lastIndexOf("/");n=l,a=0;continue}}else if(r.length===2||r.length===1){r="",t=0,n=l,a=0;continue}}if(i){if(r.length>0)r+="/..";else r="..";t=2}}else{if(r.length>0)r+="/"+e.slice(n+1,l);else r=e.slice(n+1,l);t=l-n-1}n=l,a=0}else if(o===46&&a!==-1)++a;else a=-1}return r}function Ja(e,i){var r=i.dir||i.root,t=i.base||(i.name||"")+(i.ext||"");if(!r)return t;if(r===i.root)return r+t;return r+e+t}function we(){var e="",i=!1,r;for(var t=arguments.length-1;t>=-1&&!i;t--){var n;if(t>=0)n=arguments[t];else{if(r===void 0)r=process.cwd();n=r}if(J(n),n.length===0)continue;e=n+"/"+e,i=n.charCodeAt(0)===47}if(e=pi(e,!i),i)if(e.length>0)return"/"+e;else return"/";else if(e.length>0)return e;else return"."}function di(e){if(J(e),e.length===0)return".";var i=e.charCodeAt(0)===47,r=e.charCodeAt(e.length-1)===47;if(e=pi(e,!i),e.length===0&&!i)e=".";if(e.length>0&&r)e+="/";if(i)return"/"+e;return e}function Ga(e){return J(e),e.length>0&&e.charCodeAt(0)===47}function Ya(){if(arguments.length===0)return".";var e;for(var i=0;i<arguments.length;++i){var r=arguments[i];if(J(r),r.length>0)if(e===void 0)e=r;else e+="/"+r}if(e===void 0)return".";return di(e)}function Ka(e,i){if(J(e),J(i),e===i)return"";if(e=we(e),i=we(i),e===i)return"";var r=1;for(;r<e.length;++r)if(e.charCodeAt(r)!==47)break;var t=e.length,n=t-r,a=1;for(;a<i.length;++a)if(i.charCodeAt(a)!==47)break;var o=i.length,l=o-a,c=n<l?n:l,u=-1,g=0;for(;g<=c;++g){if(g===c){if(l>c){if(i.charCodeAt(a+g)===47)return i.slice(a+g+1);else if(g===0)return i.slice(a+g)}else if(n>c){if(e.charCodeAt(r+g)===47)u=g;else if(g===0)u=0}break}var C=e.charCodeAt(r+g),f=i.charCodeAt(a+g);if(C!==f)break;else if(C===47)u=g}var b="";for(g=r+u+1;g<=t;++g)if(g===t||e.charCodeAt(g)===47)if(b.length===0)b+="..";else b+="/..";if(b.length>0)return b+i.slice(a+u);else{if(a+=u,i.charCodeAt(a)===47)++a;return i.slice(a)}}function ja(e){return e}function ar(e){if(J(e),e.length===0)return".";var i=e.charCodeAt(0),r=i===47,t=-1,n=!0;for(var a=e.length-1;a>=1;--a)if(i=e.charCodeAt(a),i===47){if(!n){t=a;break}}else n=!1;if(t===-1)return r?"/":".";if(r&&t===1)return"//";return e.slice(0,t)}function et(e,i){if(i!==void 0&&typeof i!=="string")throw TypeError('"ext" argument must be a string');J(e);var r=0,t=-1,n=!0,a;if(i!==void 0&&i.length>0&&i.length<=e.length){if(i.length===e.length&&i===e)return"";var o=i.length-1,l=-1;for(a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(c===47){if(!n){r=a+1;break}}else{if(l===-1)n=!1,l=a+1;if(o>=0)if(c===i.charCodeAt(o)){if(--o===-1)t=a}else o=-1,t=l}}if(r===t)t=l;else if(t===-1)t=e.length;return e.slice(r,t)}else{for(a=e.length-1;a>=0;--a)if(e.charCodeAt(a)===47){if(!n){r=a+1;break}}else if(t===-1)n=!1,t=a+1;if(t===-1)return"";return e.slice(r,t)}}function rt(e){J(e);var i=-1,r=0,t=-1,n=!0,a=0;for(var o=e.length-1;o>=0;--o){var l=e.charCodeAt(o);if(l===47){if(!n){r=o+1;break}continue}if(t===-1)n=!1,t=o+1;if(l===46){if(i===-1)i=o;else if(a!==1)a=1}else if(i!==-1)a=-1}if(i===-1||t===-1||a===0||a===1&&i===t-1&&i===r+1)return"";return e.slice(i,t)}function it(e){if(e===null||typeof e!=="object")throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return Ja("/",e)}function at(e){J(e);var i={root:"",dir:"",base:"",ext:"",name:""};if(e.length===0)return i;var r=e.charCodeAt(0),t=r===47,n;if(t)i.root="/",n=1;else n=0;var a=-1,o=0,l=-1,c=!0,u=e.length-1,g=0;for(;u>=n;--u){if(r=e.charCodeAt(u),r===47){if(!c){o=u+1;break}continue}if(l===-1)c=!1,l=u+1;if(r===46){if(a===-1)a=u;else if(g!==1)g=1}else if(a!==-1)g=-1}if(a===-1||l===-1||g===0||g===1&&a===l-1&&a===o+1){if(l!==-1)if(o===0&&t)i.base=i.name=e.slice(1,l);else i.base=i.name=e.slice(o,l)}else{if(o===0&&t)i.name=e.slice(1,a),i.base=e.slice(1,l);else i.name=e.slice(o,a),i.base=e.slice(o,l);i.ext=e.slice(a,l)}if(o>0)i.dir=e.slice(0,o-1);else if(t)i.dir="/";return i}var tt="/",nt=":",fl=((e)=>(e.posix=e,e))({resolve:we,normalize:di,isAbsolute:Ga,join:Ya,relative:Ka,_makeLong:ja,dirname:ar,basename:et,extname:rt,format:it,parse:at,sep:tt,delimiter:nt,win32:null,posix:null});function ye(){let e=window.electron?.getLocalEditors()??[];return Promise.all([].concat(Object.values(e).map(async(i)=>{let{default:r}=await import(i.info);return r.id=i.id,r.image=we(ar(i.info),r.image),r}),["@yeqin/gui-tankwar","@blockcode/gui-arcade2","@blockcode/gui-arcade","@blockcode/gui-microbit","@blockcode/gui-esp32","@blockcode/gui-arduino","@blockcode/gui-writer","@blockcode/gui-iotbit","@blockcode/gui-matrix"].map(async(i)=>{let{default:r}=await import(`${i}/info`);return r.id=i,r})))}import{jsx as h,jsxs as S,Fragment as lr}from"preact/jsx-runtime";function si({onOpenEditor:e,onOpenProject:i}){let r=Math.floor((document.body.clientWidth-20)/176),t=Math.floor((document.body.clientWidth-20)/236)*2,n=Se(null),a=Se(0),o=Se(null),l=Se(null),c=Ce(async()=>{let m=await ut();lt(()=>{a.value=m.length,n.value=m.filter((s,M)=>M<r)})},[]);ot(c,[]);let u=Ce((m,s)=>{nr({title:h(F,{id:"gui.library.projects.rename",defaultMessage:"rename"}),inputItems:[{key:"name",label:h(F,{id:"gui.menubar.titlePlaceholder",defaultMessage:"Project title here"}),defaultValue:tr(s??h(F,{id:"gui.project.shortname",defaultMessage:"Untitled"}))}],onSubmit:async(M)=>{if(M?.name)await pt(m,M.name),c()}})},[]),g=Ce(async(m)=>{await gt(m),c()},[]),C=Ce((m,s)=>{nr({title:h(F,{id:"gui.library.projects.delete",defaultMessage:"delete"}),label:h(F,{id:"gui.library.projects.deleteConfirm",defaultMessage:'Delect "{name}" project?',name:tr(s||h(F,{id:"gui.project.shortname",defaultMessage:"Untitled"}))}),onSubmit:async()=>{await dt(m),c()}})},[]),f=Ce((m)=>async()=>{let s=await mt(m);i(s)},[i]),b=()=>{return n.value?.map((m)=>h(vt,{menuItems:[[{label:h(F,{id:"gui.library.projects.rename",defaultMessage:"rename"}),onClick:()=>u(m.key,m.name)},{label:h(F,{id:"gui.library.projects.duplicate",defaultMessage:"duplicate"}),onClick:()=>g(m.key)}],[{label:h(F,{id:"gui.library.projects.delete",defaultMessage:"delete"}),className:y.deleteMenuItem,onClick:()=>C(m.key,m.name)}]],children:h(or,{id:m.key,name:m.name||h(F,{id:"gui.project.shortname",defaultMessage:"Untitled"}),image:m.thumb,onSelect:f(m.key)})},m.key))};return ct(async()=>{let m=await ye();m=m.map((s)=>Object.assign(s,{beta:s.beta||!1,disabled:s.disabled||!1,onSelect:()=>e(s.id)})),m=m.filter((s)=>{if(s.hidden)return!1;return!0}),o.value=m.sort((s,M)=>s.sortIndex-M.sortIndex),l.value=await ir(m)}),S("div",{className:y.homeWrapper,children:[h(ii,{className:y.gettingStarted,pages:rr(e,i)}),n.value?.length>0&&S(lr,{children:[S("div",{className:y.libraryLabel,children:[h("span",{children:h(F,{id:"gui.home.my",defaultMessage:"My projects"})}),a.value>r&&h("span",{className:qe(y.viewAll,y.link),onClick:bt,children:h(F,{id:"gui.home.allCounts",defaultMessage:"View all ({counts})",counts:a.value})})]}),h("div",{className:y.libraryGrid,children:h(b,{})})]}),o.value?.length>0&&S(lr,{children:[h("div",{className:y.libraryLabel,children:h(F,{id:"gui.home.new",defaultMessage:"Create new project"})}),h("div",{className:y.libraryGrid,children:o.value.map((m,s)=>h(or,{featured:!0,id:s,disabled:m.disabled,beta:m.beta||m.preview,image:m.image,name:m.name,description:m.description,collaborator:m.collaborator,blocksRequired:m.blocksRequired,micropythonRequired:m.micropythonRequired,clangRequired:m.clangRequired,onSelect:m.onSelect},s))})]}),l.value?.map((m)=>m.examples.length>0&&S(lr,{children:[S("div",{className:y.libraryLabel,children:[h("span",{children:h(F,{id:"gui.home.examples",defaultMessage:"Wonderful {label} examples",label:tr(m.name)})}),m.examples.length>t&&h("span",{className:qe(y.viewAll,y.link),children:h(F,{id:"gui.home.all",defaultMessage:"View all"})})]}),h("div",{className:y.libraryGrid,children:m.examples.map((s,M)=>h(or,{large:!0,id:M,name:s.name,author:s.author,copyright:s.copyright,image:s.thumb,onSelect:async()=>{ht("importing",{id:s.name});let Q=await st(s.file);ft(s.name),i(Q)}}))})]})),S("div",{className:y.footer,children:[h("span",{className:qe(y.footerItem,y.link),onClick:()=>window.open("https://lab.blockcode.fun/","_blank"),children:"BlockCode Lab"}),h("span",{className:qe(y.footerItem,y.link),onClick:()=>window.open("https://github.com/BlockCodeLab/playgrounds-app","_blank"),children:"GitHub"}),S("span",{className:qe(y.footerItem,y.link),onClick:()=>{nr({title:h(F,{id:"gui.about.title",defaultMessage:"About..."}),body:S("div",{className:y.aboutVersionContent,children:[S("div",{className:y.aboutVersionRow,children:[h("div",{children:h("b",{children:h(F,{id:"gui.about.main",defaultMessage:"Main program"})})}),S("div",{children:["v",je]})]}),h("div",{className:y.aboutVersionRow}),o.value.filter((m)=>!m.disabled).map((m)=>S("div",{className:y.aboutVersionRow,children:[h("div",{children:h("b",{children:m.name})}),S("div",{children:["v",m.version]})]}))]})})},children:["v",je]})]})]})}import{useEffect as Ht}from"preact/hooks";import{classNames as Be,isMac as Xt}from"@blockcode/utils";import{useLocalesContext as Tt,useAppContext as zt,setLanguage as Ot,translate as Mi,setMacosMenuBarStyled as Nt}from"@blockcode/core";import{Menu as Bi,MenuItem as Vt}from"@blockcode/core";import{cloneElement as qt}from"preact";import{useMemo as Mt}from"preact/hooks";import{flatChildren as Bt}from"@blockcode/utils";var hi=Object.create(null),cr=document.createElement("div"),fi=document.createElement("style");document.body.insertBefore(fi,document.body.firstChild);var kt=(e)=>{return cr.style="",Object.entries(e).forEach(([i,r])=>cr.style[i]=r),cr.style.cssText},_t=()=>{fi.textContent=Object.entries(hi).map(([e,i])=>`${e}{${kt(i)}}`).join(`
`)};function j(e){Object.assign(hi,e),_t()}import{Menu as Et}from"@blockcode/core";import{useCallback as ur}from"preact/hooks";import{classNames as wt}from"@blockcode/utils";import{jsx as bi,jsxs as Ct,Fragment as yt}from"preact/jsx-runtime";function Me({id:e,className:i,checked:r,children:t,name:n}){let a=ur((c)=>{let u=()=>{c.target.checked=!1,document.removeEventListener("click",u)};document.addEventListener("click",u)},[]),o=ur((c)=>{let u=c.getBoundingClientRect().left;j({[`#${e}-menu-${n}`]:{left:`${u}px`}})},[e,n]),l=ur((c)=>{if(c.target.classList.contains(p.menuLabel))o(c.target);else o(c.target.parentElement)},[]);return Ct(yt,{children:[bi("input",{checked:r,className:p.menuLabel,id:`${e}-label-${n}`,name:`${e}-menu`,type:"radio",value:n,onChange:a}),bi("label",{className:wt(p.menuLabel,i),for:`${e}-label-${n}`,onClick:l,children:t})]})}import{jsxs as Qt,Fragment as Zt}from"preact/jsx-runtime";function vi({id:e,children:i}){let r=Mt(()=>Bt(i).map((t)=>t&&qt(t,{id:e})),[e,i]);return Qt(Zt,{children:[r.filter((t)=>t.type===Me),r.filter((t)=>t.type===Et).map((t)=>{let n=`${e}-label-${t.props.name}`,a=`${e}-menu-${t.props.name}`;return j({[`#${n}:checked~#${a}`]:{display:"block"}}),t})]})}import{classNames as Ft}from"@blockcode/utils";import{Text as Lt}from"@blockcode/core";var Re="./assets/icon-tutorials-bh6n0ck2.svg";import{jsx as mr,jsxs as ki,Fragment as At}from"preact/jsx-runtime";function _i({onClick:e}){return ki(At,{children:[mr("div",{className:p.divider}),ki("div",{className:Ft(p.menuBarItem,p.menuLabel,p.hoverable),onClick:e,children:[mr("img",{className:p.tutorialsIcon,src:Re}),mr(Lt,{id:"gui.menubar.tutorials",defaultMessage:"Tutorials"})]})]})}import{useProjectContext as Wt,BufferedInput as xt,renameProject as It}from"@blockcode/core";import{jsx as gr,jsxs as St,Fragment as Dt}from"preact/jsx-runtime";function wi({placeholder:e,defaultValue:i}){let{name:r}=Wt();return St(Dt,{children:[gr("div",{className:p.divider}),gr("div",{className:p.menuBarItem,children:gr(xt,{className:p.titleField,placeholder:e,value:r.value||i,onSubmit:It})})]})}var yi="./assets/icon-language-3wan1389.svg";var Ci="./assets/icon-dropdown-caret-y4j91xc6.svg";var qi="./assets/icon-home-jt8mdkv3.svg";import{jsx as P,jsxs as te,Fragment as Jt}from"preact/jsx-runtime";function Ei({className:e,showHomeButton:i,onRequestHome:r,onOpenTutorialLibrary:t}){let{language:n,languageNames:a}=Tt(),{menuItems:o,tutorials:l,macosMenuBarStyled:c}=zt();return Ht(()=>{window.electron?.onChangeFullscreen((u)=>Nt(Xt&&!u))},[]),te("div",{className:Be(p.menuBar,e),children:[te("div",{className:Be(p.mainMenu,{[p.electron]:c.value}),children:[te(vi,{id:p.mainMenu,children:[te(Me,{className:Be(p.menuBarItem,p.languageLabel),name:"language-selector",children:[P("img",{className:p.languageIcon,src:yi}),P("img",{src:Ci})]}),P(Bi,{className:p.menu,name:"language-selector",children:Array.from(a.entries()).map(([u,g])=>te(Vt,{className:p.menuItem,onClick:()=>Ot(u),children:[P("img",{className:Be(p.checkIcon,{[p.checked]:n.value===u}),src:le}),g.languageName]},u))}),o.value&&o.value.map(({icon:u,label:g,Menu:C},f)=>te(Jt,{children:[te(Me,{className:p.menuBarItem,name:f,children:[typeof u==="string"?P("img",{src:u}):u,g]},f),P(Bi,{className:p.menu,name:f,children:P(C,{itemClassName:p.menuItem})},f)]}))]}),l.value&&P(_i,{onClick:t}),i&&P(wi,{placeholder:Mi("gui.menubar.titlePlaceholder","Project title here"),defaultValue:Mi("gui.project.name","BlockCode Project")})]}),P("div",{className:p.rightMenu,children:i&&P("div",{className:Be(p.menuBarItem,p.hoverable),onClick:r,children:P("img",{className:p.homeIcon,src:qi})})})]})}import{classNames as Gt}from"@blockcode/utils";w(".mS9Hoa_pane-wrapper{flex-direction:column;display:flex;position:relative}.mS9Hoa_pane{display:none}.mS9Hoa_pane-header{background:var(--ui-white);padding:calc(var(--space)/2);text-align:center;color:var(--text-primary);cursor:pointer;border:1px solid var(--ui-black-transparent);border-radius:var(--space)var(--space)0 0;flex:1;font-size:.85rem}.mS9Hoa_pane-left .mS9Hoa_pane-header{border-top-left-radius:0}.mS9Hoa_pane-right .mS9Hoa_pane-header{border-top-right-radius:0}.mS9Hoa_pane-content{border-left:1px solid var(--ui-black-transparent);border-right:1px solid var(--ui-black-transparent);min-height:5.5rem;display:none;position:relative}.mS9Hoa_pane-left .mS9Hoa_pane-content{border-left:0}.mS9Hoa_pane-right .mS9Hoa_pane-content{border-right:0}.mS9Hoa_pane:checked~.mS9Hoa_pane-content{display:flex}");var ne={paneWrapper:"mS9Hoa_pane-wrapper",paneRight:"mS9Hoa_pane-right",paneLeft:"mS9Hoa_pane-left",pane:"mS9Hoa_pane",paneContent:"mS9Hoa_pane-content",paneHeader:"mS9Hoa_pane-header"};import{jsx as pr,jsxs as Yt}from"preact/jsx-runtime";function Zi({className:e,id:i,title:r,left:t,right:n,children:a}){return Yt("div",{className:Gt(ne.paneWrapper,e,{[ne.paneLeft]:t,[ne.paneRight]:n}),children:[pr("input",{id:`${i}-pane`,type:"checkbox",className:ne.pane}),pr("label",{className:ne.paneHeader,for:`${i}-pane`,children:r}),pr("div",{className:ne.paneContent,children:a})]})}import{classNames as Qi}from"@blockcode/utils";import{maybeTranslate as Kt,Text as dr,Button as sr,Modal as jt}from"@blockcode/core";w(".ulcaFG_prompt-modal{width:360px}.ulcaFG_prompt-modal.ulcaFG_wide{width:600px}.ulcaFG_prompt-modal.ulcaFG_auto{width:auto;max-width:60vw}.ulcaFG_prompt-content{background:var(--ui-white);padding:1.5rem 2.25rem}.ulcaFG_label{margin:0 0 1.5rem;font-weight:500}.ulcaFG_label.ulcaFG_input-label{margin-bottom:.75rem}.ulcaFG_content{font-size:var(--standard-font-size);color:var(--text-primary);max-height:400px;margin-bottom:1.5rem;overflow:auto}.ulcaFG_content a{color:var(--theme-primary);border-bottom:1px solid;text-decoration-line:none}.ulcaFG_text-input{border:1px solid var(--ui-black-transparent);width:100%;height:3rem;color:var(--text-primary);border-radius:5px;margin-bottom:1.5rem;padding:0 1rem;font-size:.875rem}.ulcaFG_button-row{text-align:right;font-weight:bolder}.ulcaFG_button{padding:.75rem 1rem;font-size:.85rem;font-weight:600}.ulcaFG_ok-button{background:var(--theme-primary);border:var(--theme-primary);color:var(--ui-white);margin-left:var(--space)}");var q={content:"ulcaFG_content",wide:"ulcaFG_wide",auto:"ulcaFG_auto",promptContent:"ulcaFG_prompt-content",promptModal:"ulcaFG_prompt-modal",textInput:"ulcaFG_text-input",inputLabel:"ulcaFG_input-label",buttonRow:"ulcaFG_button-row",button:"ulcaFG_button",okButton:"ulcaFG_ok-button",label:"ulcaFG_label"};import{useCallback as en}from"preact/hooks";import{jsx as X,jsxs as $i,Fragment as rn}from"preact/jsx-runtime";function Fi({title:e,label:i,content:r,redStyle:t,children:n,onClose:a,onSubmit:o}){let l=en(()=>{o(),a()},[a,o]);return X(jt,{title:e,redStyle:t,className:Qi(q.promptModal,{[q.wide]:r,[q.auto]:n}),onClose:a,children:$i("div",{className:q.promptContent,children:[i&&X("div",{className:q.label,children:i}),r?X("div",{className:q.content,dangerouslySetInnerHTML:{__html:Kt(r)}}):X("div",{className:q.content,children:n}),X("div",{className:q.buttonRow,children:o?$i(rn,{children:[X(sr,{className:q.button,onClick:a,children:X(dr,{id:"gui.prompt.cancel",defaultMessage:"Cancel"})}),X(sr,{className:Qi(q.button,q.okButton),onClick:l,children:X(dr,{id:"gui.prompt.ok",defaultMessage:"OK"})})]}):X(sr,{className:q.button,onClick:a,children:X(dr,{id:"gui.prompt.close",defaultMessage:"Close"})})})]})})}import{useCallback as hr,useEffect as an}from"preact/hooks";import{useSignal as tn}from"@preact/signals";import{classNames as Li}from"@blockcode/utils";import{maybeTranslate as Ai,Text as Wi,BufferedInput as nn,Button as xi,Modal as on}from"@blockcode/core";import{jsx as ee,jsxs as fr,Fragment as ln}from"preact/jsx-runtime";function Ii({title:e,inputItems:i,content:r,onClose:t,onSubmit:n}){let a=tn(Object.fromEntries(i.map(({name:u,defaultValue:g})=>[u,g]))),o=hr((u)=>{if(u.stopPropagation(),u.key==="Escape")t()},[t]),l=hr(()=>{n(a.value),t()},[t,n]),c=hr((u)=>(g)=>{a.value={...a.value,[u]:g}},[]);return an(()=>{return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[]),ee(on,{title:e,className:q.promptModal,onClose:t,children:fr("div",{className:q.promptContent,children:[i.map(({name:u,label:g,placeholder:C,defaultValue:f},b)=>fr(ln,{children:[g&&ee("div",{className:Li(q.label,q.inputLabel),children:g}),ee(nn,{autoFocus:b===0,className:q.textInput,placeholder:Ai(C),defaultValue:f,onSubmit:c(u)},b)]})),r&&ee("div",{className:q.content,dangerouslySetInnerHTML:{__html:Ai(r)}}),fr("div",{className:q.buttonRow,children:[ee(xi,{className:q.button,onClick:t,children:ee(Wi,{id:"gui.prompt.cancel",defaultMessage:"Cancel"})}),ee(xi,{className:Li(q.button,q.okButton),onClick:l,children:ee(Wi,{id:"gui.prompt.ok",defaultMessage:"OK"})})]})]})})}import{classNames as cn}from"@blockcode/utils";import{Text as br,Spinner as un}from"@blockcode/core";w(".LkfKFW_splash{background:var(--theme-primary);z-index:var(--z-index-modal);flex-direction:column;justify-content:center;align-items:center;display:flex;position:absolute;inset:0}.LkfKFW_spinner{margin-bottom:calc(4*var(--space))}.LkfKFW_error{background:var(--error-primary)}.LkfKFW_title{color:var(--ui-white);margin:var(--space);font-size:2rem}.LkfKFW_label{color:var(--ui-white);margin:var(--space)}");var ge={error:"LkfKFW_error",title:"LkfKFW_title",splash:"LkfKFW_splash",label:"LkfKFW_label",spinner:"LkfKFW_spinner"};import{jsx as pe,jsxs as mn}from"preact/jsx-runtime";function Di({error:e}){return mn("div",{className:cn(ge.splash,{[ge.error]:e}),children:[!e&&pe(un,{large:!0,level:"info",className:ge.spinner}),pe("div",{className:ge.title,children:e?pe(br,{id:"gui.splash.errorTitle",defaultMessage:"Error Occurred"}):pe(br,{id:"gui.splash.loading",defaultMessage:"Loading project..."})}),pe("div",{className:ge.label,children:e&&pe(br,{id:"gui.splash.errorLabel",defaultMessage:"Please refresh the page and reopen it."})})]})}import{cloneElement as fn}from"preact";import{useMemo as bn}from"preact/hooks";import{classNames as vn,flatChildren as kn}from"@blockcode/utils";import{classNames as gn}from"@blockcode/utils";w(".M5TDuW_tabs-wrapper{white-space:nowrap;position:relative}.M5TDuW_tab-label{--line-height:calc(var(--tool-bar-height)*.8 - 2px);--margin-top:calc(var(--tool-bar-height)*.2 + 1px);font-weight:500;font-size:var(--standard-font-size);line-height:var(--line-height);border:1px solid var(--ui-black-transparent);background:var(--ui-tertiary);color:var(--text-transparent);margin-top:var(--margin-top);white-space:nowrap;border-radius:1rem 1rem 0 0;justify-content:center;padding:0 1.25rem;display:inline-flex;position:relative}.M5TDuW_tab-label.M5TDuW_disabled{filter:opacity(.5);cursor:default;pointer-events:none}.M5TDuW_tab-label:nth-of-type(n+2){margin-left:calc(-1*var(--space))}.M5TDuW_tab-label:last-of-type{margin-right:var(--space)}.M5TDuW_tab-label:not(.M5TDuW_disabled):hover{cursor:pointer;background:var(--ui-primary)}.M5TDuW_tab-label img{filter:grayscale();width:1.375rem}.M5TDuW_tab{display:none}.M5TDuW_tab:checked+.M5TDuW_tab-label{--scale:var(--space)/2;line-height:calc(var(--line-height) + var(--scale));margin-top:calc(var(--margin-top) - var(--scale));color:var(--theme-primary);background:var(--ui-white)}.M5TDuW_tab:checked+.M5TDuW_tab-label img{filter:none}.M5TDuW_tab-panel{top:var(--tool-bar-height);width:100%;height:calc(100% - var(--tool-bar-height));border:1px solid var(--ui-black-transparent);border-radius:0 var(--space)var(--space)var(--space);flex-direction:column;display:flex;position:absolute;bottom:0;transform:translateY(200%)}");var T={tabLabel:"M5TDuW_tab-label",disabled:"M5TDuW_disabled",tabsWrapper:"M5TDuW_tabs-wrapper",tab:"M5TDuW_tab",tabPanel:"M5TDuW_tab-panel"};import{jsx as Si,jsxs as dn,Fragment as pn}from"preact/jsx-runtime";function Pe({id:e,className:i,disabled:r,checked:t,children:n,name:a,onSelect:o}){return dn(pn,{children:[Si("input",{disabled:r,checked:t,className:T.tab,id:`${e}-tab-${a}`,name:`${e}-tab`,type:"radio",value:a}),Si("label",{className:gn(T.tabLabel,i,{[T.disabled]:r}),for:`${e}-tab-${a}`,onClick:o,children:n})]})}import{classNames as sn}from"@blockcode/utils";import{jsx as hn}from"preact/jsx-runtime";function Ue({id:e,className:i,name:r,children:t}){return hn("div",{className:sn(T.tabPanel,i),id:`${e}-panel-${r}`,children:t})}import{jsxs as _n}from"preact/jsx-runtime";function Ri({id:e,className:i,children:r}){let t=bn(()=>kn(r).filter((n)=>n).map((n)=>fn(n,{id:e})),[e,r]);return j({[`.${T.tab}:checked+.${T.tabLabel}`]:{zIndex:`${t.length+1}`}}),_n("div",{className:vn(T.tabsWrapper,i),children:[t.filter((n)=>n.type===Pe).map((n,a,o)=>{return j({[`.${T.tabLabel}:nth-of-type(${a+1})`]:{zIndex:`${o.length-a}`}}),n}),t.filter((n)=>n.type===Ue).map((n)=>{let a=`${e}-tab-${n.props.name}`,o=`${e}-panel-${n.props.name}`;return j({[`#${a}:checked~#${o}`]:{transform:"none"}}),n})]})}import{useRef as Mn,useEffect as Xi,useCallback as kr}from"preact/hooks";import{batch as Bn,useComputed as En,useSignal as _r}from"@preact/signals";import{classNames as Zn}from"@blockcode/utils";import{useAppContext as Qn,Text as de,Button as $n}from"@blockcode/core";w("._4EOxpW_tutorial-box-wrapper{pointer-events:auto;z-index:var(--z-index-card);min-width:468px;position:absolute;top:55%;left:50%;transform:translate(-50%)}._4EOxpW_tutorial-card{border:1px solid var(--ui-tertiary);border-radius:calc(var(--space)*1.8);cursor:move;box-shadow:0px 5px 25px 5px var(--ui-black-transparent);z-index:20;flex-direction:column;align-items:center;display:flex;overflow:hidden}._4EOxpW_card-header{background:var(--blocks-primary);width:100%;font-size:var(--small-font-size);flex-direction:row;justify-content:space-between;align-items:center;font-weight:700;display:flex}._4EOxpW_header-button-group{flex-direction:row;display:flex}._4EOxpW_header-button{cursor:pointer;color:#fff;flex-direction:column;justify-content:center;align-items:center;padding:.75rem;display:flex}._4EOxpW_header-button:hover{background:var(--ui-black-transparent)}._4EOxpW_button-icon{border:0;height:1.25rem}._4EOxpW_step-list{flex-direction:row;justify-content:center;align-items:center;display:flex}._4EOxpW_step-pip{cursor:pointer;background:var(--ui-white-transparent);border-radius:100%;width:.5rem;height:.5rem;margin:0 .25rem}._4EOxpW_step-pip._4EOxpW_actived{background:var(--ui-white);-webkit-box-shadow:0px 0px 0px 2px var(--ui-black-transparent);box-shadow:0px 0px 0px 2px var(--ui-black-transparent)}._4EOxpW_card-body{background:var(--ui-white);border-top:1px solid var(--blocks-tertiary);text-align:center;width:100%;min-height:256px;color:var(--text-primary);flex-direction:column;justify-content:center;align-items:center;display:flex;position:relative}._4EOxpW_title{text-align:center;margin:.9rem;font-size:.9rem;font-weight:700}._4EOxpW_image{object-fit:contain;background:var(--ui-secondary);border-radius:var(--space);max-width:450px;max-height:200px;margin:0 var(--space)var(--space);overflow:hidden}._4EOxpW_text{max-width:450px;height:200px;margin:0 var(--space)2.7rem var(--space);flex-direction:column;justify-content:center;font-size:1rem;display:flex}._4EOxpW_image+._4EOxpW_text{height:auto}._4EOxpW_more{padding:0 .9rem var(--space);flex-direction:row;justify-content:space-around;display:flex}._4EOxpW_more-item{margin:0 var(--space)var(--space);cursor:pointer;border-radius:var(--space);border:1px solid #00000026;flex-direction:column;display:flex;overflow:hidden}._4EOxpW_more-item-image{object-fit:cover;width:200px;height:100px}._4EOxpW_more-item-name{color:var(--theme-primary);margin:calc(var(--space)*1.2)0px;text-align:center;text-align:center;max-width:200px;font-size:.85rem;font-weight:700}._4EOxpW_see-more-button{background:var(--theme-primary);color:var(--ui-white);border:0;margin-bottom:2.7rem}._4EOxpW_left-page,._4EOxpW_right-page{background:var(--ui-white);border:1px solid var(--ui-black-transparent);height:90%;width:calc(var(--space)*1.8);opacity:.9;z-index:10;position:absolute;top:5%;overflow:hidden}._4EOxpW_left-page:after,._4EOxpW_right-page:after{content:\"\";background:var(--blocks-primary);width:100%;height:2.5rem;position:absolute;top:0;left:0}._4EOxpW_left-button,._4EOxpW_right-button{user-select:none;cursor:pointer;background:var(--blocks-primary);box-shadow:0 0 0 4px var(--blocks-transparent);z-index:30;border-radius:100%;justify-content:center;align-items:center;width:44px;height:44px;margin-top:-15px;transition:all .25s;display:flex;position:absolute;top:50%}._4EOxpW_left-button:hover,._4EOxpW_right-button:hover{box-shadow:0 0 0 6px var(--blocks-transparent);transform:scale(1.125)}._4EOxpW_left-button img,._4EOxpW_right-button img{width:1.75rem}._4EOxpW_left-page{border-top-left-radius:calc(var(--space)*1.8);border-bottom-left-radius:calc(var(--space)*1.8);border-right:0;left:0;transform:translate(-100%)}._4EOxpW_left-button{left:-27px}._4EOxpW_right-page{border-top-right-radius:calc(var(--space)*1.8);border-bottom-right-radius:calc(var(--space)*1.8);border-left:0;right:0;transform:translate(100%)}._4EOxpW_right-button{right:-27px}._4EOxpW_right-button img{transform:rotateY(180deg)}");var v={tutorialBoxWrapper:"_4EOxpW_tutorial-box-wrapper",tutorialCard:"_4EOxpW_tutorial-card",text:"_4EOxpW_text",headerButton:"_4EOxpW_header-button",stepList:"_4EOxpW_step-list",moreItemName:"_4EOxpW_more-item-name",moreItemImage:"_4EOxpW_more-item-image",seeMoreButton:"_4EOxpW_see-more-button",leftPage:"_4EOxpW_left-page",actived:"_4EOxpW_actived",more:"_4EOxpW_more",moreItem:"_4EOxpW_more-item",buttonIcon:"_4EOxpW_button-icon",headerButtonGroup:"_4EOxpW_header-button-group",rightPage:"_4EOxpW_right-page",leftButton:"_4EOxpW_left-button",cardHeader:"_4EOxpW_card-header",stepPip:"_4EOxpW_step-pip",title:"_4EOxpW_title",cardBody:"_4EOxpW_card-body",image:"_4EOxpW_image",rightButton:"_4EOxpW_right-button"};var Pi="./assets/icon-shrink-8vdqegra.svg";var Ui="./assets/icon-expand-67bgdn61.svg";var Hi="./assets/icon-close-dy7x7fdb.svg";var vr="./assets/icon-arrow-ddhj68kd.svg";import{jsx as _,jsxs as R,Fragment as Ee}from"preact/jsx-runtime";function Ti({tutorialId:e,onOpenTutorial:i,onBack:r,onClose:t}){let n=Mn(),{tutorials:a}=Qn(),o=_r(null),l=_r(-1),c=_r(!0),u=En(()=>o.value?.[l.value]),g=kr(()=>{l.value=(l.value+1)%o.value.length},[]),C=kr(()=>{l.value=(l.value-1)%o.value.length},[]);return Xi(()=>{let f=a.value.lessons[e];if(!f){t();return}Bn(()=>{o.value=[].concat(f.pages,f.next?{next:f.next.filter((b)=>a.value.lessons[b]).map((b)=>({id:b,title:a.value.lessons[b].title,image:a.value.lessons[b].image}))}:[]),l.value=0})},[e]),Xi(()=>{if(n.current){let f=n.current.parentElement,b,m,s=(Q)=>{let A=b-Q.clientX,re=m-Q.clientY;b=Q.clientX,m=Q.clientY,f.style.top=`${f.offsetTop-re}px`,f.style.left=`${f.offsetLeft-A}px`},M=()=>{document.removeEventListener("pointerup",M),document.removeEventListener("pointermove",s)};n.current.addEventListener("pointerdown",(Q)=>{b=Q.clientX,m=Q.clientY,document.addEventListener("pointerup",M),document.addEventListener("pointermove",s)})}},[n]),R("div",{className:v.tutorialBoxWrapper,children:[R("div",{ref:n,className:v.tutorialCard,children:[R("div",{className:v.cardHeader,children:[R("div",{className:v.headerButton,onClick:r,children:[_("img",{className:v.buttonIcon,src:Re}),_(de,{id:"gui.menubar.tutorials",defaultMessage:"Tutorials"})]}),_("div",{className:v.stepList,children:o.value?.map((f,b)=>_("div",{className:Zn(v.stepPip,{[v.actived]:b===l.value}),onClick:()=>l.value=b},b))}),R("div",{className:v.headerButtonGroup,children:[_("div",{className:v.headerButton,onClick:kr(()=>c.value=!c.value,[]),children:c.value?R(Ee,{children:[_("img",{className:v.buttonIcon,src:Pi}),_(de,{id:"gui.tutorials.shrink",defaultMessage:"Shrink"})]}):R(Ee,{children:[_("img",{className:v.buttonIcon,src:Ui}),_(de,{id:"gui.tutorials.expand",defaultMessage:"Expand"})]})}),R("div",{className:v.headerButton,onClick:t,children:[_("img",{className:v.buttonIcon,src:Hi}),_(de,{id:"gui.tutorials.close",defaultMessage:"Close"})]})]})]}),c.value&&u.value&&R("div",{className:v.cardBody,children:[(u.value.title||u.value.next)&&_("div",{className:v.title,children:u.value.title||_(de,{id:"gui.tutorials.moreTry",defaultMessage:"More things to try!"})}),u.value.image&&_("img",{className:v.image,src:u.value.image}),u.value.text&&_("div",{className:v.text,children:u.value.text}),u.value.next&&R(Ee,{children:[_("div",{className:v.more,children:u.value.next.map((f)=>R("div",{className:v.moreItem,onClick:()=>i(f.id),children:[_("img",{className:v.moreItemImage,src:f.image}),_("div",{className:v.moreItemName,children:f.title})]},f.id))}),_($n,{className:v.seeMoreButton,onClick:r,children:_(de,{id:"gui.tutorials.seeMore",defaultMessage:"See more"})})]})]})]}),c.value&&l.value>0&&R(Ee,{children:[_("div",{className:v.leftPage}),_("div",{className:v.leftButton,onClick:C,children:_("img",{src:vr})})]}),c.value&&o.value&&l.value<o.value.length-1&&R(Ee,{children:[_("div",{className:v.rightPage}),_("div",{className:v.rightButton,onClick:g,children:_("img",{src:vr})})]})]})}import{useComputed as Fn}from"@preact/signals";import{useAppContext as Ln,Text as An,Library as Wn}from"@blockcode/core";import{jsx as Oi}from"preact/jsx-runtime";var xn=Oi(An,{id:"gui.library.tutorials.tutorial",defaultMessage:"Choose a tutorial"});function zi({onOpenTutorial:e,onClose:i}){let{tutorials:r}=Ln(),t=Fn(()=>{return Object.entries(r.value.lessons).map(([a,o])=>({title:o.title,image:o.image,tags:o.tags,onSelect:()=>e(a)}))});return Oi(Wn,{featured:!0,items:t.value,title:r.value.title||xn,filterable:r.value.tags,tags:r.value.tags,onClose:i})}import{useCallback as Ze,useEffect as In}from"preact/hooks";import{useComputed as Dn,useSignal as Sn}from"@preact/signals";import{getProjectsThumbs as Rn,getProject as Pn,cloneProject as Un,renameProject as Hn,delProject as Xn}from"@blockcode/utils";import{useProjectContext as Tn,closeUserStorage as Vi,maybeTranslate as wr,openPromptModal as Ji}from"@blockcode/core";import{Text as z,Library as zn}from"@blockcode/core";w(".mLGZyG_delete-menu-item:hover{background:var(--error-primary)}");var Ni={deleteMenuItem:"mLGZyG_delete-menu-item"};import{jsx as U}from"preact/jsx-runtime";var On=30;function Gi({onOpenProject:e}){let{meta:i}=Tn(),r=Sn([]),t=Dn(()=>r.value.length),n=Ze((u,g)=>{Ji({title:U(z,{id:"gui.library.projects.rename",defaultMessage:"rename"}),inputItems:[{key:"name",label:U(z,{id:"gui.menubar.titlePlaceholder",defaultMessage:"Project title here"}),defaultValue:wr(g??U(z,{id:"gui.project.shortname",defaultMessage:"Untitled"}))}],onSubmit:async(C)=>{if(C?.name)await Hn(u,C.name),c()}})},[]),a=Ze(async(u)=>{await Un(u),c()},[]),o=Ze((u,g)=>{Ji({title:U(z,{id:"gui.library.projects.delete",defaultMessage:"delete"}),label:U(z,{id:"gui.library.projects.deleteConfirm",defaultMessage:'Delect "{name}" project?',name:wr(g||U(z,{id:"gui.project.shortname",defaultMessage:"Untitled"}))}),onSubmit:async()=>{await Xn(u),c()}})},[]),l=Ze((u)=>async()=>{let g=await Pn(u);e(g),Vi()},[]),c=Ze(async()=>{let u=await Rn();if(i.value?.editor)u=u.filter((g)=>g.meta.editor===i.value.editor);u=u.sort((g,C)=>C.modifiedDate-g.modifiedDate),r.value=u.map((g)=>({name:wr(g.name??U(z,{id:"gui.project.shortname",defaultMessage:"Untitled"})),image:g.thumb,onSelect:l(g.key),contextMenu:[[{label:U(z,{id:"gui.library.projects.rename",defaultMessage:"rename"}),onClick:()=>n(g.key,g.name)},{label:U(z,{id:"gui.library.projects.duplicate",defaultMessage:"duplicate"}),onClick:()=>a(g.key)}],[{label:U(z,{id:"gui.library.projects.delete",defaultMessage:"delete"}),className:Ni.deleteMenuItem,onClick:()=>o(g.key,g.name)}]]}))},[l,n,o]);return In(()=>c(),[c]),U(zn,{items:r.value,filterable:t.value>On,emptyMessage:U(z,{id:"gui.library.projects.empty",defaultMessage:"No project!"}),onClose:Vi})}w("._3HqakW_gui-wrapper{height:100%}._3HqakW_alerts-container{width:100%;z-index:var(--z-index-alerts);margin-top:calc(var(--menu-bar-height) + var(--space));pointer-events:none;justify-content:center;display:flex;position:absolute}._3HqakW_menu-bar-position{z-index:var(--z-index-menu-bar);position:relative}._3HqakW_body-wrapper{height:calc(100% - var(--menu-bar-height));background:var(--ui-primary)}._3HqakW_body-wrapper *{box-sizing:border-box}._3HqakW_workspace-wrapper{flex-direction:row;height:100%;display:flex;overflow-y:hidden}._3HqakW_sidebar-wrapper{margin:0 var(--space);display:flex;position:relative}._3HqakW_editor-wrapper{flex-direction:column;flex-grow:1;flex-shrink:0;display:flex;position:relative}._3HqakW_tabs-wrapper{flex-grow:1;position:relative}._3HqakW_tab-panel-no-left{border-bottom-left-radius:0}._3HqakW_tab-panel-no-right{border-top-right-radius:0;border-bottom-right-radius:0}._3HqakW_tab-panel-no-bottom{border-bottom-right-radius:0;border-bottom-left-radius:0}._3HqakW_pane-wrapper{margin:var(--space)0 0 0;display:flex;position:relative}");var I={menuBarPosition:"_3HqakW_menu-bar-position",paneWrapper:"_3HqakW_pane-wrapper",guiWrapper:"_3HqakW_gui-wrapper",alertsContainer:"_3HqakW_alerts-container",tabsWrapper:"_3HqakW_tabs-wrapper",tabPanelNoLeft:"_3HqakW_tab-panel-no-left",tabPanelNoRight:"_3HqakW_tab-panel-no-right",sidebarWrapper:"_3HqakW_sidebar-wrapper",bodyWrapper:"_3HqakW_body-wrapper",tabPanelNoBottom:"_3HqakW_tab-panel-no-bottom",editorWrapper:"_3HqakW_editor-wrapper",workspaceWrapper:"_3HqakW_workspace-wrapper"};import{jsx as k,jsxs as Qe,Fragment as ra}from"preact/jsx-runtime";var fe=Yn({Bluetooth:null,SerialPort:null});function ia(){let[e]=Nn(),{language:i}=eo(),r=jn();Yi(()=>{document.title=io("gui.name","BlockCode Playgrounds"),document.title+=" [BETA]"},[i.value]);let t,n;r.docks.value?.forEach((d)=>{if(d.expand==="left")t=d.Content;else n=d.Content});let a=r.panes.value?.[0].Content,o=Gn({[I.tabPanelNoLeft]:!t,[I.tabPanelNoRight]:!n,[I.tabPanelNoBottom]:!a}),l=He(null);Yi(()=>{if(yr)window.electron.serial.onScan((d)=>{l.value=d&&{devices:d,type:fe.SerialPort}}),window.electron.bluetooth.onScan((d)=>{l.value=d&&{devices:d,type:fe.Bluetooth}})},[]);let c=()=>{},u=O(()=>{if(yr){if(l.value.type===fe.SerialPort)window.electron.serial.cancel();if(l.value.type===fe.Bluetooth)window.electron.bluetooth.cancel();l.value=null}},[]),g=O((d)=>{if(yr){if(l.value.type===fe.SerialPort)window.electron.serial.connect(d);if(l.value.type===fe.Bluetooth)window.electron.bluetooth.connect(d)}},[]),C=He({});Jn(async()=>{let d=await ye();d=d.map((E)=>[E.id,{name:E.name,version:E.version}]),C.value=Object.fromEntries(d)});let f=O(()=>{se(()=>{r.appState.value?.device?.disconnect(),go("device",null),co(),oo()})},[]),b=O((d)=>{se(()=>{Ki(),lo(Object.assign(JSON.parse(JSON.stringify(d)),{fileId:d.fileId??d.files?.[0]?.id})),ea(0)})},[]),m=He(!1),s=He(null),M=O(()=>{se(()=>{s.value=null,m.value=!0})},[]),Q=O((d)=>{let E=r.tutorials.value.lessons[d];se(async()=>{if(E.project){uo("importing",{id:d});let D=await Kn(E.project);mo(d),b(D)}s.value=d,m.value=!1})},[]),{meta:A,key:re,modified:Te}=ro(),Cr=Vn(()=>!A.value),aa=O(()=>{if(Te.value)Xe({title:k(he,{id:"gui.library.projects.notSaved",defaultMessage:"Not saved"}),label:k(he,{id:"gui.library.projects.close",defaultMessage:"Close current project?"}),onSubmit:f});else f()},[]),ze=O((d,E)=>{if(E!==d.meta.editor){Xe({label:k(he,{id:"gui.library.projects.errorEditor",defaultMessage:'This project is not currently editor creation, please switch to "{editor}" and open it.',editor:ao(C.value[d.meta.editor]?.name)}),redStyle:!0});return}if(re.value===d.key)return;if(Te.value)Xe({title:k(he,{id:"gui.library.projects.notSaved",defaultMessage:"Not saved"}),label:k(he,{id:"gui.library.projects.replace",defaultMessage:"Replace contents of the current project?"}),onSubmit:()=>b(d)});else b(d)},[]),qr=O(async(d,E)=>{se(()=>{f(),Ki()});let D=d,Br=window.electron?.getLocalEditors();if(Br?.[d]?.main)D=Br[d].main;let ie;try{ie=(await import(D)).default}catch(vo){Xe({label:k(he,{id:"gui.library.projects.notFoundEditor",defaultMessage:'Not Found the "{editor}" Editor.',editor:d}),redStyle:!0}),to();return}let Oe={editor:d,version:C.value[d]?.version};if(!E)E=JSON.parse(JSON.stringify(await ie.onNew()));if(!E.meta)E.meta=Oe;if(!E.meta.editor)E.meta.editor=d,E.meta.version=Oe.version;let ta={menuItems:zr(ie,Oe,ze),tabs:ie.tabs,docks:ie.docks,panes:ie.panes,tutorials:window.electron?.getLocalTutorials(d,i.value)??ie.tutorials};se(()=>{no(ta),ze(E,d)})},[]),Mr=O((d)=>{if(A.value?.editor!==d.meta.editor){f(),qr(d.meta.editor,d);return}ze(d,A.value.editor)},[]);return Qe(ra,{children:[(r.splashVisible.value||e)&&k(Di,{error:e}),k(Gr,{items:r.alerts.value}),k(Ei,{className:I.menuBarPosition,showHomeButton:!Cr.value,onRequestHome:aa,onOpenTutorialLibrary:M}),k("div",{className:I.bodyWrapper,children:Qe("div",{className:I.workspaceWrapper,children:[t&&k("div",{className:I.sidebarWrapper,children:k(t,{})}),Qe("div",{className:I.editorWrapper,children:[k(Ri,{id:I.tabsWrapper,className:I.tabsWrapper,children:r.tabs.value?.map(({Content:d,...E},D)=>Qe(ra,{children:[Qe(Pe,{name:D,disabled:E.disabled,checked:D===r.tabIndex.value,onSelect:()=>ea(D),children:[k("img",{src:E.icon}),E.label]},D),k(Ue,{name:D,className:o,children:(D===0||r.tabIndex.value===D)&&d&&k(d,{})},D)]}))}),a&&k(Zi,{id:I.paneWrapper,className:I.paneWrapper,title:pane.label,right:!n,left:!t,children:k(a,{})})]}),n&&k("div",{className:I.sidebarWrapper,children:k(n,{})})]})}),l.value&&k(jr,{title:A.value.deviceName,icon:A.value.deviceIcon,devices:l.value.devices,onClose:u,onConnect:g}),s.value&&k(Ti,{tutorialId:s.value,onOpenTutorial:Q,onBack:M,onClose:()=>s.value=null}),m.value&&k(zi,{onOpenTutorial:Q,onClose:O(()=>m.value=!1,[])}),Cr.value&&k(si,{onOpenEditor:qr,onOpenProject:Mr}),r.userStorageVisible.value&&k(Gi,{onOpenProject:Mr}),r.prompt.value&&(r.prompt.value.inputItems?k(Ii,{title:r.prompt.value.title,content:r.prompt.value.content,inputItems:r.prompt.value.inputItems,onClose:ji,onSubmit:r.prompt.value.onSubmit}):k(Fi,{title:r.prompt.value.title,label:r.prompt.value.label,content:r.prompt.value.content,redStyle:r.prompt.value.redStyle,onClose:ji,onSubmit:r.prompt.value.onSubmit,children:r.prompt.value.body}))]})}import{addAlertConfig as W,Text as x,Spinner as oe}from"@blockcode/core";import{jsx as B}from"preact/jsx-runtime";W("importing",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.importing",defaultMessage:"Importing..."})});W("downloading",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.downloading",defaultMessage:"Downloading...{progress}%"})});W("downloadCompleted",{icon:null,message:B(x,{id:"gui.alert.downloadCompleted",defaultMessage:"Download completed."})});W("connecting",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.connecting",defaultMessage:"Connecting..."})});W("connected",{icon:null,message:B(x,{id:"gui.alert.connected",defaultMessage:"Connected."})});W("connectionCancel",{icon:null,mode:"warn",message:B(x,{id:"gui.alert.connectionCancel",defaultMessage:"Connection cancel."})});W("connectionError",{icon:null,mode:"warn",message:B(x,{id:"gui.alert.connectionError",defaultMessage:"Connection error or connection was lost."})});W("erasing",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.erasing",defaultMessage:"Erasing..."})});W("restoring",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.restoring",defaultMessage:"Firmware restoring...{progress}%"})});W("recovering",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.recovering",defaultMessage:"Recovering..."})});W("restoreCompleted",{icon:null,message:B(x,{id:"gui.alert.restoreCompleted",defaultMessage:"Firmware resotre completed! Now press RESET key"})});W("compiling",{icon:B(oe,{level:"success"}),message:B(x,{id:"gui.alert.compiling",defaultMessage:"Compiling..."})});W("compileCompleted",{icon:null,message:B(x,{id:"gui.alert.compileCompleted",defaultMessage:"Compilation completed."})});W("compileError",{icon:null,mode:"warn",message:B(x,{id:"gui.alert.compileError",defaultMessage:"Compilation error."})});W("reseting",{icon:null,message:B(x,{id:"gui.alert.reseting",defaultMessage:"Reseting..."})});import{jsx as $e}from"preact/jsx-runtime";function bo(){return $e(so,{children:$e(ho,{children:$e(fo,{children:$e(ia,{})})})})}po($e(bo,{}),document.getElementById("root"));
