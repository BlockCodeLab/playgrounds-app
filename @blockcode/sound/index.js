import{addLocalesMessages as Br}from"@blockcode/core";var Ce={"sound.sound":"Sound","sound.play":"Play","sound.record":"Record","sound.stop":"Stop","sound.name":"name","sound.contextMenu.export":"export","sound.contextMenu.delete":"delete","sound.actionButton.upload":"Upload Sound","sound.actionButton.surprise":"Surprise","sound.actionButton.record":"Record","sound.actionButton.sound":"Choose a Sound","sound.error.formatNotSupperted":"This wav format is not supported."};var fe={"sound.sound":"声音","sound.play":"播放","sound.record":"录音","sound.stop":"停止","sound.name":"名称","sound.contextMenu.export":"导出","sound.contextMenu.delete":"删除","sound.actionButton.upload":"上传声音","sound.actionButton.surprise":"随机","sound.actionButton.record":"录制","sound.actionButton.sound":"选择一个声音","sound.error.formatNotSupperted":"声音文件格式不支持。"};var We={"sound.sound":"聲音","sound.play":"播放","sound.record":"録音","sound.stop":"停止","sound.name":"名稱","sound.contextMenu.export":"導齣","sound.contextMenu.delete":"刪除","sound.actionButton.upload":"上傳聲音","sound.actionButton.surprise":"隨機","sound.actionButton.record":"録製","sound.actionButton.sound":"選擇一個聲音","sound.error.formatNotSupperted":"聲音文件格式不支持。"};Br({en:Ce,"zh-Hans":fe,"zh-Hant":We});var Se={};function Rr(t){return new Int8Array(t)}function He(t){return new Int16Array(t)}function Ee(t){return new Int32Array(t)}function Ie(t){return new Float32Array(t)}function Ar(t){return new Float64Array(t)}function _e(t){if(t.length==1)return Ie(t[0]);var e=t[0];t=t.slice(1);for(var d=[],W=0;W<e;W++)d.push(_e(t));return d}function Be(t){if(t.length==1)return Ee(t[0]);var e=t[0];t=t.slice(1);for(var d=[],W=0;W<e;W++)d.push(Be(t));return d}function Re(t){if(t.length==1)return He(t[0]);var e=t[0];t=t.slice(1);for(var d=[],W=0;W<e;W++)d.push(Re(t));return d}function Ae(t){if(t.length==1)return Array(t[0]);var e=t[0];t=t.slice(1);for(var d=[],W=0;W<e;W++)d.push(Ae(t));return d}var tr={};tr.fill=function(t,e,d,W){if(arguments.length==2)for(var Q=0;Q<t.length;Q++)t[Q]=arguments[1];else for(var Q=e;Q<d;Q++)t[Q]=W};var hn={};hn.arraycopy=function(t,e,d,W,Q){for(var j=e+Q;e<j;)d[W++]=t[e++]};hn.out={};hn.out.println=function(t){console.log(t)};hn.out.printf=function(){console.log.apply(console,arguments)};var fn={};fn.SQRT2=1.4142135623730951;fn.FAST_LOG10=function(t){return Math.log10(t)};fn.FAST_LOG10_X=function(t,e){return Math.log10(t)*e};function Zi(t){this.ordinal=t}Zi.short_block_allowed=new Zi(0);Zi.short_block_coupled=new Zi(1);Zi.short_block_dispensed=new Zi(2);Zi.short_block_forced=new Zi(3);var ir={};ir.MAX_VALUE=340282350000000000000000000000000000000;function gi(t){this.ordinal=t}gi.vbr_off=new gi(0);gi.vbr_mt=new gi(1);gi.vbr_rh=new gi(2);gi.vbr_abr=new gi(3);gi.vbr_mtrh=new gi(4);gi.vbr_default=gi.vbr_mtrh;var to=function(t){},Et={System:hn,VbrMode:gi,Float:ir,ShortBlock:Zi,Util:fn,Arrays:tr,new_array_n:Ae,new_byte:Rr,new_double:Ar,new_float:Ie,new_float_n:_e,new_int:Ee,new_int_n:Be,new_short:He,new_short_n:Re,assert:to},xn,Pe;function io(){if(Pe)return xn;Pe=1;var t=Et,e=t.System,d=t.Util,W=t.Arrays,Q=t.new_float,j=ri();function x(){var y=[-0.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,0.9063471690191471,0.1960342806591213,-0.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,0.8206787908286602,0.3901806440322567,-0.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,0.7416505462720353,0.5805693545089249,-0.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,0.6681786379192989,0.7653668647301797,-0.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,0.5993769336819237,0.9427934736519954,-0.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,0.5345111359507916,1.111140466039205,-0.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,0.4729647758913199,1.268786568327291,-0.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,0.41421356237309503,1.414213562373095,-0.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,0.3578057213145241,1.546020906725474,-0.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,0.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,0.3033466836073424,1.66293922460509,-0.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,0.2504869601913055,1.76384252869671,-0.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,0.198912367379658,1.847759065022573,-0.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,0.1483359875383474,1.913880671464418,-0.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,0.09849140335716425,1.961570560806461,-0.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,0.04912684976946725,1.990369453344394,0.035780907*d.SQRT2*0.5/0.000002384,0.017876148*d.SQRT2*0.5/0.000002384,0.003134727*d.SQRT2*0.5/0.000002384,0.002457142*d.SQRT2*0.5/0.000002384,0.000971317*d.SQRT2*0.5/0.000002384,0.000218868*d.SQRT2*0.5/0.000002384,0.000101566*d.SQRT2*0.5/0.000002384,0.000013828*d.SQRT2*0.5/0.000002384,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],U=12,R=36,p=[[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.000000000000940084909404969,0.0000000000006423305872147839,0.0000000000002382191739347918,0.000000000005456116108943412,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758252,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558783,0.0000000000008371015190102974,0.0000000000002599706096327376,-0.000000000005456116108943412,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758252,-0.000000000002858043359288076,-0.000000000002156177623817898,-0.000000000001475637723558783,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347923,-0.0000000000006423305872147843,-0.0000000000009400849094049696,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049694,-0.000000000000642330587214784,-0.0000000000002382191739347918],[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.0000000000009400849094049688,0.0000000000006423305872147841,0.0000000000002382191739347918,0.000000000005456116108943413,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758253,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558782,0.0000000000008371015190102975,0.0000000000002599706096327376,-0.000000000005461314069809755,-0.000000000004921085770524055,-0.000000000004343405037091838,-0.000000000003732668368707687,-0.000000000003093523840190885,-0.000000000002430835727329465,-0.000000000001734679010007751,-0.000000000000974825365660928,-0.0000000000002797435120168326,0,0,0,0,0,0,-0.0000000000002283748241799531,-0.0000000000004037858874020686,-0.0000000000002146547464825323],[0.1316524975873958,0.414213562373095,0.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,0.984807753012208,0.6427876096865394,0.3420201433256688,0.9396926207859084,-0.1736481776669303,-0.7660444431189779,0.8660254037844387,0.5,-0.5144957554275265,-0.4717319685649723,-0.3133774542039019,-0.1819131996109812,-0.09457419252642064,-0.04096558288530405,-0.01419856857247115,-0.003699974673760037,0.8574929257125442,0.8817419973177052,0.9496286491027329,0.9833145924917901,0.9955178160675857,0.9991605581781475,0.999899195244447,0.9999931550702802],[0,0,0,0,0,0,0.0000000000002283748241799531,0.0000000000004037858874020686,0.0000000000002146547464825323,0.000000000005461314069809755,0.000000000004921085770524055,0.000000000004343405037091838,0.000000000003732668368707687,0.000000000003093523840190885,0.000000000002430835727329466,0.000000000001734679010007751,0.000000000000974825365660928,0.0000000000002797435120168326,-0.000000000005456116108943413,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758253,-0.000000000002858043359288075,-0.000000000002156177623817898,-0.000000000001475637723558782,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347913,-0.0000000000006423305872147834,-0.0000000000009400849094049688,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049688,-0.0000000000006423305872147841,-0.0000000000002382191739347918]],l=p[j.SHORT_TYPE],Z=p[j.SHORT_TYPE],V=p[j.SHORT_TYPE],M=p[j.SHORT_TYPE],I=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function _(C,P,i){for(var c=10,Y=P+238-14-286,K=-15;K<0;K++){var q,$,b;q=y[c+-10],$=C[Y+-224]*q,b=C[P+224]*q,q=y[c+-9],$+=C[Y+-160]*q,b+=C[P+160]*q,q=y[c+-8],$+=C[Y+-96]*q,b+=C[P+96]*q,q=y[c+-7],$+=C[Y+-32]*q,b+=C[P+32]*q,q=y[c+-6],$+=C[Y+32]*q,b+=C[P+-32]*q,q=y[c+-5],$+=C[Y+96]*q,b+=C[P+-96]*q,q=y[c+-4],$+=C[Y+160]*q,b+=C[P+-160]*q,q=y[c+-3],$+=C[Y+224]*q,b+=C[P+-224]*q,q=y[c+-2],$+=C[P+-256]*q,b-=C[Y+256]*q,q=y[c+-1],$+=C[P+-192]*q,b-=C[Y+192]*q,q=y[c+0],$+=C[P+-128]*q,b-=C[Y+128]*q,q=y[c+1],$+=C[P+-64]*q,b-=C[Y+64]*q,q=y[c+2],$+=C[P+0]*q,b-=C[Y+0]*q,q=y[c+3],$+=C[P+64]*q,b-=C[Y+-64]*q,q=y[c+4],$+=C[P+128]*q,b-=C[Y+-128]*q,q=y[c+5],$+=C[P+192]*q,b-=C[Y+-192]*q,$*=y[c+6],q=b-$,i[30+K*2]=b+$,i[31+K*2]=y[c+7]*q,c+=18,P--,Y++}{var $,b,ht,D;b=C[P+-16]*y[c+-10],$=C[P+-32]*y[c+-2],b+=(C[P+-48]-C[P+16])*y[c+-9],$+=C[P+-96]*y[c+-1],b+=(C[P+-80]+C[P+48])*y[c+-8],$+=C[P+-160]*y[c+0],b+=(C[P+-112]-C[P+80])*y[c+-7],$+=C[P+-224]*y[c+1],b+=(C[P+-144]+C[P+112])*y[c+-6],$-=C[P+32]*y[c+2],b+=(C[P+-176]-C[P+144])*y[c+-5],$-=C[P+96]*y[c+3],b+=(C[P+-208]+C[P+176])*y[c+-4],$-=C[P+160]*y[c+4],b+=(C[P+-240]-C[P+208])*y[c+-3],$-=C[P+224],ht=$-b,D=$+b,b=i[14],$=i[15]-b,i[31]=D+b,i[30]=ht+$,i[15]=ht-$,i[14]=D-b}{var n;n=i[28]-i[0],i[0]+=i[28],i[28]=n*y[c+-36+7],n=i[29]-i[1],i[1]+=i[29],i[29]=n*y[c+-36+7],n=i[26]-i[2],i[2]+=i[26],i[26]=n*y[c+-72+7],n=i[27]-i[3],i[3]+=i[27],i[27]=n*y[c+-72+7],n=i[24]-i[4],i[4]+=i[24],i[24]=n*y[c+-108+7],n=i[25]-i[5],i[5]+=i[25],i[25]=n*y[c+-108+7],n=i[22]-i[6],i[6]+=i[22],i[22]=n*d.SQRT2,n=i[23]-i[7],i[7]+=i[23],i[23]=n*d.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],n=i[6],i[6]=i[31]-n,i[31]=i[31]+n,n=i[7],i[7]=i[30]-n,i[30]=i[30]+n,n=i[22],i[22]=i[15]-n,i[15]=i[15]+n,n=i[23],i[23]=i[14]-n,i[14]=i[14]+n,n=i[20]-i[8],i[8]+=i[20],i[20]=n*y[c+-180+7],n=i[21]-i[9],i[9]+=i[21],i[21]=n*y[c+-180+7],n=i[18]-i[10],i[10]+=i[18],i[18]=n*y[c+-216+7],n=i[19]-i[11],i[11]+=i[19],i[19]=n*y[c+-216+7],n=i[16]-i[12],i[12]+=i[16],i[16]=n*y[c+-252+7],n=i[17]-i[13],i[13]+=i[17],i[17]=n*y[c+-252+7],n=-i[20]+i[24],i[20]+=i[24],i[24]=n*y[c+-216+7],n=-i[21]+i[25],i[21]+=i[25],i[25]=n*y[c+-216+7],n=i[4]-i[8],i[4]+=i[8],i[8]=n*y[c+-216+7],n=i[5]-i[9],i[5]+=i[9],i[9]=n*y[c+-216+7],n=i[0]-i[12],i[0]+=i[12],i[12]=n*y[c+-72+7],n=i[1]-i[13],i[1]+=i[13],i[13]=n*y[c+-72+7],n=i[16]-i[28],i[16]+=i[28],i[28]=n*y[c+-72+7],n=-i[17]+i[29],i[17]+=i[29],i[29]=n*y[c+-72+7],n=d.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=n,n=d.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=n,n=d.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=n-i[18],n=d.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=n-i[19],n=i[2],i[19]-=i[3],i[3]-=n,i[2]=i[31]-n,i[31]+=n,n=i[3],i[11]-=i[19],i[18]-=n,i[3]=i[30]-n,i[30]+=n,n=i[18],i[27]-=i[11],i[19]-=n,i[18]=i[15]-n,i[15]+=n,n=i[19],i[10]-=n,i[19]=i[14]-n,i[14]+=n,n=i[10],i[11]-=n,i[10]=i[23]-n,i[23]+=n,n=i[11],i[26]-=n,i[11]=i[22]-n,i[22]+=n,n=i[26],i[27]-=n,i[26]=i[7]-n,i[7]+=n,n=i[27],i[27]=i[6]-n,i[6]+=n,n=d.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=n,n=d.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=n,n=d.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=n,n=d.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=n,n=-d.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=n-i[8],n=-d.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=n-i[9],n=-d.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=n-i[25],n=-d.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=n-i[24],n=i[24]-i[16],i[24]=n,n=i[20]-n,i[20]=n,n=i[28]-n,i[28]=n,n=i[25]-i[17],i[25]=n,n=i[21]-n,i[21]=n,n=i[29]-n,i[29]=n,n=i[17]-i[1],i[17]=n,n=i[9]-n,i[9]=n,n=i[25]-n,i[25]=n,n=i[5]-n,i[5]=n,n=i[21]-n,i[21]=n,n=i[13]-n,i[13]=n,n=i[29]-n,i[29]=n,n=i[1]-i[0],i[1]=n,n=i[16]-n,i[16]=n,n=i[17]-n,i[17]=n,n=i[8]-n,i[8]=n,n=i[9]-n,i[9]=n,n=i[24]-n,i[24]=n,n=i[25]-n,i[25]=n,n=i[4]-n,i[4]=n,n=i[5]-n,i[5]=n,n=i[20]-n,i[20]=n,n=i[21]-n,i[21]=n,n=i[12]-n,i[12]=n,n=i[13]-n,i[13]=n,n=i[28]-n,i[28]=n,n=i[29]-n,i[29]=n,n=i[0],i[0]+=i[31],i[31]-=n,n=i[1],i[1]+=i[30],i[30]-=n,n=i[16],i[16]+=i[15],i[15]-=n,n=i[17],i[17]+=i[14],i[14]-=n,n=i[8],i[8]+=i[23],i[23]-=n,n=i[9],i[9]+=i[22],i[22]-=n,n=i[24],i[24]+=i[7],i[7]-=n,n=i[25],i[25]+=i[6],i[6]-=n,n=i[4],i[4]+=i[27],i[27]-=n,n=i[5],i[5]+=i[26],i[26]-=n,n=i[20],i[20]+=i[11],i[11]-=n,n=i[21],i[21]+=i[10],i[10]-=n,n=i[12],i[12]+=i[19],i[19]-=n,n=i[13],i[13]+=i[18],i[18]-=n,n=i[28],i[28]+=i[3],i[3]-=n,n=i[29],i[29]+=i[2],i[2]-=n}}function z(C,P){for(var i=0;i<3;i++){var c,Y,K,q,$,b;q=C[P+6]*p[j.SHORT_TYPE][0]-C[P+15],c=C[P+0]*p[j.SHORT_TYPE][2]-C[P+9],Y=q+c,K=q-c,q=C[P+15]*p[j.SHORT_TYPE][0]+C[P+6],c=C[P+9]*p[j.SHORT_TYPE][2]+C[P+0],$=q+c,b=-q+c,c=(C[P+3]*p[j.SHORT_TYPE][1]-C[P+12])*0.00000000002069978111953089,q=(C[P+12]*p[j.SHORT_TYPE][1]+C[P+3])*0.00000000002069978111953089,C[P+0]=Y*0.0000000000190752519173728+c,C[P+15]=-$*0.0000000000190752519173728+q,K=K*0.8660254037844387*0.00000000001907525191737281,$=$*0.5*0.00000000001907525191737281+q,C[P+3]=K-$,C[P+6]=K+$,Y=Y*0.5*0.00000000001907525191737281-c,b=b*0.8660254037844387*0.00000000001907525191737281,C[P+9]=Y+b,C[P+12]=Y-b,P++}}function g(C,P,i){var c,Y;{var K,q,$,b,ht,D,n,J;K=i[17]-i[9],$=i[15]-i[11],b=i[14]-i[12],ht=i[0]+i[8],D=i[1]+i[7],n=i[2]+i[6],J=i[3]+i[5],C[P+17]=ht+n-J-(D-i[4]),Y=(ht+n-J)*Z[19]+(D-i[4]),c=(K-$-b)*Z[18],C[P+5]=c+Y,C[P+6]=c-Y,q=(i[16]-i[10])*Z[18],D=D*Z[19]+i[4],c=K*Z[12]+q+$*Z[13]+b*Z[14],Y=-ht*Z[16]+D-n*Z[17]+J*Z[15],C[P+1]=c+Y,C[P+2]=c-Y,c=K*Z[13]-q-$*Z[14]+b*Z[12],Y=-ht*Z[17]+D-n*Z[15]+J*Z[16],C[P+9]=c+Y,C[P+10]=c-Y,c=K*Z[14]-q+$*Z[12]-b*Z[13],Y=ht*Z[15]-D+n*Z[16]-J*Z[17],C[P+13]=c+Y,C[P+14]=c-Y}{var O,T,v,it,F,h,s,r;O=i[8]-i[0],v=i[6]-i[2],it=i[5]-i[3],F=i[17]+i[9],h=i[16]+i[10],s=i[15]+i[11],r=i[14]+i[12],C[P+0]=F+s+r+(h+i[13]),c=(F+s+r)*Z[19]-(h+i[13]),Y=(O-v+it)*Z[18],C[P+11]=c+Y,C[P+12]=c-Y,T=(i[7]-i[1])*Z[18],h=i[13]-h*Z[19],c=F*Z[15]-h+s*Z[16]+r*Z[17],Y=O*Z[14]+T+v*Z[12]+it*Z[13],C[P+3]=c+Y,C[P+4]=c-Y,c=-F*Z[17]+h-s*Z[15]-r*Z[16],Y=O*Z[13]+T-v*Z[14]-it*Z[12],C[P+7]=c+Y,C[P+8]=c-Y,c=-F*Z[16]+h-s*Z[17]-r*Z[15],Y=O*Z[12]-T+v*Z[13]-it*Z[14],C[P+15]=c+Y,C[P+16]=c-Y}}this.mdct_sub48=function(C,P,i){for(var c=P,Y=286,K=0;K<C.channels_out;K++){for(var q=0;q<C.mode_gr;q++){for(var $,b=C.l3_side.tt[q][K],ht=b.xr,D=0,n=C.sb_sample[K][1-q],J=0,O=0;O<9;O++)for(_(c,Y,n[J]),_(c,Y+32,n[J+1]),J+=2,Y+=64,$=1;$<32;$+=2)n[J-1][$]*=-1;for($=0;$<32;$++,D+=18){var T=b.block_type,v=C.sb_sample[K][q],it=C.sb_sample[K][1-q];if(b.mixed_block_flag!=0&&$<2&&(T=0),C.amp_filter[$]<0.000000000001)W.fill(ht,D+0,D+18,0);else{if(C.amp_filter[$]<1)for(var O=0;O<18;O++)it[O][I[$]]*=C.amp_filter[$];if(T==j.SHORT_TYPE){for(var O=-U/4;O<0;O++){var F=p[j.SHORT_TYPE][O+3];ht[D+O*3+9]=v[9+O][I[$]]*F-v[8-O][I[$]],ht[D+O*3+18]=v[14-O][I[$]]*F+v[15+O][I[$]],ht[D+O*3+10]=v[15+O][I[$]]*F-v[14-O][I[$]],ht[D+O*3+19]=it[2-O][I[$]]*F+it[3+O][I[$]],ht[D+O*3+11]=it[3+O][I[$]]*F-it[2-O][I[$]],ht[D+O*3+20]=it[8-O][I[$]]*F+it[9+O][I[$]]}z(ht,D)}else{for(var h=Q(18),O=-R/4;O<0;O++){var s,r;s=p[T][O+27]*it[O+9][I[$]]+p[T][O+36]*it[8-O][I[$]],r=p[T][O+9]*v[O+9][I[$]]-p[T][O+18]*v[8-O][I[$]],h[O+9]=s-r*l[3+O+9],h[O+18]=s*l[3+O+9]+r}g(ht,D,h)}}if(T!=j.SHORT_TYPE&&$!=0)for(var O=7;O>=0;--O){var a,f;a=ht[D+O]*V[20+O]+ht[D+-1-O]*M[28+O],f=ht[D+O]*M[28+O]-ht[D+-1-O]*V[20+O],ht[D+-1-O]=a,ht[D+O]=f}}}if(c=i,Y=286,C.mode_gr==1)for(var E=0;E<18;E++)e.arraycopy(C.sb_sample[K][1][E],0,C.sb_sample[K][0][E],0,32)}}}return xn=x,xn}var Ln,De;function nr(){if(De)return Ln;De=1;var t=ri(),e=Et,d=e.System,W=e.new_float,Q=e.new_float_n;function j(){this.l=W(t.SBMAX_l),this.s=Q([t.SBMAX_s,3]);var x=this;this.assign=function(y){d.arraycopy(y.l,0,x.l,0,t.SBMAX_l);for(var U=0;U<t.SBMAX_s;U++)for(var R=0;R<3;R++)x.s[U][R]=y.s[U][R]}}return Ln=j,Ln}var Kn,ke;function no(){if(ke)return Kn;ke=1;var t=nr();function e(){this.thm=new t,this.en=new t}return Kn=e,Kn}function ki(t){var e=t;this.ordinal=function(){return e}}ki.STEREO=new ki(0);ki.JOINT_STEREO=new ki(1);ki.DUAL_CHANNEL=new ki(2);ki.MONO=new ki(3);ki.NOT_SET=new ki(4);var ln=ki,On,ze;function ri(){if(ze)return On;ze=1;var t=Et,e=t.System,d=t.VbrMode,W=t.new_array_n,Q=t.new_float,j=t.new_float_n,x=t.new_int,y=t.assert;U.ENCDELAY=576,U.POSTDELAY=1152,U.MDCTDELAY=48,U.FFTOFFSET=224+U.MDCTDELAY,U.DECDELAY=528,U.SBLIMIT=32,U.CBANDS=64,U.SBPSY_l=21,U.SBPSY_s=12,U.SBMAX_l=22,U.SBMAX_s=13,U.PSFB21=6,U.PSFB12=6,U.BLKSIZE=1024,U.HBLKSIZE=U.BLKSIZE/2+1,U.BLKSIZE_s=256,U.HBLKSIZE_s=U.BLKSIZE_s/2+1,U.NORM_TYPE=0,U.START_TYPE=1,U.SHORT_TYPE=2,U.STOP_TYPE=3,U.MPG_MD_LR_LR=0,U.MPG_MD_LR_I=1,U.MPG_MD_MS_LR=2,U.MPG_MD_MS_I=3,U.fircoef=[-0.1039435,-0.1892065,-0.21623599999999998,-0.155915,0.00000000000000003898045,0.23387249999999998,0.50455,0.756825,0.9354899999999999];function U(){var R=io(),p=no(),l=ln,Z=U.FFTOFFSET,V=U.MPG_MD_MS_LR,M=null;this.psy=null;var I=null,_=null,z=null;this.setModules=function(c,Y,K,q){M=c,this.psy=Y,I=Y,_=q,z=K};var g=new R;function C(c){var Y,K;if(c.ATH.useAdjust==0){c.ATH.adjust=1;return}if(K=c.loudness_sq[0][0],Y=c.loudness_sq[1][0],c.channels_out==2?(K+=c.loudness_sq[0][1],Y+=c.loudness_sq[1][1]):(K+=K,Y+=Y),c.mode_gr==2&&(K=Math.max(K,Y)),K*=0.5,K*=c.ATH.aaSensitivityP,K>0.03125)c.ATH.adjust>=1?c.ATH.adjust=1:c.ATH.adjust<c.ATH.adjustLimit&&(c.ATH.adjust=c.ATH.adjustLimit),c.ATH.adjustLimit=1;else{var q=31.98*K+0.000625;c.ATH.adjust>=q?(c.ATH.adjust*=q*0.075+0.925,c.ATH.adjust<q&&(c.ATH.adjust=q)):c.ATH.adjustLimit>=q?c.ATH.adjust=q:c.ATH.adjust<c.ATH.adjustLimit&&(c.ATH.adjust=c.ATH.adjustLimit),c.ATH.adjustLimit=q}}function P(c){var Y,K;for(y(0<=c.bitrate_index&&c.bitrate_index<16),y(0<=c.mode_ext&&c.mode_ext<4),c.bitrate_stereoMode_Hist[c.bitrate_index][4]++,c.bitrate_stereoMode_Hist[15][4]++,c.channels_out==2&&(c.bitrate_stereoMode_Hist[c.bitrate_index][c.mode_ext]++,c.bitrate_stereoMode_Hist[15][c.mode_ext]++),Y=0;Y<c.mode_gr;++Y)for(K=0;K<c.channels_out;++K){var q=c.l3_side.tt[Y][K].block_type|0;c.l3_side.tt[Y][K].mixed_block_flag!=0&&(q=4),c.bitrate_blockType_Hist[c.bitrate_index][q]++,c.bitrate_blockType_Hist[c.bitrate_index][5]++,c.bitrate_blockType_Hist[15][q]++,c.bitrate_blockType_Hist[15][5]++}}function i(c,Y){var K=c.internal_flags,q,$;if(K.lame_encode_frame_init==0){var b,ht,D=Q(2014),n=Q(2014);for(K.lame_encode_frame_init=1,b=0,ht=0;b<286+576*(1+K.mode_gr);++b)b<576*K.mode_gr?(D[b]=0,K.channels_out==2&&(n[b]=0)):(D[b]=Y[0][ht],K.channels_out==2&&(n[b]=Y[1][ht]),++ht);for($=0;$<K.mode_gr;$++)for(q=0;q<K.channels_out;q++)K.l3_side.tt[$][q].block_type=U.SHORT_TYPE;g.mdct_sub48(K,D,n),y(576>=U.FFTOFFSET),y(K.mf_size>=U.BLKSIZE+c.framesize-U.FFTOFFSET),y(K.mf_size>=512+c.framesize-32)}}this.lame_encode_mp3_frame=function(c,Y,K,q,$,b){var ht,D=W([2,2]);D[0][0]=new p,D[0][1]=new p,D[1][0]=new p,D[1][1]=new p;var n=W([2,2]);n[0][0]=new p,n[0][1]=new p,n[1][0]=new p,n[1][1]=new p;var J,O=[null,null],T=c.internal_flags,v=j([2,4]),it=[0.5,0.5],F=[[0,0],[0,0]],h=[[0,0],[0,0]],s,r,a;if(O[0]=Y,O[1]=K,T.lame_encode_frame_init==0&&i(c,O),T.padding=0,(T.slot_lag-=T.frac_SpF)<0&&(T.slot_lag+=c.out_samplerate,T.padding=1),T.psymodel!=0){var f,E=[null,null],et=0,X=x(2);for(a=0;a<T.mode_gr;a++){for(r=0;r<T.channels_out;r++)E[r]=O[r],et=576+a*576-U.FFTOFFSET;if(c.VBR==d.vbr_mtrh||c.VBR==d.vbr_mt?f=I.L3psycho_anal_vbr(c,E,et,a,D,n,F[a],h[a],v[a],X):f=I.L3psycho_anal_ns(c,E,et,a,D,n,F[a],h[a],v[a],X),f!=0)return-4;for(c.mode==l.JOINT_STEREO&&(it[a]=v[a][2]+v[a][3],it[a]>0&&(it[a]=v[a][3]/it[a])),r=0;r<T.channels_out;r++){var B=T.l3_side.tt[a][r];B.block_type=X[r],B.mixed_block_flag=0}}}else for(a=0;a<T.mode_gr;a++)for(r=0;r<T.channels_out;r++)T.l3_side.tt[a][r].block_type=U.NORM_TYPE,T.l3_side.tt[a][r].mixed_block_flag=0,h[a][r]=F[a][r]=700;if(C(T),g.mdct_sub48(T,O[0],O[1]),T.mode_ext=U.MPG_MD_LR_LR,c.force_ms)T.mode_ext=U.MPG_MD_MS_LR;else if(c.mode==l.JOINT_STEREO){var dt=0,ut=0;for(a=0;a<T.mode_gr;a++)for(r=0;r<T.channels_out;r++)dt+=h[a][r],ut+=F[a][r];if(dt<=1*ut){var ft=T.l3_side.tt[0],Dt=T.l3_side.tt[T.mode_gr-1];ft[0].block_type==ft[1].block_type&&Dt[0].block_type==Dt[1].block_type&&(T.mode_ext=U.MPG_MD_MS_LR)}}if(T.mode_ext==V?(J=n,s=h):(J=D,s=F),c.analysis&&T.pinfo!=null)for(a=0;a<T.mode_gr;a++)for(r=0;r<T.channels_out;r++)T.pinfo.ms_ratio[a]=T.ms_ratio[a],T.pinfo.ms_ener_ratio[a]=it[a],T.pinfo.blocktype[a][r]=T.l3_side.tt[a][r].block_type,T.pinfo.pe[a][r]=s[a][r],e.arraycopy(T.l3_side.tt[a][r].xr,0,T.pinfo.xr[a][r],0,576),T.mode_ext==V&&(T.pinfo.ers[a][r]=T.pinfo.ers[a][r+2],e.arraycopy(T.pinfo.energy[a][r+2],0,T.pinfo.energy[a][r],0,T.pinfo.energy[a][r].length));if(c.VBR==d.vbr_off||c.VBR==d.vbr_abr){var Pt,Wt;for(Pt=0;Pt<18;Pt++)T.nsPsy.pefirbuf[Pt]=T.nsPsy.pefirbuf[Pt+1];for(Wt=0,a=0;a<T.mode_gr;a++)for(r=0;r<T.channels_out;r++)Wt+=s[a][r];for(T.nsPsy.pefirbuf[18]=Wt,Wt=T.nsPsy.pefirbuf[9],Pt=0;Pt<9;Pt++)Wt+=(T.nsPsy.pefirbuf[Pt]+T.nsPsy.pefirbuf[18-Pt])*U.fircoef[Pt];for(Wt=3350*T.mode_gr*T.channels_out/Wt,a=0;a<T.mode_gr;a++)for(r=0;r<T.channels_out;r++)s[a][r]*=Wt}if(T.iteration_loop.iteration_loop(c,s,it,J),M.format_bitstream(c),ht=M.copy_buffer(T,q,$,b,1),c.bWriteVbrTag&&_.addVbrFrame(c),c.analysis&&T.pinfo!=null){for(r=0;r<T.channels_out;r++){var yt;for(yt=0;yt<Z;yt++)T.pinfo.pcmdata[r][yt]=T.pinfo.pcmdata[r][yt+c.framesize];for(yt=Z;yt<1600;yt++)T.pinfo.pcmdata[r][yt]=O[r][yt-Z]}z.set_frame_pinfo(c,J)}return P(T),ht}}return On=U,On}var er=Et,Je=er.Util,Ye=er.new_float,At=ri();function eo(){var t=Ye(At.BLKSIZE),e=Ye(At.BLKSIZE_s/2),d=[0.9238795325112867,0.3826834323650898,0.9951847266721969,0.0980171403295606,0.9996988186962042,0.02454122852291229,0.9999811752826011,0.006135884649154475];function W(j,x,y){var U=0,R,p,l;y<<=1;var Z=x+y;R=4;do{var V,M,I,_,z,g,C;C=R>>1,_=R,z=R<<1,g=z+_,R=z<<1,p=x,l=p+C;do{var P,i,c,Y;i=j[p+0]-j[p+_],P=j[p+0]+j[p+_],Y=j[p+z]-j[p+g],c=j[p+z]+j[p+g],j[p+z]=P-c,j[p+0]=P+c,j[p+g]=i-Y,j[p+_]=i+Y,i=j[l+0]-j[l+_],P=j[l+0]+j[l+_],Y=Je.SQRT2*j[l+g],c=Je.SQRT2*j[l+z],j[l+z]=P-c,j[l+0]=P+c,j[l+g]=i-Y,j[l+_]=i+Y,l+=R,p+=R}while(p<Z);for(M=d[U+0],V=d[U+1],I=1;I<C;I++){var K,q;K=1-2*V*V,q=2*V*M,p=x+I,l=x+_-I;do{var $,b,ht,P,i,D,c,n,Y,J;b=q*j[p+_]-K*j[l+_],$=K*j[p+_]+q*j[l+_],i=j[p+0]-$,P=j[p+0]+$,D=j[l+0]-b,ht=j[l+0]+b,b=q*j[p+g]-K*j[l+g],$=K*j[p+g]+q*j[l+g],Y=j[p+z]-$,c=j[p+z]+$,J=j[l+z]-b,n=j[l+z]+b,b=V*c-M*J,$=M*c+V*J,j[p+z]=P-$,j[p+0]=P+$,j[l+g]=D-b,j[l+_]=D+b,b=M*n-V*Y,$=V*n+M*Y,j[l+z]=ht-$,j[l+0]=ht+$,j[p+g]=i-b,j[p+_]=i+b,l+=R,p+=R}while(p<Z);K=M,M=K*d[U+0]-V*d[U+1],V=K*d[U+1]+V*d[U+0]}U+=2}while(R<y)}var Q=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(j,x,y,U,R){for(var p=0;p<3;p++){var l=At.BLKSIZE_s/2,Z=65535&192*(p+1),V=At.BLKSIZE_s/8-1;do{var M,I,_,z,g,C=Q[V<<2]&255;M=e[C]*U[y][R+C+Z],g=e[127-C]*U[y][R+C+Z+128],I=M-g,M=M+g,_=e[C+64]*U[y][R+C+Z+64],g=e[63-C]*U[y][R+C+Z+192],z=_-g,_=_+g,l-=4,x[p][l+0]=M+_,x[p][l+2]=M-_,x[p][l+1]=I+z,x[p][l+3]=I-z,M=e[C+1]*U[y][R+C+Z+1],g=e[126-C]*U[y][R+C+Z+129],I=M-g,M=M+g,_=e[C+65]*U[y][R+C+Z+65],g=e[62-C]*U[y][R+C+Z+193],z=_-g,_=_+g,x[p][l+At.BLKSIZE_s/2+0]=M+_,x[p][l+At.BLKSIZE_s/2+2]=M-_,x[p][l+At.BLKSIZE_s/2+1]=I+z,x[p][l+At.BLKSIZE_s/2+3]=I-z}while(--V>=0);W(x[p],l,At.BLKSIZE_s/2)}},this.fft_long=function(j,x,y,U,R){var p=At.BLKSIZE/8-1,l=At.BLKSIZE/2;do{var Z,V,M,I,_,z=Q[p]&255;Z=t[z]*U[y][R+z],_=t[z+512]*U[y][R+z+512],V=Z-_,Z=Z+_,M=t[z+256]*U[y][R+z+256],_=t[z+768]*U[y][R+z+768],I=M-_,M=M+_,l-=4,x[l+0]=Z+M,x[l+2]=Z-M,x[l+1]=V+I,x[l+3]=V-I,Z=t[z+1]*U[y][R+z+1],_=t[z+513]*U[y][R+z+513],V=Z-_,Z=Z+_,M=t[z+257]*U[y][R+z+257],_=t[z+769]*U[y][R+z+769],I=M-_,M=M+_,x[l+At.BLKSIZE/2+0]=Z+M,x[l+At.BLKSIZE/2+2]=Z-M,x[l+At.BLKSIZE/2+1]=V+I,x[l+At.BLKSIZE/2+3]=V-I}while(--p>=0);W(x,l,At.BLKSIZE/2)},this.init_fft=function(j){for(var x=0;x<At.BLKSIZE;x++)t[x]=0.42-0.5*Math.cos(2*Math.PI*(x+0.5)/At.BLKSIZE)+0.08*Math.cos(4*Math.PI*(x+0.5)/At.BLKSIZE);for(var x=0;x<At.BLKSIZE_s/2;x++)e[x]=0.5*(1-Math.cos(2*Math.PI*(x+0.5)/At.BLKSIZE_s))}}var ro=eo,$i=Et,Ti=$i.VbrMode,Ge=$i.Float,Ni=$i.ShortBlock,hi=$i.Util,oo=$i.Arrays,ti=$i.new_float,wi=$i.new_float_n,xi=$i.new_int,Ut=$i.assert,so=ro,st=ri();function ho(){var t=ln,e=new so,d=2.302585092994046,W=2,Q=16,j=2,x=16,y=0.34,U=0.000000004595134127921476/(st.BLKSIZE/2),R=0.01,p=0.8,l=0.6,Z=0.3,V=3.5,M=21,I=0.2302585093;function _(m){return m}function z(m,w){for(var G=0,L=0;L<st.BLKSIZE/2;++L)G+=m[L]*w.ATH.eql_w[L];return G*=U,G}function g(m,w,G,L,H,k,N,A,S,rt,tt){var ot=m.internal_flags;if(S<2)e.fft_long(ot,L[H],S,rt,tt),e.fft_short(ot,k[N],S,rt,tt);else if(S==2){for(var gt=st.BLKSIZE-1;gt>=0;--gt){var $t=L[H+0][gt],lt=L[H+1][gt];L[H+0][gt]=($t+lt)*hi.SQRT2*0.5,L[H+1][gt]=($t-lt)*hi.SQRT2*0.5}for(var Zt=2;Zt>=0;--Zt)for(var gt=st.BLKSIZE_s-1;gt>=0;--gt){var $t=k[N+0][Zt][gt],lt=k[N+1][Zt][gt];k[N+0][Zt][gt]=($t+lt)*hi.SQRT2*0.5,k[N+1][Zt][gt]=($t-lt)*hi.SQRT2*0.5}}w[0]=L[H+0][0],w[0]*=w[0];for(var gt=st.BLKSIZE/2-1;gt>=0;--gt){var nt=L[H+0][st.BLKSIZE/2-gt],kt=L[H+0][st.BLKSIZE/2+gt];w[st.BLKSIZE/2-gt]=(nt*nt+kt*kt)*0.5}for(var Zt=2;Zt>=0;--Zt){G[Zt][0]=k[N+0][Zt][0],G[Zt][0]*=G[Zt][0];for(var gt=st.BLKSIZE_s/2-1;gt>=0;--gt){var nt=k[N+0][Zt][st.BLKSIZE_s/2-gt],kt=k[N+0][Zt][st.BLKSIZE_s/2+gt];G[Zt][st.BLKSIZE_s/2-gt]=(nt*nt+kt*kt)*0.5}}{for(var Lt=0,gt=11;gt<st.HBLKSIZE;gt++)Lt+=w[gt];ot.tot_ener[S]=Lt}if(m.analysis){for(var gt=0;gt<st.HBLKSIZE;gt++)ot.pinfo.energy[A][S][gt]=ot.pinfo.energy_save[S][gt],ot.pinfo.energy_save[S][gt]=w[gt];ot.pinfo.pe[A][S]=ot.pe[S]}m.athaa_loudapprox==2&&S<2&&(ot.loudness_sq[A][S]=ot.loudness_sq_save[S],ot.loudness_sq_save[S]=z(w,ot))}var C=8,P=23,i=15,c,Y,K,q=[1,0.79433,0.63096,0.63096,0.63096,0.63096,0.63096,0.25119,0.11749];function $(){c=Math.pow(10,(C+1)/16),Y=Math.pow(10,(P+1)/16),K=Math.pow(10,i/10)}var b=[11.052965160000001,10.487040256900002,9.9500500969,9.0247369744,8.1854926609,7.0440875649,6.061887168099999,5.2166559999999995,4.4892710641,3.8632688703999998,3.3246052225000002,2.8610369315999997,2.4621061921,2.1508568964,1.8789281476000002,1.7170433295999998,1.5691069696,1.4555939904,1.3503137208999998,1.2715945225,1.1974487183999998,1.1361428100000002,1.0779838276,1.0382591025,1],ht=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1],D=[5.5396212496,5.255968908100001,4.9868695969,4.523065562499999,4.102447702500001,3.5304155236000003,3.0381535809000004,2.6145273025000004,2.2499700001,1.9362165904000002,1.6662420888999998,1.4339104515999999,1.2339655056,1.0779838276];function n(m,w,G,L,H,k){var N;if(w>m)if(w<m*Y)N=w/m;else return m+w;else{if(m>=w*Y)return m+w;N=m/w}if(m+=w,L+3<=6){if(N>=c)return m;var A=0|hi.FAST_LOG10_X(N,16);return m*ht[A]}var A=0|hi.FAST_LOG10_X(N,16);if(k!=0?w=H.ATH.cb_s[G]*H.ATH.adjust:w=H.ATH.cb_l[G]*H.ATH.adjust,m<K*w){if(m>w){var S,rt;return S=1,A<=13&&(S=D[A]),rt=hi.FAST_LOG10_X(m/w,0.6666666666666666),m*((b[A]-S)*rt+S)}return A>13?m:m*D[A]}return m*b[A]}var J=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1];function O(m,w,G){var L;if(m<0&&(m=0),w<0&&(w=0),m<=0)return w;if(w<=0)return m;if(w>m?L=w/m:L=m/w,-2<=G&&G<=2){if(L>=c)return m+w;var H=0|hi.FAST_LOG10_X(L,16);return(m+w)*J[H]}return L<Y?m+w:(m<w&&(m=w),m)}function T(m,w){var G=m.internal_flags;if(G.channels_out>1){for(var L=0;L<st.SBMAX_l;L++){var H=G.thm[0].l[L],k=G.thm[1].l[L];G.thm[0].l[L]+=k*w,G.thm[1].l[L]+=H*w}for(var L=0;L<st.SBMAX_s;L++)for(var N=0;N<3;N++){var H=G.thm[0].s[L][N],k=G.thm[1].s[L][N];G.thm[0].s[L][N]+=k*w,G.thm[1].s[L][N]+=H*w}}}function v(m){for(var w=0;w<st.SBMAX_l;w++)if(!(m.thm[0].l[w]>1.58*m.thm[1].l[w]||m.thm[1].l[w]>1.58*m.thm[0].l[w])){var G=m.mld_l[w]*m.en[3].l[w],L=Math.max(m.thm[2].l[w],Math.min(m.thm[3].l[w],G));G=m.mld_l[w]*m.en[2].l[w];var H=Math.max(m.thm[3].l[w],Math.min(m.thm[2].l[w],G));m.thm[2].l[w]=L,m.thm[3].l[w]=H}for(var w=0;w<st.SBMAX_s;w++)for(var k=0;k<3;k++)if(!(m.thm[0].s[w][k]>1.58*m.thm[1].s[w][k]||m.thm[1].s[w][k]>1.58*m.thm[0].s[w][k])){var G=m.mld_s[w]*m.en[3].s[w][k],L=Math.max(m.thm[2].s[w][k],Math.min(m.thm[3].s[w][k],G));G=m.mld_s[w]*m.en[2].s[w][k];var H=Math.max(m.thm[3].s[w][k],Math.min(m.thm[2].s[w][k],G));m.thm[2].s[w][k]=L,m.thm[3].s[w][k]=H}}function it(m,w,G){var L=w,H=Math.pow(10,G);w*=2,L*=2;for(var k=0;k<st.SBMAX_l;k++){var N,A,S,rt;if(rt=m.ATH.cb_l[m.bm_l[k]]*H,N=Math.min(Math.max(m.thm[0].l[k],rt),Math.max(m.thm[1].l[k],rt)),A=Math.max(m.thm[2].l[k],rt),S=Math.max(m.thm[3].l[k],rt),N*w<A+S){var tt=N*L/(A+S);A*=tt,S*=tt}m.thm[2].l[k]=Math.min(A,m.thm[2].l[k]),m.thm[3].l[k]=Math.min(S,m.thm[3].l[k])}H*=st.BLKSIZE_s/st.BLKSIZE;for(var k=0;k<st.SBMAX_s;k++)for(var ot=0;ot<3;ot++){var N,A,S,rt;if(rt=m.ATH.cb_s[m.bm_s[k]]*H,N=Math.min(Math.max(m.thm[0].s[k][ot],rt),Math.max(m.thm[1].s[k][ot],rt)),A=Math.max(m.thm[2].s[k][ot],rt),S=Math.max(m.thm[3].s[k][ot],rt),N*w<A+S){var tt=N*w/(A+S);A*=tt,S*=tt}m.thm[2].s[k][ot]=Math.min(m.thm[2].s[k][ot],A),m.thm[3].s[k][ot]=Math.min(m.thm[3].s[k][ot],S)}}function F(m,w,G,L,H){var k,N,A=0,S=0;for(k=N=0;k<st.SBMAX_s;++N,++k){for(var rt=m.bo_s[k],tt=m.npart_s,ot=rt<tt?rt:tt;N<ot;)Ut(w[N]>=0),Ut(G[N]>=0),A+=w[N],S+=G[N],N++;if(m.en[L].s[k][H]=A,m.thm[L].s[k][H]=S,N>=tt){++k;break}Ut(w[N]>=0),Ut(G[N]>=0);{var gt=m.PSY.bo_s_weight[k],$t=1-gt;A=gt*w[N],S=gt*G[N],m.en[L].s[k][H]+=A,m.thm[L].s[k][H]+=S,A=$t*w[N],S=$t*G[N]}}for(;k<st.SBMAX_s;++k)m.en[L].s[k][H]=0,m.thm[L].s[k][H]=0}function h(m,w,G,L){var H,k,N=0,A=0;for(H=k=0;H<st.SBMAX_l;++k,++H){for(var S=m.bo_l[H],rt=m.npart_l,tt=S<rt?S:rt;k<tt;)Ut(w[k]>=0),Ut(G[k]>=0),N+=w[k],A+=G[k],k++;if(m.en[L].l[H]=N,m.thm[L].l[H]=A,k>=rt){++H;break}Ut(w[k]>=0),Ut(G[k]>=0);{var ot=m.PSY.bo_l_weight[H],gt=1-ot;N=ot*w[k],A=ot*G[k],m.en[L].l[H]+=N,m.thm[L].l[H]+=A,N=gt*w[k],A=gt*G[k]}}for(;H<st.SBMAX_l;++H)m.en[L].l[H]=0,m.thm[L].l[H]=0}function s(m,w,G,L,H,k){var N=m.internal_flags,A,S;for(S=A=0;S<N.npart_s;++S){for(var rt=0,tt=N.numlines_s[S],ot=0;ot<tt;++ot,++A){var gt=w[k][A];rt+=gt}G[S]=rt}for(Ut(S==N.npart_s),A=S=0;S<N.npart_s;S++){var $t=N.s3ind_s[S][0],lt=N.s3_ss[A++]*G[$t];for(++$t;$t<=N.s3ind_s[S][1];)lt+=N.s3_ss[A]*G[$t],++A,++$t;{var Zt=j*N.nb_s1[H][S];L[S]=Math.min(lt,Zt)}if(N.blocktype_old[H&1]==st.SHORT_TYPE){var Zt=x*N.nb_s2[H][S],nt=L[S];L[S]=Math.min(Zt,nt)}N.nb_s2[H][S]=N.nb_s1[H][S],N.nb_s1[H][S]=lt,Ut(L[S]>=0)}for(;S<=st.CBANDS;++S)G[S]=0,L[S]=0}function r(m,w,G,L){var H=m.internal_flags;m.short_blocks==Ni.short_block_coupled&&!(w[0]!=0&&w[1]!=0)&&(w[0]=w[1]=0);for(var k=0;k<H.channels_out;k++)L[k]=st.NORM_TYPE,m.short_blocks==Ni.short_block_dispensed&&(w[k]=1),m.short_blocks==Ni.short_block_forced&&(w[k]=0),w[k]!=0?(Ut(H.blocktype_old[k]!=st.START_TYPE),H.blocktype_old[k]==st.SHORT_TYPE&&(L[k]=st.STOP_TYPE)):(L[k]=st.SHORT_TYPE,H.blocktype_old[k]==st.NORM_TYPE&&(H.blocktype_old[k]=st.START_TYPE),H.blocktype_old[k]==st.STOP_TYPE&&(H.blocktype_old[k]=st.SHORT_TYPE)),G[k]=H.blocktype_old[k],H.blocktype_old[k]=L[k]}function a(m,w,G){return G>=1?m:G<=0?w:w>0?Math.pow(m/w,G)*w:0}var f=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function E(m,w){for(var G=309.07,L=0;L<st.SBMAX_s-1;L++)for(var H=0;H<3;H++){var k=m.thm.s[L][H];if(k>0){var N=k*w,A=m.en.s[L][H];A>N&&(A>N*10000000000?G+=f[L]*(10*d):G+=f[L]*hi.FAST_LOG10(A/N))}}return G}var et=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function X(m,w){for(var G=281.0575,L=0;L<st.SBMAX_l-1;L++){var H=m.thm.l[L];if(H>0){var k=H*w,N=m.en.l[L];N>k&&(N>k*10000000000?G+=et[L]*(10*d):G+=et[L]*hi.FAST_LOG10(N/k))}}return G}function B(m,w,G,L,H){var k,N;for(k=N=0;k<m.npart_l;++k){var A=0,S=0,rt;for(rt=0;rt<m.numlines_l[k];++rt,++N){var tt=w[N];A+=tt,S<tt&&(S=tt)}G[k]=A,L[k]=S,H[k]=A*m.rnumlines_l[k],Ut(m.rnumlines_l[k]>=0),Ut(G[k]>=0),Ut(L[k]>=0),Ut(H[k]>=0)}}function dt(m,w,G,L){var H=q.length-1,k=0,N=G[k]+G[k+1];if(N>0){var A=w[k];A<w[k+1]&&(A=w[k+1]),Ut(m.numlines_l[k]+m.numlines_l[k+1]-1>0),N=20*(A*2-N)/(N*(m.numlines_l[k]+m.numlines_l[k+1]-1));var S=0|N;S>H&&(S=H),L[k]=S}else L[k]=0;for(k=1;k<m.npart_l-1;k++)if(N=G[k-1]+G[k]+G[k+1],N>0){var A=w[k-1];A<w[k]&&(A=w[k]),A<w[k+1]&&(A=w[k+1]),Ut(m.numlines_l[k-1]+m.numlines_l[k]+m.numlines_l[k+1]-1>0),N=20*(A*3-N)/(N*(m.numlines_l[k-1]+m.numlines_l[k]+m.numlines_l[k+1]-1));var S=0|N;S>H&&(S=H),L[k]=S}else L[k]=0;if(Ut(k==m.npart_l-1),N=G[k-1]+G[k],N>0){var A=w[k-1];A<w[k]&&(A=w[k]),Ut(m.numlines_l[k-1]+m.numlines_l[k]-1>0),N=20*(A*2-N)/(N*(m.numlines_l[k-1]+m.numlines_l[k]-1));var S=0|N;S>H&&(S=H),L[k]=S}else L[k]=0;Ut(k==m.npart_l-1)}var ut=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];this.L3psycho_anal_ns=function(m,w,G,L,H,k,N,A,S,rt){var tt=m.internal_flags,ot=wi([2,st.BLKSIZE]),gt=wi([2,3,st.BLKSIZE_s]),$t=ti(st.CBANDS+1),lt=ti(st.CBANDS+1),Zt=ti(st.CBANDS+2),nt=xi(2),kt=xi(2),Lt,at,Jt,ct,Ft,Tt,wt,Xt,Kt=wi([2,576]),Nt,ci=xi(st.CBANDS+2),Rt=xi(st.CBANDS+2);for(oo.fill(Rt,0),Lt=tt.channels_out,m.mode==t.JOINT_STEREO&&(Lt=4),m.VBR==Ti.vbr_off?Nt=tt.ResvMax==0?0:tt.ResvSize/tt.ResvMax*0.5:m.VBR==Ti.vbr_rh||m.VBR==Ti.vbr_mtrh||m.VBR==Ti.vbr_mt?Nt=0.6:Nt=1,at=0;at<tt.channels_out;at++){var St=w[at],si=G+576-350-M+192;for(ct=0;ct<576;ct++){var pi,ui;for(pi=St[si+ct+10],ui=0,Ft=0;Ft<(M-1)/2-1;Ft+=2)pi+=ut[Ft]*(St[si+ct+Ft]+St[si+ct+M-Ft]),ui+=ut[Ft+1]*(St[si+ct+Ft+1]+St[si+ct+M-Ft-1]);Kt[at][ct]=pi+ui}H[L][at].en.assign(tt.en[at]),H[L][at].thm.assign(tt.thm[at]),Lt>2&&(k[L][at].en.assign(tt.en[at+2]),k[L][at].thm.assign(tt.thm[at+2]))}for(at=0;at<Lt;at++){var fi,Wi,ei=ti(12),Yi=[0,0,0,0],Vi=ti(12),jn=1,ce,pe=ti(st.CBANDS),ue=ti(st.CBANDS),Ht=[0,0,0,0],ge=ti(st.HBLKSIZE),me=wi([3,st.HBLKSIZE_s]);for(Ut(tt.npart_s<=st.CBANDS),Ut(tt.npart_l<=st.CBANDS),ct=0;ct<3;ct++)ei[ct]=tt.nsPsy.last_en_subshort[at][ct+6],Ut(tt.nsPsy.last_en_subshort[at][ct+4]>0),Vi[ct]=ei[ct]/tt.nsPsy.last_en_subshort[at][ct+4],Yi[0]+=ei[ct];if(at==2)for(ct=0;ct<576;ct++){var Zn,$n;Zn=Kt[0][ct],$n=Kt[1][ct],Kt[0][ct]=Zn+$n,Kt[1][ct]=Zn-$n}{var we=Kt[at&1],tn=0;for(ct=0;ct<9;ct++){for(var _r=tn+64,ni=1;tn<_r;tn++)ni<Math.abs(we[tn])&&(ni=Math.abs(we[tn]));tt.nsPsy.last_en_subshort[at][ct]=ei[ct+3]=ni,Yi[1+ct/3]+=ni,ni>ei[ct+3-2]?(Ut(ei[ct+3-2]>0),ni=ni/ei[ct+3-2]):ei[ct+3-2]>ni*10?ni=ei[ct+3-2]/(ni*10):ni=0,Vi[ct+3]=ni}}if(m.analysis){var Fn=Vi[0];for(ct=1;ct<12;ct++)Fn<Vi[ct]&&(Fn=Vi[ct]);tt.pinfo.ers[L][at]=tt.pinfo.ers_save[at],tt.pinfo.ers_save[at]=Fn}for(ce=at==3?tt.nsPsy.attackthre_s:tt.nsPsy.attackthre,ct=0;ct<12;ct++)Ht[ct/3]==0&&Vi[ct]>ce&&(Ht[ct/3]=ct%3+1);for(ct=1;ct<4;ct++){var Qn;Yi[ct-1]>Yi[ct]?(Ut(Yi[ct]>0),Qn=Yi[ct-1]/Yi[ct]):(Ut(Yi[ct-1]>0),Qn=Yi[ct]/Yi[ct-1]),Qn<1.7&&(Ht[ct]=0,ct==1&&(Ht[0]=0))}for(Ht[0]!=0&&tt.nsPsy.lastAttacks[at]!=0&&(Ht[0]=0),(tt.nsPsy.lastAttacks[at]==3||Ht[0]+Ht[1]+Ht[2]+Ht[3]!=0)&&(jn=0,Ht[1]!=0&&Ht[0]!=0&&(Ht[1]=0),Ht[2]!=0&&Ht[1]!=0&&(Ht[2]=0),Ht[3]!=0&&Ht[2]!=0&&(Ht[3]=0)),at<2?kt[at]=jn:jn==0&&(kt[0]=kt[1]=0),S[at]=tt.tot_ener[at],Wi=gt,fi=ot,g(m,ge,me,fi,at&1,Wi,at&1,L,at,w,G),B(tt,ge,$t,pe,ue),dt(tt,pe,ue,ci),Xt=0;Xt<3;Xt++){var bn,di;for(s(m,me,lt,Zt,at,Xt),F(tt,lt,Zt,at,Xt),wt=0;wt<st.SBMAX_s;wt++){if(di=tt.thm[at].s[wt][Xt],di*=p,Ht[Xt]>=2||Ht[Xt+1]==1){var nn=Xt!=0?Xt-1:2,ni=a(tt.thm[at].s[wt][nn],di,l*Nt);di=Math.min(di,ni)}if(Ht[Xt]==1){var nn=Xt!=0?Xt-1:2,ni=a(tt.thm[at].s[wt][nn],di,Z*Nt);di=Math.min(di,ni)}else if(Xt!=0&&Ht[Xt-1]==3||Xt==0&&tt.nsPsy.lastAttacks[at]==3){var nn=Xt!=2?Xt+1:0,ni=a(tt.thm[at].s[wt][nn],di,Z*Nt);di=Math.min(di,ni)}bn=ei[Xt*3+3]+ei[Xt*3+4]+ei[Xt*3+5],ei[Xt*3+5]*6<bn&&(di*=0.5,ei[Xt*3+4]*6<bn&&(di*=0.5)),tt.thm[at].s[wt][Xt]=di}}for(tt.nsPsy.lastAttacks[at]=Ht[2],Tt=0,Jt=0;Jt<tt.npart_l;Jt++){for(var Xi=tt.s3ind[Jt][0],Xn=$t[Xi]*q[ci[Xi]],Ui=tt.s3_ll[Tt++]*Xn;++Xi<=tt.s3ind[Jt][1];)Xn=$t[Xi]*q[ci[Xi]],Ui=n(Ui,tt.s3_ll[Tt++]*Xn,Xi,Xi-Jt,tt,0);Ui*=0.158489319246111,tt.blocktype_old[at&1]==st.SHORT_TYPE?Zt[Jt]=Ui:Zt[Jt]=a(Math.min(Ui,Math.min(W*tt.nb_1[at][Jt],Q*tt.nb_2[at][Jt])),Ui,Nt),tt.nb_2[at][Jt]=tt.nb_1[at][Jt],tt.nb_1[at][Jt]=Ui}for(;Jt<=st.CBANDS;++Jt)$t[Jt]=0,Zt[Jt]=0;h(tt,$t,Zt,at)}if((m.mode==t.STEREO||m.mode==t.JOINT_STEREO)&&m.interChRatio>0&&T(m,m.interChRatio),m.mode==t.JOINT_STEREO){var Un;v(tt),Un=m.msfix,Math.abs(Un)>0&&it(tt,Un,m.ATHlower*tt.ATH.adjust)}for(r(m,kt,rt,nt),at=0;at<Lt;at++){var en,rn=0,cn,pn;at>1?(en=A,rn=-2,cn=st.NORM_TYPE,(rt[0]==st.SHORT_TYPE||rt[1]==st.SHORT_TYPE)&&(cn=st.SHORT_TYPE),pn=k[L][at-2]):(en=N,rn=0,cn=rt[at],pn=H[L][at]),cn==st.SHORT_TYPE?en[rn+at]=E(pn,tt.masking_lower):en[rn+at]=X(pn,tt.masking_lower),m.analysis&&(tt.pinfo.pe[L][at]=en[rn+at])}return 0};function ft(m,w,G,L,H,k,N,A){var S=m.internal_flags;if(L<2)e.fft_long(S,N[A],L,w,G);else if(L==2)for(var rt=st.BLKSIZE-1;rt>=0;--rt){var tt=N[A+0][rt],ot=N[A+1][rt];N[A+0][rt]=(tt+ot)*hi.SQRT2*0.5,N[A+1][rt]=(tt-ot)*hi.SQRT2*0.5}k[0]=N[A+0][0],k[0]*=k[0];for(var rt=st.BLKSIZE/2-1;rt>=0;--rt){var gt=N[A+0][st.BLKSIZE/2-rt],$t=N[A+0][st.BLKSIZE/2+rt];k[st.BLKSIZE/2-rt]=(gt*gt+$t*$t)*0.5}{for(var lt=0,rt=11;rt<st.HBLKSIZE;rt++)lt+=k[rt];S.tot_ener[L]=lt}if(m.analysis){for(var rt=0;rt<st.HBLKSIZE;rt++)S.pinfo.energy[H][L][rt]=S.pinfo.energy_save[L][rt],S.pinfo.energy_save[L][rt]=k[rt];S.pinfo.pe[H][L]=S.pe[L]}}function Dt(m,w,G,L,H,k,N,A){var S=m.internal_flags;if(H==0&&L<2&&e.fft_short(S,N[A],L,w,G),L==2)for(var rt=st.BLKSIZE_s-1;rt>=0;--rt){var tt=N[A+0][H][rt],ot=N[A+1][H][rt];N[A+0][H][rt]=(tt+ot)*hi.SQRT2*0.5,N[A+1][H][rt]=(tt-ot)*hi.SQRT2*0.5}k[H][0]=N[A+0][H][0],k[H][0]*=k[H][0];for(var rt=st.BLKSIZE_s/2-1;rt>=0;--rt){var gt=N[A+0][H][st.BLKSIZE_s/2-rt],$t=N[A+0][H][st.BLKSIZE_s/2+rt];k[H][st.BLKSIZE_s/2-rt]=(gt*gt+$t*$t)*0.5}}function Pt(m,w,G,L){var H=m.internal_flags;m.athaa_loudapprox==2&&G<2&&(H.loudness_sq[w][G]=H.loudness_sq_save[G],H.loudness_sq_save[G]=z(L,H))}var Wt=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];function yt(m,w,G,L,H,k,N,A,S,rt){for(var tt=wi([2,576]),ot=m.internal_flags,gt=ot.channels_out,$t=m.mode==t.JOINT_STEREO?4:gt,lt=0;lt<gt;lt++){firbuf=w[lt];for(var Zt=G+576-350-M+192,nt=0;nt<576;nt++){var kt,Lt;kt=firbuf[Zt+nt+10],Lt=0;for(var at=0;at<(M-1)/2-1;at+=2)kt+=Wt[at]*(firbuf[Zt+nt+at]+firbuf[Zt+nt+M-at]),Lt+=Wt[at+1]*(firbuf[Zt+nt+at+1]+firbuf[Zt+nt+M-at-1]);tt[lt][nt]=kt+Lt}H[L][lt].en.assign(ot.en[lt]),H[L][lt].thm.assign(ot.thm[lt]),$t>2&&(k[L][lt].en.assign(ot.en[lt+2]),k[L][lt].thm.assign(ot.thm[lt+2]))}for(var lt=0;lt<$t;lt++){var Jt=ti(12),ct=ti(12),Ft=[0,0,0,0],Tt=tt[lt&1],wt=0,Xt=lt==3?ot.nsPsy.attackthre_s:ot.nsPsy.attackthre,Kt=1;if(lt==2)for(var nt=0,at=576;at>0;++nt,--at){var Nt=tt[0][nt],ci=tt[1][nt];tt[0][nt]=Nt+ci,tt[1][nt]=Nt-ci}for(var nt=0;nt<3;nt++)ct[nt]=ot.nsPsy.last_en_subshort[lt][nt+6],Ut(ot.nsPsy.last_en_subshort[lt][nt+4]>0),Jt[nt]=ct[nt]/ot.nsPsy.last_en_subshort[lt][nt+4],Ft[0]+=ct[nt];for(var nt=0;nt<9;nt++){for(var Rt=wt+64,St=1;wt<Rt;wt++)St<Math.abs(Tt[wt])&&(St=Math.abs(Tt[wt]));ot.nsPsy.last_en_subshort[lt][nt]=ct[nt+3]=St,Ft[1+nt/3]+=St,St>ct[nt+3-2]?(Ut(ct[nt+3-2]>0),St=St/ct[nt+3-2]):ct[nt+3-2]>St*10?St=ct[nt+3-2]/(St*10):St=0,Jt[nt+3]=St}for(var nt=0;nt<3;++nt){var si=ct[nt*3+3]+ct[nt*3+4]+ct[nt*3+5],pi=1;ct[nt*3+5]*6<si&&(pi*=0.5,ct[nt*3+4]*6<si&&(pi*=0.5)),A[lt][nt]=pi}if(m.analysis){for(var ui=Jt[0],nt=1;nt<12;nt++)ui<Jt[nt]&&(ui=Jt[nt]);ot.pinfo.ers[L][lt]=ot.pinfo.ers_save[lt],ot.pinfo.ers_save[lt]=ui}for(var nt=0;nt<12;nt++)S[lt][nt/3]==0&&Jt[nt]>Xt&&(S[lt][nt/3]=nt%3+1);for(var nt=1;nt<4;nt++){var fi=Ft[nt-1],Wi=Ft[nt],ei=Math.max(fi,Wi);ei<40000&&fi<1.7*Wi&&Wi<1.7*fi&&(nt==1&&S[lt][0]<=S[lt][nt]&&(S[lt][0]=0),S[lt][nt]=0)}S[lt][0]<=ot.nsPsy.lastAttacks[lt]&&(S[lt][0]=0),(ot.nsPsy.lastAttacks[lt]==3||S[lt][0]+S[lt][1]+S[lt][2]+S[lt][3]!=0)&&(Kt=0,S[lt][1]!=0&&S[lt][0]!=0&&(S[lt][1]=0),S[lt][2]!=0&&S[lt][1]!=0&&(S[lt][2]=0),S[lt][3]!=0&&S[lt][2]!=0&&(S[lt][3]=0)),lt<2?rt[lt]=Kt:Kt==0&&(rt[0]=rt[1]=0),N[lt]=ot.tot_ener[lt]}}function Vt(m,w,G){if(G==0)for(var L=0;L<m.npart_s;L++)m.nb_s2[w][L]=m.nb_s1[w][L],m.nb_s1[w][L]=0}function mi(m,w){for(var G=0;G<m.npart_l;G++)m.nb_2[w][G]=m.nb_1[w][G],m.nb_1[w][G]=0}function o(m,w,G,L){var H=q.length-1,k=0,N=G[k]+G[k+1];if(N>0){var A=w[k];A<w[k+1]&&(A=w[k+1]),Ut(m.numlines_s[k]+m.numlines_s[k+1]-1>0),N=20*(A*2-N)/(N*(m.numlines_s[k]+m.numlines_s[k+1]-1));var S=0|N;S>H&&(S=H),L[k]=S}else L[k]=0;for(k=1;k<m.npart_s-1;k++)if(N=G[k-1]+G[k]+G[k+1],Ut(k+1<m.npart_s),N>0){var A=w[k-1];A<w[k]&&(A=w[k]),A<w[k+1]&&(A=w[k+1]),Ut(m.numlines_s[k-1]+m.numlines_s[k]+m.numlines_s[k+1]-1>0),N=20*(A*3-N)/(N*(m.numlines_s[k-1]+m.numlines_s[k]+m.numlines_s[k+1]-1));var S=0|N;S>H&&(S=H),L[k]=S}else L[k]=0;if(Ut(k==m.npart_s-1),N=G[k-1]+G[k],N>0){var A=w[k-1];A<w[k]&&(A=w[k]),Ut(m.numlines_s[k-1]+m.numlines_s[k]-1>0),N=20*(A*2-N)/(N*(m.numlines_s[k-1]+m.numlines_s[k]-1));var S=0|N;S>H&&(S=H),L[k]=S}else L[k]=0;Ut(k==m.npart_s-1)}function u(m,w,G,L,H,k){var N=m.internal_flags,A=new float[st.CBANDS],S=ti(st.CBANDS),rt,tt,ot,gt=new int[st.CBANDS];for(ot=tt=0;ot<N.npart_s;++ot){var $t=0,lt=0,Zt=N.numlines_s[ot];for(rt=0;rt<Zt;++rt,++tt){var nt=w[k][tt];$t+=nt,lt<nt&&(lt=nt)}G[ot]=$t,A[ot]=lt,S[ot]=$t/Zt,Ut(S[ot]>=0)}for(Ut(ot==N.npart_s);ot<st.CBANDS;++ot)A[ot]=0,S[ot]=0;for(o(N,A,S,gt),tt=ot=0;ot<N.npart_s;ot++){var kt=N.s3ind_s[ot][0],Lt=N.s3ind_s[ot][1],at,Jt,ct,Ft,Tt;for(at=gt[kt],Jt=1,Ft=N.s3_ss[tt]*G[kt]*q[gt[kt]],++tt,++kt;kt<=Lt;)at+=gt[kt],Jt+=1,ct=N.s3_ss[tt]*G[kt]*q[gt[kt]],Ft=O(Ft,ct,kt-ot),++tt,++kt;at=(1+2*at)/(2*Jt),Tt=q[at]*0.5,Ft*=Tt,L[ot]=Ft,N.nb_s2[H][ot]=N.nb_s1[H][ot],N.nb_s1[H][ot]=Ft,ct=A[ot],ct*=N.minval_s[ot],ct*=Tt,L[ot]>ct&&(L[ot]=ct),N.masking_lower>1&&(L[ot]*=N.masking_lower),L[ot]>G[ot]&&(L[ot]=G[ot]),N.masking_lower<1&&(L[ot]*=N.masking_lower),Ut(L[ot]>=0)}for(;ot<st.CBANDS;++ot)G[ot]=0,L[ot]=0}function Ct(m,w,G,L,H){var k=ti(st.CBANDS),N=ti(st.CBANDS),A=xi(st.CBANDS+2),S;B(m,w,G,k,N),dt(m,k,N,A);var rt=0;for(S=0;S<m.npart_l;S++){var tt,ot,gt,$t,lt=m.s3ind[S][0],Zt=m.s3ind[S][1],nt=0,kt=0;for(nt=A[lt],kt+=1,ot=m.s3_ll[rt]*G[lt]*q[A[lt]],++rt,++lt;lt<=Zt;)nt+=A[lt],kt+=1,tt=m.s3_ll[rt]*G[lt]*q[A[lt]],$t=O(ot,tt,lt-S),ot=$t,++rt,++lt;if(nt=(1+2*nt)/(2*kt),gt=q[nt]*0.5,ot*=gt,m.blocktype_old[H&1]==st.SHORT_TYPE){var Lt=W*m.nb_1[H][S];Lt>0?L[S]=Math.min(ot,Lt):L[S]=Math.min(ot,G[S]*Z)}else{var at=Q*m.nb_2[H][S],Jt=W*m.nb_1[H][S],Lt;at<=0&&(at=ot),Jt<=0&&(Jt=ot),m.blocktype_old[H&1]==st.NORM_TYPE?Lt=Math.min(Jt,at):Lt=Jt,L[S]=Math.min(ot,Lt)}m.nb_2[H][S]=m.nb_1[H][S],m.nb_1[H][S]=ot,tt=k[S],tt*=m.minval_l[S],tt*=gt,L[S]>tt&&(L[S]=tt),m.masking_lower>1&&(L[S]*=m.masking_lower),L[S]>G[S]&&(L[S]=G[S]),m.masking_lower<1&&(L[S]*=m.masking_lower),Ut(L[S]>=0)}for(;S<st.CBANDS;++S)G[S]=0,L[S]=0}function zt(m,w){var G=m.internal_flags;m.short_blocks==Ni.short_block_coupled&&!(w[0]!=0&&w[1]!=0)&&(w[0]=w[1]=0);for(var L=0;L<G.channels_out;L++)m.short_blocks==Ni.short_block_dispensed&&(w[L]=1),m.short_blocks==Ni.short_block_forced&&(w[L]=0)}function bt(m,w,G){for(var L=m.internal_flags,H=0;H<L.channels_out;H++){var k=st.NORM_TYPE;w[H]!=0?(Ut(L.blocktype_old[H]!=st.START_TYPE),L.blocktype_old[H]==st.SHORT_TYPE&&(k=st.STOP_TYPE)):(k=st.SHORT_TYPE,L.blocktype_old[H]==st.NORM_TYPE&&(L.blocktype_old[H]=st.START_TYPE),L.blocktype_old[H]==st.STOP_TYPE&&(L.blocktype_old[H]=st.SHORT_TYPE)),G[H]=L.blocktype_old[H],L.blocktype_old[H]=k}}function Qt(m,w,G,L,H,k,N){for(var A=k*2,S=k>0?Math.pow(10,H):1,rt,tt,ot=0;ot<N;++ot){var gt=m[2][ot],$t=m[3][ot],lt=w[0][ot],Zt=w[1][ot],nt=w[2][ot],kt=w[3][ot];if(lt<=1.58*Zt&&Zt<=1.58*lt){var Lt=G[ot]*$t,at=G[ot]*gt;tt=Math.max(nt,Math.min(kt,Lt)),rt=Math.max(kt,Math.min(nt,at))}else tt=nt,rt=kt;if(k>0){var Jt,ct,Ft=L[ot]*S;if(Jt=Math.min(Math.max(lt,Ft),Math.max(Zt,Ft)),nt=Math.max(tt,Ft),kt=Math.max(rt,Ft),ct=nt+kt,ct>0&&Jt*A<ct){var Tt=Jt*A/ct;nt*=Tt,kt*=Tt}tt=Math.min(nt,tt),rt=Math.min(kt,rt)}tt>gt&&(tt=gt),rt>$t&&(rt=$t),w[2][ot]=tt,w[3][ot]=rt}}this.L3psycho_anal_vbr=function(m,w,G,L,H,k,N,A,S,rt){var tt=m.internal_flags,ot,gt,$t=ti(st.HBLKSIZE),lt=wi([3,st.HBLKSIZE_s]),Zt=wi([2,st.BLKSIZE]),nt=wi([2,3,st.BLKSIZE_s]),kt=wi([4,st.CBANDS]),Lt=wi([4,st.CBANDS]),at=wi([4,3]),Jt=0.6,ct=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ft=xi(2),Tt=m.mode==t.JOINT_STEREO?4:tt.channels_out;yt(m,w,G,L,H,k,S,at,ct,Ft),zt(m,Ft);{for(var wt=0;wt<Tt;wt++){var Xt=wt&1;ot=Zt,ft(m,w,G,wt,L,$t,ot,Xt),Pt(m,L,wt,$t),Ft[Xt]!=0?Ct(tt,$t,kt[wt],Lt[wt],wt):mi(tt,wt)}Ft[0]+Ft[1]==2&&m.mode==t.JOINT_STEREO&&Qt(kt,Lt,tt.mld_cb_l,tt.ATH.cb_l,m.ATHlower*tt.ATH.adjust,m.msfix,tt.npart_l);for(var wt=0;wt<Tt;wt++){var Xt=wt&1;Ft[Xt]!=0&&h(tt,kt[wt],Lt[wt],wt)}}{for(var Kt=0;Kt<3;Kt++){for(var wt=0;wt<Tt;++wt){var Xt=wt&1;Ft[Xt]!=0?Vt(tt,wt,Kt):(gt=nt,Dt(m,w,G,wt,Kt,lt,gt,Xt),u(m,lt,kt[wt],Lt[wt],wt,Kt))}Ft[0]+Ft[1]==0&&m.mode==t.JOINT_STEREO&&Qt(kt,Lt,tt.mld_cb_s,tt.ATH.cb_s,m.ATHlower*tt.ATH.adjust,m.msfix,tt.npart_s);for(var wt=0;wt<Tt;++wt){var Xt=wt&1;Ft[Xt]==0&&F(tt,kt[wt],Lt[wt],wt,Kt)}}for(var wt=0;wt<Tt;wt++){var Xt=wt&1;if(Ft[Xt]==0)for(var Nt=0;Nt<st.SBMAX_s;Nt++){for(var ci=ti(3),Kt=0;Kt<3;Kt++){var Rt=tt.thm[wt].s[Nt][Kt];if(Rt*=p,ct[wt][Kt]>=2||ct[wt][Kt+1]==1){var St=Kt!=0?Kt-1:2,si=a(tt.thm[wt].s[Nt][St],Rt,l*Jt);Rt=Math.min(Rt,si)}else if(ct[wt][Kt]==1){var St=Kt!=0?Kt-1:2,si=a(tt.thm[wt].s[Nt][St],Rt,Z*Jt);Rt=Math.min(Rt,si)}else if(Kt!=0&&ct[wt][Kt-1]==3||Kt==0&&tt.nsPsy.lastAttacks[wt]==3){var St=Kt!=2?Kt+1:0,si=a(tt.thm[wt].s[Nt][St],Rt,Z*Jt);Rt=Math.min(Rt,si)}Rt*=at[wt][Kt],ci[Kt]=Rt}for(var Kt=0;Kt<3;Kt++)tt.thm[wt].s[Nt][Kt]=ci[Kt]}}}for(var wt=0;wt<Tt;wt++)tt.nsPsy.lastAttacks[wt]=ct[wt][2];bt(m,Ft,rt);for(var wt=0;wt<Tt;wt++){var pi,ui,fi,Wi;wt>1?(pi=A,ui=-2,fi=st.NORM_TYPE,(rt[0]==st.SHORT_TYPE||rt[1]==st.SHORT_TYPE)&&(fi=st.SHORT_TYPE),Wi=k[L][wt-2]):(pi=N,ui=0,fi=rt[wt],Wi=H[L][wt]),fi==st.SHORT_TYPE?pi[ui+wt]=E(Wi,tt.masking_lower):pi[ui+wt]=X(Wi,tt.masking_lower),m.analysis&&(tt.pinfo.pe[L][wt]=pi[ui+wt])}return 0};function Gt(m,w){var G=m,L;return G>=0?L=-G*27:L=G*w,L<=-72?0:Math.exp(L*I)}function Yt(m){var w=0,G=0;{var L=0,H,k;for(L=0;Gt(L,m)>0.00000000000000000001;L-=1);for(H=L,k=0;Math.abs(k-H)>0.000000000001;)L=(k+H)/2,Gt(L,m)>0?k=L:H=L;w=H}{var L=0,H,k;for(L=0;Gt(L,m)>0.00000000000000000001;L+=1);for(H=0,k=L;Math.abs(k-H)>0.000000000001;)L=(k+H)/2,Gt(L,m)>0?H=L:k=L;G=k}{var N=0,A=1000,S;for(S=0;S<=A;++S){var L=w+S*(G-w)/A,rt=Gt(L,m);N+=rt}{var tt=(A+1)/(N*(G-w));return tt}}}function xt(m){var w,G,L,H;return w=m,w>=0?w*=3:w*=1.5,w>=0.5&&w<=2.5?(H=w-0.5,G=8*(H*H-2*H)):G=0,w+=0.474,L=15.811389+7.5*w-17.5*Math.sqrt(1+w*w),L<=-60?0:(w=Math.exp((G+L)*I),w/=0.6609193,w)}function jt(m){return m<0&&(m=0),m=m*0.001,13*Math.atan(0.76*m)+3.5*Math.atan(m*m/56.25)}function mt(m,w,G,L,H,k,N,A,S,rt,tt,ot){var gt=ti(st.CBANDS+1),$t=A/(ot>15?1152:384),lt=xi(st.HBLKSIZE),Zt;A/=S;var nt=0,kt=0;for(Zt=0;Zt<st.CBANDS;Zt++){var Lt,at;for(Lt=jt(A*nt),gt[Zt]=A*nt,at=nt;jt(A*at)-Lt<y&&at<=S/2;at++);for(m[Zt]=at-nt,kt=Zt+1;nt<at;)Ut(nt<st.HBLKSIZE),lt[nt++]=Zt;if(nt>S/2){nt=S/2,++Zt;break}}Ut(Zt<st.CBANDS),gt[Zt]=A*nt;for(var Jt=0;Jt<ot;Jt++){var ct,Ft,Tt,wt,Xt;Tt=rt[Jt],wt=rt[Jt+1],ct=0|Math.floor(0.5+tt*(Tt-0.5)),ct<0&&(ct=0),Ft=0|Math.floor(0.5+tt*(wt-0.5)),Ft>S/2&&(Ft=S/2),G[Jt]=(lt[ct]+lt[Ft])/2,w[Jt]=lt[Ft];var Kt=$t*wt;N[Jt]=(Kt-gt[w[Jt]])/(gt[w[Jt]+1]-gt[w[Jt]]),N[Jt]<0?N[Jt]=0:N[Jt]>1&&(N[Jt]=1),Xt=jt(A*rt[Jt]*tt),Xt=Math.min(Xt,15.5)/15.5,k[Jt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Xt))-2.5)}nt=0;for(var Nt=0;Nt<kt;Nt++){var ci=m[Nt],Lt,Rt;Lt=jt(A*nt),Rt=jt(A*(nt+ci-1)),L[Nt]=0.5*(Lt+Rt),Lt=jt(A*(nt-0.5)),Rt=jt(A*(nt+ci-0.5)),H[Nt]=Rt-Lt,nt+=ci}return kt}function qt(m,w,G,L,H,k){var N=wi([st.CBANDS,st.CBANDS]),A,S=0;if(k)for(var rt=0;rt<w;rt++)for(A=0;A<w;A++){var tt=xt(G[rt]-G[A])*L[A];N[rt][A]=tt*H[rt]}else for(A=0;A<w;A++)for(var ot=15+Math.min(21/G[A],12),gt=Yt(ot),rt=0;rt<w;rt++){var tt=gt*Gt(G[rt]-G[A],ot)*L[A];N[rt][A]=tt*H[rt]}for(var rt=0;rt<w;rt++){for(A=0;A<w&&!(N[rt][A]>0);A++);for(m[rt][0]=A,A=w-1;A>0&&!(N[rt][A]>0);A--);m[rt][1]=A,S+=m[rt][1]-m[rt][0]+1}for(var $t=ti(S),lt=0,rt=0;rt<w;rt++)for(A=m[rt][0];A<=m[rt][1];A++)$t[lt++]=N[rt][A];return $t}function ii(m){var w=jt(m);return w=Math.min(w,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*w))-2.5)}this.psymodel_init=function(m){var w=m.internal_flags,G,L=!0,H=13,k=24,N=0,A=0,S=-8.25,rt=-4.5,tt=ti(st.CBANDS),ot=ti(st.CBANDS),gt=ti(st.CBANDS),$t=m.out_samplerate;switch(m.experimentalZ){default:case 0:L=!0;break;case 1:L=!(m.VBR==Ti.vbr_mtrh||m.VBR==Ti.vbr_mt);break;case 2:L=!1;break;case 3:H=8,N=-1.75,A=-0.0125,S=-8.25,rt=-2.25;break}for(w.ms_ener_ratio_old=0.25,w.blocktype_old[0]=w.blocktype_old[1]=st.NORM_TYPE,G=0;G<4;++G){for(var nt=0;nt<st.CBANDS;++nt)w.nb_1[G][nt]=100000000000000000000,w.nb_2[G][nt]=100000000000000000000,w.nb_s1[G][nt]=w.nb_s2[G][nt]=1;for(var lt=0;lt<st.SBMAX_l;lt++)w.en[G].l[lt]=100000000000000000000,w.thm[G].l[lt]=100000000000000000000;for(var nt=0;nt<3;++nt){for(var lt=0;lt<st.SBMAX_s;lt++)w.en[G].s[lt][nt]=100000000000000000000,w.thm[G].s[lt][nt]=100000000000000000000;w.nsPsy.lastAttacks[G]=0}for(var nt=0;nt<9;nt++)w.nsPsy.last_en_subshort[G][nt]=10}for(w.loudness_sq_save[0]=w.loudness_sq_save[1]=0,w.npart_l=mt(w.numlines_l,w.bo_l,w.bm_l,tt,ot,w.mld_l,w.PSY.bo_l_weight,$t,st.BLKSIZE,w.scalefac_band.l,st.BLKSIZE/1152,st.SBMAX_l),Ut(w.npart_l<st.CBANDS),G=0;G<w.npart_l;G++){var Zt=N;tt[G]>=H&&(Zt=A*(tt[G]-H)/(k-H)+N*(k-tt[G])/(k-H)),gt[G]=Math.pow(10,Zt/10),w.numlines_l[G]>0?w.rnumlines_l[G]=1/w.numlines_l[G]:w.rnumlines_l[G]=0}w.s3_ll=qt(w.s3ind,w.npart_l,tt,ot,gt,L);var nt=0;for(G=0;G<w.npart_l;G++){var kt=Ge.MAX_VALUE;for(var Lt=0;Lt<w.numlines_l[G];Lt++,nt++){var at=$t*nt/(1000*st.BLKSIZE),Jt;Jt=this.ATHformula(at*1000,m)-20,Jt=Math.pow(10,0.1*Jt),Jt*=w.numlines_l[G],kt>Jt&&(kt=Jt)}w.ATH.cb_l[G]=kt,kt=-20+tt[G]*20/10,kt>6&&(kt=100),kt<-15&&(kt=-15),kt-=8,w.minval_l[G]=Math.pow(10,kt/10)*w.numlines_l[G]}for(w.npart_s=mt(w.numlines_s,w.bo_s,w.bm_s,tt,ot,w.mld_s,w.PSY.bo_s_weight,$t,st.BLKSIZE_s,w.scalefac_band.s,st.BLKSIZE_s/384,st.SBMAX_s),Ut(w.npart_s<st.CBANDS),nt=0,G=0;G<w.npart_s;G++){var kt,Zt=S;tt[G]>=H&&(Zt=rt*(tt[G]-H)/(k-H)+S*(k-tt[G])/(k-H)),gt[G]=Math.pow(10,Zt/10),kt=Ge.MAX_VALUE;for(var Lt=0;Lt<w.numlines_s[G];Lt++,nt++){var at=$t*nt/(1000*st.BLKSIZE_s),Jt;Jt=this.ATHformula(at*1000,m)-20,Jt=Math.pow(10,0.1*Jt),Jt*=w.numlines_s[G],kt>Jt&&(kt=Jt)}w.ATH.cb_s[G]=kt,kt=-7+tt[G]*7/12,tt[G]>12&&(kt*=1+Math.log(1+kt)*3.1),tt[G]<12&&(kt*=1+Math.log(1-kt)*2.3),kt<-15&&(kt=-15),kt-=8,w.minval_s[G]=Math.pow(10,kt/10)*w.numlines_s[G]}w.s3_ss=qt(w.s3ind_s,w.npart_s,tt,ot,gt,L),$(),e.init_fft(w),w.decay=Math.exp(-1*d/(R*$t/192));{var ct;ct=V,m.exp_nspsytune&2&&(ct=1),Math.abs(m.msfix)>0&&(ct=m.msfix),m.msfix=ct;for(var Ft=0;Ft<w.npart_l;Ft++)w.s3ind[Ft][1]>w.npart_l-1&&(w.s3ind[Ft][1]=w.npart_l-1)}var Tt=576*w.mode_gr/$t;if(w.ATH.decay=Math.pow(10,-1.2*Tt),w.ATH.adjust=0.01,w.ATH.adjustLimit=1,Ut(w.bo_l[st.SBMAX_l-1]<=w.npart_l),Ut(w.bo_s[st.SBMAX_s-1]<=w.npart_s),m.ATHtype!=-1){var at,wt=m.out_samplerate/st.BLKSIZE,Xt=0;for(at=0,G=0;G<st.BLKSIZE/2;++G)at+=wt,w.ATH.eql_w[G]=1/Math.pow(10,this.ATHformula(at,m)/10),Xt+=w.ATH.eql_w[G];for(Xt=1/Xt,G=st.BLKSIZE/2;--G>=0;)w.ATH.eql_w[G]*=Xt}{for(var Ft=nt=0;Ft<w.npart_s;++Ft)for(G=0;G<w.numlines_s[Ft];++G)++nt;for(var Ft=nt=0;Ft<w.npart_l;++Ft)for(G=0;G<w.numlines_l[Ft];++G)++nt}for(nt=0,G=0;G<w.npart_l;G++){var at=$t*(nt+w.numlines_l[G]/2)/(1*st.BLKSIZE);w.mld_cb_l[G]=ii(at),nt+=w.numlines_l[G]}for(;G<st.CBANDS;++G)w.mld_cb_l[G]=1;for(nt=0,G=0;G<w.npart_s;G++){var at=$t*(nt+w.numlines_s[G]/2)/(1*st.BLKSIZE_s);w.mld_cb_s[G]=ii(at),nt+=w.numlines_s[G]}for(;G<st.CBANDS;++G)w.mld_cb_s[G]=1;return 0};function Ot(m,w){m<-0.3&&(m=3410),m/=1000,m=Math.max(0.1,m);var G=3.64*Math.pow(m,-0.8)-6.8*Math.exp(-0.6*Math.pow(m-3.4,2))+6*Math.exp(-0.15*Math.pow(m-8.7,2))+(0.6+0.04*w)*0.001*Math.pow(m,4);return G}this.ATHformula=function(m,w){var G;switch(w.ATHtype){case 0:G=Ot(m,9);break;case 1:G=Ot(m,-1);break;case 2:G=Ot(m,0);break;case 3:G=Ot(m,1)+6;break;case 4:G=Ot(m,w.ATHcurve);break;default:G=Ot(m,0);break}return G}}var lo=ho,ao=ln;function co(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=ao.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var po=co,uo=ri(),rr={};rr.SFBMAX=uo.SBMAX_s*3;var Wn=rr,or=Et,go=or.new_float,Li=or.new_int,vn=Wn;function mo(){this.xr=go(576),this.l3_enc=Li(576),this.scalefac=Li(vn.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Li(3),this.subblock_gain=Li(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Li(vn.SFBMAX),this.window=Li(vn.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Li(4),this.max_nonzero_coeff=0;var t=this;function e(W){return new Int32Array(W)}function d(W){return new Float32Array(W)}this.assign=function(W){t.xr=d(W.xr),t.l3_enc=e(W.l3_enc),t.scalefac=e(W.scalefac),t.xrpow_max=W.xrpow_max,t.part2_3_length=W.part2_3_length,t.big_values=W.big_values,t.count1=W.count1,t.global_gain=W.global_gain,t.scalefac_compress=W.scalefac_compress,t.block_type=W.block_type,t.mixed_block_flag=W.mixed_block_flag,t.table_select=e(W.table_select),t.subblock_gain=e(W.subblock_gain),t.region0_count=W.region0_count,t.region1_count=W.region1_count,t.preflag=W.preflag,t.scalefac_scale=W.scalefac_scale,t.count1table_select=W.count1table_select,t.part2_length=W.part2_length,t.sfb_lmax=W.sfb_lmax,t.sfb_smin=W.sfb_smin,t.psy_lmax=W.psy_lmax,t.sfbmax=W.sfbmax,t.psymax=W.psymax,t.sfbdivide=W.sfbdivide,t.width=e(W.width),t.window=e(W.window),t.count1bits=W.count1bits,t.sfb_partition_table=W.sfb_partition_table.slice(0),t.slen=e(W.slen),t.max_nonzero_coeff=W.max_nonzero_coeff}}var In=mo,wo=Et,ye=wo.new_int,Co=In;function fo(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[ye(4),ye(4)];for(var t=0;t<2;t++)for(var e=0;e<2;e++)this.tt[t][e]=new Co}var Wo=fo,sr=Et,un=sr.System,gn=sr.new_int,mn=ri();function Po(t,e,d,W){this.l=gn(1+mn.SBMAX_l),this.s=gn(1+mn.SBMAX_s),this.psfb21=gn(1+mn.PSFB21),this.psfb12=gn(1+mn.PSFB12);var Q=this.l,j=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],un.arraycopy(this.arrL,0,Q,0,Math.min(this.arrL.length,this.l.length)),un.arraycopy(this.arrS,0,j,0,Math.min(this.arrS.length,this.s.length)),un.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),un.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var dr=Po,_n=Et,Mn=_n.new_float,Do=_n.new_float_n,ko=_n.new_int,je=ri();function zo(){this.last_en_subshort=Do([4,9]),this.lastAttacks=ko(4),this.pefirbuf=Mn(19),this.longfact=Mn(je.SBMAX_l),this.shortfact=Mn(je.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var Jo=zo;function Yo(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var Go=Yo,Ei=Et,yo=Ei.new_byte,jo=Ei.new_double,Ci=Ei.new_float,Ki=Ei.new_float_n,Pi=Ei.new_int,wn=Ei.new_int_n,Zo=Wo,$o=dr,Fo=Jo,Qo=Go,Ze=nr(),_t=ri(),bo=Wn;ji.MFSIZE=3456+_t.ENCDELAY-_t.MDCTDELAY;ji.MAX_HEADER_BUF=256;ji.MAX_BITS_PER_CHANNEL=4095;ji.MAX_BITS_PER_GRANULE=7680;ji.BPC=320;function ji(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Ki([2,ji.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Zo,this.ms_ratio=Ci(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Pi(2),this.CurrentStep=Pi(2),this.masking_lower=0,this.bv_scf=Pi(576),this.pseudohalf=Pi(bo.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=[,,],this.blackfilt=Array(2*ji.BPC+1),this.itime=jo(2),this.sideinfo_len=0,this.sb_sample=Ki([2,2,18,_t.SBLIMIT]),this.amp_filter=Ci(32);function e(){this.write_timing=0,this.ptr=0,this.buf=yo(t)}this.header=Array(ji.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new $o,this.minval_l=Ci(_t.CBANDS),this.minval_s=Ci(_t.CBANDS),this.nb_1=Ki([4,_t.CBANDS]),this.nb_2=Ki([4,_t.CBANDS]),this.nb_s1=Ki([4,_t.CBANDS]),this.nb_s2=Ki([4,_t.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=[,,,,],this.en=[,,,,],this.tot_ener=Ci(4),this.loudness_sq=Ki([2,2]),this.loudness_sq_save=Ci(2),this.mld_l=Ci(_t.SBMAX_l),this.mld_s=Ci(_t.SBMAX_s),this.bm_l=Pi(_t.SBMAX_l),this.bo_l=Pi(_t.SBMAX_l),this.bm_s=Pi(_t.SBMAX_s),this.bo_s=Pi(_t.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=wn([_t.CBANDS,2]),this.s3ind_s=wn([_t.CBANDS,2]),this.numlines_s=Pi(_t.CBANDS),this.numlines_l=Pi(_t.CBANDS),this.rnumlines_l=Ci(_t.CBANDS),this.mld_cb_l=Ci(_t.CBANDS),this.mld_cb_s=Ci(_t.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ci(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Pi(2),this.nsPsy=new Fo,this.VBR_seek_table=new Qo,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=wn([16,5]),this.bitrate_blockType_Hist=wn([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var d=0;d<this.en.length;d++)this.en[d]=new Ze;for(var d=0;d<this.thm.length;d++)this.thm[d]=new Ze;for(var d=0;d<this.header.length;d++)this.header[d]=new e}var Pn=ji,Xo=Et,Oi=Xo.new_float,vi=ri();function Uo(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Oi(vi.SBMAX_l),this.s=Oi(vi.SBMAX_s),this.psfb21=Oi(vi.PSFB21),this.psfb12=Oi(vi.PSFB12),this.cb_l=Oi(vi.CBANDS),this.cb_s=Oi(vi.CBANDS),this.eql_w=Oi(vi.BLKSIZE/2)}var xo=Uo,hr=Et,li=hr.System,$e=hr.Arrays;Bt.STEPS_per_dB=100;Bt.MAX_dB=120;Bt.GAIN_NOT_ENOUGH_SAMPLES=-24601;Bt.GAIN_ANALYSIS_ERROR=0;Bt.GAIN_ANALYSIS_OK=1;Bt.INIT_GAIN_ANALYSIS_ERROR=0;Bt.INIT_GAIN_ANALYSIS_OK=1;Bt.YULE_ORDER=10;Bt.MAX_ORDER=Bt.YULE_ORDER;Bt.MAX_SAMP_FREQ=48000;Bt.RMS_WINDOW_TIME_NUMERATOR=1;Bt.RMS_WINDOW_TIME_DENOMINATOR=20;Bt.MAX_SAMPLES_PER_WINDOW=Bt.MAX_SAMP_FREQ*Bt.RMS_WINDOW_TIME_NUMERATOR/Bt.RMS_WINDOW_TIME_DENOMINATOR+1;function Bt(){var t=64.82,e=0.95,d=Bt.RMS_WINDOW_TIME_NUMERATOR,W=Bt.RMS_WINDOW_TIME_DENOMINATOR,Q=[[0.038575994352,-3.84664617118067,-0.02160367184185,7.81501653005538,-0.00123395316851,-11.34170355132042,-0.00009291677959,13.05504219327545,-0.01655260341619,-12.28759895145294,0.02161526843274,9.4829380631979,-0.02074045215285,-5.87257861775999,0.00594298065125,2.75465861874613,0.00306428023191,-0.86984376593551,0.00012025322027,0.13919314567432,0.00288463683916],[0.0541865640643,-3.47845948550071,-0.02911007808948,6.36317777566148,-0.00848709379851,-8.54751527471874,-0.00851165645469,9.4769360780128,-0.00834990904936,-8.81498681370155,0.02245293253339,6.85401540936998,-0.02596338512915,-4.39470996079559,0.01624864962975,2.19611684890774,-0.00240879051584,-0.75104302451432,0.00674613682247,0.13149317958808,-0.00187763777362],[0.15457299681924,-2.37898834973084,-0.09331049056315,2.84868151156327,-0.06247880153653,-2.64577170229825,0.02163541888798,2.23697657451713,-0.05588393329856,-1.67148153367602,0.04781476674921,1.00595954808547,0.00222312597743,-0.45953458054983,0.03174092540049,0.16378164858596,-0.01390589421898,-0.05032077717131,0.00651420667831,0.0234789740702,-0.00881362733839],[0.30296907319327,-1.61273165137247,-0.22613988682123,1.0797749225997,-0.08587323730772,-0.2565625775407,0.03282930172664,-0.1627671912044,-0.00915702933434,-0.22638893773906,-0.02364141202522,0.39120800788284,-0.00584456039913,-0.22138138954925,0.06276101321749,0.04500235387352,-0.00000828086748,0.02005851806501,0.00205861885564,0.00302439095741,-0.02950134983287],[0.33642304856132,-1.49858979367799,-0.2557224142557,0.87350271418188,-0.11828570177555,0.12205022308084,0.11921148675203,-0.80774944671438,-0.07834489609479,0.47854794562326,-0.0046997791438,-0.12453458140019,-0.0058950022444,-0.04067510197014,0.05724228140351,0.08333755284107,0.00832043980773,-0.04237348025746,-0.0163538138454,0.02977207319925,-0.0176017656815],[0.4491525660845,-0.62820619233671,-0.14351757464547,0.29661783706366,-0.22784394429749,-0.372563729424,-0.01419140100551,0.00213767857124,0.04078262797139,-0.42029820170918,-0.12398163381748,0.22199650564824,0.04097565135648,0.00613424350682,0.10478503600251,0.06747620744683,-0.01863887810927,0.05784820375801,-0.03193428438915,0.03222754072173,0.00541907748707],[0.56619470757641,-1.04800335126349,-0.75464456939302,0.29156311971249,0.1624213774223,-0.26806001042947,0.16744243493672,0.00819999645858,-0.18901604199609,0.45054734505008,0.3093178284183,-0.33032403314006,-0.27562961986224,0.0673936833311,0.00647310677246,-0.04784254229033,0.08647503780351,0.01639907836189,-0.0378898455484,0.01807364323573,-0.00588215443421],[0.58100494960553,-0.51035327095184,-0.53174909058578,-0.31863563325245,-0.14289799034253,-0.20256413484477,0.17520704835522,0.1472815413433,0.02377945217615,0.38952639978999,0.15558449135573,-0.23313271880868,-0.25344790059353,-0.05246019024463,0.01628462406333,-0.02505961724053,0.06920467763959,0.02442357316099,-0.03721611395801,0.01818801111503,-0.00749618797172],[0.53648789255105,-0.2504987195602,-0.42163034350696,-0.43193942311114,-0.00275953611929,-0.03424681017675,0.04267842219415,-0.04678328784242,-0.10214864179676,0.26408300200955,0.14590772289388,0.15113130533216,-0.02459864859345,-0.17556493366449,-0.11202315195388,-0.18823009262115,-0.04060034127,0.05477720428674,0.0478866554818,0.0470440968812,-0.02217936801134]],j=[[0.98621192462708,-1.97223372919527,-1.97242384925416,0.97261396931306,0.98621192462708],[0.98500175787242,-1.96977855582618,-1.97000351574484,0.9702284756635,0.98500175787242],[0.97938932735214,-1.95835380975398,-1.95877865470428,0.95920349965459,0.97938932735214],[0.97531843204928,-1.95002759149878,-1.95063686409857,0.95124613669835,0.97531843204928],[0.97316523498161,-1.94561023566527,-1.94633046996323,0.94705070426118,0.97316523498161],[0.96454515552826,-1.92783286977036,-1.92909031105652,0.93034775234268,0.96454515552826],[0.96009142950541,-1.91858953033784,-1.92018285901082,0.92177618768381,0.96009142950541],[0.95856916599601,-1.9154210807478,-1.91713833199203,0.91885558323625,0.95856916599601],[0.94597685600279,-1.88903307939452,-1.89195371200558,0.89487434461664,0.94597685600279]];function x(l,Z,V,M,I,_){for(;I--!=0;)V[M]=0.0000000001+l[Z+0]*_[0]-V[M-1]*_[1]+l[Z-1]*_[2]-V[M-2]*_[3]+l[Z-2]*_[4]-V[M-3]*_[5]+l[Z-3]*_[6]-V[M-4]*_[7]+l[Z-4]*_[8]-V[M-5]*_[9]+l[Z-5]*_[10]-V[M-6]*_[11]+l[Z-6]*_[12]-V[M-7]*_[13]+l[Z-7]*_[14]-V[M-8]*_[15]+l[Z-8]*_[16]-V[M-9]*_[17]+l[Z-9]*_[18]-V[M-10]*_[19]+l[Z-10]*_[20],++M,++Z}function y(l,Z,V,M,I,_){for(;I--!=0;)V[M]=l[Z+0]*_[0]-V[M-1]*_[1]+l[Z-1]*_[2]-V[M-2]*_[3]+l[Z-2]*_[4],++M,++Z}function U(l,Z){for(var V=0;V<MAX_ORDER;V++)l.linprebuf[V]=l.lstepbuf[V]=l.loutbuf[V]=l.rinprebuf[V]=l.rstepbuf[V]=l.routbuf[V]=0;switch(0|Z){case 48000:l.reqindex=0;break;case 44100:l.reqindex=1;break;case 32000:l.reqindex=2;break;case 24000:l.reqindex=3;break;case 22050:l.reqindex=4;break;case 16000:l.reqindex=5;break;case 12000:l.reqindex=6;break;case 11025:l.reqindex=7;break;case 8000:l.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return l.sampleWindow=0|(Z*d+W-1)/W,l.lsum=0,l.rsum=0,l.totsamp=0,$e.ill(l.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(l,Z){return U(l,Z)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(l.linpre=MAX_ORDER,l.rinpre=MAX_ORDER,l.lstep=MAX_ORDER,l.rstep=MAX_ORDER,l.lout=MAX_ORDER,l.rout=MAX_ORDER,$e.fill(l.B,0),INIT_GAIN_ANALYSIS_OK)};function R(l){return l*l}this.AnalyzeSamples=function(l,Z,V,M,I,_,z){var g,C,P,i,c,Y,K;if(_==0)return GAIN_ANALYSIS_OK;switch(K=0,c=_,z){case 1:M=Z,I=V;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(_<MAX_ORDER?(li.arraycopy(Z,V,l.linprebuf,MAX_ORDER,_),li.arraycopy(M,I,l.rinprebuf,MAX_ORDER,_)):(li.arraycopy(Z,V,l.linprebuf,MAX_ORDER,MAX_ORDER),li.arraycopy(M,I,l.rinprebuf,MAX_ORDER,MAX_ORDER));c>0;){Y=c>l.sampleWindow-l.totsamp?l.sampleWindow-l.totsamp:c,K<MAX_ORDER?(g=l.linpre+K,C=l.linprebuf,P=l.rinpre+K,i=l.rinprebuf,Y>MAX_ORDER-K&&(Y=MAX_ORDER-K)):(g=V+K,C=Z,P=I+K,i=M),x(C,g,l.lstepbuf,l.lstep+l.totsamp,Y,Q[l.reqindex]),x(i,P,l.rstepbuf,l.rstep+l.totsamp,Y,Q[l.reqindex]),y(l.lstepbuf,l.lstep+l.totsamp,l.loutbuf,l.lout+l.totsamp,Y,j[l.reqindex]),y(l.rstepbuf,l.rstep+l.totsamp,l.routbuf,l.rout+l.totsamp,Y,j[l.reqindex]),g=l.lout+l.totsamp,C=l.loutbuf,P=l.rout+l.totsamp,i=l.routbuf;for(var q=Y%8;q--!=0;)l.lsum+=R(C[g++]),l.rsum+=R(i[P++]);for(q=Y/8;q--!=0;)l.lsum+=R(C[g+0])+R(C[g+1])+R(C[g+2])+R(C[g+3])+R(C[g+4])+R(C[g+5])+R(C[g+6])+R(C[g+7]),g+=8,l.rsum+=R(i[P+0])+R(i[P+1])+R(i[P+2])+R(i[P+3])+R(i[P+4])+R(i[P+5])+R(i[P+6])+R(i[P+7]),P+=8;if(c-=Y,K+=Y,l.totsamp+=Y,l.totsamp==l.sampleWindow){var $=Bt.STEPS_per_dB*10*Math.log10((l.lsum+l.rsum)/l.totsamp*0.5+0.0000000000000000000000000000000000001),b=$<=0?0:0|$;b>=l.A.length&&(b=l.A.length-1),l.A[b]++,l.lsum=l.rsum=0,li.arraycopy(l.loutbuf,l.totsamp,l.loutbuf,0,MAX_ORDER),li.arraycopy(l.routbuf,l.totsamp,l.routbuf,0,MAX_ORDER),li.arraycopy(l.lstepbuf,l.totsamp,l.lstepbuf,0,MAX_ORDER),li.arraycopy(l.rstepbuf,l.totsamp,l.rstepbuf,0,MAX_ORDER),l.totsamp=0}if(l.totsamp>l.sampleWindow)return GAIN_ANALYSIS_ERROR}return _<MAX_ORDER?(li.arraycopy(l.linprebuf,_,l.linprebuf,0,MAX_ORDER-_),li.arraycopy(l.rinprebuf,_,l.rinprebuf,0,MAX_ORDER-_),li.arraycopy(Z,V,l.linprebuf,MAX_ORDER-_,_),li.arraycopy(M,I,l.rinprebuf,MAX_ORDER-_,_)):(li.arraycopy(Z,V+_-MAX_ORDER,l.linprebuf,0,MAX_ORDER),li.arraycopy(M,I+_-MAX_ORDER,l.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function p(l,Z){var V,M=0;for(V=0;V<Z;V++)M+=l[V];if(M==0)return GAIN_NOT_ENOUGH_SAMPLES;var I=0|Math.ceil(M*(1-e));for(V=Z;V-- >0&&!((I-=l[V])<=0););return t-V/Bt.STEPS_per_dB}this.GetTitleGain=function(l){for(var Z=p(l.A,l.A.length),V=0;V<l.A.length;V++)l.B[V]+=l.A[V],l.A[V]=0;for(var V=0;V<MAX_ORDER;V++)l.linprebuf[V]=l.lstepbuf[V]=l.loutbuf[V]=l.rinprebuf[V]=l.rstepbuf[V]=l.routbuf[V]=0;return l.totsamp=0,l.lsum=l.rsum=0,Z}}var lr=Bt,ar=Et,Si=ar.new_float,Fe=ar.new_int,ai=lr;function Lo(){this.linprebuf=Si(ai.MAX_ORDER*2),this.linpre=0,this.lstepbuf=Si(ai.MAX_SAMPLES_PER_WINDOW+ai.MAX_ORDER),this.lstep=0,this.loutbuf=Si(ai.MAX_SAMPLES_PER_WINDOW+ai.MAX_ORDER),this.lout=0,this.rinprebuf=Si(ai.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=Si(ai.MAX_SAMPLES_PER_WINDOW+ai.MAX_ORDER),this.rstep=0,this.routbuf=Si(ai.MAX_SAMPLES_PER_WINDOW+ai.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Fe(0|ai.STEPS_per_dB*ai.MAX_dB),this.B=Fe(0|ai.STEPS_per_dB*ai.MAX_dB)}var Ko=Lo;function Oo(t){this.bits=t}var cr=Oo,Bn=Et,Qe=Bn.new_float,vo=Bn.new_int,be=Bn.assert,Mo=cr,Xe=ri(),qo=Wn,Vo=Pn;function To(t){var e=t;this.quantize=e,this.iteration_loop=function(d,W,Q,j){var x=d.internal_flags,y=Qe(qo.SFBMAX),U=Qe(576),R=vo(2),p=0,l,Z=x.l3_side,V=new Mo(p);this.quantize.rv.ResvFrameBegin(d,V),p=V.bits;for(var M=0;M<x.mode_gr;M++){l=this.quantize.qupvt.on_pe(d,W,R,p,M,M),x.mode_ext==Xe.MPG_MD_MS_LR&&(this.quantize.ms_convert(x.l3_side,M),this.quantize.qupvt.reduce_side(R,Q[M],p,l));for(var I=0;I<x.channels_out;I++){var _,z,g=Z.tt[M][I];g.block_type!=Xe.SHORT_TYPE?(_=0,z=x.PSY.mask_adjust-_):(_=0,z=x.PSY.mask_adjust_short-_),x.masking_lower=Math.pow(10,z*0.1),this.quantize.init_outer_loop(x,g),this.quantize.init_xrpow(x,g,U)&&(this.quantize.qupvt.calc_xmin(d,j[M][I],g,y),this.quantize.outer_loop(d,g,y,U,I,R[I])),this.quantize.iteration_finish_one(x,M,I),be(g.part2_3_length<=Vo.MAX_BITS_PER_CHANNEL),be(g.part2_3_length<=R[I])}}this.quantize.rv.ResvFrameEnd(x,p)}}var No=To;function vt(t,e,d,W){this.xlen=t,this.linmax=e,this.table=d,this.hlen=W}var pt={};pt.t1HB=[1,1,1,0];pt.t2HB=[1,2,1,3,1,1,3,2,0];pt.t3HB=[3,2,1,1,1,1,3,2,0];pt.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];pt.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];pt.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];pt.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];pt.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];pt.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];pt.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];pt.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];pt.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];pt.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];pt.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];pt.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];pt.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];pt.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];pt.t1l=[1,4,3,5];pt.t2l=[1,4,7,4,5,7,6,7,8];pt.t3l=[2,3,7,4,4,7,6,7,8];pt.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];pt.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];pt.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];pt.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];pt.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];pt.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];pt.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];pt.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];pt.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];pt.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];pt.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];pt.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];pt.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];pt.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];pt.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];pt.ht=[new vt(0,0,null,null),new vt(2,0,pt.t1HB,pt.t1l),new vt(3,0,pt.t2HB,pt.t2l),new vt(3,0,pt.t3HB,pt.t3l),new vt(0,0,null,null),new vt(4,0,pt.t5HB,pt.t5l),new vt(4,0,pt.t6HB,pt.t6l),new vt(6,0,pt.t7HB,pt.t7l),new vt(6,0,pt.t8HB,pt.t8l),new vt(6,0,pt.t9HB,pt.t9l),new vt(8,0,pt.t10HB,pt.t10l),new vt(8,0,pt.t11HB,pt.t11l),new vt(8,0,pt.t12HB,pt.t12l),new vt(16,0,pt.t13HB,pt.t13l),new vt(0,0,null,pt.t16_5l),new vt(16,0,pt.t15HB,pt.t15l),new vt(1,1,pt.t16HB,pt.t16l),new vt(2,3,pt.t16HB,pt.t16l),new vt(3,7,pt.t16HB,pt.t16l),new vt(4,15,pt.t16HB,pt.t16l),new vt(6,63,pt.t16HB,pt.t16l),new vt(8,255,pt.t16HB,pt.t16l),new vt(10,1023,pt.t16HB,pt.t16l),new vt(13,8191,pt.t16HB,pt.t16l),new vt(4,15,pt.t24HB,pt.t24l),new vt(5,31,pt.t24HB,pt.t24l),new vt(6,63,pt.t24HB,pt.t24l),new vt(7,127,pt.t24HB,pt.t24l),new vt(8,255,pt.t24HB,pt.t24l),new vt(9,511,pt.t24HB,pt.t24l),new vt(11,2047,pt.t24HB,pt.t24l),new vt(13,8191,pt.t24HB,pt.t24l),new vt(0,0,pt.t32HB,pt.t32l),new vt(0,0,pt.t33HB,pt.t33l)];pt.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];pt.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];pt.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];pt.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];pt.samplerate_table=[[22050,24000,16000,-1],[44100,48000,32000,-1],[11025,12000,8000,-1]];pt.scfsi_band=[0,6,11,16,21];var Rn=pt,qn,Ue;function pr(){if(Ue)return qn;Ue=1;var t=dr,e=Et,d=e.VbrMode,W=e.Float,Q=e.Util,j=e.new_float,x=e.new_int,y=e.assert,U=ri(),R=cr,p=Pn;l.Q_MAX=257,l.Q_MAX2=116,l.LARGE_BITS=1e5,l.IXMAX_VAL=8206;function l(){var Z=An(),V=null,M=null,I=null;this.setModules=function(J,O,T){V=J,M=O,I=T};function _(J){return y(0<=J+l.Q_MAX2&&J<l.Q_MAX),K[J+l.Q_MAX2]}this.IPOW20=function(J){return y(0<=J&&J<l.Q_MAX),q[J]};var z=0.0000000000000002220446049250313,g=l.IXMAX_VAL,C=g+2,P=l.Q_MAX,i=l.Q_MAX2;l.LARGE_BITS;var c=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var Y=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=Y,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var K=j(P+i+1),q=j(P),$=j(C),b=j(C);this.adj43=b;function ht(J,O){var T=I.ATHformula(O,J);return T-=c,T=Math.pow(10,T/10+J.ATHlower),T}function D(J){for(var O=J.internal_flags.ATH.l,T=J.internal_flags.ATH.psfb21,v=J.internal_flags.ATH.s,it=J.internal_flags.ATH.psfb12,F=J.internal_flags,h=J.out_samplerate,s=0;s<U.SBMAX_l;s++){var r=F.scalefac_band.l[s],a=F.scalefac_band.l[s+1];O[s]=W.MAX_VALUE;for(var f=r;f<a;f++){var E=f*h/1152,et=ht(J,E);O[s]=Math.min(O[s],et)}}for(var s=0;s<U.PSFB21;s++){var r=F.scalefac_band.psfb21[s],a=F.scalefac_band.psfb21[s+1];T[s]=W.MAX_VALUE;for(var f=r;f<a;f++){var E=f*h/1152,et=ht(J,E);T[s]=Math.min(T[s],et)}}for(var s=0;s<U.SBMAX_s;s++){var r=F.scalefac_band.s[s],a=F.scalefac_band.s[s+1];v[s]=W.MAX_VALUE;for(var f=r;f<a;f++){var E=f*h/384,et=ht(J,E);v[s]=Math.min(v[s],et)}v[s]*=F.scalefac_band.s[s+1]-F.scalefac_band.s[s]}for(var s=0;s<U.PSFB12;s++){var r=F.scalefac_band.psfb12[s],a=F.scalefac_band.psfb12[s+1];it[s]=W.MAX_VALUE;for(var f=r;f<a;f++){var E=f*h/384,et=ht(J,E);it[s]=Math.min(it[s],et)}it[s]*=F.scalefac_band.s[13]-F.scalefac_band.s[12]}if(J.noATH){for(var s=0;s<U.SBMAX_l;s++)O[s]=0.00000000000000000001;for(var s=0;s<U.PSFB21;s++)T[s]=0.00000000000000000001;for(var s=0;s<U.SBMAX_s;s++)v[s]=0.00000000000000000001;for(var s=0;s<U.PSFB12;s++)it[s]=0.00000000000000000001}F.ATH.floor=10*Math.log10(ht(J,-1))}this.iteration_init=function(J){var O=J.internal_flags,T=O.l3_side,v;if(O.iteration_init_init==0){for(O.iteration_init_init=1,T.main_data_begin=0,D(J),$[0]=0,v=1;v<C;v++)$[v]=Math.pow(v,1.3333333333333333);for(v=0;v<C-1;v++)b[v]=v+1-Math.pow(0.5*($[v]+$[v+1]),0.75);for(b[v]=0.5,v=0;v<P;v++)q[v]=Math.pow(2,(v-210)*-0.1875);for(v=0;v<=P+i;v++)K[v]=Math.pow(2,(v-210-i)*0.25);V.huffman_init(O);{var it,F,h,s;for(v=J.exp_nspsytune>>2&63,v>=32&&(v-=64),it=Math.pow(10,v/4/10),v=J.exp_nspsytune>>8&63,v>=32&&(v-=64),F=Math.pow(10,v/4/10),v=J.exp_nspsytune>>14&63,v>=32&&(v-=64),h=Math.pow(10,v/4/10),v=J.exp_nspsytune>>20&63,v>=32&&(v-=64),s=h*Math.pow(10,v/4/10),v=0;v<U.SBMAX_l;v++){var r;v<=6?r=it:v<=13?r=F:v<=20?r=h:r=s,O.nsPsy.longfact[v]=r}for(v=0;v<U.SBMAX_s;v++){var r;v<=5?r=it:v<=10?r=F:v<=11?r=h:r=s,O.nsPsy.shortfact[v]=r}}}},this.on_pe=function(J,O,T,v,it,F){var h=J.internal_flags,s=0,r,a=x(2),f,E=new R(s),et=M.ResvMaxBits(J,v,E,F);s=E.bits;var X=s+et;for(X>p.MAX_BITS_PER_GRANULE&&(X=p.MAX_BITS_PER_GRANULE),r=0,f=0;f<h.channels_out;++f)T[f]=Math.min(p.MAX_BITS_PER_CHANNEL,s/h.channels_out),a[f]=0|T[f]*O[it][f]/700-T[f],a[f]>v*3/4&&(a[f]=v*3/4),a[f]<0&&(a[f]=0),a[f]+T[f]>p.MAX_BITS_PER_CHANNEL&&(a[f]=Math.max(0,p.MAX_BITS_PER_CHANNEL-T[f])),r+=a[f];if(r>et)for(f=0;f<h.channels_out;++f)a[f]=et*a[f]/r;for(f=0;f<h.channels_out;++f)T[f]+=a[f],et-=a[f];for(r=0,f=0;f<h.channels_out;++f)r+=T[f];if(r>p.MAX_BITS_PER_GRANULE){var B=0;for(f=0;f<h.channels_out;++f)T[f]*=p.MAX_BITS_PER_GRANULE,T[f]/=r,B+=T[f]}return X},this.reduce_side=function(J,O,T,v){y(J[0]+J[1]<=p.MAX_BITS_PER_GRANULE);var it=0.33*(0.5-O)/0.5;it<0&&(it=0),it>0.5&&(it=0.5);var F=0|it*0.5*(J[0]+J[1]);F>p.MAX_BITS_PER_CHANNEL-J[0]&&(F=p.MAX_BITS_PER_CHANNEL-J[0]),F<0&&(F=0),J[1]>=125&&(J[1]-F>125?(J[0]<T&&(J[0]+=F),J[1]-=F):(J[0]+=J[1]-125,J[1]=125)),F=J[0]+J[1],F>v&&(J[0]=v*J[0]/F,J[1]=v*J[1]/F),y(J[0]<=p.MAX_BITS_PER_CHANNEL),y(J[1]<=p.MAX_BITS_PER_CHANNEL),y(J[0]+J[1]<=p.MAX_BITS_PER_GRANULE)},this.athAdjust=function(J,O,T){var v=90.30873362,it=94.82444863,F=Q.FAST_LOG10_X(O,10),h=J*J,s=0;return F-=T,h>0.00000000000000000001&&(s=1+Q.FAST_LOG10_X(h,10/v)),s<0&&(s=0),F*=s,F+=T+v-it,Math.pow(10,0.1*F)},this.calc_xmin=function(J,O,T,v){var it=0,F=J.internal_flags,h,s=0,r=0,a=F.ATH,f=T.xr,E=J.VBR==d.vbr_mtrh?1:0,et=F.masking_lower;for((J.VBR==d.vbr_mtrh||J.VBR==d.vbr_mt)&&(et=1),h=0;h<T.psy_lmax;h++){var X,B,dt,ut,ft,Dt;J.VBR==d.vbr_rh||J.VBR==d.vbr_mtrh?B=athAdjust(a.adjust,a.l[h],a.floor):B=a.adjust*a.l[h],ft=T.width[h],dt=B/ft,ut=z,Dt=ft>>1,X=0;do{var Pt,Wt;Pt=f[s]*f[s],X+=Pt,ut+=Pt<dt?Pt:dt,s++,Wt=f[s]*f[s],X+=Wt,ut+=Wt<dt?Wt:dt,s++}while(--Dt>0);if(X>B&&r++,h==U.SBPSY_l){var yt=B*F.nsPsy.longfact[h];ut<yt&&(ut=yt)}if(E!=0&&(B=ut),!J.ATHonly){var Vt=O.en.l[h];if(Vt>0){var yt;yt=X*O.thm.l[h]*et/Vt,E!=0&&(yt*=F.nsPsy.longfact[h]),B<yt&&(B=yt)}}E!=0?v[it++]=B:v[it++]=B*F.nsPsy.longfact[h]}var mi=575;if(T.block_type!=U.SHORT_TYPE)for(var o=576;o--!=0&&Z.EQ(f[o],0);)mi=o;T.max_nonzero_coeff=mi;for(var u=T.sfb_smin;h<T.psymax;u++,h+=3){var ft,Ct,zt;for(J.VBR==d.vbr_rh||J.VBR==d.vbr_mtrh?zt=athAdjust(a.adjust,a.s[u],a.floor):zt=a.adjust*a.s[u],ft=T.width[h],Ct=0;Ct<3;Ct++){var X=0,B,dt,ut,Dt=ft>>1;dt=zt/ft,ut=z;do{var Pt,Wt;Pt=f[s]*f[s],X+=Pt,ut+=Pt<dt?Pt:dt,s++,Wt=f[s]*f[s],X+=Wt,ut+=Wt<dt?Wt:dt,s++}while(--Dt>0);if(X>zt&&r++,u==U.SBPSY_s){var yt=zt*F.nsPsy.shortfact[u];ut<yt&&(ut=yt)}if(E!=0?B=ut:B=zt,!J.ATHonly&&!J.ATHshort){var Vt=O.en.s[u][Ct];if(Vt>0){var yt;yt=X*O.thm.s[u][Ct]*et/Vt,E!=0&&(yt*=F.nsPsy.shortfact[u]),B<yt&&(B=yt)}}E!=0?v[it++]=B:v[it++]=B*F.nsPsy.shortfact[u]}J.useTemporal&&(v[it-3]>v[it-3+1]&&(v[it-3+1]+=(v[it-3]-v[it-3+1])*F.decay),v[it-3+1]>v[it-3+2]&&(v[it-3+2]+=(v[it-3+1]-v[it-3+2])*F.decay))}return r};function n(J){this.s=J}this.calc_noise_core=function(J,O,T,v){var it=0,F=O.s,h=J.l3_enc;if(F>J.count1)for(;T--!=0;){var s;s=J.xr[F],F++,it+=s*s,s=J.xr[F],F++,it+=s*s}else if(F>J.big_values){var r=j(2);for(r[0]=0,r[1]=v;T--!=0;){var s;s=Math.abs(J.xr[F])-r[h[F]],F++,it+=s*s,s=Math.abs(J.xr[F])-r[h[F]],F++,it+=s*s}}else for(;T--!=0;){var s;s=Math.abs(J.xr[F])-$[h[F]]*v,F++,it+=s*s,s=Math.abs(J.xr[F])-$[h[F]]*v,F++,it+=s*s}return O.s=F,it},this.calc_noise=function(J,O,T,v,it){var F=0,h=0,s,r,a=0,f=0,E=0,et=-20,X=0,B=J.scalefac,dt=0;for(v.over_SSD=0,s=0;s<J.psymax;s++){var ut=J.global_gain-(B[dt++]+(J.preflag!=0?Y[s]:0)<<J.scalefac_scale+1)-J.subblock_gain[J.window[s]]*8,ft=0;if(it!=null&&it.step[s]==ut)ft=it.noise[s],X+=J.width[s],T[F++]=ft/O[h++],ft=it.noise_log[s];else{var Dt=_(ut);if(r=J.width[s]>>1,X+J.width[s]>J.max_nonzero_coeff){var Pt;Pt=J.max_nonzero_coeff-X+1,Pt>0?r=Pt>>1:r=0}var Wt=new n(X);ft=this.calc_noise_core(J,Wt,r,Dt),X=Wt.s,it!=null&&(it.step[s]=ut,it.noise[s]=ft),ft=T[F++]=ft/O[h++],ft=Q.FAST_LOG10(Math.max(ft,0.00000000000000000001)),it!=null&&(it.noise_log[s]=ft)}if(it!=null&&(it.global_gain=J.global_gain),E+=ft,ft>0){var yt;yt=Math.max(0|ft*10+0.5,1),v.over_SSD+=yt*yt,a++,f+=ft}et=Math.max(et,ft)}return v.over_count=a,v.tot_noise=E,v.over_noise=f,v.max_noise=et,a},this.set_pinfo=function(J,O,T,v,it){var F=J.internal_flags,h,s,r,a,f,E=O.scalefac_scale==0?0.5:1,et=O.scalefac,X=j(L3Side.SFBMAX),B=j(L3Side.SFBMAX),dt=new CalcNoiseResult;calc_xmin(J,T,O,X),calc_noise(O,X,B,dt,null);var ut=0;for(s=O.sfb_lmax,O.block_type!=U.SHORT_TYPE&&O.mixed_block_flag==0&&(s=22),h=0;h<s;h++){var ft=F.scalefac_band.l[h],Dt=F.scalefac_band.l[h+1],Pt=Dt-ft;for(a=0;ut<Dt;ut++)a+=O.xr[ut]*O.xr[ut];a/=Pt,f=1000000000000000,F.pinfo.en[v][it][h]=f*a,F.pinfo.xfsf[v][it][h]=f*X[h]*B[h]/Pt,T.en.l[h]>0&&!J.ATHonly?a=a/T.en.l[h]:a=0,F.pinfo.thr[v][it][h]=f*Math.max(a*T.thm.l[h],F.ATH.l[h]),F.pinfo.LAMEsfb[v][it][h]=0,O.preflag!=0&&h>=11&&(F.pinfo.LAMEsfb[v][it][h]=-E*Y[h]),h<U.SBPSY_l&&(y(et[h]>=0),F.pinfo.LAMEsfb[v][it][h]-=E*et[h])}if(O.block_type==U.SHORT_TYPE)for(s=h,h=O.sfb_smin;h<U.SBMAX_s;h++)for(var ft=F.scalefac_band.s[h],Dt=F.scalefac_band.s[h+1],Pt=Dt-ft,Wt=0;Wt<3;Wt++){for(a=0,r=ft;r<Dt;r++)a+=O.xr[ut]*O.xr[ut],ut++;a=Math.max(a/Pt,0.00000000000000000001),f=1000000000000000,F.pinfo.en_s[v][it][3*h+Wt]=f*a,F.pinfo.xfsf_s[v][it][3*h+Wt]=f*X[s]*B[s]/Pt,T.en.s[h][Wt]>0?a=a/T.en.s[h][Wt]:a=0,(J.ATHonly||J.ATHshort)&&(a=0),F.pinfo.thr_s[v][it][3*h+Wt]=f*Math.max(a*T.thm.s[h][Wt],F.ATH.s[h]),F.pinfo.LAMEsfb_s[v][it][3*h+Wt]=-2*O.subblock_gain[Wt],h<U.SBPSY_s&&(F.pinfo.LAMEsfb_s[v][it][3*h+Wt]-=E*et[s]),s++}F.pinfo.LAMEqss[v][it]=O.global_gain,F.pinfo.LAMEmainbits[v][it]=O.part2_3_length+O.part2_length,F.pinfo.LAMEsfbits[v][it]=O.part2_length,F.pinfo.over[v][it]=dt.over_count,F.pinfo.max_noise[v][it]=dt.max_noise*10,F.pinfo.over_noise[v][it]=dt.over_noise*10,F.pinfo.tot_noise[v][it]=dt.tot_noise*10,F.pinfo.over_SSD[v][it]=dt.over_SSD}}return qn=l,qn}var Vn,xe;function ur(){if(xe)return Vn;xe=1;var t=Et,e=t.System,d=t.Arrays,W=t.new_int,Q=t.assert,j=ri(),x=Rn,y=In,U=pr();function R(){var p=null;this.qupvt=null,this.setModules=function(F){this.qupvt=F,p=F};function l(F){this.bits=0|F}var Z=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function V(F,h,s,r,a,f){var E=0.5946/h;for(F=F>>1;F--!=0;)a[f++]=E>s[r++]?0:1,a[f++]=E>s[r++]?0:1}function M(F,h,s,r,a,f){F=F>>1;var E=F%2;for(F=F>>1;F--!=0;){var et,X,B,dt,ut,ft,Dt,Pt;et=s[r++]*h,X=s[r++]*h,ut=0|et,B=s[r++]*h,ft=0|X,dt=s[r++]*h,Dt=0|B,et+=p.adj43[ut],Pt=0|dt,X+=p.adj43[ft],a[f++]=0|et,B+=p.adj43[Dt],a[f++]=0|X,dt+=p.adj43[Pt],a[f++]=0|B,a[f++]=0|dt}if(E!=0){var et,X,ut,ft;et=s[r++]*h,X=s[r++]*h,ut=0|et,ft=0|X,et+=p.adj43[ut],X+=p.adj43[ft],a[f++]=0|et,a[f++]=0|X}}function I(F,h,s,r,a){var f,E,et=0,X,B=0,dt=0,ut=0,ft=h,Dt=0,Pt=ft,Wt=0,yt=F,Vt=0;for(X=a!=null&&r.global_gain==a.global_gain,r.block_type==j.SHORT_TYPE?E=38:E=21,f=0;f<=E;f++){var mi=-1;if((X||r.block_type==j.NORM_TYPE)&&(mi=r.global_gain-(r.scalefac[f]+(r.preflag!=0?p.pretab[f]:0)<<r.scalefac_scale+1)-r.subblock_gain[r.window[f]]*8),Q(r.width[f]>=0),X&&a.step[f]==mi)B!=0&&(M(B,s,yt,Vt,Pt,Wt),B=0),dt!=0&&(V(dt,s,yt,Vt,Pt,Wt),dt=0);else{var o=r.width[f];if(et+r.width[f]>r.max_nonzero_coeff){var u;u=r.max_nonzero_coeff-et+1,d.fill(h,r.max_nonzero_coeff,576,0),o=u,o<0&&(o=0),f=E+1}if(B==0&&dt==0&&(Pt=ft,Wt=Dt,yt=F,Vt=ut),a!=null&&a.sfb_count1>0&&f>=a.sfb_count1&&a.step[f]>0&&mi>=a.step[f]?(B!=0&&(M(B,s,yt,Vt,Pt,Wt),B=0,Pt=ft,Wt=Dt,yt=F,Vt=ut),dt+=o):(dt!=0&&(V(dt,s,yt,Vt,Pt,Wt),dt=0,Pt=ft,Wt=Dt,yt=F,Vt=ut),B+=o),o<=0){dt!=0&&(V(dt,s,yt,Vt,Pt,Wt),dt=0),B!=0&&(M(B,s,yt,Vt,Pt,Wt),B=0);break}}f<=E&&(Dt+=r.width[f],ut+=r.width[f],et+=r.width[f])}B!=0&&(M(B,s,yt,Vt,Pt,Wt),B=0),dt!=0&&(V(dt,s,yt,Vt,Pt,Wt),dt=0)}function _(F,h,s){var r=0,a=0;do{var f=F[h++],E=F[h++];r<f&&(r=f),a<E&&(a=E)}while(h<s);return r<a&&(r=a),r}function z(F,h,s,r,a,f){var E=x.ht[r].xlen*65536+x.ht[a].xlen,et=0,X;do{var B=F[h++],dt=F[h++];B!=0&&(B>14&&(B=15,et+=E),B*=16),dt!=0&&(dt>14&&(dt=15,et+=E),B+=dt),et+=x.largetbl[B]}while(h<s);return X=et&65535,et>>=16,et>X&&(et=X,r=a),f.bits+=et,r}function g(F,h,s,r){var a=0,f=x.ht[1].hlen;do{var E=F[h+0]*2+F[h+1];h+=2,a+=f[E]}while(h<s);return r.bits+=a,1}function C(F,h,s,r,a){var f=0,E,et=x.ht[r].xlen,X;r==2?X=x.table23:X=x.table56;do{var B=F[h+0]*et+F[h+1];h+=2,f+=X[B]}while(h<s);return E=f&65535,f>>=16,f>E&&(f=E,r++),a.bits+=f,r}function P(F,h,s,r,a){var f=0,E=0,et=0,X=x.ht[r].xlen,B=x.ht[r].hlen,dt=x.ht[r+1].hlen,ut=x.ht[r+2].hlen;do{var ft=F[h+0]*X+F[h+1];h+=2,f+=B[ft],E+=dt[ft],et+=ut[ft]}while(h<s);var Dt=r;return f>E&&(f=E,Dt++),f>et&&(f=et,Dt=r+2),a.bits+=f,Dt}var i=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function c(F,h,s,r){var a=_(F,h,s);switch(a){case 0:return a;case 1:return g(F,h,s,r);case 2:case 3:return C(F,h,s,i[a-1],r);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return P(F,h,s,i[a-1],r);default:if(a>U.IXMAX_VAL)return r.bits=U.LARGE_BITS,-1;a-=15;var f;for(f=24;f<32&&!(x.ht[f].linmax>=a);f++);var E;for(E=f-8;E<24&&!(x.ht[E].linmax>=a);E++);return z(F,h,s,E,f,r)}}this.noquant_count_bits=function(F,h,s){var r=h.l3_enc,a=Math.min(576,h.max_nonzero_coeff+2>>1<<1);for(s!=null&&(s.sfb_count1=0);a>1&&!(r[a-1]|r[a-2]);a-=2);h.count1=a;for(var f=0,E=0;a>3;a-=4){var et;if(((r[a-1]|r[a-2]|r[a-3]|r[a-4])&2147483647)>1)break;et=((r[a-4]*2+r[a-3])*2+r[a-2])*2+r[a-1],f+=x.t32l[et],E+=x.t33l[et]}var X=f;if(h.count1table_select=0,f>E&&(X=E,h.count1table_select=1),h.count1bits=X,h.big_values=a,a==0)return X;if(h.block_type==j.SHORT_TYPE)f=3*F.scalefac_band.s[3],f>h.big_values&&(f=h.big_values),E=h.big_values;else if(h.block_type==j.NORM_TYPE){if(f=h.region0_count=F.bv_scf[a-2],E=h.region1_count=F.bv_scf[a-1],Q(f+E+2<j.SBPSY_l),E=F.scalefac_band.l[f+E+2],f=F.scalefac_band.l[f+1],E<a){var B=new l(X);h.table_select[2]=c(r,E,a,B),X=B.bits}}else h.region0_count=7,h.region1_count=j.SBMAX_l-1-7-1,f=F.scalefac_band.l[8],E=a,f>E&&(f=E);if(f=Math.min(f,a),E=Math.min(E,a),0<f){var B=new l(X);h.table_select[0]=c(r,0,f,B),X=B.bits}if(f<E){var B=new l(X);h.table_select[1]=c(r,f,E,B),X=B.bits}if(F.use_best_huffman==2&&(h.part2_3_length=X,best_huffman_divide(F,h),X=h.part2_3_length),s!=null&&h.block_type==j.NORM_TYPE){for(var dt=0;F.scalefac_band.l[dt]<h.big_values;)dt++;s.sfb_count1=dt}return X},this.count_bits=function(F,h,s,r){var a=s.l3_enc,f=U.IXMAX_VAL/p.IPOW20(s.global_gain);if(s.xrpow_max>f)return U.LARGE_BITS;if(I(h,a,p.IPOW20(s.global_gain),s,r),F.substep_shaping&2)for(var E=0,et=s.global_gain+s.scalefac_scale,X=0.634521682242439/p.IPOW20(et),B=0;B<s.sfbmax;B++){var dt=s.width[B];if(F.pseudohalf[B]==0)E+=dt;else{var ut;for(ut=E,E+=dt;ut<E;++ut)a[ut]=h[ut]>=X?a[ut]:0}}return this.noquant_count_bits(F,s,r)};function Y(F,h,s,r,a,f,E){for(var et=h.big_values,X=0;X<=22;X++)r[X]=U.LARGE_BITS;for(var X=0;X<16;X++){var B=F.scalefac_band.l[X+1];if(B>=et)break;var dt=0,ut=new l(dt),ft=c(s,0,B,ut);dt=ut.bits;for(var Dt=0;Dt<8;Dt++){var Pt=F.scalefac_band.l[X+Dt+2];if(Pt>=et)break;var Wt=dt;ut=new l(Wt);var yt=c(s,B,Pt,ut);Wt=ut.bits,r[X+Dt]>Wt&&(r[X+Dt]=Wt,a[X+Dt]=X,f[X+Dt]=ft,E[X+Dt]=yt)}}}function K(F,h,s,r,a,f,E,et){for(var X=h.big_values,B=2;B<j.SBMAX_l+1;B++){var dt=F.scalefac_band.l[B];if(dt>=X)break;var ut=a[B-2]+h.count1bits;if(s.part2_3_length<=ut)break;var ft=new l(ut),Dt=c(r,dt,X,ft);ut=ft.bits,!(s.part2_3_length<=ut)&&(s.assign(h),s.part2_3_length=ut,s.region0_count=f[B-2],s.region1_count=B-2-f[B-2],s.table_select[0]=E[B-2],s.table_select[1]=et[B-2],s.table_select[2]=Dt)}}this.best_huffman_divide=function(F,h){var s=new y,r=h.l3_enc,a=W(23),f=W(23),E=W(23),et=W(23);if(!(h.block_type==j.SHORT_TYPE&&F.mode_gr==1)){s.assign(h),h.block_type==j.NORM_TYPE&&(Y(F,h,r,a,f,E,et),K(F,s,h,r,a,f,E,et));var X=s.big_values;if(!(X==0||(r[X-2]|r[X-1])>1)&&(X=h.count1+2,!(X>576))){s.assign(h),s.count1=X;for(var B=0,dt=0;X>s.big_values;X-=4){var ut=((r[X-4]*2+r[X-3])*2+r[X-2])*2+r[X-1];B+=x.t32l[ut],dt+=x.t33l[ut]}if(s.big_values=X,s.count1table_select=0,B>dt&&(B=dt,s.count1table_select=1),s.count1bits=B,s.block_type==j.NORM_TYPE)K(F,s,h,r,a,f,E,et);else{if(s.part2_3_length=B,B=F.scalefac_band.l[8],B>X&&(B=X),B>0){var ft=new l(s.part2_3_length);s.table_select[0]=c(r,0,B,ft),s.part2_3_length=ft.bits}if(X>B){var ft=new l(s.part2_3_length);s.table_select[1]=c(r,B,X,ft),s.part2_3_length=ft.bits}h.part2_3_length>s.part2_3_length&&h.assign(s)}}}};var q=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],$=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],b=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],ht=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];R.slen1_tab=b,R.slen2_tab=ht;function D(F,h){for(var s,r=h.tt[1][F],a=h.tt[0][F],f=0;f<x.scfsi_band.length-1;f++){for(s=x.scfsi_band[f];s<x.scfsi_band[f+1]&&!(a.scalefac[s]!=r.scalefac[s]&&r.scalefac[s]>=0);s++);if(s==x.scfsi_band[f+1]){for(s=x.scfsi_band[f];s<x.scfsi_band[f+1];s++)r.scalefac[s]=-1;h.scfsi[F][f]=1}}var E=0,et=0;for(s=0;s<11;s++)r.scalefac[s]!=-1&&(et++,E<r.scalefac[s]&&(E=r.scalefac[s]));for(var X=0,B=0;s<j.SBPSY_l;s++)r.scalefac[s]!=-1&&(B++,X<r.scalefac[s]&&(X=r.scalefac[s]));for(var f=0;f<16;f++)if(E<q[f]&&X<$[f]){var dt=b[f]*et+ht[f]*B;r.part2_length>dt&&(r.part2_length=dt,r.scalefac_compress=f)}}this.best_scalefac_store=function(F,h,s,r){var a=r.tt[h][s],f,E,et,X,B=0;for(et=0,f=0;f<a.sfbmax;f++){var dt=a.width[f];for(et+=dt,X=-dt;X<0&&a.l3_enc[X+et]==0;X++);X==0&&(a.scalefac[f]=B=-2)}if(a.scalefac_scale==0&&a.preflag==0){var ut=0;for(f=0;f<a.sfbmax;f++)a.scalefac[f]>0&&(ut|=a.scalefac[f]);if(!(ut&1)&&ut!=0){for(f=0;f<a.sfbmax;f++)a.scalefac[f]>0&&(a.scalefac[f]>>=1);a.scalefac_scale=B=1}}if(a.preflag==0&&a.block_type!=j.SHORT_TYPE&&F.mode_gr==2){for(f=11;f<j.SBPSY_l&&!(a.scalefac[f]<p.pretab[f]&&a.scalefac[f]!=-2);f++);if(f==j.SBPSY_l){for(f=11;f<j.SBPSY_l;f++)a.scalefac[f]>0&&(a.scalefac[f]-=p.pretab[f]);a.preflag=B=1}}for(E=0;E<4;E++)r.scfsi[s][E]=0;for(F.mode_gr==2&&h==1&&r.tt[0][s].block_type!=j.SHORT_TYPE&&r.tt[1][s].block_type!=j.SHORT_TYPE&&(D(s,r),B=0),f=0;f<a.sfbmax;f++)a.scalefac[f]==-2&&(a.scalefac[f]=0);B!=0&&(F.mode_gr==2?this.scale_bitcount(a):this.scale_bitcount_lsf(F,a))};function n(F,h){for(var s=0;s<h;++s)if(F[s]<0)return!1;return!0}var J=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],O=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],T=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(F){var h,s,r=0,a=0,f,E=F.scalefac;if(Q(n(E,F.sfbmax)),F.block_type==j.SHORT_TYPE)f=J,F.mixed_block_flag!=0&&(f=O);else if(f=T,F.preflag==0){for(s=11;s<j.SBPSY_l&&!(E[s]<p.pretab[s]);s++);if(s==j.SBPSY_l)for(F.preflag=1,s=11;s<j.SBPSY_l;s++)E[s]-=p.pretab[s]}for(s=0;s<F.sfbdivide;s++)r<E[s]&&(r=E[s]);for(;s<F.sfbmax;s++)a<E[s]&&(a=E[s]);for(F.part2_length=U.LARGE_BITS,h=0;h<16;h++)r<q[h]&&a<$[h]&&F.part2_length>f[h]&&(F.part2_length=f[h],F.scalefac_compress=h);return F.part2_length==U.LARGE_BITS};var v=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(F,h){var s,r,a,f,E,et,X,B,dt=W(4),ut=h.scalefac;for(h.preflag!=0?s=2:s=0,X=0;X<4;X++)dt[X]=0;if(h.block_type==j.SHORT_TYPE){r=1;var ft=p.nr_of_sfb_block[s][r];for(B=0,a=0;a<4;a++)for(f=ft[a]/3,X=0;X<f;X++,B++)for(E=0;E<3;E++)ut[B*3+E]>dt[a]&&(dt[a]=ut[B*3+E])}else{r=0;var ft=p.nr_of_sfb_block[s][r];for(B=0,a=0;a<4;a++)for(f=ft[a],X=0;X<f;X++,B++)ut[B]>dt[a]&&(dt[a]=ut[B])}for(et=!1,a=0;a<4;a++)dt[a]>v[s][a]&&(et=!0);if(!et){var Dt,Pt,Wt,yt;for(h.sfb_partition_table=p.nr_of_sfb_block[s][r],a=0;a<4;a++)h.slen[a]=it[dt[a]];switch(Dt=h.slen[0],Pt=h.slen[1],Wt=h.slen[2],yt=h.slen[3],s){case 0:h.scalefac_compress=(Dt*5+Pt<<4)+(Wt<<2)+yt;break;case 1:h.scalefac_compress=400+(Dt*5+Pt<<2)+Wt;break;case 2:h.scalefac_compress=500+Dt*3+Pt;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!et)for(Q(h.sfb_partition_table!=null),h.part2_length=0,a=0;a<4;a++)h.part2_length+=h.slen[a]*h.sfb_partition_table[a];return et};var it=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(F){for(var h=2;h<=576;h+=2){for(var s=0,r;F.scalefac_band.l[++s]<h;);for(r=Z[s][0];F.scalefac_band.l[r+1]>h;)r--;for(r<0&&(r=Z[s][0]),F.bv_scf[h-2]=r,r=Z[s][1];F.scalefac_band.l[r+F.bv_scf[h-2]+2]>h;)r--;r<0&&(r=Z[s][1]),F.bv_scf[h-1]=r}}}return Vn=R,Vn}var Tn,Le;function An(){if(Le)return Tn;Le=1;var t=Et,e=t.System,d=t.Arrays,W=t.new_byte,Q=t.new_float_n,j=t.new_int,x=t.assert,y=ur(),U=Rn,R=ri(),p=Pn;l.EQ=function(Z,V){return Math.abs(Z)>Math.abs(V)?Math.abs(Z-V)<=Math.abs(Z)*0.000001:Math.abs(Z-V)<=Math.abs(V)*0.000001},l.NEQ=function(Z,V){return!l.EQ(Z,V)};function l(){var Z=te(),V=this,M=32773,I=null,_=null,z=null,g=null;this.setModules=function(h,s,r,a){I=h,_=s,z=r,g=a};var C=null,P=0,i=0,c=0;this.getframebits=function(h){var s=h.internal_flags,r;s.bitrate_index!=0?r=U.bitrate_table[h.version][s.bitrate_index]:r=h.brate;var a=0|(h.version+1)*72000*r/h.out_samplerate+s.padding;return 8*a};function Y(h){e.arraycopy(h.header[h.w_ptr].buf,0,C,i,h.sideinfo_len),i+=h.sideinfo_len,P+=h.sideinfo_len*8,h.w_ptr=h.w_ptr+1&p.MAX_HEADER_BUF-1}function K(h,s,r){for(;r>0;){var a;c==0&&(c=8,i++,x(i<Z.LAME_MAXMP3BUFFER),x(h.header[h.w_ptr].write_timing>=P),h.header[h.w_ptr].write_timing==P&&Y(h),C[i]=0),a=Math.min(r,c),r-=a,c-=a,C[i]|=s>>r<<c,P+=a}}function q(h,s,r){for(;r>0;){var a;c==0&&(c=8,i++,x(i<Z.LAME_MAXMP3BUFFER),C[i]=0),a=Math.min(r,c),r-=a,c-=a,C[i]|=s>>r<<c,P+=a}}function $(h,s){var r=h.internal_flags,a;if(s>=8&&(K(r,76,8),s-=8),s>=8&&(K(r,65,8),s-=8),s>=8&&(K(r,77,8),s-=8),s>=8&&(K(r,69,8),s-=8),s>=32){var f=z.getLameShortVersion();if(s>=32)for(a=0;a<f.length&&s>=8;++a)s-=8,K(r,f.charAt(a),8)}for(;s>=1;s-=1)K(r,r.ancillary_flag,1),r.ancillary_flag^=h.disable_reservoir?0:1}function b(h,s,r){for(var a=h.header[h.h_ptr].ptr;r>0;){var f=Math.min(r,8-(a&7));r-=f,h.header[h.h_ptr].buf[a>>3]|=s>>r<<8-(a&7)-f,a+=f}h.header[h.h_ptr].ptr=a}function ht(h,s){h<<=8;for(var r=0;r<8;r++)h<<=1,s<<=1,(s^h)&65536&&(s^=M);return s}this.CRC_writeheader=function(h,s){var r=65535;r=ht(s[2]&255,r),r=ht(s[3]&255,r);for(var a=6;a<h.sideinfo_len;a++)r=ht(s[a]&255,r);s[4]=byte(r>>8),s[5]=byte(r&255)};function D(h,s){var r=h.internal_flags,a,f,E;if(a=r.l3_side,r.header[r.h_ptr].ptr=0,d.fill(r.header[r.h_ptr].buf,0,r.sideinfo_len,0),h.out_samplerate<16000?b(r,4094,12):b(r,4095,12),b(r,h.version,1),b(r,1,2),b(r,h.error_protection?0:1,1),b(r,r.bitrate_index,4),b(r,r.samplerate_index,2),b(r,r.padding,1),b(r,h.extension,1),b(r,h.mode.ordinal(),2),b(r,r.mode_ext,2),b(r,h.copyright,1),b(r,h.original,1),b(r,h.emphasis,2),h.error_protection&&b(r,0,16),h.version==1){for(x(a.main_data_begin>=0),b(r,a.main_data_begin,9),r.channels_out==2?b(r,a.private_bits,3):b(r,a.private_bits,5),E=0;E<r.channels_out;E++){var et;for(et=0;et<4;et++)b(r,a.scfsi[E][et],1)}for(f=0;f<2;f++)for(E=0;E<r.channels_out;E++){var X=a.tt[f][E];b(r,X.part2_3_length+X.part2_length,12),b(r,X.big_values/2,9),b(r,X.global_gain,8),b(r,X.scalefac_compress,4),X.block_type!=R.NORM_TYPE?(b(r,1,1),b(r,X.block_type,2),b(r,X.mixed_block_flag,1),X.table_select[0]==14&&(X.table_select[0]=16),b(r,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),b(r,X.table_select[1],5),b(r,X.subblock_gain[0],3),b(r,X.subblock_gain[1],3),b(r,X.subblock_gain[2],3)):(b(r,0,1),X.table_select[0]==14&&(X.table_select[0]=16),b(r,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),b(r,X.table_select[1],5),X.table_select[2]==14&&(X.table_select[2]=16),b(r,X.table_select[2],5),x(0<=X.region0_count&&X.region0_count<16),x(0<=X.region1_count&&X.region1_count<8),b(r,X.region0_count,4),b(r,X.region1_count,3)),b(r,X.preflag,1),b(r,X.scalefac_scale,1),b(r,X.count1table_select,1)}}else for(x(a.main_data_begin>=0),b(r,a.main_data_begin,8),b(r,a.private_bits,r.channels_out),f=0,E=0;E<r.channels_out;E++){var X=a.tt[f][E];b(r,X.part2_3_length+X.part2_length,12),b(r,X.big_values/2,9),b(r,X.global_gain,8),b(r,X.scalefac_compress,9),X.block_type!=R.NORM_TYPE?(b(r,1,1),b(r,X.block_type,2),b(r,X.mixed_block_flag,1),X.table_select[0]==14&&(X.table_select[0]=16),b(r,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),b(r,X.table_select[1],5),b(r,X.subblock_gain[0],3),b(r,X.subblock_gain[1],3),b(r,X.subblock_gain[2],3)):(b(r,0,1),X.table_select[0]==14&&(X.table_select[0]=16),b(r,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),b(r,X.table_select[1],5),X.table_select[2]==14&&(X.table_select[2]=16),b(r,X.table_select[2],5),x(0<=X.region0_count&&X.region0_count<16),x(0<=X.region1_count&&X.region1_count<8),b(r,X.region0_count,4),b(r,X.region1_count,3)),b(r,X.scalefac_scale,1),b(r,X.count1table_select,1)}h.error_protection&&CRC_writeheader(r,r.header[r.h_ptr].buf);{var B=r.h_ptr;x(r.header[B].ptr==r.sideinfo_len*8),r.h_ptr=B+1&p.MAX_HEADER_BUF-1,r.header[r.h_ptr].write_timing=r.header[B].write_timing+s,r.h_ptr==r.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function n(h,s){var r=U.ht[s.count1table_select+32],a,f=0,E=s.big_values,et=s.big_values;for(x(s.count1table_select<2),a=(s.count1-s.big_values)/4;a>0;--a){var X=0,B=0,dt;dt=s.l3_enc[E+0],dt!=0&&(B+=8,s.xr[et+0]<0&&X++),dt=s.l3_enc[E+1],dt!=0&&(B+=4,X*=2,s.xr[et+1]<0&&X++),dt=s.l3_enc[E+2],dt!=0&&(B+=2,X*=2,s.xr[et+2]<0&&X++),dt=s.l3_enc[E+3],dt!=0&&(B++,X*=2,s.xr[et+3]<0&&X++),E+=4,et+=4,K(h,X+r.table[B],r.hlen[B]),f+=r.hlen[B]}return f}function J(h,s,r,a,f){var E=U.ht[s],et=0;if(s==0)return et;for(var X=r;X<a;X+=2){var B=0,dt=0,ut=E.xlen,ft=E.xlen,Dt=0,Pt=f.l3_enc[X],Wt=f.l3_enc[X+1];if(Pt!=0&&(f.xr[X]<0&&Dt++,B--),s>15){if(Pt>14){var yt=Pt-15;x(yt<=E.linmax),Dt|=yt<<1,dt=ut,Pt=15}if(Wt>14){var Vt=Wt-15;x(Vt<=E.linmax),Dt<<=ut,Dt|=Vt,dt+=ut,Wt=15}ft=16}Wt!=0&&(Dt<<=1,f.xr[X+1]<0&&Dt++,B--),Pt=Pt*ft+Wt,dt-=B,B+=E.hlen[Pt],K(h,E.table[Pt],B),K(h,Dt,dt),et+=B+dt}return et}function O(h,s){var r=3*h.scalefac_band.s[3];r>s.big_values&&(r=s.big_values);var a=J(h,s.table_select[0],0,r,s);return a+=J(h,s.table_select[1],r,s.big_values,s),a}function T(h,s){var r,a,f,E;r=s.big_values;var et=s.region0_count+1;return x(et<h.scalefac_band.l.length),f=h.scalefac_band.l[et],et+=s.region1_count+1,x(et<h.scalefac_band.l.length),E=h.scalefac_band.l[et],f>r&&(f=r),E>r&&(E=r),a=J(h,s.table_select[0],0,f,s),a+=J(h,s.table_select[1],f,E,s),a+=J(h,s.table_select[2],E,r,s),a}function v(h){var s,r,a,f,E=0,et=h.internal_flags,X=et.l3_side;if(h.version==1)for(s=0;s<2;s++)for(r=0;r<et.channels_out;r++){var B=X.tt[s][r],dt=y.slen1_tab[B.scalefac_compress],ut=y.slen2_tab[B.scalefac_compress];for(f=0,a=0;a<B.sfbdivide;a++)B.scalefac[a]!=-1&&(K(et,B.scalefac[a],dt),f+=dt);for(;a<B.sfbmax;a++)B.scalefac[a]!=-1&&(K(et,B.scalefac[a],ut),f+=ut);x(f==B.part2_length),B.block_type==R.SHORT_TYPE?f+=O(et,B):f+=T(et,B),f+=n(et,B),x(f==B.part2_3_length+B.part2_length),E+=f}else for(s=0,r=0;r<et.channels_out;r++){var B=X.tt[s][r],ft,Dt,Pt=0;if(x(B.sfb_partition_table!=null),f=0,a=0,Dt=0,B.block_type==R.SHORT_TYPE){for(;Dt<4;Dt++){var Wt=B.sfb_partition_table[Dt]/3,yt=B.slen[Dt];for(ft=0;ft<Wt;ft++,a++)K(et,Math.max(B.scalefac[a*3+0],0),yt),K(et,Math.max(B.scalefac[a*3+1],0),yt),K(et,Math.max(B.scalefac[a*3+2],0),yt),Pt+=3*yt}f+=O(et,B)}else{for(;Dt<4;Dt++){var Wt=B.sfb_partition_table[Dt],yt=B.slen[Dt];for(ft=0;ft<Wt;ft++,a++)K(et,Math.max(B.scalefac[a],0),yt),Pt+=yt}f+=T(et,B)}f+=n(et,B),x(f==B.part2_3_length),x(Pt==B.part2_length),E+=Pt+f}return E}function it(){this.total=0}function F(h,s){var r=h.internal_flags,a,f,E,et,X;return X=r.w_ptr,et=r.h_ptr-1,et==-1&&(et=p.MAX_HEADER_BUF-1),a=r.header[et].write_timing-P,s.total=a,a>=0&&(f=1+et-X,et<X&&(f=1+et-X+p.MAX_HEADER_BUF),a-=f*8*r.sideinfo_len),E=V.getframebits(h),a+=E,s.total+=E,s.total%8!=0?s.total=1+s.total/8:s.total=s.total/8,s.total+=i+1,a<0&&e.err.println(`strange error flushing buffer ... 
`),a}this.flush_bitstream=function(h){var s=h.internal_flags,r,a,f=s.h_ptr-1;if(f==-1&&(f=p.MAX_HEADER_BUF-1),r=s.l3_side,!((a=F(h,new it))<0)){if($(h,a),x(s.header[f].write_timing+this.getframebits(h)==P),s.ResvSize=0,r.main_data_begin=0,s.findReplayGain){var E=I.GetTitleGain(s.rgdata);x(NEQ(E,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),s.RadioGain=Math.floor(E*10+0.5)|0}s.findPeakSample&&(s.noclipGainChange=Math.ceil(Math.log10(s.PeakSample/32767)*20*10)|0,s.noclipGainChange>0&&(EQ(h.scale,1)||EQ(h.scale,0))?s.noclipScale=Math.floor(32767/s.PeakSample*100)/100:s.noclipScale=-1)}},this.add_dummy_byte=function(h,s,r){for(var a=h.internal_flags,f;r-- >0;)for(q(a,s,8),f=0;f<p.MAX_HEADER_BUF;++f)a.header[f].write_timing+=8},this.format_bitstream=function(h){var s=h.internal_flags,r;r=s.l3_side;var a=this.getframebits(h);$(h,r.resvDrain_pre),D(h,a);var f=8*s.sideinfo_len;if(f+=v(h),$(h,r.resvDrain_post),f+=r.resvDrain_post,r.main_data_begin+=(a-f)/8,F(h,new it)!=s.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),r.main_data_begin*8!=s.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*r.main_data_begin,s.ResvSize,r.resvDrain_post,r.resvDrain_pre,8*s.sideinfo_len,f-r.resvDrain_post-8*s.sideinfo_len,f,f%8,a),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),s.ResvSize=r.main_data_begin*8),P>1e9){var E;for(E=0;E<p.MAX_HEADER_BUF;++E)s.header[E].write_timing-=P;P=0}return 0},this.copy_buffer=function(h,s,r,a,f){var E=i+1;if(E<=0)return 0;if(a!=0&&E>a)return-1;if(e.arraycopy(C,0,s,r,E),i=-1,c=0,f!=0){var et=j(1);if(et[0]=h.nMusicCRC,g.updateMusicCRC(et,s,r,E),h.nMusicCRC=et[0],E>0&&(h.VBR_seek_table.nBytesWritten+=E),h.decode_on_the_fly){for(var X=Q([2,1152]),B=E,dt=-1,ut;dt!=0;)if(dt=_.hip_decode1_unclipped(h.hip,s,r,B,X[0],X[1]),B=0,dt==-1&&(dt=0),dt>0){if(h.findPeakSample){for(ut=0;ut<dt;ut++)X[0][ut]>h.PeakSample?h.PeakSample=X[0][ut]:-X[0][ut]>h.PeakSample&&(h.PeakSample=-X[0][ut]);if(h.channels_out>1)for(ut=0;ut<dt;ut++)X[1][ut]>h.PeakSample?h.PeakSample=X[1][ut]:-X[1][ut]>h.PeakSample&&(h.PeakSample=-X[1][ut])}if(h.findReplayGain&&I.AnalyzeSamples(h.rgdata,X[0],0,X[1],0,dt,h.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return E},this.init_bit_stream_w=function(h){C=W(Z.LAME_MAXMP3BUFFER),h.h_ptr=h.w_ptr=0,h.header[h.h_ptr].write_timing=0,i=-1,c=0,P=0}}return Tn=l,Tn}var Nn,Ke;function te(){if(Ke)return Nn;Ke=1;var t=Et,e=t.System,d=t.VbrMode,W=t.ShortBlock,Q=t.new_float,j=t.new_int_n,x=t.new_short_n,y=t.assert,U=lo,R=po,p=Pn,l=xo,Z=Ko,V=No,M=An(),I=Rn,_=ri();function z(){var g=ln,C=this,P=131072;z.V9=410,z.V8=420,z.V7=430,z.V6=440,z.V5=450,z.V4=460,z.V3=470,z.V2=480,z.V1=490,z.V0=500,z.R3MIX=1000,z.STANDARD=1001,z.EXTREME=1002,z.INSANE=1003,z.STANDARD_FAST=1004,z.EXTREME_FAST=1005,z.MEDIUM=1006,z.MEDIUM_FAST=1007;var i=16384+P;z.LAME_MAXMP3BUFFER=i;var c,Y,K,q,$,b=new U,ht,D,n;this.enc=new _,this.setModules=function(o,u,Ct,zt,bt,Qt,Gt,Yt,xt){c=o,Y=u,K=Ct,q=zt,$=bt,ht=Qt,D=Yt,n=xt,this.enc.setModules(Y,b,q,ht)};function J(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=Q(_.SBMAX_l),this.bo_s_weight=Q(_.SBMAX_s)}function O(){this.lowerlimit=0}function T(o,u){this.lowpass=u}var v=4294479419;function it(o){var u;return o.class_id=v,u=o.internal_flags=new p,o.mode=g.NOT_SET,o.original=1,o.in_samplerate=44100,o.num_channels=2,o.num_samples=-1,o.bWriteVbrTag=!0,o.quality=-1,o.short_blocks=null,u.subblock_gain=-1,o.lowpassfreq=0,o.highpassfreq=0,o.lowpasswidth=-1,o.highpasswidth=-1,o.VBR=d.vbr_off,o.VBR_q=4,o.ATHcurve=-1,o.VBR_mean_bitrate_kbps=128,o.VBR_min_bitrate_kbps=0,o.VBR_max_bitrate_kbps=0,o.VBR_hard_min=0,u.VBR_min_bitrate=1,u.VBR_max_bitrate=13,o.quant_comp=-1,o.quant_comp_short=-1,o.msfix=-1,u.resample_ratio=1,u.OldValue[0]=180,u.OldValue[1]=180,u.CurrentStep[0]=4,u.CurrentStep[1]=4,u.masking_lower=1,u.nsPsy.attackthre=-1,u.nsPsy.attackthre_s=-1,o.scale=-1,o.athaa_type=-1,o.ATHtype=-1,o.athaa_loudapprox=-1,o.athaa_sensitivity=0,o.useTemporal=null,o.interChRatio=-1,u.mf_samples_to_encode=_.ENCDELAY+_.POSTDELAY,o.encoder_padding=0,u.mf_size=_.ENCDELAY-_.MDCTDELAY,o.findReplayGain=!1,o.decode_on_the_fly=!1,u.decode_on_the_fly=!1,u.findReplayGain=!1,u.findPeakSample=!1,u.RadioGain=0,u.AudiophileGain=0,u.noclipGainChange=0,u.noclipScale=-1,o.preset=0,o.write_id3tag_automatic=!0,0}this.lame_init=function(){var o=new R;return it(o),o.lame_allocated_gfp=1,o};function F(o){return o>1?0:o<=0?1:Math.cos(Math.PI/2*o)}this.nearestBitrateFullIndex=function(o){var u=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Ct=0,zt=0,bt=0,Qt=0;Qt=u[16],bt=16,zt=u[16],Ct=16;for(var Gt=0;Gt<16;Gt++)if(Math.max(o,u[Gt+1])!=o){Qt=u[Gt+1],bt=Gt+1,zt=u[Gt],Ct=Gt;break}return Qt-o>o-zt?Ct:bt};function h(o,u){var Ct=44100;return u>=48000?Ct=48000:u>=44100?Ct=44100:u>=32000?Ct=32000:u>=24000?Ct=24000:u>=22050?Ct=22050:u>=16000?Ct=16000:u>=12000?Ct=12000:u>=11025?Ct=11025:u>=8000&&(Ct=8000),o==-1?Ct:(o<=15960&&(Ct=44100),o<=15250&&(Ct=32000),o<=11220&&(Ct=24000),o<=9970&&(Ct=22050),o<=7230&&(Ct=16000),o<=5420&&(Ct=12000),o<=4510&&(Ct=11025),o<=3970&&(Ct=8000),u<Ct?u>44100?48000:u>32000?44100:u>24000?32000:u>22050?24000:u>16000?22050:u>12000?16000:u>11025?12000:u>8000?11025:8000:Ct)}function s(o,u){switch(o){case 44100:return u.version=1,0;case 48000:return u.version=1,1;case 32000:return u.version=1,2;case 22050:return u.version=0,0;case 24000:return u.version=0,1;case 16000:return u.version=0,2;case 11025:return u.version=0,0;case 12000:return u.version=0,1;case 8000:return u.version=0,2;default:return u.version=0,-1}}function r(o,u,Ct){Ct<16000&&(u=2);for(var zt=I.bitrate_table[u][1],bt=2;bt<=14;bt++)I.bitrate_table[u][bt]>0&&Math.abs(I.bitrate_table[u][bt]-o)<Math.abs(zt-o)&&(zt=I.bitrate_table[u][bt]);return zt}function a(o,u,Ct){Ct<16000&&(u=2);for(var zt=0;zt<=14;zt++)if(I.bitrate_table[u][zt]>0&&I.bitrate_table[u][zt]==o)return zt;return-1}function f(o,u){var Ct=[new T(8,2000),new T(16,3700),new T(24,3900),new T(32,5500),new T(40,7000),new T(48,7500),new T(56,1e4),new T(64,11000),new T(80,13500),new T(96,15100),new T(112,15600),new T(128,17000),new T(160,17500),new T(192,18600),new T(224,19400),new T(256,19700),new T(320,20500)],zt=C.nearestBitrateFullIndex(u);o.lowerlimit=Ct[zt].lowpass}function E(o){var u=o.internal_flags,Ct=32,zt=-1;if(u.lowpass1>0){for(var bt=999,Qt=0;Qt<=31;Qt++){var Gt=Qt/31;Gt>=u.lowpass2&&(Ct=Math.min(Ct,Qt)),u.lowpass1<Gt&&Gt<u.lowpass2&&(bt=Math.min(bt,Qt))}bt==999?u.lowpass1=(Ct-0.75)/31:u.lowpass1=(bt-0.75)/31,u.lowpass2=Ct/31}if(u.highpass2>0&&u.highpass2<0.021774193548387097&&(u.highpass1=0,u.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),u.highpass2>0){for(var Yt=-1,Qt=0;Qt<=31;Qt++){var Gt=Qt/31;Gt<=u.highpass1&&(zt=Math.max(zt,Qt)),u.highpass1<Gt&&Gt<u.highpass2&&(Yt=Math.max(Yt,Qt))}u.highpass1=zt/31,Yt==-1?u.highpass2=(zt+0.75)/31:u.highpass2=(Yt+0.75)/31}for(var Qt=0;Qt<32;Qt++){var xt,jt,Gt=Qt/31;u.highpass2>u.highpass1?xt=F((u.highpass2-Gt)/(u.highpass2-u.highpass1+0.00000000000000000001)):xt=1,u.lowpass2>u.lowpass1?jt=F((Gt-u.lowpass1)/(u.lowpass2-u.lowpass1+0.00000000000000000001)):jt=1,u.amp_filter[Qt]=xt*jt}}function et(o){var u=o.internal_flags;switch(o.quality){default:case 9:u.psymodel=0,u.noise_shaping=0,u.noise_shaping_amp=0,u.noise_shaping_stop=0,u.use_best_huffman=0,u.full_outer_loop=0;break;case 8:o.quality=7;case 7:u.psymodel=1,u.noise_shaping=0,u.noise_shaping_amp=0,u.noise_shaping_stop=0,u.use_best_huffman=0,u.full_outer_loop=0;break;case 6:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.noise_shaping_amp=0,u.noise_shaping_stop=0,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=0,u.full_outer_loop=0;break;case 5:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.noise_shaping_amp=0,u.noise_shaping_stop=0,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=0,u.full_outer_loop=0;break;case 4:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.noise_shaping_amp=0,u.noise_shaping_stop=0,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=1,u.full_outer_loop=0;break;case 3:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.noise_shaping_amp=1,u.noise_shaping_stop=1,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=1,u.full_outer_loop=0;break;case 2:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.substep_shaping==0&&(u.substep_shaping=2),u.noise_shaping_amp=1,u.noise_shaping_stop=1,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=1,u.full_outer_loop=0;break;case 1:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.substep_shaping==0&&(u.substep_shaping=2),u.noise_shaping_amp=2,u.noise_shaping_stop=1,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=1,u.full_outer_loop=0;break;case 0:u.psymodel=1,u.noise_shaping==0&&(u.noise_shaping=1),u.substep_shaping==0&&(u.substep_shaping=2),u.noise_shaping_amp=2,u.noise_shaping_stop=1,u.subblock_gain==-1&&(u.subblock_gain=1),u.use_best_huffman=1,u.full_outer_loop=0;break}}function X(o){var u=o.internal_flags;o.frameNum=0,o.write_id3tag_automatic&&D.id3tag_write_v2(o),u.bitrate_stereoMode_Hist=j([16,5]),u.bitrate_blockType_Hist=j([16,6]),u.PeakSample=0,o.bWriteVbrTag&&ht.InitVbrTag(o)}this.lame_init_params=function(o){var u=o.internal_flags;if(u.Class_ID=0,u.ATH==null&&(u.ATH=new l),u.PSY==null&&(u.PSY=new J),u.rgdata==null&&(u.rgdata=new Z),u.channels_in=o.num_channels,u.channels_in==1&&(o.mode=g.MONO),u.channels_out=o.mode==g.MONO?1:2,u.mode_ext=_.MPG_MD_MS_LR,o.mode==g.MONO&&(o.force_ms=!1),o.VBR==d.vbr_off&&o.VBR_mean_bitrate_kbps!=128&&o.brate==0&&(o.brate=o.VBR_mean_bitrate_kbps),o.VBR==d.vbr_off||o.VBR==d.vbr_mtrh||o.VBR==d.vbr_mt||(o.free_format=!1),o.VBR==d.vbr_off&&o.brate==0&&M.EQ(o.compression_ratio,0)&&(o.compression_ratio=11.025),o.VBR==d.vbr_off&&o.compression_ratio>0&&(o.out_samplerate==0&&(o.out_samplerate=map2MP3Frequency(int(0.97*o.in_samplerate))),o.brate=0|o.out_samplerate*16*u.channels_out/(1000*o.compression_ratio),u.samplerate_index=s(o.out_samplerate,o),o.free_format||(o.brate=r(o.brate,o.version,o.out_samplerate))),o.out_samplerate!=0&&(o.out_samplerate<16000?(o.VBR_mean_bitrate_kbps=Math.max(o.VBR_mean_bitrate_kbps,8),o.VBR_mean_bitrate_kbps=Math.min(o.VBR_mean_bitrate_kbps,64)):o.out_samplerate<32000?(o.VBR_mean_bitrate_kbps=Math.max(o.VBR_mean_bitrate_kbps,8),o.VBR_mean_bitrate_kbps=Math.min(o.VBR_mean_bitrate_kbps,160)):(o.VBR_mean_bitrate_kbps=Math.max(o.VBR_mean_bitrate_kbps,32),o.VBR_mean_bitrate_kbps=Math.min(o.VBR_mean_bitrate_kbps,320))),o.lowpassfreq==0){var Ct=16000;switch(o.VBR){case d.vbr_off:{var zt=new O;f(zt,o.brate),Ct=zt.lowerlimit;break}case d.vbr_abr:{var zt=new O;f(zt,o.VBR_mean_bitrate_kbps),Ct=zt.lowerlimit;break}case d.vbr_rh:{var bt=[19500,19000,18600,18000,17500,16000,15600,14900,12500,1e4,3950];if(0<=o.VBR_q&&o.VBR_q<=9){var Qt=bt[o.VBR_q],Gt=bt[o.VBR_q+1],Yt=o.VBR_q_frac;Ct=linear_int(Qt,Gt,Yt)}else Ct=19500;break}default:{var bt=[19500,19000,18500,18000,17500,16500,15500,14500,12500,9500,3950];if(0<=o.VBR_q&&o.VBR_q<=9){var Qt=bt[o.VBR_q],Gt=bt[o.VBR_q+1],Yt=o.VBR_q_frac;Ct=linear_int(Qt,Gt,Yt)}else Ct=19500}}o.mode==g.MONO&&(o.VBR==d.vbr_off||o.VBR==d.vbr_abr)&&(Ct*=1.5),o.lowpassfreq=Ct|0}if(o.out_samplerate==0&&(2*o.lowpassfreq>o.in_samplerate&&(o.lowpassfreq=o.in_samplerate/2),o.out_samplerate=h(o.lowpassfreq|0,o.in_samplerate)),o.lowpassfreq=Math.min(20500,o.lowpassfreq),o.lowpassfreq=Math.min(o.out_samplerate/2,o.lowpassfreq),o.VBR==d.vbr_off&&(o.compression_ratio=o.out_samplerate*16*u.channels_out/(1000*o.brate)),o.VBR==d.vbr_abr&&(o.compression_ratio=o.out_samplerate*16*u.channels_out/(1000*o.VBR_mean_bitrate_kbps)),o.bWriteVbrTag||(o.findReplayGain=!1,o.decode_on_the_fly=!1,u.findPeakSample=!1),u.findReplayGain=o.findReplayGain,u.decode_on_the_fly=o.decode_on_the_fly,u.decode_on_the_fly&&(u.findPeakSample=!0),u.findReplayGain&&c.InitGainAnalysis(u.rgdata,o.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return o.internal_flags=null,-6;switch(u.decode_on_the_fly&&!o.decode_only&&(u.hip!=null&&n.hip_decode_exit(u.hip),u.hip=n.hip_decode_init()),u.mode_gr=o.out_samplerate<=24000?1:2,o.framesize=576*u.mode_gr,o.encoder_delay=_.ENCDELAY,u.resample_ratio=o.in_samplerate/o.out_samplerate,o.VBR){case d.vbr_mt:case d.vbr_rh:case d.vbr_mtrh:{var xt=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];o.compression_ratio=xt[o.VBR_q]}break;case d.vbr_abr:o.compression_ratio=o.out_samplerate*16*u.channels_out/(1000*o.VBR_mean_bitrate_kbps);break;default:o.compression_ratio=o.out_samplerate*16*u.channels_out/(1000*o.brate);break}if(o.mode==g.NOT_SET&&(o.mode=g.JOINT_STEREO),o.highpassfreq>0?(u.highpass1=2*o.highpassfreq,o.highpasswidth>=0?u.highpass2=2*(o.highpassfreq+o.highpasswidth):u.highpass2=2*o.highpassfreq,u.highpass1/=o.out_samplerate,u.highpass2/=o.out_samplerate):(u.highpass1=0,u.highpass2=0),o.lowpassfreq>0?(u.lowpass2=2*o.lowpassfreq,o.lowpasswidth>=0?(u.lowpass1=2*(o.lowpassfreq-o.lowpasswidth),u.lowpass1<0&&(u.lowpass1=0)):u.lowpass1=2*o.lowpassfreq,u.lowpass1/=o.out_samplerate,u.lowpass2/=o.out_samplerate):(u.lowpass1=0,u.lowpass2=0),E(o),u.samplerate_index=s(o.out_samplerate,o),u.samplerate_index<0)return o.internal_flags=null,-1;if(o.VBR==d.vbr_off){if(o.free_format)u.bitrate_index=0;else if(o.brate=r(o.brate,o.version,o.out_samplerate),u.bitrate_index=a(o.brate,o.version,o.out_samplerate),u.bitrate_index<=0)return o.internal_flags=null,-1}else u.bitrate_index=1;o.analysis&&(o.bWriteVbrTag=!1),u.pinfo!=null&&(o.bWriteVbrTag=!1),Y.init_bit_stream_w(u);for(var jt=u.samplerate_index+3*o.version+6*(o.out_samplerate<16000?1:0),mt=0;mt<_.SBMAX_l+1;mt++)u.scalefac_band.l[mt]=q.sfBandIndex[jt].l[mt];for(var mt=0;mt<_.PSFB21+1;mt++){var qt=(u.scalefac_band.l[22]-u.scalefac_band.l[21])/_.PSFB21,ii=u.scalefac_band.l[21]+mt*qt;u.scalefac_band.psfb21[mt]=ii}u.scalefac_band.psfb21[_.PSFB21]=576;for(var mt=0;mt<_.SBMAX_s+1;mt++)u.scalefac_band.s[mt]=q.sfBandIndex[jt].s[mt];for(var mt=0;mt<_.PSFB12+1;mt++){var qt=(u.scalefac_band.s[13]-u.scalefac_band.s[12])/_.PSFB12,ii=u.scalefac_band.s[12]+mt*qt;u.scalefac_band.psfb12[mt]=ii}u.scalefac_band.psfb12[_.PSFB12]=192,o.version==1?u.sideinfo_len=u.channels_out==1?21:36:u.sideinfo_len=u.channels_out==1?13:21,o.error_protection&&(u.sideinfo_len+=2),X(o),u.Class_ID=v;{var Ot;for(Ot=0;Ot<19;Ot++)u.nsPsy.pefirbuf[Ot]=700*u.mode_gr*u.channels_out;o.ATHtype==-1&&(o.ATHtype=4)}switch(y(o.VBR_q<=9),y(o.VBR_q>=0),o.VBR){case d.vbr_mt:o.VBR=d.vbr_mtrh;case d.vbr_mtrh:{o.useTemporal==null&&(o.useTemporal=!1),K.apply_preset(o,500-o.VBR_q*10,0),o.quality<0&&(o.quality=LAME_DEFAULT_QUALITY),o.quality<5&&(o.quality=0),o.quality>5&&(o.quality=5),u.PSY.mask_adjust=o.maskingadjust,u.PSY.mask_adjust_short=o.maskingadjust_short,o.experimentalY?u.sfb21_extra=!1:u.sfb21_extra=o.out_samplerate>44000,u.iteration_loop=new VBRNewIterationLoop($);break}case d.vbr_rh:{K.apply_preset(o,500-o.VBR_q*10,0),u.PSY.mask_adjust=o.maskingadjust,u.PSY.mask_adjust_short=o.maskingadjust_short,o.experimentalY?u.sfb21_extra=!1:u.sfb21_extra=o.out_samplerate>44000,o.quality>6&&(o.quality=6),o.quality<0&&(o.quality=LAME_DEFAULT_QUALITY),u.iteration_loop=new VBROldIterationLoop($);break}default:{var m;u.sfb21_extra=!1,o.quality<0&&(o.quality=LAME_DEFAULT_QUALITY),m=o.VBR,m==d.vbr_off&&(o.VBR_mean_bitrate_kbps=o.brate),K.apply_preset(o,o.VBR_mean_bitrate_kbps,0),o.VBR=m,u.PSY.mask_adjust=o.maskingadjust,u.PSY.mask_adjust_short=o.maskingadjust_short,m==d.vbr_off?u.iteration_loop=new V($):u.iteration_loop=new ABRIterationLoop($);break}}if(y(o.scale>=0),o.VBR!=d.vbr_off){if(u.VBR_min_bitrate=1,u.VBR_max_bitrate=14,o.out_samplerate<16000&&(u.VBR_max_bitrate=8),o.VBR_min_bitrate_kbps!=0&&(o.VBR_min_bitrate_kbps=r(o.VBR_min_bitrate_kbps,o.version,o.out_samplerate),u.VBR_min_bitrate=a(o.VBR_min_bitrate_kbps,o.version,o.out_samplerate),u.VBR_min_bitrate<0)||o.VBR_max_bitrate_kbps!=0&&(o.VBR_max_bitrate_kbps=r(o.VBR_max_bitrate_kbps,o.version,o.out_samplerate),u.VBR_max_bitrate=a(o.VBR_max_bitrate_kbps,o.version,o.out_samplerate),u.VBR_max_bitrate<0))return-1;o.VBR_min_bitrate_kbps=I.bitrate_table[o.version][u.VBR_min_bitrate],o.VBR_max_bitrate_kbps=I.bitrate_table[o.version][u.VBR_max_bitrate],o.VBR_mean_bitrate_kbps=Math.min(I.bitrate_table[o.version][u.VBR_max_bitrate],o.VBR_mean_bitrate_kbps),o.VBR_mean_bitrate_kbps=Math.max(I.bitrate_table[o.version][u.VBR_min_bitrate],o.VBR_mean_bitrate_kbps)}return o.tune&&(u.PSY.mask_adjust+=o.tune_value_a,u.PSY.mask_adjust_short+=o.tune_value_a),et(o),y(o.scale>=0),o.athaa_type<0?u.ATH.useAdjust=3:u.ATH.useAdjust=o.athaa_type,u.ATH.aaSensitivityP=Math.pow(10,o.athaa_sensitivity/-10),o.short_blocks==null&&(o.short_blocks=W.short_block_allowed),o.short_blocks==W.short_block_allowed&&(o.mode==g.JOINT_STEREO||o.mode==g.STEREO)&&(o.short_blocks=W.short_block_coupled),o.quant_comp<0&&(o.quant_comp=1),o.quant_comp_short<0&&(o.quant_comp_short=0),o.msfix<0&&(o.msfix=0),o.exp_nspsytune=o.exp_nspsytune|1,o.internal_flags.nsPsy.attackthre<0&&(o.internal_flags.nsPsy.attackthre=U.NSATTACKTHRE),o.internal_flags.nsPsy.attackthre_s<0&&(o.internal_flags.nsPsy.attackthre_s=U.NSATTACKTHRE_S),y(o.scale>=0),o.scale<0&&(o.scale=1),o.ATHtype<0&&(o.ATHtype=4),o.ATHcurve<0&&(o.ATHcurve=4),o.athaa_loudapprox<0&&(o.athaa_loudapprox=2),o.interChRatio<0&&(o.interChRatio=0),o.useTemporal==null&&(o.useTemporal=!0),u.slot_lag=u.frac_SpF=0,o.VBR==d.vbr_off&&(u.slot_lag=u.frac_SpF=(o.version+1)*72000*o.brate%o.out_samplerate|0),q.iteration_init(o),b.psymodel_init(o),y(o.scale>=0),0};function B(o,u){(o.in_buffer_0==null||o.in_buffer_nsamples<u)&&(o.in_buffer_0=Q(u),o.in_buffer_1=Q(u),o.in_buffer_nsamples=u)}this.lame_encode_flush=function(o,u,Ct,zt){var bt=o.internal_flags,Qt=x([2,1152]),Gt=0,Yt,xt,jt,mt,qt=bt.mf_samples_to_encode-_.POSTDELAY,ii=dt(o);if(bt.mf_samples_to_encode<1)return 0;for(Yt=0,o.in_samplerate!=o.out_samplerate&&(qt+=16*o.out_samplerate/o.in_samplerate),jt=o.framesize-qt%o.framesize,jt<576&&(jt+=o.framesize),o.encoder_padding=jt,mt=(qt+jt)/o.framesize;mt>0&&Gt>=0;){var Ot=ii-bt.mf_size,m=o.frameNum;Ot*=o.in_samplerate,Ot/=o.out_samplerate,Ot>1152&&(Ot=1152),Ot<1&&(Ot=1),xt=zt-Yt,zt==0&&(xt=0),Gt=this.lame_encode_buffer(o,Qt[0],Qt[1],Ot,u,Ct,xt),Ct+=Gt,Yt+=Gt,mt-=m!=o.frameNum?1:0}if(bt.mf_samples_to_encode=0,Gt<0||(xt=zt-Yt,zt==0&&(xt=0),Y.flush_bitstream(o),Gt=Y.copy_buffer(bt,u,Ct,xt,1),Gt<0))return Gt;if(Ct+=Gt,Yt+=Gt,xt=zt-Yt,zt==0&&(xt=0),o.write_id3tag_automatic){if(D.id3tag_write_v1(o),Gt=Y.copy_buffer(bt,u,Ct,xt,0),Gt<0)return Gt;Yt+=Gt}return Yt},this.lame_encode_buffer=function(o,u,Ct,zt,bt,Qt,Gt){var Yt=o.internal_flags,xt=[null,null];if(Yt.Class_ID!=v)return-3;if(zt==0)return 0;B(Yt,zt),xt[0]=Yt.in_buffer_0,xt[1]=Yt.in_buffer_1;for(var jt=0;jt<zt;jt++)xt[0][jt]=u[jt],Yt.channels_in>1&&(xt[1][jt]=Ct[jt]);return ut(o,xt[0],xt[1],zt,bt,Qt,Gt)};function dt(o){var u=_.BLKSIZE+o.framesize-_.FFTOFFSET;return u=Math.max(u,512+o.framesize-32),u}function ut(o,u,Ct,zt,bt,Qt,Gt){var Yt=o.internal_flags,xt=0,jt,mt,qt,ii,Ot,m=[null,null],w=[null,null];if(Yt.Class_ID!=v)return-3;if(zt==0)return 0;if(Ot=Y.copy_buffer(Yt,bt,Qt,Gt,0),Ot<0)return Ot;if(Qt+=Ot,xt+=Ot,w[0]=u,w[1]=Ct,M.NEQ(o.scale,0)&&M.NEQ(o.scale,1))for(mt=0;mt<zt;++mt)w[0][mt]*=o.scale,Yt.channels_out==2&&(w[1][mt]*=o.scale);if(M.NEQ(o.scale_left,0)&&M.NEQ(o.scale_left,1))for(mt=0;mt<zt;++mt)w[0][mt]*=o.scale_left;if(M.NEQ(o.scale_right,0)&&M.NEQ(o.scale_right,1))for(mt=0;mt<zt;++mt)w[1][mt]*=o.scale_right;if(o.num_channels==2&&Yt.channels_out==1)for(mt=0;mt<zt;++mt)w[0][mt]=0.5*(w[0][mt]+w[1][mt]),w[1][mt]=0;ii=dt(o),m[0]=Yt.mfbuf[0],m[1]=Yt.mfbuf[1];for(var G=0;zt>0;){var L=[null,null],H=0,k=0;L[0]=w[0],L[1]=w[1];var N=new Dt;if(mi(o,m,L,G,zt,N),H=N.n_in,k=N.n_out,Yt.findReplayGain&&!Yt.decode_on_the_fly&&c.AnalyzeSamples(Yt.rgdata,m[0],Yt.mf_size,m[1],Yt.mf_size,k,Yt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(zt-=H,G+=H,Yt.channels_out==0,Yt.mf_size+=k,y(Yt.mf_size<=p.MFSIZE),Yt.mf_samples_to_encode<1&&(Yt.mf_samples_to_encode=_.ENCDELAY+_.POSTDELAY),Yt.mf_samples_to_encode+=k,Yt.mf_size>=ii){var A=Gt-xt;if(Gt==0&&(A=0),jt=ft(o,m[0],m[1],bt,Qt,A),jt<0)return jt;for(Qt+=jt,xt+=jt,Yt.mf_size-=o.framesize,Yt.mf_samples_to_encode-=o.framesize,qt=0;qt<Yt.channels_out;qt++)for(mt=0;mt<Yt.mf_size;mt++)m[qt][mt]=m[qt][mt+o.framesize]}}return xt}function ft(o,u,Ct,zt,bt,Qt){var Gt=C.enc.lame_encode_mp3_frame(o,u,Ct,zt,bt,Qt);return o.frameNum++,Gt}function Dt(){this.n_in=0,this.n_out=0}function Pt(){this.num_used=0}function Wt(o,u){return u!=0?Wt(u,o%u):o}function yt(o,u,Ct){var zt=Math.PI*u;o/=Ct,o<0&&(o=0),o>1&&(o=1);var bt=o-0.5,Qt=0.42-0.5*Math.cos(2*o*Math.PI)+0.08*Math.cos(4*o*Math.PI);return Math.abs(bt)<0.000000001?zt/Math.PI:Qt*Math.sin(Ct*zt*bt)/(Math.PI*Ct*bt)}function Vt(o,u,Ct,zt,bt,Qt,Gt,Yt,xt){var jt=o.internal_flags,mt,qt=0,ii,Ot=o.out_samplerate/Wt(o.out_samplerate,o.in_samplerate);Ot>p.BPC&&(Ot=p.BPC);var m=Math.abs(jt.resample_ratio-Math.floor(0.5+jt.resample_ratio))<0.0001?1:0,w=1/jt.resample_ratio;w>1&&(w=1);var G=31;G%2==0&&--G,G+=m;var L=G+1;if(jt.fill_buffer_resample_init==0){for(jt.inbuf_old[0]=Q(L),jt.inbuf_old[1]=Q(L),mt=0;mt<=2*Ot;++mt)jt.blackfilt[mt]=Q(L);for(jt.itime[0]=0,jt.itime[1]=0,qt=0;qt<=2*Ot;qt++){var H=0,k=(qt-Ot)/(2*Ot);for(mt=0;mt<=G;mt++)H+=jt.blackfilt[qt][mt]=yt(mt-k,w,G);for(mt=0;mt<=G;mt++)jt.blackfilt[qt][mt]/=H}jt.fill_buffer_resample_init=1}var N=jt.inbuf_old[xt];for(ii=0;ii<zt;ii++){var A,S;if(A=ii*jt.resample_ratio,qt=0|Math.floor(A-jt.itime[xt]),G+qt-G/2>=Gt)break;var k=A-jt.itime[xt]-(qt+0.5*(G%2));S=0|Math.floor(k*2*Ot+Ot+0.5);var rt=0;for(mt=0;mt<=G;++mt){var tt=0|mt+qt-G/2,ot;ot=tt<0?N[L+tt]:bt[Qt+tt],rt+=ot*jt.blackfilt[S][mt]}u[Ct+ii]=rt}if(Yt.num_used=Math.min(Gt,G+qt-G/2),jt.itime[xt]+=Yt.num_used-ii*jt.resample_ratio,Yt.num_used>=L)for(mt=0;mt<L;mt++)N[mt]=bt[Qt+Yt.num_used+mt-L];else{var gt=L-Yt.num_used;for(mt=0;mt<gt;++mt)N[mt]=N[mt+Yt.num_used];for(qt=0;mt<L;++mt,++qt)N[mt]=bt[Qt+qt];y(qt==Yt.num_used)}return ii}function mi(o,u,Ct,zt,bt,Qt){var Gt=o.internal_flags;if(Gt.resample_ratio<0.9999||Gt.resample_ratio>1.0001)for(var Yt=0;Yt<Gt.channels_out;Yt++){var xt=new Pt;Qt.n_out=Vt(o,u[Yt],Gt.mf_size,o.framesize,Ct[Yt],zt,bt,xt,Yt),Qt.n_in=xt.num_used}else{Qt.n_out=Math.min(o.framesize,bt),Qt.n_in=Qt.n_out;for(var jt=0;jt<Qt.n_out;++jt)u[0][Gt.mf_size+jt]=Ct[0][zt+jt],Gt.channels_out==2&&(u[1][Gt.mf_size+jt]=Ct[1][zt+jt])}}}return Nn=z,Nn}var So=Et,Gi=So.VbrMode;function Ho(){var t=te();function e(p,l,Z,V,M,I,_,z,g,C,P,i,c,Y,K){this.vbr_q=p,this.quant_comp=l,this.quant_comp_s=Z,this.expY=V,this.st_lrm=M,this.st_s=I,this.masking_adj=_,this.masking_adj_short=z,this.ath_lower=g,this.ath_curve=C,this.ath_sensitivity=P,this.interch=i,this.safejoint=c,this.sfb21mod=Y,this.msfix=K}function d(p,l,Z,V,M,I,_,z,g,C,P,i,c,Y){this.quant_comp=l,this.quant_comp_s=Z,this.safejoint=V,this.nsmsfix=M,this.st_lrm=I,this.st_s=_,this.nsbass=z,this.scale=g,this.masking_adj=C,this.ath_lower=P,this.ath_curve=i,this.interch=c,this.sfscale=Y}var W;this.setModules=function(p){W=p};var Q=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,0.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-0.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,0.5,0.4,-7.5,4,-12,0.0002,0,0,1.95),new e(6,9,9,1,6.6,145,0.67,0.65,-14.7,6.5,-19,0.0004,0,0,2.3),new e(7,9,9,1,6.6,145,0.8,0.75,-19.7,8,-22,0.0006,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,0.0007,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,0.0008,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,0.0008,0,0,0)],j=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,0.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,0.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,0.0002,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,0.0004,0,0,2),new e(7,9,9,1,4.2,25,0.5,2,-14.5,8,-22,0.0006,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,0.0007,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,0.0008,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,0.0008,0,0,2)];function x(p,l,Z){var V=p.VBR==Gi.vbr_rh?Q:j,M=p.VBR_q_frac,I=V[l],_=V[l+1],z=I;I.st_lrm=I.st_lrm+M*(_.st_lrm-I.st_lrm),I.st_s=I.st_s+M*(_.st_s-I.st_s),I.masking_adj=I.masking_adj+M*(_.masking_adj-I.masking_adj),I.masking_adj_short=I.masking_adj_short+M*(_.masking_adj_short-I.masking_adj_short),I.ath_lower=I.ath_lower+M*(_.ath_lower-I.ath_lower),I.ath_curve=I.ath_curve+M*(_.ath_curve-I.ath_curve),I.ath_sensitivity=I.ath_sensitivity+M*(_.ath_sensitivity-I.ath_sensitivity),I.interch=I.interch+M*(_.interch-I.interch),I.msfix=I.msfix+M*(_.msfix-I.msfix),R(p,z.vbr_q),Z!=0?p.quant_comp=z.quant_comp:Math.abs(p.quant_comp- -1)>0||(p.quant_comp=z.quant_comp),Z!=0?p.quant_comp_short=z.quant_comp_s:Math.abs(p.quant_comp_short- -1)>0||(p.quant_comp_short=z.quant_comp_s),z.expY!=0&&(p.experimentalY=z.expY!=0),Z!=0?p.internal_flags.nsPsy.attackthre=z.st_lrm:Math.abs(p.internal_flags.nsPsy.attackthre- -1)>0||(p.internal_flags.nsPsy.attackthre=z.st_lrm),Z!=0?p.internal_flags.nsPsy.attackthre_s=z.st_s:Math.abs(p.internal_flags.nsPsy.attackthre_s- -1)>0||(p.internal_flags.nsPsy.attackthre_s=z.st_s),Z!=0?p.maskingadjust=z.masking_adj:Math.abs(p.maskingadjust-0)>0||(p.maskingadjust=z.masking_adj),Z!=0?p.maskingadjust_short=z.masking_adj_short:Math.abs(p.maskingadjust_short-0)>0||(p.maskingadjust_short=z.masking_adj_short),Z!=0?p.ATHlower=-z.ath_lower/10:Math.abs(-p.ATHlower*10-0)>0||(p.ATHlower=-z.ath_lower/10),Z!=0?p.ATHcurve=z.ath_curve:Math.abs(p.ATHcurve- -1)>0||(p.ATHcurve=z.ath_curve),Z!=0?p.athaa_sensitivity=z.ath_sensitivity:Math.abs(p.athaa_sensitivity- -1)>0||(p.athaa_sensitivity=z.ath_sensitivity),z.interch>0&&(Z!=0?p.interChRatio=z.interch:Math.abs(p.interChRatio- -1)>0||(p.interChRatio=z.interch)),z.safejoint>0&&(p.exp_nspsytune=p.exp_nspsytune|z.safejoint),z.sfb21mod>0&&(p.exp_nspsytune=p.exp_nspsytune|z.sfb21mod<<20),Z!=0?p.msfix=z.msfix:Math.abs(p.msfix- -1)>0||(p.msfix=z.msfix),Z==0&&(p.VBR_q=l,p.VBR_q_frac=M)}var y=[new d(8,9,9,0,0,6.6,145,0,0.95,0,-30,11,0.0012,1),new d(16,9,9,0,0,6.6,145,0,0.95,0,-25,11,0.001,1),new d(24,9,9,0,0,6.6,145,0,0.95,0,-20,11,0.001,1),new d(32,9,9,0,0,6.6,145,0,0.95,0,-15,11,0.001,1),new d(40,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new d(48,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new d(56,9,9,0,0,6.6,145,0,0.95,0,-6,11,0.0008,1),new d(64,9,9,0,0,6.6,145,0,0.95,0,-2,11,0.0008,1),new d(80,9,9,0,0,6.6,145,0,0.95,0,0,8,0.0007,1),new d(96,9,9,0,2.5,6.6,145,0,0.95,0,1,5.5,0.0006,1),new d(112,9,9,0,2.25,6.6,145,0,0.95,0,2,4.5,0.0005,1),new d(128,9,9,0,1.95,6.4,140,0,0.95,0,3,4,0.0002,1),new d(160,9,9,1,1.79,6,135,0,0.95,-2,5,3.5,0,1),new d(192,9,9,1,1.49,5.6,125,0,0.97,-4,7,3,0,0),new d(224,9,9,1,1.25,5.2,125,0,0.98,-6,9,2,0,0),new d(256,9,9,1,0.97,5.2,125,0,1,-8,10,1,0,0),new d(320,9,9,1,0.9,5.2,125,0,1,-10,12,0,0,0)];function U(p,l,Z){var V=l,M=W.nearestBitrateFullIndex(l);if(p.VBR=Gi.vbr_abr,p.VBR_mean_bitrate_kbps=V,p.VBR_mean_bitrate_kbps=Math.min(p.VBR_mean_bitrate_kbps,320),p.VBR_mean_bitrate_kbps=Math.max(p.VBR_mean_bitrate_kbps,8),p.brate=p.VBR_mean_bitrate_kbps,p.VBR_mean_bitrate_kbps>320&&(p.disable_reservoir=!0),y[M].safejoint>0&&(p.exp_nspsytune=p.exp_nspsytune|2),y[M].sfscale>0&&(p.internal_flags.noise_shaping=2),Math.abs(y[M].nsbass)>0){var I=int(y[M].nsbass*4);I<0&&(I+=64),p.exp_nspsytune=p.exp_nspsytune|I<<2}return Z!=0?p.quant_comp=y[M].quant_comp:Math.abs(p.quant_comp- -1)>0||(p.quant_comp=y[M].quant_comp),Z!=0?p.quant_comp_short=y[M].quant_comp_s:Math.abs(p.quant_comp_short- -1)>0||(p.quant_comp_short=y[M].quant_comp_s),Z!=0?p.msfix=y[M].nsmsfix:Math.abs(p.msfix- -1)>0||(p.msfix=y[M].nsmsfix),Z!=0?p.internal_flags.nsPsy.attackthre=y[M].st_lrm:Math.abs(p.internal_flags.nsPsy.attackthre- -1)>0||(p.internal_flags.nsPsy.attackthre=y[M].st_lrm),Z!=0?p.internal_flags.nsPsy.attackthre_s=y[M].st_s:Math.abs(p.internal_flags.nsPsy.attackthre_s- -1)>0||(p.internal_flags.nsPsy.attackthre_s=y[M].st_s),Z!=0?p.scale=y[M].scale:Math.abs(p.scale- -1)>0||(p.scale=y[M].scale),Z!=0?p.maskingadjust=y[M].masking_adj:Math.abs(p.maskingadjust-0)>0||(p.maskingadjust=y[M].masking_adj),y[M].masking_adj>0?Z!=0?p.maskingadjust_short=y[M].masking_adj*0.9:Math.abs(p.maskingadjust_short-0)>0||(p.maskingadjust_short=y[M].masking_adj*0.9):Z!=0?p.maskingadjust_short=y[M].masking_adj*1.1:Math.abs(p.maskingadjust_short-0)>0||(p.maskingadjust_short=y[M].masking_adj*1.1),Z!=0?p.ATHlower=-y[M].ath_lower/10:Math.abs(-p.ATHlower*10-0)>0||(p.ATHlower=-y[M].ath_lower/10),Z!=0?p.ATHcurve=y[M].ath_curve:Math.abs(p.ATHcurve- -1)>0||(p.ATHcurve=y[M].ath_curve),Z!=0?p.interChRatio=y[M].interch:Math.abs(p.interChRatio- -1)>0||(p.interChRatio=y[M].interch),l}this.apply_preset=function(p,l,Z){switch(l){case t.R3MIX:{l=t.V3,p.VBR=Gi.vbr_mtrh;break}case t.MEDIUM:{l=t.V4,p.VBR=Gi.vbr_rh;break}case t.MEDIUM_FAST:{l=t.V4,p.VBR=Gi.vbr_mtrh;break}case t.STANDARD:{l=t.V2,p.VBR=Gi.vbr_rh;break}case t.STANDARD_FAST:{l=t.V2,p.VBR=Gi.vbr_mtrh;break}case t.EXTREME:{l=t.V0,p.VBR=Gi.vbr_rh;break}case t.EXTREME_FAST:{l=t.V0,p.VBR=Gi.vbr_mtrh;break}case t.INSANE:return l=320,p.preset=l,U(p,l,Z),p.VBR=Gi.vbr_off,l}switch(p.preset=l,l){case t.V9:return x(p,9,Z),l;case t.V8:return x(p,8,Z),l;case t.V7:return x(p,7,Z),l;case t.V6:return x(p,6,Z),l;case t.V5:return x(p,5,Z),l;case t.V4:return x(p,4,Z),l;case t.V3:return x(p,3,Z),l;case t.V2:return x(p,2,Z),l;case t.V1:return x(p,1,Z),l;case t.V0:return x(p,0,Z),l}return 8<=l&&l<=320?U(p,l,Z):(p.preset=0,l)};function R(p,l){var Z=0;return 0>l&&(Z=-1,l=0),9<l&&(Z=-1,l=9),p.VBR_q=l,p.VBR_q_frac=0,Z}}var Eo=Ho;function Io(){this.setModules=function(t,e){}}var _o=Io;function Bo(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Ro=Bo,gr=Et,Oe=gr.new_float,Ao=gr.new_int;function ts(){this.global_gain=0,this.sfb_count1=0,this.step=Ao(39),this.noise=Oe(39),this.noise_log=Oe(39)}var is=ts,Ii=Et,Fi=Ii.System,ve=Ii.VbrMode,Sn=Ii.Util,Hi=Ii.Arrays,on=Ii.new_float,sn=Ii.assert,ns=_o,Hn=Ro,es=is,Mt=ri(),Me=In,qe=Wn;function rs(){var t;this.rv=null;var e;this.qupvt=null;var d,W=new ns,Q;this.setModules=function(z,g,C,P){t=z,e=g,this.rv=g,d=C,this.qupvt=C,Q=P,W.setModules(d,Q)},this.ms_convert=function(z,g){for(var C=0;C<576;++C){var P=z.tt[g][0].xr[C],i=z.tt[g][1].xr[C];z.tt[g][0].xr[C]=(P+i)*(Sn.SQRT2*0.5),z.tt[g][1].xr[C]=(P-i)*(Sn.SQRT2*0.5)}};function j(z,g,C,P){P=0;for(var i=0;i<=C;++i){var c=Math.abs(z.xr[i]);P+=c,g[i]=Math.sqrt(c*Math.sqrt(c)),g[i]>z.xrpow_max&&(z.xrpow_max=g[i])}return P}this.init_xrpow=function(z,g,C){var P=0,i=0|g.max_nonzero_coeff;if(g.xrpow_max=0,Hi.fill(C,i,576,0),P=j(g,C,i,P),P>0.00000000000000000001){var c=0;z.substep_shaping&2&&(c=1);for(var Y=0;Y<g.psymax;Y++)z.pseudohalf[Y]=c;return!0}return Hi.fill(g.l3_enc,0,576,0),!1};function x(z,g){var C=z.ATH,P=g.xr;if(g.block_type!=Mt.SHORT_TYPE)for(var i=!1,c=Mt.PSFB21-1;c>=0&&!i;c--){var Y=z.scalefac_band.psfb21[c],K=z.scalefac_band.psfb21[c+1],q=d.athAdjust(C.adjust,C.psfb21[c],C.floor);z.nsPsy.longfact[21]>0.000000000001&&(q*=z.nsPsy.longfact[21]);for(var $=K-1;$>=Y;$--)if(Math.abs(P[$])<q)P[$]=0;else{i=!0;break}}else for(var b=0;b<3;b++)for(var i=!1,c=Mt.PSFB12-1;c>=0&&!i;c--){var Y=z.scalefac_band.s[12]*3+(z.scalefac_band.s[13]-z.scalefac_band.s[12])*b+(z.scalefac_band.psfb12[c]-z.scalefac_band.psfb12[0]),K=Y+(z.scalefac_band.psfb12[c+1]-z.scalefac_band.psfb12[c]),ht=d.athAdjust(C.adjust,C.psfb12[c],C.floor);z.nsPsy.shortfact[12]>0.000000000001&&(ht*=z.nsPsy.shortfact[12]);for(var $=K-1;$>=Y;$--)if(Math.abs(P[$])<ht)P[$]=0;else{i=!0;break}}}this.init_outer_loop=function(z,g){g.part2_3_length=0,g.big_values=0,g.count1=0,g.global_gain=210,g.scalefac_compress=0,g.table_select[0]=0,g.table_select[1]=0,g.table_select[2]=0,g.subblock_gain[0]=0,g.subblock_gain[1]=0,g.subblock_gain[2]=0,g.subblock_gain[3]=0,g.region0_count=0,g.region1_count=0,g.preflag=0,g.scalefac_scale=0,g.count1table_select=0,g.part2_length=0,g.sfb_lmax=Mt.SBPSY_l,g.sfb_smin=Mt.SBPSY_s,g.psy_lmax=z.sfb21_extra?Mt.SBMAX_l:Mt.SBPSY_l,g.psymax=g.psy_lmax,g.sfbmax=g.sfb_lmax,g.sfbdivide=11;for(var C=0;C<Mt.SBMAX_l;C++)g.width[C]=z.scalefac_band.l[C+1]-z.scalefac_band.l[C],g.window[C]=3;if(g.block_type==Mt.SHORT_TYPE){var P=on(576);g.sfb_smin=0,g.sfb_lmax=0,g.mixed_block_flag!=0&&(g.sfb_smin=3,g.sfb_lmax=z.mode_gr*2+4),g.psymax=g.sfb_lmax+3*((z.sfb21_extra?Mt.SBMAX_s:Mt.SBPSY_s)-g.sfb_smin),g.sfbmax=g.sfb_lmax+3*(Mt.SBPSY_s-g.sfb_smin),g.sfbdivide=g.sfbmax-18,g.psy_lmax=g.sfb_lmax;var i=z.scalefac_band.l[g.sfb_lmax];Fi.arraycopy(g.xr,0,P,0,576);for(var C=g.sfb_smin;C<Mt.SBMAX_s;C++)for(var c=z.scalefac_band.s[C],Y=z.scalefac_band.s[C+1],K=0;K<3;K++)for(var q=c;q<Y;q++)g.xr[i++]=P[3*q+K];for(var{sfb_lmax:$,sfb_smin:C}=g;C<Mt.SBMAX_s;C++)g.width[$]=g.width[$+1]=g.width[$+2]=z.scalefac_band.s[C+1]-z.scalefac_band.s[C],g.window[$]=0,g.window[$+1]=1,g.window[$+2]=2,$+=3}g.count1bits=0,g.sfb_partition_table=d.nr_of_sfb_block[0][0],g.slen[0]=0,g.slen[1]=0,g.slen[2]=0,g.slen[3]=0,g.max_nonzero_coeff=575,Hi.fill(g.scalefac,0),x(z,g)};function y(z){this.ordinal=z}y.BINSEARCH_NONE=new y(0),y.BINSEARCH_UP=new y(1),y.BINSEARCH_DOWN=new y(2);function U(z,g,C,P,i){var c,Y=z.CurrentStep[P],K=!1,q=z.OldValue[P],$=y.BINSEARCH_NONE;for(g.global_gain=q,C-=g.part2_length;;){var b;if(c=Q.count_bits(z,i,g,null),Y==1||c==C)break;c>C?($==y.BINSEARCH_DOWN&&(K=!0),K&&(Y/=2),$=y.BINSEARCH_UP,b=Y):($==y.BINSEARCH_UP&&(K=!0),K&&(Y/=2),$=y.BINSEARCH_DOWN,b=-Y),g.global_gain+=b,g.global_gain<0&&(g.global_gain=0,K=!0),g.global_gain>255&&(g.global_gain=255,K=!0)}for(sn(g.global_gain>=0),sn(g.global_gain<256);c>C&&g.global_gain<255;)g.global_gain++,c=Q.count_bits(z,i,g,null);return z.CurrentStep[P]=q-g.global_gain>=4?4:2,z.OldValue[P]=g.global_gain,g.part2_3_length=c,c}this.trancate_smallspectrums=function(z,g,C,P){var i=on(qe.SFBMAX);if(!(!(z.substep_shaping&4)&&g.block_type==Mt.SHORT_TYPE||z.substep_shaping&128)){d.calc_noise(g,C,i,new Hn,null);for(var Y=0;Y<576;Y++){var c=0;g.l3_enc[Y]!=0&&(c=Math.abs(g.xr[Y])),P[Y]=c}var Y=0,K=8;g.block_type==Mt.SHORT_TYPE&&(K=6);do{var q,$,b,ht,D=g.width[K];if(Y+=D,!(i[K]>=1)&&(Hi.sort(P,Y-D,D),!BitStream.EQ(P[Y-1],0))){q=(1-i[K])*C[K],$=0,ht=0;do{var n;for(b=1;ht+b<D&&!BitStream.NEQ(P[ht+Y-D],P[ht+Y+b-D]);b++);if(n=P[ht+Y-D]*P[ht+Y-D]*b,q<n){ht!=0&&($=P[ht+Y-D-1]);break}q-=n,ht+=b}while(ht<D);if(!BitStream.EQ($,0))do Math.abs(g.xr[Y-D])<=$&&(g.l3_enc[Y-D]=0);while(--D>0)}}while(++K<g.psymax);g.part2_3_length=Q.noquant_count_bits(z,g,null)}};function R(z){for(var g=0;g<z.sfbmax;g++)if(z.scalefac[g]+z.subblock_gain[z.window[g]]==0)return!1;return!0}function p(z){return Sn.FAST_LOG10(0.368+0.632*z*z*z)}function l(z,g){for(var C=0.0000000000000000000000000000000000001,P=0;P<g.psymax;P++)C+=p(z[P]);return Math.max(0.00000000000000000001,C)}function Z(z,g,C,P,i){var c;switch(z){default:case 9:{g.over_count>0?(c=C.over_SSD<=g.over_SSD,C.over_SSD==g.over_SSD&&(c=C.bits<g.bits)):c=C.max_noise<0&&C.max_noise*10+C.bits<=g.max_noise*10+g.bits;break}case 0:c=C.over_count<g.over_count||C.over_count==g.over_count&&C.over_noise<g.over_noise||C.over_count==g.over_count&&BitStream.EQ(C.over_noise,g.over_noise)&&C.tot_noise<g.tot_noise;break;case 8:C.max_noise=l(i,P);case 1:c=C.max_noise<g.max_noise;break;case 2:c=C.tot_noise<g.tot_noise;break;case 3:c=C.tot_noise<g.tot_noise&&C.max_noise<g.max_noise;break;case 4:c=C.max_noise<=0&&g.max_noise>0.2||C.max_noise<=0&&g.max_noise<0&&g.max_noise>C.max_noise-0.2&&C.tot_noise<g.tot_noise||C.max_noise<=0&&g.max_noise>0&&g.max_noise>C.max_noise-0.2&&C.tot_noise<g.tot_noise+g.over_noise||C.max_noise>0&&g.max_noise>-0.05&&g.max_noise>C.max_noise-0.1&&C.tot_noise+C.over_noise<g.tot_noise+g.over_noise||C.max_noise>0&&g.max_noise>-0.1&&g.max_noise>C.max_noise-0.15&&C.tot_noise+C.over_noise+C.over_noise<g.tot_noise+g.over_noise+g.over_noise;break;case 5:c=C.over_noise<g.over_noise||BitStream.EQ(C.over_noise,g.over_noise)&&C.tot_noise<g.tot_noise;break;case 6:c=C.over_noise<g.over_noise||BitStream.EQ(C.over_noise,g.over_noise)&&(C.max_noise<g.max_noise||BitStream.EQ(C.max_noise,g.max_noise)&&C.tot_noise<=g.tot_noise);break;case 7:c=C.over_count<g.over_count||C.over_noise<g.over_noise;break}return g.over_count==0&&(c=c&&C.bits<g.bits),c}function V(z,g,C,P,i){var c=z.internal_flags,Y;g.scalefac_scale==0?Y=1.2968395546510096:Y=1.6817928305074292;for(var K=0,q=0;q<g.sfbmax;q++)K<C[q]&&(K=C[q]);var $=c.noise_shaping_amp;switch($==3&&(i?$=2:$=1),$){case 2:break;case 1:K>1?K=Math.pow(K,0.5):K*=0.95;break;case 0:default:K>1?K=1:K*=0.95;break}for(var b=0,q=0;q<g.sfbmax;q++){var ht=g.width[q],D;if(b+=ht,!(C[q]<K)){if(c.substep_shaping&2&&(c.pseudohalf[q]=c.pseudohalf[q]==0?1:0,c.pseudohalf[q]==0&&c.noise_shaping_amp==2))return;for(g.scalefac[q]++,D=-ht;D<0;D++)P[b+D]*=Y,P[b+D]>g.xrpow_max&&(g.xrpow_max=P[b+D]);if(c.noise_shaping_amp==2)return}}}function M(z,g){for(var C=1.2968395546510096,P=0,i=0;i<z.sfbmax;i++){var c=z.width[i],Y=z.scalefac[i];if(z.preflag!=0&&(Y+=d.pretab[i]),P+=c,Y&1){Y++;for(var K=-c;K<0;K++)g[P+K]*=C,g[P+K]>z.xrpow_max&&(z.xrpow_max=g[P+K])}z.scalefac[i]=Y>>1}z.preflag=0,z.scalefac_scale=1}function I(z,g,C){var P,i=g.scalefac;for(P=0;P<g.sfb_lmax;P++)if(i[P]>=16)return!0;for(var c=0;c<3;c++){var Y=0,K=0;for(P=g.sfb_lmax+c;P<g.sfbdivide;P+=3)Y<i[P]&&(Y=i[P]);for(;P<g.sfbmax;P+=3)K<i[P]&&(K=i[P]);if(!(Y<16&&K<8)){if(g.subblock_gain[c]>=7)return!0;g.subblock_gain[c]++;var q=z.scalefac_band.l[g.sfb_lmax];for(P=g.sfb_lmax+c;P<g.sfbmax;P+=3){var $,b=g.width[P],ht=i[P];if(ht=ht-(4>>g.scalefac_scale),ht>=0){i[P]=ht,q+=b*3;continue}i[P]=0;{var D=210+(ht<<g.scalefac_scale+1);$=d.IPOW20(D)}q+=b*(c+1);for(var n=-b;n<0;n++)C[q+n]*=$,C[q+n]>g.xrpow_max&&(g.xrpow_max=C[q+n]);q+=b*(3-c-1)}{var $=d.IPOW20(202);q+=g.width[P]*(c+1);for(var n=-g.width[P];n<0;n++)C[q+n]*=$,C[q+n]>g.xrpow_max&&(g.xrpow_max=C[q+n])}}}return!1}function _(z,g,C,P,i){var c=z.internal_flags;V(z,g,C,P,i);var Y=R(g);return Y?!1:(c.mode_gr==2?Y=Q.scale_bitcount(g):Y=Q.scale_bitcount_lsf(c,g),Y?(c.noise_shaping>1&&(Hi.fill(c.pseudohalf,0),g.scalefac_scale==0?(M(g,P),Y=!1):g.block_type==Mt.SHORT_TYPE&&c.subblock_gain>0&&(Y=I(c,g,P)||R(g))),Y||(c.mode_gr==2?Y=Q.scale_bitcount(g):Y=Q.scale_bitcount_lsf(c,g)),!Y):!0)}this.outer_loop=function(z,g,C,P,i,c){var Y=z.internal_flags,K=new Me,q=on(576),$=on(qe.SFBMAX),b=new Hn,ht,D=new es,n=9999999,J=!1,O=!1,T=0;if(U(Y,g,c,i,P),Y.noise_shaping==0)return 100;d.calc_noise(g,C,$,b,D),b.bits=g.part2_3_length,K.assign(g);var v=0;for(Fi.arraycopy(P,0,q,0,576);!J;){do{var it=new Hn,F,h=255;if(Y.substep_shaping&2?F=20:F=3,Y.sfb21_extra&&($[K.sfbmax]>1||K.block_type==Mt.SHORT_TYPE&&($[K.sfbmax+1]>1||$[K.sfbmax+2]>1))||!_(z,K,$,P,O))break;K.scalefac_scale!=0&&(h=254);var s=c-K.part2_length;if(s<=0)break;for(;(K.part2_3_length=Q.count_bits(Y,P,K,D))>s&&K.global_gain<=h;)K.global_gain++;if(K.global_gain>h)break;if(b.over_count==0){for(;(K.part2_3_length=Q.count_bits(Y,P,K,D))>n&&K.global_gain<=h;)K.global_gain++;if(K.global_gain>h)break}if(d.calc_noise(K,C,$,it,D),it.bits=K.part2_3_length,g.block_type!=Mt.SHORT_TYPE?ht=z.quant_comp:ht=z.quant_comp_short,ht=Z(ht,b,it,K,$)?1:0,ht!=0)n=g.part2_3_length,b=it,g.assign(K),v=0,Fi.arraycopy(P,0,q,0,576);else if(Y.full_outer_loop==0&&(++v>F&&b.over_count==0||Y.noise_shaping_amp==3&&O&&v>30||Y.noise_shaping_amp==3&&O&&K.global_gain-T>15))break}while(K.global_gain+K.scalefac_scale<255);Y.noise_shaping_amp==3?O?J=!0:(K.assign(g),Fi.arraycopy(q,0,P,0,576),v=0,T=K.global_gain,O=!0):J=!0}return sn(g.global_gain+g.scalefac_scale<=255),z.VBR==ve.vbr_rh||z.VBR==ve.vbr_mtrh?Fi.arraycopy(q,0,P,0,576):Y.substep_shaping&1&&trancate_smallspectrums(Y,g,C,P),b.over_count},this.iteration_finish_one=function(z,g,C){var P=z.l3_side,i=P.tt[g][C];Q.best_scalefac_store(z,g,C,P),z.use_best_huffman==1&&Q.best_huffman_divide(z,i),e.ResvAdjust(z,i)},this.VBR_encode_granule=function(z,g,C,P,i,c,Y){var K=z.internal_flags,q=new Me,$=on(576),b=Y,ht=Y+1,D=(Y+c)/2,n,J,O=0,T=K.sfb21_extra;sn(b<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Hi.fill(q.l3_enc,0);do D>b-42?K.sfb21_extra=!1:K.sfb21_extra=T,J=outer_loop(z,g,C,P,i,D),J<=0?(O=1,ht=g.part2_3_length,q.assign(g),Fi.arraycopy(P,0,$,0,576),Y=ht-32,n=Y-c,D=(Y+c)/2):(c=D+32,n=Y-c,D=(Y+c)/2,O!=0&&(O=2,g.assign(q),Fi.arraycopy($,0,P,0,576)));while(n>12);K.sfb21_extra=T,O==2&&Fi.arraycopy(q.l3_enc,0,g.l3_enc,0,576),sn(g.part2_3_length<=b)},this.get_framebits=function(z,g){var C=z.internal_flags;C.bitrate_index=C.VBR_min_bitrate;var P=t.getframebits(z);C.bitrate_index=1,P=t.getframebits(z);for(var i=1;i<=C.VBR_max_bitrate;i++){C.bitrate_index=i;var c=new MeanBits(P);g[i]=e.ResvFrameBegin(z,c),P=c.bits}},this.VBR_old_prepare=function(z,g,C,P,i,c,Y,K,q){var $=z.internal_flags,b,ht=0,D=1,n=0;$.bitrate_index=$.VBR_max_bitrate;var J=e.ResvFrameBegin(z,new MeanBits(0))/$.mode_gr;get_framebits(z,c);for(var O=0;O<$.mode_gr;O++){var T=d.on_pe(z,g,K[O],J,O,0);$.mode_ext==Mt.MPG_MD_MS_LR&&(ms_convert($.l3_side,O),d.reduce_side(K[O],C[O],J,T));for(var v=0;v<$.channels_out;++v){var it=$.l3_side.tt[O][v];it.block_type!=Mt.SHORT_TYPE?(ht=1.28/(1+Math.exp(3.5-g[O][v]/300))-0.05,b=$.PSY.mask_adjust-ht):(ht=2.56/(1+Math.exp(3.5-g[O][v]/300))-0.14,b=$.PSY.mask_adjust_short-ht),$.masking_lower=Math.pow(10,b*0.1),init_outer_loop($,it),q[O][v]=d.calc_xmin(z,P[O][v],it,i[O][v]),q[O][v]!=0&&(D=0),Y[O][v]=126,n+=K[O][v]}}for(var O=0;O<$.mode_gr;O++)for(var v=0;v<$.channels_out;v++)n>c[$.VBR_max_bitrate]&&(K[O][v]*=c[$.VBR_max_bitrate],K[O][v]/=n),Y[O][v]>K[O][v]&&(Y[O][v]=K[O][v]);return D},this.bitpressure_strategy=function(z,g,C,P){for(var i=0;i<z.mode_gr;i++)for(var c=0;c<z.channels_out;c++){for(var Y=z.l3_side.tt[i][c],K=g[i][c],q=0,$=0;$<Y.psy_lmax;$++)K[q++]*=1+0.029*$*$/Mt.SBMAX_l/Mt.SBMAX_l;if(Y.block_type==Mt.SHORT_TYPE)for(var $=Y.sfb_smin;$<Mt.SBMAX_s;$++)K[q++]*=1+0.029*$*$/Mt.SBMAX_s/Mt.SBMAX_s,K[q++]*=1+0.029*$*$/Mt.SBMAX_s/Mt.SBMAX_s,K[q++]*=1+0.029*$*$/Mt.SBMAX_s/Mt.SBMAX_s;P[i][c]=0|Math.max(C[i][c],0.9*P[i][c])}},this.VBR_new_prepare=function(z,g,C,P,i,c){var Y=z.internal_flags,K=1,q=0,$=0,b;if(z.free_format){Y.bitrate_index=0;var ht=new MeanBits(q);b=e.ResvFrameBegin(z,ht),q=ht.bits,i[0]=b}else{Y.bitrate_index=Y.VBR_max_bitrate;var ht=new MeanBits(q);e.ResvFrameBegin(z,ht),q=ht.bits,get_framebits(z,i),b=i[Y.VBR_max_bitrate]}for(var D=0;D<Y.mode_gr;D++){d.on_pe(z,g,c[D],q,D,0),Y.mode_ext==Mt.MPG_MD_MS_LR&&ms_convert(Y.l3_side,D);for(var n=0;n<Y.channels_out;++n){var J=Y.l3_side.tt[D][n];Y.masking_lower=Math.pow(10,Y.PSY.mask_adjust*0.1),init_outer_loop(Y,J),d.calc_xmin(z,C[D][n],J,P[D][n])!=0&&(K=0),$+=c[D][n]}}for(var D=0;D<Y.mode_gr;D++)for(var n=0;n<Y.channels_out;n++)$>b&&(c[D][n]*=b,c[D][n]/=$);return K},this.calc_target_bits=function(z,g,C,P,i,c){var Y=z.internal_flags,K=Y.l3_side,q,$,b,ht,D=0;Y.bitrate_index=Y.VBR_max_bitrate;var n=new MeanBits(D);for(c[0]=e.ResvFrameBegin(z,n),D=n.bits,Y.bitrate_index=1,D=t.getframebits(z)-Y.sideinfo_len*8,i[0]=D/(Y.mode_gr*Y.channels_out),D=z.VBR_mean_bitrate_kbps*z.framesize*1000,Y.substep_shaping&1&&(D*=1.09),D/=z.out_samplerate,D-=Y.sideinfo_len*8,D/=Y.mode_gr*Y.channels_out,q=0.93+0.07*(11-z.compression_ratio)/5.5,q<0.9&&(q=0.9),q>1&&(q=1),$=0;$<Y.mode_gr;$++){var J=0;for(b=0;b<Y.channels_out;b++){if(P[$][b]=int(q*D),g[$][b]>700){var O=int((g[$][b]-700)/1.4),T=K.tt[$][b];P[$][b]=int(q*D),T.block_type==Mt.SHORT_TYPE&&O<D/2&&(O=D/2),O>D*3/2?O=D*3/2:O<0&&(O=0),P[$][b]+=O}P[$][b]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[$][b]=LameInternalFlags.MAX_BITS_PER_CHANNEL),J+=P[$][b]}if(J>LameInternalFlags.MAX_BITS_PER_GRANULE)for(b=0;b<Y.channels_out;++b)P[$][b]*=LameInternalFlags.MAX_BITS_PER_GRANULE,P[$][b]/=J}if(Y.mode_ext==Mt.MPG_MD_MS_LR)for($=0;$<Y.mode_gr;$++)d.reduce_side(P[$],C[$],D*Y.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(ht=0,$=0;$<Y.mode_gr;$++)for(b=0;b<Y.channels_out;b++)P[$][b]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[$][b]=LameInternalFlags.MAX_BITS_PER_CHANNEL),ht+=P[$][b];if(ht>c[0])for($=0;$<Y.mode_gr;$++)for(b=0;b<Y.channels_out;b++)P[$][b]*=c[0],P[$][b]/=ht}}var os=rs,ss=Et,Ve=ss.assert;function ds(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(e,d){var W=e.internal_flags,Q,j=W.l3_side,x=t.getframebits(e);d.bits=(x-W.sideinfo_len*8)/W.mode_gr;var y=2048*W.mode_gr-8;e.brate>320?Q=8*int(e.brate*1000/(e.out_samplerate/1152)/8+0.5):(Q=11520,e.strict_ISO&&(Q=8*int(320000/(e.out_samplerate/1152)/8+0.5))),W.ResvMax=Q-x,W.ResvMax>y&&(W.ResvMax=y),(W.ResvMax<0||e.disable_reservoir)&&(W.ResvMax=0);var U=d.bits*W.mode_gr+Math.min(W.ResvSize,W.ResvMax);return U>Q&&(U=Q),Ve(W.ResvMax%8==0),Ve(W.ResvMax>=0),j.resvDrain_pre=0,W.pinfo!=null&&(W.pinfo.mean_bits=d.bits/2,W.pinfo.resvsize=W.ResvSize),U},this.ResvMaxBits=function(e,d,W,Q){var j=e.internal_flags,x,y=j.ResvSize,U=j.ResvMax;Q!=0&&(y+=d),j.substep_shaping&1&&(U*=0.9),W.bits=d,y*10>U*9?(x=y-U*9/10,W.bits+=x,j.substep_shaping|=128):(x=0,j.substep_shaping&=127,!e.disable_reservoir&&!(j.substep_shaping&1)&&(W.bits-=0.1*d));var R=y<j.ResvMax*6/10?y:j.ResvMax*6/10;return R-=x,R<0&&(R=0),R},this.ResvAdjust=function(e,d){e.ResvSize-=d.part2_3_length+d.part2_length},this.ResvFrameEnd=function(e,d){var W,Q=e.l3_side;e.ResvSize+=d*e.mode_gr;var j=0;Q.resvDrain_post=0,Q.resvDrain_pre=0,(W=e.ResvSize%8)!=0&&(j+=W),W=e.ResvSize-j-e.ResvMax,W>0&&(j+=W);{var x=Math.min(Q.main_data_begin*8,j)/8;Q.resvDrain_pre+=8*x,j-=8*x,e.ResvSize-=8*x,Q.main_data_begin-=x}Q.resvDrain_post+=j,e.ResvSize-=j}}var hs=ds;function ls(){var t="http://www.mp3dev.org/",e=3,d=98,W=4,Q=0,j=93;this.getLameVersion=function(){return e+"."+d+"."+W},this.getLameShortVersion=function(){return e+"."+d+"."+W},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+d+"r"},this.getPsyVersion=function(){return Q+"."+j},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var as=ls,_i=Et,cs=_i.System,En=_i.VbrMode,Te=_i.ShortBlock,ps=_i.Arrays,Cn=_i.new_byte,us=_i.assert;dn.NUMTOCENTRIES=100;dn.MAXFRAMESIZE=2880;function dn(){var t,e,d;this.setModules=function(D,n,J){t=D,e=n,d=J};var W=1,Q=2,j=4,x=8,y=dn.NUMTOCENTRIES,U=dn.MAXFRAMESIZE,R=y+4+4+4+4+4,p=R+9+1+1+8+1+1+3+1+1+2+4+2+2,l=128,Z=64,V=32,M=null,I="Xing",_="Info",z=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8000,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16000,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32000,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function g(D,n){if(D.nVbrNumFrames++,D.sum+=n,D.seen++,!(D.seen<D.want)&&(D.pos<D.size&&(D.bag[D.pos]=D.sum,D.pos++,D.seen=0),D.pos==D.size)){for(var J=1;J<D.size;J+=2)D.bag[J/2]=D.bag[J];D.want*=2,D.pos/=2}}function C(D,n){if(!(D.pos<=0))for(var J=1;J<y;++J){var O=J/y,T,v,it=0|Math.floor(O*D.pos);it>D.pos-1&&(it=D.pos-1),T=D.bag[it],v=D.sum;var F=0|256*T/v;F>255&&(F=255),n[J]=255&F}}this.addVbrFrame=function(D){var n=D.internal_flags,J=Tables.bitrate_table[D.version][n.bitrate_index];us(n.VBR_seek_table.bag!=null),g(n.VBR_seek_table,J)};function P(D,n){var J=D[n+0]&255;return J<<=8,J|=D[n+1]&255,J<<=8,J|=D[n+2]&255,J<<=8,J|=D[n+3]&255,J}function i(D,n,J){D[n+0]=255&(J>>24&255),D[n+1]=255&(J>>16&255),D[n+2]=255&(J>>8&255),D[n+3]=255&(J&255)}function c(D,n,J){D[n+0]=255&(J>>8&255),D[n+1]=255&(J&255)}function Y(D,n){return new String(D,n,I.length(),M).equals(I)||new String(D,n,_.length(),M).equals(_)}function K(D,n,J){return 255&(D<<n|J&~(-1<<n))}function q(D,n){var J=D.internal_flags;n[0]=K(n[0],8,255),n[1]=K(n[1],3,7),n[1]=K(n[1],1,D.out_samplerate<16000?0:1),n[1]=K(n[1],1,D.version),n[1]=K(n[1],2,1),n[1]=K(n[1],1,D.error_protection?0:1),n[2]=K(n[2],4,J.bitrate_index),n[2]=K(n[2],2,J.samplerate_index),n[2]=K(n[2],1,0),n[2]=K(n[2],1,D.extension),n[3]=K(n[3],2,D.mode.ordinal()),n[3]=K(n[3],2,J.mode_ext),n[3]=K(n[3],1,D.copyright),n[3]=K(n[3],1,D.original),n[3]=K(n[3],2,D.emphasis),n[0]=255;var O=255&(n[1]&241),T;D.version==1?T=l:D.out_samplerate<16000?T=V:T=Z,D.VBR==En.vbr_off&&(T=D.brate);var v;D.free_format?v=0:v=255&16*t.BitrateIndex(T,D.version,D.out_samplerate),D.version==1?(n[1]=255&(O|10),O=255&(n[2]&13),n[2]=255&(v|O)):(n[1]=255&(O|2),O=255&(n[2]&13),n[2]=255&(v|O))}this.getVbrTag=function(D){var n=new VBRTagData,J=0;n.flags=0;var O=D[J+1]>>3&1,T=D[J+2]>>2&3,v=D[J+3]>>6&3,it=D[J+2]>>4&15;if(it=Tables.bitrate_table[O][it],D[J+1]>>4==14?n.samprate=Tables.samplerate_table[2][T]:n.samprate=Tables.samplerate_table[O][T],O!=0?v!=3?J+=36:J+=21:v!=3?J+=21:J+=13,!Y(D,J))return null;J+=4,n.hId=O;var F=n.flags=P(D,J);if(J+=4,F&W&&(n.frames=P(D,J),J+=4),F&Q&&(n.bytes=P(D,J),J+=4),F&j){if(n.toc!=null)for(var h=0;h<y;h++)n.toc[h]=D[J+h];J+=y}n.vbrScale=-1,F&x&&(n.vbrScale=P(D,J),J+=4),n.headersize=(O+1)*72000*it/n.samprate,J+=21;var s=D[J+0]<<4;s+=D[J+1]>>4;var r=(D[J+1]&15)<<8;return r+=D[J+2]&255,(s<0||s>3000)&&(s=-1),(r<0||r>3000)&&(r=-1),n.encDelay=s,n.encPadding=r,n},this.InitVbrTag=function(D){var n=D.internal_flags,J;D.version==1?J=l:D.out_samplerate<16000?J=V:J=Z,D.VBR==En.vbr_off&&(J=D.brate);var O=(D.version+1)*72000*J/D.out_samplerate,T=n.sideinfo_len+p;if(n.VBR_seek_table.TotalFrameSize=O,O<T||O>U){D.bWriteVbrTag=!1;return}n.VBR_seek_table.nVbrNumFrames=0,n.VBR_seek_table.nBytesWritten=0,n.VBR_seek_table.sum=0,n.VBR_seek_table.seen=0,n.VBR_seek_table.want=1,n.VBR_seek_table.pos=0,n.VBR_seek_table.bag==null&&(n.VBR_seek_table.bag=new int[400],n.VBR_seek_table.size=400);var v=Cn(U);q(D,v);for(var it=n.VBR_seek_table.TotalFrameSize,F=0;F<it;++F)e.add_dummy_byte(D,v[F]&255,1)};function $(D,n){var J=n^D;return n=n>>8^z[J&255],n}this.updateMusicCRC=function(D,n,J,O){for(var T=0;T<O;++T)D[0]=$(n[J+T],D[0])};function b(D,n,J,O,T){var v=D.internal_flags,it=0,F=D.encoder_delay,h=D.encoder_padding,s=100-10*D.VBR_q-D.quality,r=d.getLameVeryShortVersion(),a,f=0,E,et=[1,5,3,2,4,0,3],X=0|(D.lowpassfreq/100+0.5>255?255:D.lowpassfreq/100+0.5),B=0,dt=0,ut=0,ft=D.internal_flags.noise_shaping,Dt=0,Pt=0,Wt=0,yt=0,Vt=0,mi=(D.exp_nspsytune&1)!=0,o=(D.exp_nspsytune&2)!=0,u=!1,Ct=!1,zt=D.internal_flags.nogap_total,bt=D.internal_flags.nogap_current,Qt=D.ATHtype,Gt=0,Yt;switch(D.VBR){case vbr_abr:Yt=D.VBR_mean_bitrate_kbps;break;case vbr_off:Yt=D.brate;break;default:Yt=D.VBR_min_bitrate_kbps}switch(D.VBR.ordinal()<et.length?a=et[D.VBR.ordinal()]:a=0,E=16*f+a,v.findReplayGain&&(v.RadioGain>510&&(v.RadioGain=510),v.RadioGain<-510&&(v.RadioGain=-510),dt=8192,dt|=3072,v.RadioGain>=0?dt|=v.RadioGain:(dt|=512,dt|=-v.RadioGain)),v.findPeakSample&&(B=Math.abs(0|v.PeakSample/32767*Math.pow(2,23)+0.5)),zt!=-1&&(bt>0&&(Ct=!0),bt<zt-1&&(u=!0)),Gt=Qt+((mi?1:0)<<4)+((o?1:0)<<5)+((u?1:0)<<6)+((Ct?1:0)<<7),s<0&&(s=0),D.mode){case MONO:Dt=0;break;case STEREO:Dt=1;break;case DUAL_CHANNEL:Dt=2;break;case JOINT_STEREO:D.force_ms?Dt=4:Dt=3;break;case NOT_SET:default:Dt=7;break}D.in_samplerate<=32000?Wt=0:D.in_samplerate==48000?Wt=2:D.in_samplerate>48000?Wt=3:Wt=1,(D.short_blocks==Te.short_block_forced||D.short_blocks==Te.short_block_dispensed||D.lowpassfreq==-1&&D.highpassfreq==-1||D.scale_left<D.scale_right||D.scale_left>D.scale_right||D.disable_reservoir&&D.brate<320||D.noATH||D.ATHonly||Qt==0||D.in_samplerate<=32000)&&(Pt=1),yt=ft+(Dt<<2)+(Pt<<5)+(Wt<<6),Vt=v.nMusicCRC,i(J,O+it,s),it+=4;for(var xt=0;xt<9;xt++)J[O+it+xt]=255&r.charAt(xt);it+=9,J[O+it]=255&E,it++,J[O+it]=255&X,it++,i(J,O+it,B),it+=4,c(J,O+it,dt),it+=2,c(J,O+it,ut),it+=2,J[O+it]=255&Gt,it++,Yt>=255?J[O+it]=255:J[O+it]=255&Yt,it++,J[O+it]=255&F>>4,J[O+it+1]=255&(F<<4)+(h>>8),J[O+it+2]=255&h,it+=3,J[O+it]=255&yt,it++,J[O+it++]=0,c(J,O+it,D.preset),it+=2,i(J,O+it,n),it+=4,c(J,O+it,Vt),it+=2;for(var jt=0;jt<it;jt++)T=$(J[O+jt],T);return c(J,O+it,T),it+=2,it}function ht(D){D.seek(0);var n=Cn(10);D.readFully(n);var J;return new String(n,"ISO-8859-1").startsWith("ID3")?J=0:J=((n[6]&127)<<21|(n[7]&127)<<14|(n[8]&127)<<7|n[9]&127)+n.length,J}this.getLameTagFrame=function(D,n){var J=D.internal_flags;if(!D.bWriteVbrTag||J.Class_ID!=Lame.LAME_ID||J.VBR_seek_table.pos<=0)return 0;if(n.length<J.VBR_seek_table.TotalFrameSize)return J.VBR_seek_table.TotalFrameSize;ps.fill(n,0,J.VBR_seek_table.TotalFrameSize,0),q(D,n);var O=Cn(y);if(D.free_format)for(var T=1;T<y;++T)O[T]=255&255*T/100;else C(J.VBR_seek_table,O);var v=J.sideinfo_len;D.error_protection&&(v-=2),D.VBR==En.vbr_off?(n[v++]=255&_.charAt(0),n[v++]=255&_.charAt(1),n[v++]=255&_.charAt(2),n[v++]=255&_.charAt(3)):(n[v++]=255&I.charAt(0),n[v++]=255&I.charAt(1),n[v++]=255&I.charAt(2),n[v++]=255&I.charAt(3)),i(n,v,W+Q+j+x),v+=4,i(n,v,J.VBR_seek_table.nVbrNumFrames),v+=4;var it=J.VBR_seek_table.nBytesWritten+J.VBR_seek_table.TotalFrameSize;i(n,v,0|it),v+=4,cs.arraycopy(O,0,n,v,O.length),v+=O.length,D.error_protection&&e.CRC_writeheader(J,n);for(var F=0,T=0;T<v;T++)F=$(n[T],F);return v+=b(D,it,n,v,F),J.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(D,n){var J=D.internal_flags;if(J.VBR_seek_table.pos<=0||(n.seek(n.length()),n.length()==0))return-1;var O=ht(n);n.seek(O);var T=Cn(U),v=getLameTagFrame(D,T);return v>T.length?-1:(v<1||n.write(T,0,v),0)}}var gs=dn,mr=Et,Ne=mr.new_byte,ms=mr.assert,ws=te(),Cs=Eo,fs=lr,Ws=pr(),Ps=os,Ds=ur(),ks=hs,zs=ln,Js=An();ri();var Ys=as,Gs=gs;function ys(){this.setModules=function(t,e){}}function js(){this.setModules=function(t,e,d){}}function Zs(){}function $s(){this.setModules=function(t,e){}}function Fs(t,e,d){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,e=44100,d=128);var W=new ws,Q=new ys,j=new fs,x=new Js,y=new Cs,U=new Ws,R=new Ps,p=new Gs,l=new Ys,Z=new $s,V=new ks,M=new Ds,I=new js,_=new Zs;W.setModules(j,x,y,U,R,p,l,Z,_),x.setModules(j,_,l,p),Z.setModules(x,l),y.setModules(W),R.setModules(x,V,U,M),U.setModules(M,V,W.enc.psy),V.setModules(x),M.setModules(U),p.setModules(W,x,l),Q.setModules(I,_),I.setModules(l,Z,y);var z=W.lame_init();z.num_channels=t,z.in_samplerate=e,z.brate=d,z.mode=zs.STEREO,z.quality=3,z.bWriteVbrTag=!1,z.disable_reservoir=!0,z.write_id3tag_automatic=!1,W.lame_init_params(z);var g=1152,C=0|1.25*g+7200,P=Ne(C);this.encodeBuffer=function(i,c){t==1&&(c=i),ms(i.length==c.length),i.length>g&&(g=i.length,C=0|1.25*g+7200,P=Ne(C));var Y=W.lame_encode_buffer(z,i,c,i.length,P,0,C);return new Int8Array(P.subarray(0,Y))},this.flush=function(){var i=W.lame_encode_flush(z,P,0,C);return new Int8Array(P.subarray(0,i))}}function Di(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function Dn(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}Di.RIFF=Dn("RIFF");Di.WAVE=Dn("WAVE");Di.fmt_=Dn("fmt ");Di.data=Dn("data");Di.readHeader=function(t){var e=new Di,d=t.getUint32(0,!1);if(Di.RIFF==d&&(t.getUint32(4,!0),Di.WAVE==t.getUint32(8,!1)&&Di.fmt_==t.getUint32(12,!1))){var W=t.getUint32(16,!0),Q=20;switch(W){case 16:case 18:e.channels=t.getUint16(Q+2,!0),e.sampleRate=t.getUint32(Q+4,!0);break;default:throw"extended fmt chunk not implemented"}Q+=W;for(var j=Di.data,x=0;j!=d&&(d=t.getUint32(Q,!1),x=t.getUint32(Q+4,!0),j!=d);)Q+=x+8;return e.dataLen=x,e.dataOffset=Q+8,e}};var wr=Se.Mp3Encoder=Fs,k0=Se.WavHeader=Di;var Qs=32767,kn=1152;function Cr(t,e,d){let W=t.numberOfChannels;if(W!==1&&W!==2)throw Error("Expecting mono or stereo audioBuffer");if(e=e??128,e<96)W=1;let Q=t.length,j=[],x,y,U;for(let p=0;p<W;p++){x=t.getChannelData(p),y=new Int16Array(Q);for(let l=0;l<Q;++l)U=x[l],U=Math.min(1,Math.max(-1,U)),U=Math.round(U*Qs),y[l]=U;j.push(y)}let R=new wr(W,t.sampleRate,e);return new Promise((p,l)=>{let Z=[],V=0,M=()=>{let I;if(V>=Q){if(I=R.flush(),I.length>0)Z.push(I);let C=new Blob(Z,{type:"audio/mp3"});return p(C)}let _,z,g=performance.now();try{while(V<Q&&performance.now()-g<15){if(W===1)_=j[0].subarray(V,V+kn),I=R.encodeBuffer(_);else _=j[0].subarray(V,V+kn),z=j[1].subarray(V,V+kn),I=R.encodeBuffer(_,z);if(I.length>0)Z.push(I);V+=kn}}catch(C){l(C)}d&&d(V/Q),setTimeout(M,16.7)};M()})}var bs=22050,Xs=32,Us=22,ie=new AudioContext({sampleRate:bs}),ne=(t)=>new Promise(async(e)=>{let d=await Cr(t,Xs),W=new FileReader;W.readAsDataURL(d),W.addEventListener("load",(Q)=>e({data:Q.target.result.slice(Us),type:"audio/mp3",rate:t.sampleRate,sampleCount:t.length}))});function ee(t){return new Promise((e,d)=>{let W=new FileReader;W.readAsArrayBuffer(t),W.addEventListener("load",async()=>{try{let Q=await ie.decodeAudioData(W.result),j=ne(Q);e(j)}catch(Q){d(Q)}})})}async function xs(t){let d=await(await fetch(t)).arrayBuffer(),W=await ie.decodeAudioData(d);return ne(W)}async function fr(t){let e=await t.arrayBuffer(),d=await ie.decodeAudioData(e);return ne(d)}import{useCallback as an,useMemo as O0}from"preact/hooks";import{batch as Yr}from"@preact/signals";import{nanoid as re}from"@blockcode/utils";import{useProjectContext as Vs,translate as Ts,setAlert as Gr,delAlert as Ns,openAsset as oe,addAsset as yr,delAsset as Ss}from"@blockcode/core";function Wr(t){let e=Math.floor(t/60),d=Math.floor(t%60);return`${e}:${`00${d}`.slice(-2)}.${t.toFixed(3).slice(-3)}`}import{Text as Qi,IconSelector as Hs,ActionButton as Es}from"@blockcode/core";function Mi(t){let e=globalThis.document,d=e.createElement("style");d.appendChild(e.createTextNode(t)),e.head.append(d)}Mi("._YzM_q_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}._YzM_q_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}._YzM_q_selector-item{width:5rem;height:5rem;margin:.5rem auto}._YzM_q_delete-menu-item:hover{background:var(--error-primary)}._YzM_q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}._YzM_q_add-button{margin:.75rem auto}");var qi={selectorItem:"_YzM_q_selector-item",deleteMenuItem:"_YzM_q_delete-menu-item",selectorWrapper:"_YzM_q_selector-wrapper",selectorItemsWrapper:"_YzM_q_selector-items-wrapper",addButton:"_YzM_q_add-button",addButtonWrapper:"_YzM_q_add-button-wrapper"};var Pr="./assets/icon-thumb-jy4n8115.svg";var Dr="./assets/icon-sound-56nbc8vm.svg";var kr="./assets/icon-search-6g8kgvdt.svg";var Bi="./assets/icon-record-k0kczk8k.svg";var zr="./assets/icon-surprise-d5t4529a.svg";var Jr="./assets/icon-file-upload-0z25chr6.svg";import{jsx as zi,jsxs as Is}from"preact/jsx-runtime";function jr({onShowLibrary:t,onSurprise:e,onSoundsFilter:d}){let{assets:W,assetId:Q}=Vs(),j=an(()=>{return W.value.filter((p)=>{if(!/^audio\//.test(p.type))return!1;if(!d)return!0;return d(p)})},[d]),x=an(()=>{let p=document.createElement("input");p.type="file",p.accept=".wav,.mp3",p.multiple=!0,p.click(),p.addEventListener("change",async(l)=>{let Z=re();Gr("importing",{id:Z});try{for(let V of l.target.files){let M=re(),I=V.name.slice(0,V.name.lastIndexOf(".")),_=await ee(V);yr({..._,id:M,name:I})}}catch(V){Gr({id:Z,message:zi(Qi,{id:"sound.error.formatNotSupperted",defaultMessage:"This wav format is not supported."})},2000)}Ns(Z)})},[]),y=an(()=>{let p=re();Yr(()=>{yr({id:p,type:"audio/mp3",name:Ts("sound.sound","Sound"),data:"",rate:22050,sampleCount:0,record:!0}),oe(p)})},[]),U=an((p)=>{let l=j(),Z=l[p];Yr(()=>{let V=Q.value;if(Z.id===Q.value){if(p===0)V=l[1]?.id;else if(p+1<l.length)V=l[p+1].id;else if(p-1>-1)V=l[p-1].id}Ss(Z.id),oe(V)})},[]),R=an((p,l)=>{oe(l.id)},[]);return Is("div",{className:qi.selectorWrapper,children:[zi(Hs,{displayOrder:!0,id:"sound-selector",className:qi.selectorItemsWrapper,items:j().map((p,l)=>({...p,details:`${Wr(p.sampleCount/p.rate)||0}`,icon:Pr,order:l,className:qi.selectorItem,contextMenu:[[{label:zi(Qi,{id:"sound.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:zi(Qi,{id:"sound.contextMenu.delete",defaultMessage:"delete"}),className:qi.deleteMenuItem,onClick:()=>U(l)}]]})),selectedId:Q.value,onSelect:R,onDelete:U}),zi("div",{className:qi.addButtonWrapper,children:zi(Es,{tooltipPlacement:"right",className:qi.addButton,icon:Dr,tooltip:zi(Qi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t,moreButtons:[{icon:Jr,tooltip:zi(Qi,{id:"sound.actionButton.upload",defaultMessage:"Upload Sound"}),onClick:x},{icon:zr,tooltip:zi(Qi,{id:"sound.actionButton.surprise",defaultMessage:"Surprise"}),onClick:e},{icon:Bi,tooltip:zi(Qi,{id:"sound.actionButton.record",defaultMessage:"Record"}),onClick:y},{icon:kr,tooltip:zi(Qi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t}]})})]})}import{useRef as ae,useEffect as Mr,useCallback as bi}from"preact/hooks";import{classNames as yn}from"@blockcode/utils";import{useProjectContext as r0,translate as Ji,maybeTranslate as o0,setAsset as qr}from"@blockcode/core";function oi(t,e,d,W){return new(d||(d=Promise))(function(Q,j){function x(R){try{U(W.next(R))}catch(p){j(p)}}function y(R){try{U(W.throw(R))}catch(p){j(p)}}function U(R){var p;R.done?Q(R.value):(p=R.value,p instanceof d?p:new d(function(l){l(p)})).then(x,y)}U((W=W.apply(t,e||[])).next())})}class Ai{constructor(){this.listeners={}}on(t,e,d){if(this.listeners[t]||(this.listeners[t]=new Set),d==null?void 0:d.once){let W=(...Q)=>{this.un(t,W),e(...Q)};return this.listeners[t].add(W),()=>this.un(t,W)}return this.listeners[t].add(e),()=>this.un(t,e)}un(t,e){var d;(d=this.listeners[t])===null||d===void 0||d.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((d)=>d(...e))}}var zn={decode:function(t,e){return oi(this,void 0,void 0,function*(){let d=new AudioContext({sampleRate:e});try{return yield d.decodeAudioData(t)}finally{d.close()}})},createBuffer:function(t,e){if(!t||t.length===0)throw Error("channelData must be a non-empty array");if(e<=0)throw Error("duration must be greater than 0");if(typeof t[0]=="number"&&(t=[t]),!t[0]||t[0].length===0)throw Error("channelData must contain non-empty channel arrays");(function(W){let Q=W[0];if(Q.some((j)=>j>1||j<-1)){let j=Q.length,x=0;for(let y=0;y<j;y++){let U=Math.abs(Q[y]);U>x&&(x=U)}for(let y of W)for(let U=0;U<j;U++)y[U]/=x}})(t);let d=t.map((W)=>W instanceof Float32Array?W:Float32Array.from(W));return{duration:e,length:d[0].length,sampleRate:d[0].length/e,numberOfChannels:d.length,getChannelData:(W)=>{let Q=d[W];if(!Q)throw Error(`Channel ${W} not found`);return Q},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function Xr(t,e){let d=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(let[W,Q]of Object.entries(e))if(W==="children"&&Q)for(let[j,x]of Object.entries(Q))x instanceof Node?d.appendChild(x):typeof x=="string"?d.appendChild(document.createTextNode(x)):d.appendChild(Xr(j,x));else W==="style"?Object.assign(d.style,Q):W==="textContent"?d.textContent=Q:d.setAttribute(W,Q.toString());return d}function Zr(t,e,d){let W=Xr(t,e||{});return d==null||d.appendChild(W),W}var _s=Object.freeze({__proto__:null,createElement:Zr,default:Zr}),Bs={fetchBlob:function(t,e,d){return oi(this,void 0,void 0,function*(){let W=yield fetch(t,d);if(W.status>=400)throw Error(`Failed to fetch ${t}: ${W.status} (${W.statusText})`);return function(Q,j){oi(this,void 0,void 0,function*(){if(!Q.body||!Q.headers)return;let x=Q.body.getReader(),y=Number(Q.headers.get("Content-Length"))||0,U=0,R=(p)=>{U+=(p==null?void 0:p.length)||0;let l=Math.round(U/y*100);j(l)};try{for(;;){let p=yield x.read();if(p.done)break;R(p.value)}}catch(p){console.warn("Progress tracking error:",p)}})}(W.clone(),e),W.blob()})}};class Ur extends Ai{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)},{once:!0})}onMediaEvent(t,e,d){return this.media.addEventListener(t,e,d),()=>this.media.removeEventListener(t,e,d)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return this.media.canPlayType(t)!==""}setSrc(t,e){let d=this.getSrc();if(t&&d===t)return;this.revokeSrc();let W=e instanceof Blob&&(this.canPlayType(e.type)||!t)?URL.createObjectURL(e):t;if(d&&this.media.removeAttribute("src"),W||t)try{this.media.src=W}catch(Q){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(t){this.media=t}play(){return oi(this,void 0,void 0,function*(){try{return yield this.media.play()}catch(t){if(t instanceof DOMException&&t.name==="AbortError")return;throw t}})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,e){e!=null&&(this.media.preservesPitch=e),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}function se(t){return t<0?0:t>1?1:t}function Rs({maxTop:t,maxBottom:e,halfHeight:d,vScale:W}){let Q=Math.round(t*d*W);return{topHeight:Q,totalHeight:Q+Math.round(e*d*W)||1}}function As({barAlign:t,halfHeight:e,topHeight:d,totalHeight:W,canvasHeight:Q}){return t==="top"?0:t==="bottom"?Q-W:e-d}function $r(t,e,d){let W=e-t.left,Q=d-t.top;return[W/t.width,Q/t.height]}function xr(t){return Boolean(t.barWidth||t.barGap||t.barAlign)}function Fr(t,e){if(!xr(e))return t;let d=e.barWidth||0.5,W=d+(e.barGap||d/2);return W===0?t:Math.floor(t/W)*W}function Qr({scrollLeft:t,totalWidth:e,numCanvases:d}){if(e===0)return[0];let W=t/e,Q=Math.floor(W*d);return[Q-1,Q,Q+1]}function br({scrollLeft:t,clientWidth:e,scrollWidth:d}){if(d===0)return{startX:0,endX:0};return{startX:t/d,endX:(t+e)/d}}class Lr extends Ai{constructor(t,e){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragUnsubscribe=null,this.subscriptions=[],this.options=t;let d=this.parentFromOptionsContainer(t.container);this.parent=d;let[W,Q]=this.initHtml();d.appendChild(W),this.container=W,this.scrollContainer=Q.querySelector(".scroll"),this.wrapper=Q.querySelector(".wrapper"),this.canvasWrapper=Q.querySelector(".canvases"),this.progressWrapper=Q.querySelector(".progress"),this.cursor=Q.querySelector(".cursor"),e&&Q.appendChild(e),this.initEvents()}parentFromOptionsContainer(t){let e;if(typeof t=="string"?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw Error("Container not found");return e}initEvents(){if(this.wrapper.addEventListener("click",(t)=>{let e=this.wrapper.getBoundingClientRect(),[d,W]=$r(e,t.clientX,t.clientY);this.emit("click",d,W)}),this.wrapper.addEventListener("dblclick",(t)=>{let e=this.wrapper.getBoundingClientRect(),[d,W]=$r(e,t.clientX,t.clientY);this.emit("dblclick",d,W)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{let{scrollLeft:t,scrollWidth:e,clientWidth:d}=this.scrollContainer,{startX:W,endX:Q}=br({scrollLeft:t,scrollWidth:e,clientWidth:d});this.emit("scroll",W,Q,t,t+d)}),typeof ResizeObserver=="function"){let t=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{t().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let t=this.parent.clientWidth;t===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=t,this.reRender(),this.emit("resize"))}initDrag(){this.dragUnsubscribe||(this.dragUnsubscribe=function(t,e,d,W,Q=3,j=0,x=100){if(!t)return()=>{};let y=new Map,U=matchMedia("(pointer: coarse)").matches,R=()=>{},p=(l)=>{if(l.button!==j)return;if(y.set(l.pointerId,l),y.size>1)return;let{clientX:Z,clientY:V}=l,M=!1,I=Date.now(),_=(i)=>{if(i.defaultPrevented||y.size>1)return;if(U&&Date.now()-I<x)return;let{clientX:c,clientY:Y}=i,K=c-Z,q=Y-V;if(M||Math.abs(K)>Q||Math.abs(q)>Q){i.preventDefault(),i.stopPropagation();let $=t.getBoundingClientRect(),{left:b,top:ht}=$;M||(d==null||d(Z-b,V-ht),M=!0),e(K,q,c-b,Y-ht),Z=c,V=Y}},z=(i)=>{if(y.delete(i.pointerId),M){let{clientX:c,clientY:Y}=i,K=t.getBoundingClientRect(),{left:q,top:$}=K;W==null||W(c-q,Y-$)}R()},g=(i)=>{y.delete(i.pointerId),i.relatedTarget&&i.relatedTarget!==document.documentElement||z(i)},C=(i)=>{M&&(i.stopPropagation(),i.preventDefault())},P=(i)=>{i.defaultPrevented||y.size>1||M&&i.preventDefault()};document.addEventListener("pointermove",_),document.addEventListener("pointerup",z),document.addEventListener("pointerout",g),document.addEventListener("pointercancel",g),document.addEventListener("touchmove",P,{passive:!1}),document.addEventListener("click",C,{capture:!0}),R=()=>{document.removeEventListener("pointermove",_),document.removeEventListener("pointerup",z),document.removeEventListener("pointerout",g),document.removeEventListener("pointercancel",g),document.removeEventListener("touchmove",P),setTimeout(()=>{document.removeEventListener("click",C,{capture:!0})},10)}};return t.addEventListener("pointerdown",p),()=>{R(),t.removeEventListener("pointerdown",p),y.clear()}}(this.wrapper,(t,e,d)=>{let W=this.wrapper.getBoundingClientRect().width;this.emit("drag",se(d/W))},(t)=>{this.isDragging=!0;let e=this.wrapper.getBoundingClientRect().width;this.emit("dragstart",se(t/e))},(t)=>{this.isDragging=!1;let e=this.wrapper.getBoundingClientRect().width;this.emit("dragend",se(t/e))}),this.subscriptions.push(this.dragUnsubscribe))}initHtml(){let t=document.createElement("div"),e=t.attachShadow({mode:"open"}),d=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return e.innerHTML=`
      <style${d?` nonce="${d}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
          pointer-events: none;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,e]}setOptions(t){if(this.options.container!==t.container){let e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}t.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){let{scrollWidth:e}=this.scrollContainer,d=e*t;this.setScroll(d)}destroy(){var t;this.subscriptions.forEach((e)=>e()),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),(t=this.unsubscribeOnScroll)===null||t===void 0||t.forEach((e)=>e()),this.unsubscribeOnScroll=[]}createDelay(t=10){let e,d,W=()=>{e&&(clearTimeout(e),e=void 0),d&&(d(),d=void 0)};return this.timeouts.push(W),()=>new Promise((Q,j)=>{W(),d=j,e=setTimeout(()=>{e=void 0,d=void 0,Q()},t)})}getHeight(t,e){var d;let W=((d=this.audioData)===null||d===void 0?void 0:d.numberOfChannels)||1;return function({optionsHeight:Q,optionsSplitChannels:j,parentHeight:x,numberOfChannels:y,defaultHeight:U=128}){if(Q==null)return U;let R=Number(Q);if(!isNaN(R))return R;if(Q==="auto"){let p=x||U;return(j==null?void 0:j.every((l)=>!l.overlay))?p/y:p}return U}({optionsHeight:t,optionsSplitChannels:e,parentHeight:this.parent.clientHeight,numberOfChannels:W,defaultHeight:128})}convertColorValues(t){return function(e,d){if(!Array.isArray(e))return e||"";if(e.length===0)return"#999";if(e.length<2)return e[0]||"";let W=document.createElement("canvas"),Q=W.getContext("2d"),j=W.height*d,x=Q.createLinearGradient(0,0,0,j||d),y=1/(e.length-1);return e.forEach((U,R)=>{x.addColorStop(R*y,U)}),x}(t,this.getPixelRatio())}getPixelRatio(){return t=window.devicePixelRatio,Math.max(1,t||1);var t}renderBarWaveform(t,e,d,W){let{width:Q,height:j}=d.canvas,{halfHeight:x,barWidth:y,barRadius:U,barIndexScale:R,barSpacing:p}=function({width:Z,height:V,length:M,options:I,pixelRatio:_}){let z=V/2,g=I.barWidth?I.barWidth*_:1,C=I.barGap?I.barGap*_:I.barWidth?g/2:0,P=g+C||1;return{halfHeight:z,barWidth:g,barGap:C,barRadius:I.barRadius||0,barIndexScale:M>0?Z/P/M:0,barSpacing:P}}({width:Q,height:j,length:(t[0]||[]).length,options:e,pixelRatio:this.getPixelRatio()}),l=function({channelData:Z,barIndexScale:V,barSpacing:M,barWidth:I,halfHeight:_,vScale:z,canvasHeight:g,barAlign:C}){let P=Z[0]||[],i=Z[1]||P,c=P.length,Y=[],K=0,q=0,$=0;for(let b=0;b<=c;b++){let ht=Math.round(b*V);if(ht>K){let{topHeight:J,totalHeight:O}=Rs({maxTop:q,maxBottom:$,halfHeight:_,vScale:z}),T=As({barAlign:C,halfHeight:_,topHeight:J,totalHeight:O,canvasHeight:g});Y.push({x:K*M,y:T,width:I,height:O}),K=ht,q=0,$=0}let D=Math.abs(P[b]||0),n=Math.abs(i[b]||0);D>q&&(q=D),n>$&&($=n)}return Y}({channelData:t,barIndexScale:R,barSpacing:p,barWidth:y,halfHeight:x,vScale:W,canvasHeight:j,barAlign:e.barAlign});d.beginPath();for(let Z of l)U&&"roundRect"in d?d.roundRect(Z.x,Z.y,Z.width,Z.height,U):d.rect(Z.x,Z.y,Z.width,Z.height);d.fill(),d.closePath()}renderLineWaveform(t,e,d,W){let{width:Q,height:j}=d.canvas,x=function({channelData:y,width:U,height:R,vScale:p}){let l=R/2,Z=y[0]||[];return[Z,y[1]||Z].map((V,M)=>{let I=V.length,_=I?U/I:0,z=l,g=M===0?-1:1,C=[{x:0,y:z}],P=0,i=0;for(let c=0;c<=I;c++){let Y=Math.round(c*_);if(Y>P){let q=z+(Math.round(i*l*p)||1)*g;C.push({x:P,y:q}),P=Y,i=0}let K=Math.abs(V[c]||0);K>i&&(i=K)}return C.push({x:P,y:z}),C})}({channelData:t,width:Q,height:j,vScale:W});d.beginPath();for(let y of x)if(y.length){d.moveTo(y[0].x,y[0].y);for(let U=1;U<y.length;U++){let R=y[U];d.lineTo(R.x,R.y)}}d.fill(),d.closePath()}renderWaveform(t,e,d){if(d.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction)return void e.renderFunction(t,d);let W=function({channelData:Q,barHeight:j,normalize:x}){var y;let U=j||1;if(!x)return U;let R=Q[0];if(!R||R.length===0)return U;let p=0;for(let l=0;l<R.length;l++){let Z=(y=R[l])!==null&&y!==void 0?y:0,V=Math.abs(Z);V>p&&(p=V)}return p?U/p:U}({channelData:t,barHeight:e.barHeight,normalize:e.normalize});xr(e)?this.renderBarWaveform(t,e,d,W):this.renderLineWaveform(t,e,d,W)}renderSingleCanvas(t,e,d,W,Q,j,x){let y=this.getPixelRatio(),U=document.createElement("canvas");U.width=Math.round(d*y),U.height=Math.round(W*y),U.style.width=`${d}px`,U.style.height=`${W}px`,U.style.left=`${Math.round(Q)}px`,j.appendChild(U);let R=U.getContext("2d");if(e.renderFunction?(R.fillStyle=this.convertColorValues(e.waveColor),e.renderFunction(t,R)):this.renderWaveform(t,e,R),U.width>0&&U.height>0){let p=U.cloneNode(),l=p.getContext("2d");l.drawImage(U,0,0),l.globalCompositeOperation="source-in",l.fillStyle=this.convertColorValues(e.progressColor),l.fillRect(0,0,U.width,U.height),x.appendChild(p)}}renderMultiCanvas(t,e,d,W,Q,j){let x=this.getPixelRatio(),{clientWidth:y}=this.scrollContainer,U=d/x,R=function({clientWidth:V,totalWidth:M,options:I}){return Fr(Math.min(8000,V,M),I)}({clientWidth:y,totalWidth:U,options:e}),p={};if(R===0)return;let l=(V)=>{if(V<0||V>=Z)return;if(p[V])return;p[V]=!0;let M=V*R,I=Math.min(U-M,R);if(I=Fr(I,e),I<=0)return;let _=function({channelData:z,offset:g,clampedWidth:C,totalWidth:P}){return z.map((i)=>{let c=Math.floor(g/P*i.length),Y=Math.floor((g+C)/P*i.length);return i.slice(c,Y)})}({channelData:t,offset:M,clampedWidth:I,totalWidth:U});this.renderSingleCanvas(_,e,I,W,M,Q,j)},Z=Math.ceil(U/R);if(!this.isScrollable){for(let V=0;V<Z;V++)l(V);return}if(Qr({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:U,numCanvases:Z}).forEach((V)=>l(V)),Z>1){let V=this.on("scroll",()=>{let{scrollLeft:M}=this.scrollContainer;Object.keys(p).length>10&&(Q.innerHTML="",j.innerHTML="",p={}),Qr({scrollLeft:M,totalWidth:U,numCanvases:Z}).forEach((I)=>l(I))});this.unsubscribeOnScroll.push(V)}}renderChannel(t,e,d,W){var{overlay:Q}=e,j=function(R,p){var l={};for(var Z in R)Object.prototype.hasOwnProperty.call(R,Z)&&p.indexOf(Z)<0&&(l[Z]=R[Z]);if(R!=null&&typeof Object.getOwnPropertySymbols=="function"){var V=0;for(Z=Object.getOwnPropertySymbols(R);V<Z.length;V++)p.indexOf(Z[V])<0&&Object.prototype.propertyIsEnumerable.call(R,Z[V])&&(l[Z[V]]=R[Z[V]])}return l}(e,["overlay"]);let x=document.createElement("div"),y=this.getHeight(j.height,j.splitChannels);x.style.height=`${y}px`,Q&&W>0&&(x.style.marginTop=`-${y}px`),this.canvasWrapper.style.minHeight=`${y}px`,this.canvasWrapper.appendChild(x);let U=x.cloneNode();this.progressWrapper.appendChild(U),this.renderMultiCanvas(t,j,d,y,x,U)}render(t){return oi(this,void 0,void 0,function*(){var e;this.timeouts.forEach((U)=>U()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);let d=this.getPixelRatio(),W=this.scrollContainer.clientWidth,{scrollWidth:Q,isScrollable:j,useParentWidth:x,width:y}=function({duration:U,minPxPerSec:R=0,parentWidth:p,fillParent:l,pixelRatio:Z}){let V=Math.ceil(U*R),M=V>p,I=Boolean(l&&!M);return{scrollWidth:V,isScrollable:M,useParentWidth:I,width:(I?p:V)*Z}}({duration:t.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:W,fillParent:this.options.fillParent,pixelRatio:d});if(this.isScrollable=j,this.wrapper.style.width=x?"100%":`${Q}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let U=0;U<t.numberOfChannels;U++){let R=Object.assign(Object.assign({},this.options),(e=this.options.splitChannels)===null||e===void 0?void 0:e[U]);this.renderChannel([t.getChannelData(U)],R,y,U)}else{let U=[t.getChannelData(0)];t.numberOfChannels>1&&U.push(t.getChannelData(1)),this.renderChannel(U,this.options,y,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach((d)=>d()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:t}=this.scrollContainer,{right:e}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){let{right:d}=this.progressWrapper.getBoundingClientRect(),W=function(Q){let j=2*Q;return(j<0?Math.floor(j):Math.ceil(j))/2}(d-e);this.scrollContainer.scrollLeft+=W}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,e=!1){let{scrollLeft:d,scrollWidth:W,clientWidth:Q}=this.scrollContainer,j=t*W,x=d,y=d+Q,U=Q/2;if(this.isDragging)j+30>y?this.scrollContainer.scrollLeft+=30:j-30<x&&(this.scrollContainer.scrollLeft-=30);else{(j<x||j>y)&&(this.scrollContainer.scrollLeft=j-(this.options.autoCenter?U:0));let R=j-d-U;e&&this.options.autoCenter&&R>0&&(this.scrollContainer.scrollLeft+=R)}{let R=this.scrollContainer.scrollLeft,{startX:p,endX:l}=br({scrollLeft:R,scrollWidth:W,clientWidth:Q});this.emit("scroll",p,l,R,R+Q)}}renderProgress(t,e){if(isNaN(t))return;let d=100*t;this.canvasWrapper.style.clipPath=`polygon(${d}% 0%, 100% 0%, 100% 100%, ${d}% 100%)`,this.progressWrapper.style.width=`${d}%`,this.cursor.style.left=`${d}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${t*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,e)}exportImage(t,e,d){return oi(this,void 0,void 0,function*(){let W=this.canvasWrapper.querySelectorAll("canvas");if(!W.length)throw Error("No waveform data");if(d==="dataURL"){let Q=Array.from(W).map((j)=>j.toDataURL(t,e));return Promise.resolve(Q)}return Promise.all(Array.from(W).map((Q)=>new Promise((j,x)=>{Q.toBlob((y)=>{y?j(y):x(Error("Could not export image"))},t,e)})))})}}class Kr extends Ai{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;let t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class Jn extends Ai{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return oi(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((e)=>{if(e.status>=400)throw Error(`Failed to fetch ${t}: ${e.status} (${e.statusText})`);return e.arrayBuffer()}).then((e)=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(e)).then((e)=>{this.currentSrc===t&&(this.buffer=e,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}).catch((e)=>{console.error("WebAudioPlayer load error:",e)})}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;(t>=this.duration||t<0)&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,(t=this.bufferNode)===null||t===void 0||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return oi(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){let e=t-this.currentTime,d=this.bufferNode;d==null||d.stop(this.audioContext.currentTime+e),d==null||d.addEventListener("ended",()=>{d===this.bufferNode&&(this.bufferNode=null,this.pause())},{once:!0})}setSinkId(t){return oi(this,void 0,void 0,function*(){return this.audioContext.setSinkId(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){let e=!this.paused;e&&this._pause(),this.playedDuration=t/this._playbackRate,e&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,e;return(t=this._duration)!==null&&t!==void 0?t:((e=this.buffer)===null||e===void 0?void 0:e.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){let t=[];if(!this.buffer)return t;let e=this.buffer.numberOfChannels;for(let d=0;d<e;d++)t.push(this.buffer.getChannelData(d));return t}removeAttribute(t){switch(t){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}var t0={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8000};class Ri extends Ur{static create(t){return new Ri(t)}constructor(t){let e=t.media||(t.backend==="WebAudio"?new Jn:void 0);super({media:e,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},t0,t),this.timer=new Kr;let d=e?void 0:this.getMediaElement();this.renderer=new Lr(this.options,d),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();let W=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:Q,duration:j}=this.options;(W||Q&&j)&&this.load(W,Q,j).catch((x)=>{this.emit("error",x instanceof Error?x:Error(String(x)))})})}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),this.stopAtPosition!=null&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let t=this.updateProgress();this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var t;this.emit("error",(t=this.getMediaElement().error)!==null&&t!==void 0?t:Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,e)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,e))}),this.renderer.on("dblclick",(t,e)=>{this.emit("dblclick",t,e)}),this.renderer.on("scroll",(t,e,d,W)=>{let Q=this.getDuration();this.emit("scroll",t*Q,e*Q,d,W)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",(t)=>{this.emit("dragstart",t)}),this.renderer.on("dragend",(t)=>{this.emit("dragend",t)}),this.renderer.on("resize",()=>{this.emit("resize")}));{let t,e=this.renderer.on("drag",(d)=>{var W;if(!this.options.interact)return;this.renderer.renderProgress(d),clearTimeout(t);let Q=0,j=this.options.dragToSeek;this.isPlaying()?Q=0:j===!0?Q=200:j&&typeof j=="object"&&(Q=(W=j.debounceTime)!==null&&W!==void 0?W:200),t=setTimeout(()=>{this.seekTo(d)},Q),this.emit("interaction",d*this.getDuration()),this.emit("drag",d)});this.subscriptions.push(()=>{clearTimeout(t),e()})}}initPlugins(){var t;((t=this.options.plugins)===null||t===void 0?void 0:t.length)&&this.options.plugins.forEach((e)=>{this.registerPlugin(e)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t)=>t()),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=zn.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=zn.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){if(this.plugins.includes(t))return t;t._init(this),this.plugins.push(t);let e=t.once("destroy",()=>{this.plugins=this.plugins.filter((d)=>d!==t),this.subscriptions=this.subscriptions.filter((d)=>d!==e)});return this.subscriptions.push(e),t}unregisterPlugin(t){this.plugins=this.plugins.filter((e)=>e!==t),t.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){let e=t/this.getDuration();this.renderer.setScrollPercentage(e)}getActivePlugins(){return this.plugins}loadAudio(t,e,d,W){return oi(this,void 0,void 0,function*(){var Q;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,(Q=this.abortController)===null||Q===void 0||Q.abort(),this.abortController=null,!e&&!d){let x=this.options.fetchParams||{};window.AbortController&&!x.signal&&(this.abortController=new AbortController,x.signal=this.abortController.signal);let y=(R)=>this.emit("loading",R);e=yield Bs.fetchBlob(t,y,x);let U=this.options.blobMimeType;U&&(e=new Blob([e],{type:U}))}this.setSrc(t,e);let j=yield new Promise((x)=>{let y=W||this.getDuration();y?x(y):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>x(this.getDuration()),{once:!0}))});if(!t&&!e){let x=this.getMediaElement();x instanceof Jn&&(x.duration=j)}if(d)this.decodedData=zn.createBuffer(d,j||0);else if(e){let x=yield e.arrayBuffer();this.decodedData=yield zn.decode(x,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(t,e,d){return oi(this,void 0,void 0,function*(){try{return yield this.loadAudio(t,void 0,e,d)}catch(W){throw this.emit("error",W),W}})}loadBlob(t,e,d){return oi(this,void 0,void 0,function*(){try{return yield this.loadAudio("",t,e,d)}catch(W){throw this.emit("error",W),W}})}zoom(t){if(!this.decodedData)throw Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:e=8000,precision:d=1e4}={}){if(!this.decodedData)throw Error("The audio has not been decoded yet");let W=Math.min(t,this.decodedData.numberOfChannels),Q=[];for(let j=0;j<W;j++){let x=this.decodedData.getChannelData(j),y=[],U=x.length/e;for(let R=0;R<e;R++){let p=x.slice(Math.floor(R*U),Math.ceil((R+1)*U)),l=0;for(let Z=0;Z<p.length;Z++){let V=p[Z];Math.abs(V)>Math.abs(l)&&(l=V)}y.push(Math.round(l*d)/d)}Q.push(y)}return Q}getDuration(){let t=super.getDuration()||0;return t!==0&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){let e=this.getDuration()*t;this.setTime(e)}play(t,e){let d=Object.create(null,{play:{get:()=>super.play}});return oi(this,void 0,void 0,function*(){t!=null&&this.setTime(t);let W=yield d.play.call(this);return e!=null&&(this.media instanceof Jn?this.media.stopAt(e):this.stopAtPosition=e),W})}playPause(){return oi(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],0.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return oi(this,arguments,void 0,function*(t="image/png",e=1,d="dataURL"){return this.renderer.exportImage(t,e,d)})}destroy(){var t;this.emit("destroy"),(t=this.abortController)===null||t===void 0||t.abort(),this.plugins.forEach((e)=>e.destroy()),this.subscriptions.forEach((e)=>e()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}Ri.BasePlugin=class extends Ai{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},Ri.dom=_s;function de(t,e,d,W){return new(d||(d=Promise))(function(Q,j){function x(R){try{U(W.next(R))}catch(p){j(p)}}function y(R){try{U(W.throw(R))}catch(p){j(p)}}function U(R){var p;R.done?Q(R.value):(p=R.value,p instanceof d?p:new d(function(l){l(p)})).then(x,y)}U((W=W.apply(t,e||[])).next())})}class he{constructor(){this.listeners={}}on(t,e,d){if(this.listeners[t]||(this.listeners[t]=new Set),d==null?void 0:d.once){let W=(...Q)=>{this.un(t,W),e(...Q)};return this.listeners[t].add(W),()=>this.un(t,W)}return this.listeners[t].add(e),()=>this.un(t,e)}un(t,e){var d;(d=this.listeners[t])===null||d===void 0||d.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((d)=>d(...e))}}class Or extends he{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}class vr extends he{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;let t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}var i0=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class Yn extends Or{constructor(t){var e,d,W,Q,j,x;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(e=t.audioBitsPerSecond)!==null&&e!==void 0?e:128000,scrollingWaveform:(d=t.scrollingWaveform)!==null&&d!==void 0&&d,scrollingWaveformWindow:(W=t.scrollingWaveformWindow)!==null&&W!==void 0?W:5,continuousWaveform:(Q=t.continuousWaveform)!==null&&Q!==void 0&&Q,renderRecordedAudio:(j=t.renderRecordedAudio)===null||j===void 0||j,mediaRecorderTimeslice:(x=t.mediaRecorderTimeslice)!==null&&x!==void 0?x:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.micStream=null,this.recordedBlobUrl=null,this.timer=new vr,this.subscriptions.push(this.timer.on("tick",()=>{let y=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+y,this.emit("record-progress",this.duration)}))}static create(t){return new Yn(t||{})}renderMicStream(t){var e;let d=new AudioContext,W=d.createMediaStreamSource(t),Q=d.createAnalyser();W.connect(Q),this.options.continuousWaveform&&(Q.fftSize=32);let j=Q.frequencyBinCount,x=new Float32Array(j),y=0;this.wavesurfer&&((e=this.originalOptions)!==null&&e!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));let U=setInterval(()=>{var R,p,l,Z;if(!this.isWaveformPaused){if(Q.getFloatTimeDomainData(x),this.options.scrollingWaveform){let V=Math.floor((this.options.scrollingWaveformWindow||0)*d.sampleRate),M=Math.min(V,this.dataWindow?this.dataWindow.length+j:j),I=new Float32Array(V);if(this.dataWindow){let _=Math.max(0,V-this.dataWindow.length);I.set(this.dataWindow.slice(-M+j),_)}I.set(x,V-j),this.dataWindow=I}else if(this.options.continuousWaveform){if(!this.dataWindow){let M=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((p=(R=this.wavesurfer)===null||R===void 0?void 0:R.getWidth())!==null&&p!==void 0?p:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(M)}let V=0;for(let M=0;M<j;M++){let I=Math.abs(x[M]);I>V&&(V=I)}if(y+1>this.dataWindow.length){let M=new Float32Array(2*this.dataWindow.length);M.set(this.dataWindow,0),this.dataWindow=M}this.dataWindow[y]=V,y++}else this.dataWindow=x;if(this.wavesurfer){let V=((Z=(l=this.dataWindow)===null||l===void 0?void 0:l.length)!==null&&Z!==void 0?Z:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:V).then(()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1000),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))}).catch((M)=>{console.error("Error rendering real-time recording data:",M)})}}},10);return{onDestroy:()=>{clearInterval(U),W==null||W.disconnect(),d==null||d.close()},onEnd:()=>{this.isWaveformPaused=!0,this.stopMic()}}}startMic(t){return de(this,void 0,void 0,function*(){let e;this.micStream&&this.stopMic();try{e=yield navigator.mediaDevices.getUserMedia({audio:t==null||t})}catch(W){throw Error("Error accessing the microphone: "+W.message)}let d=this.renderMicStream(e);return this.micStream=d,this.unsubscribeDestroy=this.once("destroy",d.onDestroy),this.unsubscribeRecordEnd=this.once("record-end",d.onEnd),this.stream=e,e})}stopMic(){var t,e,d;(t=this.micStream)===null||t===void 0||t.onDestroy(),(e=this.unsubscribeDestroy)===null||e===void 0||e.call(this),(d=this.unsubscribeRecordEnd)===null||d===void 0||d.call(this),this.micStream=null,this.unsubscribeDestroy=void 0,this.unsubscribeRecordEnd=void 0,this.stream&&(this.stream.getTracks().forEach((W)=>W.stop()),this.stream=null,this.mediaRecorder=null)}startRecording(t){return de(this,void 0,void 0,function*(){let e=this.stream||(yield this.startMic(t));this.dataWindow=null;let d=this.mediaRecorder||new MediaRecorder(e,{mimeType:this.options.mimeType||i0.find((j)=>MediaRecorder.isTypeSupported(j)),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=d,this.stopRecording();let W=[];d.ondataavailable=(j)=>{j.data.size>0&&W.push(j.data),this.emit("record-data-available",j.data)};let Q=(j)=>{var x;let y=new Blob(W,{type:d.mimeType});this.emit(j,y),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),this.recordedBlobUrl&&URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=URL.createObjectURL(y),(x=this.wavesurfer)===null||x===void 0||x.load(this.recordedBlobUrl))};d.onpause=()=>Q("record-pause"),d.onstop=()=>Q("record-end"),d.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")})}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,e;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(e=this.mediaRecorder)===null||e===void 0||e.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return de(this,void 0,void 0,function*(){return navigator.mediaDevices.enumerateDevices().then((t)=>t.filter((e)=>e.kind==="audioinput"))})}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic(),this.recordedBlobUrl&&(URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=null)}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}import{Label as s0,BufferedInput as d0,Button as Vr}from"@blockcode/core";Mi("._32PlYG_wave-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._32PlYG_wave-wrapper._32PlYG_disabled{opacity:.5;pointer-events:none}._32PlYG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._32PlYG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._32PlYG_row-right{margin-right:var(--space);justify-content:right}._32PlYG_row:last-child{min-height:unset;margin-bottom:0}._32PlYG_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._32PlYG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._32PlYG_name-input{width:8rem}._32PlYG_large-input{width:4rem}._32PlYG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._32PlYG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._32PlYG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._32PlYG_button-icon{width:100%;height:100%;margin:auto}._32PlYG_group-button{border-left:none;border-radius:0}._32PlYG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._32PlYG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._32PlYG_group-button-toggled-off{filter:saturate(0)}._32PlYG_label-button{border:0;font-weight:400}._32PlYG_label-button._32PlYG_selected{background:var(--theme-primary);color:var(--ui-white)}._32PlYG_label-button._32PlYG_selected ._32PlYG_button-icon{filter:brightness(0)invert()}._32PlYG_play-button,._32PlYG_record-button{cursor:pointer;width:3rem;height:3rem;margin:0 var(--space);border:0;border-radius:100%;padding:.75rem}._32PlYG_play-button{background:var(--theme-primary)}._32PlYG_record-button{background:var(--error-primary)}._32PlYG_wave-box-wrapper{margin:20px var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)*.8);background:hsl(from var(--blocks-sounds-primary)h s l/.15);flex:1;min-height:160px;position:relative;overflow:hidden}._32PlYG_wave-box-wrapper._32PlYG_hidden>div{visibility:hidden}");var It={selected:"_32PlYG_selected",rowRight:"_32PlYG_row-right",buttonIcon:"_32PlYG_button-icon",recordButton:"_32PlYG_record-button",playButton:"_32PlYG_play-button",waveBoxWrapper:"_32PlYG_wave-box-wrapper",hidden:"_32PlYG_hidden",groupButtonLast:"_32PlYG_group-button-last",nameInput:"_32PlYG_name-input",rowFill:"_32PlYG_row-fill",waveWrapper:"_32PlYG_wave-wrapper",groupButton:"_32PlYG_group-button",toolIcon:"_32PlYG_tool-icon",groupButtonFirst:"_32PlYG_group-button-first",largeInput:"_32PlYG_large-input",button:"_32PlYG_button",groupButtonToggledOff:"_32PlYG_group-button-toggled-off",dashedBorder:"_32PlYG_dashed-border",labelButton:"_32PlYG_label-button",disabled:"_32PlYG_disabled",row:"_32PlYG_row",group:"_32PlYG_group",labelImage:"_32PlYG_label-image"};var Gn="./assets/icon-play-mnpftarf.svg";var le="./assets/icon-stop-547qvw0a.svg";import{jsx as yi,jsxs as Nr}from"preact/jsx-runtime";var h0=Yn.create(),Tr;function Sr(){let t=ae(),e=ae(),d=ae(),{asset:W}=r0(),Q=W.value,j=!Q||!/^audio\//.test(Q.type);Mr(()=>{if(!t.ws)return;if(t.ws.isPlaying())t.ws.stop();if(t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})}),t.ws.empty(),Q?.sampleCount>0)t.ws.load(`data:${Q.type};base64,${Q.data}`);if(t.record.sound=Q,e.current)e.current.src=Gn,e.current.title=Ji("sound.play","Play");if(d.current)d.current.src=Bi,d.current.title=Ji("sound.record","Record")},[Q,j]);let x=bi((M,I)=>{qr({[M]:I})},[]),y=bi(()=>{if(t.ws){if(t.ws.isPlaying())t.ws.stop();else if(Q.sampleCount>0)t.ws.play()}if(d.current)setTimeout(()=>{let M=d.current.parentElement.parentElement;if(M.disabled=t.ws.isPlaying(),t.ws.isPlaying())M.classList.add(It.groupButtonToggledOff);else M.classList.remove(It.groupButtonToggledOff)})},[Q]),U=bi(()=>{if(e.current)e.current.src=le,e.current.title=Ji("sound.stop","Stop");if(t.ws)t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1});if(d.current){let M=d.current.parentElement.parentElement;M.disabled=!1,M.classList.remove(It.groupButtonToggledOff)}},[]),R=bi(()=>{if(e.current){if(e.current.src=Gn,e.current.title=Ji("sound.play","Play"),t.ws)t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})})}if(d.current){d.current.src=Bi,d.current.title=Ji("sound.record","Record");let M=d.current.parentElement.parentElement;M.disabled=!1,M.classList.remove(It.groupButtonToggledOff)}},[]),p=bi(()=>{if(t.ws&&!t.record.isRecording())t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1})},[]),l=bi(()=>{if(d.current)d.current.src=le,d.current.title=Ji("sound.stop","Stop");if(e.current){let M=e.current.parentElement.parentElement;M.disabled=!0,M.classList.add(It.groupButtonToggledOff)}},[]),Z=bi(()=>{if(t.record)if(t.record.isRecording())t.record.stopRecording(),t.record.stopMic(),clearTimeout(Tr);else t.record.startRecording(),Tr=setTimeout(Z,1e4)},[]),V=bi(async(M)=>{let I=await fr(M);if(qr(I),e.current){let _=e.current.parentElement.parentElement;_.disabled=!1,_.classList.remove(It.groupButtonToggledOff)}},[]);return Mr(()=>{if(t.current){if(t.ws=Ri.create({container:t.current,dragToSeek:!0,height:"auto",waveColor:"hsla(300, 48%, 50%, 1)",progressColor:"hsla(300, 48%, 50%, 0.8)",cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0}),t.record=t.ws.registerPlugin(h0),t.record.on("record-start",l),t.record.on("record-end",V),t.ws.on("play",U),t.ws.on("pause",R),t.ws.on("finish",R),t.ws.on("seeking",p),Q?.sampleCount>0)t.ws.empty(),t.ws.load(`data:${Q.type};base64,${Q.data}`);t.record.sound=Q}return()=>{if(t.ws)t.ws.destroy()}},[t]),Nr("div",{className:yn(It.waveWrapper,{[It.disabled]:j}),children:[yi("div",{className:It.row,children:yi("div",{className:It.group,children:yi(s0,{text:Ji("sound.sound","Sound"),children:yi(d0,{disabled:j,className:It.nameInput,placeholder:Ji("sound.name","name"),onSubmit:(M)=>x("name",M),value:j||!Q?Ji("sound.sound","Sound"):o0(Q.name)})})})}),yi("div",{className:It.row,children:yi("div",{ref:t,className:yn(It.waveBoxWrapper,{[It.hidden]:j})})}),Nr("div",{className:It.row,children:[yi(Vr,{className:yn(It.button,It.playButton,{[It.groupButtonToggledOff]:j}),onClick:y,children:yi("img",{ref:e,src:Gn,className:It.buttonIcon,title:Ji("sound.play","Play")})}),Q?.record&&yi(Vr,{className:yn(It.button,It.recordButton,{[It.groupButtonToggledOff]:j}),onClick:Z,children:yi("img",{ref:d,src:Bi,className:It.buttonIcon,title:Ji("sound.record","Record")})})]})]})}Mi(".cPknva_wave-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var Hr={waveEditorWrapper:"cPknva_wave-editor-wrapper"};import{jsx as Er,jsxs as a0}from"preact/jsx-runtime";function l0({onShowLibrary:t,onSurprise:e,onSoundsFilter:d}){return a0("div",{className:Hr.waveEditorWrapper,children:[Er(jr,{onShowLibrary:t,onSurprise:e,onSoundsFilter:d}),Er(Sr,{})]})}import{Text as p0}from"@blockcode/core";var Ir="./assets/icon-sound-ajkz0had.svg";import{jsx as g0}from"preact/jsx-runtime";var u0={icon:Ir,label:g0(p0,{id:"sound.sound",defaultMessage:"Sound"})};export{u0 as soundTab,xs as loadSoundFromURL,ee as loadSoundFromFile,l0 as SoundEditor};
