import{addLocalesMessages as Se}from"@blockcode/core";var fo={"sound.sound":"Sound","sound.play":"Play","sound.record":"Record","sound.stop":"Stop","sound.name":"name","sound.contextMenu.export":"export","sound.contextMenu.delete":"delete","sound.actionButton.upload":"Upload Sound","sound.actionButton.surprise":"Surprise","sound.actionButton.record":"Record","sound.actionButton.sound":"Choose a Sound","sound.error.formatNotSupperted":"This wav format is not supported."};var Po={"sound.sound":"声音","sound.play":"播放","sound.record":"录音","sound.stop":"停止","sound.name":"名称","sound.contextMenu.export":"导出","sound.contextMenu.delete":"删除","sound.actionButton.upload":"上传声音","sound.actionButton.surprise":"随机","sound.actionButton.record":"录制","sound.actionButton.sound":"选择一个声音","sound.error.formatNotSupperted":"声音文件格式不支持。"};var Wo={"sound.sound":"聲音","sound.play":"播放","sound.record":"録音","sound.stop":"停止","sound.name":"名稱","sound.contextMenu.export":"導齣","sound.contextMenu.delete":"刪除","sound.actionButton.upload":"上傳聲音","sound.actionButton.surprise":"隨機","sound.actionButton.record":"録製","sound.actionButton.sound":"選擇一個聲音","sound.error.formatNotSupperted":"聲音文件格式不支持。"};Se({en:fo,"zh-Hans":Po,"zh-Hant":Wo});var Eo={};function Ee(t){return new Int8Array(t)}function Ho(t){return new Int16Array(t)}function Io(t){return new Int32Array(t)}function _o(t){return new Float32Array(t)}function He(t){return new Float64Array(t)}function Bo(t){if(t.length==1)return _o(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(Bo(t));return d}function Ro(t){if(t.length==1)return Io(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(Ro(t));return d}function Ao(t){if(t.length==1)return Ho(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(Ao(t));return d}function te(t){if(t.length==1)return new Array(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(te(t));return d}var ie={};ie.fill=function(t,r,d,W){if(arguments.length==2)for(var O=0;O<t.length;O++)t[O]=arguments[1];else for(var O=r;O<d;O++)t[O]=W};var ln={};ln.arraycopy=function(t,r,d,W,O){for(var j=r+O;r<j;)d[W++]=t[r++]};ln.out={};ln.out.println=function(t){console.log(t)};ln.out.printf=function(){console.log.apply(console,arguments)};var Pn={};Pn.SQRT2=1.4142135623730951;Pn.FAST_LOG10=function(t){return Math.log10(t)};Pn.FAST_LOG10_X=function(t,r){return Math.log10(t)*r};function $i(t){this.ordinal=t}$i.short_block_allowed=new $i(0);$i.short_block_coupled=new $i(1);$i.short_block_dispensed=new $i(2);$i.short_block_forced=new $i(3);var ne={};ne.MAX_VALUE=340282350000000000000000000000000000000;function gi(t){this.ordinal=t}gi.vbr_off=new gi(0);gi.vbr_mt=new gi(1);gi.vbr_rh=new gi(2);gi.vbr_abr=new gi(3);gi.vbr_mtrh=new gi(4);gi.vbr_default=gi.vbr_mtrh;var Ie=function(t){},Ht={System:ln,VbrMode:gi,Float:ne,ShortBlock:$i,Util:Pn,Arrays:ie,new_array_n:te,new_byte:Ee,new_double:He,new_float:_o,new_float_n:Bo,new_int:Io,new_int_n:Ro,new_short:Ho,new_short_n:Ao,assert:Ie},Un,Do;function _e(){if(Do)return Un;Do=1;var t=Ht,r=t.System,d=t.Util,W=t.Arrays,O=t.new_float,j=ri();function L(){var Z=[-0.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,0.9063471690191471,0.1960342806591213,-0.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,0.8206787908286602,0.3901806440322567,-0.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,0.7416505462720353,0.5805693545089249,-0.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,0.6681786379192989,0.7653668647301797,-0.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,0.5993769336819237,0.9427934736519954,-0.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,0.5345111359507916,1.111140466039205,-0.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,0.4729647758913199,1.268786568327291,-0.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,0.41421356237309503,1.414213562373095,-0.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,0.3578057213145241,1.546020906725474,-0.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,0.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,0.3033466836073424,1.66293922460509,-0.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,0.2504869601913055,1.76384252869671,-0.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,0.198912367379658,1.847759065022573,-0.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,0.1483359875383474,1.913880671464418,-0.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,0.09849140335716425,1.961570560806461,-0.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,0.04912684976946725,1.990369453344394,0.035780907*d.SQRT2*0.5/0.000002384,0.017876148*d.SQRT2*0.5/0.000002384,0.003134727*d.SQRT2*0.5/0.000002384,0.002457142*d.SQRT2*0.5/0.000002384,0.000971317*d.SQRT2*0.5/0.000002384,0.000218868*d.SQRT2*0.5/0.000002384,0.000101566*d.SQRT2*0.5/0.000002384,0.000013828*d.SQRT2*0.5/0.000002384,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],x=12,A=36,u=[[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.000000000000940084909404969,0.0000000000006423305872147839,0.0000000000002382191739347918,0.000000000005456116108943412,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758252,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558783,0.0000000000008371015190102974,0.0000000000002599706096327376,-0.000000000005456116108943412,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758252,-0.000000000002858043359288076,-0.000000000002156177623817898,-0.000000000001475637723558783,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347923,-0.0000000000006423305872147843,-0.0000000000009400849094049696,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049694,-0.000000000000642330587214784,-0.0000000000002382191739347918],[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.0000000000009400849094049688,0.0000000000006423305872147841,0.0000000000002382191739347918,0.000000000005456116108943413,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758253,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558782,0.0000000000008371015190102975,0.0000000000002599706096327376,-0.000000000005461314069809755,-0.000000000004921085770524055,-0.000000000004343405037091838,-0.000000000003732668368707687,-0.000000000003093523840190885,-0.000000000002430835727329465,-0.000000000001734679010007751,-0.000000000000974825365660928,-0.0000000000002797435120168326,0,0,0,0,0,0,-0.0000000000002283748241799531,-0.0000000000004037858874020686,-0.0000000000002146547464825323],[0.1316524975873958,0.414213562373095,0.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,0.984807753012208,0.6427876096865394,0.3420201433256688,0.9396926207859084,-0.1736481776669303,-0.7660444431189779,0.8660254037844387,0.5,-0.5144957554275265,-0.4717319685649723,-0.3133774542039019,-0.1819131996109812,-0.09457419252642064,-0.04096558288530405,-0.01419856857247115,-0.003699974673760037,0.8574929257125442,0.8817419973177052,0.9496286491027329,0.9833145924917901,0.9955178160675857,0.9991605581781475,0.999899195244447,0.9999931550702802],[0,0,0,0,0,0,0.0000000000002283748241799531,0.0000000000004037858874020686,0.0000000000002146547464825323,0.000000000005461314069809755,0.000000000004921085770524055,0.000000000004343405037091838,0.000000000003732668368707687,0.000000000003093523840190885,0.000000000002430835727329466,0.000000000001734679010007751,0.000000000000974825365660928,0.0000000000002797435120168326,-0.000000000005456116108943413,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758253,-0.000000000002858043359288075,-0.000000000002156177623817898,-0.000000000001475637723558782,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347913,-0.0000000000006423305872147834,-0.0000000000009400849094049688,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049688,-0.0000000000006423305872147841,-0.0000000000002382191739347918]],h=u[j.SHORT_TYPE],Q=u[j.SHORT_TYPE],H=u[j.SHORT_TYPE],v=u[j.SHORT_TYPE],B=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function S(C,P,i){for(var a=10,z=P+238-14-286,U=-15;U<0;U++){var b,F,M;b=Z[a+-10],F=C[z+-224]*b,M=C[P+224]*b,b=Z[a+-9],F+=C[z+-160]*b,M+=C[P+160]*b,b=Z[a+-8],F+=C[z+-96]*b,M+=C[P+96]*b,b=Z[a+-7],F+=C[z+-32]*b,M+=C[P+32]*b,b=Z[a+-6],F+=C[z+32]*b,M+=C[P+-32]*b,b=Z[a+-5],F+=C[z+96]*b,M+=C[P+-96]*b,b=Z[a+-4],F+=C[z+160]*b,M+=C[P+-160]*b,b=Z[a+-3],F+=C[z+224]*b,M+=C[P+-224]*b,b=Z[a+-2],F+=C[P+-256]*b,M-=C[z+256]*b,b=Z[a+-1],F+=C[P+-192]*b,M-=C[z+192]*b,b=Z[a+0],F+=C[P+-128]*b,M-=C[z+128]*b,b=Z[a+1],F+=C[P+-64]*b,M-=C[z+64]*b,b=Z[a+2],F+=C[P+0]*b,M-=C[z+0]*b,b=Z[a+3],F+=C[P+64]*b,M-=C[z+-64]*b,b=Z[a+4],F+=C[P+128]*b,M-=C[z+-128]*b,b=Z[a+5],F+=C[P+192]*b,M-=C[z+-192]*b,F*=Z[a+6],b=M-F,i[30+U*2]=M+F,i[31+U*2]=Z[a+7]*b,a+=18,P--,z++}{var F,M,at,k;M=C[P+-16]*Z[a+-10],F=C[P+-32]*Z[a+-2],M+=(C[P+-48]-C[P+16])*Z[a+-9],F+=C[P+-96]*Z[a+-1],M+=(C[P+-80]+C[P+48])*Z[a+-8],F+=C[P+-160]*Z[a+0],M+=(C[P+-112]-C[P+80])*Z[a+-7],F+=C[P+-224]*Z[a+1],M+=(C[P+-144]+C[P+112])*Z[a+-6],F-=C[P+32]*Z[a+2],M+=(C[P+-176]-C[P+144])*Z[a+-5],F-=C[P+96]*Z[a+3],M+=(C[P+-208]+C[P+176])*Z[a+-4],F-=C[P+160]*Z[a+4],M+=(C[P+-240]-C[P+208])*Z[a+-3],F-=C[P+224],at=F-M,k=F+M,M=i[14],F=i[15]-M,i[31]=k+M,i[30]=at+F,i[15]=at-F,i[14]=k-M}{var n;n=i[28]-i[0],i[0]+=i[28],i[28]=n*Z[a+-36+7],n=i[29]-i[1],i[1]+=i[29],i[29]=n*Z[a+-36+7],n=i[26]-i[2],i[2]+=i[26],i[26]=n*Z[a+-72+7],n=i[27]-i[3],i[3]+=i[27],i[27]=n*Z[a+-72+7],n=i[24]-i[4],i[4]+=i[24],i[24]=n*Z[a+-108+7],n=i[25]-i[5],i[5]+=i[25],i[25]=n*Z[a+-108+7],n=i[22]-i[6],i[6]+=i[22],i[22]=n*d.SQRT2,n=i[23]-i[7],i[7]+=i[23],i[23]=n*d.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],n=i[6],i[6]=i[31]-n,i[31]=i[31]+n,n=i[7],i[7]=i[30]-n,i[30]=i[30]+n,n=i[22],i[22]=i[15]-n,i[15]=i[15]+n,n=i[23],i[23]=i[14]-n,i[14]=i[14]+n,n=i[20]-i[8],i[8]+=i[20],i[20]=n*Z[a+-180+7],n=i[21]-i[9],i[9]+=i[21],i[21]=n*Z[a+-180+7],n=i[18]-i[10],i[10]+=i[18],i[18]=n*Z[a+-216+7],n=i[19]-i[11],i[11]+=i[19],i[19]=n*Z[a+-216+7],n=i[16]-i[12],i[12]+=i[16],i[16]=n*Z[a+-252+7],n=i[17]-i[13],i[13]+=i[17],i[17]=n*Z[a+-252+7],n=-i[20]+i[24],i[20]+=i[24],i[24]=n*Z[a+-216+7],n=-i[21]+i[25],i[21]+=i[25],i[25]=n*Z[a+-216+7],n=i[4]-i[8],i[4]+=i[8],i[8]=n*Z[a+-216+7],n=i[5]-i[9],i[5]+=i[9],i[9]=n*Z[a+-216+7],n=i[0]-i[12],i[0]+=i[12],i[12]=n*Z[a+-72+7],n=i[1]-i[13],i[1]+=i[13],i[13]=n*Z[a+-72+7],n=i[16]-i[28],i[16]+=i[28],i[28]=n*Z[a+-72+7],n=-i[17]+i[29],i[17]+=i[29],i[29]=n*Z[a+-72+7],n=d.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=n,n=d.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=n,n=d.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=n-i[18],n=d.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=n-i[19],n=i[2],i[19]-=i[3],i[3]-=n,i[2]=i[31]-n,i[31]+=n,n=i[3],i[11]-=i[19],i[18]-=n,i[3]=i[30]-n,i[30]+=n,n=i[18],i[27]-=i[11],i[19]-=n,i[18]=i[15]-n,i[15]+=n,n=i[19],i[10]-=n,i[19]=i[14]-n,i[14]+=n,n=i[10],i[11]-=n,i[10]=i[23]-n,i[23]+=n,n=i[11],i[26]-=n,i[11]=i[22]-n,i[22]+=n,n=i[26],i[27]-=n,i[26]=i[7]-n,i[7]+=n,n=i[27],i[27]=i[6]-n,i[6]+=n,n=d.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=n,n=d.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=n,n=d.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=n,n=d.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=n,n=-d.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=n-i[8],n=-d.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=n-i[9],n=-d.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=n-i[25],n=-d.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=n-i[24],n=i[24]-i[16],i[24]=n,n=i[20]-n,i[20]=n,n=i[28]-n,i[28]=n,n=i[25]-i[17],i[25]=n,n=i[21]-n,i[21]=n,n=i[29]-n,i[29]=n,n=i[17]-i[1],i[17]=n,n=i[9]-n,i[9]=n,n=i[25]-n,i[25]=n,n=i[5]-n,i[5]=n,n=i[21]-n,i[21]=n,n=i[13]-n,i[13]=n,n=i[29]-n,i[29]=n,n=i[1]-i[0],i[1]=n,n=i[16]-n,i[16]=n,n=i[17]-n,i[17]=n,n=i[8]-n,i[8]=n,n=i[9]-n,i[9]=n,n=i[24]-n,i[24]=n,n=i[25]-n,i[25]=n,n=i[4]-n,i[4]=n,n=i[5]-n,i[5]=n,n=i[20]-n,i[20]=n,n=i[21]-n,i[21]=n,n=i[12]-n,i[12]=n,n=i[13]-n,i[13]=n,n=i[28]-n,i[28]=n,n=i[29]-n,i[29]=n,n=i[0],i[0]+=i[31],i[31]-=n,n=i[1],i[1]+=i[30],i[30]-=n,n=i[16],i[16]+=i[15],i[15]-=n,n=i[17],i[17]+=i[14],i[14]-=n,n=i[8],i[8]+=i[23],i[23]-=n,n=i[9],i[9]+=i[22],i[22]-=n,n=i[24],i[24]+=i[7],i[7]-=n,n=i[25],i[25]+=i[6],i[6]-=n,n=i[4],i[4]+=i[27],i[27]-=n,n=i[5],i[5]+=i[26],i[26]-=n,n=i[20],i[20]+=i[11],i[11]-=n,n=i[21],i[21]+=i[10],i[10]-=n,n=i[12],i[12]+=i[19],i[19]-=n,n=i[13],i[13]+=i[18],i[18]-=n,n=i[28],i[28]+=i[3],i[3]-=n,n=i[29],i[29]+=i[2],i[2]-=n}}function D(C,P){for(var i=0;i<3;i++){var a,z,U,b,F,M;b=C[P+6]*u[j.SHORT_TYPE][0]-C[P+15],a=C[P+0]*u[j.SHORT_TYPE][2]-C[P+9],z=b+a,U=b-a,b=C[P+15]*u[j.SHORT_TYPE][0]+C[P+6],a=C[P+9]*u[j.SHORT_TYPE][2]+C[P+0],F=b+a,M=-b+a,a=(C[P+3]*u[j.SHORT_TYPE][1]-C[P+12])*0.00000000002069978111953089,b=(C[P+12]*u[j.SHORT_TYPE][1]+C[P+3])*0.00000000002069978111953089,C[P+0]=z*0.0000000000190752519173728+a,C[P+15]=-F*0.0000000000190752519173728+b,U=U*0.8660254037844387*0.00000000001907525191737281,F=F*0.5*0.00000000001907525191737281+b,C[P+3]=U-F,C[P+6]=U+F,z=z*0.5*0.00000000001907525191737281-a,M=M*0.8660254037844387*0.00000000001907525191737281,C[P+9]=z+M,C[P+12]=z-M,P++}}function g(C,P,i){var a,z;{var U,b,F,M,at,k,n,G;U=i[17]-i[9],F=i[15]-i[11],M=i[14]-i[12],at=i[0]+i[8],k=i[1]+i[7],n=i[2]+i[6],G=i[3]+i[5],C[P+17]=at+n-G-(k-i[4]),z=(at+n-G)*Q[19]+(k-i[4]),a=(U-F-M)*Q[18],C[P+5]=a+z,C[P+6]=a-z,b=(i[16]-i[10])*Q[18],k=k*Q[19]+i[4],a=U*Q[12]+b+F*Q[13]+M*Q[14],z=-at*Q[16]+k-n*Q[17]+G*Q[15],C[P+1]=a+z,C[P+2]=a-z,a=U*Q[13]-b-F*Q[14]+M*Q[12],z=-at*Q[17]+k-n*Q[15]+G*Q[16],C[P+9]=a+z,C[P+10]=a-z,a=U*Q[14]-b+F*Q[12]-M*Q[13],z=at*Q[15]-k+n*Q[16]-G*Q[17],C[P+13]=a+z,C[P+14]=a-z}{var K,V,q,it,$,l,s,o;K=i[8]-i[0],q=i[6]-i[2],it=i[5]-i[3],$=i[17]+i[9],l=i[16]+i[10],s=i[15]+i[11],o=i[14]+i[12],C[P+0]=$+s+o+(l+i[13]),a=($+s+o)*Q[19]-(l+i[13]),z=(K-q+it)*Q[18],C[P+11]=a+z,C[P+12]=a-z,V=(i[7]-i[1])*Q[18],l=i[13]-l*Q[19],a=$*Q[15]-l+s*Q[16]+o*Q[17],z=K*Q[14]+V+q*Q[12]+it*Q[13],C[P+3]=a+z,C[P+4]=a-z,a=-$*Q[17]+l-s*Q[15]-o*Q[16],z=K*Q[13]+V-q*Q[14]-it*Q[12],C[P+7]=a+z,C[P+8]=a-z,a=-$*Q[16]+l-s*Q[17]-o*Q[15],z=K*Q[12]-V+q*Q[13]-it*Q[14],C[P+15]=a+z,C[P+16]=a-z}}this.mdct_sub48=function(C,P,i){for(var a=P,z=286,U=0;U<C.channels_out;U++){for(var b=0;b<C.mode_gr;b++){for(var F,M=C.l3_side.tt[b][U],at=M.xr,k=0,n=C.sb_sample[U][1-b],G=0,K=0;K<9;K++)for(S(a,z,n[G]),S(a,z+32,n[G+1]),G+=2,z+=64,F=1;F<32;F+=2)n[G-1][F]*=-1;for(F=0;F<32;F++,k+=18){var V=M.block_type,q=C.sb_sample[U][b],it=C.sb_sample[U][1-b];if(M.mixed_block_flag!=0&&F<2&&(V=0),C.amp_filter[F]<0.000000000001)W.fill(at,k+0,k+18,0);else{if(C.amp_filter[F]<1)for(var K=0;K<18;K++)it[K][B[F]]*=C.amp_filter[F];if(V==j.SHORT_TYPE){for(var K=-x/4;K<0;K++){var $=u[j.SHORT_TYPE][K+3];at[k+K*3+9]=q[9+K][B[F]]*$-q[8-K][B[F]],at[k+K*3+18]=q[14-K][B[F]]*$+q[15+K][B[F]],at[k+K*3+10]=q[15+K][B[F]]*$-q[14-K][B[F]],at[k+K*3+19]=it[2-K][B[F]]*$+it[3+K][B[F]],at[k+K*3+11]=it[3+K][B[F]]*$-it[2-K][B[F]],at[k+K*3+20]=it[8-K][B[F]]*$+it[9+K][B[F]]}D(at,k)}else{for(var l=O(18),K=-A/4;K<0;K++){var s,o;s=u[V][K+27]*it[K+9][B[F]]+u[V][K+36]*it[8-K][B[F]],o=u[V][K+9]*q[K+9][B[F]]-u[V][K+18]*q[8-K][B[F]],l[K+9]=s-o*h[3+K+9],l[K+18]=s*h[3+K+9]+o}g(at,k,l)}}if(V!=j.SHORT_TYPE&&F!=0)for(var K=7;K>=0;--K){var c,f;c=at[k+K]*H[20+K]+at[k+-1-K]*v[28+K],f=at[k+K]*v[28+K]-at[k+-1-K]*H[20+K],at[k+-1-K]=c,at[k+K]=f}}}if(a=i,z=286,C.mode_gr==1)for(var I=0;I<18;I++)r.arraycopy(C.sb_sample[U][1][I],0,C.sb_sample[U][0][I],0,32)}}}return Un=L,Un}var On,ko;function oe(){if(ko)return On;ko=1;var t=ri(),r=Ht,d=r.System,W=r.new_float,O=r.new_float_n;function j(){this.l=W(t.SBMAX_l),this.s=O([t.SBMAX_s,3]);var L=this;this.assign=function(Z){d.arraycopy(Z.l,0,L.l,0,t.SBMAX_l);for(var x=0;x<t.SBMAX_s;x++)for(var A=0;A<3;A++)L.s[x][A]=Z.s[x][A]}}return On=j,On}var qn,Jo;function Be(){if(Jo)return qn;Jo=1;var t=oe();function r(){this.thm=new t,this.en=new t}return qn=r,qn}function ki(t){var r=t;this.ordinal=function(){return r}}ki.STEREO=new ki(0);ki.JOINT_STEREO=new ki(1);ki.DUAL_CHANNEL=new ki(2);ki.MONO=new ki(3);ki.NOT_SET=new ki(4);var cn=ki,xn,Go;function ri(){if(Go)return xn;Go=1;var t=Ht,r=t.System,d=t.VbrMode,W=t.new_array_n,O=t.new_float,j=t.new_float_n,L=t.new_int,Z=t.assert;x.ENCDELAY=576,x.POSTDELAY=1152,x.MDCTDELAY=48,x.FFTOFFSET=224+x.MDCTDELAY,x.DECDELAY=528,x.SBLIMIT=32,x.CBANDS=64,x.SBPSY_l=21,x.SBPSY_s=12,x.SBMAX_l=22,x.SBMAX_s=13,x.PSFB21=6,x.PSFB12=6,x.BLKSIZE=1024,x.HBLKSIZE=x.BLKSIZE/2+1,x.BLKSIZE_s=256,x.HBLKSIZE_s=x.BLKSIZE_s/2+1,x.NORM_TYPE=0,x.START_TYPE=1,x.SHORT_TYPE=2,x.STOP_TYPE=3,x.MPG_MD_LR_LR=0,x.MPG_MD_LR_I=1,x.MPG_MD_MS_LR=2,x.MPG_MD_MS_I=3,x.fircoef=[-0.1039435,-0.1892065,-0.21623599999999998,-0.155915,0.00000000000000003898045,0.23387249999999998,0.50455,0.756825,0.9354899999999999];function x(){var A=_e(),u=Be(),h=cn,Q=x.FFTOFFSET,H=x.MPG_MD_MS_LR,v=null;this.psy=null;var B=null,S=null,D=null;this.setModules=function(a,z,U,b){v=a,this.psy=z,B=z,S=b,D=U};var g=new A;function C(a){var z,U;if(a.ATH.useAdjust==0){a.ATH.adjust=1;return}if(U=a.loudness_sq[0][0],z=a.loudness_sq[1][0],a.channels_out==2?(U+=a.loudness_sq[0][1],z+=a.loudness_sq[1][1]):(U+=U,z+=z),a.mode_gr==2&&(U=Math.max(U,z)),U*=0.5,U*=a.ATH.aaSensitivityP,U>0.03125)a.ATH.adjust>=1?a.ATH.adjust=1:a.ATH.adjust<a.ATH.adjustLimit&&(a.ATH.adjust=a.ATH.adjustLimit),a.ATH.adjustLimit=1;else{var b=31.98*U+0.000625;a.ATH.adjust>=b?(a.ATH.adjust*=b*0.075+0.925,a.ATH.adjust<b&&(a.ATH.adjust=b)):a.ATH.adjustLimit>=b?a.ATH.adjust=b:a.ATH.adjust<a.ATH.adjustLimit&&(a.ATH.adjust=a.ATH.adjustLimit),a.ATH.adjustLimit=b}}function P(a){var z,U;for(Z(0<=a.bitrate_index&&a.bitrate_index<16),Z(0<=a.mode_ext&&a.mode_ext<4),a.bitrate_stereoMode_Hist[a.bitrate_index][4]++,a.bitrate_stereoMode_Hist[15][4]++,a.channels_out==2&&(a.bitrate_stereoMode_Hist[a.bitrate_index][a.mode_ext]++,a.bitrate_stereoMode_Hist[15][a.mode_ext]++),z=0;z<a.mode_gr;++z)for(U=0;U<a.channels_out;++U){var b=a.l3_side.tt[z][U].block_type|0;a.l3_side.tt[z][U].mixed_block_flag!=0&&(b=4),a.bitrate_blockType_Hist[a.bitrate_index][b]++,a.bitrate_blockType_Hist[a.bitrate_index][5]++,a.bitrate_blockType_Hist[15][b]++,a.bitrate_blockType_Hist[15][5]++}}function i(a,z){var U=a.internal_flags,b,F;if(U.lame_encode_frame_init==0){var M,at,k=O(2014),n=O(2014);for(U.lame_encode_frame_init=1,M=0,at=0;M<286+576*(1+U.mode_gr);++M)M<576*U.mode_gr?(k[M]=0,U.channels_out==2&&(n[M]=0)):(k[M]=z[0][at],U.channels_out==2&&(n[M]=z[1][at]),++at);for(F=0;F<U.mode_gr;F++)for(b=0;b<U.channels_out;b++)U.l3_side.tt[F][b].block_type=x.SHORT_TYPE;g.mdct_sub48(U,k,n),Z(576>=x.FFTOFFSET),Z(U.mf_size>=x.BLKSIZE+a.framesize-x.FFTOFFSET),Z(U.mf_size>=512+a.framesize-32)}}this.lame_encode_mp3_frame=function(a,z,U,b,F,M){var at,k=W([2,2]);k[0][0]=new u,k[0][1]=new u,k[1][0]=new u,k[1][1]=new u;var n=W([2,2]);n[0][0]=new u,n[0][1]=new u,n[1][0]=new u,n[1][1]=new u;var G,K=[null,null],V=a.internal_flags,q=j([2,4]),it=[0.5,0.5],$=[[0,0],[0,0]],l=[[0,0],[0,0]],s,o,c;if(K[0]=z,K[1]=U,V.lame_encode_frame_init==0&&i(a,K),V.padding=0,(V.slot_lag-=V.frac_SpF)<0&&(V.slot_lag+=a.out_samplerate,V.padding=1),V.psymodel!=0){var f,I=[null,null],ot=0,y=L(2);for(c=0;c<V.mode_gr;c++){for(o=0;o<V.channels_out;o++)I[o]=K[o],ot=576+c*576-x.FFTOFFSET;if(a.VBR==d.vbr_mtrh||a.VBR==d.vbr_mt?f=B.L3psycho_anal_vbr(a,I,ot,c,k,n,$[c],l[c],q[c],y):f=B.L3psycho_anal_ns(a,I,ot,c,k,n,$[c],l[c],q[c],y),f!=0)return-4;for(a.mode==h.JOINT_STEREO&&(it[c]=q[c][2]+q[c][3],it[c]>0&&(it[c]=q[c][3]/it[c])),o=0;o<V.channels_out;o++){var _=V.l3_side.tt[c][o];_.block_type=y[o],_.mixed_block_flag=0}}}else for(c=0;c<V.mode_gr;c++)for(o=0;o<V.channels_out;o++)V.l3_side.tt[c][o].block_type=x.NORM_TYPE,V.l3_side.tt[c][o].mixed_block_flag=0,l[c][o]=$[c][o]=700;if(C(V),g.mdct_sub48(V,K[0],K[1]),V.mode_ext=x.MPG_MD_LR_LR,a.force_ms)V.mode_ext=x.MPG_MD_MS_LR;else if(a.mode==h.JOINT_STEREO){var dt=0,ut=0;for(c=0;c<V.mode_gr;c++)for(o=0;o<V.channels_out;o++)dt+=l[c][o],ut+=$[c][o];if(dt<=1*ut){var ft=V.l3_side.tt[0],Dt=V.l3_side.tt[V.mode_gr-1];ft[0].block_type==ft[1].block_type&&Dt[0].block_type==Dt[1].block_type&&(V.mode_ext=x.MPG_MD_MS_LR)}}if(V.mode_ext==H?(G=n,s=l):(G=k,s=$),a.analysis&&V.pinfo!=null)for(c=0;c<V.mode_gr;c++)for(o=0;o<V.channels_out;o++)V.pinfo.ms_ratio[c]=V.ms_ratio[c],V.pinfo.ms_ener_ratio[c]=it[c],V.pinfo.blocktype[c][o]=V.l3_side.tt[c][o].block_type,V.pinfo.pe[c][o]=s[c][o],r.arraycopy(V.l3_side.tt[c][o].xr,0,V.pinfo.xr[c][o],0,576),V.mode_ext==H&&(V.pinfo.ers[c][o]=V.pinfo.ers[c][o+2],r.arraycopy(V.pinfo.energy[c][o+2],0,V.pinfo.energy[c][o],0,V.pinfo.energy[c][o].length));if(a.VBR==d.vbr_off||a.VBR==d.vbr_abr){var Wt,Pt;for(Wt=0;Wt<18;Wt++)V.nsPsy.pefirbuf[Wt]=V.nsPsy.pefirbuf[Wt+1];for(Pt=0,c=0;c<V.mode_gr;c++)for(o=0;o<V.channels_out;o++)Pt+=s[c][o];for(V.nsPsy.pefirbuf[18]=Pt,Pt=V.nsPsy.pefirbuf[9],Wt=0;Wt<9;Wt++)Pt+=(V.nsPsy.pefirbuf[Wt]+V.nsPsy.pefirbuf[18-Wt])*x.fircoef[Wt];for(Pt=3350*V.mode_gr*V.channels_out/Pt,c=0;c<V.mode_gr;c++)for(o=0;o<V.channels_out;o++)s[c][o]*=Pt}if(V.iteration_loop.iteration_loop(a,s,it,G),v.format_bitstream(a),at=v.copy_buffer(V,b,F,M,1),a.bWriteVbrTag&&S.addVbrFrame(a),a.analysis&&V.pinfo!=null){for(o=0;o<V.channels_out;o++){var Zt;for(Zt=0;Zt<Q;Zt++)V.pinfo.pcmdata[o][Zt]=V.pinfo.pcmdata[o][Zt+a.framesize];for(Zt=Q;Zt<1600;Zt++)V.pinfo.pcmdata[o][Zt]=K[o][Zt-Q]}D.set_frame_pinfo(a,G)}return P(V),at}}return xn=x,xn}var ee=Ht,Yo=ee.Util,zo=ee.new_float,At=ri();function Re(){var t=zo(At.BLKSIZE),r=zo(At.BLKSIZE_s/2),d=[0.9238795325112867,0.3826834323650898,0.9951847266721969,0.0980171403295606,0.9996988186962042,0.02454122852291229,0.9999811752826011,0.006135884649154475];function W(j,L,Z){var x=0,A,u,h;Z<<=1;var Q=L+Z;A=4;do{var H,v,B,S,D,g,C;C=A>>1,S=A,D=A<<1,g=D+S,A=D<<1,u=L,h=u+C;do{var P,i,a,z;i=j[u+0]-j[u+S],P=j[u+0]+j[u+S],z=j[u+D]-j[u+g],a=j[u+D]+j[u+g],j[u+D]=P-a,j[u+0]=P+a,j[u+g]=i-z,j[u+S]=i+z,i=j[h+0]-j[h+S],P=j[h+0]+j[h+S],z=Yo.SQRT2*j[h+g],a=Yo.SQRT2*j[h+D],j[h+D]=P-a,j[h+0]=P+a,j[h+g]=i-z,j[h+S]=i+z,h+=A,u+=A}while(u<Q);for(v=d[x+0],H=d[x+1],B=1;B<C;B++){var U,b;U=1-2*H*H,b=2*H*v,u=L+B,h=L+S-B;do{var F,M,at,P,i,k,a,n,z,G;M=b*j[u+S]-U*j[h+S],F=U*j[u+S]+b*j[h+S],i=j[u+0]-F,P=j[u+0]+F,k=j[h+0]-M,at=j[h+0]+M,M=b*j[u+g]-U*j[h+g],F=U*j[u+g]+b*j[h+g],z=j[u+D]-F,a=j[u+D]+F,G=j[h+D]-M,n=j[h+D]+M,M=H*a-v*G,F=v*a+H*G,j[u+D]=P-F,j[u+0]=P+F,j[h+g]=k-M,j[h+S]=k+M,M=v*n-H*z,F=H*n+v*z,j[h+D]=at-F,j[h+0]=at+F,j[u+g]=i-M,j[u+S]=i+M,h+=A,u+=A}while(u<Q);U=v,v=U*d[x+0]-H*d[x+1],H=U*d[x+1]+H*d[x+0]}x+=2}while(A<Z)}var O=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(j,L,Z,x,A){for(var u=0;u<3;u++){var h=At.BLKSIZE_s/2,Q=65535&192*(u+1),H=At.BLKSIZE_s/8-1;do{var v,B,S,D,g,C=O[H<<2]&255;v=r[C]*x[Z][A+C+Q],g=r[127-C]*x[Z][A+C+Q+128],B=v-g,v=v+g,S=r[C+64]*x[Z][A+C+Q+64],g=r[63-C]*x[Z][A+C+Q+192],D=S-g,S=S+g,h-=4,L[u][h+0]=v+S,L[u][h+2]=v-S,L[u][h+1]=B+D,L[u][h+3]=B-D,v=r[C+1]*x[Z][A+C+Q+1],g=r[126-C]*x[Z][A+C+Q+129],B=v-g,v=v+g,S=r[C+65]*x[Z][A+C+Q+65],g=r[62-C]*x[Z][A+C+Q+193],D=S-g,S=S+g,L[u][h+At.BLKSIZE_s/2+0]=v+S,L[u][h+At.BLKSIZE_s/2+2]=v-S,L[u][h+At.BLKSIZE_s/2+1]=B+D,L[u][h+At.BLKSIZE_s/2+3]=B-D}while(--H>=0);W(L[u],h,At.BLKSIZE_s/2)}},this.fft_long=function(j,L,Z,x,A){var u=At.BLKSIZE/8-1,h=At.BLKSIZE/2;do{var Q,H,v,B,S,D=O[u]&255;Q=t[D]*x[Z][A+D],S=t[D+512]*x[Z][A+D+512],H=Q-S,Q=Q+S,v=t[D+256]*x[Z][A+D+256],S=t[D+768]*x[Z][A+D+768],B=v-S,v=v+S,h-=4,L[h+0]=Q+v,L[h+2]=Q-v,L[h+1]=H+B,L[h+3]=H-B,Q=t[D+1]*x[Z][A+D+1],S=t[D+513]*x[Z][A+D+513],H=Q-S,Q=Q+S,v=t[D+257]*x[Z][A+D+257],S=t[D+769]*x[Z][A+D+769],B=v-S,v=v+S,L[h+At.BLKSIZE/2+0]=Q+v,L[h+At.BLKSIZE/2+2]=Q-v,L[h+At.BLKSIZE/2+1]=H+B,L[h+At.BLKSIZE/2+3]=H-B}while(--u>=0);W(L,h,At.BLKSIZE/2)},this.init_fft=function(j){for(var L=0;L<At.BLKSIZE;L++)t[L]=0.42-0.5*Math.cos(2*Math.PI*(L+0.5)/At.BLKSIZE)+0.08*Math.cos(4*Math.PI*(L+0.5)/At.BLKSIZE);for(var L=0;L<At.BLKSIZE_s/2;L++)r[L]=0.5*(1-Math.cos(2*Math.PI*(L+0.5)/At.BLKSIZE_s))}}var Ae=Re,Qi=Ht,Ti=Qi.VbrMode,Zo=Qi.Float,Ni=Qi.ShortBlock,hi=Qi.Util,tr=Qi.Arrays,ti=Qi.new_float,wi=Qi.new_float_n,Ki=Qi.new_int,Lt=Qi.assert,ir=Ae,st=ri();function nr(){var t=cn,r=new ir,d=2.302585092994046,W=2,O=16,j=2,L=16,Z=0.34,x=0.000000004595134127921476/(st.BLKSIZE/2),A=0.01,u=0.8,h=0.6,Q=0.3,H=3.5,v=21,B=0.2302585093;function S(m){return m}function D(m,w){for(var Y=0,X=0;X<st.BLKSIZE/2;++X)Y+=m[X]*w.ATH.eql_w[X];return Y*=x,Y}function g(m,w,Y,X,E,J,T,R,N,et,tt){var rt=m.internal_flags;if(N<2)r.fft_long(rt,X[E],N,et,tt),r.fft_short(rt,J[T],N,et,tt);else if(N==2){for(var gt=st.BLKSIZE-1;gt>=0;--gt){var Qt=X[E+0][gt],ht=X[E+1][gt];X[E+0][gt]=(Qt+ht)*hi.SQRT2*0.5,X[E+1][gt]=(Qt-ht)*hi.SQRT2*0.5}for(var $t=2;$t>=0;--$t)for(var gt=st.BLKSIZE_s-1;gt>=0;--gt){var Qt=J[T+0][$t][gt],ht=J[T+1][$t][gt];J[T+0][$t][gt]=(Qt+ht)*hi.SQRT2*0.5,J[T+1][$t][gt]=(Qt-ht)*hi.SQRT2*0.5}}w[0]=X[E+0][0],w[0]*=w[0];for(var gt=st.BLKSIZE/2-1;gt>=0;--gt){var nt=X[E+0][st.BLKSIZE/2-gt],kt=X[E+0][st.BLKSIZE/2+gt];w[st.BLKSIZE/2-gt]=(nt*nt+kt*kt)*0.5}for(var $t=2;$t>=0;--$t){Y[$t][0]=J[T+0][$t][0],Y[$t][0]*=Y[$t][0];for(var gt=st.BLKSIZE_s/2-1;gt>=0;--gt){var nt=J[T+0][$t][st.BLKSIZE_s/2-gt],kt=J[T+0][$t][st.BLKSIZE_s/2+gt];Y[$t][st.BLKSIZE_s/2-gt]=(nt*nt+kt*kt)*0.5}}{for(var Ut=0,gt=11;gt<st.HBLKSIZE;gt++)Ut+=w[gt];rt.tot_ener[N]=Ut}if(m.analysis){for(var gt=0;gt<st.HBLKSIZE;gt++)rt.pinfo.energy[R][N][gt]=rt.pinfo.energy_save[N][gt],rt.pinfo.energy_save[N][gt]=w[gt];rt.pinfo.pe[R][N]=rt.pe[N]}m.athaa_loudapprox==2&&N<2&&(rt.loudness_sq[R][N]=rt.loudness_sq_save[N],rt.loudness_sq_save[N]=D(w,rt))}var C=8,P=23,i=15,a,z,U,b=[1,0.79433,0.63096,0.63096,0.63096,0.63096,0.63096,0.25119,0.11749];function F(){a=Math.pow(10,(C+1)/16),z=Math.pow(10,(P+1)/16),U=Math.pow(10,i/10)}var M=[11.052965160000001,10.487040256900002,9.9500500969,9.0247369744,8.1854926609,7.0440875649,6.061887168099999,5.2166559999999995,4.4892710641,3.8632688703999998,3.3246052225000002,2.8610369315999997,2.4621061921,2.1508568964,1.8789281476000002,1.7170433295999998,1.5691069696,1.4555939904,1.3503137208999998,1.2715945225,1.1974487183999998,1.1361428100000002,1.0779838276,1.0382591025,1],at=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1],k=[5.5396212496,5.255968908100001,4.9868695969,4.523065562499999,4.102447702500001,3.5304155236000003,3.0381535809000004,2.6145273025000004,2.2499700001,1.9362165904000002,1.6662420888999998,1.4339104515999999,1.2339655056,1.0779838276];function n(m,w,Y,X,E,J){var T;if(w>m)if(w<m*z)T=w/m;else return m+w;else{if(m>=w*z)return m+w;T=m/w}if(m+=w,X+3<=6){if(T>=a)return m;var R=0|hi.FAST_LOG10_X(T,16);return m*at[R]}var R=0|hi.FAST_LOG10_X(T,16);if(J!=0?w=E.ATH.cb_s[Y]*E.ATH.adjust:w=E.ATH.cb_l[Y]*E.ATH.adjust,m<U*w){if(m>w){var N,et;return N=1,R<=13&&(N=k[R]),et=hi.FAST_LOG10_X(m/w,0.6666666666666666),m*((M[R]-N)*et+N)}return R>13?m:m*k[R]}return m*M[R]}var G=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1];function K(m,w,Y){var X;if(m<0&&(m=0),w<0&&(w=0),m<=0)return w;if(w<=0)return m;if(w>m?X=w/m:X=m/w,-2<=Y&&Y<=2){if(X>=a)return m+w;var E=0|hi.FAST_LOG10_X(X,16);return(m+w)*G[E]}return X<z?m+w:(m<w&&(m=w),m)}function V(m,w){var Y=m.internal_flags;if(Y.channels_out>1){for(var X=0;X<st.SBMAX_l;X++){var E=Y.thm[0].l[X],J=Y.thm[1].l[X];Y.thm[0].l[X]+=J*w,Y.thm[1].l[X]+=E*w}for(var X=0;X<st.SBMAX_s;X++)for(var T=0;T<3;T++){var E=Y.thm[0].s[X][T],J=Y.thm[1].s[X][T];Y.thm[0].s[X][T]+=J*w,Y.thm[1].s[X][T]+=E*w}}}function q(m){for(var w=0;w<st.SBMAX_l;w++)if(!(m.thm[0].l[w]>1.58*m.thm[1].l[w]||m.thm[1].l[w]>1.58*m.thm[0].l[w])){var Y=m.mld_l[w]*m.en[3].l[w],X=Math.max(m.thm[2].l[w],Math.min(m.thm[3].l[w],Y));Y=m.mld_l[w]*m.en[2].l[w];var E=Math.max(m.thm[3].l[w],Math.min(m.thm[2].l[w],Y));m.thm[2].l[w]=X,m.thm[3].l[w]=E}for(var w=0;w<st.SBMAX_s;w++)for(var J=0;J<3;J++)if(!(m.thm[0].s[w][J]>1.58*m.thm[1].s[w][J]||m.thm[1].s[w][J]>1.58*m.thm[0].s[w][J])){var Y=m.mld_s[w]*m.en[3].s[w][J],X=Math.max(m.thm[2].s[w][J],Math.min(m.thm[3].s[w][J],Y));Y=m.mld_s[w]*m.en[2].s[w][J];var E=Math.max(m.thm[3].s[w][J],Math.min(m.thm[2].s[w][J],Y));m.thm[2].s[w][J]=X,m.thm[3].s[w][J]=E}}function it(m,w,Y){var X=w,E=Math.pow(10,Y);w*=2,X*=2;for(var J=0;J<st.SBMAX_l;J++){var T,R,N,et;if(et=m.ATH.cb_l[m.bm_l[J]]*E,T=Math.min(Math.max(m.thm[0].l[J],et),Math.max(m.thm[1].l[J],et)),R=Math.max(m.thm[2].l[J],et),N=Math.max(m.thm[3].l[J],et),T*w<R+N){var tt=T*X/(R+N);R*=tt,N*=tt}m.thm[2].l[J]=Math.min(R,m.thm[2].l[J]),m.thm[3].l[J]=Math.min(N,m.thm[3].l[J])}E*=st.BLKSIZE_s/st.BLKSIZE;for(var J=0;J<st.SBMAX_s;J++)for(var rt=0;rt<3;rt++){var T,R,N,et;if(et=m.ATH.cb_s[m.bm_s[J]]*E,T=Math.min(Math.max(m.thm[0].s[J][rt],et),Math.max(m.thm[1].s[J][rt],et)),R=Math.max(m.thm[2].s[J][rt],et),N=Math.max(m.thm[3].s[J][rt],et),T*w<R+N){var tt=T*w/(R+N);R*=tt,N*=tt}m.thm[2].s[J][rt]=Math.min(m.thm[2].s[J][rt],R),m.thm[3].s[J][rt]=Math.min(m.thm[3].s[J][rt],N)}}function $(m,w,Y,X,E){var J,T,R=0,N=0;for(J=T=0;J<st.SBMAX_s;++T,++J){for(var et=m.bo_s[J],tt=m.npart_s,rt=et<tt?et:tt;T<rt;)Lt(w[T]>=0),Lt(Y[T]>=0),R+=w[T],N+=Y[T],T++;if(m.en[X].s[J][E]=R,m.thm[X].s[J][E]=N,T>=tt){++J;break}Lt(w[T]>=0),Lt(Y[T]>=0);{var gt=m.PSY.bo_s_weight[J],Qt=1-gt;R=gt*w[T],N=gt*Y[T],m.en[X].s[J][E]+=R,m.thm[X].s[J][E]+=N,R=Qt*w[T],N=Qt*Y[T]}}for(;J<st.SBMAX_s;++J)m.en[X].s[J][E]=0,m.thm[X].s[J][E]=0}function l(m,w,Y,X){var E,J,T=0,R=0;for(E=J=0;E<st.SBMAX_l;++J,++E){for(var N=m.bo_l[E],et=m.npart_l,tt=N<et?N:et;J<tt;)Lt(w[J]>=0),Lt(Y[J]>=0),T+=w[J],R+=Y[J],J++;if(m.en[X].l[E]=T,m.thm[X].l[E]=R,J>=et){++E;break}Lt(w[J]>=0),Lt(Y[J]>=0);{var rt=m.PSY.bo_l_weight[E],gt=1-rt;T=rt*w[J],R=rt*Y[J],m.en[X].l[E]+=T,m.thm[X].l[E]+=R,T=gt*w[J],R=gt*Y[J]}}for(;E<st.SBMAX_l;++E)m.en[X].l[E]=0,m.thm[X].l[E]=0}function s(m,w,Y,X,E,J){var T=m.internal_flags,R,N;for(N=R=0;N<T.npart_s;++N){for(var et=0,tt=T.numlines_s[N],rt=0;rt<tt;++rt,++R){var gt=w[J][R];et+=gt}Y[N]=et}for(Lt(N==T.npart_s),R=N=0;N<T.npart_s;N++){var Qt=T.s3ind_s[N][0],ht=T.s3_ss[R++]*Y[Qt];for(++Qt;Qt<=T.s3ind_s[N][1];)ht+=T.s3_ss[R]*Y[Qt],++R,++Qt;{var $t=j*T.nb_s1[E][N];X[N]=Math.min(ht,$t)}if(T.blocktype_old[E&1]==st.SHORT_TYPE){var $t=L*T.nb_s2[E][N],nt=X[N];X[N]=Math.min($t,nt)}T.nb_s2[E][N]=T.nb_s1[E][N],T.nb_s1[E][N]=ht,Lt(X[N]>=0)}for(;N<=st.CBANDS;++N)Y[N]=0,X[N]=0}function o(m,w,Y,X){var E=m.internal_flags;m.short_blocks==Ni.short_block_coupled&&!(w[0]!=0&&w[1]!=0)&&(w[0]=w[1]=0);for(var J=0;J<E.channels_out;J++)X[J]=st.NORM_TYPE,m.short_blocks==Ni.short_block_dispensed&&(w[J]=1),m.short_blocks==Ni.short_block_forced&&(w[J]=0),w[J]!=0?(Lt(E.blocktype_old[J]!=st.START_TYPE),E.blocktype_old[J]==st.SHORT_TYPE&&(X[J]=st.STOP_TYPE)):(X[J]=st.SHORT_TYPE,E.blocktype_old[J]==st.NORM_TYPE&&(E.blocktype_old[J]=st.START_TYPE),E.blocktype_old[J]==st.STOP_TYPE&&(E.blocktype_old[J]=st.SHORT_TYPE)),Y[J]=E.blocktype_old[J],E.blocktype_old[J]=X[J]}function c(m,w,Y){return Y>=1?m:Y<=0?w:w>0?Math.pow(m/w,Y)*w:0}var f=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function I(m,w){for(var Y=309.07,X=0;X<st.SBMAX_s-1;X++)for(var E=0;E<3;E++){var J=m.thm.s[X][E];if(J>0){var T=J*w,R=m.en.s[X][E];R>T&&(R>T*10000000000?Y+=f[X]*(10*d):Y+=f[X]*hi.FAST_LOG10(R/T))}}return Y}var ot=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function y(m,w){for(var Y=281.0575,X=0;X<st.SBMAX_l-1;X++){var E=m.thm.l[X];if(E>0){var J=E*w,T=m.en.l[X];T>J&&(T>J*10000000000?Y+=ot[X]*(10*d):Y+=ot[X]*hi.FAST_LOG10(T/J))}}return Y}function _(m,w,Y,X,E){var J,T;for(J=T=0;J<m.npart_l;++J){var R=0,N=0,et;for(et=0;et<m.numlines_l[J];++et,++T){var tt=w[T];R+=tt,N<tt&&(N=tt)}Y[J]=R,X[J]=N,E[J]=R*m.rnumlines_l[J],Lt(m.rnumlines_l[J]>=0),Lt(Y[J]>=0),Lt(X[J]>=0),Lt(E[J]>=0)}}function dt(m,w,Y,X){var E=b.length-1,J=0,T=Y[J]+Y[J+1];if(T>0){var R=w[J];R<w[J+1]&&(R=w[J+1]),Lt(m.numlines_l[J]+m.numlines_l[J+1]-1>0),T=20*(R*2-T)/(T*(m.numlines_l[J]+m.numlines_l[J+1]-1));var N=0|T;N>E&&(N=E),X[J]=N}else X[J]=0;for(J=1;J<m.npart_l-1;J++)if(T=Y[J-1]+Y[J]+Y[J+1],T>0){var R=w[J-1];R<w[J]&&(R=w[J]),R<w[J+1]&&(R=w[J+1]),Lt(m.numlines_l[J-1]+m.numlines_l[J]+m.numlines_l[J+1]-1>0),T=20*(R*3-T)/(T*(m.numlines_l[J-1]+m.numlines_l[J]+m.numlines_l[J+1]-1));var N=0|T;N>E&&(N=E),X[J]=N}else X[J]=0;if(Lt(J==m.npart_l-1),T=Y[J-1]+Y[J],T>0){var R=w[J-1];R<w[J]&&(R=w[J]),Lt(m.numlines_l[J-1]+m.numlines_l[J]-1>0),T=20*(R*2-T)/(T*(m.numlines_l[J-1]+m.numlines_l[J]-1));var N=0|T;N>E&&(N=E),X[J]=N}else X[J]=0;Lt(J==m.npart_l-1)}var ut=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];this.L3psycho_anal_ns=function(m,w,Y,X,E,J,T,R,N,et){var tt=m.internal_flags,rt=wi([2,st.BLKSIZE]),gt=wi([2,3,st.BLKSIZE_s]),Qt=ti(st.CBANDS+1),ht=ti(st.CBANDS+1),$t=ti(st.CBANDS+2),nt=Ki(2),kt=Ki(2),Ut,lt,Gt,ct,Ft,Tt,wt,Mt,Ot=wi([2,576]),Nt,ai=Ki(st.CBANDS+2),Rt=Ki(st.CBANDS+2);for(tr.fill(Rt,0),Ut=tt.channels_out,m.mode==t.JOINT_STEREO&&(Ut=4),m.VBR==Ti.vbr_off?Nt=tt.ResvMax==0?0:tt.ResvSize/tt.ResvMax*0.5:m.VBR==Ti.vbr_rh||m.VBR==Ti.vbr_mtrh||m.VBR==Ti.vbr_mt?Nt=0.6:Nt=1,lt=0;lt<tt.channels_out;lt++){var St=w[lt],si=Y+576-350-v+192;for(ct=0;ct<576;ct++){var pi,ui;for(pi=St[si+ct+10],ui=0,Ft=0;Ft<(v-1)/2-1;Ft+=2)pi+=ut[Ft]*(St[si+ct+Ft]+St[si+ct+v-Ft]),ui+=ut[Ft+1]*(St[si+ct+Ft+1]+St[si+ct+v-Ft-1]);Ot[lt][ct]=pi+ui}E[X][lt].en.assign(tt.en[lt]),E[X][lt].thm.assign(tt.thm[lt]),Ut>2&&(J[X][lt].en.assign(tt.en[lt+2]),J[X][lt].thm.assign(tt.thm[lt+2]))}for(lt=0;lt<Ut;lt++){var fi,Pi,ei=ti(12),Yi=[0,0,0,0],Vi=ti(12),$n=1,po,uo=ti(st.CBANDS),go=ti(st.CBANDS),Et=[0,0,0,0],mo=ti(st.HBLKSIZE),wo=wi([3,st.HBLKSIZE_s]);for(Lt(tt.npart_s<=st.CBANDS),Lt(tt.npart_l<=st.CBANDS),ct=0;ct<3;ct++)ei[ct]=tt.nsPsy.last_en_subshort[lt][ct+6],Lt(tt.nsPsy.last_en_subshort[lt][ct+4]>0),Vi[ct]=ei[ct]/tt.nsPsy.last_en_subshort[lt][ct+4],Yi[0]+=ei[ct];if(lt==2)for(ct=0;ct<576;ct++){var Qn,Fn;Qn=Ot[0][ct],Fn=Ot[1][ct],Ot[0][ct]=Qn+Fn,Ot[1][ct]=Qn-Fn}{var Co=Ot[lt&1],nn=0;for(ct=0;ct<9;ct++){for(var Ne=nn+64,ni=1;nn<Ne;nn++)ni<Math.abs(Co[nn])&&(ni=Math.abs(Co[nn]));tt.nsPsy.last_en_subshort[lt][ct]=ei[ct+3]=ni,Yi[1+ct/3]+=ni,ni>ei[ct+3-2]?(Lt(ei[ct+3-2]>0),ni=ni/ei[ct+3-2]):ei[ct+3-2]>ni*10?ni=ei[ct+3-2]/(ni*10):ni=0,Vi[ct+3]=ni}}if(m.analysis){var yn=Vi[0];for(ct=1;ct<12;ct++)yn<Vi[ct]&&(yn=Vi[ct]);tt.pinfo.ers[X][lt]=tt.pinfo.ers_save[lt],tt.pinfo.ers_save[lt]=yn}for(po=lt==3?tt.nsPsy.attackthre_s:tt.nsPsy.attackthre,ct=0;ct<12;ct++)Et[ct/3]==0&&Vi[ct]>po&&(Et[ct/3]=ct%3+1);for(ct=1;ct<4;ct++){var Xn;Yi[ct-1]>Yi[ct]?(Lt(Yi[ct]>0),Xn=Yi[ct-1]/Yi[ct]):(Lt(Yi[ct-1]>0),Xn=Yi[ct]/Yi[ct-1]),Xn<1.7&&(Et[ct]=0,ct==1&&(Et[0]=0))}for(Et[0]!=0&&tt.nsPsy.lastAttacks[lt]!=0&&(Et[0]=0),(tt.nsPsy.lastAttacks[lt]==3||Et[0]+Et[1]+Et[2]+Et[3]!=0)&&($n=0,Et[1]!=0&&Et[0]!=0&&(Et[1]=0),Et[2]!=0&&Et[1]!=0&&(Et[2]=0),Et[3]!=0&&Et[2]!=0&&(Et[3]=0)),lt<2?kt[lt]=$n:$n==0&&(kt[0]=kt[1]=0),N[lt]=tt.tot_ener[lt],Pi=gt,fi=rt,g(m,mo,wo,fi,lt&1,Pi,lt&1,X,lt,w,Y),_(tt,mo,Qt,uo,go),dt(tt,uo,go,ai),Mt=0;Mt<3;Mt++){var Mn,di;for(s(m,wo,ht,$t,lt,Mt),$(tt,ht,$t,lt,Mt),wt=0;wt<st.SBMAX_s;wt++){if(di=tt.thm[lt].s[wt][Mt],di*=u,Et[Mt]>=2||Et[Mt+1]==1){var on=Mt!=0?Mt-1:2,ni=c(tt.thm[lt].s[wt][on],di,h*Nt);di=Math.min(di,ni)}if(Et[Mt]==1){var on=Mt!=0?Mt-1:2,ni=c(tt.thm[lt].s[wt][on],di,Q*Nt);di=Math.min(di,ni)}else if(Mt!=0&&Et[Mt-1]==3||Mt==0&&tt.nsPsy.lastAttacks[lt]==3){var on=Mt!=2?Mt+1:0,ni=c(tt.thm[lt].s[wt][on],di,Q*Nt);di=Math.min(di,ni)}Mn=ei[Mt*3+3]+ei[Mt*3+4]+ei[Mt*3+5],ei[Mt*3+5]*6<Mn&&(di*=0.5,ei[Mt*3+4]*6<Mn&&(di*=0.5)),tt.thm[lt].s[wt][Mt]=di}}for(tt.nsPsy.lastAttacks[lt]=Et[2],Tt=0,Gt=0;Gt<tt.npart_l;Gt++){for(var Mi=tt.s3ind[Gt][0],Ln=Qt[Mi]*b[ai[Mi]],Li=tt.s3_ll[Tt++]*Ln;++Mi<=tt.s3ind[Gt][1];)Ln=Qt[Mi]*b[ai[Mi]],Li=n(Li,tt.s3_ll[Tt++]*Ln,Mi,Mi-Gt,tt,0);Li*=0.158489319246111,tt.blocktype_old[lt&1]==st.SHORT_TYPE?$t[Gt]=Li:$t[Gt]=c(Math.min(Li,Math.min(W*tt.nb_1[lt][Gt],O*tt.nb_2[lt][Gt])),Li,Nt),tt.nb_2[lt][Gt]=tt.nb_1[lt][Gt],tt.nb_1[lt][Gt]=Li}for(;Gt<=st.CBANDS;++Gt)Qt[Gt]=0,$t[Gt]=0;l(tt,Qt,$t,lt)}if((m.mode==t.STEREO||m.mode==t.JOINT_STEREO)&&m.interChRatio>0&&V(m,m.interChRatio),m.mode==t.JOINT_STEREO){var Kn;q(tt),Kn=m.msfix,Math.abs(Kn)>0&&it(tt,Kn,m.ATHlower*tt.ATH.adjust)}for(o(m,kt,et,nt),lt=0;lt<Ut;lt++){var en,rn=0,pn,un;lt>1?(en=R,rn=-2,pn=st.NORM_TYPE,(et[0]==st.SHORT_TYPE||et[1]==st.SHORT_TYPE)&&(pn=st.SHORT_TYPE),un=J[X][lt-2]):(en=T,rn=0,pn=et[lt],un=E[X][lt]),pn==st.SHORT_TYPE?en[rn+lt]=I(un,tt.masking_lower):en[rn+lt]=y(un,tt.masking_lower),m.analysis&&(tt.pinfo.pe[X][lt]=en[rn+lt])}return 0};function ft(m,w,Y,X,E,J,T,R){var N=m.internal_flags;if(X<2)r.fft_long(N,T[R],X,w,Y);else if(X==2)for(var et=st.BLKSIZE-1;et>=0;--et){var tt=T[R+0][et],rt=T[R+1][et];T[R+0][et]=(tt+rt)*hi.SQRT2*0.5,T[R+1][et]=(tt-rt)*hi.SQRT2*0.5}J[0]=T[R+0][0],J[0]*=J[0];for(var et=st.BLKSIZE/2-1;et>=0;--et){var gt=T[R+0][st.BLKSIZE/2-et],Qt=T[R+0][st.BLKSIZE/2+et];J[st.BLKSIZE/2-et]=(gt*gt+Qt*Qt)*0.5}{for(var ht=0,et=11;et<st.HBLKSIZE;et++)ht+=J[et];N.tot_ener[X]=ht}if(m.analysis){for(var et=0;et<st.HBLKSIZE;et++)N.pinfo.energy[E][X][et]=N.pinfo.energy_save[X][et],N.pinfo.energy_save[X][et]=J[et];N.pinfo.pe[E][X]=N.pe[X]}}function Dt(m,w,Y,X,E,J,T,R){var N=m.internal_flags;if(E==0&&X<2&&r.fft_short(N,T[R],X,w,Y),X==2)for(var et=st.BLKSIZE_s-1;et>=0;--et){var tt=T[R+0][E][et],rt=T[R+1][E][et];T[R+0][E][et]=(tt+rt)*hi.SQRT2*0.5,T[R+1][E][et]=(tt-rt)*hi.SQRT2*0.5}J[E][0]=T[R+0][E][0],J[E][0]*=J[E][0];for(var et=st.BLKSIZE_s/2-1;et>=0;--et){var gt=T[R+0][E][st.BLKSIZE_s/2-et],Qt=T[R+0][E][st.BLKSIZE_s/2+et];J[E][st.BLKSIZE_s/2-et]=(gt*gt+Qt*Qt)*0.5}}function Wt(m,w,Y,X){var E=m.internal_flags;m.athaa_loudapprox==2&&Y<2&&(E.loudness_sq[w][Y]=E.loudness_sq_save[Y],E.loudness_sq_save[Y]=D(X,E))}var Pt=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];function Zt(m,w,Y,X,E,J,T,R,N,et){for(var tt=wi([2,576]),rt=m.internal_flags,gt=rt.channels_out,Qt=m.mode==t.JOINT_STEREO?4:gt,ht=0;ht<gt;ht++){firbuf=w[ht];for(var $t=Y+576-350-v+192,nt=0;nt<576;nt++){var kt,Ut;kt=firbuf[$t+nt+10],Ut=0;for(var lt=0;lt<(v-1)/2-1;lt+=2)kt+=Pt[lt]*(firbuf[$t+nt+lt]+firbuf[$t+nt+v-lt]),Ut+=Pt[lt+1]*(firbuf[$t+nt+lt+1]+firbuf[$t+nt+v-lt-1]);tt[ht][nt]=kt+Ut}E[X][ht].en.assign(rt.en[ht]),E[X][ht].thm.assign(rt.thm[ht]),Qt>2&&(J[X][ht].en.assign(rt.en[ht+2]),J[X][ht].thm.assign(rt.thm[ht+2]))}for(var ht=0;ht<Qt;ht++){var Gt=ti(12),ct=ti(12),Ft=[0,0,0,0],Tt=tt[ht&1],wt=0,Mt=ht==3?rt.nsPsy.attackthre_s:rt.nsPsy.attackthre,Ot=1;if(ht==2)for(var nt=0,lt=576;lt>0;++nt,--lt){var Nt=tt[0][nt],ai=tt[1][nt];tt[0][nt]=Nt+ai,tt[1][nt]=Nt-ai}for(var nt=0;nt<3;nt++)ct[nt]=rt.nsPsy.last_en_subshort[ht][nt+6],Lt(rt.nsPsy.last_en_subshort[ht][nt+4]>0),Gt[nt]=ct[nt]/rt.nsPsy.last_en_subshort[ht][nt+4],Ft[0]+=ct[nt];for(var nt=0;nt<9;nt++){for(var Rt=wt+64,St=1;wt<Rt;wt++)St<Math.abs(Tt[wt])&&(St=Math.abs(Tt[wt]));rt.nsPsy.last_en_subshort[ht][nt]=ct[nt+3]=St,Ft[1+nt/3]+=St,St>ct[nt+3-2]?(Lt(ct[nt+3-2]>0),St=St/ct[nt+3-2]):ct[nt+3-2]>St*10?St=ct[nt+3-2]/(St*10):St=0,Gt[nt+3]=St}for(var nt=0;nt<3;++nt){var si=ct[nt*3+3]+ct[nt*3+4]+ct[nt*3+5],pi=1;ct[nt*3+5]*6<si&&(pi*=0.5,ct[nt*3+4]*6<si&&(pi*=0.5)),R[ht][nt]=pi}if(m.analysis){for(var ui=Gt[0],nt=1;nt<12;nt++)ui<Gt[nt]&&(ui=Gt[nt]);rt.pinfo.ers[X][ht]=rt.pinfo.ers_save[ht],rt.pinfo.ers_save[ht]=ui}for(var nt=0;nt<12;nt++)N[ht][nt/3]==0&&Gt[nt]>Mt&&(N[ht][nt/3]=nt%3+1);for(var nt=1;nt<4;nt++){var fi=Ft[nt-1],Pi=Ft[nt],ei=Math.max(fi,Pi);ei<40000&&fi<1.7*Pi&&Pi<1.7*fi&&(nt==1&&N[ht][0]<=N[ht][nt]&&(N[ht][0]=0),N[ht][nt]=0)}N[ht][0]<=rt.nsPsy.lastAttacks[ht]&&(N[ht][0]=0),(rt.nsPsy.lastAttacks[ht]==3||N[ht][0]+N[ht][1]+N[ht][2]+N[ht][3]!=0)&&(Ot=0,N[ht][1]!=0&&N[ht][0]!=0&&(N[ht][1]=0),N[ht][2]!=0&&N[ht][1]!=0&&(N[ht][2]=0),N[ht][3]!=0&&N[ht][2]!=0&&(N[ht][3]=0)),ht<2?et[ht]=Ot:Ot==0&&(et[0]=et[1]=0),T[ht]=rt.tot_ener[ht]}}function Vt(m,w,Y){if(Y==0)for(var X=0;X<m.npart_s;X++)m.nb_s2[w][X]=m.nb_s1[w][X],m.nb_s1[w][X]=0}function mi(m,w){for(var Y=0;Y<m.npart_l;Y++)m.nb_2[w][Y]=m.nb_1[w][Y],m.nb_1[w][Y]=0}function e(m,w,Y,X){var E=b.length-1,J=0,T=Y[J]+Y[J+1];if(T>0){var R=w[J];R<w[J+1]&&(R=w[J+1]),Lt(m.numlines_s[J]+m.numlines_s[J+1]-1>0),T=20*(R*2-T)/(T*(m.numlines_s[J]+m.numlines_s[J+1]-1));var N=0|T;N>E&&(N=E),X[J]=N}else X[J]=0;for(J=1;J<m.npart_s-1;J++)if(T=Y[J-1]+Y[J]+Y[J+1],Lt(J+1<m.npart_s),T>0){var R=w[J-1];R<w[J]&&(R=w[J]),R<w[J+1]&&(R=w[J+1]),Lt(m.numlines_s[J-1]+m.numlines_s[J]+m.numlines_s[J+1]-1>0),T=20*(R*3-T)/(T*(m.numlines_s[J-1]+m.numlines_s[J]+m.numlines_s[J+1]-1));var N=0|T;N>E&&(N=E),X[J]=N}else X[J]=0;if(Lt(J==m.npart_s-1),T=Y[J-1]+Y[J],T>0){var R=w[J-1];R<w[J]&&(R=w[J]),Lt(m.numlines_s[J-1]+m.numlines_s[J]-1>0),T=20*(R*2-T)/(T*(m.numlines_s[J-1]+m.numlines_s[J]-1));var N=0|T;N>E&&(N=E),X[J]=N}else X[J]=0;Lt(J==m.npart_s-1)}function p(m,w,Y,X,E,J){var T=m.internal_flags,R=new float[st.CBANDS],N=ti(st.CBANDS),et,tt,rt,gt=new int[st.CBANDS];for(rt=tt=0;rt<T.npart_s;++rt){var Qt=0,ht=0,$t=T.numlines_s[rt];for(et=0;et<$t;++et,++tt){var nt=w[J][tt];Qt+=nt,ht<nt&&(ht=nt)}Y[rt]=Qt,R[rt]=ht,N[rt]=Qt/$t,Lt(N[rt]>=0)}for(Lt(rt==T.npart_s);rt<st.CBANDS;++rt)R[rt]=0,N[rt]=0;for(e(T,R,N,gt),tt=rt=0;rt<T.npart_s;rt++){var kt=T.s3ind_s[rt][0],Ut=T.s3ind_s[rt][1],lt,Gt,ct,Ft,Tt;for(lt=gt[kt],Gt=1,Ft=T.s3_ss[tt]*Y[kt]*b[gt[kt]],++tt,++kt;kt<=Ut;)lt+=gt[kt],Gt+=1,ct=T.s3_ss[tt]*Y[kt]*b[gt[kt]],Ft=K(Ft,ct,kt-rt),++tt,++kt;lt=(1+2*lt)/(2*Gt),Tt=b[lt]*0.5,Ft*=Tt,X[rt]=Ft,T.nb_s2[E][rt]=T.nb_s1[E][rt],T.nb_s1[E][rt]=Ft,ct=R[rt],ct*=T.minval_s[rt],ct*=Tt,X[rt]>ct&&(X[rt]=ct),T.masking_lower>1&&(X[rt]*=T.masking_lower),X[rt]>Y[rt]&&(X[rt]=Y[rt]),T.masking_lower<1&&(X[rt]*=T.masking_lower),Lt(X[rt]>=0)}for(;rt<st.CBANDS;++rt)Y[rt]=0,X[rt]=0}function Ct(m,w,Y,X,E){var J=ti(st.CBANDS),T=ti(st.CBANDS),R=Ki(st.CBANDS+2),N;_(m,w,Y,J,T),dt(m,J,T,R);var et=0;for(N=0;N<m.npart_l;N++){var tt,rt,gt,Qt,ht=m.s3ind[N][0],$t=m.s3ind[N][1],nt=0,kt=0;for(nt=R[ht],kt+=1,rt=m.s3_ll[et]*Y[ht]*b[R[ht]],++et,++ht;ht<=$t;)nt+=R[ht],kt+=1,tt=m.s3_ll[et]*Y[ht]*b[R[ht]],Qt=K(rt,tt,ht-N),rt=Qt,++et,++ht;if(nt=(1+2*nt)/(2*kt),gt=b[nt]*0.5,rt*=gt,m.blocktype_old[E&1]==st.SHORT_TYPE){var Ut=W*m.nb_1[E][N];Ut>0?X[N]=Math.min(rt,Ut):X[N]=Math.min(rt,Y[N]*Q)}else{var lt=O*m.nb_2[E][N],Gt=W*m.nb_1[E][N],Ut;lt<=0&&(lt=rt),Gt<=0&&(Gt=rt),m.blocktype_old[E&1]==st.NORM_TYPE?Ut=Math.min(Gt,lt):Ut=Gt,X[N]=Math.min(rt,Ut)}m.nb_2[E][N]=m.nb_1[E][N],m.nb_1[E][N]=rt,tt=J[N],tt*=m.minval_l[N],tt*=gt,X[N]>tt&&(X[N]=tt),m.masking_lower>1&&(X[N]*=m.masking_lower),X[N]>Y[N]&&(X[N]=Y[N]),m.masking_lower<1&&(X[N]*=m.masking_lower),Lt(X[N]>=0)}for(;N<st.CBANDS;++N)Y[N]=0,X[N]=0}function Jt(m,w){var Y=m.internal_flags;m.short_blocks==Ni.short_block_coupled&&!(w[0]!=0&&w[1]!=0)&&(w[0]=w[1]=0);for(var X=0;X<Y.channels_out;X++)m.short_blocks==Ni.short_block_dispensed&&(w[X]=1),m.short_blocks==Ni.short_block_forced&&(w[X]=0)}function Xt(m,w,Y){for(var X=m.internal_flags,E=0;E<X.channels_out;E++){var J=st.NORM_TYPE;w[E]!=0?(Lt(X.blocktype_old[E]!=st.START_TYPE),X.blocktype_old[E]==st.SHORT_TYPE&&(J=st.STOP_TYPE)):(J=st.SHORT_TYPE,X.blocktype_old[E]==st.NORM_TYPE&&(X.blocktype_old[E]=st.START_TYPE),X.blocktype_old[E]==st.STOP_TYPE&&(X.blocktype_old[E]=st.SHORT_TYPE)),Y[E]=X.blocktype_old[E],X.blocktype_old[E]=J}}function yt(m,w,Y,X,E,J,T){for(var R=J*2,N=J>0?Math.pow(10,E):1,et,tt,rt=0;rt<T;++rt){var gt=m[2][rt],Qt=m[3][rt],ht=w[0][rt],$t=w[1][rt],nt=w[2][rt],kt=w[3][rt];if(ht<=1.58*$t&&$t<=1.58*ht){var Ut=Y[rt]*Qt,lt=Y[rt]*gt;tt=Math.max(nt,Math.min(kt,Ut)),et=Math.max(kt,Math.min(nt,lt))}else tt=nt,et=kt;if(J>0){var Gt,ct,Ft=X[rt]*N;if(Gt=Math.min(Math.max(ht,Ft),Math.max($t,Ft)),nt=Math.max(tt,Ft),kt=Math.max(et,Ft),ct=nt+kt,ct>0&&Gt*R<ct){var Tt=Gt*R/ct;nt*=Tt,kt*=Tt}tt=Math.min(nt,tt),et=Math.min(kt,et)}tt>gt&&(tt=gt),et>Qt&&(et=Qt),w[2][rt]=tt,w[3][rt]=et}}this.L3psycho_anal_vbr=function(m,w,Y,X,E,J,T,R,N,et){var tt=m.internal_flags,rt,gt,Qt=ti(st.HBLKSIZE),ht=wi([3,st.HBLKSIZE_s]),$t=wi([2,st.BLKSIZE]),nt=wi([2,3,st.BLKSIZE_s]),kt=wi([4,st.CBANDS]),Ut=wi([4,st.CBANDS]),lt=wi([4,3]),Gt=0.6,ct=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ft=Ki(2),Tt=m.mode==t.JOINT_STEREO?4:tt.channels_out;Zt(m,w,Y,X,E,J,N,lt,ct,Ft),Jt(m,Ft);{for(var wt=0;wt<Tt;wt++){var Mt=wt&1;rt=$t,ft(m,w,Y,wt,X,Qt,rt,Mt),Wt(m,X,wt,Qt),Ft[Mt]!=0?Ct(tt,Qt,kt[wt],Ut[wt],wt):mi(tt,wt)}Ft[0]+Ft[1]==2&&m.mode==t.JOINT_STEREO&&yt(kt,Ut,tt.mld_cb_l,tt.ATH.cb_l,m.ATHlower*tt.ATH.adjust,m.msfix,tt.npart_l);for(var wt=0;wt<Tt;wt++){var Mt=wt&1;Ft[Mt]!=0&&l(tt,kt[wt],Ut[wt],wt)}}{for(var Ot=0;Ot<3;Ot++){for(var wt=0;wt<Tt;++wt){var Mt=wt&1;Ft[Mt]!=0?Vt(tt,wt,Ot):(gt=nt,Dt(m,w,Y,wt,Ot,ht,gt,Mt),p(m,ht,kt[wt],Ut[wt],wt,Ot))}Ft[0]+Ft[1]==0&&m.mode==t.JOINT_STEREO&&yt(kt,Ut,tt.mld_cb_s,tt.ATH.cb_s,m.ATHlower*tt.ATH.adjust,m.msfix,tt.npart_s);for(var wt=0;wt<Tt;++wt){var Mt=wt&1;Ft[Mt]==0&&$(tt,kt[wt],Ut[wt],wt,Ot)}}for(var wt=0;wt<Tt;wt++){var Mt=wt&1;if(Ft[Mt]==0)for(var Nt=0;Nt<st.SBMAX_s;Nt++){for(var ai=ti(3),Ot=0;Ot<3;Ot++){var Rt=tt.thm[wt].s[Nt][Ot];if(Rt*=u,ct[wt][Ot]>=2||ct[wt][Ot+1]==1){var St=Ot!=0?Ot-1:2,si=c(tt.thm[wt].s[Nt][St],Rt,h*Gt);Rt=Math.min(Rt,si)}else if(ct[wt][Ot]==1){var St=Ot!=0?Ot-1:2,si=c(tt.thm[wt].s[Nt][St],Rt,Q*Gt);Rt=Math.min(Rt,si)}else if(Ot!=0&&ct[wt][Ot-1]==3||Ot==0&&tt.nsPsy.lastAttacks[wt]==3){var St=Ot!=2?Ot+1:0,si=c(tt.thm[wt].s[Nt][St],Rt,Q*Gt);Rt=Math.min(Rt,si)}Rt*=lt[wt][Ot],ai[Ot]=Rt}for(var Ot=0;Ot<3;Ot++)tt.thm[wt].s[Nt][Ot]=ai[Ot]}}}for(var wt=0;wt<Tt;wt++)tt.nsPsy.lastAttacks[wt]=ct[wt][2];Xt(m,Ft,et);for(var wt=0;wt<Tt;wt++){var pi,ui,fi,Pi;wt>1?(pi=R,ui=-2,fi=st.NORM_TYPE,(et[0]==st.SHORT_TYPE||et[1]==st.SHORT_TYPE)&&(fi=st.SHORT_TYPE),Pi=J[X][wt-2]):(pi=T,ui=0,fi=et[wt],Pi=E[X][wt]),fi==st.SHORT_TYPE?pi[ui+wt]=I(Pi,tt.masking_lower):pi[ui+wt]=y(Pi,tt.masking_lower),m.analysis&&(tt.pinfo.pe[X][wt]=pi[ui+wt])}return 0};function zt(m,w){var Y=m,X;return Y>=0?X=-Y*27:X=Y*w,X<=-72?0:Math.exp(X*B)}function Yt(m){var w=0,Y=0;{var X=0,E,J;for(X=0;zt(X,m)>0.00000000000000000001;X-=1);for(E=X,J=0;Math.abs(J-E)>0.000000000001;)X=(J+E)/2,zt(X,m)>0?J=X:E=X;w=E}{var X=0,E,J;for(X=0;zt(X,m)>0.00000000000000000001;X+=1);for(E=0,J=X;Math.abs(J-E)>0.000000000001;)X=(J+E)/2,zt(X,m)>0?E=X:J=X;Y=J}{var T=0,R=1000,N;for(N=0;N<=R;++N){var X=w+N*(Y-w)/R,et=zt(X,m);T+=et}{var tt=(R+1)/(T*(Y-w));return tt}}}function Kt(m){var w,Y,X,E;return w=m,w>=0?w*=3:w*=1.5,w>=0.5&&w<=2.5?(E=w-0.5,Y=8*(E*E-2*E)):Y=0,w+=0.474,X=15.811389+7.5*w-17.5*Math.sqrt(1+w*w),X<=-60?0:(w=Math.exp((Y+X)*B),w/=0.6609193,w)}function jt(m){return m<0&&(m=0),m=m*0.001,13*Math.atan(0.76*m)+3.5*Math.atan(m*m/56.25)}function mt(m,w,Y,X,E,J,T,R,N,et,tt,rt){var gt=ti(st.CBANDS+1),Qt=R/(rt>15?1152:384),ht=Ki(st.HBLKSIZE),$t;R/=N;var nt=0,kt=0;for($t=0;$t<st.CBANDS;$t++){var Ut,lt;for(Ut=jt(R*nt),gt[$t]=R*nt,lt=nt;jt(R*lt)-Ut<Z&&lt<=N/2;lt++);for(m[$t]=lt-nt,kt=$t+1;nt<lt;)Lt(nt<st.HBLKSIZE),ht[nt++]=$t;if(nt>N/2){nt=N/2,++$t;break}}Lt($t<st.CBANDS),gt[$t]=R*nt;for(var Gt=0;Gt<rt;Gt++){var ct,Ft,Tt,wt,Mt;Tt=et[Gt],wt=et[Gt+1],ct=0|Math.floor(0.5+tt*(Tt-0.5)),ct<0&&(ct=0),Ft=0|Math.floor(0.5+tt*(wt-0.5)),Ft>N/2&&(Ft=N/2),Y[Gt]=(ht[ct]+ht[Ft])/2,w[Gt]=ht[Ft];var Ot=Qt*wt;T[Gt]=(Ot-gt[w[Gt]])/(gt[w[Gt]+1]-gt[w[Gt]]),T[Gt]<0?T[Gt]=0:T[Gt]>1&&(T[Gt]=1),Mt=jt(R*et[Gt]*tt),Mt=Math.min(Mt,15.5)/15.5,J[Gt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Mt))-2.5)}nt=0;for(var Nt=0;Nt<kt;Nt++){var ai=m[Nt],Ut,Rt;Ut=jt(R*nt),Rt=jt(R*(nt+ai-1)),X[Nt]=0.5*(Ut+Rt),Ut=jt(R*(nt-0.5)),Rt=jt(R*(nt+ai-0.5)),E[Nt]=Rt-Ut,nt+=ai}return kt}function vt(m,w,Y,X,E,J){var T=wi([st.CBANDS,st.CBANDS]),R,N=0;if(J)for(var et=0;et<w;et++)for(R=0;R<w;R++){var tt=Kt(Y[et]-Y[R])*X[R];T[et][R]=tt*E[et]}else for(R=0;R<w;R++)for(var rt=15+Math.min(21/Y[R],12),gt=Yt(rt),et=0;et<w;et++){var tt=gt*zt(Y[et]-Y[R],rt)*X[R];T[et][R]=tt*E[et]}for(var et=0;et<w;et++){for(R=0;R<w&&!(T[et][R]>0);R++);for(m[et][0]=R,R=w-1;R>0&&!(T[et][R]>0);R--);m[et][1]=R,N+=m[et][1]-m[et][0]+1}for(var Qt=ti(N),ht=0,et=0;et<w;et++)for(R=m[et][0];R<=m[et][1];R++)Qt[ht++]=T[et][R];return Qt}function ii(m){var w=jt(m);return w=Math.min(w,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*w))-2.5)}this.psymodel_init=function(m){var w=m.internal_flags,Y,X=!0,E=13,J=24,T=0,R=0,N=-8.25,et=-4.5,tt=ti(st.CBANDS),rt=ti(st.CBANDS),gt=ti(st.CBANDS),Qt=m.out_samplerate;switch(m.experimentalZ){default:case 0:X=!0;break;case 1:X=!(m.VBR==Ti.vbr_mtrh||m.VBR==Ti.vbr_mt);break;case 2:X=!1;break;case 3:E=8,T=-1.75,R=-0.0125,N=-8.25,et=-2.25;break}for(w.ms_ener_ratio_old=0.25,w.blocktype_old[0]=w.blocktype_old[1]=st.NORM_TYPE,Y=0;Y<4;++Y){for(var nt=0;nt<st.CBANDS;++nt)w.nb_1[Y][nt]=100000000000000000000,w.nb_2[Y][nt]=100000000000000000000,w.nb_s1[Y][nt]=w.nb_s2[Y][nt]=1;for(var ht=0;ht<st.SBMAX_l;ht++)w.en[Y].l[ht]=100000000000000000000,w.thm[Y].l[ht]=100000000000000000000;for(var nt=0;nt<3;++nt){for(var ht=0;ht<st.SBMAX_s;ht++)w.en[Y].s[ht][nt]=100000000000000000000,w.thm[Y].s[ht][nt]=100000000000000000000;w.nsPsy.lastAttacks[Y]=0}for(var nt=0;nt<9;nt++)w.nsPsy.last_en_subshort[Y][nt]=10}for(w.loudness_sq_save[0]=w.loudness_sq_save[1]=0,w.npart_l=mt(w.numlines_l,w.bo_l,w.bm_l,tt,rt,w.mld_l,w.PSY.bo_l_weight,Qt,st.BLKSIZE,w.scalefac_band.l,st.BLKSIZE/1152,st.SBMAX_l),Lt(w.npart_l<st.CBANDS),Y=0;Y<w.npart_l;Y++){var $t=T;tt[Y]>=E&&($t=R*(tt[Y]-E)/(J-E)+T*(J-tt[Y])/(J-E)),gt[Y]=Math.pow(10,$t/10),w.numlines_l[Y]>0?w.rnumlines_l[Y]=1/w.numlines_l[Y]:w.rnumlines_l[Y]=0}w.s3_ll=vt(w.s3ind,w.npart_l,tt,rt,gt,X);var nt=0;for(Y=0;Y<w.npart_l;Y++){var kt=Zo.MAX_VALUE;for(var Ut=0;Ut<w.numlines_l[Y];Ut++,nt++){var lt=Qt*nt/(1000*st.BLKSIZE),Gt;Gt=this.ATHformula(lt*1000,m)-20,Gt=Math.pow(10,0.1*Gt),Gt*=w.numlines_l[Y],kt>Gt&&(kt=Gt)}w.ATH.cb_l[Y]=kt,kt=-20+tt[Y]*20/10,kt>6&&(kt=100),kt<-15&&(kt=-15),kt-=8,w.minval_l[Y]=Math.pow(10,kt/10)*w.numlines_l[Y]}for(w.npart_s=mt(w.numlines_s,w.bo_s,w.bm_s,tt,rt,w.mld_s,w.PSY.bo_s_weight,Qt,st.BLKSIZE_s,w.scalefac_band.s,st.BLKSIZE_s/384,st.SBMAX_s),Lt(w.npart_s<st.CBANDS),nt=0,Y=0;Y<w.npart_s;Y++){var kt,$t=N;tt[Y]>=E&&($t=et*(tt[Y]-E)/(J-E)+N*(J-tt[Y])/(J-E)),gt[Y]=Math.pow(10,$t/10),kt=Zo.MAX_VALUE;for(var Ut=0;Ut<w.numlines_s[Y];Ut++,nt++){var lt=Qt*nt/(1000*st.BLKSIZE_s),Gt;Gt=this.ATHformula(lt*1000,m)-20,Gt=Math.pow(10,0.1*Gt),Gt*=w.numlines_s[Y],kt>Gt&&(kt=Gt)}w.ATH.cb_s[Y]=kt,kt=-7+tt[Y]*7/12,tt[Y]>12&&(kt*=1+Math.log(1+kt)*3.1),tt[Y]<12&&(kt*=1+Math.log(1-kt)*2.3),kt<-15&&(kt=-15),kt-=8,w.minval_s[Y]=Math.pow(10,kt/10)*w.numlines_s[Y]}w.s3_ss=vt(w.s3ind_s,w.npart_s,tt,rt,gt,X),F(),r.init_fft(w),w.decay=Math.exp(-1*d/(A*Qt/192));{var ct;ct=H,m.exp_nspsytune&2&&(ct=1),Math.abs(m.msfix)>0&&(ct=m.msfix),m.msfix=ct;for(var Ft=0;Ft<w.npart_l;Ft++)w.s3ind[Ft][1]>w.npart_l-1&&(w.s3ind[Ft][1]=w.npart_l-1)}var Tt=576*w.mode_gr/Qt;if(w.ATH.decay=Math.pow(10,-1.2*Tt),w.ATH.adjust=0.01,w.ATH.adjustLimit=1,Lt(w.bo_l[st.SBMAX_l-1]<=w.npart_l),Lt(w.bo_s[st.SBMAX_s-1]<=w.npart_s),m.ATHtype!=-1){var lt,wt=m.out_samplerate/st.BLKSIZE,Mt=0;for(lt=0,Y=0;Y<st.BLKSIZE/2;++Y)lt+=wt,w.ATH.eql_w[Y]=1/Math.pow(10,this.ATHformula(lt,m)/10),Mt+=w.ATH.eql_w[Y];for(Mt=1/Mt,Y=st.BLKSIZE/2;--Y>=0;)w.ATH.eql_w[Y]*=Mt}{for(var Ft=nt=0;Ft<w.npart_s;++Ft)for(Y=0;Y<w.numlines_s[Ft];++Y)++nt;for(var Ft=nt=0;Ft<w.npart_l;++Ft)for(Y=0;Y<w.numlines_l[Ft];++Y)++nt}for(nt=0,Y=0;Y<w.npart_l;Y++){var lt=Qt*(nt+w.numlines_l[Y]/2)/(1*st.BLKSIZE);w.mld_cb_l[Y]=ii(lt),nt+=w.numlines_l[Y]}for(;Y<st.CBANDS;++Y)w.mld_cb_l[Y]=1;for(nt=0,Y=0;Y<w.npart_s;Y++){var lt=Qt*(nt+w.numlines_s[Y]/2)/(1*st.BLKSIZE_s);w.mld_cb_s[Y]=ii(lt),nt+=w.numlines_s[Y]}for(;Y<st.CBANDS;++Y)w.mld_cb_s[Y]=1;return 0};function qt(m,w){m<-0.3&&(m=3410),m/=1000,m=Math.max(0.1,m);var Y=3.64*Math.pow(m,-0.8)-6.8*Math.exp(-0.6*Math.pow(m-3.4,2))+6*Math.exp(-0.15*Math.pow(m-8.7,2))+(0.6+0.04*w)*0.001*Math.pow(m,4);return Y}this.ATHformula=function(m,w){var Y;switch(w.ATHtype){case 0:Y=qt(m,9);break;case 1:Y=qt(m,-1);break;case 2:Y=qt(m,0);break;case 3:Y=qt(m,1)+6;break;case 4:Y=qt(m,w.ATHcurve);break;default:Y=qt(m,0);break}return Y}}var or=nr,er=cn;function rr(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=er.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var sr=rr,dr=ri(),re={};re.SFBMAX=dr.SBMAX_s*3;var Wn=re,se=Ht,hr=se.new_float,Ui=se.new_int,bn=Wn;function lr(){this.xr=hr(576),this.l3_enc=Ui(576),this.scalefac=Ui(bn.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Ui(3),this.subblock_gain=Ui(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Ui(bn.SFBMAX),this.window=Ui(bn.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Ui(4),this.max_nonzero_coeff=0;var t=this;function r(W){return new Int32Array(W)}function d(W){return new Float32Array(W)}this.assign=function(W){t.xr=d(W.xr),t.l3_enc=r(W.l3_enc),t.scalefac=r(W.scalefac),t.xrpow_max=W.xrpow_max,t.part2_3_length=W.part2_3_length,t.big_values=W.big_values,t.count1=W.count1,t.global_gain=W.global_gain,t.scalefac_compress=W.scalefac_compress,t.block_type=W.block_type,t.mixed_block_flag=W.mixed_block_flag,t.table_select=r(W.table_select),t.subblock_gain=r(W.subblock_gain),t.region0_count=W.region0_count,t.region1_count=W.region1_count,t.preflag=W.preflag,t.scalefac_scale=W.scalefac_scale,t.count1table_select=W.count1table_select,t.part2_length=W.part2_length,t.sfb_lmax=W.sfb_lmax,t.sfb_smin=W.sfb_smin,t.psy_lmax=W.psy_lmax,t.sfbmax=W.sfbmax,t.psymax=W.psymax,t.sfbdivide=W.sfbdivide,t.width=r(W.width),t.window=r(W.window),t.count1bits=W.count1bits,t.sfb_partition_table=W.sfb_partition_table.slice(0),t.slen=r(W.slen),t.max_nonzero_coeff=W.max_nonzero_coeff}}var _n=lr,cr=Ht,jo=cr.new_int,ar=_n;function pr(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[jo(4),jo(4)];for(var t=0;t<2;t++)for(var r=0;r<2;r++)this.tt[t][r]=new ar}var ur=pr,de=Ht,gn=de.System,mn=de.new_int,wn=ri();function gr(t,r,d,W){this.l=mn(1+wn.SBMAX_l),this.s=mn(1+wn.SBMAX_s),this.psfb21=mn(1+wn.PSFB21),this.psfb12=mn(1+wn.PSFB12);var O=this.l,j=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],gn.arraycopy(this.arrL,0,O,0,Math.min(this.arrL.length,this.l.length)),gn.arraycopy(this.arrS,0,j,0,Math.min(this.arrS.length,this.s.length)),gn.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),gn.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var he=gr,Bn=Ht,vn=Bn.new_float,mr=Bn.new_float_n,wr=Bn.new_int,$o=ri();function Cr(){this.last_en_subshort=mr([4,9]),this.lastAttacks=wr(4),this.pefirbuf=vn(19),this.longfact=vn($o.SBMAX_l),this.shortfact=vn($o.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var fr=Cr;function Pr(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var Wr=Pr,Hi=Ht,Dr=Hi.new_byte,kr=Hi.new_double,Ci=Hi.new_float,Oi=Hi.new_float_n,Wi=Hi.new_int,Cn=Hi.new_int_n,Jr=ur,Gr=he,Yr=fr,zr=Wr,Qo=oe(),_t=ri(),Zr=Wn;ji.MFSIZE=3456+_t.ENCDELAY-_t.MDCTDELAY;ji.MAX_HEADER_BUF=256;ji.MAX_BITS_PER_CHANNEL=4095;ji.MAX_BITS_PER_GRANULE=7680;ji.BPC=320;function ji(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Oi([2,ji.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Jr,this.ms_ratio=Ci(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Wi(2),this.CurrentStep=Wi(2),this.masking_lower=0,this.bv_scf=Wi(576),this.pseudohalf=Wi(Zr.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*ji.BPC+1),this.itime=kr(2),this.sideinfo_len=0,this.sb_sample=Oi([2,2,18,_t.SBLIMIT]),this.amp_filter=Ci(32);function r(){this.write_timing=0,this.ptr=0,this.buf=Dr(t)}this.header=new Array(ji.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new Gr,this.minval_l=Ci(_t.CBANDS),this.minval_s=Ci(_t.CBANDS),this.nb_1=Oi([4,_t.CBANDS]),this.nb_2=Oi([4,_t.CBANDS]),this.nb_s1=Oi([4,_t.CBANDS]),this.nb_s2=Oi([4,_t.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ci(4),this.loudness_sq=Oi([2,2]),this.loudness_sq_save=Ci(2),this.mld_l=Ci(_t.SBMAX_l),this.mld_s=Ci(_t.SBMAX_s),this.bm_l=Wi(_t.SBMAX_l),this.bo_l=Wi(_t.SBMAX_l),this.bm_s=Wi(_t.SBMAX_s),this.bo_s=Wi(_t.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Cn([_t.CBANDS,2]),this.s3ind_s=Cn([_t.CBANDS,2]),this.numlines_s=Wi(_t.CBANDS),this.numlines_l=Wi(_t.CBANDS),this.rnumlines_l=Ci(_t.CBANDS),this.mld_cb_l=Ci(_t.CBANDS),this.mld_cb_s=Ci(_t.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ci(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Wi(2),this.nsPsy=new Yr,this.VBR_seek_table=new zr,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Cn([16,5]),this.bitrate_blockType_Hist=Cn([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var d=0;d<this.en.length;d++)this.en[d]=new Qo;for(var d=0;d<this.thm.length;d++)this.thm[d]=new Qo;for(var d=0;d<this.header.length;d++)this.header[d]=new r}var Dn=ji,jr=Ht,qi=jr.new_float,xi=ri();function $r(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=qi(xi.SBMAX_l),this.s=qi(xi.SBMAX_s),this.psfb21=qi(xi.PSFB21),this.psfb12=qi(xi.PSFB12),this.cb_l=qi(xi.CBANDS),this.cb_s=qi(xi.CBANDS),this.eql_w=qi(xi.BLKSIZE/2)}var Qr=$r,le=Ht,li=le.System,Fo=le.Arrays;Bt.STEPS_per_dB=100;Bt.MAX_dB=120;Bt.GAIN_NOT_ENOUGH_SAMPLES=-24601;Bt.GAIN_ANALYSIS_ERROR=0;Bt.GAIN_ANALYSIS_OK=1;Bt.INIT_GAIN_ANALYSIS_ERROR=0;Bt.INIT_GAIN_ANALYSIS_OK=1;Bt.YULE_ORDER=10;Bt.MAX_ORDER=Bt.YULE_ORDER;Bt.MAX_SAMP_FREQ=48000;Bt.RMS_WINDOW_TIME_NUMERATOR=1;Bt.RMS_WINDOW_TIME_DENOMINATOR=20;Bt.MAX_SAMPLES_PER_WINDOW=Bt.MAX_SAMP_FREQ*Bt.RMS_WINDOW_TIME_NUMERATOR/Bt.RMS_WINDOW_TIME_DENOMINATOR+1;function Bt(){var t=64.82,r=0.95,d=Bt.RMS_WINDOW_TIME_NUMERATOR,W=Bt.RMS_WINDOW_TIME_DENOMINATOR,O=[[0.038575994352,-3.84664617118067,-0.02160367184185,7.81501653005538,-0.00123395316851,-11.34170355132042,-0.00009291677959,13.05504219327545,-0.01655260341619,-12.28759895145294,0.02161526843274,9.4829380631979,-0.02074045215285,-5.87257861775999,0.00594298065125,2.75465861874613,0.00306428023191,-0.86984376593551,0.00012025322027,0.13919314567432,0.00288463683916],[0.0541865640643,-3.47845948550071,-0.02911007808948,6.36317777566148,-0.00848709379851,-8.54751527471874,-0.00851165645469,9.4769360780128,-0.00834990904936,-8.81498681370155,0.02245293253339,6.85401540936998,-0.02596338512915,-4.39470996079559,0.01624864962975,2.19611684890774,-0.00240879051584,-0.75104302451432,0.00674613682247,0.13149317958808,-0.00187763777362],[0.15457299681924,-2.37898834973084,-0.09331049056315,2.84868151156327,-0.06247880153653,-2.64577170229825,0.02163541888798,2.23697657451713,-0.05588393329856,-1.67148153367602,0.04781476674921,1.00595954808547,0.00222312597743,-0.45953458054983,0.03174092540049,0.16378164858596,-0.01390589421898,-0.05032077717131,0.00651420667831,0.0234789740702,-0.00881362733839],[0.30296907319327,-1.61273165137247,-0.22613988682123,1.0797749225997,-0.08587323730772,-0.2565625775407,0.03282930172664,-0.1627671912044,-0.00915702933434,-0.22638893773906,-0.02364141202522,0.39120800788284,-0.00584456039913,-0.22138138954925,0.06276101321749,0.04500235387352,-0.00000828086748,0.02005851806501,0.00205861885564,0.00302439095741,-0.02950134983287],[0.33642304856132,-1.49858979367799,-0.2557224142557,0.87350271418188,-0.11828570177555,0.12205022308084,0.11921148675203,-0.80774944671438,-0.07834489609479,0.47854794562326,-0.0046997791438,-0.12453458140019,-0.0058950022444,-0.04067510197014,0.05724228140351,0.08333755284107,0.00832043980773,-0.04237348025746,-0.0163538138454,0.02977207319925,-0.0176017656815],[0.4491525660845,-0.62820619233671,-0.14351757464547,0.29661783706366,-0.22784394429749,-0.372563729424,-0.01419140100551,0.00213767857124,0.04078262797139,-0.42029820170918,-0.12398163381748,0.22199650564824,0.04097565135648,0.00613424350682,0.10478503600251,0.06747620744683,-0.01863887810927,0.05784820375801,-0.03193428438915,0.03222754072173,0.00541907748707],[0.56619470757641,-1.04800335126349,-0.75464456939302,0.29156311971249,0.1624213774223,-0.26806001042947,0.16744243493672,0.00819999645858,-0.18901604199609,0.45054734505008,0.3093178284183,-0.33032403314006,-0.27562961986224,0.0673936833311,0.00647310677246,-0.04784254229033,0.08647503780351,0.01639907836189,-0.0378898455484,0.01807364323573,-0.00588215443421],[0.58100494960553,-0.51035327095184,-0.53174909058578,-0.31863563325245,-0.14289799034253,-0.20256413484477,0.17520704835522,0.1472815413433,0.02377945217615,0.38952639978999,0.15558449135573,-0.23313271880868,-0.25344790059353,-0.05246019024463,0.01628462406333,-0.02505961724053,0.06920467763959,0.02442357316099,-0.03721611395801,0.01818801111503,-0.00749618797172],[0.53648789255105,-0.2504987195602,-0.42163034350696,-0.43193942311114,-0.00275953611929,-0.03424681017675,0.04267842219415,-0.04678328784242,-0.10214864179676,0.26408300200955,0.14590772289388,0.15113130533216,-0.02459864859345,-0.17556493366449,-0.11202315195388,-0.18823009262115,-0.04060034127,0.05477720428674,0.0478866554818,0.0470440968812,-0.02217936801134]],j=[[0.98621192462708,-1.97223372919527,-1.97242384925416,0.97261396931306,0.98621192462708],[0.98500175787242,-1.96977855582618,-1.97000351574484,0.9702284756635,0.98500175787242],[0.97938932735214,-1.95835380975398,-1.95877865470428,0.95920349965459,0.97938932735214],[0.97531843204928,-1.95002759149878,-1.95063686409857,0.95124613669835,0.97531843204928],[0.97316523498161,-1.94561023566527,-1.94633046996323,0.94705070426118,0.97316523498161],[0.96454515552826,-1.92783286977036,-1.92909031105652,0.93034775234268,0.96454515552826],[0.96009142950541,-1.91858953033784,-1.92018285901082,0.92177618768381,0.96009142950541],[0.95856916599601,-1.9154210807478,-1.91713833199203,0.91885558323625,0.95856916599601],[0.94597685600279,-1.88903307939452,-1.89195371200558,0.89487434461664,0.94597685600279]];function L(h,Q,H,v,B,S){for(;B--!=0;)H[v]=0.0000000001+h[Q+0]*S[0]-H[v-1]*S[1]+h[Q-1]*S[2]-H[v-2]*S[3]+h[Q-2]*S[4]-H[v-3]*S[5]+h[Q-3]*S[6]-H[v-4]*S[7]+h[Q-4]*S[8]-H[v-5]*S[9]+h[Q-5]*S[10]-H[v-6]*S[11]+h[Q-6]*S[12]-H[v-7]*S[13]+h[Q-7]*S[14]-H[v-8]*S[15]+h[Q-8]*S[16]-H[v-9]*S[17]+h[Q-9]*S[18]-H[v-10]*S[19]+h[Q-10]*S[20],++v,++Q}function Z(h,Q,H,v,B,S){for(;B--!=0;)H[v]=h[Q+0]*S[0]-H[v-1]*S[1]+h[Q-1]*S[2]-H[v-2]*S[3]+h[Q-2]*S[4],++v,++Q}function x(h,Q){for(var H=0;H<MAX_ORDER;H++)h.linprebuf[H]=h.lstepbuf[H]=h.loutbuf[H]=h.rinprebuf[H]=h.rstepbuf[H]=h.routbuf[H]=0;switch(0|Q){case 48000:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32000:h.reqindex=2;break;case 24000:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16000:h.reqindex=5;break;case 12000:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8000:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|(Q*d+W-1)/W,h.lsum=0,h.rsum=0,h.totsamp=0,Fo.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,Q){return x(h,Q)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,Fo.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function A(h){return h*h}this.AnalyzeSamples=function(h,Q,H,v,B,S,D){var g,C,P,i,a,z,U;if(S==0)return GAIN_ANALYSIS_OK;switch(U=0,a=S,D){case 1:v=Q,B=H;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(S<MAX_ORDER?(li.arraycopy(Q,H,h.linprebuf,MAX_ORDER,S),li.arraycopy(v,B,h.rinprebuf,MAX_ORDER,S)):(li.arraycopy(Q,H,h.linprebuf,MAX_ORDER,MAX_ORDER),li.arraycopy(v,B,h.rinprebuf,MAX_ORDER,MAX_ORDER));a>0;){z=a>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:a,U<MAX_ORDER?(g=h.linpre+U,C=h.linprebuf,P=h.rinpre+U,i=h.rinprebuf,z>MAX_ORDER-U&&(z=MAX_ORDER-U)):(g=H+U,C=Q,P=B+U,i=v),L(C,g,h.lstepbuf,h.lstep+h.totsamp,z,O[h.reqindex]),L(i,P,h.rstepbuf,h.rstep+h.totsamp,z,O[h.reqindex]),Z(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,z,j[h.reqindex]),Z(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,z,j[h.reqindex]),g=h.lout+h.totsamp,C=h.loutbuf,P=h.rout+h.totsamp,i=h.routbuf;for(var b=z%8;b--!=0;)h.lsum+=A(C[g++]),h.rsum+=A(i[P++]);for(b=z/8;b--!=0;)h.lsum+=A(C[g+0])+A(C[g+1])+A(C[g+2])+A(C[g+3])+A(C[g+4])+A(C[g+5])+A(C[g+6])+A(C[g+7]),g+=8,h.rsum+=A(i[P+0])+A(i[P+1])+A(i[P+2])+A(i[P+3])+A(i[P+4])+A(i[P+5])+A(i[P+6])+A(i[P+7]),P+=8;if(a-=z,U+=z,h.totsamp+=z,h.totsamp==h.sampleWindow){var F=Bt.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*0.5+0.0000000000000000000000000000000000001),M=F<=0?0:0|F;M>=h.A.length&&(M=h.A.length-1),h.A[M]++,h.lsum=h.rsum=0,li.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),li.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),li.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),li.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return S<MAX_ORDER?(li.arraycopy(h.linprebuf,S,h.linprebuf,0,MAX_ORDER-S),li.arraycopy(h.rinprebuf,S,h.rinprebuf,0,MAX_ORDER-S),li.arraycopy(Q,H,h.linprebuf,MAX_ORDER-S,S),li.arraycopy(v,B,h.rinprebuf,MAX_ORDER-S,S)):(li.arraycopy(Q,H+S-MAX_ORDER,h.linprebuf,0,MAX_ORDER),li.arraycopy(v,B+S-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function u(h,Q){var H,v=0;for(H=0;H<Q;H++)v+=h[H];if(v==0)return GAIN_NOT_ENOUGH_SAMPLES;var B=0|Math.ceil(v*(1-r));for(H=Q;H-- >0&&!((B-=h[H])<=0););return t-H/Bt.STEPS_per_dB}this.GetTitleGain=function(h){for(var Q=u(h.A,h.A.length),H=0;H<h.A.length;H++)h.B[H]+=h.A[H],h.A[H]=0;for(var H=0;H<MAX_ORDER;H++)h.linprebuf[H]=h.lstepbuf[H]=h.loutbuf[H]=h.rinprebuf[H]=h.rstepbuf[H]=h.routbuf[H]=0;return h.totsamp=0,h.lsum=h.rsum=0,Q}}var ce=Bt,ae=Ht,Si=ae.new_float,yo=ae.new_int,ci=ce;function Fr(){this.linprebuf=Si(ci.MAX_ORDER*2),this.linpre=0,this.lstepbuf=Si(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.lstep=0,this.loutbuf=Si(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.lout=0,this.rinprebuf=Si(ci.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=Si(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.rstep=0,this.routbuf=Si(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=yo(0|ci.STEPS_per_dB*ci.MAX_dB),this.B=yo(0|ci.STEPS_per_dB*ci.MAX_dB)}var yr=Fr;function Xr(t){this.bits=t}var pe=Xr,Rn=Ht,Xo=Rn.new_float,Mr=Rn.new_int,Mo=Rn.assert,Lr=pe,Lo=ri(),Kr=Wn,Ur=Dn;function Or(t){var r=t;this.quantize=r,this.iteration_loop=function(d,W,O,j){var L=d.internal_flags,Z=Xo(Kr.SFBMAX),x=Xo(576),A=Mr(2),u=0,h,Q=L.l3_side,H=new Lr(u);this.quantize.rv.ResvFrameBegin(d,H),u=H.bits;for(var v=0;v<L.mode_gr;v++){h=this.quantize.qupvt.on_pe(d,W,A,u,v,v),L.mode_ext==Lo.MPG_MD_MS_LR&&(this.quantize.ms_convert(L.l3_side,v),this.quantize.qupvt.reduce_side(A,O[v],u,h));for(var B=0;B<L.channels_out;B++){var S,D,g=Q.tt[v][B];g.block_type!=Lo.SHORT_TYPE?(S=0,D=L.PSY.mask_adjust-S):(S=0,D=L.PSY.mask_adjust_short-S),L.masking_lower=Math.pow(10,D*0.1),this.quantize.init_outer_loop(L,g),this.quantize.init_xrpow(L,g,x)&&(this.quantize.qupvt.calc_xmin(d,j[v][B],g,Z),this.quantize.outer_loop(d,g,Z,x,B,A[B])),this.quantize.iteration_finish_one(L,v,B),Mo(g.part2_3_length<=Ur.MAX_BITS_PER_CHANNEL),Mo(g.part2_3_length<=A[B])}}this.quantize.rv.ResvFrameEnd(L,u)}}var qr=Or;function xt(t,r,d,W){this.xlen=t,this.linmax=r,this.table=d,this.hlen=W}var pt={};pt.t1HB=[1,1,1,0];pt.t2HB=[1,2,1,3,1,1,3,2,0];pt.t3HB=[3,2,1,1,1,1,3,2,0];pt.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];pt.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];pt.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];pt.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];pt.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];pt.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];pt.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];pt.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];pt.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];pt.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];pt.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];pt.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];pt.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];pt.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];pt.t1l=[1,4,3,5];pt.t2l=[1,4,7,4,5,7,6,7,8];pt.t3l=[2,3,7,4,4,7,6,7,8];pt.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];pt.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];pt.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];pt.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];pt.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];pt.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];pt.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];pt.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];pt.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];pt.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];pt.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];pt.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];pt.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];pt.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];pt.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];pt.ht=[new xt(0,0,null,null),new xt(2,0,pt.t1HB,pt.t1l),new xt(3,0,pt.t2HB,pt.t2l),new xt(3,0,pt.t3HB,pt.t3l),new xt(0,0,null,null),new xt(4,0,pt.t5HB,pt.t5l),new xt(4,0,pt.t6HB,pt.t6l),new xt(6,0,pt.t7HB,pt.t7l),new xt(6,0,pt.t8HB,pt.t8l),new xt(6,0,pt.t9HB,pt.t9l),new xt(8,0,pt.t10HB,pt.t10l),new xt(8,0,pt.t11HB,pt.t11l),new xt(8,0,pt.t12HB,pt.t12l),new xt(16,0,pt.t13HB,pt.t13l),new xt(0,0,null,pt.t16_5l),new xt(16,0,pt.t15HB,pt.t15l),new xt(1,1,pt.t16HB,pt.t16l),new xt(2,3,pt.t16HB,pt.t16l),new xt(3,7,pt.t16HB,pt.t16l),new xt(4,15,pt.t16HB,pt.t16l),new xt(6,63,pt.t16HB,pt.t16l),new xt(8,255,pt.t16HB,pt.t16l),new xt(10,1023,pt.t16HB,pt.t16l),new xt(13,8191,pt.t16HB,pt.t16l),new xt(4,15,pt.t24HB,pt.t24l),new xt(5,31,pt.t24HB,pt.t24l),new xt(6,63,pt.t24HB,pt.t24l),new xt(7,127,pt.t24HB,pt.t24l),new xt(8,255,pt.t24HB,pt.t24l),new xt(9,511,pt.t24HB,pt.t24l),new xt(11,2047,pt.t24HB,pt.t24l),new xt(13,8191,pt.t24HB,pt.t24l),new xt(0,0,pt.t32HB,pt.t32l),new xt(0,0,pt.t33HB,pt.t33l)];pt.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];pt.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];pt.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];pt.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];pt.samplerate_table=[[22050,24000,16000,-1],[44100,48000,32000,-1],[11025,12000,8000,-1]];pt.scfsi_band=[0,6,11,16,21];var An=pt,Vn,Ko;function ue(){if(Ko)return Vn;Ko=1;var t=he,r=Ht,d=r.VbrMode,W=r.Float,O=r.Util,j=r.new_float,L=r.new_int,Z=r.assert,x=ri(),A=pe,u=Dn;h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206;function h(){var Q=to(),H=null,v=null,B=null;this.setModules=function(G,K,V){H=G,v=K,B=V};function S(G){return Z(0<=G+h.Q_MAX2&&G<h.Q_MAX),U[G+h.Q_MAX2]}this.IPOW20=function(G){return Z(0<=G&&G<h.Q_MAX),b[G]};var D=0.0000000000000002220446049250313,g=h.IXMAX_VAL,C=g+2,P=h.Q_MAX,i=h.Q_MAX2;h.LARGE_BITS;var a=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var z=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=z,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var U=j(P+i+1),b=j(P),F=j(C),M=j(C);this.adj43=M;function at(G,K){var V=B.ATHformula(K,G);return V-=a,V=Math.pow(10,V/10+G.ATHlower),V}function k(G){for(var K=G.internal_flags.ATH.l,V=G.internal_flags.ATH.psfb21,q=G.internal_flags.ATH.s,it=G.internal_flags.ATH.psfb12,$=G.internal_flags,l=G.out_samplerate,s=0;s<x.SBMAX_l;s++){var o=$.scalefac_band.l[s],c=$.scalefac_band.l[s+1];K[s]=W.MAX_VALUE;for(var f=o;f<c;f++){var I=f*l/1152,ot=at(G,I);K[s]=Math.min(K[s],ot)}}for(var s=0;s<x.PSFB21;s++){var o=$.scalefac_band.psfb21[s],c=$.scalefac_band.psfb21[s+1];V[s]=W.MAX_VALUE;for(var f=o;f<c;f++){var I=f*l/1152,ot=at(G,I);V[s]=Math.min(V[s],ot)}}for(var s=0;s<x.SBMAX_s;s++){var o=$.scalefac_band.s[s],c=$.scalefac_band.s[s+1];q[s]=W.MAX_VALUE;for(var f=o;f<c;f++){var I=f*l/384,ot=at(G,I);q[s]=Math.min(q[s],ot)}q[s]*=$.scalefac_band.s[s+1]-$.scalefac_band.s[s]}for(var s=0;s<x.PSFB12;s++){var o=$.scalefac_band.psfb12[s],c=$.scalefac_band.psfb12[s+1];it[s]=W.MAX_VALUE;for(var f=o;f<c;f++){var I=f*l/384,ot=at(G,I);it[s]=Math.min(it[s],ot)}it[s]*=$.scalefac_band.s[13]-$.scalefac_band.s[12]}if(G.noATH){for(var s=0;s<x.SBMAX_l;s++)K[s]=0.00000000000000000001;for(var s=0;s<x.PSFB21;s++)V[s]=0.00000000000000000001;for(var s=0;s<x.SBMAX_s;s++)q[s]=0.00000000000000000001;for(var s=0;s<x.PSFB12;s++)it[s]=0.00000000000000000001}$.ATH.floor=10*Math.log10(at(G,-1))}this.iteration_init=function(G){var K=G.internal_flags,V=K.l3_side,q;if(K.iteration_init_init==0){for(K.iteration_init_init=1,V.main_data_begin=0,k(G),F[0]=0,q=1;q<C;q++)F[q]=Math.pow(q,1.3333333333333333);for(q=0;q<C-1;q++)M[q]=q+1-Math.pow(0.5*(F[q]+F[q+1]),0.75);for(M[q]=0.5,q=0;q<P;q++)b[q]=Math.pow(2,(q-210)*-0.1875);for(q=0;q<=P+i;q++)U[q]=Math.pow(2,(q-210-i)*0.25);H.huffman_init(K);{var it,$,l,s;for(q=G.exp_nspsytune>>2&63,q>=32&&(q-=64),it=Math.pow(10,q/4/10),q=G.exp_nspsytune>>8&63,q>=32&&(q-=64),$=Math.pow(10,q/4/10),q=G.exp_nspsytune>>14&63,q>=32&&(q-=64),l=Math.pow(10,q/4/10),q=G.exp_nspsytune>>20&63,q>=32&&(q-=64),s=l*Math.pow(10,q/4/10),q=0;q<x.SBMAX_l;q++){var o;q<=6?o=it:q<=13?o=$:q<=20?o=l:o=s,K.nsPsy.longfact[q]=o}for(q=0;q<x.SBMAX_s;q++){var o;q<=5?o=it:q<=10?o=$:q<=11?o=l:o=s,K.nsPsy.shortfact[q]=o}}}},this.on_pe=function(G,K,V,q,it,$){var l=G.internal_flags,s=0,o,c=L(2),f,I=new A(s),ot=v.ResvMaxBits(G,q,I,$);s=I.bits;var y=s+ot;for(y>u.MAX_BITS_PER_GRANULE&&(y=u.MAX_BITS_PER_GRANULE),o=0,f=0;f<l.channels_out;++f)V[f]=Math.min(u.MAX_BITS_PER_CHANNEL,s/l.channels_out),c[f]=0|V[f]*K[it][f]/700-V[f],c[f]>q*3/4&&(c[f]=q*3/4),c[f]<0&&(c[f]=0),c[f]+V[f]>u.MAX_BITS_PER_CHANNEL&&(c[f]=Math.max(0,u.MAX_BITS_PER_CHANNEL-V[f])),o+=c[f];if(o>ot)for(f=0;f<l.channels_out;++f)c[f]=ot*c[f]/o;for(f=0;f<l.channels_out;++f)V[f]+=c[f],ot-=c[f];for(o=0,f=0;f<l.channels_out;++f)o+=V[f];if(o>u.MAX_BITS_PER_GRANULE){var _=0;for(f=0;f<l.channels_out;++f)V[f]*=u.MAX_BITS_PER_GRANULE,V[f]/=o,_+=V[f]}return y},this.reduce_side=function(G,K,V,q){Z(G[0]+G[1]<=u.MAX_BITS_PER_GRANULE);var it=0.33*(0.5-K)/0.5;it<0&&(it=0),it>0.5&&(it=0.5);var $=0|it*0.5*(G[0]+G[1]);$>u.MAX_BITS_PER_CHANNEL-G[0]&&($=u.MAX_BITS_PER_CHANNEL-G[0]),$<0&&($=0),G[1]>=125&&(G[1]-$>125?(G[0]<V&&(G[0]+=$),G[1]-=$):(G[0]+=G[1]-125,G[1]=125)),$=G[0]+G[1],$>q&&(G[0]=q*G[0]/$,G[1]=q*G[1]/$),Z(G[0]<=u.MAX_BITS_PER_CHANNEL),Z(G[1]<=u.MAX_BITS_PER_CHANNEL),Z(G[0]+G[1]<=u.MAX_BITS_PER_GRANULE)},this.athAdjust=function(G,K,V){var q=90.30873362,it=94.82444863,$=O.FAST_LOG10_X(K,10),l=G*G,s=0;return $-=V,l>0.00000000000000000001&&(s=1+O.FAST_LOG10_X(l,10/q)),s<0&&(s=0),$*=s,$+=V+q-it,Math.pow(10,0.1*$)},this.calc_xmin=function(G,K,V,q){var it=0,$=G.internal_flags,l,s=0,o=0,c=$.ATH,f=V.xr,I=G.VBR==d.vbr_mtrh?1:0,ot=$.masking_lower;for((G.VBR==d.vbr_mtrh||G.VBR==d.vbr_mt)&&(ot=1),l=0;l<V.psy_lmax;l++){var y,_,dt,ut,ft,Dt;G.VBR==d.vbr_rh||G.VBR==d.vbr_mtrh?_=athAdjust(c.adjust,c.l[l],c.floor):_=c.adjust*c.l[l],ft=V.width[l],dt=_/ft,ut=D,Dt=ft>>1,y=0;do{var Wt,Pt;Wt=f[s]*f[s],y+=Wt,ut+=Wt<dt?Wt:dt,s++,Pt=f[s]*f[s],y+=Pt,ut+=Pt<dt?Pt:dt,s++}while(--Dt>0);if(y>_&&o++,l==x.SBPSY_l){var Zt=_*$.nsPsy.longfact[l];ut<Zt&&(ut=Zt)}if(I!=0&&(_=ut),!G.ATHonly){var Vt=K.en.l[l];if(Vt>0){var Zt;Zt=y*K.thm.l[l]*ot/Vt,I!=0&&(Zt*=$.nsPsy.longfact[l]),_<Zt&&(_=Zt)}}I!=0?q[it++]=_:q[it++]=_*$.nsPsy.longfact[l]}var mi=575;if(V.block_type!=x.SHORT_TYPE)for(var e=576;e--!=0&&Q.EQ(f[e],0);)mi=e;V.max_nonzero_coeff=mi;for(var p=V.sfb_smin;l<V.psymax;p++,l+=3){var ft,Ct,Jt;for(G.VBR==d.vbr_rh||G.VBR==d.vbr_mtrh?Jt=athAdjust(c.adjust,c.s[p],c.floor):Jt=c.adjust*c.s[p],ft=V.width[l],Ct=0;Ct<3;Ct++){var y=0,_,dt,ut,Dt=ft>>1;dt=Jt/ft,ut=D;do{var Wt,Pt;Wt=f[s]*f[s],y+=Wt,ut+=Wt<dt?Wt:dt,s++,Pt=f[s]*f[s],y+=Pt,ut+=Pt<dt?Pt:dt,s++}while(--Dt>0);if(y>Jt&&o++,p==x.SBPSY_s){var Zt=Jt*$.nsPsy.shortfact[p];ut<Zt&&(ut=Zt)}if(I!=0?_=ut:_=Jt,!G.ATHonly&&!G.ATHshort){var Vt=K.en.s[p][Ct];if(Vt>0){var Zt;Zt=y*K.thm.s[p][Ct]*ot/Vt,I!=0&&(Zt*=$.nsPsy.shortfact[p]),_<Zt&&(_=Zt)}}I!=0?q[it++]=_:q[it++]=_*$.nsPsy.shortfact[p]}G.useTemporal&&(q[it-3]>q[it-3+1]&&(q[it-3+1]+=(q[it-3]-q[it-3+1])*$.decay),q[it-3+1]>q[it-3+2]&&(q[it-3+2]+=(q[it-3+1]-q[it-3+2])*$.decay))}return o};function n(G){this.s=G}this.calc_noise_core=function(G,K,V,q){var it=0,$=K.s,l=G.l3_enc;if($>G.count1)for(;V--!=0;){var s;s=G.xr[$],$++,it+=s*s,s=G.xr[$],$++,it+=s*s}else if($>G.big_values){var o=j(2);for(o[0]=0,o[1]=q;V--!=0;){var s;s=Math.abs(G.xr[$])-o[l[$]],$++,it+=s*s,s=Math.abs(G.xr[$])-o[l[$]],$++,it+=s*s}}else for(;V--!=0;){var s;s=Math.abs(G.xr[$])-F[l[$]]*q,$++,it+=s*s,s=Math.abs(G.xr[$])-F[l[$]]*q,$++,it+=s*s}return K.s=$,it},this.calc_noise=function(G,K,V,q,it){var $=0,l=0,s,o,c=0,f=0,I=0,ot=-20,y=0,_=G.scalefac,dt=0;for(q.over_SSD=0,s=0;s<G.psymax;s++){var ut=G.global_gain-(_[dt++]+(G.preflag!=0?z[s]:0)<<G.scalefac_scale+1)-G.subblock_gain[G.window[s]]*8,ft=0;if(it!=null&&it.step[s]==ut)ft=it.noise[s],y+=G.width[s],V[$++]=ft/K[l++],ft=it.noise_log[s];else{var Dt=S(ut);if(o=G.width[s]>>1,y+G.width[s]>G.max_nonzero_coeff){var Wt;Wt=G.max_nonzero_coeff-y+1,Wt>0?o=Wt>>1:o=0}var Pt=new n(y);ft=this.calc_noise_core(G,Pt,o,Dt),y=Pt.s,it!=null&&(it.step[s]=ut,it.noise[s]=ft),ft=V[$++]=ft/K[l++],ft=O.FAST_LOG10(Math.max(ft,0.00000000000000000001)),it!=null&&(it.noise_log[s]=ft)}if(it!=null&&(it.global_gain=G.global_gain),I+=ft,ft>0){var Zt;Zt=Math.max(0|ft*10+0.5,1),q.over_SSD+=Zt*Zt,c++,f+=ft}ot=Math.max(ot,ft)}return q.over_count=c,q.tot_noise=I,q.over_noise=f,q.max_noise=ot,c},this.set_pinfo=function(G,K,V,q,it){var $=G.internal_flags,l,s,o,c,f,I=K.scalefac_scale==0?0.5:1,ot=K.scalefac,y=j(L3Side.SFBMAX),_=j(L3Side.SFBMAX),dt=new CalcNoiseResult;calc_xmin(G,V,K,y),calc_noise(K,y,_,dt,null);var ut=0;for(s=K.sfb_lmax,K.block_type!=x.SHORT_TYPE&&K.mixed_block_flag==0&&(s=22),l=0;l<s;l++){var ft=$.scalefac_band.l[l],Dt=$.scalefac_band.l[l+1],Wt=Dt-ft;for(c=0;ut<Dt;ut++)c+=K.xr[ut]*K.xr[ut];c/=Wt,f=1000000000000000,$.pinfo.en[q][it][l]=f*c,$.pinfo.xfsf[q][it][l]=f*y[l]*_[l]/Wt,V.en.l[l]>0&&!G.ATHonly?c=c/V.en.l[l]:c=0,$.pinfo.thr[q][it][l]=f*Math.max(c*V.thm.l[l],$.ATH.l[l]),$.pinfo.LAMEsfb[q][it][l]=0,K.preflag!=0&&l>=11&&($.pinfo.LAMEsfb[q][it][l]=-I*z[l]),l<x.SBPSY_l&&(Z(ot[l]>=0),$.pinfo.LAMEsfb[q][it][l]-=I*ot[l])}if(K.block_type==x.SHORT_TYPE)for(s=l,l=K.sfb_smin;l<x.SBMAX_s;l++)for(var ft=$.scalefac_band.s[l],Dt=$.scalefac_band.s[l+1],Wt=Dt-ft,Pt=0;Pt<3;Pt++){for(c=0,o=ft;o<Dt;o++)c+=K.xr[ut]*K.xr[ut],ut++;c=Math.max(c/Wt,0.00000000000000000001),f=1000000000000000,$.pinfo.en_s[q][it][3*l+Pt]=f*c,$.pinfo.xfsf_s[q][it][3*l+Pt]=f*y[s]*_[s]/Wt,V.en.s[l][Pt]>0?c=c/V.en.s[l][Pt]:c=0,(G.ATHonly||G.ATHshort)&&(c=0),$.pinfo.thr_s[q][it][3*l+Pt]=f*Math.max(c*V.thm.s[l][Pt],$.ATH.s[l]),$.pinfo.LAMEsfb_s[q][it][3*l+Pt]=-2*K.subblock_gain[Pt],l<x.SBPSY_s&&($.pinfo.LAMEsfb_s[q][it][3*l+Pt]-=I*ot[s]),s++}$.pinfo.LAMEqss[q][it]=K.global_gain,$.pinfo.LAMEmainbits[q][it]=K.part2_3_length+K.part2_length,$.pinfo.LAMEsfbits[q][it]=K.part2_length,$.pinfo.over[q][it]=dt.over_count,$.pinfo.max_noise[q][it]=dt.max_noise*10,$.pinfo.over_noise[q][it]=dt.over_noise*10,$.pinfo.tot_noise[q][it]=dt.tot_noise*10,$.pinfo.over_SSD[q][it]=dt.over_SSD}}return Vn=h,Vn}var Tn,Uo;function ge(){if(Uo)return Tn;Uo=1;var t=Ht,r=t.System,d=t.Arrays,W=t.new_int,O=t.assert,j=ri(),L=An,Z=_n,x=ue();function A(){var u=null;this.qupvt=null,this.setModules=function($){this.qupvt=$,u=$};function h($){this.bits=0|$}var Q=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function H($,l,s,o,c,f){var I=0.5946/l;for($=$>>1;$--!=0;)c[f++]=I>s[o++]?0:1,c[f++]=I>s[o++]?0:1}function v($,l,s,o,c,f){$=$>>1;var I=$%2;for($=$>>1;$--!=0;){var ot,y,_,dt,ut,ft,Dt,Wt;ot=s[o++]*l,y=s[o++]*l,ut=0|ot,_=s[o++]*l,ft=0|y,dt=s[o++]*l,Dt=0|_,ot+=u.adj43[ut],Wt=0|dt,y+=u.adj43[ft],c[f++]=0|ot,_+=u.adj43[Dt],c[f++]=0|y,dt+=u.adj43[Wt],c[f++]=0|_,c[f++]=0|dt}if(I!=0){var ot,y,ut,ft;ot=s[o++]*l,y=s[o++]*l,ut=0|ot,ft=0|y,ot+=u.adj43[ut],y+=u.adj43[ft],c[f++]=0|ot,c[f++]=0|y}}function B($,l,s,o,c){var f,I,ot=0,y,_=0,dt=0,ut=0,ft=l,Dt=0,Wt=ft,Pt=0,Zt=$,Vt=0;for(y=c!=null&&o.global_gain==c.global_gain,o.block_type==j.SHORT_TYPE?I=38:I=21,f=0;f<=I;f++){var mi=-1;if((y||o.block_type==j.NORM_TYPE)&&(mi=o.global_gain-(o.scalefac[f]+(o.preflag!=0?u.pretab[f]:0)<<o.scalefac_scale+1)-o.subblock_gain[o.window[f]]*8),O(o.width[f]>=0),y&&c.step[f]==mi)_!=0&&(v(_,s,Zt,Vt,Wt,Pt),_=0),dt!=0&&(H(dt,s,Zt,Vt,Wt,Pt),dt=0);else{var e=o.width[f];if(ot+o.width[f]>o.max_nonzero_coeff){var p;p=o.max_nonzero_coeff-ot+1,d.fill(l,o.max_nonzero_coeff,576,0),e=p,e<0&&(e=0),f=I+1}if(_==0&&dt==0&&(Wt=ft,Pt=Dt,Zt=$,Vt=ut),c!=null&&c.sfb_count1>0&&f>=c.sfb_count1&&c.step[f]>0&&mi>=c.step[f]?(_!=0&&(v(_,s,Zt,Vt,Wt,Pt),_=0,Wt=ft,Pt=Dt,Zt=$,Vt=ut),dt+=e):(dt!=0&&(H(dt,s,Zt,Vt,Wt,Pt),dt=0,Wt=ft,Pt=Dt,Zt=$,Vt=ut),_+=e),e<=0){dt!=0&&(H(dt,s,Zt,Vt,Wt,Pt),dt=0),_!=0&&(v(_,s,Zt,Vt,Wt,Pt),_=0);break}}f<=I&&(Dt+=o.width[f],ut+=o.width[f],ot+=o.width[f])}_!=0&&(v(_,s,Zt,Vt,Wt,Pt),_=0),dt!=0&&(H(dt,s,Zt,Vt,Wt,Pt),dt=0)}function S($,l,s){var o=0,c=0;do{var f=$[l++],I=$[l++];o<f&&(o=f),c<I&&(c=I)}while(l<s);return o<c&&(o=c),o}function D($,l,s,o,c,f){var I=L.ht[o].xlen*65536+L.ht[c].xlen,ot=0,y;do{var _=$[l++],dt=$[l++];_!=0&&(_>14&&(_=15,ot+=I),_*=16),dt!=0&&(dt>14&&(dt=15,ot+=I),_+=dt),ot+=L.largetbl[_]}while(l<s);return y=ot&65535,ot>>=16,ot>y&&(ot=y,o=c),f.bits+=ot,o}function g($,l,s,o){var c=0,f=L.ht[1].hlen;do{var I=$[l+0]*2+$[l+1];l+=2,c+=f[I]}while(l<s);return o.bits+=c,1}function C($,l,s,o,c){var f=0,I,ot=L.ht[o].xlen,y;o==2?y=L.table23:y=L.table56;do{var _=$[l+0]*ot+$[l+1];l+=2,f+=y[_]}while(l<s);return I=f&65535,f>>=16,f>I&&(f=I,o++),c.bits+=f,o}function P($,l,s,o,c){var f=0,I=0,ot=0,y=L.ht[o].xlen,_=L.ht[o].hlen,dt=L.ht[o+1].hlen,ut=L.ht[o+2].hlen;do{var ft=$[l+0]*y+$[l+1];l+=2,f+=_[ft],I+=dt[ft],ot+=ut[ft]}while(l<s);var Dt=o;return f>I&&(f=I,Dt++),f>ot&&(f=ot,Dt=o+2),c.bits+=f,Dt}var i=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function a($,l,s,o){var c=S($,l,s);switch(c){case 0:return c;case 1:return g($,l,s,o);case 2:case 3:return C($,l,s,i[c-1],o);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return P($,l,s,i[c-1],o);default:if(c>x.IXMAX_VAL)return o.bits=x.LARGE_BITS,-1;c-=15;var f;for(f=24;f<32&&!(L.ht[f].linmax>=c);f++);var I;for(I=f-8;I<24&&!(L.ht[I].linmax>=c);I++);return D($,l,s,I,f,o)}}this.noquant_count_bits=function($,l,s){var o=l.l3_enc,c=Math.min(576,l.max_nonzero_coeff+2>>1<<1);for(s!=null&&(s.sfb_count1=0);c>1&&!(o[c-1]|o[c-2]);c-=2);l.count1=c;for(var f=0,I=0;c>3;c-=4){var ot;if(((o[c-1]|o[c-2]|o[c-3]|o[c-4])&2147483647)>1)break;ot=((o[c-4]*2+o[c-3])*2+o[c-2])*2+o[c-1],f+=L.t32l[ot],I+=L.t33l[ot]}var y=f;if(l.count1table_select=0,f>I&&(y=I,l.count1table_select=1),l.count1bits=y,l.big_values=c,c==0)return y;if(l.block_type==j.SHORT_TYPE)f=3*$.scalefac_band.s[3],f>l.big_values&&(f=l.big_values),I=l.big_values;else if(l.block_type==j.NORM_TYPE){if(f=l.region0_count=$.bv_scf[c-2],I=l.region1_count=$.bv_scf[c-1],O(f+I+2<j.SBPSY_l),I=$.scalefac_band.l[f+I+2],f=$.scalefac_band.l[f+1],I<c){var _=new h(y);l.table_select[2]=a(o,I,c,_),y=_.bits}}else l.region0_count=7,l.region1_count=j.SBMAX_l-1-7-1,f=$.scalefac_band.l[8],I=c,f>I&&(f=I);if(f=Math.min(f,c),I=Math.min(I,c),0<f){var _=new h(y);l.table_select[0]=a(o,0,f,_),y=_.bits}if(f<I){var _=new h(y);l.table_select[1]=a(o,f,I,_),y=_.bits}if($.use_best_huffman==2&&(l.part2_3_length=y,best_huffman_divide($,l),y=l.part2_3_length),s!=null&&l.block_type==j.NORM_TYPE){for(var dt=0;$.scalefac_band.l[dt]<l.big_values;)dt++;s.sfb_count1=dt}return y},this.count_bits=function($,l,s,o){var c=s.l3_enc,f=x.IXMAX_VAL/u.IPOW20(s.global_gain);if(s.xrpow_max>f)return x.LARGE_BITS;if(B(l,c,u.IPOW20(s.global_gain),s,o),$.substep_shaping&2)for(var I=0,ot=s.global_gain+s.scalefac_scale,y=0.634521682242439/u.IPOW20(ot),_=0;_<s.sfbmax;_++){var dt=s.width[_];if($.pseudohalf[_]==0)I+=dt;else{var ut;for(ut=I,I+=dt;ut<I;++ut)c[ut]=l[ut]>=y?c[ut]:0}}return this.noquant_count_bits($,s,o)};function z($,l,s,o,c,f,I){for(var ot=l.big_values,y=0;y<=22;y++)o[y]=x.LARGE_BITS;for(var y=0;y<16;y++){var _=$.scalefac_band.l[y+1];if(_>=ot)break;var dt=0,ut=new h(dt),ft=a(s,0,_,ut);dt=ut.bits;for(var Dt=0;Dt<8;Dt++){var Wt=$.scalefac_band.l[y+Dt+2];if(Wt>=ot)break;var Pt=dt;ut=new h(Pt);var Zt=a(s,_,Wt,ut);Pt=ut.bits,o[y+Dt]>Pt&&(o[y+Dt]=Pt,c[y+Dt]=y,f[y+Dt]=ft,I[y+Dt]=Zt)}}}function U($,l,s,o,c,f,I,ot){for(var y=l.big_values,_=2;_<j.SBMAX_l+1;_++){var dt=$.scalefac_band.l[_];if(dt>=y)break;var ut=c[_-2]+l.count1bits;if(s.part2_3_length<=ut)break;var ft=new h(ut),Dt=a(o,dt,y,ft);ut=ft.bits,!(s.part2_3_length<=ut)&&(s.assign(l),s.part2_3_length=ut,s.region0_count=f[_-2],s.region1_count=_-2-f[_-2],s.table_select[0]=I[_-2],s.table_select[1]=ot[_-2],s.table_select[2]=Dt)}}this.best_huffman_divide=function($,l){var s=new Z,o=l.l3_enc,c=W(23),f=W(23),I=W(23),ot=W(23);if(!(l.block_type==j.SHORT_TYPE&&$.mode_gr==1)){s.assign(l),l.block_type==j.NORM_TYPE&&(z($,l,o,c,f,I,ot),U($,s,l,o,c,f,I,ot));var y=s.big_values;if(!(y==0||(o[y-2]|o[y-1])>1)&&(y=l.count1+2,!(y>576))){s.assign(l),s.count1=y;for(var _=0,dt=0;y>s.big_values;y-=4){var ut=((o[y-4]*2+o[y-3])*2+o[y-2])*2+o[y-1];_+=L.t32l[ut],dt+=L.t33l[ut]}if(s.big_values=y,s.count1table_select=0,_>dt&&(_=dt,s.count1table_select=1),s.count1bits=_,s.block_type==j.NORM_TYPE)U($,s,l,o,c,f,I,ot);else{if(s.part2_3_length=_,_=$.scalefac_band.l[8],_>y&&(_=y),_>0){var ft=new h(s.part2_3_length);s.table_select[0]=a(o,0,_,ft),s.part2_3_length=ft.bits}if(y>_){var ft=new h(s.part2_3_length);s.table_select[1]=a(o,_,y,ft),s.part2_3_length=ft.bits}l.part2_3_length>s.part2_3_length&&l.assign(s)}}}};var b=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],F=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],M=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],at=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];A.slen1_tab=M,A.slen2_tab=at;function k($,l){for(var s,o=l.tt[1][$],c=l.tt[0][$],f=0;f<L.scfsi_band.length-1;f++){for(s=L.scfsi_band[f];s<L.scfsi_band[f+1]&&!(c.scalefac[s]!=o.scalefac[s]&&o.scalefac[s]>=0);s++);if(s==L.scfsi_band[f+1]){for(s=L.scfsi_band[f];s<L.scfsi_band[f+1];s++)o.scalefac[s]=-1;l.scfsi[$][f]=1}}var I=0,ot=0;for(s=0;s<11;s++)o.scalefac[s]!=-1&&(ot++,I<o.scalefac[s]&&(I=o.scalefac[s]));for(var y=0,_=0;s<j.SBPSY_l;s++)o.scalefac[s]!=-1&&(_++,y<o.scalefac[s]&&(y=o.scalefac[s]));for(var f=0;f<16;f++)if(I<b[f]&&y<F[f]){var dt=M[f]*ot+at[f]*_;o.part2_length>dt&&(o.part2_length=dt,o.scalefac_compress=f)}}this.best_scalefac_store=function($,l,s,o){var c=o.tt[l][s],f,I,ot,y,_=0;for(ot=0,f=0;f<c.sfbmax;f++){var dt=c.width[f];for(ot+=dt,y=-dt;y<0&&c.l3_enc[y+ot]==0;y++);y==0&&(c.scalefac[f]=_=-2)}if(c.scalefac_scale==0&&c.preflag==0){var ut=0;for(f=0;f<c.sfbmax;f++)c.scalefac[f]>0&&(ut|=c.scalefac[f]);if(!(ut&1)&&ut!=0){for(f=0;f<c.sfbmax;f++)c.scalefac[f]>0&&(c.scalefac[f]>>=1);c.scalefac_scale=_=1}}if(c.preflag==0&&c.block_type!=j.SHORT_TYPE&&$.mode_gr==2){for(f=11;f<j.SBPSY_l&&!(c.scalefac[f]<u.pretab[f]&&c.scalefac[f]!=-2);f++);if(f==j.SBPSY_l){for(f=11;f<j.SBPSY_l;f++)c.scalefac[f]>0&&(c.scalefac[f]-=u.pretab[f]);c.preflag=_=1}}for(I=0;I<4;I++)o.scfsi[s][I]=0;for($.mode_gr==2&&l==1&&o.tt[0][s].block_type!=j.SHORT_TYPE&&o.tt[1][s].block_type!=j.SHORT_TYPE&&(k(s,o),_=0),f=0;f<c.sfbmax;f++)c.scalefac[f]==-2&&(c.scalefac[f]=0);_!=0&&($.mode_gr==2?this.scale_bitcount(c):this.scale_bitcount_lsf($,c))};function n($,l){for(var s=0;s<l;++s)if($[s]<0)return!1;return!0}var G=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],K=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],V=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function($){var l,s,o=0,c=0,f,I=$.scalefac;if(O(n(I,$.sfbmax)),$.block_type==j.SHORT_TYPE)f=G,$.mixed_block_flag!=0&&(f=K);else if(f=V,$.preflag==0){for(s=11;s<j.SBPSY_l&&!(I[s]<u.pretab[s]);s++);if(s==j.SBPSY_l)for($.preflag=1,s=11;s<j.SBPSY_l;s++)I[s]-=u.pretab[s]}for(s=0;s<$.sfbdivide;s++)o<I[s]&&(o=I[s]);for(;s<$.sfbmax;s++)c<I[s]&&(c=I[s]);for($.part2_length=x.LARGE_BITS,l=0;l<16;l++)o<b[l]&&c<F[l]&&$.part2_length>f[l]&&($.part2_length=f[l],$.scalefac_compress=l);return $.part2_length==x.LARGE_BITS};var q=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function($,l){var s,o,c,f,I,ot,y,_,dt=W(4),ut=l.scalefac;for(l.preflag!=0?s=2:s=0,y=0;y<4;y++)dt[y]=0;if(l.block_type==j.SHORT_TYPE){o=1;var ft=u.nr_of_sfb_block[s][o];for(_=0,c=0;c<4;c++)for(f=ft[c]/3,y=0;y<f;y++,_++)for(I=0;I<3;I++)ut[_*3+I]>dt[c]&&(dt[c]=ut[_*3+I])}else{o=0;var ft=u.nr_of_sfb_block[s][o];for(_=0,c=0;c<4;c++)for(f=ft[c],y=0;y<f;y++,_++)ut[_]>dt[c]&&(dt[c]=ut[_])}for(ot=!1,c=0;c<4;c++)dt[c]>q[s][c]&&(ot=!0);if(!ot){var Dt,Wt,Pt,Zt;for(l.sfb_partition_table=u.nr_of_sfb_block[s][o],c=0;c<4;c++)l.slen[c]=it[dt[c]];switch(Dt=l.slen[0],Wt=l.slen[1],Pt=l.slen[2],Zt=l.slen[3],s){case 0:l.scalefac_compress=(Dt*5+Wt<<4)+(Pt<<2)+Zt;break;case 1:l.scalefac_compress=400+(Dt*5+Wt<<2)+Pt;break;case 2:l.scalefac_compress=500+Dt*3+Wt;break;default:r.err.printf(`intensity stereo not implemented yet
`);break}}if(!ot)for(O(l.sfb_partition_table!=null),l.part2_length=0,c=0;c<4;c++)l.part2_length+=l.slen[c]*l.sfb_partition_table[c];return ot};var it=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function($){for(var l=2;l<=576;l+=2){for(var s=0,o;$.scalefac_band.l[++s]<l;);for(o=Q[s][0];$.scalefac_band.l[o+1]>l;)o--;for(o<0&&(o=Q[s][0]),$.bv_scf[l-2]=o,o=Q[s][1];$.scalefac_band.l[o+$.bv_scf[l-2]+2]>l;)o--;o<0&&(o=Q[s][1]),$.bv_scf[l-1]=o}}}return Tn=A,Tn}var Nn,Oo;function to(){if(Oo)return Nn;Oo=1;var t=Ht,r=t.System,d=t.Arrays,W=t.new_byte,O=t.new_float_n,j=t.new_int,L=t.assert,Z=ge(),x=An,A=ri(),u=Dn;h.EQ=function(Q,H){return Math.abs(Q)>Math.abs(H)?Math.abs(Q-H)<=Math.abs(Q)*0.000001:Math.abs(Q-H)<=Math.abs(H)*0.000001},h.NEQ=function(Q,H){return!h.EQ(Q,H)};function h(){var Q=io(),H=this,v=32773,B=null,S=null,D=null,g=null;this.setModules=function(l,s,o,c){B=l,S=s,D=o,g=c};var C=null,P=0,i=0,a=0;this.getframebits=function(l){var s=l.internal_flags,o;s.bitrate_index!=0?o=x.bitrate_table[l.version][s.bitrate_index]:o=l.brate;var c=0|(l.version+1)*72000*o/l.out_samplerate+s.padding;return 8*c};function z(l){r.arraycopy(l.header[l.w_ptr].buf,0,C,i,l.sideinfo_len),i+=l.sideinfo_len,P+=l.sideinfo_len*8,l.w_ptr=l.w_ptr+1&u.MAX_HEADER_BUF-1}function U(l,s,o){for(;o>0;){var c;a==0&&(a=8,i++,L(i<Q.LAME_MAXMP3BUFFER),L(l.header[l.w_ptr].write_timing>=P),l.header[l.w_ptr].write_timing==P&&z(l),C[i]=0),c=Math.min(o,a),o-=c,a-=c,C[i]|=s>>o<<a,P+=c}}function b(l,s,o){for(;o>0;){var c;a==0&&(a=8,i++,L(i<Q.LAME_MAXMP3BUFFER),C[i]=0),c=Math.min(o,a),o-=c,a-=c,C[i]|=s>>o<<a,P+=c}}function F(l,s){var o=l.internal_flags,c;if(s>=8&&(U(o,76,8),s-=8),s>=8&&(U(o,65,8),s-=8),s>=8&&(U(o,77,8),s-=8),s>=8&&(U(o,69,8),s-=8),s>=32){var f=D.getLameShortVersion();if(s>=32)for(c=0;c<f.length&&s>=8;++c)s-=8,U(o,f.charAt(c),8)}for(;s>=1;s-=1)U(o,o.ancillary_flag,1),o.ancillary_flag^=l.disable_reservoir?0:1}function M(l,s,o){for(var c=l.header[l.h_ptr].ptr;o>0;){var f=Math.min(o,8-(c&7));o-=f,l.header[l.h_ptr].buf[c>>3]|=s>>o<<8-(c&7)-f,c+=f}l.header[l.h_ptr].ptr=c}function at(l,s){l<<=8;for(var o=0;o<8;o++)l<<=1,s<<=1,(s^l)&65536&&(s^=v);return s}this.CRC_writeheader=function(l,s){var o=65535;o=at(s[2]&255,o),o=at(s[3]&255,o);for(var c=6;c<l.sideinfo_len;c++)o=at(s[c]&255,o);s[4]=byte(o>>8),s[5]=byte(o&255)};function k(l,s){var o=l.internal_flags,c,f,I;if(c=o.l3_side,o.header[o.h_ptr].ptr=0,d.fill(o.header[o.h_ptr].buf,0,o.sideinfo_len,0),l.out_samplerate<16000?M(o,4094,12):M(o,4095,12),M(o,l.version,1),M(o,1,2),M(o,l.error_protection?0:1,1),M(o,o.bitrate_index,4),M(o,o.samplerate_index,2),M(o,o.padding,1),M(o,l.extension,1),M(o,l.mode.ordinal(),2),M(o,o.mode_ext,2),M(o,l.copyright,1),M(o,l.original,1),M(o,l.emphasis,2),l.error_protection&&M(o,0,16),l.version==1){for(L(c.main_data_begin>=0),M(o,c.main_data_begin,9),o.channels_out==2?M(o,c.private_bits,3):M(o,c.private_bits,5),I=0;I<o.channels_out;I++){var ot;for(ot=0;ot<4;ot++)M(o,c.scfsi[I][ot],1)}for(f=0;f<2;f++)for(I=0;I<o.channels_out;I++){var y=c.tt[f][I];M(o,y.part2_3_length+y.part2_length,12),M(o,y.big_values/2,9),M(o,y.global_gain,8),M(o,y.scalefac_compress,4),y.block_type!=A.NORM_TYPE?(M(o,1,1),M(o,y.block_type,2),M(o,y.mixed_block_flag,1),y.table_select[0]==14&&(y.table_select[0]=16),M(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),M(o,y.table_select[1],5),M(o,y.subblock_gain[0],3),M(o,y.subblock_gain[1],3),M(o,y.subblock_gain[2],3)):(M(o,0,1),y.table_select[0]==14&&(y.table_select[0]=16),M(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),M(o,y.table_select[1],5),y.table_select[2]==14&&(y.table_select[2]=16),M(o,y.table_select[2],5),L(0<=y.region0_count&&y.region0_count<16),L(0<=y.region1_count&&y.region1_count<8),M(o,y.region0_count,4),M(o,y.region1_count,3)),M(o,y.preflag,1),M(o,y.scalefac_scale,1),M(o,y.count1table_select,1)}}else for(L(c.main_data_begin>=0),M(o,c.main_data_begin,8),M(o,c.private_bits,o.channels_out),f=0,I=0;I<o.channels_out;I++){var y=c.tt[f][I];M(o,y.part2_3_length+y.part2_length,12),M(o,y.big_values/2,9),M(o,y.global_gain,8),M(o,y.scalefac_compress,9),y.block_type!=A.NORM_TYPE?(M(o,1,1),M(o,y.block_type,2),M(o,y.mixed_block_flag,1),y.table_select[0]==14&&(y.table_select[0]=16),M(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),M(o,y.table_select[1],5),M(o,y.subblock_gain[0],3),M(o,y.subblock_gain[1],3),M(o,y.subblock_gain[2],3)):(M(o,0,1),y.table_select[0]==14&&(y.table_select[0]=16),M(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),M(o,y.table_select[1],5),y.table_select[2]==14&&(y.table_select[2]=16),M(o,y.table_select[2],5),L(0<=y.region0_count&&y.region0_count<16),L(0<=y.region1_count&&y.region1_count<8),M(o,y.region0_count,4),M(o,y.region1_count,3)),M(o,y.scalefac_scale,1),M(o,y.count1table_select,1)}l.error_protection&&CRC_writeheader(o,o.header[o.h_ptr].buf);{var _=o.h_ptr;L(o.header[_].ptr==o.sideinfo_len*8),o.h_ptr=_+1&u.MAX_HEADER_BUF-1,o.header[o.h_ptr].write_timing=o.header[_].write_timing+s,o.h_ptr==o.w_ptr&&r.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function n(l,s){var o=x.ht[s.count1table_select+32],c,f=0,I=s.big_values,ot=s.big_values;for(L(s.count1table_select<2),c=(s.count1-s.big_values)/4;c>0;--c){var y=0,_=0,dt;dt=s.l3_enc[I+0],dt!=0&&(_+=8,s.xr[ot+0]<0&&y++),dt=s.l3_enc[I+1],dt!=0&&(_+=4,y*=2,s.xr[ot+1]<0&&y++),dt=s.l3_enc[I+2],dt!=0&&(_+=2,y*=2,s.xr[ot+2]<0&&y++),dt=s.l3_enc[I+3],dt!=0&&(_++,y*=2,s.xr[ot+3]<0&&y++),I+=4,ot+=4,U(l,y+o.table[_],o.hlen[_]),f+=o.hlen[_]}return f}function G(l,s,o,c,f){var I=x.ht[s],ot=0;if(s==0)return ot;for(var y=o;y<c;y+=2){var _=0,dt=0,ut=I.xlen,ft=I.xlen,Dt=0,Wt=f.l3_enc[y],Pt=f.l3_enc[y+1];if(Wt!=0&&(f.xr[y]<0&&Dt++,_--),s>15){if(Wt>14){var Zt=Wt-15;L(Zt<=I.linmax),Dt|=Zt<<1,dt=ut,Wt=15}if(Pt>14){var Vt=Pt-15;L(Vt<=I.linmax),Dt<<=ut,Dt|=Vt,dt+=ut,Pt=15}ft=16}Pt!=0&&(Dt<<=1,f.xr[y+1]<0&&Dt++,_--),Wt=Wt*ft+Pt,dt-=_,_+=I.hlen[Wt],U(l,I.table[Wt],_),U(l,Dt,dt),ot+=_+dt}return ot}function K(l,s){var o=3*l.scalefac_band.s[3];o>s.big_values&&(o=s.big_values);var c=G(l,s.table_select[0],0,o,s);return c+=G(l,s.table_select[1],o,s.big_values,s),c}function V(l,s){var o,c,f,I;o=s.big_values;var ot=s.region0_count+1;return L(ot<l.scalefac_band.l.length),f=l.scalefac_band.l[ot],ot+=s.region1_count+1,L(ot<l.scalefac_band.l.length),I=l.scalefac_band.l[ot],f>o&&(f=o),I>o&&(I=o),c=G(l,s.table_select[0],0,f,s),c+=G(l,s.table_select[1],f,I,s),c+=G(l,s.table_select[2],I,o,s),c}function q(l){var s,o,c,f,I=0,ot=l.internal_flags,y=ot.l3_side;if(l.version==1)for(s=0;s<2;s++)for(o=0;o<ot.channels_out;o++){var _=y.tt[s][o],dt=Z.slen1_tab[_.scalefac_compress],ut=Z.slen2_tab[_.scalefac_compress];for(f=0,c=0;c<_.sfbdivide;c++)_.scalefac[c]!=-1&&(U(ot,_.scalefac[c],dt),f+=dt);for(;c<_.sfbmax;c++)_.scalefac[c]!=-1&&(U(ot,_.scalefac[c],ut),f+=ut);L(f==_.part2_length),_.block_type==A.SHORT_TYPE?f+=K(ot,_):f+=V(ot,_),f+=n(ot,_),L(f==_.part2_3_length+_.part2_length),I+=f}else for(s=0,o=0;o<ot.channels_out;o++){var _=y.tt[s][o],ft,Dt,Wt=0;if(L(_.sfb_partition_table!=null),f=0,c=0,Dt=0,_.block_type==A.SHORT_TYPE){for(;Dt<4;Dt++){var Pt=_.sfb_partition_table[Dt]/3,Zt=_.slen[Dt];for(ft=0;ft<Pt;ft++,c++)U(ot,Math.max(_.scalefac[c*3+0],0),Zt),U(ot,Math.max(_.scalefac[c*3+1],0),Zt),U(ot,Math.max(_.scalefac[c*3+2],0),Zt),Wt+=3*Zt}f+=K(ot,_)}else{for(;Dt<4;Dt++){var Pt=_.sfb_partition_table[Dt],Zt=_.slen[Dt];for(ft=0;ft<Pt;ft++,c++)U(ot,Math.max(_.scalefac[c],0),Zt),Wt+=Zt}f+=V(ot,_)}f+=n(ot,_),L(f==_.part2_3_length),L(Wt==_.part2_length),I+=Wt+f}return I}function it(){this.total=0}function $(l,s){var o=l.internal_flags,c,f,I,ot,y;return y=o.w_ptr,ot=o.h_ptr-1,ot==-1&&(ot=u.MAX_HEADER_BUF-1),c=o.header[ot].write_timing-P,s.total=c,c>=0&&(f=1+ot-y,ot<y&&(f=1+ot-y+u.MAX_HEADER_BUF),c-=f*8*o.sideinfo_len),I=H.getframebits(l),c+=I,s.total+=I,s.total%8!=0?s.total=1+s.total/8:s.total=s.total/8,s.total+=i+1,c<0&&r.err.println(`strange error flushing buffer ... 
`),c}this.flush_bitstream=function(l){var s=l.internal_flags,o,c,f=s.h_ptr-1;if(f==-1&&(f=u.MAX_HEADER_BUF-1),o=s.l3_side,!((c=$(l,new it))<0)){if(F(l,c),L(s.header[f].write_timing+this.getframebits(l)==P),s.ResvSize=0,o.main_data_begin=0,s.findReplayGain){var I=B.GetTitleGain(s.rgdata);L(NEQ(I,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),s.RadioGain=Math.floor(I*10+0.5)|0}s.findPeakSample&&(s.noclipGainChange=Math.ceil(Math.log10(s.PeakSample/32767)*20*10)|0,s.noclipGainChange>0&&(EQ(l.scale,1)||EQ(l.scale,0))?s.noclipScale=Math.floor(32767/s.PeakSample*100)/100:s.noclipScale=-1)}},this.add_dummy_byte=function(l,s,o){for(var c=l.internal_flags,f;o-- >0;)for(b(c,s,8),f=0;f<u.MAX_HEADER_BUF;++f)c.header[f].write_timing+=8},this.format_bitstream=function(l){var s=l.internal_flags,o;o=s.l3_side;var c=this.getframebits(l);F(l,o.resvDrain_pre),k(l,c);var f=8*s.sideinfo_len;if(f+=q(l),F(l,o.resvDrain_post),f+=o.resvDrain_post,o.main_data_begin+=(c-f)/8,$(l,new it)!=s.ResvSize&&r.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),o.main_data_begin*8!=s.ResvSize&&(r.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*o.main_data_begin,s.ResvSize,o.resvDrain_post,o.resvDrain_pre,8*s.sideinfo_len,f-o.resvDrain_post-8*s.sideinfo_len,f,f%8,c),r.err.println("This is a fatal error.  It has several possible causes:"),r.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),r.err.println(" 9%%  Your system is overclocked"),r.err.println(" 1%%  bug in LAME encoding library"),s.ResvSize=o.main_data_begin*8),P>1e9){var I;for(I=0;I<u.MAX_HEADER_BUF;++I)s.header[I].write_timing-=P;P=0}return 0},this.copy_buffer=function(l,s,o,c,f){var I=i+1;if(I<=0)return 0;if(c!=0&&I>c)return-1;if(r.arraycopy(C,0,s,o,I),i=-1,a=0,f!=0){var ot=j(1);if(ot[0]=l.nMusicCRC,g.updateMusicCRC(ot,s,o,I),l.nMusicCRC=ot[0],I>0&&(l.VBR_seek_table.nBytesWritten+=I),l.decode_on_the_fly){for(var y=O([2,1152]),_=I,dt=-1,ut;dt!=0;)if(dt=S.hip_decode1_unclipped(l.hip,s,o,_,y[0],y[1]),_=0,dt==-1&&(dt=0),dt>0){if(l.findPeakSample){for(ut=0;ut<dt;ut++)y[0][ut]>l.PeakSample?l.PeakSample=y[0][ut]:-y[0][ut]>l.PeakSample&&(l.PeakSample=-y[0][ut]);if(l.channels_out>1)for(ut=0;ut<dt;ut++)y[1][ut]>l.PeakSample?l.PeakSample=y[1][ut]:-y[1][ut]>l.PeakSample&&(l.PeakSample=-y[1][ut])}if(l.findReplayGain&&B.AnalyzeSamples(l.rgdata,y[0],0,y[1],0,dt,l.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return I},this.init_bit_stream_w=function(l){C=W(Q.LAME_MAXMP3BUFFER),l.h_ptr=l.w_ptr=0,l.header[l.h_ptr].write_timing=0,i=-1,a=0,P=0}}return Nn=h,Nn}var Sn,qo;function io(){if(qo)return Sn;qo=1;var t=Ht,r=t.System,d=t.VbrMode,W=t.ShortBlock,O=t.new_float,j=t.new_int_n,L=t.new_short_n,Z=t.assert,x=or,A=sr,u=Dn,h=Qr,Q=yr,H=qr,v=to(),B=An,S=ri();function D(){var g=cn,C=this,P=131072;D.V9=410,D.V8=420,D.V7=430,D.V6=440,D.V5=450,D.V4=460,D.V3=470,D.V2=480,D.V1=490,D.V0=500,D.R3MIX=1000,D.STANDARD=1001,D.EXTREME=1002,D.INSANE=1003,D.STANDARD_FAST=1004,D.EXTREME_FAST=1005,D.MEDIUM=1006,D.MEDIUM_FAST=1007;var i=16384+P;D.LAME_MAXMP3BUFFER=i;var a,z,U,b,F,M=new x,at,k,n;this.enc=new S,this.setModules=function(e,p,Ct,Jt,Xt,yt,zt,Yt,Kt){a=e,z=p,U=Ct,b=Jt,F=Xt,at=yt,k=Yt,n=Kt,this.enc.setModules(z,M,b,at)};function G(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=O(S.SBMAX_l),this.bo_s_weight=O(S.SBMAX_s)}function K(){this.lowerlimit=0}function V(e,p){this.lowpass=p}var q=4294479419;function it(e){var p;return e.class_id=q,p=e.internal_flags=new u,e.mode=g.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,p.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=d.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,p.VBR_min_bitrate=1,p.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,p.resample_ratio=1,p.OldValue[0]=180,p.OldValue[1]=180,p.CurrentStep[0]=4,p.CurrentStep[1]=4,p.masking_lower=1,p.nsPsy.attackthre=-1,p.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,p.mf_samples_to_encode=S.ENCDELAY+S.POSTDELAY,e.encoder_padding=0,p.mf_size=S.ENCDELAY-S.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,p.decode_on_the_fly=!1,p.findReplayGain=!1,p.findPeakSample=!1,p.RadioGain=0,p.AudiophileGain=0,p.noclipGainChange=0,p.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}this.lame_init=function(){var e=new A;return it(e),e.lame_allocated_gfp=1,e};function $(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}this.nearestBitrateFullIndex=function(e){var p=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Ct=0,Jt=0,Xt=0,yt=0;yt=p[16],Xt=16,Jt=p[16],Ct=16;for(var zt=0;zt<16;zt++)if(Math.max(e,p[zt+1])!=e){yt=p[zt+1],Xt=zt+1,Jt=p[zt],Ct=zt;break}return yt-e>e-Jt?Ct:Xt};function l(e,p){var Ct=44100;return p>=48000?Ct=48000:p>=44100?Ct=44100:p>=32000?Ct=32000:p>=24000?Ct=24000:p>=22050?Ct=22050:p>=16000?Ct=16000:p>=12000?Ct=12000:p>=11025?Ct=11025:p>=8000&&(Ct=8000),e==-1?Ct:(e<=15960&&(Ct=44100),e<=15250&&(Ct=32000),e<=11220&&(Ct=24000),e<=9970&&(Ct=22050),e<=7230&&(Ct=16000),e<=5420&&(Ct=12000),e<=4510&&(Ct=11025),e<=3970&&(Ct=8000),p<Ct?p>44100?48000:p>32000?44100:p>24000?32000:p>22050?24000:p>16000?22050:p>12000?16000:p>11025?12000:p>8000?11025:8000:Ct)}function s(e,p){switch(e){case 44100:return p.version=1,0;case 48000:return p.version=1,1;case 32000:return p.version=1,2;case 22050:return p.version=0,0;case 24000:return p.version=0,1;case 16000:return p.version=0,2;case 11025:return p.version=0,0;case 12000:return p.version=0,1;case 8000:return p.version=0,2;default:return p.version=0,-1}}function o(e,p,Ct){Ct<16000&&(p=2);for(var Jt=B.bitrate_table[p][1],Xt=2;Xt<=14;Xt++)B.bitrate_table[p][Xt]>0&&Math.abs(B.bitrate_table[p][Xt]-e)<Math.abs(Jt-e)&&(Jt=B.bitrate_table[p][Xt]);return Jt}function c(e,p,Ct){Ct<16000&&(p=2);for(var Jt=0;Jt<=14;Jt++)if(B.bitrate_table[p][Jt]>0&&B.bitrate_table[p][Jt]==e)return Jt;return-1}function f(e,p){var Ct=[new V(8,2000),new V(16,3700),new V(24,3900),new V(32,5500),new V(40,7000),new V(48,7500),new V(56,1e4),new V(64,11000),new V(80,13500),new V(96,15100),new V(112,15600),new V(128,17000),new V(160,17500),new V(192,18600),new V(224,19400),new V(256,19700),new V(320,20500)],Jt=C.nearestBitrateFullIndex(p);e.lowerlimit=Ct[Jt].lowpass}function I(e){var p=e.internal_flags,Ct=32,Jt=-1;if(p.lowpass1>0){for(var Xt=999,yt=0;yt<=31;yt++){var zt=yt/31;zt>=p.lowpass2&&(Ct=Math.min(Ct,yt)),p.lowpass1<zt&&zt<p.lowpass2&&(Xt=Math.min(Xt,yt))}Xt==999?p.lowpass1=(Ct-0.75)/31:p.lowpass1=(Xt-0.75)/31,p.lowpass2=Ct/31}if(p.highpass2>0&&p.highpass2<0.021774193548387097&&(p.highpass1=0,p.highpass2=0,r.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),p.highpass2>0){for(var Yt=-1,yt=0;yt<=31;yt++){var zt=yt/31;zt<=p.highpass1&&(Jt=Math.max(Jt,yt)),p.highpass1<zt&&zt<p.highpass2&&(Yt=Math.max(Yt,yt))}p.highpass1=Jt/31,Yt==-1?p.highpass2=(Jt+0.75)/31:p.highpass2=(Yt+0.75)/31}for(var yt=0;yt<32;yt++){var Kt,jt,zt=yt/31;p.highpass2>p.highpass1?Kt=$((p.highpass2-zt)/(p.highpass2-p.highpass1+0.00000000000000000001)):Kt=1,p.lowpass2>p.lowpass1?jt=$((zt-p.lowpass1)/(p.lowpass2-p.lowpass1+0.00000000000000000001)):jt=1,p.amp_filter[yt]=Kt*jt}}function ot(e){var p=e.internal_flags;switch(e.quality){default:case 9:p.psymodel=0,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 8:e.quality=7;case 7:p.psymodel=1,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 6:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 5:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 4:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 3:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 2:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 1:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 0:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break}}function y(e){var p=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&k.id3tag_write_v2(e),p.bitrate_stereoMode_Hist=j([16,5]),p.bitrate_blockType_Hist=j([16,6]),p.PeakSample=0,e.bWriteVbrTag&&at.InitVbrTag(e)}this.lame_init_params=function(e){var p=e.internal_flags;if(p.Class_ID=0,p.ATH==null&&(p.ATH=new h),p.PSY==null&&(p.PSY=new G),p.rgdata==null&&(p.rgdata=new Q),p.channels_in=e.num_channels,p.channels_in==1&&(e.mode=g.MONO),p.channels_out=e.mode==g.MONO?1:2,p.mode_ext=S.MPG_MD_MS_LR,e.mode==g.MONO&&(e.force_ms=!1),e.VBR==d.vbr_off&&e.VBR_mean_bitrate_kbps!=128&&e.brate==0&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==d.vbr_off||e.VBR==d.vbr_mtrh||e.VBR==d.vbr_mt||(e.free_format=!1),e.VBR==d.vbr_off&&e.brate==0&&v.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==d.vbr_off&&e.compression_ratio>0&&(e.out_samplerate==0&&(e.out_samplerate=map2MP3Frequency(int(0.97*e.in_samplerate))),e.brate=0|e.out_samplerate*16*p.channels_out/(1000*e.compression_ratio),p.samplerate_index=s(e.out_samplerate,e),e.free_format||(e.brate=o(e.brate,e.version,e.out_samplerate))),e.out_samplerate!=0&&(e.out_samplerate<16000?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32000?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),e.lowpassfreq==0){var Ct=16000;switch(e.VBR){case d.vbr_off:{var Jt=new K;f(Jt,e.brate),Ct=Jt.lowerlimit;break}case d.vbr_abr:{var Jt=new K;f(Jt,e.VBR_mean_bitrate_kbps),Ct=Jt.lowerlimit;break}case d.vbr_rh:{var Xt=[19500,19000,18600,18000,17500,16000,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var yt=Xt[e.VBR_q],zt=Xt[e.VBR_q+1],Yt=e.VBR_q_frac;Ct=linear_int(yt,zt,Yt)}else Ct=19500;break}default:{var Xt=[19500,19000,18500,18000,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var yt=Xt[e.VBR_q],zt=Xt[e.VBR_q+1],Yt=e.VBR_q_frac;Ct=linear_int(yt,zt,Yt)}else Ct=19500}}e.mode==g.MONO&&(e.VBR==d.vbr_off||e.VBR==d.vbr_abr)&&(Ct*=1.5),e.lowpassfreq=Ct|0}if(e.out_samplerate==0&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=l(e.lowpassfreq|0,e.in_samplerate)),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==d.vbr_off&&(e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.brate)),e.VBR==d.vbr_abr&&(e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,p.findPeakSample=!1),p.findReplayGain=e.findReplayGain,p.decode_on_the_fly=e.decode_on_the_fly,p.decode_on_the_fly&&(p.findPeakSample=!0),p.findReplayGain&&a.InitGainAnalysis(p.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(p.decode_on_the_fly&&!e.decode_only&&(p.hip!=null&&n.hip_decode_exit(p.hip),p.hip=n.hip_decode_init()),p.mode_gr=e.out_samplerate<=24000?1:2,e.framesize=576*p.mode_gr,e.encoder_delay=S.ENCDELAY,p.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case d.vbr_mt:case d.vbr_rh:case d.vbr_mtrh:{var Kt=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];e.compression_ratio=Kt[e.VBR_q]}break;case d.vbr_abr:e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.brate);break}if(e.mode==g.NOT_SET&&(e.mode=g.JOINT_STEREO),e.highpassfreq>0?(p.highpass1=2*e.highpassfreq,e.highpasswidth>=0?p.highpass2=2*(e.highpassfreq+e.highpasswidth):p.highpass2=2*e.highpassfreq,p.highpass1/=e.out_samplerate,p.highpass2/=e.out_samplerate):(p.highpass1=0,p.highpass2=0),e.lowpassfreq>0?(p.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(p.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),p.lowpass1<0&&(p.lowpass1=0)):p.lowpass1=2*e.lowpassfreq,p.lowpass1/=e.out_samplerate,p.lowpass2/=e.out_samplerate):(p.lowpass1=0,p.lowpass2=0),I(e),p.samplerate_index=s(e.out_samplerate,e),p.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==d.vbr_off){if(e.free_format)p.bitrate_index=0;else if(e.brate=o(e.brate,e.version,e.out_samplerate),p.bitrate_index=c(e.brate,e.version,e.out_samplerate),p.bitrate_index<=0)return e.internal_flags=null,-1}else p.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),p.pinfo!=null&&(e.bWriteVbrTag=!1),z.init_bit_stream_w(p);for(var jt=p.samplerate_index+3*e.version+6*(e.out_samplerate<16000?1:0),mt=0;mt<S.SBMAX_l+1;mt++)p.scalefac_band.l[mt]=b.sfBandIndex[jt].l[mt];for(var mt=0;mt<S.PSFB21+1;mt++){var vt=(p.scalefac_band.l[22]-p.scalefac_band.l[21])/S.PSFB21,ii=p.scalefac_band.l[21]+mt*vt;p.scalefac_band.psfb21[mt]=ii}p.scalefac_band.psfb21[S.PSFB21]=576;for(var mt=0;mt<S.SBMAX_s+1;mt++)p.scalefac_band.s[mt]=b.sfBandIndex[jt].s[mt];for(var mt=0;mt<S.PSFB12+1;mt++){var vt=(p.scalefac_band.s[13]-p.scalefac_band.s[12])/S.PSFB12,ii=p.scalefac_band.s[12]+mt*vt;p.scalefac_band.psfb12[mt]=ii}p.scalefac_band.psfb12[S.PSFB12]=192,e.version==1?p.sideinfo_len=p.channels_out==1?21:36:p.sideinfo_len=p.channels_out==1?13:21,e.error_protection&&(p.sideinfo_len+=2),y(e),p.Class_ID=q;{var qt;for(qt=0;qt<19;qt++)p.nsPsy.pefirbuf[qt]=700*p.mode_gr*p.channels_out;e.ATHtype==-1&&(e.ATHtype=4)}switch(Z(e.VBR_q<=9),Z(e.VBR_q>=0),e.VBR){case d.vbr_mt:e.VBR=d.vbr_mtrh;case d.vbr_mtrh:{e.useTemporal==null&&(e.useTemporal=!1),U.apply_preset(e,500-e.VBR_q*10,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),p.PSY.mask_adjust=e.maskingadjust,p.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=e.out_samplerate>44000,p.iteration_loop=new VBRNewIterationLoop(F);break}case d.vbr_rh:{U.apply_preset(e,500-e.VBR_q*10,0),p.PSY.mask_adjust=e.maskingadjust,p.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=e.out_samplerate>44000,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),p.iteration_loop=new VBROldIterationLoop(F);break}default:{var m;p.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),m=e.VBR,m==d.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),U.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=m,p.PSY.mask_adjust=e.maskingadjust,p.PSY.mask_adjust_short=e.maskingadjust_short,m==d.vbr_off?p.iteration_loop=new H(F):p.iteration_loop=new ABRIterationLoop(F);break}}if(Z(e.scale>=0),e.VBR!=d.vbr_off){if(p.VBR_min_bitrate=1,p.VBR_max_bitrate=14,e.out_samplerate<16000&&(p.VBR_max_bitrate=8),e.VBR_min_bitrate_kbps!=0&&(e.VBR_min_bitrate_kbps=o(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),p.VBR_min_bitrate=c(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),p.VBR_min_bitrate<0)||e.VBR_max_bitrate_kbps!=0&&(e.VBR_max_bitrate_kbps=o(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),p.VBR_max_bitrate=c(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),p.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=B.bitrate_table[e.version][p.VBR_min_bitrate],e.VBR_max_bitrate_kbps=B.bitrate_table[e.version][p.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(B.bitrate_table[e.version][p.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(B.bitrate_table[e.version][p.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(p.PSY.mask_adjust+=e.tune_value_a,p.PSY.mask_adjust_short+=e.tune_value_a),ot(e),Z(e.scale>=0),e.athaa_type<0?p.ATH.useAdjust=3:p.ATH.useAdjust=e.athaa_type,p.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),e.short_blocks==null&&(e.short_blocks=W.short_block_allowed),e.short_blocks==W.short_block_allowed&&(e.mode==g.JOINT_STEREO||e.mode==g.STEREO)&&(e.short_blocks=W.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=e.exp_nspsytune|1,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=x.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=x.NSATTACKTHRE_S),Z(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),e.useTemporal==null&&(e.useTemporal=!0),p.slot_lag=p.frac_SpF=0,e.VBR==d.vbr_off&&(p.slot_lag=p.frac_SpF=(e.version+1)*72000*e.brate%e.out_samplerate|0),b.iteration_init(e),M.psymodel_init(e),Z(e.scale>=0),0};function _(e,p){(e.in_buffer_0==null||e.in_buffer_nsamples<p)&&(e.in_buffer_0=O(p),e.in_buffer_1=O(p),e.in_buffer_nsamples=p)}this.lame_encode_flush=function(e,p,Ct,Jt){var Xt=e.internal_flags,yt=L([2,1152]),zt=0,Yt,Kt,jt,mt,vt=Xt.mf_samples_to_encode-S.POSTDELAY,ii=dt(e);if(Xt.mf_samples_to_encode<1)return 0;for(Yt=0,e.in_samplerate!=e.out_samplerate&&(vt+=16*e.out_samplerate/e.in_samplerate),jt=e.framesize-vt%e.framesize,jt<576&&(jt+=e.framesize),e.encoder_padding=jt,mt=(vt+jt)/e.framesize;mt>0&&zt>=0;){var qt=ii-Xt.mf_size,m=e.frameNum;qt*=e.in_samplerate,qt/=e.out_samplerate,qt>1152&&(qt=1152),qt<1&&(qt=1),Kt=Jt-Yt,Jt==0&&(Kt=0),zt=this.lame_encode_buffer(e,yt[0],yt[1],qt,p,Ct,Kt),Ct+=zt,Yt+=zt,mt-=m!=e.frameNum?1:0}if(Xt.mf_samples_to_encode=0,zt<0||(Kt=Jt-Yt,Jt==0&&(Kt=0),z.flush_bitstream(e),zt=z.copy_buffer(Xt,p,Ct,Kt,1),zt<0))return zt;if(Ct+=zt,Yt+=zt,Kt=Jt-Yt,Jt==0&&(Kt=0),e.write_id3tag_automatic){if(k.id3tag_write_v1(e),zt=z.copy_buffer(Xt,p,Ct,Kt,0),zt<0)return zt;Yt+=zt}return Yt},this.lame_encode_buffer=function(e,p,Ct,Jt,Xt,yt,zt){var Yt=e.internal_flags,Kt=[null,null];if(Yt.Class_ID!=q)return-3;if(Jt==0)return 0;_(Yt,Jt),Kt[0]=Yt.in_buffer_0,Kt[1]=Yt.in_buffer_1;for(var jt=0;jt<Jt;jt++)Kt[0][jt]=p[jt],Yt.channels_in>1&&(Kt[1][jt]=Ct[jt]);return ut(e,Kt[0],Kt[1],Jt,Xt,yt,zt)};function dt(e){var p=S.BLKSIZE+e.framesize-S.FFTOFFSET;return p=Math.max(p,512+e.framesize-32),p}function ut(e,p,Ct,Jt,Xt,yt,zt){var Yt=e.internal_flags,Kt=0,jt,mt,vt,ii,qt,m=[null,null],w=[null,null];if(Yt.Class_ID!=q)return-3;if(Jt==0)return 0;if(qt=z.copy_buffer(Yt,Xt,yt,zt,0),qt<0)return qt;if(yt+=qt,Kt+=qt,w[0]=p,w[1]=Ct,v.NEQ(e.scale,0)&&v.NEQ(e.scale,1))for(mt=0;mt<Jt;++mt)w[0][mt]*=e.scale,Yt.channels_out==2&&(w[1][mt]*=e.scale);if(v.NEQ(e.scale_left,0)&&v.NEQ(e.scale_left,1))for(mt=0;mt<Jt;++mt)w[0][mt]*=e.scale_left;if(v.NEQ(e.scale_right,0)&&v.NEQ(e.scale_right,1))for(mt=0;mt<Jt;++mt)w[1][mt]*=e.scale_right;if(e.num_channels==2&&Yt.channels_out==1)for(mt=0;mt<Jt;++mt)w[0][mt]=0.5*(w[0][mt]+w[1][mt]),w[1][mt]=0;ii=dt(e),m[0]=Yt.mfbuf[0],m[1]=Yt.mfbuf[1];for(var Y=0;Jt>0;){var X=[null,null],E=0,J=0;X[0]=w[0],X[1]=w[1];var T=new Dt;if(mi(e,m,X,Y,Jt,T),E=T.n_in,J=T.n_out,Yt.findReplayGain&&!Yt.decode_on_the_fly&&a.AnalyzeSamples(Yt.rgdata,m[0],Yt.mf_size,m[1],Yt.mf_size,J,Yt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(Jt-=E,Y+=E,Yt.channels_out==0,Yt.mf_size+=J,Z(Yt.mf_size<=u.MFSIZE),Yt.mf_samples_to_encode<1&&(Yt.mf_samples_to_encode=S.ENCDELAY+S.POSTDELAY),Yt.mf_samples_to_encode+=J,Yt.mf_size>=ii){var R=zt-Kt;if(zt==0&&(R=0),jt=ft(e,m[0],m[1],Xt,yt,R),jt<0)return jt;for(yt+=jt,Kt+=jt,Yt.mf_size-=e.framesize,Yt.mf_samples_to_encode-=e.framesize,vt=0;vt<Yt.channels_out;vt++)for(mt=0;mt<Yt.mf_size;mt++)m[vt][mt]=m[vt][mt+e.framesize]}}return Kt}function ft(e,p,Ct,Jt,Xt,yt){var zt=C.enc.lame_encode_mp3_frame(e,p,Ct,Jt,Xt,yt);return e.frameNum++,zt}function Dt(){this.n_in=0,this.n_out=0}function Wt(){this.num_used=0}function Pt(e,p){return p!=0?Pt(p,e%p):e}function Zt(e,p,Ct){var Jt=Math.PI*p;e/=Ct,e<0&&(e=0),e>1&&(e=1);var Xt=e-0.5,yt=0.42-0.5*Math.cos(2*e*Math.PI)+0.08*Math.cos(4*e*Math.PI);return Math.abs(Xt)<0.000000001?Jt/Math.PI:yt*Math.sin(Ct*Jt*Xt)/(Math.PI*Ct*Xt)}function Vt(e,p,Ct,Jt,Xt,yt,zt,Yt,Kt){var jt=e.internal_flags,mt,vt=0,ii,qt=e.out_samplerate/Pt(e.out_samplerate,e.in_samplerate);qt>u.BPC&&(qt=u.BPC);var m=Math.abs(jt.resample_ratio-Math.floor(0.5+jt.resample_ratio))<0.0001?1:0,w=1/jt.resample_ratio;w>1&&(w=1);var Y=31;Y%2==0&&--Y,Y+=m;var X=Y+1;if(jt.fill_buffer_resample_init==0){for(jt.inbuf_old[0]=O(X),jt.inbuf_old[1]=O(X),mt=0;mt<=2*qt;++mt)jt.blackfilt[mt]=O(X);for(jt.itime[0]=0,jt.itime[1]=0,vt=0;vt<=2*qt;vt++){var E=0,J=(vt-qt)/(2*qt);for(mt=0;mt<=Y;mt++)E+=jt.blackfilt[vt][mt]=Zt(mt-J,w,Y);for(mt=0;mt<=Y;mt++)jt.blackfilt[vt][mt]/=E}jt.fill_buffer_resample_init=1}var T=jt.inbuf_old[Kt];for(ii=0;ii<Jt;ii++){var R,N;if(R=ii*jt.resample_ratio,vt=0|Math.floor(R-jt.itime[Kt]),Y+vt-Y/2>=zt)break;var J=R-jt.itime[Kt]-(vt+0.5*(Y%2));N=0|Math.floor(J*2*qt+qt+0.5);var et=0;for(mt=0;mt<=Y;++mt){var tt=0|mt+vt-Y/2,rt;rt=tt<0?T[X+tt]:Xt[yt+tt],et+=rt*jt.blackfilt[N][mt]}p[Ct+ii]=et}if(Yt.num_used=Math.min(zt,Y+vt-Y/2),jt.itime[Kt]+=Yt.num_used-ii*jt.resample_ratio,Yt.num_used>=X)for(mt=0;mt<X;mt++)T[mt]=Xt[yt+Yt.num_used+mt-X];else{var gt=X-Yt.num_used;for(mt=0;mt<gt;++mt)T[mt]=T[mt+Yt.num_used];for(vt=0;mt<X;++mt,++vt)T[mt]=Xt[yt+vt];Z(vt==Yt.num_used)}return ii}function mi(e,p,Ct,Jt,Xt,yt){var zt=e.internal_flags;if(zt.resample_ratio<0.9999||zt.resample_ratio>1.0001)for(var Yt=0;Yt<zt.channels_out;Yt++){var Kt=new Wt;yt.n_out=Vt(e,p[Yt],zt.mf_size,e.framesize,Ct[Yt],Jt,Xt,Kt,Yt),yt.n_in=Kt.num_used}else{yt.n_out=Math.min(e.framesize,Xt),yt.n_in=yt.n_out;for(var jt=0;jt<yt.n_out;++jt)p[0][zt.mf_size+jt]=Ct[0][Jt+jt],zt.channels_out==2&&(p[1][zt.mf_size+jt]=Ct[1][Jt+jt])}}}return Sn=D,Sn}var xr=Ht,zi=xr.VbrMode;function br(){var t=io();function r(u,h,Q,H,v,B,S,D,g,C,P,i,a,z,U){this.vbr_q=u,this.quant_comp=h,this.quant_comp_s=Q,this.expY=H,this.st_lrm=v,this.st_s=B,this.masking_adj=S,this.masking_adj_short=D,this.ath_lower=g,this.ath_curve=C,this.ath_sensitivity=P,this.interch=i,this.safejoint=a,this.sfb21mod=z,this.msfix=U}function d(u,h,Q,H,v,B,S,D,g,C,P,i,a,z){this.quant_comp=h,this.quant_comp_s=Q,this.safejoint=H,this.nsmsfix=v,this.st_lrm=B,this.st_s=S,this.nsbass=D,this.scale=g,this.masking_adj=C,this.ath_lower=P,this.ath_curve=i,this.interch=a,this.sfscale=z}var W;this.setModules=function(u){W=u};var O=[new r(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,0.97),new r(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new r(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new r(4,9,9,1,6,135,-0.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new r(5,9,9,1,6.4,140,0.5,0.4,-7.5,4,-12,0.0002,0,0,1.95),new r(6,9,9,1,6.6,145,0.67,0.65,-14.7,6.5,-19,0.0004,0,0,2.3),new r(7,9,9,1,6.6,145,0.8,0.75,-19.7,8,-22,0.0006,0,0,2.7),new r(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,0.0007,0,0,0),new r(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,0.0008,0,0,0),new r(10,9,9,1,6.6,145,2,2,-36,12,-25,0.0008,0,0,0)],j=[new r(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,0.97),new r(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new r(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new r(4,9,9,1,4.2,25,-2.2,0.1,0,3.5,-8,0,2,0,1.79),new r(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,0.0002,0,0,1.95),new r(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,0.0004,0,0,2),new r(7,9,9,1,4.2,25,0.5,2,-14.5,8,-22,0.0006,0,0,2),new r(8,9,9,1,4.2,25,1,2.4,-22,10,-23,0.0007,0,0,2),new r(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,0.0008,0,0,2),new r(10,9,9,1,4.2,25,2,2.95,-36,12,-30,0.0008,0,0,2)];function L(u,h,Q){var H=u.VBR==zi.vbr_rh?O:j,v=u.VBR_q_frac,B=H[h],S=H[h+1],D=B;B.st_lrm=B.st_lrm+v*(S.st_lrm-B.st_lrm),B.st_s=B.st_s+v*(S.st_s-B.st_s),B.masking_adj=B.masking_adj+v*(S.masking_adj-B.masking_adj),B.masking_adj_short=B.masking_adj_short+v*(S.masking_adj_short-B.masking_adj_short),B.ath_lower=B.ath_lower+v*(S.ath_lower-B.ath_lower),B.ath_curve=B.ath_curve+v*(S.ath_curve-B.ath_curve),B.ath_sensitivity=B.ath_sensitivity+v*(S.ath_sensitivity-B.ath_sensitivity),B.interch=B.interch+v*(S.interch-B.interch),B.msfix=B.msfix+v*(S.msfix-B.msfix),A(u,D.vbr_q),Q!=0?u.quant_comp=D.quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=D.quant_comp),Q!=0?u.quant_comp_short=D.quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=D.quant_comp_s),D.expY!=0&&(u.experimentalY=D.expY!=0),Q!=0?u.internal_flags.nsPsy.attackthre=D.st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=D.st_lrm),Q!=0?u.internal_flags.nsPsy.attackthre_s=D.st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=D.st_s),Q!=0?u.maskingadjust=D.masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=D.masking_adj),Q!=0?u.maskingadjust_short=D.masking_adj_short:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=D.masking_adj_short),Q!=0?u.ATHlower=-D.ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-D.ath_lower/10),Q!=0?u.ATHcurve=D.ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=D.ath_curve),Q!=0?u.athaa_sensitivity=D.ath_sensitivity:Math.abs(u.athaa_sensitivity- -1)>0||(u.athaa_sensitivity=D.ath_sensitivity),D.interch>0&&(Q!=0?u.interChRatio=D.interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=D.interch)),D.safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|D.safejoint),D.sfb21mod>0&&(u.exp_nspsytune=u.exp_nspsytune|D.sfb21mod<<20),Q!=0?u.msfix=D.msfix:Math.abs(u.msfix- -1)>0||(u.msfix=D.msfix),Q==0&&(u.VBR_q=h,u.VBR_q_frac=v)}var Z=[new d(8,9,9,0,0,6.6,145,0,0.95,0,-30,11,0.0012,1),new d(16,9,9,0,0,6.6,145,0,0.95,0,-25,11,0.001,1),new d(24,9,9,0,0,6.6,145,0,0.95,0,-20,11,0.001,1),new d(32,9,9,0,0,6.6,145,0,0.95,0,-15,11,0.001,1),new d(40,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new d(48,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new d(56,9,9,0,0,6.6,145,0,0.95,0,-6,11,0.0008,1),new d(64,9,9,0,0,6.6,145,0,0.95,0,-2,11,0.0008,1),new d(80,9,9,0,0,6.6,145,0,0.95,0,0,8,0.0007,1),new d(96,9,9,0,2.5,6.6,145,0,0.95,0,1,5.5,0.0006,1),new d(112,9,9,0,2.25,6.6,145,0,0.95,0,2,4.5,0.0005,1),new d(128,9,9,0,1.95,6.4,140,0,0.95,0,3,4,0.0002,1),new d(160,9,9,1,1.79,6,135,0,0.95,-2,5,3.5,0,1),new d(192,9,9,1,1.49,5.6,125,0,0.97,-4,7,3,0,0),new d(224,9,9,1,1.25,5.2,125,0,0.98,-6,9,2,0,0),new d(256,9,9,1,0.97,5.2,125,0,1,-8,10,1,0,0),new d(320,9,9,1,0.9,5.2,125,0,1,-10,12,0,0,0)];function x(u,h,Q){var H=h,v=W.nearestBitrateFullIndex(h);if(u.VBR=zi.vbr_abr,u.VBR_mean_bitrate_kbps=H,u.VBR_mean_bitrate_kbps=Math.min(u.VBR_mean_bitrate_kbps,320),u.VBR_mean_bitrate_kbps=Math.max(u.VBR_mean_bitrate_kbps,8),u.brate=u.VBR_mean_bitrate_kbps,u.VBR_mean_bitrate_kbps>320&&(u.disable_reservoir=!0),Z[v].safejoint>0&&(u.exp_nspsytune=u.exp_nspsytune|2),Z[v].sfscale>0&&(u.internal_flags.noise_shaping=2),Math.abs(Z[v].nsbass)>0){var B=int(Z[v].nsbass*4);B<0&&(B+=64),u.exp_nspsytune=u.exp_nspsytune|B<<2}return Q!=0?u.quant_comp=Z[v].quant_comp:Math.abs(u.quant_comp- -1)>0||(u.quant_comp=Z[v].quant_comp),Q!=0?u.quant_comp_short=Z[v].quant_comp_s:Math.abs(u.quant_comp_short- -1)>0||(u.quant_comp_short=Z[v].quant_comp_s),Q!=0?u.msfix=Z[v].nsmsfix:Math.abs(u.msfix- -1)>0||(u.msfix=Z[v].nsmsfix),Q!=0?u.internal_flags.nsPsy.attackthre=Z[v].st_lrm:Math.abs(u.internal_flags.nsPsy.attackthre- -1)>0||(u.internal_flags.nsPsy.attackthre=Z[v].st_lrm),Q!=0?u.internal_flags.nsPsy.attackthre_s=Z[v].st_s:Math.abs(u.internal_flags.nsPsy.attackthre_s- -1)>0||(u.internal_flags.nsPsy.attackthre_s=Z[v].st_s),Q!=0?u.scale=Z[v].scale:Math.abs(u.scale- -1)>0||(u.scale=Z[v].scale),Q!=0?u.maskingadjust=Z[v].masking_adj:Math.abs(u.maskingadjust-0)>0||(u.maskingadjust=Z[v].masking_adj),Z[v].masking_adj>0?Q!=0?u.maskingadjust_short=Z[v].masking_adj*0.9:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=Z[v].masking_adj*0.9):Q!=0?u.maskingadjust_short=Z[v].masking_adj*1.1:Math.abs(u.maskingadjust_short-0)>0||(u.maskingadjust_short=Z[v].masking_adj*1.1),Q!=0?u.ATHlower=-Z[v].ath_lower/10:Math.abs(-u.ATHlower*10-0)>0||(u.ATHlower=-Z[v].ath_lower/10),Q!=0?u.ATHcurve=Z[v].ath_curve:Math.abs(u.ATHcurve- -1)>0||(u.ATHcurve=Z[v].ath_curve),Q!=0?u.interChRatio=Z[v].interch:Math.abs(u.interChRatio- -1)>0||(u.interChRatio=Z[v].interch),h}this.apply_preset=function(u,h,Q){switch(h){case t.R3MIX:{h=t.V3,u.VBR=zi.vbr_mtrh;break}case t.MEDIUM:{h=t.V4,u.VBR=zi.vbr_rh;break}case t.MEDIUM_FAST:{h=t.V4,u.VBR=zi.vbr_mtrh;break}case t.STANDARD:{h=t.V2,u.VBR=zi.vbr_rh;break}case t.STANDARD_FAST:{h=t.V2,u.VBR=zi.vbr_mtrh;break}case t.EXTREME:{h=t.V0,u.VBR=zi.vbr_rh;break}case t.EXTREME_FAST:{h=t.V0,u.VBR=zi.vbr_mtrh;break}case t.INSANE:return h=320,u.preset=h,x(u,h,Q),u.VBR=zi.vbr_off,h}switch(u.preset=h,h){case t.V9:return L(u,9,Q),h;case t.V8:return L(u,8,Q),h;case t.V7:return L(u,7,Q),h;case t.V6:return L(u,6,Q),h;case t.V5:return L(u,5,Q),h;case t.V4:return L(u,4,Q),h;case t.V3:return L(u,3,Q),h;case t.V2:return L(u,2,Q),h;case t.V1:return L(u,1,Q),h;case t.V0:return L(u,0,Q),h}return 8<=h&&h<=320?x(u,h,Q):(u.preset=0,h)};function A(u,h){var Q=0;return 0>h&&(Q=-1,h=0),9<h&&(Q=-1,h=9),u.VBR_q=h,u.VBR_q_frac=0,Q}}var vr=br;function Vr(){this.setModules=function(t,r){}}var Tr=Vr;function Nr(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Sr=Nr,me=Ht,xo=me.new_float,Er=me.new_int;function Hr(){this.global_gain=0,this.sfb_count1=0,this.step=Er(39),this.noise=xo(39),this.noise_log=xo(39)}var Ir=Hr,Ii=Ht,Fi=Ii.System,bo=Ii.VbrMode,En=Ii.Util,Ei=Ii.Arrays,sn=Ii.new_float,dn=Ii.assert,_r=Tr,Hn=Sr,Br=Ir,bt=ri(),vo=_n,Vo=Wn;function Rr(){var t;this.rv=null;var r;this.qupvt=null;var d,W=new _r,O;this.setModules=function(D,g,C,P){t=D,r=g,this.rv=g,d=C,this.qupvt=C,O=P,W.setModules(d,O)},this.ms_convert=function(D,g){for(var C=0;C<576;++C){var P=D.tt[g][0].xr[C],i=D.tt[g][1].xr[C];D.tt[g][0].xr[C]=(P+i)*(En.SQRT2*0.5),D.tt[g][1].xr[C]=(P-i)*(En.SQRT2*0.5)}};function j(D,g,C,P){P=0;for(var i=0;i<=C;++i){var a=Math.abs(D.xr[i]);P+=a,g[i]=Math.sqrt(a*Math.sqrt(a)),g[i]>D.xrpow_max&&(D.xrpow_max=g[i])}return P}this.init_xrpow=function(D,g,C){var P=0,i=0|g.max_nonzero_coeff;if(g.xrpow_max=0,Ei.fill(C,i,576,0),P=j(g,C,i,P),P>0.00000000000000000001){var a=0;D.substep_shaping&2&&(a=1);for(var z=0;z<g.psymax;z++)D.pseudohalf[z]=a;return!0}return Ei.fill(g.l3_enc,0,576,0),!1};function L(D,g){var C=D.ATH,P=g.xr;if(g.block_type!=bt.SHORT_TYPE)for(var i=!1,a=bt.PSFB21-1;a>=0&&!i;a--){var z=D.scalefac_band.psfb21[a],U=D.scalefac_band.psfb21[a+1],b=d.athAdjust(C.adjust,C.psfb21[a],C.floor);D.nsPsy.longfact[21]>0.000000000001&&(b*=D.nsPsy.longfact[21]);for(var F=U-1;F>=z;F--)if(Math.abs(P[F])<b)P[F]=0;else{i=!0;break}}else for(var M=0;M<3;M++)for(var i=!1,a=bt.PSFB12-1;a>=0&&!i;a--){var z=D.scalefac_band.s[12]*3+(D.scalefac_band.s[13]-D.scalefac_band.s[12])*M+(D.scalefac_band.psfb12[a]-D.scalefac_band.psfb12[0]),U=z+(D.scalefac_band.psfb12[a+1]-D.scalefac_band.psfb12[a]),at=d.athAdjust(C.adjust,C.psfb12[a],C.floor);D.nsPsy.shortfact[12]>0.000000000001&&(at*=D.nsPsy.shortfact[12]);for(var F=U-1;F>=z;F--)if(Math.abs(P[F])<at)P[F]=0;else{i=!0;break}}}this.init_outer_loop=function(D,g){g.part2_3_length=0,g.big_values=0,g.count1=0,g.global_gain=210,g.scalefac_compress=0,g.table_select[0]=0,g.table_select[1]=0,g.table_select[2]=0,g.subblock_gain[0]=0,g.subblock_gain[1]=0,g.subblock_gain[2]=0,g.subblock_gain[3]=0,g.region0_count=0,g.region1_count=0,g.preflag=0,g.scalefac_scale=0,g.count1table_select=0,g.part2_length=0,g.sfb_lmax=bt.SBPSY_l,g.sfb_smin=bt.SBPSY_s,g.psy_lmax=D.sfb21_extra?bt.SBMAX_l:bt.SBPSY_l,g.psymax=g.psy_lmax,g.sfbmax=g.sfb_lmax,g.sfbdivide=11;for(var C=0;C<bt.SBMAX_l;C++)g.width[C]=D.scalefac_band.l[C+1]-D.scalefac_band.l[C],g.window[C]=3;if(g.block_type==bt.SHORT_TYPE){var P=sn(576);g.sfb_smin=0,g.sfb_lmax=0,g.mixed_block_flag!=0&&(g.sfb_smin=3,g.sfb_lmax=D.mode_gr*2+4),g.psymax=g.sfb_lmax+3*((D.sfb21_extra?bt.SBMAX_s:bt.SBPSY_s)-g.sfb_smin),g.sfbmax=g.sfb_lmax+3*(bt.SBPSY_s-g.sfb_smin),g.sfbdivide=g.sfbmax-18,g.psy_lmax=g.sfb_lmax;var i=D.scalefac_band.l[g.sfb_lmax];Fi.arraycopy(g.xr,0,P,0,576);for(var C=g.sfb_smin;C<bt.SBMAX_s;C++)for(var a=D.scalefac_band.s[C],z=D.scalefac_band.s[C+1],U=0;U<3;U++)for(var b=a;b<z;b++)g.xr[i++]=P[3*b+U];for(var{sfb_lmax:F,sfb_smin:C}=g;C<bt.SBMAX_s;C++)g.width[F]=g.width[F+1]=g.width[F+2]=D.scalefac_band.s[C+1]-D.scalefac_band.s[C],g.window[F]=0,g.window[F+1]=1,g.window[F+2]=2,F+=3}g.count1bits=0,g.sfb_partition_table=d.nr_of_sfb_block[0][0],g.slen[0]=0,g.slen[1]=0,g.slen[2]=0,g.slen[3]=0,g.max_nonzero_coeff=575,Ei.fill(g.scalefac,0),L(D,g)};function Z(D){this.ordinal=D}Z.BINSEARCH_NONE=new Z(0),Z.BINSEARCH_UP=new Z(1),Z.BINSEARCH_DOWN=new Z(2);function x(D,g,C,P,i){var a,z=D.CurrentStep[P],U=!1,b=D.OldValue[P],F=Z.BINSEARCH_NONE;for(g.global_gain=b,C-=g.part2_length;;){var M;if(a=O.count_bits(D,i,g,null),z==1||a==C)break;a>C?(F==Z.BINSEARCH_DOWN&&(U=!0),U&&(z/=2),F=Z.BINSEARCH_UP,M=z):(F==Z.BINSEARCH_UP&&(U=!0),U&&(z/=2),F=Z.BINSEARCH_DOWN,M=-z),g.global_gain+=M,g.global_gain<0&&(g.global_gain=0,U=!0),g.global_gain>255&&(g.global_gain=255,U=!0)}for(dn(g.global_gain>=0),dn(g.global_gain<256);a>C&&g.global_gain<255;)g.global_gain++,a=O.count_bits(D,i,g,null);return D.CurrentStep[P]=b-g.global_gain>=4?4:2,D.OldValue[P]=g.global_gain,g.part2_3_length=a,a}this.trancate_smallspectrums=function(D,g,C,P){var i=sn(Vo.SFBMAX);if(!(!(D.substep_shaping&4)&&g.block_type==bt.SHORT_TYPE||D.substep_shaping&128)){d.calc_noise(g,C,i,new Hn,null);for(var z=0;z<576;z++){var a=0;g.l3_enc[z]!=0&&(a=Math.abs(g.xr[z])),P[z]=a}var z=0,U=8;g.block_type==bt.SHORT_TYPE&&(U=6);do{var b,F,M,at,k=g.width[U];if(z+=k,!(i[U]>=1)&&(Ei.sort(P,z-k,k),!BitStream.EQ(P[z-1],0))){b=(1-i[U])*C[U],F=0,at=0;do{var n;for(M=1;at+M<k&&!BitStream.NEQ(P[at+z-k],P[at+z+M-k]);M++);if(n=P[at+z-k]*P[at+z-k]*M,b<n){at!=0&&(F=P[at+z-k-1]);break}b-=n,at+=M}while(at<k);if(!BitStream.EQ(F,0))do Math.abs(g.xr[z-k])<=F&&(g.l3_enc[z-k]=0);while(--k>0)}}while(++U<g.psymax);g.part2_3_length=O.noquant_count_bits(D,g,null)}};function A(D){for(var g=0;g<D.sfbmax;g++)if(D.scalefac[g]+D.subblock_gain[D.window[g]]==0)return!1;return!0}function u(D){return En.FAST_LOG10(0.368+0.632*D*D*D)}function h(D,g){for(var C=0.0000000000000000000000000000000000001,P=0;P<g.psymax;P++)C+=u(D[P]);return Math.max(0.00000000000000000001,C)}function Q(D,g,C,P,i){var a;switch(D){default:case 9:{g.over_count>0?(a=C.over_SSD<=g.over_SSD,C.over_SSD==g.over_SSD&&(a=C.bits<g.bits)):a=C.max_noise<0&&C.max_noise*10+C.bits<=g.max_noise*10+g.bits;break}case 0:a=C.over_count<g.over_count||C.over_count==g.over_count&&C.over_noise<g.over_noise||C.over_count==g.over_count&&BitStream.EQ(C.over_noise,g.over_noise)&&C.tot_noise<g.tot_noise;break;case 8:C.max_noise=h(i,P);case 1:a=C.max_noise<g.max_noise;break;case 2:a=C.tot_noise<g.tot_noise;break;case 3:a=C.tot_noise<g.tot_noise&&C.max_noise<g.max_noise;break;case 4:a=C.max_noise<=0&&g.max_noise>0.2||C.max_noise<=0&&g.max_noise<0&&g.max_noise>C.max_noise-0.2&&C.tot_noise<g.tot_noise||C.max_noise<=0&&g.max_noise>0&&g.max_noise>C.max_noise-0.2&&C.tot_noise<g.tot_noise+g.over_noise||C.max_noise>0&&g.max_noise>-0.05&&g.max_noise>C.max_noise-0.1&&C.tot_noise+C.over_noise<g.tot_noise+g.over_noise||C.max_noise>0&&g.max_noise>-0.1&&g.max_noise>C.max_noise-0.15&&C.tot_noise+C.over_noise+C.over_noise<g.tot_noise+g.over_noise+g.over_noise;break;case 5:a=C.over_noise<g.over_noise||BitStream.EQ(C.over_noise,g.over_noise)&&C.tot_noise<g.tot_noise;break;case 6:a=C.over_noise<g.over_noise||BitStream.EQ(C.over_noise,g.over_noise)&&(C.max_noise<g.max_noise||BitStream.EQ(C.max_noise,g.max_noise)&&C.tot_noise<=g.tot_noise);break;case 7:a=C.over_count<g.over_count||C.over_noise<g.over_noise;break}return g.over_count==0&&(a=a&&C.bits<g.bits),a}function H(D,g,C,P,i){var a=D.internal_flags,z;g.scalefac_scale==0?z=1.2968395546510096:z=1.6817928305074292;for(var U=0,b=0;b<g.sfbmax;b++)U<C[b]&&(U=C[b]);var F=a.noise_shaping_amp;switch(F==3&&(i?F=2:F=1),F){case 2:break;case 1:U>1?U=Math.pow(U,0.5):U*=0.95;break;case 0:default:U>1?U=1:U*=0.95;break}for(var M=0,b=0;b<g.sfbmax;b++){var at=g.width[b],k;if(M+=at,!(C[b]<U)){if(a.substep_shaping&2&&(a.pseudohalf[b]=a.pseudohalf[b]==0?1:0,a.pseudohalf[b]==0&&a.noise_shaping_amp==2))return;for(g.scalefac[b]++,k=-at;k<0;k++)P[M+k]*=z,P[M+k]>g.xrpow_max&&(g.xrpow_max=P[M+k]);if(a.noise_shaping_amp==2)return}}}function v(D,g){for(var C=1.2968395546510096,P=0,i=0;i<D.sfbmax;i++){var a=D.width[i],z=D.scalefac[i];if(D.preflag!=0&&(z+=d.pretab[i]),P+=a,z&1){z++;for(var U=-a;U<0;U++)g[P+U]*=C,g[P+U]>D.xrpow_max&&(D.xrpow_max=g[P+U])}D.scalefac[i]=z>>1}D.preflag=0,D.scalefac_scale=1}function B(D,g,C){var P,i=g.scalefac;for(P=0;P<g.sfb_lmax;P++)if(i[P]>=16)return!0;for(var a=0;a<3;a++){var z=0,U=0;for(P=g.sfb_lmax+a;P<g.sfbdivide;P+=3)z<i[P]&&(z=i[P]);for(;P<g.sfbmax;P+=3)U<i[P]&&(U=i[P]);if(!(z<16&&U<8)){if(g.subblock_gain[a]>=7)return!0;g.subblock_gain[a]++;var b=D.scalefac_band.l[g.sfb_lmax];for(P=g.sfb_lmax+a;P<g.sfbmax;P+=3){var F,M=g.width[P],at=i[P];if(at=at-(4>>g.scalefac_scale),at>=0){i[P]=at,b+=M*3;continue}i[P]=0;{var k=210+(at<<g.scalefac_scale+1);F=d.IPOW20(k)}b+=M*(a+1);for(var n=-M;n<0;n++)C[b+n]*=F,C[b+n]>g.xrpow_max&&(g.xrpow_max=C[b+n]);b+=M*(3-a-1)}{var F=d.IPOW20(202);b+=g.width[P]*(a+1);for(var n=-g.width[P];n<0;n++)C[b+n]*=F,C[b+n]>g.xrpow_max&&(g.xrpow_max=C[b+n])}}}return!1}function S(D,g,C,P,i){var a=D.internal_flags;H(D,g,C,P,i);var z=A(g);return z?!1:(a.mode_gr==2?z=O.scale_bitcount(g):z=O.scale_bitcount_lsf(a,g),z?(a.noise_shaping>1&&(Ei.fill(a.pseudohalf,0),g.scalefac_scale==0?(v(g,P),z=!1):g.block_type==bt.SHORT_TYPE&&a.subblock_gain>0&&(z=B(a,g,P)||A(g))),z||(a.mode_gr==2?z=O.scale_bitcount(g):z=O.scale_bitcount_lsf(a,g)),!z):!0)}this.outer_loop=function(D,g,C,P,i,a){var z=D.internal_flags,U=new vo,b=sn(576),F=sn(Vo.SFBMAX),M=new Hn,at,k=new Br,n=9999999,G=!1,K=!1,V=0;if(x(z,g,a,i,P),z.noise_shaping==0)return 100;d.calc_noise(g,C,F,M,k),M.bits=g.part2_3_length,U.assign(g);var q=0;for(Fi.arraycopy(P,0,b,0,576);!G;){do{var it=new Hn,$,l=255;if(z.substep_shaping&2?$=20:$=3,z.sfb21_extra&&(F[U.sfbmax]>1||U.block_type==bt.SHORT_TYPE&&(F[U.sfbmax+1]>1||F[U.sfbmax+2]>1))||!S(D,U,F,P,K))break;U.scalefac_scale!=0&&(l=254);var s=a-U.part2_length;if(s<=0)break;for(;(U.part2_3_length=O.count_bits(z,P,U,k))>s&&U.global_gain<=l;)U.global_gain++;if(U.global_gain>l)break;if(M.over_count==0){for(;(U.part2_3_length=O.count_bits(z,P,U,k))>n&&U.global_gain<=l;)U.global_gain++;if(U.global_gain>l)break}if(d.calc_noise(U,C,F,it,k),it.bits=U.part2_3_length,g.block_type!=bt.SHORT_TYPE?at=D.quant_comp:at=D.quant_comp_short,at=Q(at,M,it,U,F)?1:0,at!=0)n=g.part2_3_length,M=it,g.assign(U),q=0,Fi.arraycopy(P,0,b,0,576);else if(z.full_outer_loop==0&&(++q>$&&M.over_count==0||z.noise_shaping_amp==3&&K&&q>30||z.noise_shaping_amp==3&&K&&U.global_gain-V>15))break}while(U.global_gain+U.scalefac_scale<255);z.noise_shaping_amp==3?K?G=!0:(U.assign(g),Fi.arraycopy(b,0,P,0,576),q=0,V=U.global_gain,K=!0):G=!0}return dn(g.global_gain+g.scalefac_scale<=255),D.VBR==bo.vbr_rh||D.VBR==bo.vbr_mtrh?Fi.arraycopy(b,0,P,0,576):z.substep_shaping&1&&trancate_smallspectrums(z,g,C,P),M.over_count},this.iteration_finish_one=function(D,g,C){var P=D.l3_side,i=P.tt[g][C];O.best_scalefac_store(D,g,C,P),D.use_best_huffman==1&&O.best_huffman_divide(D,i),r.ResvAdjust(D,i)},this.VBR_encode_granule=function(D,g,C,P,i,a,z){var U=D.internal_flags,b=new vo,F=sn(576),M=z,at=z+1,k=(z+a)/2,n,G,K=0,V=U.sfb21_extra;dn(M<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Ei.fill(b.l3_enc,0);do k>M-42?U.sfb21_extra=!1:U.sfb21_extra=V,G=outer_loop(D,g,C,P,i,k),G<=0?(K=1,at=g.part2_3_length,b.assign(g),Fi.arraycopy(P,0,F,0,576),z=at-32,n=z-a,k=(z+a)/2):(a=k+32,n=z-a,k=(z+a)/2,K!=0&&(K=2,g.assign(b),Fi.arraycopy(F,0,P,0,576)));while(n>12);U.sfb21_extra=V,K==2&&Fi.arraycopy(b.l3_enc,0,g.l3_enc,0,576),dn(g.part2_3_length<=M)},this.get_framebits=function(D,g){var C=D.internal_flags;C.bitrate_index=C.VBR_min_bitrate;var P=t.getframebits(D);C.bitrate_index=1,P=t.getframebits(D);for(var i=1;i<=C.VBR_max_bitrate;i++){C.bitrate_index=i;var a=new MeanBits(P);g[i]=r.ResvFrameBegin(D,a),P=a.bits}},this.VBR_old_prepare=function(D,g,C,P,i,a,z,U,b){var F=D.internal_flags,M,at=0,k=1,n=0;F.bitrate_index=F.VBR_max_bitrate;var G=r.ResvFrameBegin(D,new MeanBits(0))/F.mode_gr;get_framebits(D,a);for(var K=0;K<F.mode_gr;K++){var V=d.on_pe(D,g,U[K],G,K,0);F.mode_ext==bt.MPG_MD_MS_LR&&(ms_convert(F.l3_side,K),d.reduce_side(U[K],C[K],G,V));for(var q=0;q<F.channels_out;++q){var it=F.l3_side.tt[K][q];it.block_type!=bt.SHORT_TYPE?(at=1.28/(1+Math.exp(3.5-g[K][q]/300))-0.05,M=F.PSY.mask_adjust-at):(at=2.56/(1+Math.exp(3.5-g[K][q]/300))-0.14,M=F.PSY.mask_adjust_short-at),F.masking_lower=Math.pow(10,M*0.1),init_outer_loop(F,it),b[K][q]=d.calc_xmin(D,P[K][q],it,i[K][q]),b[K][q]!=0&&(k=0),z[K][q]=126,n+=U[K][q]}}for(var K=0;K<F.mode_gr;K++)for(var q=0;q<F.channels_out;q++)n>a[F.VBR_max_bitrate]&&(U[K][q]*=a[F.VBR_max_bitrate],U[K][q]/=n),z[K][q]>U[K][q]&&(z[K][q]=U[K][q]);return k},this.bitpressure_strategy=function(D,g,C,P){for(var i=0;i<D.mode_gr;i++)for(var a=0;a<D.channels_out;a++){for(var z=D.l3_side.tt[i][a],U=g[i][a],b=0,F=0;F<z.psy_lmax;F++)U[b++]*=1+0.029*F*F/bt.SBMAX_l/bt.SBMAX_l;if(z.block_type==bt.SHORT_TYPE)for(var F=z.sfb_smin;F<bt.SBMAX_s;F++)U[b++]*=1+0.029*F*F/bt.SBMAX_s/bt.SBMAX_s,U[b++]*=1+0.029*F*F/bt.SBMAX_s/bt.SBMAX_s,U[b++]*=1+0.029*F*F/bt.SBMAX_s/bt.SBMAX_s;P[i][a]=0|Math.max(C[i][a],0.9*P[i][a])}},this.VBR_new_prepare=function(D,g,C,P,i,a){var z=D.internal_flags,U=1,b=0,F=0,M;if(D.free_format){z.bitrate_index=0;var at=new MeanBits(b);M=r.ResvFrameBegin(D,at),b=at.bits,i[0]=M}else{z.bitrate_index=z.VBR_max_bitrate;var at=new MeanBits(b);r.ResvFrameBegin(D,at),b=at.bits,get_framebits(D,i),M=i[z.VBR_max_bitrate]}for(var k=0;k<z.mode_gr;k++){d.on_pe(D,g,a[k],b,k,0),z.mode_ext==bt.MPG_MD_MS_LR&&ms_convert(z.l3_side,k);for(var n=0;n<z.channels_out;++n){var G=z.l3_side.tt[k][n];z.masking_lower=Math.pow(10,z.PSY.mask_adjust*0.1),init_outer_loop(z,G),d.calc_xmin(D,C[k][n],G,P[k][n])!=0&&(U=0),F+=a[k][n]}}for(var k=0;k<z.mode_gr;k++)for(var n=0;n<z.channels_out;n++)F>M&&(a[k][n]*=M,a[k][n]/=F);return U},this.calc_target_bits=function(D,g,C,P,i,a){var z=D.internal_flags,U=z.l3_side,b,F,M,at,k=0;z.bitrate_index=z.VBR_max_bitrate;var n=new MeanBits(k);for(a[0]=r.ResvFrameBegin(D,n),k=n.bits,z.bitrate_index=1,k=t.getframebits(D)-z.sideinfo_len*8,i[0]=k/(z.mode_gr*z.channels_out),k=D.VBR_mean_bitrate_kbps*D.framesize*1000,z.substep_shaping&1&&(k*=1.09),k/=D.out_samplerate,k-=z.sideinfo_len*8,k/=z.mode_gr*z.channels_out,b=0.93+0.07*(11-D.compression_ratio)/5.5,b<0.9&&(b=0.9),b>1&&(b=1),F=0;F<z.mode_gr;F++){var G=0;for(M=0;M<z.channels_out;M++){if(P[F][M]=int(b*k),g[F][M]>700){var K=int((g[F][M]-700)/1.4),V=U.tt[F][M];P[F][M]=int(b*k),V.block_type==bt.SHORT_TYPE&&K<k/2&&(K=k/2),K>k*3/2?K=k*3/2:K<0&&(K=0),P[F][M]+=K}P[F][M]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[F][M]=LameInternalFlags.MAX_BITS_PER_CHANNEL),G+=P[F][M]}if(G>LameInternalFlags.MAX_BITS_PER_GRANULE)for(M=0;M<z.channels_out;++M)P[F][M]*=LameInternalFlags.MAX_BITS_PER_GRANULE,P[F][M]/=G}if(z.mode_ext==bt.MPG_MD_MS_LR)for(F=0;F<z.mode_gr;F++)d.reduce_side(P[F],C[F],k*z.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(at=0,F=0;F<z.mode_gr;F++)for(M=0;M<z.channels_out;M++)P[F][M]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[F][M]=LameInternalFlags.MAX_BITS_PER_CHANNEL),at+=P[F][M];if(at>a[0])for(F=0;F<z.mode_gr;F++)for(M=0;M<z.channels_out;M++)P[F][M]*=a[0],P[F][M]/=at}}var Ar=Rr,ts=Ht,To=ts.assert;function is(){var t;this.setModules=function(r){t=r},this.ResvFrameBegin=function(r,d){var W=r.internal_flags,O,j=W.l3_side,L=t.getframebits(r);d.bits=(L-W.sideinfo_len*8)/W.mode_gr;var Z=2048*W.mode_gr-8;r.brate>320?O=8*int(r.brate*1000/(r.out_samplerate/1152)/8+0.5):(O=11520,r.strict_ISO&&(O=8*int(320000/(r.out_samplerate/1152)/8+0.5))),W.ResvMax=O-L,W.ResvMax>Z&&(W.ResvMax=Z),(W.ResvMax<0||r.disable_reservoir)&&(W.ResvMax=0);var x=d.bits*W.mode_gr+Math.min(W.ResvSize,W.ResvMax);return x>O&&(x=O),To(W.ResvMax%8==0),To(W.ResvMax>=0),j.resvDrain_pre=0,W.pinfo!=null&&(W.pinfo.mean_bits=d.bits/2,W.pinfo.resvsize=W.ResvSize),x},this.ResvMaxBits=function(r,d,W,O){var j=r.internal_flags,L,Z=j.ResvSize,x=j.ResvMax;O!=0&&(Z+=d),j.substep_shaping&1&&(x*=0.9),W.bits=d,Z*10>x*9?(L=Z-x*9/10,W.bits+=L,j.substep_shaping|=128):(L=0,j.substep_shaping&=127,!r.disable_reservoir&&!(j.substep_shaping&1)&&(W.bits-=0.1*d));var A=Z<j.ResvMax*6/10?Z:j.ResvMax*6/10;return A-=L,A<0&&(A=0),A},this.ResvAdjust=function(r,d){r.ResvSize-=d.part2_3_length+d.part2_length},this.ResvFrameEnd=function(r,d){var W,O=r.l3_side;r.ResvSize+=d*r.mode_gr;var j=0;O.resvDrain_post=0,O.resvDrain_pre=0,(W=r.ResvSize%8)!=0&&(j+=W),W=r.ResvSize-j-r.ResvMax,W>0&&(j+=W);{var L=Math.min(O.main_data_begin*8,j)/8;O.resvDrain_pre+=8*L,j-=8*L,r.ResvSize-=8*L,O.main_data_begin-=L}O.resvDrain_post+=j,r.ResvSize-=j}}var ns=is;function os(){var t="http://www.mp3dev.org/",r=3,d=98,W=4,O=0,j=93;this.getLameVersion=function(){return r+"."+d+"."+W},this.getLameShortVersion=function(){return r+"."+d+"."+W},this.getLameVeryShortVersion=function(){return"LAME"+r+"."+d+"r"},this.getPsyVersion=function(){return O+"."+j},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var es=os,_i=Ht,rs=_i.System,In=_i.VbrMode,No=_i.ShortBlock,ss=_i.Arrays,fn=_i.new_byte,ds=_i.assert;hn.NUMTOCENTRIES=100;hn.MAXFRAMESIZE=2880;function hn(){var t,r,d;this.setModules=function(k,n,G){t=k,r=n,d=G};var W=1,O=2,j=4,L=8,Z=hn.NUMTOCENTRIES,x=hn.MAXFRAMESIZE,A=Z+4+4+4+4+4,u=A+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,Q=64,H=32,v=null,B="Xing",S="Info",D=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8000,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16000,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32000,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function g(k,n){if(k.nVbrNumFrames++,k.sum+=n,k.seen++,!(k.seen<k.want)&&(k.pos<k.size&&(k.bag[k.pos]=k.sum,k.pos++,k.seen=0),k.pos==k.size)){for(var G=1;G<k.size;G+=2)k.bag[G/2]=k.bag[G];k.want*=2,k.pos/=2}}function C(k,n){if(!(k.pos<=0))for(var G=1;G<Z;++G){var K=G/Z,V,q,it=0|Math.floor(K*k.pos);it>k.pos-1&&(it=k.pos-1),V=k.bag[it],q=k.sum;var $=0|256*V/q;$>255&&($=255),n[G]=255&$}}this.addVbrFrame=function(k){var n=k.internal_flags,G=Tables.bitrate_table[k.version][n.bitrate_index];ds(n.VBR_seek_table.bag!=null),g(n.VBR_seek_table,G)};function P(k,n){var G=k[n+0]&255;return G<<=8,G|=k[n+1]&255,G<<=8,G|=k[n+2]&255,G<<=8,G|=k[n+3]&255,G}function i(k,n,G){k[n+0]=255&(G>>24&255),k[n+1]=255&(G>>16&255),k[n+2]=255&(G>>8&255),k[n+3]=255&(G&255)}function a(k,n,G){k[n+0]=255&(G>>8&255),k[n+1]=255&(G&255)}function z(k,n){return new String(k,n,B.length(),v).equals(B)||new String(k,n,S.length(),v).equals(S)}function U(k,n,G){return 255&(k<<n|G&~(-1<<n))}function b(k,n){var G=k.internal_flags;n[0]=U(n[0],8,255),n[1]=U(n[1],3,7),n[1]=U(n[1],1,k.out_samplerate<16000?0:1),n[1]=U(n[1],1,k.version),n[1]=U(n[1],2,1),n[1]=U(n[1],1,k.error_protection?0:1),n[2]=U(n[2],4,G.bitrate_index),n[2]=U(n[2],2,G.samplerate_index),n[2]=U(n[2],1,0),n[2]=U(n[2],1,k.extension),n[3]=U(n[3],2,k.mode.ordinal()),n[3]=U(n[3],2,G.mode_ext),n[3]=U(n[3],1,k.copyright),n[3]=U(n[3],1,k.original),n[3]=U(n[3],2,k.emphasis),n[0]=255;var K=255&(n[1]&241),V;k.version==1?V=h:k.out_samplerate<16000?V=H:V=Q,k.VBR==In.vbr_off&&(V=k.brate);var q;k.free_format?q=0:q=255&16*t.BitrateIndex(V,k.version,k.out_samplerate),k.version==1?(n[1]=255&(K|10),K=255&(n[2]&13),n[2]=255&(q|K)):(n[1]=255&(K|2),K=255&(n[2]&13),n[2]=255&(q|K))}this.getVbrTag=function(k){var n=new VBRTagData,G=0;n.flags=0;var K=k[G+1]>>3&1,V=k[G+2]>>2&3,q=k[G+3]>>6&3,it=k[G+2]>>4&15;if(it=Tables.bitrate_table[K][it],k[G+1]>>4==14?n.samprate=Tables.samplerate_table[2][V]:n.samprate=Tables.samplerate_table[K][V],K!=0?q!=3?G+=36:G+=21:q!=3?G+=21:G+=13,!z(k,G))return null;G+=4,n.hId=K;var $=n.flags=P(k,G);if(G+=4,$&W&&(n.frames=P(k,G),G+=4),$&O&&(n.bytes=P(k,G),G+=4),$&j){if(n.toc!=null)for(var l=0;l<Z;l++)n.toc[l]=k[G+l];G+=Z}n.vbrScale=-1,$&L&&(n.vbrScale=P(k,G),G+=4),n.headersize=(K+1)*72000*it/n.samprate,G+=21;var s=k[G+0]<<4;s+=k[G+1]>>4;var o=(k[G+1]&15)<<8;return o+=k[G+2]&255,(s<0||s>3000)&&(s=-1),(o<0||o>3000)&&(o=-1),n.encDelay=s,n.encPadding=o,n},this.InitVbrTag=function(k){var n=k.internal_flags,G;k.version==1?G=h:k.out_samplerate<16000?G=H:G=Q,k.VBR==In.vbr_off&&(G=k.brate);var K=(k.version+1)*72000*G/k.out_samplerate,V=n.sideinfo_len+u;if(n.VBR_seek_table.TotalFrameSize=K,K<V||K>x){k.bWriteVbrTag=!1;return}n.VBR_seek_table.nVbrNumFrames=0,n.VBR_seek_table.nBytesWritten=0,n.VBR_seek_table.sum=0,n.VBR_seek_table.seen=0,n.VBR_seek_table.want=1,n.VBR_seek_table.pos=0,n.VBR_seek_table.bag==null&&(n.VBR_seek_table.bag=new int[400],n.VBR_seek_table.size=400);var q=fn(x);b(k,q);for(var it=n.VBR_seek_table.TotalFrameSize,$=0;$<it;++$)r.add_dummy_byte(k,q[$]&255,1)};function F(k,n){var G=n^k;return n=n>>8^D[G&255],n}this.updateMusicCRC=function(k,n,G,K){for(var V=0;V<K;++V)k[0]=F(n[G+V],k[0])};function M(k,n,G,K,V){var q=k.internal_flags,it=0,$=k.encoder_delay,l=k.encoder_padding,s=100-10*k.VBR_q-k.quality,o=d.getLameVeryShortVersion(),c,f=0,I,ot=[1,5,3,2,4,0,3],y=0|(k.lowpassfreq/100+0.5>255?255:k.lowpassfreq/100+0.5),_=0,dt=0,ut=0,ft=k.internal_flags.noise_shaping,Dt=0,Wt=0,Pt=0,Zt=0,Vt=0,mi=(k.exp_nspsytune&1)!=0,e=(k.exp_nspsytune&2)!=0,p=!1,Ct=!1,Jt=k.internal_flags.nogap_total,Xt=k.internal_flags.nogap_current,yt=k.ATHtype,zt=0,Yt;switch(k.VBR){case vbr_abr:Yt=k.VBR_mean_bitrate_kbps;break;case vbr_off:Yt=k.brate;break;default:Yt=k.VBR_min_bitrate_kbps}switch(k.VBR.ordinal()<ot.length?c=ot[k.VBR.ordinal()]:c=0,I=16*f+c,q.findReplayGain&&(q.RadioGain>510&&(q.RadioGain=510),q.RadioGain<-510&&(q.RadioGain=-510),dt=8192,dt|=3072,q.RadioGain>=0?dt|=q.RadioGain:(dt|=512,dt|=-q.RadioGain)),q.findPeakSample&&(_=Math.abs(0|q.PeakSample/32767*Math.pow(2,23)+0.5)),Jt!=-1&&(Xt>0&&(Ct=!0),Xt<Jt-1&&(p=!0)),zt=yt+((mi?1:0)<<4)+((e?1:0)<<5)+((p?1:0)<<6)+((Ct?1:0)<<7),s<0&&(s=0),k.mode){case MONO:Dt=0;break;case STEREO:Dt=1;break;case DUAL_CHANNEL:Dt=2;break;case JOINT_STEREO:k.force_ms?Dt=4:Dt=3;break;case NOT_SET:default:Dt=7;break}k.in_samplerate<=32000?Pt=0:k.in_samplerate==48000?Pt=2:k.in_samplerate>48000?Pt=3:Pt=1,(k.short_blocks==No.short_block_forced||k.short_blocks==No.short_block_dispensed||k.lowpassfreq==-1&&k.highpassfreq==-1||k.scale_left<k.scale_right||k.scale_left>k.scale_right||k.disable_reservoir&&k.brate<320||k.noATH||k.ATHonly||yt==0||k.in_samplerate<=32000)&&(Wt=1),Zt=ft+(Dt<<2)+(Wt<<5)+(Pt<<6),Vt=q.nMusicCRC,i(G,K+it,s),it+=4;for(var Kt=0;Kt<9;Kt++)G[K+it+Kt]=255&o.charAt(Kt);it+=9,G[K+it]=255&I,it++,G[K+it]=255&y,it++,i(G,K+it,_),it+=4,a(G,K+it,dt),it+=2,a(G,K+it,ut),it+=2,G[K+it]=255&zt,it++,Yt>=255?G[K+it]=255:G[K+it]=255&Yt,it++,G[K+it]=255&$>>4,G[K+it+1]=255&($<<4)+(l>>8),G[K+it+2]=255&l,it+=3,G[K+it]=255&Zt,it++,G[K+it++]=0,a(G,K+it,k.preset),it+=2,i(G,K+it,n),it+=4,a(G,K+it,Vt),it+=2;for(var jt=0;jt<it;jt++)V=F(G[K+jt],V);return a(G,K+it,V),it+=2,it}function at(k){k.seek(0);var n=fn(10);k.readFully(n);var G;return new String(n,"ISO-8859-1").startsWith("ID3")?G=0:G=((n[6]&127)<<21|(n[7]&127)<<14|(n[8]&127)<<7|n[9]&127)+n.length,G}this.getLameTagFrame=function(k,n){var G=k.internal_flags;if(!k.bWriteVbrTag||G.Class_ID!=Lame.LAME_ID||G.VBR_seek_table.pos<=0)return 0;if(n.length<G.VBR_seek_table.TotalFrameSize)return G.VBR_seek_table.TotalFrameSize;ss.fill(n,0,G.VBR_seek_table.TotalFrameSize,0),b(k,n);var K=fn(Z);if(k.free_format)for(var V=1;V<Z;++V)K[V]=255&255*V/100;else C(G.VBR_seek_table,K);var q=G.sideinfo_len;k.error_protection&&(q-=2),k.VBR==In.vbr_off?(n[q++]=255&S.charAt(0),n[q++]=255&S.charAt(1),n[q++]=255&S.charAt(2),n[q++]=255&S.charAt(3)):(n[q++]=255&B.charAt(0),n[q++]=255&B.charAt(1),n[q++]=255&B.charAt(2),n[q++]=255&B.charAt(3)),i(n,q,W+O+j+L),q+=4,i(n,q,G.VBR_seek_table.nVbrNumFrames),q+=4;var it=G.VBR_seek_table.nBytesWritten+G.VBR_seek_table.TotalFrameSize;i(n,q,0|it),q+=4,rs.arraycopy(K,0,n,q,K.length),q+=K.length,k.error_protection&&r.CRC_writeheader(G,n);for(var $=0,V=0;V<q;V++)$=F(n[V],$);return q+=M(k,it,n,q,$),G.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(k,n){var G=k.internal_flags;if(G.VBR_seek_table.pos<=0||(n.seek(n.length()),n.length()==0))return-1;var K=at(n);n.seek(K);var V=fn(x),q=getLameTagFrame(k,V);return q>V.length?-1:(q<1||n.write(V,0,q),0)}}var hs=hn,we=Ht,So=we.new_byte,ls=we.assert,cs=io(),as=vr,ps=ce,us=ue(),gs=Ar,ms=ge(),ws=ns,Cs=cn,fs=to();ri();var Ps=es,Ws=hs;function Ds(){this.setModules=function(t,r){}}function ks(){this.setModules=function(t,r,d){}}function Js(){}function Gs(){this.setModules=function(t,r){}}function Ys(t,r,d){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,r=44100,d=128);var W=new cs,O=new Ds,j=new ps,L=new fs,Z=new as,x=new us,A=new gs,u=new Ws,h=new Ps,Q=new Gs,H=new ws,v=new ms,B=new ks,S=new Js;W.setModules(j,L,Z,x,A,u,h,Q,S),L.setModules(j,S,h,u),Q.setModules(L,h),Z.setModules(W),A.setModules(L,H,x,v),x.setModules(v,H,W.enc.psy),H.setModules(L),v.setModules(x),u.setModules(W,L,h),O.setModules(B,S),B.setModules(h,Q,Z);var D=W.lame_init();D.num_channels=t,D.in_samplerate=r,D.brate=d,D.mode=Cs.STEREO,D.quality=3,D.bWriteVbrTag=!1,D.disable_reservoir=!0,D.write_id3tag_automatic=!1,W.lame_init_params(D);var g=1152,C=0|1.25*g+7200,P=So(C);this.encodeBuffer=function(i,a){t==1&&(a=i),ls(i.length==a.length),i.length>g&&(g=i.length,C=0|1.25*g+7200,P=So(C));var z=W.lame_encode_buffer(D,i,a,i.length,P,0,C);return new Int8Array(P.subarray(0,z))},this.flush=function(){var i=W.lame_encode_flush(D,P,0,C);return new Int8Array(P.subarray(0,i))}}function Di(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function kn(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}Di.RIFF=kn("RIFF");Di.WAVE=kn("WAVE");Di.fmt_=kn("fmt ");Di.data=kn("data");Di.readHeader=function(t){var r=new Di,d=t.getUint32(0,!1);if(Di.RIFF==d&&(t.getUint32(4,!0),Di.WAVE==t.getUint32(8,!1)&&Di.fmt_==t.getUint32(12,!1))){var W=t.getUint32(16,!0),O=20;switch(W){case 16:case 18:r.channels=t.getUint16(O+2,!0),r.sampleRate=t.getUint32(O+4,!0);break;default:throw"extended fmt chunk not implemented"}O+=W;for(var j=Di.data,L=0;j!=d&&(d=t.getUint32(O,!1),L=t.getUint32(O+4,!0),j!=d);)O+=L+8;return r.dataLen=L,r.dataOffset=O+8,r}};var Ce=Eo.Mp3Encoder=Ys,g0=Eo.WavHeader=Di;var zs=32767,Jn=1152;function fe(t,r,d){let W=t.numberOfChannels;if(W!==1&&W!==2)throw new Error("Expecting mono or stereo audioBuffer");if(r=r??128,r<96)W=1;let O=t.length,j=[],L,Z,x;for(let u=0;u<W;u++){L=t.getChannelData(u),Z=new Int16Array(O);for(let h=0;h<O;++h)x=L[h],x=Math.min(1,Math.max(-1,x)),x=Math.round(x*zs),Z[h]=x;j.push(Z)}let A=new Ce(W,t.sampleRate,r);return new Promise((u,h)=>{let Q=[],H=0,v=()=>{let B;if(H>=O){if(B=A.flush(),B.length>0)Q.push(B);let C=new Blob(Q,{type:"audio/mp3"});return u(C)}let S,D,g=performance.now();try{while(H<O&&performance.now()-g<15){if(W===1)S=j[0].subarray(H,H+Jn),B=A.encodeBuffer(S);else S=j[0].subarray(H,H+Jn),D=j[1].subarray(H,H+Jn),B=A.encodeBuffer(S,D);if(B.length>0)Q.push(B);H+=Jn}}catch(C){h(C)}d&&d(H/O),setTimeout(v,16.7)};v()})}var Zs=22050,js=32,$s=22,no=new AudioContext({sampleRate:Zs}),oo=(t)=>new Promise(async(r)=>{let d=await fe(t,js),W=new FileReader;W.readAsDataURL(d),W.addEventListener("load",(O)=>r({data:O.target.result.slice($s),type:"audio/mp3",rate:t.sampleRate,sampleCount:t.length}))});function eo(t){return new Promise((r,d)=>{let W=new FileReader;W.readAsArrayBuffer(t),W.addEventListener("load",async()=>{try{let O=await no.decodeAudioData(W.result),j=oo(O);r(j)}catch(O){d(O)}})})}async function Qs(t){let d=await(await fetch(t)).arrayBuffer(),W=await no.decodeAudioData(d);return oo(W)}async function Pe(t){let r=await t.arrayBuffer(),d=await no.decodeAudioData(r);return oo(d)}import{useCallback as an,useMemo as F0}from"preact/hooks";import{batch as ze}from"@preact/signals";import{nanoid as ro}from"@blockcode/utils";import{useProjectContext as Us,translate as Os,setAlert as Ze,delAlert as qs,openAsset as so,addAsset as je,delAsset as xs}from"@blockcode/core";function We(t){let r=Math.floor(t/60),d=Math.floor(t%60);return`${r}:${`00${d}`.slice(-2)}.${t.toFixed(3).slice(-3)}`}import{Text as yi,IconSelector as bs,ActionButton as vs}from"@blockcode/core";function bi(t){let r=globalThis.document,d=r.createElement("style");d.appendChild(r.createTextNode(t)),r.head.append(d)}bi("._YzM_q_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}._YzM_q_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}._YzM_q_selector-item{width:5rem;height:5rem;margin:.5rem auto}._YzM_q_delete-menu-item:hover{background:var(--error-primary)}._YzM_q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}._YzM_q_add-button{margin:.75rem auto}");var vi={addButtonWrapper:"_YzM_q_add-button-wrapper",addButton:"_YzM_q_add-button",deleteMenuItem:"_YzM_q_delete-menu-item",selectorItem:"_YzM_q_selector-item",selectorWrapper:"_YzM_q_selector-wrapper",selectorItemsWrapper:"_YzM_q_selector-items-wrapper"};var De="./assets/icon-thumb-jy4n8115.svg";var ke="./assets/icon-sound-56nbc8vm.svg";var Je="./assets/icon-search-6g8kgvdt.svg";var Bi="./assets/icon-record-k0kczk8k.svg";var Ge="./assets/icon-surprise-d5t4529a.svg";var Ye="./assets/icon-file-upload-0z25chr6.svg";import{jsx as Ji,jsxs as Vs}from"preact/jsx-runtime";function $e({onShowLibrary:t,onSurprise:r,onSoundsFilter:d}){let{assets:W,assetId:O}=Us(),j=an(()=>{return W.value.filter((u)=>{if(!/^audio\//.test(u.type))return!1;if(!d)return!0;return d(u)})},[d]),L=an(()=>{let u=document.createElement("input");u.type="file",u.accept=".wav,.mp3",u.multiple=!0,u.click(),u.addEventListener("change",async(h)=>{let Q=ro();Ze("importing",{id:Q});try{for(let H of h.target.files){let v=ro(),B=H.name.slice(0,H.name.lastIndexOf(".")),S=await eo(H);je({...S,id:v,name:B})}}catch(H){Ze({id:Q,message:Ji(yi,{id:"sound.error.formatNotSupperted",defaultMessage:"This wav format is not supported."})},2000)}qs(Q)})},[]),Z=an(()=>{let u=ro();ze(()=>{je({id:u,type:"audio/mp3",name:Os("sound.sound","Sound"),data:"",rate:22050,sampleCount:0,record:!0}),so(u)})},[]),x=an((u)=>{let h=j(),Q=h[u];ze(()=>{let H=O.value;if(Q.id===O.value){if(u===0)H=h[1]?.id;else if(u+1<h.length)H=h[u+1].id;else if(u-1>-1)H=h[u-1].id}xs(Q.id),so(H)})},[]),A=an((u,h)=>{so(h.id)},[]);return Vs("div",{className:vi.selectorWrapper,children:[Ji(bs,{displayOrder:!0,id:"sound-selector",className:vi.selectorItemsWrapper,items:j().map((u,h)=>({...u,details:`${We(u.sampleCount/u.rate)||0}`,icon:De,order:h,className:vi.selectorItem,contextMenu:[[{label:Ji(yi,{id:"sound.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:Ji(yi,{id:"sound.contextMenu.delete",defaultMessage:"delete"}),className:vi.deleteMenuItem,onClick:()=>x(h)}]]})),selectedId:O.value,onSelect:A,onDelete:x}),Ji("div",{className:vi.addButtonWrapper,children:Ji(vs,{tooltipPlacement:"right",className:vi.addButton,icon:ke,tooltip:Ji(yi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t,moreButtons:[{icon:Ye,tooltip:Ji(yi,{id:"sound.actionButton.upload",defaultMessage:"Upload Sound"}),onClick:L},{icon:Ge,tooltip:Ji(yi,{id:"sound.actionButton.surprise",defaultMessage:"Surprise"}),onClick:r},{icon:Bi,tooltip:Ji(yi,{id:"sound.actionButton.record",defaultMessage:"Record"}),onClick:Z},{icon:Je,tooltip:Ji(yi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t}]})})]})}import{useRef as ao,useEffect as Ke,useCallback as Xi}from"preact/hooks";import{classNames as jn}from"@blockcode/utils";import{useProjectContext as _s,translate as Gi,maybeTranslate as Bs,setAsset as Ue}from"@blockcode/core";function oi(t,r,d,W){return new(d||(d=Promise))(function(O,j){function L(A){try{x(W.next(A))}catch(u){j(u)}}function Z(A){try{x(W.throw(A))}catch(u){j(u)}}function x(A){var u;A.done?O(A.value):(u=A.value,u instanceof d?u:new d(function(h){h(u)})).then(L,Z)}x((W=W.apply(t,r||[])).next())})}class tn{constructor(){this.listeners={}}on(t,r,d){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(r),d==null?void 0:d.once){let W=()=>{this.un(t,W),this.un(t,r)};return this.on(t,W),W}return()=>this.un(t,r)}un(t,r){var d;(d=this.listeners[t])===null||d===void 0||d.delete(r)}once(t,r){return this.on(t,r,{once:!0})}unAll(){this.listeners={}}emit(t,...r){this.listeners[t]&&this.listeners[t].forEach((d)=>d(...r))}}var Gn={decode:function(t,r){return oi(this,void 0,void 0,function*(){let d=new AudioContext({sampleRate:r});return d.decodeAudioData(t).finally(()=>d.close())})},createBuffer:function(t,r){return typeof t[0]=="number"&&(t=[t]),function(d){let W=d[0];if(W.some((O)=>O>1||O<-1)){let O=W.length,j=0;for(let L=0;L<O;L++){let Z=Math.abs(W[L]);Z>j&&(j=Z)}for(let L of d)for(let Z=0;Z<O;Z++)L[Z]/=j}}(t),{duration:r,length:t[0].length,sampleRate:t[0].length/r,numberOfChannels:t.length,getChannelData:(d)=>t==null?void 0:t[d],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function Fe(t,r){let d=r.xmlns?document.createElementNS(r.xmlns,t):document.createElement(t);for(let[W,O]of Object.entries(r))if(W==="children")for(let[j,L]of Object.entries(r))typeof L=="string"?d.appendChild(document.createTextNode(L)):d.appendChild(Fe(j,L));else W==="style"?Object.assign(d.style,O):W==="textContent"?d.textContent=O:d.setAttribute(W,O.toString());return d}function Qe(t,r,d){let W=Fe(t,r||{});return d==null||d.appendChild(W),W}var Ts=Object.freeze({__proto__:null,createElement:Qe,default:Qe}),Ns={fetchBlob:function(t,r,d){return oi(this,void 0,void 0,function*(){let W=yield fetch(t,d);if(W.status>=400)throw new Error(`Failed to fetch ${t}: ${W.status} (${W.statusText})`);return function(O,j){oi(this,void 0,void 0,function*(){if(!O.body||!O.headers)return;let L=O.body.getReader(),Z=Number(O.headers.get("Content-Length"))||0,x=0,A=(h)=>oi(this,void 0,void 0,function*(){x+=(h==null?void 0:h.length)||0;let Q=Math.round(x/Z*100);j(Q)}),u=()=>oi(this,void 0,void 0,function*(){let h;try{h=yield L.read()}catch(Q){return}h.done||(A(h.value),yield u())});u()})}(W.clone(),r),W.blob()})}};class ye extends tn{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)},{once:!0})}onMediaEvent(t,r,d){return this.media.addEventListener(t,r,d),()=>this.media.removeEventListener(t,r,d)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return this.media.canPlayType(t)!==""}setSrc(t,r){let d=this.getSrc();if(t&&d===t)return;this.revokeSrc();let W=r instanceof Blob&&(this.canPlayType(r.type)||!t)?URL.createObjectURL(r):t;d&&(this.media.src="");try{this.media.src=W}catch(O){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(t){this.media=t}play(){return oi(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,r){r!=null&&(this.media.preservesPitch=r),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}class Ri extends tn{constructor(t,r){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=t;let d=this.parentFromOptionsContainer(t.container);this.parent=d;let[W,O]=this.initHtml();d.appendChild(W),this.container=W,this.scrollContainer=O.querySelector(".scroll"),this.wrapper=O.querySelector(".wrapper"),this.canvasWrapper=O.querySelector(".canvases"),this.progressWrapper=O.querySelector(".progress"),this.cursor=O.querySelector(".cursor"),r&&O.appendChild(r),this.initEvents()}parentFromOptionsContainer(t){let r;if(typeof t=="string"?r=document.querySelector(t):t instanceof HTMLElement&&(r=t),!r)throw new Error("Container not found");return r}initEvents(){let t=(r)=>{let d=this.wrapper.getBoundingClientRect(),W=r.clientX-d.left,O=r.clientY-d.top;return[W/d.width,O/d.height]};if(this.wrapper.addEventListener("click",(r)=>{let[d,W]=t(r);this.emit("click",d,W)}),this.wrapper.addEventListener("dblclick",(r)=>{let[d,W]=t(r);this.emit("dblclick",d,W)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{let{scrollLeft:r,scrollWidth:d,clientWidth:W}=this.scrollContainer,O=r/d,j=(r+W)/d;this.emit("scroll",O,j,r,r+W)}),typeof ResizeObserver=="function"){let r=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{r().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let t=this.parent.clientWidth;t===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=t,this.reRender())}initDrag(){this.subscriptions.push(function(t,r,d,W,O=3,j=0,L=100){if(!t)return()=>{};let Z=matchMedia("(pointer: coarse)").matches,x=()=>{},A=(u)=>{if(u.button!==j)return;u.preventDefault(),u.stopPropagation();let{clientX:h,clientY:Q}=u,H=!1,v=Date.now(),B=(P)=>{if(P.preventDefault(),P.stopPropagation(),Z&&Date.now()-v<L)return;let{clientX:i,clientY:a}=P,z=i-h,U=a-Q;if(H||Math.abs(z)>O||Math.abs(U)>O){let b=t.getBoundingClientRect(),{left:F,top:M}=b;H||(d==null||d(h-F,Q-M),H=!0),r(z,U,i-F,a-M),h=i,Q=a}},S=(P)=>{if(H){let{clientX:i,clientY:a}=P,z=t.getBoundingClientRect(),{left:U,top:b}=z;W==null||W(i-U,a-b)}x()},D=(P)=>{P.relatedTarget&&P.relatedTarget!==document.documentElement||S(P)},g=(P)=>{H&&(P.stopPropagation(),P.preventDefault())},C=(P)=>{H&&P.preventDefault()};document.addEventListener("pointermove",B),document.addEventListener("pointerup",S),document.addEventListener("pointerout",D),document.addEventListener("pointercancel",D),document.addEventListener("touchmove",C,{passive:!1}),document.addEventListener("click",g,{capture:!0}),x=()=>{document.removeEventListener("pointermove",B),document.removeEventListener("pointerup",S),document.removeEventListener("pointerout",D),document.removeEventListener("pointercancel",D),document.removeEventListener("touchmove",C),setTimeout(()=>{document.removeEventListener("click",g,{capture:!0})},10)}};return t.addEventListener("pointerdown",A),()=>{x(),t.removeEventListener("pointerdown",A)}}(this.wrapper,(t,r,d)=>{this.emit("drag",Math.max(0,Math.min(1,d/this.wrapper.getBoundingClientRect().width)))},(t)=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))},(t)=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))}))}getHeight(t,r){var d;let W=((d=this.audioData)===null||d===void 0?void 0:d.numberOfChannels)||1;if(t==null)return 128;if(!isNaN(Number(t)))return Number(t);if(t==="auto"){let O=this.parent.clientHeight||128;return(r==null?void 0:r.every((j)=>!j.overlay))?O/W:O}return 128}initHtml(){let t=document.createElement("div"),r=t.attachShadow({mode:"open"}),d=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return r.innerHTML=`
      <style${d?` nonce="${d}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,r]}setOptions(t){if(this.options.container!==t.container){let r=this.parentFromOptionsContainer(t.container);r.appendChild(this.container),this.parent=r}t.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){let{scrollWidth:r}=this.scrollContainer,d=r*t;this.setScroll(d)}destroy(){var t,r;this.subscriptions.forEach((d)=>d()),this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(r=this.unsubscribeOnScroll)===null||r===void 0||r.forEach((d)=>d()),this.unsubscribeOnScroll=[]}createDelay(t=10){let r,d,W=()=>{r&&clearTimeout(r),d&&d()};return this.timeouts.push(W),()=>new Promise((O,j)=>{W(),d=j,r=setTimeout(()=>{r=void 0,d=void 0,O()},t)})}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";let r=document.createElement("canvas"),d=r.getContext("2d"),W=r.height*(window.devicePixelRatio||1),O=d.createLinearGradient(0,0,0,W),j=1/(t.length-1);return t.forEach((L,Z)=>{let x=Z*j;O.addColorStop(x,L)}),O}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(t,r,d,W){let O=t[0],j=t[1]||t[0],L=O.length,{width:Z,height:x}=d.canvas,A=x/2,u=this.getPixelRatio(),h=r.barWidth?r.barWidth*u:1,Q=r.barGap?r.barGap*u:r.barWidth?h/2:0,H=r.barRadius||0,v=Z/(h+Q)/L,B=H&&"roundRect"in d?"roundRect":"rect";d.beginPath();let S=0,D=0,g=0;for(let C=0;C<=L;C++){let P=Math.round(C*v);if(P>S){let z=Math.round(D*A*W),U=z+Math.round(g*A*W)||1,b=A-z;r.barAlign==="top"?b=0:r.barAlign==="bottom"&&(b=x-U),d[B](S*(h+Q),b,h,U,H),S=P,D=0,g=0}let i=Math.abs(O[C]||0),a=Math.abs(j[C]||0);i>D&&(D=i),a>g&&(g=a)}d.fill(),d.closePath()}renderLineWaveform(t,r,d,W){let O=(j)=>{let L=t[j]||t[0],Z=L.length,{height:x}=d.canvas,A=x/2,u=d.canvas.width/Z;d.moveTo(0,A);let h=0,Q=0;for(let H=0;H<=Z;H++){let v=Math.round(H*u);if(v>h){let S=A+(Math.round(Q*A*W)||1)*(j===0?-1:1);d.lineTo(h,S),h=v,Q=0}let B=Math.abs(L[H]||0);B>Q&&(Q=B)}d.lineTo(h,A)};d.beginPath(),O(0),O(1),d.fill(),d.closePath()}renderWaveform(t,r,d){if(d.fillStyle=this.convertColorValues(r.waveColor),r.renderFunction)return void r.renderFunction(t,d);let W=r.barHeight||1;if(r.normalize){let O=Array.from(t[0]).reduce((j,L)=>Math.max(j,Math.abs(L)),0);W=O?1/O:1}r.barWidth||r.barGap||r.barAlign?this.renderBarWaveform(t,r,d,W):this.renderLineWaveform(t,r,d,W)}renderSingleCanvas(t,r,d,W,O,j,L){let Z=this.getPixelRatio(),x=document.createElement("canvas");x.width=Math.round(d*Z),x.height=Math.round(W*Z),x.style.width=`${d}px`,x.style.height=`${W}px`,x.style.left=`${Math.round(O)}px`,j.appendChild(x);let A=x.getContext("2d");if(this.renderWaveform(t,r,A),x.width>0&&x.height>0){let u=x.cloneNode(),h=u.getContext("2d");h.drawImage(x,0,0),h.globalCompositeOperation="source-in",h.fillStyle=this.convertColorValues(r.progressColor),h.fillRect(0,0,x.width,x.height),L.appendChild(u)}}renderMultiCanvas(t,r,d,W,O,j){let L=this.getPixelRatio(),{clientWidth:Z}=this.scrollContainer,x=d/L,A=Math.min(Ri.MAX_CANVAS_WIDTH,Z,x),u={};if(A===0)return;if(r.barWidth||r.barGap){let B=r.barWidth||0.5,S=B+(r.barGap||B/2);A%S!=0&&(A=Math.floor(A/S)*S)}let h=(B)=>{if(B<0||B>=Q)return;if(u[B])return;u[B]=!0;let S=B*A,D=Math.min(x-S,A);if(D<=0)return;let g=t.map((C)=>{let P=Math.floor(S/x*C.length),i=Math.floor((S+D)/x*C.length);return C.slice(P,i)});this.renderSingleCanvas(g,r,D,W,S,O,j)},Q=Math.ceil(x/A);if(!this.isScrollable){for(let B=0;B<Q;B++)h(B);return}let H=this.scrollContainer.scrollLeft/x,v=Math.floor(H*Q);if(h(v-1),h(v),h(v+1),Q>1){let B=this.on("scroll",()=>{let{scrollLeft:S}=this.scrollContainer,D=Math.floor(S/x*Q);Object.keys(u).length>Ri.MAX_NODES&&(O.innerHTML="",j.innerHTML="",u={}),h(D-1),h(D),h(D+1)});this.unsubscribeOnScroll.push(B)}}renderChannel(t,r,d,W){var{overlay:O}=r,j=function(A,u){var h={};for(var Q in A)Object.prototype.hasOwnProperty.call(A,Q)&&u.indexOf(Q)<0&&(h[Q]=A[Q]);if(A!=null&&typeof Object.getOwnPropertySymbols=="function"){var H=0;for(Q=Object.getOwnPropertySymbols(A);H<Q.length;H++)u.indexOf(Q[H])<0&&Object.prototype.propertyIsEnumerable.call(A,Q[H])&&(h[Q[H]]=A[Q[H]])}return h}(r,["overlay"]);let L=document.createElement("div"),Z=this.getHeight(j.height,j.splitChannels);L.style.height=`${Z}px`,O&&W>0&&(L.style.marginTop=`-${Z}px`),this.canvasWrapper.style.minHeight=`${Z}px`,this.canvasWrapper.appendChild(L);let x=L.cloneNode();this.progressWrapper.appendChild(x),this.renderMultiCanvas(t,j,d,Z,L,x)}render(t){return oi(this,void 0,void 0,function*(){var r;this.timeouts.forEach((Z)=>Z()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);let d=this.getPixelRatio(),W=this.scrollContainer.clientWidth,O=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrollable=O>W;let j=this.options.fillParent&&!this.isScrollable,L=(j?W:O)*d;if(this.wrapper.style.width=j?"100%":`${O}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let Z=0;Z<t.numberOfChannels;Z++){let x=Object.assign(Object.assign({},this.options),(r=this.options.splitChannels)===null||r===void 0?void 0:r[Z]);this.renderChannel([t.getChannelData(Z)],x,L,Z)}else{let Z=[t.getChannelData(0)];t.numberOfChannels>1&&Z.push(t.getChannelData(1)),this.renderChannel(Z,this.options,L,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach((d)=>d()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:t}=this.scrollContainer,{right:r}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){let{right:d}=this.progressWrapper.getBoundingClientRect(),W=d-r;W*=2,W=W<0?Math.floor(W):Math.ceil(W),W/=2,this.scrollContainer.scrollLeft+=W}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,r=!1){let{scrollLeft:d,scrollWidth:W,clientWidth:O}=this.scrollContainer,j=t*W,L=d,Z=d+O,x=O/2;if(this.isDragging)j+30>Z?this.scrollContainer.scrollLeft+=30:j-30<L&&(this.scrollContainer.scrollLeft-=30);else{(j<L||j>Z)&&(this.scrollContainer.scrollLeft=j-(this.options.autoCenter?x:0));let A=j-d-x;r&&this.options.autoCenter&&A>0&&(this.scrollContainer.scrollLeft+=Math.min(A,10))}{let A=this.scrollContainer.scrollLeft,u=A/W,h=(A+O)/W;this.emit("scroll",u,h,A,A+O)}}renderProgress(t,r){if(isNaN(t))return;let d=100*t;this.canvasWrapper.style.clipPath=`polygon(${d}% 0, 100% 0, 100% 100%, ${d}% 100%)`,this.progressWrapper.style.width=`${d}%`,this.cursor.style.left=`${d}%`,this.cursor.style.transform=`translateX(-${Math.round(d)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,r)}exportImage(t,r,d){return oi(this,void 0,void 0,function*(){let W=this.canvasWrapper.querySelectorAll("canvas");if(!W.length)throw new Error("No waveform data");if(d==="dataURL"){let O=Array.from(W).map((j)=>j.toDataURL(t,r));return Promise.resolve(O)}return Promise.all(Array.from(W).map((O)=>new Promise((j,L)=>{O.toBlob((Z)=>{Z?j(Z):L(new Error("Could not export image"))},t,r)})))})}}Ri.MAX_CANVAS_WIDTH=8000,Ri.MAX_NODES=10;class Xe extends tn{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class Yn extends tn{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return oi(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((r)=>{if(r.status>=400)throw new Error(`Failed to fetch ${t}: ${r.status} (${r.statusText})`);return r.arrayBuffer()}).then((r)=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(r)).then((r)=>{this.currentSrc===t&&(this.buffer=r,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var t;if(!this.paused)return;this.paused=!1,(t=this.bufferNode)===null||t===void 0||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let r=this.playedDuration*this._playbackRate;(r>=this.duration||r<0)&&(r=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,r),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,(t=this.bufferNode)===null||t===void 0||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return oi(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){var r,d;let W=t-this.currentTime;(r=this.bufferNode)===null||r===void 0||r.stop(this.audioContext.currentTime+W),(d=this.bufferNode)===null||d===void 0||d.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(t){return oi(this,void 0,void 0,function*(){return this.audioContext.setSinkId(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){let r=!this.paused;r&&this._pause(),this.playedDuration=t/this._playbackRate,r&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,r;return(t=this._duration)!==null&&t!==void 0?t:((r=this.buffer)===null||r===void 0?void 0:r.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){let t=[];if(!this.buffer)return t;let r=this.buffer.numberOfChannels;for(let d=0;d<r;d++)t.push(this.buffer.getChannelData(d));return t}}var Ss={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8000};class Ai extends ye{static create(t){return new Ai(t)}constructor(t){let r=t.media||(t.backend==="WebAudio"?new Yn:void 0);super({media:r,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},Ss,t),this.timer=new Xe;let d=r?void 0:this.getMediaElement();this.renderer=new Ri(this.options,d),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();let W=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:O,duration:j}=this.options;(W||O&&j)&&this.load(W,O,j).catch(()=>null)})}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),this.stopAtPosition!=null&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let t=this.updateProgress();this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var t;this.emit("error",(t=this.getMediaElement().error)!==null&&t!==void 0?t:new Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,r)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,r))}),this.renderer.on("dblclick",(t,r)=>{this.emit("dblclick",t,r)}),this.renderer.on("scroll",(t,r,d,W)=>{let O=this.getDuration();this.emit("scroll",t*O,r*O,d,W)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",(t)=>{this.emit("dragstart",t)}),this.renderer.on("dragend",(t)=>{this.emit("dragend",t)}));{let t;this.subscriptions.push(this.renderer.on("drag",(r)=>{if(!this.options.interact)return;let d;this.renderer.renderProgress(r),clearTimeout(t),this.isPlaying()?d=0:this.options.dragToSeek===!0?d=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(d=this.options.dragToSeek.debounceTime),t=setTimeout(()=>{this.seekTo(r)},d),this.emit("interaction",r*this.getDuration()),this.emit("drag",r)}))}}initPlugins(){var t;((t=this.options.plugins)===null||t===void 0?void 0:t.length)&&this.options.plugins.forEach((r)=>{this.registerPlugin(r)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t)=>t()),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=Gn.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=Gn.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",()=>{this.plugins=this.plugins.filter((r)=>r!==t)})),t}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){let r=t/this.getDuration();this.renderer.setScrollPercentage(r)}getActivePlugins(){return this.plugins}loadAudio(t,r,d,W){return oi(this,void 0,void 0,function*(){var O;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,!r&&!d){let L=this.options.fetchParams||{};window.AbortController&&!L.signal&&(this.abortController=new AbortController,L.signal=(O=this.abortController)===null||O===void 0?void 0:O.signal);let Z=(A)=>this.emit("loading",A);r=yield Ns.fetchBlob(t,Z,L);let x=this.options.blobMimeType;x&&(r=new Blob([r],{type:x}))}this.setSrc(t,r);let j=yield new Promise((L)=>{let Z=W||this.getDuration();Z?L(Z):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>L(this.getDuration()),{once:!0}))});if(!t&&!r){let L=this.getMediaElement();L instanceof Yn&&(L.duration=j)}if(d)this.decodedData=Gn.createBuffer(d,j||0);else if(r){let L=yield r.arrayBuffer();this.decodedData=yield Gn.decode(L,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(t,r,d){return oi(this,void 0,void 0,function*(){try{return yield this.loadAudio(t,void 0,r,d)}catch(W){throw this.emit("error",W),W}})}loadBlob(t,r,d){return oi(this,void 0,void 0,function*(){try{return yield this.loadAudio("",t,r,d)}catch(W){throw this.emit("error",W),W}})}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:r=8000,precision:d=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");let W=Math.min(t,this.decodedData.numberOfChannels),O=[];for(let j=0;j<W;j++){let L=this.decodedData.getChannelData(j),Z=[],x=L.length/r;for(let A=0;A<r;A++){let u=L.slice(Math.floor(A*x),Math.ceil((A+1)*x)),h=0;for(let Q=0;Q<u.length;Q++){let H=u[Q];Math.abs(H)>Math.abs(h)&&(h=H)}Z.push(Math.round(h*d)/d)}O.push(Z)}return O}getDuration(){let t=super.getDuration()||0;return t!==0&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){let r=this.getDuration()*t;this.setTime(r)}play(t,r){let d=Object.create(null,{play:{get:()=>super.play}});return oi(this,void 0,void 0,function*(){return t!=null&&this.setTime(t),r!=null&&(this.media instanceof Yn?this.media.stopAt(r):this.stopAtPosition=r),d.play.call(this)})}playPause(){return oi(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],0.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return oi(this,arguments,void 0,function*(t="image/png",r=1,d="dataURL"){return this.renderer.exportImage(t,r,d)})}destroy(){var t;this.emit("destroy"),(t=this.abortController)===null||t===void 0||t.abort(),this.plugins.forEach((r)=>r.destroy()),this.subscriptions.forEach((r)=>r()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}Ai.BasePlugin=class extends tn{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t())}},Ai.dom=Ts;function ho(t,r,d,W){return new(d||(d=Promise))(function(O,j){function L(A){try{x(W.next(A))}catch(u){j(u)}}function Z(A){try{x(W.throw(A))}catch(u){j(u)}}function x(A){var u;A.done?O(A.value):(u=A.value,u instanceof d?u:new d(function(h){h(u)})).then(L,Z)}x((W=W.apply(t,r||[])).next())})}class lo{constructor(){this.listeners={}}on(t,r,d){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(r),d==null?void 0:d.once){let W=()=>{this.un(t,W),this.un(t,r)};return this.on(t,W),W}return()=>this.un(t,r)}un(t,r){var d;(d=this.listeners[t])===null||d===void 0||d.delete(r)}once(t,r){return this.on(t,r,{once:!0})}unAll(){this.listeners={}}emit(t,...r){this.listeners[t]&&this.listeners[t].forEach((d)=>d(...r))}}class Me extends lo{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t())}}class Le extends lo{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}var Es=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class zn extends Me{constructor(t){var r,d,W,O,j,L;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(r=t.audioBitsPerSecond)!==null&&r!==void 0?r:128000,scrollingWaveform:(d=t.scrollingWaveform)!==null&&d!==void 0&&d,scrollingWaveformWindow:(W=t.scrollingWaveformWindow)!==null&&W!==void 0?W:5,continuousWaveform:(O=t.continuousWaveform)!==null&&O!==void 0&&O,renderRecordedAudio:(j=t.renderRecordedAudio)===null||j===void 0||j,mediaRecorderTimeslice:(L=t.mediaRecorderTimeslice)!==null&&L!==void 0?L:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.timer=new Le,this.subscriptions.push(this.timer.on("tick",()=>{let Z=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+Z,this.emit("record-progress",this.duration)}))}static create(t){return new zn(t||{})}renderMicStream(t){var r;let d=new AudioContext,W=d.createMediaStreamSource(t),O=d.createAnalyser();W.connect(O),this.options.continuousWaveform&&(O.fftSize=32);let j=O.frequencyBinCount,L=new Float32Array(j),Z=0;this.wavesurfer&&((r=this.originalOptions)!==null&&r!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));let x=setInterval(()=>{var A,u,h,Q;if(!this.isWaveformPaused){if(O.getFloatTimeDomainData(L),this.options.scrollingWaveform){let H=Math.floor((this.options.scrollingWaveformWindow||0)*d.sampleRate),v=Math.min(H,this.dataWindow?this.dataWindow.length+j:j),B=new Float32Array(H);if(this.dataWindow){let S=Math.max(0,H-this.dataWindow.length);B.set(this.dataWindow.slice(-v+j),S)}B.set(L,H-j),this.dataWindow=B}else if(this.options.continuousWaveform){if(!this.dataWindow){let v=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((u=(A=this.wavesurfer)===null||A===void 0?void 0:A.getWidth())!==null&&u!==void 0?u:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(v)}let H=0;for(let v=0;v<j;v++){let B=Math.abs(L[v]);B>H&&(H=B)}if(Z+1>this.dataWindow.length){let v=new Float32Array(2*this.dataWindow.length);v.set(this.dataWindow,0),this.dataWindow=v}this.dataWindow[Z]=H,Z++}else this.dataWindow=L;if(this.wavesurfer){let H=((Q=(h=this.dataWindow)===null||h===void 0?void 0:h.length)!==null&&Q!==void 0?Q:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:H).then(()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1000),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))}).catch((v)=>{console.error("Error rendering real-time recording data:",v)})}}},10);return{onDestroy:()=>{clearInterval(x),W==null||W.disconnect(),d==null||d.close()},onEnd:()=>{this.isWaveformPaused=!0,clearInterval(x),this.stopMic()}}}startMic(t){return ho(this,void 0,void 0,function*(){let r;try{r=yield navigator.mediaDevices.getUserMedia({audio:!(t==null?void 0:t.deviceId)||{deviceId:t.deviceId}})}catch(O){throw new Error("Error accessing the microphone: "+O.message)}let{onDestroy:d,onEnd:W}=this.renderMicStream(r);return this.subscriptions.push(this.once("destroy",d)),this.subscriptions.push(this.once("record-end",W)),this.stream=r,r})}stopMic(){this.stream&&(this.stream.getTracks().forEach((t)=>t.stop()),this.stream=null,this.mediaRecorder=null)}startRecording(t){return ho(this,void 0,void 0,function*(){let r=this.stream||(yield this.startMic(t));this.dataWindow=null;let d=this.mediaRecorder||new MediaRecorder(r,{mimeType:this.options.mimeType||Es.find((j)=>MediaRecorder.isTypeSupported(j)),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=d,this.stopRecording();let W=[];d.ondataavailable=(j)=>{j.data.size>0&&W.push(j.data),this.emit("record-data-available",j.data)};let O=(j)=>{var L;let Z=new Blob(W,{type:d.mimeType});this.emit(j,Z),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),(L=this.wavesurfer)===null||L===void 0||L.load(URL.createObjectURL(Z)))};d.onpause=()=>O("record-pause"),d.onstop=()=>O("record-end"),d.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")})}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,r;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(r=this.mediaRecorder)===null||r===void 0||r.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return ho(this,void 0,void 0,function*(){return navigator.mediaDevices.enumerateDevices().then((t)=>t.filter((r)=>r.kind==="audioinput"))})}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic()}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}import{Label as Rs,BufferedInput as As,Button as Oe}from"@blockcode/core";bi("._32PlYG_wave-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._32PlYG_wave-wrapper._32PlYG_disabled{opacity:.5;pointer-events:none}._32PlYG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._32PlYG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._32PlYG_row-right{margin-right:var(--space);justify-content:right}._32PlYG_row:last-child{min-height:unset;margin-bottom:0}._32PlYG_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._32PlYG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._32PlYG_name-input{width:8rem}._32PlYG_large-input{width:4rem}._32PlYG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._32PlYG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._32PlYG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._32PlYG_button-icon{width:100%;height:100%;margin:auto}._32PlYG_group-button{border-left:none;border-radius:0}._32PlYG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._32PlYG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._32PlYG_group-button-toggled-off{filter:saturate(0)}._32PlYG_label-button{border:0;font-weight:400}._32PlYG_label-button._32PlYG_selected{background:var(--theme-primary);color:var(--ui-white)}._32PlYG_label-button._32PlYG_selected ._32PlYG_button-icon{filter:brightness(0)invert()}._32PlYG_play-button,._32PlYG_record-button{cursor:pointer;width:3rem;height:3rem;margin:0 var(--space);border:0;border-radius:100%;padding:.75rem}._32PlYG_play-button{background:var(--theme-primary)}._32PlYG_record-button{background:var(--error-primary)}._32PlYG_wave-box-wrapper{margin:20px var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)*.8);background:hsl(from var(--blocks-sounds-primary)h s l/.15);flex:1;min-height:160px;position:relative;overflow:hidden}._32PlYG_wave-box-wrapper._32PlYG_hidden>div{visibility:hidden}");var It={groupButtonToggledOff:"_32PlYG_group-button-toggled-off",hidden:"_32PlYG_hidden",largeInput:"_32PlYG_large-input",rowFill:"_32PlYG_row-fill",toolIcon:"_32PlYG_tool-icon",nameInput:"_32PlYG_name-input",selected:"_32PlYG_selected",waveWrapper:"_32PlYG_wave-wrapper",playButton:"_32PlYG_play-button",disabled:"_32PlYG_disabled",waveBoxWrapper:"_32PlYG_wave-box-wrapper",recordButton:"_32PlYG_record-button",labelImage:"_32PlYG_label-image",groupButtonLast:"_32PlYG_group-button-last",labelButton:"_32PlYG_label-button",dashedBorder:"_32PlYG_dashed-border",buttonIcon:"_32PlYG_button-icon",row:"_32PlYG_row",group:"_32PlYG_group",button:"_32PlYG_button",groupButton:"_32PlYG_group-button",rowRight:"_32PlYG_row-right",groupButtonFirst:"_32PlYG_group-button-first"};var Zn="./assets/icon-play-mnpftarf.svg";var co="./assets/icon-stop-547qvw0a.svg";import{jsx as Zi,jsxs as xe}from"preact/jsx-runtime";var t0=zn.create(),qe;function be(){let t=ao(),r=ao(),d=ao(),{asset:W}=_s(),O=W.value,j=!O||!/^audio\//.test(O.type);Ke(()=>{if(!t.ws)return;if(t.ws.isPlaying())t.ws.stop();if(t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})}),t.ws.empty(),O?.sampleCount>0)t.ws.load(`data:${O.type};base64,${O.data}`);if(t.record.sound=O,r.current)r.current.src=Zn,r.current.title=Gi("sound.play","Play");if(d.current)d.current.src=Bi,d.current.title=Gi("sound.record","Record")},[O,j]);let L=Xi((v,B)=>{Ue({[v]:B})},[]),Z=Xi(()=>{if(t.ws){if(t.ws.isPlaying())t.ws.stop();else if(O.sampleCount>0)t.ws.play()}if(d.current)setTimeout(()=>{let v=d.current.parentElement.parentElement;if(v.disabled=t.ws.isPlaying(),t.ws.isPlaying())v.classList.add(It.groupButtonToggledOff);else v.classList.remove(It.groupButtonToggledOff)})},[O]),x=Xi(()=>{if(r.current)r.current.src=co,r.current.title=Gi("sound.stop","Stop");if(t.ws)t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1});if(d.current){let v=d.current.parentElement.parentElement;v.disabled=!1,v.classList.remove(It.groupButtonToggledOff)}},[]),A=Xi(()=>{if(r.current){if(r.current.src=Zn,r.current.title=Gi("sound.play","Play"),t.ws)t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})})}if(d.current){d.current.src=Bi,d.current.title=Gi("sound.record","Record");let v=d.current.parentElement.parentElement;v.disabled=!1,v.classList.remove(It.groupButtonToggledOff)}},[]),u=Xi(()=>{if(t.ws&&!t.record.isRecording())t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1})},[]),h=Xi(()=>{if(d.current)d.current.src=co,d.current.title=Gi("sound.stop","Stop");if(r.current){let v=r.current.parentElement.parentElement;v.disabled=!0,v.classList.add(It.groupButtonToggledOff)}},[]),Q=Xi(()=>{if(t.record)if(t.record.isRecording())t.record.stopRecording(),t.record.stopMic(),clearTimeout(qe);else t.record.startRecording(),qe=setTimeout(Q,1e4)},[]),H=Xi(async(v)=>{let B=await Pe(v);if(Ue(B),r.current){let S=r.current.parentElement.parentElement;S.disabled=!1,S.classList.remove(It.groupButtonToggledOff)}},[]);return Ke(()=>{if(t.current){if(t.ws=Ai.create({container:t.current,dragToSeek:!0,height:"auto",waveColor:"hsla(300, 48%, 50%, 1)",progressColor:"hsla(300, 48%, 50%, 0.8)",cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0}),t.record=t.ws.registerPlugin(t0),t.record.on("record-start",h),t.record.on("record-end",H),t.ws.on("play",x),t.ws.on("pause",A),t.ws.on("finish",A),t.ws.on("seeking",u),O?.sampleCount>0)t.ws.empty(),t.ws.load(`data:${O.type};base64,${O.data}`);t.record.sound=O}return()=>{if(t.ws)t.ws.destroy()}},[t]),xe("div",{className:jn(It.waveWrapper,{[It.disabled]:j}),children:[Zi("div",{className:It.row,children:Zi("div",{className:It.group,children:Zi(Rs,{text:Gi("sound.sound","Sound"),children:Zi(As,{disabled:j,className:It.nameInput,placeholder:Gi("sound.name","name"),onSubmit:(v)=>L("name",v),value:j||!O?Gi("sound.sound","Sound"):Bs(O.name)})})})}),Zi("div",{className:It.row,children:Zi("div",{ref:t,className:jn(It.waveBoxWrapper,{[It.hidden]:j})})}),xe("div",{className:It.row,children:[Zi(Oe,{className:jn(It.button,It.playButton,{[It.groupButtonToggledOff]:j}),onClick:Z,children:Zi("img",{ref:r,src:Zn,className:It.buttonIcon,title:Gi("sound.play","Play")})}),O?.record&&Zi(Oe,{className:jn(It.button,It.recordButton,{[It.groupButtonToggledOff]:j}),onClick:Q,children:Zi("img",{ref:d,src:Bi,className:It.buttonIcon,title:Gi("sound.record","Record")})})]})]})}bi(".cPknva_wave-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var ve={waveEditorWrapper:"cPknva_wave-editor-wrapper"};import{jsx as Ve,jsxs as n0}from"preact/jsx-runtime";function i0({onShowLibrary:t,onSurprise:r,onSoundsFilter:d}){return n0("div",{className:ve.waveEditorWrapper,children:[Ve($e,{onShowLibrary:t,onSurprise:r,onSoundsFilter:d}),Ve(be,{})]})}import{Text as e0}from"@blockcode/core";var Te="./assets/icon-sound-ajkz0had.svg";import{jsx as s0}from"preact/jsx-runtime";var r0={icon:Te,label:s0(e0,{id:"sound.sound",defaultMessage:"Sound"})};export{r0 as soundTab,Qs as loadSoundFromURL,eo as loadSoundFromFile,i0 as SoundEditor};
