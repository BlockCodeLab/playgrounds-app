import{addLocalesMessages as ts}from"@blockcode/core";var Wn={"sound.sound":"Sound","sound.play":"Play","sound.record":"Record","sound.stop":"Stop","sound.name":"name","sound.contextMenu.export":"export","sound.contextMenu.delete":"delete","sound.actionButton.upload":"Upload Sound","sound.actionButton.surprise":"Surprise","sound.actionButton.record":"Record","sound.actionButton.sound":"Choose a Sound","sound.error.formatNotSupperted":"This wav format is not supported."};var Dn={"sound.sound":"声音","sound.play":"播放","sound.record":"录音","sound.stop":"停止","sound.name":"名称","sound.contextMenu.export":"导出","sound.contextMenu.delete":"删除","sound.actionButton.upload":"上传声音","sound.actionButton.surprise":"随机","sound.actionButton.record":"录制","sound.actionButton.sound":"选择一个声音","sound.error.formatNotSupperted":"声音文件格式不支持。"};var kn={"sound.sound":"聲音","sound.play":"播放","sound.record":"録音","sound.stop":"停止","sound.name":"名稱","sound.contextMenu.export":"導齣","sound.contextMenu.delete":"刪除","sound.actionButton.upload":"上傳聲音","sound.actionButton.surprise":"隨機","sound.actionButton.record":"録製","sound.actionButton.sound":"選擇一個聲音","sound.error.formatNotSupperted":"聲音文件格式不支持。"};ts({en:Wn,"zh-Hans":Dn,"zh-Hant":kn});var In={};function is(t){return new Int8Array(t)}function _n(t){return new Int16Array(t)}function Bn(t){return new Int32Array(t)}function Rn(t){return new Float32Array(t)}function es(t){return new Float64Array(t)}function An(t){if(t.length==1)return Rn(t[0]);var e=t[0];t=t.slice(1);for(var n=[],C=0;C<e;C++)n.push(An(t));return n}function tr(t){if(t.length==1)return Bn(t[0]);var e=t[0];t=t.slice(1);for(var n=[],C=0;C<e;C++)n.push(tr(t));return n}function ir(t){if(t.length==1)return _n(t[0]);var e=t[0];t=t.slice(1);for(var n=[],C=0;C<e;C++)n.push(ir(t));return n}function er(t){if(t.length==1)return Array(t[0]);var e=t[0];t=t.slice(1);for(var n=[],C=0;C<e;C++)n.push(er(t));return n}var nr={};nr.fill=function(t,e,n,C){if(arguments.length==2)for(var b=0;b<t.length;b++)t[b]=arguments[1];else for(var b=e;b<n;b++)t[b]=C};var he={};he.arraycopy=function(t,e,n,C,b){for(var y=e+b;e<y;)n[C++]=t[e++]};he.out={};he.out.println=function(t){console.log(t)};he.out.printf=function(){console.log.apply(console,arguments)};var We={};We.SQRT2=1.4142135623730951;We.FAST_LOG10=function(t){return Math.log10(t)};We.FAST_LOG10_X=function(t,e){return Math.log10(t)*e};function ji(t){this.ordinal=t}ji.short_block_allowed=new ji(0);ji.short_block_coupled=new ji(1);ji.short_block_dispensed=new ji(2);ji.short_block_forced=new ji(3);var rr={};rr.MAX_VALUE=340282350000000000000000000000000000000;function mi(t){this.ordinal=t}mi.vbr_off=new mi(0);mi.vbr_mt=new mi(1);mi.vbr_rh=new mi(2);mi.vbr_abr=new mi(3);mi.vbr_mtrh=new mi(4);mi.vbr_default=mi.vbr_mtrh;var ns=function(t){},Ht={System:he,VbrMode:mi,Float:rr,ShortBlock:ji,Util:We,Arrays:nr,new_array_n:er,new_byte:is,new_double:es,new_float:Rn,new_float_n:An,new_int:Bn,new_int_n:tr,new_short:_n,new_short_n:ir,assert:ns},Le,yn;function rs(){if(yn)return Le;yn=1;var t=Ht,e=t.System,n=t.Util,C=t.Arrays,b=t.new_float,y=si();function j(){var z=[-0.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,0.9063471690191471,0.1960342806591213,-0.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,0.8206787908286602,0.3901806440322567,-0.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,0.7416505462720353,0.5805693545089249,-0.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,0.6681786379192989,0.7653668647301797,-0.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,0.5993769336819237,0.9427934736519954,-0.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,0.5345111359507916,1.111140466039205,-0.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,0.4729647758913199,1.268786568327291,-0.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,0.41421356237309503,1.414213562373095,-0.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,0.3578057213145241,1.546020906725474,-0.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,0.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,0.3033466836073424,1.66293922460509,-0.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,0.2504869601913055,1.76384252869671,-0.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,0.198912367379658,1.847759065022573,-0.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,0.1483359875383474,1.913880671464418,-0.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,0.09849140335716425,1.961570560806461,-0.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,0.04912684976946725,1.990369453344394,0.035780907*n.SQRT2*0.5/0.000002384,0.017876148*n.SQRT2*0.5/0.000002384,0.003134727*n.SQRT2*0.5/0.000002384,0.002457142*n.SQRT2*0.5/0.000002384,0.000971317*n.SQRT2*0.5/0.000002384,0.000218868*n.SQRT2*0.5/0.000002384,0.000101566*n.SQRT2*0.5/0.000002384,0.000013828*n.SQRT2*0.5/0.000002384,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],Z=12,B=36,h=[[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.000000000000940084909404969,0.0000000000006423305872147839,0.0000000000002382191739347918,0.000000000005456116108943412,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758252,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558783,0.0000000000008371015190102974,0.0000000000002599706096327376,-0.000000000005456116108943412,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758252,-0.000000000002858043359288076,-0.000000000002156177623817898,-0.000000000001475637723558783,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347923,-0.0000000000006423305872147843,-0.0000000000009400849094049696,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049694,-0.000000000000642330587214784,-0.0000000000002382191739347918],[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.0000000000009400849094049688,0.0000000000006423305872147841,0.0000000000002382191739347918,0.000000000005456116108943413,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758253,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558782,0.0000000000008371015190102975,0.0000000000002599706096327376,-0.000000000005461314069809755,-0.000000000004921085770524055,-0.000000000004343405037091838,-0.000000000003732668368707687,-0.000000000003093523840190885,-0.000000000002430835727329465,-0.000000000001734679010007751,-0.000000000000974825365660928,-0.0000000000002797435120168326,0,0,0,0,0,0,-0.0000000000002283748241799531,-0.0000000000004037858874020686,-0.0000000000002146547464825323],[0.1316524975873958,0.414213562373095,0.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,0.984807753012208,0.6427876096865394,0.3420201433256688,0.9396926207859084,-0.1736481776669303,-0.7660444431189779,0.8660254037844387,0.5,-0.5144957554275265,-0.4717319685649723,-0.3133774542039019,-0.1819131996109812,-0.09457419252642064,-0.04096558288530405,-0.01419856857247115,-0.003699974673760037,0.8574929257125442,0.8817419973177052,0.9496286491027329,0.9833145924917901,0.9955178160675857,0.9991605581781475,0.999899195244447,0.9999931550702802],[0,0,0,0,0,0,0.0000000000002283748241799531,0.0000000000004037858874020686,0.0000000000002146547464825323,0.000000000005461314069809755,0.000000000004921085770524055,0.000000000004343405037091838,0.000000000003732668368707687,0.000000000003093523840190885,0.000000000002430835727329466,0.000000000001734679010007751,0.000000000000974825365660928,0.0000000000002797435120168326,-0.000000000005456116108943413,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758253,-0.000000000002858043359288075,-0.000000000002156177623817898,-0.000000000001475637723558782,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347913,-0.0000000000006423305872147834,-0.0000000000009400849094049688,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049688,-0.0000000000006423305872147841,-0.0000000000002382191739347918]],d=h[y.SHORT_TYPE],F=h[y.SHORT_TYPE],q=h[y.SHORT_TYPE],L=h[y.SHORT_TYPE],I=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function E(w,k,i){for(var u=10,Y=k+238-14-286,M=-15;M<0;M++){var S,$,x;S=z[u+-10],$=w[Y+-224]*S,x=w[k+224]*S,S=z[u+-9],$+=w[Y+-160]*S,x+=w[k+160]*S,S=z[u+-8],$+=w[Y+-96]*S,x+=w[k+96]*S,S=z[u+-7],$+=w[Y+-32]*S,x+=w[k+32]*S,S=z[u+-6],$+=w[Y+32]*S,x+=w[k+-32]*S,S=z[u+-5],$+=w[Y+96]*S,x+=w[k+-96]*S,S=z[u+-4],$+=w[Y+160]*S,x+=w[k+-160]*S,S=z[u+-3],$+=w[Y+224]*S,x+=w[k+-224]*S,S=z[u+-2],$+=w[k+-256]*S,x-=w[Y+256]*S,S=z[u+-1],$+=w[k+-192]*S,x-=w[Y+192]*S,S=z[u+0],$+=w[k+-128]*S,x-=w[Y+128]*S,S=z[u+1],$+=w[k+-64]*S,x-=w[Y+64]*S,S=z[u+2],$+=w[k+0]*S,x-=w[Y+0]*S,S=z[u+3],$+=w[k+64]*S,x-=w[Y+-64]*S,S=z[u+4],$+=w[k+128]*S,x-=w[Y+-128]*S,S=z[u+5],$+=w[k+192]*S,x-=w[Y+-192]*S,$*=z[u+6],S=x-$,i[30+M*2]=x+$,i[31+M*2]=z[u+7]*S,u+=18,k--,Y++}{var $,x,dt,P;x=w[k+-16]*z[u+-10],$=w[k+-32]*z[u+-2],x+=(w[k+-48]-w[k+16])*z[u+-9],$+=w[k+-96]*z[u+-1],x+=(w[k+-80]+w[k+48])*z[u+-8],$+=w[k+-160]*z[u+0],x+=(w[k+-112]-w[k+80])*z[u+-7],$+=w[k+-224]*z[u+1],x+=(w[k+-144]+w[k+112])*z[u+-6],$-=w[k+32]*z[u+2],x+=(w[k+-176]-w[k+144])*z[u+-5],$-=w[k+96]*z[u+3],x+=(w[k+-208]+w[k+176])*z[u+-4],$-=w[k+160]*z[u+4],x+=(w[k+-240]-w[k+208])*z[u+-3],$-=w[k+224],dt=$-x,P=$+x,x=i[14],$=i[15]-x,i[31]=P+x,i[30]=dt+$,i[15]=dt-$,i[14]=P-x}{var r;r=i[28]-i[0],i[0]+=i[28],i[28]=r*z[u+-36+7],r=i[29]-i[1],i[1]+=i[29],i[29]=r*z[u+-36+7],r=i[26]-i[2],i[2]+=i[26],i[26]=r*z[u+-72+7],r=i[27]-i[3],i[3]+=i[27],i[27]=r*z[u+-72+7],r=i[24]-i[4],i[4]+=i[24],i[24]=r*z[u+-108+7],r=i[25]-i[5],i[5]+=i[25],i[25]=r*z[u+-108+7],r=i[22]-i[6],i[6]+=i[22],i[22]=r*n.SQRT2,r=i[23]-i[7],i[7]+=i[23],i[23]=r*n.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],r=i[6],i[6]=i[31]-r,i[31]=i[31]+r,r=i[7],i[7]=i[30]-r,i[30]=i[30]+r,r=i[22],i[22]=i[15]-r,i[15]=i[15]+r,r=i[23],i[23]=i[14]-r,i[14]=i[14]+r,r=i[20]-i[8],i[8]+=i[20],i[20]=r*z[u+-180+7],r=i[21]-i[9],i[9]+=i[21],i[21]=r*z[u+-180+7],r=i[18]-i[10],i[10]+=i[18],i[18]=r*z[u+-216+7],r=i[19]-i[11],i[11]+=i[19],i[19]=r*z[u+-216+7],r=i[16]-i[12],i[12]+=i[16],i[16]=r*z[u+-252+7],r=i[17]-i[13],i[13]+=i[17],i[17]=r*z[u+-252+7],r=-i[20]+i[24],i[20]+=i[24],i[24]=r*z[u+-216+7],r=-i[21]+i[25],i[21]+=i[25],i[25]=r*z[u+-216+7],r=i[4]-i[8],i[4]+=i[8],i[8]=r*z[u+-216+7],r=i[5]-i[9],i[5]+=i[9],i[9]=r*z[u+-216+7],r=i[0]-i[12],i[0]+=i[12],i[12]=r*z[u+-72+7],r=i[1]-i[13],i[1]+=i[13],i[13]=r*z[u+-72+7],r=i[16]-i[28],i[16]+=i[28],i[28]=r*z[u+-72+7],r=-i[17]+i[29],i[17]+=i[29],i[29]=r*z[u+-72+7],r=n.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=r,r=n.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=r,r=n.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=r-i[18],r=n.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=r-i[19],r=i[2],i[19]-=i[3],i[3]-=r,i[2]=i[31]-r,i[31]+=r,r=i[3],i[11]-=i[19],i[18]-=r,i[3]=i[30]-r,i[30]+=r,r=i[18],i[27]-=i[11],i[19]-=r,i[18]=i[15]-r,i[15]+=r,r=i[19],i[10]-=r,i[19]=i[14]-r,i[14]+=r,r=i[10],i[11]-=r,i[10]=i[23]-r,i[23]+=r,r=i[11],i[26]-=r,i[11]=i[22]-r,i[22]+=r,r=i[26],i[27]-=r,i[26]=i[7]-r,i[7]+=r,r=i[27],i[27]=i[6]-r,i[6]+=r,r=n.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=r,r=n.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=r,r=n.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=r,r=n.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=r,r=-n.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=r-i[8],r=-n.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=r-i[9],r=-n.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=r-i[25],r=-n.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=r-i[24],r=i[24]-i[16],i[24]=r,r=i[20]-r,i[20]=r,r=i[28]-r,i[28]=r,r=i[25]-i[17],i[25]=r,r=i[21]-r,i[21]=r,r=i[29]-r,i[29]=r,r=i[17]-i[1],i[17]=r,r=i[9]-r,i[9]=r,r=i[25]-r,i[25]=r,r=i[5]-r,i[5]=r,r=i[21]-r,i[21]=r,r=i[13]-r,i[13]=r,r=i[29]-r,i[29]=r,r=i[1]-i[0],i[1]=r,r=i[16]-r,i[16]=r,r=i[17]-r,i[17]=r,r=i[8]-r,i[8]=r,r=i[9]-r,i[9]=r,r=i[24]-r,i[24]=r,r=i[25]-r,i[25]=r,r=i[4]-r,i[4]=r,r=i[5]-r,i[5]=r,r=i[20]-r,i[20]=r,r=i[21]-r,i[21]=r,r=i[12]-r,i[12]=r,r=i[13]-r,i[13]=r,r=i[28]-r,i[28]=r,r=i[29]-r,i[29]=r,r=i[0],i[0]+=i[31],i[31]-=r,r=i[1],i[1]+=i[30],i[30]-=r,r=i[16],i[16]+=i[15],i[15]-=r,r=i[17],i[17]+=i[14],i[14]-=r,r=i[8],i[8]+=i[23],i[23]-=r,r=i[9],i[9]+=i[22],i[22]-=r,r=i[24],i[24]+=i[7],i[7]-=r,r=i[25],i[25]+=i[6],i[6]-=r,r=i[4],i[4]+=i[27],i[27]-=r,r=i[5],i[5]+=i[26],i[26]-=r,r=i[20],i[20]+=i[11],i[11]-=r,r=i[21],i[21]+=i[10],i[10]-=r,r=i[12],i[12]+=i[19],i[19]-=r,r=i[13],i[13]+=i[18],i[18]-=r,r=i[28],i[28]+=i[3],i[3]-=r,r=i[29],i[29]+=i[2],i[2]-=r}}function D(w,k){for(var i=0;i<3;i++){var u,Y,M,S,$,x;S=w[k+6]*h[y.SHORT_TYPE][0]-w[k+15],u=w[k+0]*h[y.SHORT_TYPE][2]-w[k+9],Y=S+u,M=S-u,S=w[k+15]*h[y.SHORT_TYPE][0]+w[k+6],u=w[k+9]*h[y.SHORT_TYPE][2]+w[k+0],$=S+u,x=-S+u,u=(w[k+3]*h[y.SHORT_TYPE][1]-w[k+12])*0.00000000002069978111953089,S=(w[k+12]*h[y.SHORT_TYPE][1]+w[k+3])*0.00000000002069978111953089,w[k+0]=Y*0.0000000000190752519173728+u,w[k+15]=-$*0.0000000000190752519173728+S,M=M*0.8660254037844387*0.00000000001907525191737281,$=$*0.5*0.00000000001907525191737281+S,w[k+3]=M-$,w[k+6]=M+$,Y=Y*0.5*0.00000000001907525191737281-u,x=x*0.8660254037844387*0.00000000001907525191737281,w[k+9]=Y+x,w[k+12]=Y-x,k++}}function g(w,k,i){var u,Y;{var M,S,$,x,dt,P,r,J;M=i[17]-i[9],$=i[15]-i[11],x=i[14]-i[12],dt=i[0]+i[8],P=i[1]+i[7],r=i[2]+i[6],J=i[3]+i[5],w[k+17]=dt+r-J-(P-i[4]),Y=(dt+r-J)*F[19]+(P-i[4]),u=(M-$-x)*F[18],w[k+5]=u+Y,w[k+6]=u-Y,S=(i[16]-i[10])*F[18],P=P*F[19]+i[4],u=M*F[12]+S+$*F[13]+x*F[14],Y=-dt*F[16]+P-r*F[17]+J*F[15],w[k+1]=u+Y,w[k+2]=u-Y,u=M*F[13]-S-$*F[14]+x*F[12],Y=-dt*F[17]+P-r*F[15]+J*F[16],w[k+9]=u+Y,w[k+10]=u-Y,u=M*F[14]-S+$*F[12]-x*F[13],Y=dt*F[15]-P+r*F[16]-J*F[17],w[k+13]=u+Y,w[k+14]=u-Y}{var O,T,K,tt,Q,l,a,s;O=i[8]-i[0],K=i[6]-i[2],tt=i[5]-i[3],Q=i[17]+i[9],l=i[16]+i[10],a=i[15]+i[11],s=i[14]+i[12],w[k+0]=Q+a+s+(l+i[13]),u=(Q+a+s)*F[19]-(l+i[13]),Y=(O-K+tt)*F[18],w[k+11]=u+Y,w[k+12]=u-Y,T=(i[7]-i[1])*F[18],l=i[13]-l*F[19],u=Q*F[15]-l+a*F[16]+s*F[17],Y=O*F[14]+T+K*F[12]+tt*F[13],w[k+3]=u+Y,w[k+4]=u-Y,u=-Q*F[17]+l-a*F[15]-s*F[16],Y=O*F[13]+T-K*F[14]-tt*F[12],w[k+7]=u+Y,w[k+8]=u-Y,u=-Q*F[16]+l-a*F[17]-s*F[15],Y=O*F[12]-T+K*F[13]-tt*F[14],w[k+15]=u+Y,w[k+16]=u-Y}}this.mdct_sub48=function(w,k,i){for(var u=k,Y=286,M=0;M<w.channels_out;M++){for(var S=0;S<w.mode_gr;S++){for(var $,x=w.l3_side.tt[S][M],dt=x.xr,P=0,r=w.sb_sample[M][1-S],J=0,O=0;O<9;O++)for(E(u,Y,r[J]),E(u,Y+32,r[J+1]),J+=2,Y+=64,$=1;$<32;$+=2)r[J-1][$]*=-1;for($=0;$<32;$++,P+=18){var T=x.block_type,K=w.sb_sample[M][S],tt=w.sb_sample[M][1-S];if(x.mixed_block_flag!=0&&$<2&&(T=0),w.amp_filter[$]<0.000000000001)C.fill(dt,P+0,P+18,0);else{if(w.amp_filter[$]<1)for(var O=0;O<18;O++)tt[O][I[$]]*=w.amp_filter[$];if(T==y.SHORT_TYPE){for(var O=-Z/4;O<0;O++){var Q=h[y.SHORT_TYPE][O+3];dt[P+O*3+9]=K[9+O][I[$]]*Q-K[8-O][I[$]],dt[P+O*3+18]=K[14-O][I[$]]*Q+K[15+O][I[$]],dt[P+O*3+10]=K[15+O][I[$]]*Q-K[14-O][I[$]],dt[P+O*3+19]=tt[2-O][I[$]]*Q+tt[3+O][I[$]],dt[P+O*3+11]=tt[3+O][I[$]]*Q-tt[2-O][I[$]],dt[P+O*3+20]=tt[8-O][I[$]]*Q+tt[9+O][I[$]]}D(dt,P)}else{for(var l=b(18),O=-B/4;O<0;O++){var a,s;a=h[T][O+27]*tt[O+9][I[$]]+h[T][O+36]*tt[8-O][I[$]],s=h[T][O+9]*K[O+9][I[$]]-h[T][O+18]*K[8-O][I[$]],l[O+9]=a-s*d[3+O+9],l[O+18]=a*d[3+O+9]+s}g(dt,P,l)}}if(T!=y.SHORT_TYPE&&$!=0)for(var O=7;O>=0;--O){var c,W;c=dt[P+O]*q[20+O]+dt[P+-1-O]*L[28+O],W=dt[P+O]*L[28+O]-dt[P+-1-O]*q[20+O],dt[P+-1-O]=c,dt[P+O]=W}}}if(u=i,Y=286,w.mode_gr==1)for(var _=0;_<18;_++)e.arraycopy(w.sb_sample[M][1][_],0,w.sb_sample[M][0][_],0,32)}}}return Le=j,Le}var Ue,vn;function sr(){if(vn)return Ue;vn=1;var t=si(),e=Ht,n=e.System,C=e.new_float,b=e.new_float_n;function y(){this.l=C(t.SBMAX_l),this.s=b([t.SBMAX_s,3]);var j=this;this.assign=function(z){n.arraycopy(z.l,0,j.l,0,t.SBMAX_l);for(var Z=0;Z<t.SBMAX_s;Z++)for(var B=0;B<3;B++)j.s[Z][B]=z.s[Z][B]}}return Ue=y,Ue}var Oe,zn;function ss(){if(zn)return Oe;zn=1;var t=sr();function e(){this.thm=new t,this.en=new t}return Oe=e,Oe}function yi(t){var e=t;this.ordinal=function(){return e}}yi.STEREO=new yi(0);yi.JOINT_STEREO=new yi(1);yi.DUAL_CHANNEL=new yi(2);yi.MONO=new yi(3);yi.NOT_SET=new yi(4);var ce=yi,Ke,Jn;function si(){if(Jn)return Ke;Jn=1;var t=Ht,e=t.System,n=t.VbrMode,C=t.new_array_n,b=t.new_float,y=t.new_float_n,j=t.new_int,z=t.assert;Z.ENCDELAY=576,Z.POSTDELAY=1152,Z.MDCTDELAY=48,Z.FFTOFFSET=224+Z.MDCTDELAY,Z.DECDELAY=528,Z.SBLIMIT=32,Z.CBANDS=64,Z.SBPSY_l=21,Z.SBPSY_s=12,Z.SBMAX_l=22,Z.SBMAX_s=13,Z.PSFB21=6,Z.PSFB12=6,Z.BLKSIZE=1024,Z.HBLKSIZE=Z.BLKSIZE/2+1,Z.BLKSIZE_s=256,Z.HBLKSIZE_s=Z.BLKSIZE_s/2+1,Z.NORM_TYPE=0,Z.START_TYPE=1,Z.SHORT_TYPE=2,Z.STOP_TYPE=3,Z.MPG_MD_LR_LR=0,Z.MPG_MD_LR_I=1,Z.MPG_MD_MS_LR=2,Z.MPG_MD_MS_I=3,Z.fircoef=[-0.1039435,-0.1892065,-0.21623599999999998,-0.155915,0.00000000000000003898045,0.23387249999999998,0.50455,0.756825,0.9354899999999999];function Z(){var B=rs(),h=ss(),d=ce,F=Z.FFTOFFSET,q=Z.MPG_MD_MS_LR,L=null;this.psy=null;var I=null,E=null,D=null;this.setModules=function(u,Y,M,S){L=u,this.psy=Y,I=Y,E=S,D=M};var g=new B;function w(u){var Y,M;if(u.ATH.useAdjust==0){u.ATH.adjust=1;return}if(M=u.loudness_sq[0][0],Y=u.loudness_sq[1][0],u.channels_out==2?(M+=u.loudness_sq[0][1],Y+=u.loudness_sq[1][1]):(M+=M,Y+=Y),u.mode_gr==2&&(M=Math.max(M,Y)),M*=0.5,M*=u.ATH.aaSensitivityP,M>0.03125)u.ATH.adjust>=1?u.ATH.adjust=1:u.ATH.adjust<u.ATH.adjustLimit&&(u.ATH.adjust=u.ATH.adjustLimit),u.ATH.adjustLimit=1;else{var S=31.98*M+0.000625;u.ATH.adjust>=S?(u.ATH.adjust*=S*0.075+0.925,u.ATH.adjust<S&&(u.ATH.adjust=S)):u.ATH.adjustLimit>=S?u.ATH.adjust=S:u.ATH.adjust<u.ATH.adjustLimit&&(u.ATH.adjust=u.ATH.adjustLimit),u.ATH.adjustLimit=S}}function k(u){var Y,M;for(z(0<=u.bitrate_index&&u.bitrate_index<16),z(0<=u.mode_ext&&u.mode_ext<4),u.bitrate_stereoMode_Hist[u.bitrate_index][4]++,u.bitrate_stereoMode_Hist[15][4]++,u.channels_out==2&&(u.bitrate_stereoMode_Hist[u.bitrate_index][u.mode_ext]++,u.bitrate_stereoMode_Hist[15][u.mode_ext]++),Y=0;Y<u.mode_gr;++Y)for(M=0;M<u.channels_out;++M){var S=u.l3_side.tt[Y][M].block_type|0;u.l3_side.tt[Y][M].mixed_block_flag!=0&&(S=4),u.bitrate_blockType_Hist[u.bitrate_index][S]++,u.bitrate_blockType_Hist[u.bitrate_index][5]++,u.bitrate_blockType_Hist[15][S]++,u.bitrate_blockType_Hist[15][5]++}}function i(u,Y){var M=u.internal_flags,S,$;if(M.lame_encode_frame_init==0){var x,dt,P=b(2014),r=b(2014);for(M.lame_encode_frame_init=1,x=0,dt=0;x<286+576*(1+M.mode_gr);++x)x<576*M.mode_gr?(P[x]=0,M.channels_out==2&&(r[x]=0)):(P[x]=Y[0][dt],M.channels_out==2&&(r[x]=Y[1][dt]),++dt);for($=0;$<M.mode_gr;$++)for(S=0;S<M.channels_out;S++)M.l3_side.tt[$][S].block_type=Z.SHORT_TYPE;g.mdct_sub48(M,P,r),z(576>=Z.FFTOFFSET),z(M.mf_size>=Z.BLKSIZE+u.framesize-Z.FFTOFFSET),z(M.mf_size>=512+u.framesize-32)}}this.lame_encode_mp3_frame=function(u,Y,M,S,$,x){var dt,P=C([2,2]);P[0][0]=new h,P[0][1]=new h,P[1][0]=new h,P[1][1]=new h;var r=C([2,2]);r[0][0]=new h,r[0][1]=new h,r[1][0]=new h,r[1][1]=new h;var J,O=[null,null],T=u.internal_flags,K=y([2,4]),tt=[0.5,0.5],Q=[[0,0],[0,0]],l=[[0,0],[0,0]],a,s,c;if(O[0]=Y,O[1]=M,T.lame_encode_frame_init==0&&i(u,O),T.padding=0,(T.slot_lag-=T.frac_SpF)<0&&(T.slot_lag+=u.out_samplerate,T.padding=1),T.psymodel!=0){var W,_=[null,null],nt=0,X=j(2);for(c=0;c<T.mode_gr;c++){for(s=0;s<T.channels_out;s++)_[s]=O[s],nt=576+c*576-Z.FFTOFFSET;if(u.VBR==n.vbr_mtrh||u.VBR==n.vbr_mt?W=I.L3psycho_anal_vbr(u,_,nt,c,P,r,Q[c],l[c],K[c],X):W=I.L3psycho_anal_ns(u,_,nt,c,P,r,Q[c],l[c],K[c],X),W!=0)return-4;for(u.mode==d.JOINT_STEREO&&(tt[c]=K[c][2]+K[c][3],tt[c]>0&&(tt[c]=K[c][3]/tt[c])),s=0;s<T.channels_out;s++){var R=T.l3_side.tt[c][s];R.block_type=X[s],R.mixed_block_flag=0}}}else for(c=0;c<T.mode_gr;c++)for(s=0;s<T.channels_out;s++)T.l3_side.tt[c][s].block_type=Z.NORM_TYPE,T.l3_side.tt[c][s].mixed_block_flag=0,l[c][s]=Q[c][s]=700;if(w(T),g.mdct_sub48(T,O[0],O[1]),T.mode_ext=Z.MPG_MD_LR_LR,u.force_ms)T.mode_ext=Z.MPG_MD_MS_LR;else if(u.mode==d.JOINT_STEREO){var at=0,pt=0;for(c=0;c<T.mode_gr;c++)for(s=0;s<T.channels_out;s++)at+=l[c][s],pt+=Q[c][s];if(at<=1*pt){var Ct=T.l3_side.tt[0],Dt=T.l3_side.tt[T.mode_gr-1];Ct[0].block_type==Ct[1].block_type&&Dt[0].block_type==Dt[1].block_type&&(T.mode_ext=Z.MPG_MD_MS_LR)}}if(T.mode_ext==q?(J=r,a=l):(J=P,a=Q),u.analysis&&T.pinfo!=null)for(c=0;c<T.mode_gr;c++)for(s=0;s<T.channels_out;s++)T.pinfo.ms_ratio[c]=T.ms_ratio[c],T.pinfo.ms_ener_ratio[c]=tt[c],T.pinfo.blocktype[c][s]=T.l3_side.tt[c][s].block_type,T.pinfo.pe[c][s]=a[c][s],e.arraycopy(T.l3_side.tt[c][s].xr,0,T.pinfo.xr[c][s],0,576),T.mode_ext==q&&(T.pinfo.ers[c][s]=T.pinfo.ers[c][s+2],e.arraycopy(T.pinfo.energy[c][s+2],0,T.pinfo.energy[c][s],0,T.pinfo.energy[c][s].length));if(u.VBR==n.vbr_off||u.VBR==n.vbr_abr){var Wt,Pt;for(Wt=0;Wt<18;Wt++)T.nsPsy.pefirbuf[Wt]=T.nsPsy.pefirbuf[Wt+1];for(Pt=0,c=0;c<T.mode_gr;c++)for(s=0;s<T.channels_out;s++)Pt+=a[c][s];for(T.nsPsy.pefirbuf[18]=Pt,Pt=T.nsPsy.pefirbuf[9],Wt=0;Wt<9;Wt++)Pt+=(T.nsPsy.pefirbuf[Wt]+T.nsPsy.pefirbuf[18-Wt])*Z.fircoef[Wt];for(Pt=3350*T.mode_gr*T.channels_out/Pt,c=0;c<T.mode_gr;c++)for(s=0;s<T.channels_out;s++)a[c][s]*=Pt}if(T.iteration_loop.iteration_loop(u,a,tt,J),L.format_bitstream(u),dt=L.copy_buffer(T,S,$,x,1),u.bWriteVbrTag&&E.addVbrFrame(u),u.analysis&&T.pinfo!=null){for(s=0;s<T.channels_out;s++){var Yt;for(Yt=0;Yt<F;Yt++)T.pinfo.pcmdata[s][Yt]=T.pinfo.pcmdata[s][Yt+u.framesize];for(Yt=F;Yt<1600;Yt++)T.pinfo.pcmdata[s][Yt]=O[s][Yt-F]}D.set_frame_pinfo(u,J)}return k(T),dt}}return Ke=Z,Ke}var or=Ht,Yn=or.Util,Gn=or.new_float,At=si();function os(){var t=Gn(At.BLKSIZE),e=Gn(At.BLKSIZE_s/2),n=[0.9238795325112867,0.3826834323650898,0.9951847266721969,0.0980171403295606,0.9996988186962042,0.02454122852291229,0.9999811752826011,0.006135884649154475];function C(y,j,z){var Z=0,B,h,d;z<<=1;var F=j+z;B=4;do{var q,L,I,E,D,g,w;w=B>>1,E=B,D=B<<1,g=D+E,B=D<<1,h=j,d=h+w;do{var k,i,u,Y;i=y[h+0]-y[h+E],k=y[h+0]+y[h+E],Y=y[h+D]-y[h+g],u=y[h+D]+y[h+g],y[h+D]=k-u,y[h+0]=k+u,y[h+g]=i-Y,y[h+E]=i+Y,i=y[d+0]-y[d+E],k=y[d+0]+y[d+E],Y=Yn.SQRT2*y[d+g],u=Yn.SQRT2*y[d+D],y[d+D]=k-u,y[d+0]=k+u,y[d+g]=i-Y,y[d+E]=i+Y,d+=B,h+=B}while(h<F);for(L=n[Z+0],q=n[Z+1],I=1;I<w;I++){var M,S;M=1-2*q*q,S=2*q*L,h=j+I,d=j+E-I;do{var $,x,dt,k,i,P,u,r,Y,J;x=S*y[h+E]-M*y[d+E],$=M*y[h+E]+S*y[d+E],i=y[h+0]-$,k=y[h+0]+$,P=y[d+0]-x,dt=y[d+0]+x,x=S*y[h+g]-M*y[d+g],$=M*y[h+g]+S*y[d+g],Y=y[h+D]-$,u=y[h+D]+$,J=y[d+D]-x,r=y[d+D]+x,x=q*u-L*J,$=L*u+q*J,y[h+D]=k-$,y[h+0]=k+$,y[d+g]=P-x,y[d+E]=P+x,x=L*r-q*Y,$=q*r+L*Y,y[d+D]=dt-$,y[d+0]=dt+$,y[h+g]=i-x,y[h+E]=i+x,d+=B,h+=B}while(h<F);M=L,L=M*n[Z+0]-q*n[Z+1],q=M*n[Z+1]+q*n[Z+0]}Z+=2}while(B<z)}var b=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(y,j,z,Z,B){for(var h=0;h<3;h++){var d=At.BLKSIZE_s/2,F=65535&192*(h+1),q=At.BLKSIZE_s/8-1;do{var L,I,E,D,g,w=b[q<<2]&255;L=e[w]*Z[z][B+w+F],g=e[127-w]*Z[z][B+w+F+128],I=L-g,L=L+g,E=e[w+64]*Z[z][B+w+F+64],g=e[63-w]*Z[z][B+w+F+192],D=E-g,E=E+g,d-=4,j[h][d+0]=L+E,j[h][d+2]=L-E,j[h][d+1]=I+D,j[h][d+3]=I-D,L=e[w+1]*Z[z][B+w+F+1],g=e[126-w]*Z[z][B+w+F+129],I=L-g,L=L+g,E=e[w+65]*Z[z][B+w+F+65],g=e[62-w]*Z[z][B+w+F+193],D=E-g,E=E+g,j[h][d+At.BLKSIZE_s/2+0]=L+E,j[h][d+At.BLKSIZE_s/2+2]=L-E,j[h][d+At.BLKSIZE_s/2+1]=I+D,j[h][d+At.BLKSIZE_s/2+3]=I-D}while(--q>=0);C(j[h],d,At.BLKSIZE_s/2)}},this.fft_long=function(y,j,z,Z,B){var h=At.BLKSIZE/8-1,d=At.BLKSIZE/2;do{var F,q,L,I,E,D=b[h]&255;F=t[D]*Z[z][B+D],E=t[D+512]*Z[z][B+D+512],q=F-E,F=F+E,L=t[D+256]*Z[z][B+D+256],E=t[D+768]*Z[z][B+D+768],I=L-E,L=L+E,d-=4,j[d+0]=F+L,j[d+2]=F-L,j[d+1]=q+I,j[d+3]=q-I,F=t[D+1]*Z[z][B+D+1],E=t[D+513]*Z[z][B+D+513],q=F-E,F=F+E,L=t[D+257]*Z[z][B+D+257],E=t[D+769]*Z[z][B+D+769],I=L-E,L=L+E,j[d+At.BLKSIZE/2+0]=F+L,j[d+At.BLKSIZE/2+2]=F-L,j[d+At.BLKSIZE/2+1]=q+I,j[d+At.BLKSIZE/2+3]=q-I}while(--h>=0);C(j,d,At.BLKSIZE/2)},this.init_fft=function(y){for(var j=0;j<At.BLKSIZE;j++)t[j]=0.42-0.5*Math.cos(2*Math.PI*(j+0.5)/At.BLKSIZE)+0.08*Math.cos(4*Math.PI*(j+0.5)/At.BLKSIZE);for(var j=0;j<At.BLKSIZE_s/2;j++)e[j]=0.5*(1-Math.cos(2*Math.PI*(j+0.5)/At.BLKSIZE_s))}}var as=os,Zi=Ht,Ni=Zi.VbrMode,bn=Zi.Float,Hi=Zi.ShortBlock,li=Zi.Util,ds=Zi.Arrays,ii=Zi.new_float,fi=Zi.new_float_n,Li=Zi.new_int,Mt=Zi.assert,ls=as,ot=si();function hs(){var t=ce,e=new ls,n=2.302585092994046,C=2,b=16,y=2,j=16,z=0.34,Z=0.000000004595134127921476/(ot.BLKSIZE/2),B=0.01,h=0.8,d=0.6,F=0.3,q=3.5,L=21,I=0.2302585093;function E(m){return m}function D(m,f){for(var G=0,U=0;U<ot.BLKSIZE/2;++U)G+=m[U]*f.ATH.eql_w[U];return G*=Z,G}function g(m,f,G,U,H,v,V,A,N,rt,it){var st=m.internal_flags;if(N<2)e.fft_long(st,U[H],N,rt,it),e.fft_short(st,v[V],N,rt,it);else if(N==2){for(var gt=ot.BLKSIZE-1;gt>=0;--gt){var jt=U[H+0][gt],lt=U[H+1][gt];U[H+0][gt]=(jt+lt)*li.SQRT2*0.5,U[H+1][gt]=(jt-lt)*li.SQRT2*0.5}for(var bt=2;bt>=0;--bt)for(var gt=ot.BLKSIZE_s-1;gt>=0;--gt){var jt=v[V+0][bt][gt],lt=v[V+1][bt][gt];v[V+0][bt][gt]=(jt+lt)*li.SQRT2*0.5,v[V+1][bt][gt]=(jt-lt)*li.SQRT2*0.5}}f[0]=U[H+0][0],f[0]*=f[0];for(var gt=ot.BLKSIZE/2-1;gt>=0;--gt){var et=U[H+0][ot.BLKSIZE/2-gt],kt=U[H+0][ot.BLKSIZE/2+gt];f[ot.BLKSIZE/2-gt]=(et*et+kt*kt)*0.5}for(var bt=2;bt>=0;--bt){G[bt][0]=v[V+0][bt][0],G[bt][0]*=G[bt][0];for(var gt=ot.BLKSIZE_s/2-1;gt>=0;--gt){var et=v[V+0][bt][ot.BLKSIZE_s/2-gt],kt=v[V+0][bt][ot.BLKSIZE_s/2+gt];G[bt][ot.BLKSIZE_s/2-gt]=(et*et+kt*kt)*0.5}}{for(var Xt=0,gt=11;gt<ot.HBLKSIZE;gt++)Xt+=f[gt];st.tot_ener[N]=Xt}if(m.analysis){for(var gt=0;gt<ot.HBLKSIZE;gt++)st.pinfo.energy[A][N][gt]=st.pinfo.energy_save[N][gt],st.pinfo.energy_save[N][gt]=f[gt];st.pinfo.pe[A][N]=st.pe[N]}m.athaa_loudapprox==2&&N<2&&(st.loudness_sq[A][N]=st.loudness_sq_save[N],st.loudness_sq_save[N]=D(f,st))}var w=8,k=23,i=15,u,Y,M,S=[1,0.79433,0.63096,0.63096,0.63096,0.63096,0.63096,0.25119,0.11749];function $(){u=Math.pow(10,(w+1)/16),Y=Math.pow(10,(k+1)/16),M=Math.pow(10,i/10)}var x=[11.052965160000001,10.487040256900002,9.9500500969,9.0247369744,8.1854926609,7.0440875649,6.061887168099999,5.2166559999999995,4.4892710641,3.8632688703999998,3.3246052225000002,2.8610369315999997,2.4621061921,2.1508568964,1.8789281476000002,1.7170433295999998,1.5691069696,1.4555939904,1.3503137208999998,1.2715945225,1.1974487183999998,1.1361428100000002,1.0779838276,1.0382591025,1],dt=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1],P=[5.5396212496,5.255968908100001,4.9868695969,4.523065562499999,4.102447702500001,3.5304155236000003,3.0381535809000004,2.6145273025000004,2.2499700001,1.9362165904000002,1.6662420888999998,1.4339104515999999,1.2339655056,1.0779838276];function r(m,f,G,U,H,v){var V;if(f>m)if(f<m*Y)V=f/m;else return m+f;else{if(m>=f*Y)return m+f;V=m/f}if(m+=f,U+3<=6){if(V>=u)return m;var A=0|li.FAST_LOG10_X(V,16);return m*dt[A]}var A=0|li.FAST_LOG10_X(V,16);if(v!=0?f=H.ATH.cb_s[G]*H.ATH.adjust:f=H.ATH.cb_l[G]*H.ATH.adjust,m<M*f){if(m>f){var N,rt;return N=1,A<=13&&(N=P[A]),rt=li.FAST_LOG10_X(m/f,0.6666666666666666),m*((x[A]-N)*rt+N)}return A>13?m:m*P[A]}return m*x[A]}var J=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1];function O(m,f,G){var U;if(m<0&&(m=0),f<0&&(f=0),m<=0)return f;if(f<=0)return m;if(f>m?U=f/m:U=m/f,-2<=G&&G<=2){if(U>=u)return m+f;var H=0|li.FAST_LOG10_X(U,16);return(m+f)*J[H]}return U<Y?m+f:(m<f&&(m=f),m)}function T(m,f){var G=m.internal_flags;if(G.channels_out>1){for(var U=0;U<ot.SBMAX_l;U++){var H=G.thm[0].l[U],v=G.thm[1].l[U];G.thm[0].l[U]+=v*f,G.thm[1].l[U]+=H*f}for(var U=0;U<ot.SBMAX_s;U++)for(var V=0;V<3;V++){var H=G.thm[0].s[U][V],v=G.thm[1].s[U][V];G.thm[0].s[U][V]+=v*f,G.thm[1].s[U][V]+=H*f}}}function K(m){for(var f=0;f<ot.SBMAX_l;f++)if(!(m.thm[0].l[f]>1.58*m.thm[1].l[f]||m.thm[1].l[f]>1.58*m.thm[0].l[f])){var G=m.mld_l[f]*m.en[3].l[f],U=Math.max(m.thm[2].l[f],Math.min(m.thm[3].l[f],G));G=m.mld_l[f]*m.en[2].l[f];var H=Math.max(m.thm[3].l[f],Math.min(m.thm[2].l[f],G));m.thm[2].l[f]=U,m.thm[3].l[f]=H}for(var f=0;f<ot.SBMAX_s;f++)for(var v=0;v<3;v++)if(!(m.thm[0].s[f][v]>1.58*m.thm[1].s[f][v]||m.thm[1].s[f][v]>1.58*m.thm[0].s[f][v])){var G=m.mld_s[f]*m.en[3].s[f][v],U=Math.max(m.thm[2].s[f][v],Math.min(m.thm[3].s[f][v],G));G=m.mld_s[f]*m.en[2].s[f][v];var H=Math.max(m.thm[3].s[f][v],Math.min(m.thm[2].s[f][v],G));m.thm[2].s[f][v]=U,m.thm[3].s[f][v]=H}}function tt(m,f,G){var U=f,H=Math.pow(10,G);f*=2,U*=2;for(var v=0;v<ot.SBMAX_l;v++){var V,A,N,rt;if(rt=m.ATH.cb_l[m.bm_l[v]]*H,V=Math.min(Math.max(m.thm[0].l[v],rt),Math.max(m.thm[1].l[v],rt)),A=Math.max(m.thm[2].l[v],rt),N=Math.max(m.thm[3].l[v],rt),V*f<A+N){var it=V*U/(A+N);A*=it,N*=it}m.thm[2].l[v]=Math.min(A,m.thm[2].l[v]),m.thm[3].l[v]=Math.min(N,m.thm[3].l[v])}H*=ot.BLKSIZE_s/ot.BLKSIZE;for(var v=0;v<ot.SBMAX_s;v++)for(var st=0;st<3;st++){var V,A,N,rt;if(rt=m.ATH.cb_s[m.bm_s[v]]*H,V=Math.min(Math.max(m.thm[0].s[v][st],rt),Math.max(m.thm[1].s[v][st],rt)),A=Math.max(m.thm[2].s[v][st],rt),N=Math.max(m.thm[3].s[v][st],rt),V*f<A+N){var it=V*f/(A+N);A*=it,N*=it}m.thm[2].s[v][st]=Math.min(m.thm[2].s[v][st],A),m.thm[3].s[v][st]=Math.min(m.thm[3].s[v][st],N)}}function Q(m,f,G,U,H){var v,V,A=0,N=0;for(v=V=0;v<ot.SBMAX_s;++V,++v){for(var rt=m.bo_s[v],it=m.npart_s,st=rt<it?rt:it;V<st;)Mt(f[V]>=0),Mt(G[V]>=0),A+=f[V],N+=G[V],V++;if(m.en[U].s[v][H]=A,m.thm[U].s[v][H]=N,V>=it){++v;break}Mt(f[V]>=0),Mt(G[V]>=0);{var gt=m.PSY.bo_s_weight[v],jt=1-gt;A=gt*f[V],N=gt*G[V],m.en[U].s[v][H]+=A,m.thm[U].s[v][H]+=N,A=jt*f[V],N=jt*G[V]}}for(;v<ot.SBMAX_s;++v)m.en[U].s[v][H]=0,m.thm[U].s[v][H]=0}function l(m,f,G,U){var H,v,V=0,A=0;for(H=v=0;H<ot.SBMAX_l;++v,++H){for(var N=m.bo_l[H],rt=m.npart_l,it=N<rt?N:rt;v<it;)Mt(f[v]>=0),Mt(G[v]>=0),V+=f[v],A+=G[v],v++;if(m.en[U].l[H]=V,m.thm[U].l[H]=A,v>=rt){++H;break}Mt(f[v]>=0),Mt(G[v]>=0);{var st=m.PSY.bo_l_weight[H],gt=1-st;V=st*f[v],A=st*G[v],m.en[U].l[H]+=V,m.thm[U].l[H]+=A,V=gt*f[v],A=gt*G[v]}}for(;H<ot.SBMAX_l;++H)m.en[U].l[H]=0,m.thm[U].l[H]=0}function a(m,f,G,U,H,v){var V=m.internal_flags,A,N;for(N=A=0;N<V.npart_s;++N){for(var rt=0,it=V.numlines_s[N],st=0;st<it;++st,++A){var gt=f[v][A];rt+=gt}G[N]=rt}for(Mt(N==V.npart_s),A=N=0;N<V.npart_s;N++){var jt=V.s3ind_s[N][0],lt=V.s3_ss[A++]*G[jt];for(++jt;jt<=V.s3ind_s[N][1];)lt+=V.s3_ss[A]*G[jt],++A,++jt;{var bt=y*V.nb_s1[H][N];U[N]=Math.min(lt,bt)}if(V.blocktype_old[H&1]==ot.SHORT_TYPE){var bt=j*V.nb_s2[H][N],et=U[N];U[N]=Math.min(bt,et)}V.nb_s2[H][N]=V.nb_s1[H][N],V.nb_s1[H][N]=lt,Mt(U[N]>=0)}for(;N<=ot.CBANDS;++N)G[N]=0,U[N]=0}function s(m,f,G,U){var H=m.internal_flags;m.short_blocks==Hi.short_block_coupled&&!(f[0]!=0&&f[1]!=0)&&(f[0]=f[1]=0);for(var v=0;v<H.channels_out;v++)U[v]=ot.NORM_TYPE,m.short_blocks==Hi.short_block_dispensed&&(f[v]=1),m.short_blocks==Hi.short_block_forced&&(f[v]=0),f[v]!=0?(Mt(H.blocktype_old[v]!=ot.START_TYPE),H.blocktype_old[v]==ot.SHORT_TYPE&&(U[v]=ot.STOP_TYPE)):(U[v]=ot.SHORT_TYPE,H.blocktype_old[v]==ot.NORM_TYPE&&(H.blocktype_old[v]=ot.START_TYPE),H.blocktype_old[v]==ot.STOP_TYPE&&(H.blocktype_old[v]=ot.SHORT_TYPE)),G[v]=H.blocktype_old[v],H.blocktype_old[v]=U[v]}function c(m,f,G){return G>=1?m:G<=0?f:f>0?Math.pow(m/f,G)*f:0}var W=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function _(m,f){for(var G=309.07,U=0;U<ot.SBMAX_s-1;U++)for(var H=0;H<3;H++){var v=m.thm.s[U][H];if(v>0){var V=v*f,A=m.en.s[U][H];A>V&&(A>V*10000000000?G+=W[U]*(10*n):G+=W[U]*li.FAST_LOG10(A/V))}}return G}var nt=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function X(m,f){for(var G=281.0575,U=0;U<ot.SBMAX_l-1;U++){var H=m.thm.l[U];if(H>0){var v=H*f,V=m.en.l[U];V>v&&(V>v*10000000000?G+=nt[U]*(10*n):G+=nt[U]*li.FAST_LOG10(V/v))}}return G}function R(m,f,G,U,H){var v,V;for(v=V=0;v<m.npart_l;++v){var A=0,N=0,rt;for(rt=0;rt<m.numlines_l[v];++rt,++V){var it=f[V];A+=it,N<it&&(N=it)}G[v]=A,U[v]=N,H[v]=A*m.rnumlines_l[v],Mt(m.rnumlines_l[v]>=0),Mt(G[v]>=0),Mt(U[v]>=0),Mt(H[v]>=0)}}function at(m,f,G,U){var H=S.length-1,v=0,V=G[v]+G[v+1];if(V>0){var A=f[v];A<f[v+1]&&(A=f[v+1]),Mt(m.numlines_l[v]+m.numlines_l[v+1]-1>0),V=20*(A*2-V)/(V*(m.numlines_l[v]+m.numlines_l[v+1]-1));var N=0|V;N>H&&(N=H),U[v]=N}else U[v]=0;for(v=1;v<m.npart_l-1;v++)if(V=G[v-1]+G[v]+G[v+1],V>0){var A=f[v-1];A<f[v]&&(A=f[v]),A<f[v+1]&&(A=f[v+1]),Mt(m.numlines_l[v-1]+m.numlines_l[v]+m.numlines_l[v+1]-1>0),V=20*(A*3-V)/(V*(m.numlines_l[v-1]+m.numlines_l[v]+m.numlines_l[v+1]-1));var N=0|V;N>H&&(N=H),U[v]=N}else U[v]=0;if(Mt(v==m.npart_l-1),V=G[v-1]+G[v],V>0){var A=f[v-1];A<f[v]&&(A=f[v]),Mt(m.numlines_l[v-1]+m.numlines_l[v]-1>0),V=20*(A*2-V)/(V*(m.numlines_l[v-1]+m.numlines_l[v]-1));var N=0|V;N>H&&(N=H),U[v]=N}else U[v]=0;Mt(v==m.npart_l-1)}var pt=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];this.L3psycho_anal_ns=function(m,f,G,U,H,v,V,A,N,rt){var it=m.internal_flags,st=fi([2,ot.BLKSIZE]),gt=fi([2,3,ot.BLKSIZE_s]),jt=ii(ot.CBANDS+1),lt=ii(ot.CBANDS+1),bt=ii(ot.CBANDS+2),et=Li(2),kt=Li(2),Xt,ht,vt,ct,Zt,Tt,wt,Qt,Lt=fi([2,576]),Et,ui=Li(ot.CBANDS+2),Rt=Li(ot.CBANDS+2);for(ds.fill(Rt,0),Xt=it.channels_out,m.mode==t.JOINT_STEREO&&(Xt=4),m.VBR==Ni.vbr_off?Et=it.ResvMax==0?0:it.ResvSize/it.ResvMax*0.5:m.VBR==Ni.vbr_rh||m.VBR==Ni.vbr_mtrh||m.VBR==Ni.vbr_mt?Et=0.6:Et=1,ht=0;ht<it.channels_out;ht++){var Vt=f[ht],ai=G+576-350-L+192;for(ct=0;ct<576;ct++){var pi,gi;for(pi=Vt[ai+ct+10],gi=0,Zt=0;Zt<(L-1)/2-1;Zt+=2)pi+=pt[Zt]*(Vt[ai+ct+Zt]+Vt[ai+ct+L-Zt]),gi+=pt[Zt+1]*(Vt[ai+ct+Zt+1]+Vt[ai+ct+L-Zt-1]);Lt[ht][ct]=pi+gi}H[U][ht].en.assign(it.en[ht]),H[U][ht].thm.assign(it.thm[ht]),Xt>2&&(v[U][ht].en.assign(it.en[ht+2]),v[U][ht].thm.assign(it.thm[ht+2]))}for(ht=0;ht<Xt;ht++){var Pi,Wi,ri=ii(12),Ji=[0,0,0,0],Vi=ii(12),je=1,gn,mn=ii(ot.CBANDS),wn=ii(ot.CBANDS),Nt=[0,0,0,0],fn=ii(ot.HBLKSIZE),Cn=fi([3,ot.HBLKSIZE_s]);for(Mt(it.npart_s<=ot.CBANDS),Mt(it.npart_l<=ot.CBANDS),ct=0;ct<3;ct++)ri[ct]=it.nsPsy.last_en_subshort[ht][ct+6],Mt(it.nsPsy.last_en_subshort[ht][ct+4]>0),Vi[ct]=ri[ct]/it.nsPsy.last_en_subshort[ht][ct+4],Ji[0]+=ri[ct];if(ht==2)for(ct=0;ct<576;ct++){var Ze,$e;Ze=Lt[0][ct],$e=Lt[1][ct],Lt[0][ct]=Ze+$e,Lt[1][ct]=Ze-$e}{var Pn=Lt[ht&1],ne=0;for(ct=0;ct<9;ct++){for(var Ar=ne+64,ni=1;ne<Ar;ne++)ni<Math.abs(Pn[ne])&&(ni=Math.abs(Pn[ne]));it.nsPsy.last_en_subshort[ht][ct]=ri[ct+3]=ni,Ji[1+ct/3]+=ni,ni>ri[ct+3-2]?(Mt(ri[ct+3-2]>0),ni=ni/ri[ct+3-2]):ri[ct+3-2]>ni*10?ni=ri[ct+3-2]/(ni*10):ni=0,Vi[ct+3]=ni}}if(m.analysis){var Fe=Vi[0];for(ct=1;ct<12;ct++)Fe<Vi[ct]&&(Fe=Vi[ct]);it.pinfo.ers[U][ht]=it.pinfo.ers_save[ht],it.pinfo.ers_save[ht]=Fe}for(gn=ht==3?it.nsPsy.attackthre_s:it.nsPsy.attackthre,ct=0;ct<12;ct++)Nt[ct/3]==0&&Vi[ct]>gn&&(Nt[ct/3]=ct%3+1);for(ct=1;ct<4;ct++){var Qe;Ji[ct-1]>Ji[ct]?(Mt(Ji[ct]>0),Qe=Ji[ct-1]/Ji[ct]):(Mt(Ji[ct-1]>0),Qe=Ji[ct]/Ji[ct-1]),Qe<1.7&&(Nt[ct]=0,ct==1&&(Nt[0]=0))}for(Nt[0]!=0&&it.nsPsy.lastAttacks[ht]!=0&&(Nt[0]=0),(it.nsPsy.lastAttacks[ht]==3||Nt[0]+Nt[1]+Nt[2]+Nt[3]!=0)&&(je=0,Nt[1]!=0&&Nt[0]!=0&&(Nt[1]=0),Nt[2]!=0&&Nt[1]!=0&&(Nt[2]=0),Nt[3]!=0&&Nt[2]!=0&&(Nt[3]=0)),ht<2?kt[ht]=je:je==0&&(kt[0]=kt[1]=0),N[ht]=it.tot_ener[ht],Wi=gt,Pi=st,g(m,fn,Cn,Pi,ht&1,Wi,ht&1,U,ht,f,G),R(it,fn,jt,mn,wn),at(it,mn,wn,ui),Qt=0;Qt<3;Qt++){var Me,di;for(a(m,Cn,lt,bt,ht,Qt),Q(it,lt,bt,ht,Qt),wt=0;wt<ot.SBMAX_s;wt++){if(di=it.thm[ht].s[wt][Qt],di*=h,Nt[Qt]>=2||Nt[Qt+1]==1){var re=Qt!=0?Qt-1:2,ni=c(it.thm[ht].s[wt][re],di,d*Et);di=Math.min(di,ni)}if(Nt[Qt]==1){var re=Qt!=0?Qt-1:2,ni=c(it.thm[ht].s[wt][re],di,F*Et);di=Math.min(di,ni)}else if(Qt!=0&&Nt[Qt-1]==3||Qt==0&&it.nsPsy.lastAttacks[ht]==3){var re=Qt!=2?Qt+1:0,ni=c(it.thm[ht].s[wt][re],di,F*Et);di=Math.min(di,ni)}Me=ri[Qt*3+3]+ri[Qt*3+4]+ri[Qt*3+5],ri[Qt*3+5]*6<Me&&(di*=0.5,ri[Qt*3+4]*6<Me&&(di*=0.5)),it.thm[ht].s[wt][Qt]=di}}for(it.nsPsy.lastAttacks[ht]=Nt[2],Tt=0,vt=0;vt<it.npart_l;vt++){for(var xi=it.s3ind[vt][0],xe=jt[xi]*S[ui[xi]],Xi=it.s3_ll[Tt++]*xe;++xi<=it.s3ind[vt][1];)xe=jt[xi]*S[ui[xi]],Xi=r(Xi,it.s3_ll[Tt++]*xe,xi,xi-vt,it,0);Xi*=0.158489319246111,it.blocktype_old[ht&1]==ot.SHORT_TYPE?bt[vt]=Xi:bt[vt]=c(Math.min(Xi,Math.min(C*it.nb_1[ht][vt],b*it.nb_2[ht][vt])),Xi,Et),it.nb_2[ht][vt]=it.nb_1[ht][vt],it.nb_1[ht][vt]=Xi}for(;vt<=ot.CBANDS;++vt)jt[vt]=0,bt[vt]=0;l(it,jt,bt,ht)}if((m.mode==t.STEREO||m.mode==t.JOINT_STEREO)&&m.interChRatio>0&&T(m,m.interChRatio),m.mode==t.JOINT_STEREO){var Xe;K(it),Xe=m.msfix,Math.abs(Xe)>0&&tt(it,Xe,m.ATHlower*it.ATH.adjust)}for(s(m,kt,rt,et),ht=0;ht<Xt;ht++){var se,oe=0,pe,ge;ht>1?(se=A,oe=-2,pe=ot.NORM_TYPE,(rt[0]==ot.SHORT_TYPE||rt[1]==ot.SHORT_TYPE)&&(pe=ot.SHORT_TYPE),ge=v[U][ht-2]):(se=V,oe=0,pe=rt[ht],ge=H[U][ht]),pe==ot.SHORT_TYPE?se[oe+ht]=_(ge,it.masking_lower):se[oe+ht]=X(ge,it.masking_lower),m.analysis&&(it.pinfo.pe[U][ht]=se[oe+ht])}return 0};function Ct(m,f,G,U,H,v,V,A){var N=m.internal_flags;if(U<2)e.fft_long(N,V[A],U,f,G);else if(U==2)for(var rt=ot.BLKSIZE-1;rt>=0;--rt){var it=V[A+0][rt],st=V[A+1][rt];V[A+0][rt]=(it+st)*li.SQRT2*0.5,V[A+1][rt]=(it-st)*li.SQRT2*0.5}v[0]=V[A+0][0],v[0]*=v[0];for(var rt=ot.BLKSIZE/2-1;rt>=0;--rt){var gt=V[A+0][ot.BLKSIZE/2-rt],jt=V[A+0][ot.BLKSIZE/2+rt];v[ot.BLKSIZE/2-rt]=(gt*gt+jt*jt)*0.5}{for(var lt=0,rt=11;rt<ot.HBLKSIZE;rt++)lt+=v[rt];N.tot_ener[U]=lt}if(m.analysis){for(var rt=0;rt<ot.HBLKSIZE;rt++)N.pinfo.energy[H][U][rt]=N.pinfo.energy_save[U][rt],N.pinfo.energy_save[U][rt]=v[rt];N.pinfo.pe[H][U]=N.pe[U]}}function Dt(m,f,G,U,H,v,V,A){var N=m.internal_flags;if(H==0&&U<2&&e.fft_short(N,V[A],U,f,G),U==2)for(var rt=ot.BLKSIZE_s-1;rt>=0;--rt){var it=V[A+0][H][rt],st=V[A+1][H][rt];V[A+0][H][rt]=(it+st)*li.SQRT2*0.5,V[A+1][H][rt]=(it-st)*li.SQRT2*0.5}v[H][0]=V[A+0][H][0],v[H][0]*=v[H][0];for(var rt=ot.BLKSIZE_s/2-1;rt>=0;--rt){var gt=V[A+0][H][ot.BLKSIZE_s/2-rt],jt=V[A+0][H][ot.BLKSIZE_s/2+rt];v[H][ot.BLKSIZE_s/2-rt]=(gt*gt+jt*jt)*0.5}}function Wt(m,f,G,U){var H=m.internal_flags;m.athaa_loudapprox==2&&G<2&&(H.loudness_sq[f][G]=H.loudness_sq_save[G],H.loudness_sq_save[G]=D(U,H))}var Pt=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];function Yt(m,f,G,U,H,v,V,A,N,rt){for(var it=fi([2,576]),st=m.internal_flags,gt=st.channels_out,jt=m.mode==t.JOINT_STEREO?4:gt,lt=0;lt<gt;lt++){firbuf=f[lt];for(var bt=G+576-350-L+192,et=0;et<576;et++){var kt,Xt;kt=firbuf[bt+et+10],Xt=0;for(var ht=0;ht<(L-1)/2-1;ht+=2)kt+=Pt[ht]*(firbuf[bt+et+ht]+firbuf[bt+et+L-ht]),Xt+=Pt[ht+1]*(firbuf[bt+et+ht+1]+firbuf[bt+et+L-ht-1]);it[lt][et]=kt+Xt}H[U][lt].en.assign(st.en[lt]),H[U][lt].thm.assign(st.thm[lt]),jt>2&&(v[U][lt].en.assign(st.en[lt+2]),v[U][lt].thm.assign(st.thm[lt+2]))}for(var lt=0;lt<jt;lt++){var vt=ii(12),ct=ii(12),Zt=[0,0,0,0],Tt=it[lt&1],wt=0,Qt=lt==3?st.nsPsy.attackthre_s:st.nsPsy.attackthre,Lt=1;if(lt==2)for(var et=0,ht=576;ht>0;++et,--ht){var Et=it[0][et],ui=it[1][et];it[0][et]=Et+ui,it[1][et]=Et-ui}for(var et=0;et<3;et++)ct[et]=st.nsPsy.last_en_subshort[lt][et+6],Mt(st.nsPsy.last_en_subshort[lt][et+4]>0),vt[et]=ct[et]/st.nsPsy.last_en_subshort[lt][et+4],Zt[0]+=ct[et];for(var et=0;et<9;et++){for(var Rt=wt+64,Vt=1;wt<Rt;wt++)Vt<Math.abs(Tt[wt])&&(Vt=Math.abs(Tt[wt]));st.nsPsy.last_en_subshort[lt][et]=ct[et+3]=Vt,Zt[1+et/3]+=Vt,Vt>ct[et+3-2]?(Mt(ct[et+3-2]>0),Vt=Vt/ct[et+3-2]):ct[et+3-2]>Vt*10?Vt=ct[et+3-2]/(Vt*10):Vt=0,vt[et+3]=Vt}for(var et=0;et<3;++et){var ai=ct[et*3+3]+ct[et*3+4]+ct[et*3+5],pi=1;ct[et*3+5]*6<ai&&(pi*=0.5,ct[et*3+4]*6<ai&&(pi*=0.5)),A[lt][et]=pi}if(m.analysis){for(var gi=vt[0],et=1;et<12;et++)gi<vt[et]&&(gi=vt[et]);st.pinfo.ers[U][lt]=st.pinfo.ers_save[lt],st.pinfo.ers_save[lt]=gi}for(var et=0;et<12;et++)N[lt][et/3]==0&&vt[et]>Qt&&(N[lt][et/3]=et%3+1);for(var et=1;et<4;et++){var Pi=Zt[et-1],Wi=Zt[et],ri=Math.max(Pi,Wi);ri<40000&&Pi<1.7*Wi&&Wi<1.7*Pi&&(et==1&&N[lt][0]<=N[lt][et]&&(N[lt][0]=0),N[lt][et]=0)}N[lt][0]<=st.nsPsy.lastAttacks[lt]&&(N[lt][0]=0),(st.nsPsy.lastAttacks[lt]==3||N[lt][0]+N[lt][1]+N[lt][2]+N[lt][3]!=0)&&(Lt=0,N[lt][1]!=0&&N[lt][0]!=0&&(N[lt][1]=0),N[lt][2]!=0&&N[lt][1]!=0&&(N[lt][2]=0),N[lt][3]!=0&&N[lt][2]!=0&&(N[lt][3]=0)),lt<2?rt[lt]=Lt:Lt==0&&(rt[0]=rt[1]=0),V[lt]=st.tot_ener[lt]}}function St(m,f,G){if(G==0)for(var U=0;U<m.npart_s;U++)m.nb_s2[f][U]=m.nb_s1[f][U],m.nb_s1[f][U]=0}function wi(m,f){for(var G=0;G<m.npart_l;G++)m.nb_2[f][G]=m.nb_1[f][G],m.nb_1[f][G]=0}function o(m,f,G,U){var H=S.length-1,v=0,V=G[v]+G[v+1];if(V>0){var A=f[v];A<f[v+1]&&(A=f[v+1]),Mt(m.numlines_s[v]+m.numlines_s[v+1]-1>0),V=20*(A*2-V)/(V*(m.numlines_s[v]+m.numlines_s[v+1]-1));var N=0|V;N>H&&(N=H),U[v]=N}else U[v]=0;for(v=1;v<m.npart_s-1;v++)if(V=G[v-1]+G[v]+G[v+1],Mt(v+1<m.npart_s),V>0){var A=f[v-1];A<f[v]&&(A=f[v]),A<f[v+1]&&(A=f[v+1]),Mt(m.numlines_s[v-1]+m.numlines_s[v]+m.numlines_s[v+1]-1>0),V=20*(A*3-V)/(V*(m.numlines_s[v-1]+m.numlines_s[v]+m.numlines_s[v+1]-1));var N=0|V;N>H&&(N=H),U[v]=N}else U[v]=0;if(Mt(v==m.npart_s-1),V=G[v-1]+G[v],V>0){var A=f[v-1];A<f[v]&&(A=f[v]),Mt(m.numlines_s[v-1]+m.numlines_s[v]-1>0),V=20*(A*2-V)/(V*(m.numlines_s[v-1]+m.numlines_s[v]-1));var N=0|V;N>H&&(N=H),U[v]=N}else U[v]=0;Mt(v==m.npart_s-1)}function p(m,f,G,U,H,v){var V=m.internal_flags,A=new float[ot.CBANDS],N=ii(ot.CBANDS),rt,it,st,gt=new int[ot.CBANDS];for(st=it=0;st<V.npart_s;++st){var jt=0,lt=0,bt=V.numlines_s[st];for(rt=0;rt<bt;++rt,++it){var et=f[v][it];jt+=et,lt<et&&(lt=et)}G[st]=jt,A[st]=lt,N[st]=jt/bt,Mt(N[st]>=0)}for(Mt(st==V.npart_s);st<ot.CBANDS;++st)A[st]=0,N[st]=0;for(o(V,A,N,gt),it=st=0;st<V.npart_s;st++){var kt=V.s3ind_s[st][0],Xt=V.s3ind_s[st][1],ht,vt,ct,Zt,Tt;for(ht=gt[kt],vt=1,Zt=V.s3_ss[it]*G[kt]*S[gt[kt]],++it,++kt;kt<=Xt;)ht+=gt[kt],vt+=1,ct=V.s3_ss[it]*G[kt]*S[gt[kt]],Zt=O(Zt,ct,kt-st),++it,++kt;ht=(1+2*ht)/(2*vt),Tt=S[ht]*0.5,Zt*=Tt,U[st]=Zt,V.nb_s2[H][st]=V.nb_s1[H][st],V.nb_s1[H][st]=Zt,ct=A[st],ct*=V.minval_s[st],ct*=Tt,U[st]>ct&&(U[st]=ct),V.masking_lower>1&&(U[st]*=V.masking_lower),U[st]>G[st]&&(U[st]=G[st]),V.masking_lower<1&&(U[st]*=V.masking_lower),Mt(U[st]>=0)}for(;st<ot.CBANDS;++st)G[st]=0,U[st]=0}function ft(m,f,G,U,H){var v=ii(ot.CBANDS),V=ii(ot.CBANDS),A=Li(ot.CBANDS+2),N;R(m,f,G,v,V),at(m,v,V,A);var rt=0;for(N=0;N<m.npart_l;N++){var it,st,gt,jt,lt=m.s3ind[N][0],bt=m.s3ind[N][1],et=0,kt=0;for(et=A[lt],kt+=1,st=m.s3_ll[rt]*G[lt]*S[A[lt]],++rt,++lt;lt<=bt;)et+=A[lt],kt+=1,it=m.s3_ll[rt]*G[lt]*S[A[lt]],jt=O(st,it,lt-N),st=jt,++rt,++lt;if(et=(1+2*et)/(2*kt),gt=S[et]*0.5,st*=gt,m.blocktype_old[H&1]==ot.SHORT_TYPE){var Xt=C*m.nb_1[H][N];Xt>0?U[N]=Math.min(st,Xt):U[N]=Math.min(st,G[N]*F)}else{var ht=b*m.nb_2[H][N],vt=C*m.nb_1[H][N],Xt;ht<=0&&(ht=st),vt<=0&&(vt=st),m.blocktype_old[H&1]==ot.NORM_TYPE?Xt=Math.min(vt,ht):Xt=vt,U[N]=Math.min(st,Xt)}m.nb_2[H][N]=m.nb_1[H][N],m.nb_1[H][N]=st,it=v[N],it*=m.minval_l[N],it*=gt,U[N]>it&&(U[N]=it),m.masking_lower>1&&(U[N]*=m.masking_lower),U[N]>G[N]&&(U[N]=G[N]),m.masking_lower<1&&(U[N]*=m.masking_lower),Mt(U[N]>=0)}for(;N<ot.CBANDS;++N)G[N]=0,U[N]=0}function yt(m,f){var G=m.internal_flags;m.short_blocks==Hi.short_block_coupled&&!(f[0]!=0&&f[1]!=0)&&(f[0]=f[1]=0);for(var U=0;U<G.channels_out;U++)m.short_blocks==Hi.short_block_dispensed&&(f[U]=1),m.short_blocks==Hi.short_block_forced&&(f[U]=0)}function Ft(m,f,G){for(var U=m.internal_flags,H=0;H<U.channels_out;H++){var v=ot.NORM_TYPE;f[H]!=0?(Mt(U.blocktype_old[H]!=ot.START_TYPE),U.blocktype_old[H]==ot.SHORT_TYPE&&(v=ot.STOP_TYPE)):(v=ot.SHORT_TYPE,U.blocktype_old[H]==ot.NORM_TYPE&&(U.blocktype_old[H]=ot.START_TYPE),U.blocktype_old[H]==ot.STOP_TYPE&&(U.blocktype_old[H]=ot.SHORT_TYPE)),G[H]=U.blocktype_old[H],U.blocktype_old[H]=v}}function $t(m,f,G,U,H,v,V){for(var A=v*2,N=v>0?Math.pow(10,H):1,rt,it,st=0;st<V;++st){var gt=m[2][st],jt=m[3][st],lt=f[0][st],bt=f[1][st],et=f[2][st],kt=f[3][st];if(lt<=1.58*bt&&bt<=1.58*lt){var Xt=G[st]*jt,ht=G[st]*gt;it=Math.max(et,Math.min(kt,Xt)),rt=Math.max(kt,Math.min(et,ht))}else it=et,rt=kt;if(v>0){var vt,ct,Zt=U[st]*N;if(vt=Math.min(Math.max(lt,Zt),Math.max(bt,Zt)),et=Math.max(it,Zt),kt=Math.max(rt,Zt),ct=et+kt,ct>0&&vt*A<ct){var Tt=vt*A/ct;et*=Tt,kt*=Tt}it=Math.min(et,it),rt=Math.min(kt,rt)}it>gt&&(it=gt),rt>jt&&(rt=jt),f[2][st]=it,f[3][st]=rt}}this.L3psycho_anal_vbr=function(m,f,G,U,H,v,V,A,N,rt){var it=m.internal_flags,st,gt,jt=ii(ot.HBLKSIZE),lt=fi([3,ot.HBLKSIZE_s]),bt=fi([2,ot.BLKSIZE]),et=fi([2,3,ot.BLKSIZE_s]),kt=fi([4,ot.CBANDS]),Xt=fi([4,ot.CBANDS]),ht=fi([4,3]),vt=0.6,ct=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Zt=Li(2),Tt=m.mode==t.JOINT_STEREO?4:it.channels_out;Yt(m,f,G,U,H,v,N,ht,ct,Zt),yt(m,Zt);{for(var wt=0;wt<Tt;wt++){var Qt=wt&1;st=bt,Ct(m,f,G,wt,U,jt,st,Qt),Wt(m,U,wt,jt),Zt[Qt]!=0?ft(it,jt,kt[wt],Xt[wt],wt):wi(it,wt)}Zt[0]+Zt[1]==2&&m.mode==t.JOINT_STEREO&&$t(kt,Xt,it.mld_cb_l,it.ATH.cb_l,m.ATHlower*it.ATH.adjust,m.msfix,it.npart_l);for(var wt=0;wt<Tt;wt++){var Qt=wt&1;Zt[Qt]!=0&&l(it,kt[wt],Xt[wt],wt)}}{for(var Lt=0;Lt<3;Lt++){for(var wt=0;wt<Tt;++wt){var Qt=wt&1;Zt[Qt]!=0?St(it,wt,Lt):(gt=et,Dt(m,f,G,wt,Lt,lt,gt,Qt),p(m,lt,kt[wt],Xt[wt],wt,Lt))}Zt[0]+Zt[1]==0&&m.mode==t.JOINT_STEREO&&$t(kt,Xt,it.mld_cb_s,it.ATH.cb_s,m.ATHlower*it.ATH.adjust,m.msfix,it.npart_s);for(var wt=0;wt<Tt;++wt){var Qt=wt&1;Zt[Qt]==0&&Q(it,kt[wt],Xt[wt],wt,Lt)}}for(var wt=0;wt<Tt;wt++){var Qt=wt&1;if(Zt[Qt]==0)for(var Et=0;Et<ot.SBMAX_s;Et++){for(var ui=ii(3),Lt=0;Lt<3;Lt++){var Rt=it.thm[wt].s[Et][Lt];if(Rt*=h,ct[wt][Lt]>=2||ct[wt][Lt+1]==1){var Vt=Lt!=0?Lt-1:2,ai=c(it.thm[wt].s[Et][Vt],Rt,d*vt);Rt=Math.min(Rt,ai)}else if(ct[wt][Lt]==1){var Vt=Lt!=0?Lt-1:2,ai=c(it.thm[wt].s[Et][Vt],Rt,F*vt);Rt=Math.min(Rt,ai)}else if(Lt!=0&&ct[wt][Lt-1]==3||Lt==0&&it.nsPsy.lastAttacks[wt]==3){var Vt=Lt!=2?Lt+1:0,ai=c(it.thm[wt].s[Et][Vt],Rt,F*vt);Rt=Math.min(Rt,ai)}Rt*=ht[wt][Lt],ui[Lt]=Rt}for(var Lt=0;Lt<3;Lt++)it.thm[wt].s[Et][Lt]=ui[Lt]}}}for(var wt=0;wt<Tt;wt++)it.nsPsy.lastAttacks[wt]=ct[wt][2];Ft(m,Zt,rt);for(var wt=0;wt<Tt;wt++){var pi,gi,Pi,Wi;wt>1?(pi=A,gi=-2,Pi=ot.NORM_TYPE,(rt[0]==ot.SHORT_TYPE||rt[1]==ot.SHORT_TYPE)&&(Pi=ot.SHORT_TYPE),Wi=v[U][wt-2]):(pi=V,gi=0,Pi=rt[wt],Wi=H[U][wt]),Pi==ot.SHORT_TYPE?pi[gi+wt]=_(Wi,it.masking_lower):pi[gi+wt]=X(Wi,it.masking_lower),m.analysis&&(it.pinfo.pe[U][wt]=pi[gi+wt])}return 0};function Jt(m,f){var G=m,U;return G>=0?U=-G*27:U=G*f,U<=-72?0:Math.exp(U*I)}function zt(m){var f=0,G=0;{var U=0,H,v;for(U=0;Jt(U,m)>0.00000000000000000001;U-=1);for(H=U,v=0;Math.abs(v-H)>0.000000000001;)U=(v+H)/2,Jt(U,m)>0?v=U:H=U;f=H}{var U=0,H,v;for(U=0;Jt(U,m)>0.00000000000000000001;U+=1);for(H=0,v=U;Math.abs(v-H)>0.000000000001;)U=(v+H)/2,Jt(U,m)>0?H=U:v=U;G=v}{var V=0,A=1000,N;for(N=0;N<=A;++N){var U=f+N*(G-f)/A,rt=Jt(U,m);V+=rt}{var it=(A+1)/(V*(G-f));return it}}}function xt(m){var f,G,U,H;return f=m,f>=0?f*=3:f*=1.5,f>=0.5&&f<=2.5?(H=f-0.5,G=8*(H*H-2*H)):G=0,f+=0.474,U=15.811389+7.5*f-17.5*Math.sqrt(1+f*f),U<=-60?0:(f=Math.exp((G+U)*I),f/=0.6609193,f)}function Gt(m){return m<0&&(m=0),m=m*0.001,13*Math.atan(0.76*m)+3.5*Math.atan(m*m/56.25)}function mt(m,f,G,U,H,v,V,A,N,rt,it,st){var gt=ii(ot.CBANDS+1),jt=A/(st>15?1152:384),lt=Li(ot.HBLKSIZE),bt;A/=N;var et=0,kt=0;for(bt=0;bt<ot.CBANDS;bt++){var Xt,ht;for(Xt=Gt(A*et),gt[bt]=A*et,ht=et;Gt(A*ht)-Xt<z&&ht<=N/2;ht++);for(m[bt]=ht-et,kt=bt+1;et<ht;)Mt(et<ot.HBLKSIZE),lt[et++]=bt;if(et>N/2){et=N/2,++bt;break}}Mt(bt<ot.CBANDS),gt[bt]=A*et;for(var vt=0;vt<st;vt++){var ct,Zt,Tt,wt,Qt;Tt=rt[vt],wt=rt[vt+1],ct=0|Math.floor(0.5+it*(Tt-0.5)),ct<0&&(ct=0),Zt=0|Math.floor(0.5+it*(wt-0.5)),Zt>N/2&&(Zt=N/2),G[vt]=(lt[ct]+lt[Zt])/2,f[vt]=lt[Zt];var Lt=jt*wt;V[vt]=(Lt-gt[f[vt]])/(gt[f[vt]+1]-gt[f[vt]]),V[vt]<0?V[vt]=0:V[vt]>1&&(V[vt]=1),Qt=Gt(A*rt[vt]*it),Qt=Math.min(Qt,15.5)/15.5,v[vt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Qt))-2.5)}et=0;for(var Et=0;Et<kt;Et++){var ui=m[Et],Xt,Rt;Xt=Gt(A*et),Rt=Gt(A*(et+ui-1)),U[Et]=0.5*(Xt+Rt),Xt=Gt(A*(et-0.5)),Rt=Gt(A*(et+ui-0.5)),H[Et]=Rt-Xt,et+=ui}return kt}function qt(m,f,G,U,H,v){var V=fi([ot.CBANDS,ot.CBANDS]),A,N=0;if(v)for(var rt=0;rt<f;rt++)for(A=0;A<f;A++){var it=xt(G[rt]-G[A])*U[A];V[rt][A]=it*H[rt]}else for(A=0;A<f;A++)for(var st=15+Math.min(21/G[A],12),gt=zt(st),rt=0;rt<f;rt++){var it=gt*Jt(G[rt]-G[A],st)*U[A];V[rt][A]=it*H[rt]}for(var rt=0;rt<f;rt++){for(A=0;A<f&&!(V[rt][A]>0);A++);for(m[rt][0]=A,A=f-1;A>0&&!(V[rt][A]>0);A--);m[rt][1]=A,N+=m[rt][1]-m[rt][0]+1}for(var jt=ii(N),lt=0,rt=0;rt<f;rt++)for(A=m[rt][0];A<=m[rt][1];A++)jt[lt++]=V[rt][A];return jt}function ei(m){var f=Gt(m);return f=Math.min(f,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*f))-2.5)}this.psymodel_init=function(m){var f=m.internal_flags,G,U=!0,H=13,v=24,V=0,A=0,N=-8.25,rt=-4.5,it=ii(ot.CBANDS),st=ii(ot.CBANDS),gt=ii(ot.CBANDS),jt=m.out_samplerate;switch(m.experimentalZ){default:case 0:U=!0;break;case 1:U=!(m.VBR==Ni.vbr_mtrh||m.VBR==Ni.vbr_mt);break;case 2:U=!1;break;case 3:H=8,V=-1.75,A=-0.0125,N=-8.25,rt=-2.25;break}for(f.ms_ener_ratio_old=0.25,f.blocktype_old[0]=f.blocktype_old[1]=ot.NORM_TYPE,G=0;G<4;++G){for(var et=0;et<ot.CBANDS;++et)f.nb_1[G][et]=100000000000000000000,f.nb_2[G][et]=100000000000000000000,f.nb_s1[G][et]=f.nb_s2[G][et]=1;for(var lt=0;lt<ot.SBMAX_l;lt++)f.en[G].l[lt]=100000000000000000000,f.thm[G].l[lt]=100000000000000000000;for(var et=0;et<3;++et){for(var lt=0;lt<ot.SBMAX_s;lt++)f.en[G].s[lt][et]=100000000000000000000,f.thm[G].s[lt][et]=100000000000000000000;f.nsPsy.lastAttacks[G]=0}for(var et=0;et<9;et++)f.nsPsy.last_en_subshort[G][et]=10}for(f.loudness_sq_save[0]=f.loudness_sq_save[1]=0,f.npart_l=mt(f.numlines_l,f.bo_l,f.bm_l,it,st,f.mld_l,f.PSY.bo_l_weight,jt,ot.BLKSIZE,f.scalefac_band.l,ot.BLKSIZE/1152,ot.SBMAX_l),Mt(f.npart_l<ot.CBANDS),G=0;G<f.npart_l;G++){var bt=V;it[G]>=H&&(bt=A*(it[G]-H)/(v-H)+V*(v-it[G])/(v-H)),gt[G]=Math.pow(10,bt/10),f.numlines_l[G]>0?f.rnumlines_l[G]=1/f.numlines_l[G]:f.rnumlines_l[G]=0}f.s3_ll=qt(f.s3ind,f.npart_l,it,st,gt,U);var et=0;for(G=0;G<f.npart_l;G++){var kt=bn.MAX_VALUE;for(var Xt=0;Xt<f.numlines_l[G];Xt++,et++){var ht=jt*et/(1000*ot.BLKSIZE),vt;vt=this.ATHformula(ht*1000,m)-20,vt=Math.pow(10,0.1*vt),vt*=f.numlines_l[G],kt>vt&&(kt=vt)}f.ATH.cb_l[G]=kt,kt=-20+it[G]*20/10,kt>6&&(kt=100),kt<-15&&(kt=-15),kt-=8,f.minval_l[G]=Math.pow(10,kt/10)*f.numlines_l[G]}for(f.npart_s=mt(f.numlines_s,f.bo_s,f.bm_s,it,st,f.mld_s,f.PSY.bo_s_weight,jt,ot.BLKSIZE_s,f.scalefac_band.s,ot.BLKSIZE_s/384,ot.SBMAX_s),Mt(f.npart_s<ot.CBANDS),et=0,G=0;G<f.npart_s;G++){var kt,bt=N;it[G]>=H&&(bt=rt*(it[G]-H)/(v-H)+N*(v-it[G])/(v-H)),gt[G]=Math.pow(10,bt/10),kt=bn.MAX_VALUE;for(var Xt=0;Xt<f.numlines_s[G];Xt++,et++){var ht=jt*et/(1000*ot.BLKSIZE_s),vt;vt=this.ATHformula(ht*1000,m)-20,vt=Math.pow(10,0.1*vt),vt*=f.numlines_s[G],kt>vt&&(kt=vt)}f.ATH.cb_s[G]=kt,kt=-7+it[G]*7/12,it[G]>12&&(kt*=1+Math.log(1+kt)*3.1),it[G]<12&&(kt*=1+Math.log(1-kt)*2.3),kt<-15&&(kt=-15),kt-=8,f.minval_s[G]=Math.pow(10,kt/10)*f.numlines_s[G]}f.s3_ss=qt(f.s3ind_s,f.npart_s,it,st,gt,U),$(),e.init_fft(f),f.decay=Math.exp(-1*n/(B*jt/192));{var ct;ct=q,m.exp_nspsytune&2&&(ct=1),Math.abs(m.msfix)>0&&(ct=m.msfix),m.msfix=ct;for(var Zt=0;Zt<f.npart_l;Zt++)f.s3ind[Zt][1]>f.npart_l-1&&(f.s3ind[Zt][1]=f.npart_l-1)}var Tt=576*f.mode_gr/jt;if(f.ATH.decay=Math.pow(10,-1.2*Tt),f.ATH.adjust=0.01,f.ATH.adjustLimit=1,Mt(f.bo_l[ot.SBMAX_l-1]<=f.npart_l),Mt(f.bo_s[ot.SBMAX_s-1]<=f.npart_s),m.ATHtype!=-1){var ht,wt=m.out_samplerate/ot.BLKSIZE,Qt=0;for(ht=0,G=0;G<ot.BLKSIZE/2;++G)ht+=wt,f.ATH.eql_w[G]=1/Math.pow(10,this.ATHformula(ht,m)/10),Qt+=f.ATH.eql_w[G];for(Qt=1/Qt,G=ot.BLKSIZE/2;--G>=0;)f.ATH.eql_w[G]*=Qt}{for(var Zt=et=0;Zt<f.npart_s;++Zt)for(G=0;G<f.numlines_s[Zt];++G)++et;for(var Zt=et=0;Zt<f.npart_l;++Zt)for(G=0;G<f.numlines_l[Zt];++G)++et}for(et=0,G=0;G<f.npart_l;G++){var ht=jt*(et+f.numlines_l[G]/2)/(1*ot.BLKSIZE);f.mld_cb_l[G]=ei(ht),et+=f.numlines_l[G]}for(;G<ot.CBANDS;++G)f.mld_cb_l[G]=1;for(et=0,G=0;G<f.npart_s;G++){var ht=jt*(et+f.numlines_s[G]/2)/(1*ot.BLKSIZE_s);f.mld_cb_s[G]=ei(ht),et+=f.numlines_s[G]}for(;G<ot.CBANDS;++G)f.mld_cb_s[G]=1;return 0};function Ut(m,f){m<-0.3&&(m=3410),m/=1000,m=Math.max(0.1,m);var G=3.64*Math.pow(m,-0.8)-6.8*Math.exp(-0.6*Math.pow(m-3.4,2))+6*Math.exp(-0.15*Math.pow(m-8.7,2))+(0.6+0.04*f)*0.001*Math.pow(m,4);return G}this.ATHformula=function(m,f){var G;switch(f.ATHtype){case 0:G=Ut(m,9);break;case 1:G=Ut(m,-1);break;case 2:G=Ut(m,0);break;case 3:G=Ut(m,1)+6;break;case 4:G=Ut(m,f.ATHcurve);break;default:G=Ut(m,0);break}return G}}var cs=hs,us=ce;function ps(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=us.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var gs=ps,ms=si(),ar={};ar.SFBMAX=ms.SBMAX_s*3;var De=ar,dr=Ht,ws=dr.new_float,Ui=dr.new_int,qe=De;function fs(){this.xr=ws(576),this.l3_enc=Ui(576),this.scalefac=Ui(qe.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Ui(3),this.subblock_gain=Ui(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Ui(qe.SFBMAX),this.window=Ui(qe.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Ui(4),this.max_nonzero_coeff=0;var t=this;function e(C){return new Int32Array(C)}function n(C){return new Float32Array(C)}this.assign=function(C){t.xr=n(C.xr),t.l3_enc=e(C.l3_enc),t.scalefac=e(C.scalefac),t.xrpow_max=C.xrpow_max,t.part2_3_length=C.part2_3_length,t.big_values=C.big_values,t.count1=C.count1,t.global_gain=C.global_gain,t.scalefac_compress=C.scalefac_compress,t.block_type=C.block_type,t.mixed_block_flag=C.mixed_block_flag,t.table_select=e(C.table_select),t.subblock_gain=e(C.subblock_gain),t.region0_count=C.region0_count,t.region1_count=C.region1_count,t.preflag=C.preflag,t.scalefac_scale=C.scalefac_scale,t.count1table_select=C.count1table_select,t.part2_length=C.part2_length,t.sfb_lmax=C.sfb_lmax,t.sfb_smin=C.sfb_smin,t.psy_lmax=C.psy_lmax,t.sfbmax=C.sfbmax,t.psymax=C.psymax,t.sfbdivide=C.sfbdivide,t.width=e(C.width),t.window=e(C.window),t.count1bits=C.count1bits,t.sfb_partition_table=C.sfb_partition_table.slice(0),t.slen=e(C.slen),t.max_nonzero_coeff=C.max_nonzero_coeff}}var Be=fs,Cs=Ht,jn=Cs.new_int,Ps=Be;function Ws(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[jn(4),jn(4)];for(var t=0;t<2;t++)for(var e=0;e<2;e++)this.tt[t][e]=new Ps}var Ds=Ws,lr=Ht,me=lr.System,we=lr.new_int,fe=si();function ks(t,e,n,C){this.l=we(1+fe.SBMAX_l),this.s=we(1+fe.SBMAX_s),this.psfb21=we(1+fe.PSFB21),this.psfb12=we(1+fe.PSFB12);var b=this.l,y=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],me.arraycopy(this.arrL,0,b,0,Math.min(this.arrL.length,this.l.length)),me.arraycopy(this.arrS,0,y,0,Math.min(this.arrS.length,this.s.length)),me.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),me.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var hr=ks,Re=Ht,Se=Re.new_float,ys=Re.new_float_n,vs=Re.new_int,Zn=si();function zs(){this.last_en_subshort=ys([4,9]),this.lastAttacks=vs(4),this.pefirbuf=Se(19),this.longfact=Se(Zn.SBMAX_l),this.shortfact=Se(Zn.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var Js=zs;function Ys(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var Gs=Ys,Bi=Ht,bs=Bi.new_byte,js=Bi.new_double,Ci=Bi.new_float,Oi=Bi.new_float_n,Di=Bi.new_int,Ce=Bi.new_int_n,Zs=Ds,$s=hr,Fs=Js,Qs=Gs,$n=sr(),_t=si(),Ms=De;bi.MFSIZE=3456+_t.ENCDELAY-_t.MDCTDELAY;bi.MAX_HEADER_BUF=256;bi.MAX_BITS_PER_CHANNEL=4095;bi.MAX_BITS_PER_GRANULE=7680;bi.BPC=320;function bi(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=Oi([2,bi.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Zs,this.ms_ratio=Ci(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Di(2),this.CurrentStep=Di(2),this.masking_lower=0,this.bv_scf=Di(576),this.pseudohalf=Di(Ms.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=[,,],this.blackfilt=Array(2*bi.BPC+1),this.itime=js(2),this.sideinfo_len=0,this.sb_sample=Oi([2,2,18,_t.SBLIMIT]),this.amp_filter=Ci(32);function e(){this.write_timing=0,this.ptr=0,this.buf=bs(t)}this.header=Array(bi.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new $s,this.minval_l=Ci(_t.CBANDS),this.minval_s=Ci(_t.CBANDS),this.nb_1=Oi([4,_t.CBANDS]),this.nb_2=Oi([4,_t.CBANDS]),this.nb_s1=Oi([4,_t.CBANDS]),this.nb_s2=Oi([4,_t.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=[,,,,],this.en=[,,,,],this.tot_ener=Ci(4),this.loudness_sq=Oi([2,2]),this.loudness_sq_save=Ci(2),this.mld_l=Ci(_t.SBMAX_l),this.mld_s=Ci(_t.SBMAX_s),this.bm_l=Di(_t.SBMAX_l),this.bo_l=Di(_t.SBMAX_l),this.bm_s=Di(_t.SBMAX_s),this.bo_s=Di(_t.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Ce([_t.CBANDS,2]),this.s3ind_s=Ce([_t.CBANDS,2]),this.numlines_s=Di(_t.CBANDS),this.numlines_l=Di(_t.CBANDS),this.rnumlines_l=Ci(_t.CBANDS),this.mld_cb_l=Ci(_t.CBANDS),this.mld_cb_s=Ci(_t.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ci(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Di(2),this.nsPsy=new Fs,this.VBR_seek_table=new Qs,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Ce([16,5]),this.bitrate_blockType_Hist=Ce([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var n=0;n<this.en.length;n++)this.en[n]=new $n;for(var n=0;n<this.thm.length;n++)this.thm[n]=new $n;for(var n=0;n<this.header.length;n++)this.header[n]=new e}var ke=bi,xs=Ht,Ki=xs.new_float,qi=si();function Xs(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Ki(qi.SBMAX_l),this.s=Ki(qi.SBMAX_s),this.psfb21=Ki(qi.PSFB21),this.psfb12=Ki(qi.PSFB12),this.cb_l=Ki(qi.CBANDS),this.cb_s=Ki(qi.CBANDS),this.eql_w=Ki(qi.BLKSIZE/2)}var Ls=Xs,cr=Ht,hi=cr.System,Fn=cr.Arrays;Bt.STEPS_per_dB=100;Bt.MAX_dB=120;Bt.GAIN_NOT_ENOUGH_SAMPLES=-24601;Bt.GAIN_ANALYSIS_ERROR=0;Bt.GAIN_ANALYSIS_OK=1;Bt.INIT_GAIN_ANALYSIS_ERROR=0;Bt.INIT_GAIN_ANALYSIS_OK=1;Bt.YULE_ORDER=10;Bt.MAX_ORDER=Bt.YULE_ORDER;Bt.MAX_SAMP_FREQ=48000;Bt.RMS_WINDOW_TIME_NUMERATOR=1;Bt.RMS_WINDOW_TIME_DENOMINATOR=20;Bt.MAX_SAMPLES_PER_WINDOW=Bt.MAX_SAMP_FREQ*Bt.RMS_WINDOW_TIME_NUMERATOR/Bt.RMS_WINDOW_TIME_DENOMINATOR+1;function Bt(){var t=64.82,e=0.95,n=Bt.RMS_WINDOW_TIME_NUMERATOR,C=Bt.RMS_WINDOW_TIME_DENOMINATOR,b=[[0.038575994352,-3.84664617118067,-0.02160367184185,7.81501653005538,-0.00123395316851,-11.34170355132042,-0.00009291677959,13.05504219327545,-0.01655260341619,-12.28759895145294,0.02161526843274,9.4829380631979,-0.02074045215285,-5.87257861775999,0.00594298065125,2.75465861874613,0.00306428023191,-0.86984376593551,0.00012025322027,0.13919314567432,0.00288463683916],[0.0541865640643,-3.47845948550071,-0.02911007808948,6.36317777566148,-0.00848709379851,-8.54751527471874,-0.00851165645469,9.4769360780128,-0.00834990904936,-8.81498681370155,0.02245293253339,6.85401540936998,-0.02596338512915,-4.39470996079559,0.01624864962975,2.19611684890774,-0.00240879051584,-0.75104302451432,0.00674613682247,0.13149317958808,-0.00187763777362],[0.15457299681924,-2.37898834973084,-0.09331049056315,2.84868151156327,-0.06247880153653,-2.64577170229825,0.02163541888798,2.23697657451713,-0.05588393329856,-1.67148153367602,0.04781476674921,1.00595954808547,0.00222312597743,-0.45953458054983,0.03174092540049,0.16378164858596,-0.01390589421898,-0.05032077717131,0.00651420667831,0.0234789740702,-0.00881362733839],[0.30296907319327,-1.61273165137247,-0.22613988682123,1.0797749225997,-0.08587323730772,-0.2565625775407,0.03282930172664,-0.1627671912044,-0.00915702933434,-0.22638893773906,-0.02364141202522,0.39120800788284,-0.00584456039913,-0.22138138954925,0.06276101321749,0.04500235387352,-0.00000828086748,0.02005851806501,0.00205861885564,0.00302439095741,-0.02950134983287],[0.33642304856132,-1.49858979367799,-0.2557224142557,0.87350271418188,-0.11828570177555,0.12205022308084,0.11921148675203,-0.80774944671438,-0.07834489609479,0.47854794562326,-0.0046997791438,-0.12453458140019,-0.0058950022444,-0.04067510197014,0.05724228140351,0.08333755284107,0.00832043980773,-0.04237348025746,-0.0163538138454,0.02977207319925,-0.0176017656815],[0.4491525660845,-0.62820619233671,-0.14351757464547,0.29661783706366,-0.22784394429749,-0.372563729424,-0.01419140100551,0.00213767857124,0.04078262797139,-0.42029820170918,-0.12398163381748,0.22199650564824,0.04097565135648,0.00613424350682,0.10478503600251,0.06747620744683,-0.01863887810927,0.05784820375801,-0.03193428438915,0.03222754072173,0.00541907748707],[0.56619470757641,-1.04800335126349,-0.75464456939302,0.29156311971249,0.1624213774223,-0.26806001042947,0.16744243493672,0.00819999645858,-0.18901604199609,0.45054734505008,0.3093178284183,-0.33032403314006,-0.27562961986224,0.0673936833311,0.00647310677246,-0.04784254229033,0.08647503780351,0.01639907836189,-0.0378898455484,0.01807364323573,-0.00588215443421],[0.58100494960553,-0.51035327095184,-0.53174909058578,-0.31863563325245,-0.14289799034253,-0.20256413484477,0.17520704835522,0.1472815413433,0.02377945217615,0.38952639978999,0.15558449135573,-0.23313271880868,-0.25344790059353,-0.05246019024463,0.01628462406333,-0.02505961724053,0.06920467763959,0.02442357316099,-0.03721611395801,0.01818801111503,-0.00749618797172],[0.53648789255105,-0.2504987195602,-0.42163034350696,-0.43193942311114,-0.00275953611929,-0.03424681017675,0.04267842219415,-0.04678328784242,-0.10214864179676,0.26408300200955,0.14590772289388,0.15113130533216,-0.02459864859345,-0.17556493366449,-0.11202315195388,-0.18823009262115,-0.04060034127,0.05477720428674,0.0478866554818,0.0470440968812,-0.02217936801134]],y=[[0.98621192462708,-1.97223372919527,-1.97242384925416,0.97261396931306,0.98621192462708],[0.98500175787242,-1.96977855582618,-1.97000351574484,0.9702284756635,0.98500175787242],[0.97938932735214,-1.95835380975398,-1.95877865470428,0.95920349965459,0.97938932735214],[0.97531843204928,-1.95002759149878,-1.95063686409857,0.95124613669835,0.97531843204928],[0.97316523498161,-1.94561023566527,-1.94633046996323,0.94705070426118,0.97316523498161],[0.96454515552826,-1.92783286977036,-1.92909031105652,0.93034775234268,0.96454515552826],[0.96009142950541,-1.91858953033784,-1.92018285901082,0.92177618768381,0.96009142950541],[0.95856916599601,-1.9154210807478,-1.91713833199203,0.91885558323625,0.95856916599601],[0.94597685600279,-1.88903307939452,-1.89195371200558,0.89487434461664,0.94597685600279]];function j(d,F,q,L,I,E){for(;I--!=0;)q[L]=0.0000000001+d[F+0]*E[0]-q[L-1]*E[1]+d[F-1]*E[2]-q[L-2]*E[3]+d[F-2]*E[4]-q[L-3]*E[5]+d[F-3]*E[6]-q[L-4]*E[7]+d[F-4]*E[8]-q[L-5]*E[9]+d[F-5]*E[10]-q[L-6]*E[11]+d[F-6]*E[12]-q[L-7]*E[13]+d[F-7]*E[14]-q[L-8]*E[15]+d[F-8]*E[16]-q[L-9]*E[17]+d[F-9]*E[18]-q[L-10]*E[19]+d[F-10]*E[20],++L,++F}function z(d,F,q,L,I,E){for(;I--!=0;)q[L]=d[F+0]*E[0]-q[L-1]*E[1]+d[F-1]*E[2]-q[L-2]*E[3]+d[F-2]*E[4],++L,++F}function Z(d,F){for(var q=0;q<MAX_ORDER;q++)d.linprebuf[q]=d.lstepbuf[q]=d.loutbuf[q]=d.rinprebuf[q]=d.rstepbuf[q]=d.routbuf[q]=0;switch(0|F){case 48000:d.reqindex=0;break;case 44100:d.reqindex=1;break;case 32000:d.reqindex=2;break;case 24000:d.reqindex=3;break;case 22050:d.reqindex=4;break;case 16000:d.reqindex=5;break;case 12000:d.reqindex=6;break;case 11025:d.reqindex=7;break;case 8000:d.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return d.sampleWindow=0|(F*n+C-1)/C,d.lsum=0,d.rsum=0,d.totsamp=0,Fn.ill(d.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(d,F){return Z(d,F)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(d.linpre=MAX_ORDER,d.rinpre=MAX_ORDER,d.lstep=MAX_ORDER,d.rstep=MAX_ORDER,d.lout=MAX_ORDER,d.rout=MAX_ORDER,Fn.fill(d.B,0),INIT_GAIN_ANALYSIS_OK)};function B(d){return d*d}this.AnalyzeSamples=function(d,F,q,L,I,E,D){var g,w,k,i,u,Y,M;if(E==0)return GAIN_ANALYSIS_OK;switch(M=0,u=E,D){case 1:L=F,I=q;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(E<MAX_ORDER?(hi.arraycopy(F,q,d.linprebuf,MAX_ORDER,E),hi.arraycopy(L,I,d.rinprebuf,MAX_ORDER,E)):(hi.arraycopy(F,q,d.linprebuf,MAX_ORDER,MAX_ORDER),hi.arraycopy(L,I,d.rinprebuf,MAX_ORDER,MAX_ORDER));u>0;){Y=u>d.sampleWindow-d.totsamp?d.sampleWindow-d.totsamp:u,M<MAX_ORDER?(g=d.linpre+M,w=d.linprebuf,k=d.rinpre+M,i=d.rinprebuf,Y>MAX_ORDER-M&&(Y=MAX_ORDER-M)):(g=q+M,w=F,k=I+M,i=L),j(w,g,d.lstepbuf,d.lstep+d.totsamp,Y,b[d.reqindex]),j(i,k,d.rstepbuf,d.rstep+d.totsamp,Y,b[d.reqindex]),z(d.lstepbuf,d.lstep+d.totsamp,d.loutbuf,d.lout+d.totsamp,Y,y[d.reqindex]),z(d.rstepbuf,d.rstep+d.totsamp,d.routbuf,d.rout+d.totsamp,Y,y[d.reqindex]),g=d.lout+d.totsamp,w=d.loutbuf,k=d.rout+d.totsamp,i=d.routbuf;for(var S=Y%8;S--!=0;)d.lsum+=B(w[g++]),d.rsum+=B(i[k++]);for(S=Y/8;S--!=0;)d.lsum+=B(w[g+0])+B(w[g+1])+B(w[g+2])+B(w[g+3])+B(w[g+4])+B(w[g+5])+B(w[g+6])+B(w[g+7]),g+=8,d.rsum+=B(i[k+0])+B(i[k+1])+B(i[k+2])+B(i[k+3])+B(i[k+4])+B(i[k+5])+B(i[k+6])+B(i[k+7]),k+=8;if(u-=Y,M+=Y,d.totsamp+=Y,d.totsamp==d.sampleWindow){var $=Bt.STEPS_per_dB*10*Math.log10((d.lsum+d.rsum)/d.totsamp*0.5+0.0000000000000000000000000000000000001),x=$<=0?0:0|$;x>=d.A.length&&(x=d.A.length-1),d.A[x]++,d.lsum=d.rsum=0,hi.arraycopy(d.loutbuf,d.totsamp,d.loutbuf,0,MAX_ORDER),hi.arraycopy(d.routbuf,d.totsamp,d.routbuf,0,MAX_ORDER),hi.arraycopy(d.lstepbuf,d.totsamp,d.lstepbuf,0,MAX_ORDER),hi.arraycopy(d.rstepbuf,d.totsamp,d.rstepbuf,0,MAX_ORDER),d.totsamp=0}if(d.totsamp>d.sampleWindow)return GAIN_ANALYSIS_ERROR}return E<MAX_ORDER?(hi.arraycopy(d.linprebuf,E,d.linprebuf,0,MAX_ORDER-E),hi.arraycopy(d.rinprebuf,E,d.rinprebuf,0,MAX_ORDER-E),hi.arraycopy(F,q,d.linprebuf,MAX_ORDER-E,E),hi.arraycopy(L,I,d.rinprebuf,MAX_ORDER-E,E)):(hi.arraycopy(F,q+E-MAX_ORDER,d.linprebuf,0,MAX_ORDER),hi.arraycopy(L,I+E-MAX_ORDER,d.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function h(d,F){var q,L=0;for(q=0;q<F;q++)L+=d[q];if(L==0)return GAIN_NOT_ENOUGH_SAMPLES;var I=0|Math.ceil(L*(1-e));for(q=F;q-- >0&&!((I-=d[q])<=0););return t-q/Bt.STEPS_per_dB}this.GetTitleGain=function(d){for(var F=h(d.A,d.A.length),q=0;q<d.A.length;q++)d.B[q]+=d.A[q],d.A[q]=0;for(var q=0;q<MAX_ORDER;q++)d.linprebuf[q]=d.lstepbuf[q]=d.loutbuf[q]=d.rinprebuf[q]=d.rstepbuf[q]=d.routbuf[q]=0;return d.totsamp=0,d.lsum=d.rsum=0,F}}var ur=Bt,pr=Ht,Ii=pr.new_float,Qn=pr.new_int,ci=ur;function Us(){this.linprebuf=Ii(ci.MAX_ORDER*2),this.linpre=0,this.lstepbuf=Ii(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.lstep=0,this.loutbuf=Ii(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.lout=0,this.rinprebuf=Ii(ci.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=Ii(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.rstep=0,this.routbuf=Ii(ci.MAX_SAMPLES_PER_WINDOW+ci.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=Qn(0|ci.STEPS_per_dB*ci.MAX_dB),this.B=Qn(0|ci.STEPS_per_dB*ci.MAX_dB)}var Os=Us;function Ks(t){this.bits=t}var gr=Ks,Ae=Ht,Mn=Ae.new_float,qs=Ae.new_int,xn=Ae.assert,Ss=gr,Xn=si(),Ts=De,Es=ke;function Vs(t){var e=t;this.quantize=e,this.iteration_loop=function(n,C,b,y){var j=n.internal_flags,z=Mn(Ts.SFBMAX),Z=Mn(576),B=qs(2),h=0,d,F=j.l3_side,q=new Ss(h);this.quantize.rv.ResvFrameBegin(n,q),h=q.bits;for(var L=0;L<j.mode_gr;L++){d=this.quantize.qupvt.on_pe(n,C,B,h,L,L),j.mode_ext==Xn.MPG_MD_MS_LR&&(this.quantize.ms_convert(j.l3_side,L),this.quantize.qupvt.reduce_side(B,b[L],h,d));for(var I=0;I<j.channels_out;I++){var E,D,g=F.tt[L][I];g.block_type!=Xn.SHORT_TYPE?(E=0,D=j.PSY.mask_adjust-E):(E=0,D=j.PSY.mask_adjust_short-E),j.masking_lower=Math.pow(10,D*0.1),this.quantize.init_outer_loop(j,g),this.quantize.init_xrpow(j,g,Z)&&(this.quantize.qupvt.calc_xmin(n,y[L][I],g,z),this.quantize.outer_loop(n,g,z,Z,I,B[I])),this.quantize.iteration_finish_one(j,L,I),xn(g.part2_3_length<=Es.MAX_BITS_PER_CHANNEL),xn(g.part2_3_length<=B[I])}}this.quantize.rv.ResvFrameEnd(j,h)}}var Ns=Vs;function Ot(t,e,n,C){this.xlen=t,this.linmax=e,this.table=n,this.hlen=C}var ut={};ut.t1HB=[1,1,1,0];ut.t2HB=[1,2,1,3,1,1,3,2,0];ut.t3HB=[3,2,1,1,1,1,3,2,0];ut.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];ut.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];ut.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];ut.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];ut.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];ut.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];ut.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];ut.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];ut.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];ut.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];ut.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];ut.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];ut.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];ut.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];ut.t1l=[1,4,3,5];ut.t2l=[1,4,7,4,5,7,6,7,8];ut.t3l=[2,3,7,4,4,7,6,7,8];ut.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];ut.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];ut.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];ut.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];ut.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];ut.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];ut.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];ut.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];ut.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];ut.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];ut.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];ut.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];ut.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];ut.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];ut.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];ut.ht=[new Ot(0,0,null,null),new Ot(2,0,ut.t1HB,ut.t1l),new Ot(3,0,ut.t2HB,ut.t2l),new Ot(3,0,ut.t3HB,ut.t3l),new Ot(0,0,null,null),new Ot(4,0,ut.t5HB,ut.t5l),new Ot(4,0,ut.t6HB,ut.t6l),new Ot(6,0,ut.t7HB,ut.t7l),new Ot(6,0,ut.t8HB,ut.t8l),new Ot(6,0,ut.t9HB,ut.t9l),new Ot(8,0,ut.t10HB,ut.t10l),new Ot(8,0,ut.t11HB,ut.t11l),new Ot(8,0,ut.t12HB,ut.t12l),new Ot(16,0,ut.t13HB,ut.t13l),new Ot(0,0,null,ut.t16_5l),new Ot(16,0,ut.t15HB,ut.t15l),new Ot(1,1,ut.t16HB,ut.t16l),new Ot(2,3,ut.t16HB,ut.t16l),new Ot(3,7,ut.t16HB,ut.t16l),new Ot(4,15,ut.t16HB,ut.t16l),new Ot(6,63,ut.t16HB,ut.t16l),new Ot(8,255,ut.t16HB,ut.t16l),new Ot(10,1023,ut.t16HB,ut.t16l),new Ot(13,8191,ut.t16HB,ut.t16l),new Ot(4,15,ut.t24HB,ut.t24l),new Ot(5,31,ut.t24HB,ut.t24l),new Ot(6,63,ut.t24HB,ut.t24l),new Ot(7,127,ut.t24HB,ut.t24l),new Ot(8,255,ut.t24HB,ut.t24l),new Ot(9,511,ut.t24HB,ut.t24l),new Ot(11,2047,ut.t24HB,ut.t24l),new Ot(13,8191,ut.t24HB,ut.t24l),new Ot(0,0,ut.t32HB,ut.t32l),new Ot(0,0,ut.t33HB,ut.t33l)];ut.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];ut.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];ut.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];ut.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];ut.samplerate_table=[[22050,24000,16000,-1],[44100,48000,32000,-1],[11025,12000,8000,-1]];ut.scfsi_band=[0,6,11,16,21];var tn=ut,Te,Ln;function mr(){if(Ln)return Te;Ln=1;var t=hr,e=Ht,n=e.VbrMode,C=e.Float,b=e.Util,y=e.new_float,j=e.new_int,z=e.assert,Z=si(),B=gr,h=ke;d.Q_MAX=257,d.Q_MAX2=116,d.LARGE_BITS=1e5,d.IXMAX_VAL=8206;function d(){var F=en(),q=null,L=null,I=null;this.setModules=function(J,O,T){q=J,L=O,I=T};function E(J){return z(0<=J+d.Q_MAX2&&J<d.Q_MAX),M[J+d.Q_MAX2]}this.IPOW20=function(J){return z(0<=J&&J<d.Q_MAX),S[J]};var D=0.0000000000000002220446049250313,g=d.IXMAX_VAL,w=g+2,k=d.Q_MAX,i=d.Q_MAX2;d.LARGE_BITS;var u=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var Y=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=Y,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var M=y(k+i+1),S=y(k),$=y(w),x=y(w);this.adj43=x;function dt(J,O){var T=I.ATHformula(O,J);return T-=u,T=Math.pow(10,T/10+J.ATHlower),T}function P(J){for(var O=J.internal_flags.ATH.l,T=J.internal_flags.ATH.psfb21,K=J.internal_flags.ATH.s,tt=J.internal_flags.ATH.psfb12,Q=J.internal_flags,l=J.out_samplerate,a=0;a<Z.SBMAX_l;a++){var s=Q.scalefac_band.l[a],c=Q.scalefac_band.l[a+1];O[a]=C.MAX_VALUE;for(var W=s;W<c;W++){var _=W*l/1152,nt=dt(J,_);O[a]=Math.min(O[a],nt)}}for(var a=0;a<Z.PSFB21;a++){var s=Q.scalefac_band.psfb21[a],c=Q.scalefac_band.psfb21[a+1];T[a]=C.MAX_VALUE;for(var W=s;W<c;W++){var _=W*l/1152,nt=dt(J,_);T[a]=Math.min(T[a],nt)}}for(var a=0;a<Z.SBMAX_s;a++){var s=Q.scalefac_band.s[a],c=Q.scalefac_band.s[a+1];K[a]=C.MAX_VALUE;for(var W=s;W<c;W++){var _=W*l/384,nt=dt(J,_);K[a]=Math.min(K[a],nt)}K[a]*=Q.scalefac_band.s[a+1]-Q.scalefac_band.s[a]}for(var a=0;a<Z.PSFB12;a++){var s=Q.scalefac_band.psfb12[a],c=Q.scalefac_band.psfb12[a+1];tt[a]=C.MAX_VALUE;for(var W=s;W<c;W++){var _=W*l/384,nt=dt(J,_);tt[a]=Math.min(tt[a],nt)}tt[a]*=Q.scalefac_band.s[13]-Q.scalefac_band.s[12]}if(J.noATH){for(var a=0;a<Z.SBMAX_l;a++)O[a]=0.00000000000000000001;for(var a=0;a<Z.PSFB21;a++)T[a]=0.00000000000000000001;for(var a=0;a<Z.SBMAX_s;a++)K[a]=0.00000000000000000001;for(var a=0;a<Z.PSFB12;a++)tt[a]=0.00000000000000000001}Q.ATH.floor=10*Math.log10(dt(J,-1))}this.iteration_init=function(J){var O=J.internal_flags,T=O.l3_side,K;if(O.iteration_init_init==0){for(O.iteration_init_init=1,T.main_data_begin=0,P(J),$[0]=0,K=1;K<w;K++)$[K]=Math.pow(K,1.3333333333333333);for(K=0;K<w-1;K++)x[K]=K+1-Math.pow(0.5*($[K]+$[K+1]),0.75);for(x[K]=0.5,K=0;K<k;K++)S[K]=Math.pow(2,(K-210)*-0.1875);for(K=0;K<=k+i;K++)M[K]=Math.pow(2,(K-210-i)*0.25);q.huffman_init(O);{var tt,Q,l,a;for(K=J.exp_nspsytune>>2&63,K>=32&&(K-=64),tt=Math.pow(10,K/4/10),K=J.exp_nspsytune>>8&63,K>=32&&(K-=64),Q=Math.pow(10,K/4/10),K=J.exp_nspsytune>>14&63,K>=32&&(K-=64),l=Math.pow(10,K/4/10),K=J.exp_nspsytune>>20&63,K>=32&&(K-=64),a=l*Math.pow(10,K/4/10),K=0;K<Z.SBMAX_l;K++){var s;K<=6?s=tt:K<=13?s=Q:K<=20?s=l:s=a,O.nsPsy.longfact[K]=s}for(K=0;K<Z.SBMAX_s;K++){var s;K<=5?s=tt:K<=10?s=Q:K<=11?s=l:s=a,O.nsPsy.shortfact[K]=s}}}},this.on_pe=function(J,O,T,K,tt,Q){var l=J.internal_flags,a=0,s,c=j(2),W,_=new B(a),nt=L.ResvMaxBits(J,K,_,Q);a=_.bits;var X=a+nt;for(X>h.MAX_BITS_PER_GRANULE&&(X=h.MAX_BITS_PER_GRANULE),s=0,W=0;W<l.channels_out;++W)T[W]=Math.min(h.MAX_BITS_PER_CHANNEL,a/l.channels_out),c[W]=0|T[W]*O[tt][W]/700-T[W],c[W]>K*3/4&&(c[W]=K*3/4),c[W]<0&&(c[W]=0),c[W]+T[W]>h.MAX_BITS_PER_CHANNEL&&(c[W]=Math.max(0,h.MAX_BITS_PER_CHANNEL-T[W])),s+=c[W];if(s>nt)for(W=0;W<l.channels_out;++W)c[W]=nt*c[W]/s;for(W=0;W<l.channels_out;++W)T[W]+=c[W],nt-=c[W];for(s=0,W=0;W<l.channels_out;++W)s+=T[W];if(s>h.MAX_BITS_PER_GRANULE){var R=0;for(W=0;W<l.channels_out;++W)T[W]*=h.MAX_BITS_PER_GRANULE,T[W]/=s,R+=T[W]}return X},this.reduce_side=function(J,O,T,K){z(J[0]+J[1]<=h.MAX_BITS_PER_GRANULE);var tt=0.33*(0.5-O)/0.5;tt<0&&(tt=0),tt>0.5&&(tt=0.5);var Q=0|tt*0.5*(J[0]+J[1]);Q>h.MAX_BITS_PER_CHANNEL-J[0]&&(Q=h.MAX_BITS_PER_CHANNEL-J[0]),Q<0&&(Q=0),J[1]>=125&&(J[1]-Q>125?(J[0]<T&&(J[0]+=Q),J[1]-=Q):(J[0]+=J[1]-125,J[1]=125)),Q=J[0]+J[1],Q>K&&(J[0]=K*J[0]/Q,J[1]=K*J[1]/Q),z(J[0]<=h.MAX_BITS_PER_CHANNEL),z(J[1]<=h.MAX_BITS_PER_CHANNEL),z(J[0]+J[1]<=h.MAX_BITS_PER_GRANULE)},this.athAdjust=function(J,O,T){var K=90.30873362,tt=94.82444863,Q=b.FAST_LOG10_X(O,10),l=J*J,a=0;return Q-=T,l>0.00000000000000000001&&(a=1+b.FAST_LOG10_X(l,10/K)),a<0&&(a=0),Q*=a,Q+=T+K-tt,Math.pow(10,0.1*Q)},this.calc_xmin=function(J,O,T,K){var tt=0,Q=J.internal_flags,l,a=0,s=0,c=Q.ATH,W=T.xr,_=J.VBR==n.vbr_mtrh?1:0,nt=Q.masking_lower;for((J.VBR==n.vbr_mtrh||J.VBR==n.vbr_mt)&&(nt=1),l=0;l<T.psy_lmax;l++){var X,R,at,pt,Ct,Dt;J.VBR==n.vbr_rh||J.VBR==n.vbr_mtrh?R=athAdjust(c.adjust,c.l[l],c.floor):R=c.adjust*c.l[l],Ct=T.width[l],at=R/Ct,pt=D,Dt=Ct>>1,X=0;do{var Wt,Pt;Wt=W[a]*W[a],X+=Wt,pt+=Wt<at?Wt:at,a++,Pt=W[a]*W[a],X+=Pt,pt+=Pt<at?Pt:at,a++}while(--Dt>0);if(X>R&&s++,l==Z.SBPSY_l){var Yt=R*Q.nsPsy.longfact[l];pt<Yt&&(pt=Yt)}if(_!=0&&(R=pt),!J.ATHonly){var St=O.en.l[l];if(St>0){var Yt;Yt=X*O.thm.l[l]*nt/St,_!=0&&(Yt*=Q.nsPsy.longfact[l]),R<Yt&&(R=Yt)}}_!=0?K[tt++]=R:K[tt++]=R*Q.nsPsy.longfact[l]}var wi=575;if(T.block_type!=Z.SHORT_TYPE)for(var o=576;o--!=0&&F.EQ(W[o],0);)wi=o;T.max_nonzero_coeff=wi;for(var p=T.sfb_smin;l<T.psymax;p++,l+=3){var Ct,ft,yt;for(J.VBR==n.vbr_rh||J.VBR==n.vbr_mtrh?yt=athAdjust(c.adjust,c.s[p],c.floor):yt=c.adjust*c.s[p],Ct=T.width[l],ft=0;ft<3;ft++){var X=0,R,at,pt,Dt=Ct>>1;at=yt/Ct,pt=D;do{var Wt,Pt;Wt=W[a]*W[a],X+=Wt,pt+=Wt<at?Wt:at,a++,Pt=W[a]*W[a],X+=Pt,pt+=Pt<at?Pt:at,a++}while(--Dt>0);if(X>yt&&s++,p==Z.SBPSY_s){var Yt=yt*Q.nsPsy.shortfact[p];pt<Yt&&(pt=Yt)}if(_!=0?R=pt:R=yt,!J.ATHonly&&!J.ATHshort){var St=O.en.s[p][ft];if(St>0){var Yt;Yt=X*O.thm.s[p][ft]*nt/St,_!=0&&(Yt*=Q.nsPsy.shortfact[p]),R<Yt&&(R=Yt)}}_!=0?K[tt++]=R:K[tt++]=R*Q.nsPsy.shortfact[p]}J.useTemporal&&(K[tt-3]>K[tt-3+1]&&(K[tt-3+1]+=(K[tt-3]-K[tt-3+1])*Q.decay),K[tt-3+1]>K[tt-3+2]&&(K[tt-3+2]+=(K[tt-3+1]-K[tt-3+2])*Q.decay))}return s};function r(J){this.s=J}this.calc_noise_core=function(J,O,T,K){var tt=0,Q=O.s,l=J.l3_enc;if(Q>J.count1)for(;T--!=0;){var a;a=J.xr[Q],Q++,tt+=a*a,a=J.xr[Q],Q++,tt+=a*a}else if(Q>J.big_values){var s=y(2);for(s[0]=0,s[1]=K;T--!=0;){var a;a=Math.abs(J.xr[Q])-s[l[Q]],Q++,tt+=a*a,a=Math.abs(J.xr[Q])-s[l[Q]],Q++,tt+=a*a}}else for(;T--!=0;){var a;a=Math.abs(J.xr[Q])-$[l[Q]]*K,Q++,tt+=a*a,a=Math.abs(J.xr[Q])-$[l[Q]]*K,Q++,tt+=a*a}return O.s=Q,tt},this.calc_noise=function(J,O,T,K,tt){var Q=0,l=0,a,s,c=0,W=0,_=0,nt=-20,X=0,R=J.scalefac,at=0;for(K.over_SSD=0,a=0;a<J.psymax;a++){var pt=J.global_gain-(R[at++]+(J.preflag!=0?Y[a]:0)<<J.scalefac_scale+1)-J.subblock_gain[J.window[a]]*8,Ct=0;if(tt!=null&&tt.step[a]==pt)Ct=tt.noise[a],X+=J.width[a],T[Q++]=Ct/O[l++],Ct=tt.noise_log[a];else{var Dt=E(pt);if(s=J.width[a]>>1,X+J.width[a]>J.max_nonzero_coeff){var Wt;Wt=J.max_nonzero_coeff-X+1,Wt>0?s=Wt>>1:s=0}var Pt=new r(X);Ct=this.calc_noise_core(J,Pt,s,Dt),X=Pt.s,tt!=null&&(tt.step[a]=pt,tt.noise[a]=Ct),Ct=T[Q++]=Ct/O[l++],Ct=b.FAST_LOG10(Math.max(Ct,0.00000000000000000001)),tt!=null&&(tt.noise_log[a]=Ct)}if(tt!=null&&(tt.global_gain=J.global_gain),_+=Ct,Ct>0){var Yt;Yt=Math.max(0|Ct*10+0.5,1),K.over_SSD+=Yt*Yt,c++,W+=Ct}nt=Math.max(nt,Ct)}return K.over_count=c,K.tot_noise=_,K.over_noise=W,K.max_noise=nt,c},this.set_pinfo=function(J,O,T,K,tt){var Q=J.internal_flags,l,a,s,c,W,_=O.scalefac_scale==0?0.5:1,nt=O.scalefac,X=y(L3Side.SFBMAX),R=y(L3Side.SFBMAX),at=new CalcNoiseResult;calc_xmin(J,T,O,X),calc_noise(O,X,R,at,null);var pt=0;for(a=O.sfb_lmax,O.block_type!=Z.SHORT_TYPE&&O.mixed_block_flag==0&&(a=22),l=0;l<a;l++){var Ct=Q.scalefac_band.l[l],Dt=Q.scalefac_band.l[l+1],Wt=Dt-Ct;for(c=0;pt<Dt;pt++)c+=O.xr[pt]*O.xr[pt];c/=Wt,W=1000000000000000,Q.pinfo.en[K][tt][l]=W*c,Q.pinfo.xfsf[K][tt][l]=W*X[l]*R[l]/Wt,T.en.l[l]>0&&!J.ATHonly?c=c/T.en.l[l]:c=0,Q.pinfo.thr[K][tt][l]=W*Math.max(c*T.thm.l[l],Q.ATH.l[l]),Q.pinfo.LAMEsfb[K][tt][l]=0,O.preflag!=0&&l>=11&&(Q.pinfo.LAMEsfb[K][tt][l]=-_*Y[l]),l<Z.SBPSY_l&&(z(nt[l]>=0),Q.pinfo.LAMEsfb[K][tt][l]-=_*nt[l])}if(O.block_type==Z.SHORT_TYPE)for(a=l,l=O.sfb_smin;l<Z.SBMAX_s;l++)for(var Ct=Q.scalefac_band.s[l],Dt=Q.scalefac_band.s[l+1],Wt=Dt-Ct,Pt=0;Pt<3;Pt++){for(c=0,s=Ct;s<Dt;s++)c+=O.xr[pt]*O.xr[pt],pt++;c=Math.max(c/Wt,0.00000000000000000001),W=1000000000000000,Q.pinfo.en_s[K][tt][3*l+Pt]=W*c,Q.pinfo.xfsf_s[K][tt][3*l+Pt]=W*X[a]*R[a]/Wt,T.en.s[l][Pt]>0?c=c/T.en.s[l][Pt]:c=0,(J.ATHonly||J.ATHshort)&&(c=0),Q.pinfo.thr_s[K][tt][3*l+Pt]=W*Math.max(c*T.thm.s[l][Pt],Q.ATH.s[l]),Q.pinfo.LAMEsfb_s[K][tt][3*l+Pt]=-2*O.subblock_gain[Pt],l<Z.SBPSY_s&&(Q.pinfo.LAMEsfb_s[K][tt][3*l+Pt]-=_*nt[a]),a++}Q.pinfo.LAMEqss[K][tt]=O.global_gain,Q.pinfo.LAMEmainbits[K][tt]=O.part2_3_length+O.part2_length,Q.pinfo.LAMEsfbits[K][tt]=O.part2_length,Q.pinfo.over[K][tt]=at.over_count,Q.pinfo.max_noise[K][tt]=at.max_noise*10,Q.pinfo.over_noise[K][tt]=at.over_noise*10,Q.pinfo.tot_noise[K][tt]=at.tot_noise*10,Q.pinfo.over_SSD[K][tt]=at.over_SSD}}return Te=d,Te}var Ee,Un;function wr(){if(Un)return Ee;Un=1;var t=Ht,e=t.System,n=t.Arrays,C=t.new_int,b=t.assert,y=si(),j=tn,z=Be,Z=mr();function B(){var h=null;this.qupvt=null,this.setModules=function(Q){this.qupvt=Q,h=Q};function d(Q){this.bits=0|Q}var F=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function q(Q,l,a,s,c,W){var _=0.5946/l;for(Q=Q>>1;Q--!=0;)c[W++]=_>a[s++]?0:1,c[W++]=_>a[s++]?0:1}function L(Q,l,a,s,c,W){Q=Q>>1;var _=Q%2;for(Q=Q>>1;Q--!=0;){var nt,X,R,at,pt,Ct,Dt,Wt;nt=a[s++]*l,X=a[s++]*l,pt=0|nt,R=a[s++]*l,Ct=0|X,at=a[s++]*l,Dt=0|R,nt+=h.adj43[pt],Wt=0|at,X+=h.adj43[Ct],c[W++]=0|nt,R+=h.adj43[Dt],c[W++]=0|X,at+=h.adj43[Wt],c[W++]=0|R,c[W++]=0|at}if(_!=0){var nt,X,pt,Ct;nt=a[s++]*l,X=a[s++]*l,pt=0|nt,Ct=0|X,nt+=h.adj43[pt],X+=h.adj43[Ct],c[W++]=0|nt,c[W++]=0|X}}function I(Q,l,a,s,c){var W,_,nt=0,X,R=0,at=0,pt=0,Ct=l,Dt=0,Wt=Ct,Pt=0,Yt=Q,St=0;for(X=c!=null&&s.global_gain==c.global_gain,s.block_type==y.SHORT_TYPE?_=38:_=21,W=0;W<=_;W++){var wi=-1;if((X||s.block_type==y.NORM_TYPE)&&(wi=s.global_gain-(s.scalefac[W]+(s.preflag!=0?h.pretab[W]:0)<<s.scalefac_scale+1)-s.subblock_gain[s.window[W]]*8),b(s.width[W]>=0),X&&c.step[W]==wi)R!=0&&(L(R,a,Yt,St,Wt,Pt),R=0),at!=0&&(q(at,a,Yt,St,Wt,Pt),at=0);else{var o=s.width[W];if(nt+s.width[W]>s.max_nonzero_coeff){var p;p=s.max_nonzero_coeff-nt+1,n.fill(l,s.max_nonzero_coeff,576,0),o=p,o<0&&(o=0),W=_+1}if(R==0&&at==0&&(Wt=Ct,Pt=Dt,Yt=Q,St=pt),c!=null&&c.sfb_count1>0&&W>=c.sfb_count1&&c.step[W]>0&&wi>=c.step[W]?(R!=0&&(L(R,a,Yt,St,Wt,Pt),R=0,Wt=Ct,Pt=Dt,Yt=Q,St=pt),at+=o):(at!=0&&(q(at,a,Yt,St,Wt,Pt),at=0,Wt=Ct,Pt=Dt,Yt=Q,St=pt),R+=o),o<=0){at!=0&&(q(at,a,Yt,St,Wt,Pt),at=0),R!=0&&(L(R,a,Yt,St,Wt,Pt),R=0);break}}W<=_&&(Dt+=s.width[W],pt+=s.width[W],nt+=s.width[W])}R!=0&&(L(R,a,Yt,St,Wt,Pt),R=0),at!=0&&(q(at,a,Yt,St,Wt,Pt),at=0)}function E(Q,l,a){var s=0,c=0;do{var W=Q[l++],_=Q[l++];s<W&&(s=W),c<_&&(c=_)}while(l<a);return s<c&&(s=c),s}function D(Q,l,a,s,c,W){var _=j.ht[s].xlen*65536+j.ht[c].xlen,nt=0,X;do{var R=Q[l++],at=Q[l++];R!=0&&(R>14&&(R=15,nt+=_),R*=16),at!=0&&(at>14&&(at=15,nt+=_),R+=at),nt+=j.largetbl[R]}while(l<a);return X=nt&65535,nt>>=16,nt>X&&(nt=X,s=c),W.bits+=nt,s}function g(Q,l,a,s){var c=0,W=j.ht[1].hlen;do{var _=Q[l+0]*2+Q[l+1];l+=2,c+=W[_]}while(l<a);return s.bits+=c,1}function w(Q,l,a,s,c){var W=0,_,nt=j.ht[s].xlen,X;s==2?X=j.table23:X=j.table56;do{var R=Q[l+0]*nt+Q[l+1];l+=2,W+=X[R]}while(l<a);return _=W&65535,W>>=16,W>_&&(W=_,s++),c.bits+=W,s}function k(Q,l,a,s,c){var W=0,_=0,nt=0,X=j.ht[s].xlen,R=j.ht[s].hlen,at=j.ht[s+1].hlen,pt=j.ht[s+2].hlen;do{var Ct=Q[l+0]*X+Q[l+1];l+=2,W+=R[Ct],_+=at[Ct],nt+=pt[Ct]}while(l<a);var Dt=s;return W>_&&(W=_,Dt++),W>nt&&(W=nt,Dt=s+2),c.bits+=W,Dt}var i=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function u(Q,l,a,s){var c=E(Q,l,a);switch(c){case 0:return c;case 1:return g(Q,l,a,s);case 2:case 3:return w(Q,l,a,i[c-1],s);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return k(Q,l,a,i[c-1],s);default:if(c>Z.IXMAX_VAL)return s.bits=Z.LARGE_BITS,-1;c-=15;var W;for(W=24;W<32&&!(j.ht[W].linmax>=c);W++);var _;for(_=W-8;_<24&&!(j.ht[_].linmax>=c);_++);return D(Q,l,a,_,W,s)}}this.noquant_count_bits=function(Q,l,a){var s=l.l3_enc,c=Math.min(576,l.max_nonzero_coeff+2>>1<<1);for(a!=null&&(a.sfb_count1=0);c>1&&!(s[c-1]|s[c-2]);c-=2);l.count1=c;for(var W=0,_=0;c>3;c-=4){var nt;if(((s[c-1]|s[c-2]|s[c-3]|s[c-4])&2147483647)>1)break;nt=((s[c-4]*2+s[c-3])*2+s[c-2])*2+s[c-1],W+=j.t32l[nt],_+=j.t33l[nt]}var X=W;if(l.count1table_select=0,W>_&&(X=_,l.count1table_select=1),l.count1bits=X,l.big_values=c,c==0)return X;if(l.block_type==y.SHORT_TYPE)W=3*Q.scalefac_band.s[3],W>l.big_values&&(W=l.big_values),_=l.big_values;else if(l.block_type==y.NORM_TYPE){if(W=l.region0_count=Q.bv_scf[c-2],_=l.region1_count=Q.bv_scf[c-1],b(W+_+2<y.SBPSY_l),_=Q.scalefac_band.l[W+_+2],W=Q.scalefac_band.l[W+1],_<c){var R=new d(X);l.table_select[2]=u(s,_,c,R),X=R.bits}}else l.region0_count=7,l.region1_count=y.SBMAX_l-1-7-1,W=Q.scalefac_band.l[8],_=c,W>_&&(W=_);if(W=Math.min(W,c),_=Math.min(_,c),0<W){var R=new d(X);l.table_select[0]=u(s,0,W,R),X=R.bits}if(W<_){var R=new d(X);l.table_select[1]=u(s,W,_,R),X=R.bits}if(Q.use_best_huffman==2&&(l.part2_3_length=X,best_huffman_divide(Q,l),X=l.part2_3_length),a!=null&&l.block_type==y.NORM_TYPE){for(var at=0;Q.scalefac_band.l[at]<l.big_values;)at++;a.sfb_count1=at}return X},this.count_bits=function(Q,l,a,s){var c=a.l3_enc,W=Z.IXMAX_VAL/h.IPOW20(a.global_gain);if(a.xrpow_max>W)return Z.LARGE_BITS;if(I(l,c,h.IPOW20(a.global_gain),a,s),Q.substep_shaping&2)for(var _=0,nt=a.global_gain+a.scalefac_scale,X=0.634521682242439/h.IPOW20(nt),R=0;R<a.sfbmax;R++){var at=a.width[R];if(Q.pseudohalf[R]==0)_+=at;else{var pt;for(pt=_,_+=at;pt<_;++pt)c[pt]=l[pt]>=X?c[pt]:0}}return this.noquant_count_bits(Q,a,s)};function Y(Q,l,a,s,c,W,_){for(var nt=l.big_values,X=0;X<=22;X++)s[X]=Z.LARGE_BITS;for(var X=0;X<16;X++){var R=Q.scalefac_band.l[X+1];if(R>=nt)break;var at=0,pt=new d(at),Ct=u(a,0,R,pt);at=pt.bits;for(var Dt=0;Dt<8;Dt++){var Wt=Q.scalefac_band.l[X+Dt+2];if(Wt>=nt)break;var Pt=at;pt=new d(Pt);var Yt=u(a,R,Wt,pt);Pt=pt.bits,s[X+Dt]>Pt&&(s[X+Dt]=Pt,c[X+Dt]=X,W[X+Dt]=Ct,_[X+Dt]=Yt)}}}function M(Q,l,a,s,c,W,_,nt){for(var X=l.big_values,R=2;R<y.SBMAX_l+1;R++){var at=Q.scalefac_band.l[R];if(at>=X)break;var pt=c[R-2]+l.count1bits;if(a.part2_3_length<=pt)break;var Ct=new d(pt),Dt=u(s,at,X,Ct);pt=Ct.bits,!(a.part2_3_length<=pt)&&(a.assign(l),a.part2_3_length=pt,a.region0_count=W[R-2],a.region1_count=R-2-W[R-2],a.table_select[0]=_[R-2],a.table_select[1]=nt[R-2],a.table_select[2]=Dt)}}this.best_huffman_divide=function(Q,l){var a=new z,s=l.l3_enc,c=C(23),W=C(23),_=C(23),nt=C(23);if(!(l.block_type==y.SHORT_TYPE&&Q.mode_gr==1)){a.assign(l),l.block_type==y.NORM_TYPE&&(Y(Q,l,s,c,W,_,nt),M(Q,a,l,s,c,W,_,nt));var X=a.big_values;if(!(X==0||(s[X-2]|s[X-1])>1)&&(X=l.count1+2,!(X>576))){a.assign(l),a.count1=X;for(var R=0,at=0;X>a.big_values;X-=4){var pt=((s[X-4]*2+s[X-3])*2+s[X-2])*2+s[X-1];R+=j.t32l[pt],at+=j.t33l[pt]}if(a.big_values=X,a.count1table_select=0,R>at&&(R=at,a.count1table_select=1),a.count1bits=R,a.block_type==y.NORM_TYPE)M(Q,a,l,s,c,W,_,nt);else{if(a.part2_3_length=R,R=Q.scalefac_band.l[8],R>X&&(R=X),R>0){var Ct=new d(a.part2_3_length);a.table_select[0]=u(s,0,R,Ct),a.part2_3_length=Ct.bits}if(X>R){var Ct=new d(a.part2_3_length);a.table_select[1]=u(s,R,X,Ct),a.part2_3_length=Ct.bits}l.part2_3_length>a.part2_3_length&&l.assign(a)}}}};var S=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],$=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],x=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],dt=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];B.slen1_tab=x,B.slen2_tab=dt;function P(Q,l){for(var a,s=l.tt[1][Q],c=l.tt[0][Q],W=0;W<j.scfsi_band.length-1;W++){for(a=j.scfsi_band[W];a<j.scfsi_band[W+1]&&!(c.scalefac[a]!=s.scalefac[a]&&s.scalefac[a]>=0);a++);if(a==j.scfsi_band[W+1]){for(a=j.scfsi_band[W];a<j.scfsi_band[W+1];a++)s.scalefac[a]=-1;l.scfsi[Q][W]=1}}var _=0,nt=0;for(a=0;a<11;a++)s.scalefac[a]!=-1&&(nt++,_<s.scalefac[a]&&(_=s.scalefac[a]));for(var X=0,R=0;a<y.SBPSY_l;a++)s.scalefac[a]!=-1&&(R++,X<s.scalefac[a]&&(X=s.scalefac[a]));for(var W=0;W<16;W++)if(_<S[W]&&X<$[W]){var at=x[W]*nt+dt[W]*R;s.part2_length>at&&(s.part2_length=at,s.scalefac_compress=W)}}this.best_scalefac_store=function(Q,l,a,s){var c=s.tt[l][a],W,_,nt,X,R=0;for(nt=0,W=0;W<c.sfbmax;W++){var at=c.width[W];for(nt+=at,X=-at;X<0&&c.l3_enc[X+nt]==0;X++);X==0&&(c.scalefac[W]=R=-2)}if(c.scalefac_scale==0&&c.preflag==0){var pt=0;for(W=0;W<c.sfbmax;W++)c.scalefac[W]>0&&(pt|=c.scalefac[W]);if(!(pt&1)&&pt!=0){for(W=0;W<c.sfbmax;W++)c.scalefac[W]>0&&(c.scalefac[W]>>=1);c.scalefac_scale=R=1}}if(c.preflag==0&&c.block_type!=y.SHORT_TYPE&&Q.mode_gr==2){for(W=11;W<y.SBPSY_l&&!(c.scalefac[W]<h.pretab[W]&&c.scalefac[W]!=-2);W++);if(W==y.SBPSY_l){for(W=11;W<y.SBPSY_l;W++)c.scalefac[W]>0&&(c.scalefac[W]-=h.pretab[W]);c.preflag=R=1}}for(_=0;_<4;_++)s.scfsi[a][_]=0;for(Q.mode_gr==2&&l==1&&s.tt[0][a].block_type!=y.SHORT_TYPE&&s.tt[1][a].block_type!=y.SHORT_TYPE&&(P(a,s),R=0),W=0;W<c.sfbmax;W++)c.scalefac[W]==-2&&(c.scalefac[W]=0);R!=0&&(Q.mode_gr==2?this.scale_bitcount(c):this.scale_bitcount_lsf(Q,c))};function r(Q,l){for(var a=0;a<l;++a)if(Q[a]<0)return!1;return!0}var J=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],O=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],T=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(Q){var l,a,s=0,c=0,W,_=Q.scalefac;if(b(r(_,Q.sfbmax)),Q.block_type==y.SHORT_TYPE)W=J,Q.mixed_block_flag!=0&&(W=O);else if(W=T,Q.preflag==0){for(a=11;a<y.SBPSY_l&&!(_[a]<h.pretab[a]);a++);if(a==y.SBPSY_l)for(Q.preflag=1,a=11;a<y.SBPSY_l;a++)_[a]-=h.pretab[a]}for(a=0;a<Q.sfbdivide;a++)s<_[a]&&(s=_[a]);for(;a<Q.sfbmax;a++)c<_[a]&&(c=_[a]);for(Q.part2_length=Z.LARGE_BITS,l=0;l<16;l++)s<S[l]&&c<$[l]&&Q.part2_length>W[l]&&(Q.part2_length=W[l],Q.scalefac_compress=l);return Q.part2_length==Z.LARGE_BITS};var K=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(Q,l){var a,s,c,W,_,nt,X,R,at=C(4),pt=l.scalefac;for(l.preflag!=0?a=2:a=0,X=0;X<4;X++)at[X]=0;if(l.block_type==y.SHORT_TYPE){s=1;var Ct=h.nr_of_sfb_block[a][s];for(R=0,c=0;c<4;c++)for(W=Ct[c]/3,X=0;X<W;X++,R++)for(_=0;_<3;_++)pt[R*3+_]>at[c]&&(at[c]=pt[R*3+_])}else{s=0;var Ct=h.nr_of_sfb_block[a][s];for(R=0,c=0;c<4;c++)for(W=Ct[c],X=0;X<W;X++,R++)pt[R]>at[c]&&(at[c]=pt[R])}for(nt=!1,c=0;c<4;c++)at[c]>K[a][c]&&(nt=!0);if(!nt){var Dt,Wt,Pt,Yt;for(l.sfb_partition_table=h.nr_of_sfb_block[a][s],c=0;c<4;c++)l.slen[c]=tt[at[c]];switch(Dt=l.slen[0],Wt=l.slen[1],Pt=l.slen[2],Yt=l.slen[3],a){case 0:l.scalefac_compress=(Dt*5+Wt<<4)+(Pt<<2)+Yt;break;case 1:l.scalefac_compress=400+(Dt*5+Wt<<2)+Pt;break;case 2:l.scalefac_compress=500+Dt*3+Wt;break;default:e.err.printf(`intensity stereo not implemented yet
`);break}}if(!nt)for(b(l.sfb_partition_table!=null),l.part2_length=0,c=0;c<4;c++)l.part2_length+=l.slen[c]*l.sfb_partition_table[c];return nt};var tt=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(Q){for(var l=2;l<=576;l+=2){for(var a=0,s;Q.scalefac_band.l[++a]<l;);for(s=F[a][0];Q.scalefac_band.l[s+1]>l;)s--;for(s<0&&(s=F[a][0]),Q.bv_scf[l-2]=s,s=F[a][1];Q.scalefac_band.l[s+Q.bv_scf[l-2]+2]>l;)s--;s<0&&(s=F[a][1]),Q.bv_scf[l-1]=s}}}return Ee=B,Ee}var Ve,On;function en(){if(On)return Ve;On=1;var t=Ht,e=t.System,n=t.Arrays,C=t.new_byte,b=t.new_float_n,y=t.new_int,j=t.assert,z=wr(),Z=tn,B=si(),h=ke;d.EQ=function(F,q){return Math.abs(F)>Math.abs(q)?Math.abs(F-q)<=Math.abs(F)*0.000001:Math.abs(F-q)<=Math.abs(q)*0.000001},d.NEQ=function(F,q){return!d.EQ(F,q)};function d(){var F=nn(),q=this,L=32773,I=null,E=null,D=null,g=null;this.setModules=function(l,a,s,c){I=l,E=a,D=s,g=c};var w=null,k=0,i=0,u=0;this.getframebits=function(l){var a=l.internal_flags,s;a.bitrate_index!=0?s=Z.bitrate_table[l.version][a.bitrate_index]:s=l.brate;var c=0|(l.version+1)*72000*s/l.out_samplerate+a.padding;return 8*c};function Y(l){e.arraycopy(l.header[l.w_ptr].buf,0,w,i,l.sideinfo_len),i+=l.sideinfo_len,k+=l.sideinfo_len*8,l.w_ptr=l.w_ptr+1&h.MAX_HEADER_BUF-1}function M(l,a,s){for(;s>0;){var c;u==0&&(u=8,i++,j(i<F.LAME_MAXMP3BUFFER),j(l.header[l.w_ptr].write_timing>=k),l.header[l.w_ptr].write_timing==k&&Y(l),w[i]=0),c=Math.min(s,u),s-=c,u-=c,w[i]|=a>>s<<u,k+=c}}function S(l,a,s){for(;s>0;){var c;u==0&&(u=8,i++,j(i<F.LAME_MAXMP3BUFFER),w[i]=0),c=Math.min(s,u),s-=c,u-=c,w[i]|=a>>s<<u,k+=c}}function $(l,a){var s=l.internal_flags,c;if(a>=8&&(M(s,76,8),a-=8),a>=8&&(M(s,65,8),a-=8),a>=8&&(M(s,77,8),a-=8),a>=8&&(M(s,69,8),a-=8),a>=32){var W=D.getLameShortVersion();if(a>=32)for(c=0;c<W.length&&a>=8;++c)a-=8,M(s,W.charAt(c),8)}for(;a>=1;a-=1)M(s,s.ancillary_flag,1),s.ancillary_flag^=l.disable_reservoir?0:1}function x(l,a,s){for(var c=l.header[l.h_ptr].ptr;s>0;){var W=Math.min(s,8-(c&7));s-=W,l.header[l.h_ptr].buf[c>>3]|=a>>s<<8-(c&7)-W,c+=W}l.header[l.h_ptr].ptr=c}function dt(l,a){l<<=8;for(var s=0;s<8;s++)l<<=1,a<<=1,(a^l)&65536&&(a^=L);return a}this.CRC_writeheader=function(l,a){var s=65535;s=dt(a[2]&255,s),s=dt(a[3]&255,s);for(var c=6;c<l.sideinfo_len;c++)s=dt(a[c]&255,s);a[4]=byte(s>>8),a[5]=byte(s&255)};function P(l,a){var s=l.internal_flags,c,W,_;if(c=s.l3_side,s.header[s.h_ptr].ptr=0,n.fill(s.header[s.h_ptr].buf,0,s.sideinfo_len,0),l.out_samplerate<16000?x(s,4094,12):x(s,4095,12),x(s,l.version,1),x(s,1,2),x(s,l.error_protection?0:1,1),x(s,s.bitrate_index,4),x(s,s.samplerate_index,2),x(s,s.padding,1),x(s,l.extension,1),x(s,l.mode.ordinal(),2),x(s,s.mode_ext,2),x(s,l.copyright,1),x(s,l.original,1),x(s,l.emphasis,2),l.error_protection&&x(s,0,16),l.version==1){for(j(c.main_data_begin>=0),x(s,c.main_data_begin,9),s.channels_out==2?x(s,c.private_bits,3):x(s,c.private_bits,5),_=0;_<s.channels_out;_++){var nt;for(nt=0;nt<4;nt++)x(s,c.scfsi[_][nt],1)}for(W=0;W<2;W++)for(_=0;_<s.channels_out;_++){var X=c.tt[W][_];x(s,X.part2_3_length+X.part2_length,12),x(s,X.big_values/2,9),x(s,X.global_gain,8),x(s,X.scalefac_compress,4),X.block_type!=B.NORM_TYPE?(x(s,1,1),x(s,X.block_type,2),x(s,X.mixed_block_flag,1),X.table_select[0]==14&&(X.table_select[0]=16),x(s,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),x(s,X.table_select[1],5),x(s,X.subblock_gain[0],3),x(s,X.subblock_gain[1],3),x(s,X.subblock_gain[2],3)):(x(s,0,1),X.table_select[0]==14&&(X.table_select[0]=16),x(s,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),x(s,X.table_select[1],5),X.table_select[2]==14&&(X.table_select[2]=16),x(s,X.table_select[2],5),j(0<=X.region0_count&&X.region0_count<16),j(0<=X.region1_count&&X.region1_count<8),x(s,X.region0_count,4),x(s,X.region1_count,3)),x(s,X.preflag,1),x(s,X.scalefac_scale,1),x(s,X.count1table_select,1)}}else for(j(c.main_data_begin>=0),x(s,c.main_data_begin,8),x(s,c.private_bits,s.channels_out),W=0,_=0;_<s.channels_out;_++){var X=c.tt[W][_];x(s,X.part2_3_length+X.part2_length,12),x(s,X.big_values/2,9),x(s,X.global_gain,8),x(s,X.scalefac_compress,9),X.block_type!=B.NORM_TYPE?(x(s,1,1),x(s,X.block_type,2),x(s,X.mixed_block_flag,1),X.table_select[0]==14&&(X.table_select[0]=16),x(s,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),x(s,X.table_select[1],5),x(s,X.subblock_gain[0],3),x(s,X.subblock_gain[1],3),x(s,X.subblock_gain[2],3)):(x(s,0,1),X.table_select[0]==14&&(X.table_select[0]=16),x(s,X.table_select[0],5),X.table_select[1]==14&&(X.table_select[1]=16),x(s,X.table_select[1],5),X.table_select[2]==14&&(X.table_select[2]=16),x(s,X.table_select[2],5),j(0<=X.region0_count&&X.region0_count<16),j(0<=X.region1_count&&X.region1_count<8),x(s,X.region0_count,4),x(s,X.region1_count,3)),x(s,X.scalefac_scale,1),x(s,X.count1table_select,1)}l.error_protection&&CRC_writeheader(s,s.header[s.h_ptr].buf);{var R=s.h_ptr;j(s.header[R].ptr==s.sideinfo_len*8),s.h_ptr=R+1&h.MAX_HEADER_BUF-1,s.header[s.h_ptr].write_timing=s.header[R].write_timing+a,s.h_ptr==s.w_ptr&&e.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function r(l,a){var s=Z.ht[a.count1table_select+32],c,W=0,_=a.big_values,nt=a.big_values;for(j(a.count1table_select<2),c=(a.count1-a.big_values)/4;c>0;--c){var X=0,R=0,at;at=a.l3_enc[_+0],at!=0&&(R+=8,a.xr[nt+0]<0&&X++),at=a.l3_enc[_+1],at!=0&&(R+=4,X*=2,a.xr[nt+1]<0&&X++),at=a.l3_enc[_+2],at!=0&&(R+=2,X*=2,a.xr[nt+2]<0&&X++),at=a.l3_enc[_+3],at!=0&&(R++,X*=2,a.xr[nt+3]<0&&X++),_+=4,nt+=4,M(l,X+s.table[R],s.hlen[R]),W+=s.hlen[R]}return W}function J(l,a,s,c,W){var _=Z.ht[a],nt=0;if(a==0)return nt;for(var X=s;X<c;X+=2){var R=0,at=0,pt=_.xlen,Ct=_.xlen,Dt=0,Wt=W.l3_enc[X],Pt=W.l3_enc[X+1];if(Wt!=0&&(W.xr[X]<0&&Dt++,R--),a>15){if(Wt>14){var Yt=Wt-15;j(Yt<=_.linmax),Dt|=Yt<<1,at=pt,Wt=15}if(Pt>14){var St=Pt-15;j(St<=_.linmax),Dt<<=pt,Dt|=St,at+=pt,Pt=15}Ct=16}Pt!=0&&(Dt<<=1,W.xr[X+1]<0&&Dt++,R--),Wt=Wt*Ct+Pt,at-=R,R+=_.hlen[Wt],M(l,_.table[Wt],R),M(l,Dt,at),nt+=R+at}return nt}function O(l,a){var s=3*l.scalefac_band.s[3];s>a.big_values&&(s=a.big_values);var c=J(l,a.table_select[0],0,s,a);return c+=J(l,a.table_select[1],s,a.big_values,a),c}function T(l,a){var s,c,W,_;s=a.big_values;var nt=a.region0_count+1;return j(nt<l.scalefac_band.l.length),W=l.scalefac_band.l[nt],nt+=a.region1_count+1,j(nt<l.scalefac_band.l.length),_=l.scalefac_band.l[nt],W>s&&(W=s),_>s&&(_=s),c=J(l,a.table_select[0],0,W,a),c+=J(l,a.table_select[1],W,_,a),c+=J(l,a.table_select[2],_,s,a),c}function K(l){var a,s,c,W,_=0,nt=l.internal_flags,X=nt.l3_side;if(l.version==1)for(a=0;a<2;a++)for(s=0;s<nt.channels_out;s++){var R=X.tt[a][s],at=z.slen1_tab[R.scalefac_compress],pt=z.slen2_tab[R.scalefac_compress];for(W=0,c=0;c<R.sfbdivide;c++)R.scalefac[c]!=-1&&(M(nt,R.scalefac[c],at),W+=at);for(;c<R.sfbmax;c++)R.scalefac[c]!=-1&&(M(nt,R.scalefac[c],pt),W+=pt);j(W==R.part2_length),R.block_type==B.SHORT_TYPE?W+=O(nt,R):W+=T(nt,R),W+=r(nt,R),j(W==R.part2_3_length+R.part2_length),_+=W}else for(a=0,s=0;s<nt.channels_out;s++){var R=X.tt[a][s],Ct,Dt,Wt=0;if(j(R.sfb_partition_table!=null),W=0,c=0,Dt=0,R.block_type==B.SHORT_TYPE){for(;Dt<4;Dt++){var Pt=R.sfb_partition_table[Dt]/3,Yt=R.slen[Dt];for(Ct=0;Ct<Pt;Ct++,c++)M(nt,Math.max(R.scalefac[c*3+0],0),Yt),M(nt,Math.max(R.scalefac[c*3+1],0),Yt),M(nt,Math.max(R.scalefac[c*3+2],0),Yt),Wt+=3*Yt}W+=O(nt,R)}else{for(;Dt<4;Dt++){var Pt=R.sfb_partition_table[Dt],Yt=R.slen[Dt];for(Ct=0;Ct<Pt;Ct++,c++)M(nt,Math.max(R.scalefac[c],0),Yt),Wt+=Yt}W+=T(nt,R)}W+=r(nt,R),j(W==R.part2_3_length),j(Wt==R.part2_length),_+=Wt+W}return _}function tt(){this.total=0}function Q(l,a){var s=l.internal_flags,c,W,_,nt,X;return X=s.w_ptr,nt=s.h_ptr-1,nt==-1&&(nt=h.MAX_HEADER_BUF-1),c=s.header[nt].write_timing-k,a.total=c,c>=0&&(W=1+nt-X,nt<X&&(W=1+nt-X+h.MAX_HEADER_BUF),c-=W*8*s.sideinfo_len),_=q.getframebits(l),c+=_,a.total+=_,a.total%8!=0?a.total=1+a.total/8:a.total=a.total/8,a.total+=i+1,c<0&&e.err.println(`strange error flushing buffer ... 
`),c}this.flush_bitstream=function(l){var a=l.internal_flags,s,c,W=a.h_ptr-1;if(W==-1&&(W=h.MAX_HEADER_BUF-1),s=a.l3_side,!((c=Q(l,new tt))<0)){if($(l,c),j(a.header[W].write_timing+this.getframebits(l)==k),a.ResvSize=0,s.main_data_begin=0,a.findReplayGain){var _=I.GetTitleGain(a.rgdata);j(NEQ(_,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),a.RadioGain=Math.floor(_*10+0.5)|0}a.findPeakSample&&(a.noclipGainChange=Math.ceil(Math.log10(a.PeakSample/32767)*20*10)|0,a.noclipGainChange>0&&(EQ(l.scale,1)||EQ(l.scale,0))?a.noclipScale=Math.floor(32767/a.PeakSample*100)/100:a.noclipScale=-1)}},this.add_dummy_byte=function(l,a,s){for(var c=l.internal_flags,W;s-- >0;)for(S(c,a,8),W=0;W<h.MAX_HEADER_BUF;++W)c.header[W].write_timing+=8},this.format_bitstream=function(l){var a=l.internal_flags,s;s=a.l3_side;var c=this.getframebits(l);$(l,s.resvDrain_pre),P(l,c);var W=8*a.sideinfo_len;if(W+=K(l),$(l,s.resvDrain_post),W+=s.resvDrain_post,s.main_data_begin+=(c-W)/8,Q(l,new tt)!=a.ResvSize&&e.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),s.main_data_begin*8!=a.ResvSize&&(e.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*s.main_data_begin,a.ResvSize,s.resvDrain_post,s.resvDrain_pre,8*a.sideinfo_len,W-s.resvDrain_post-8*a.sideinfo_len,W,W%8,c),e.err.println("This is a fatal error.  It has several possible causes:"),e.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),e.err.println(" 9%%  Your system is overclocked"),e.err.println(" 1%%  bug in LAME encoding library"),a.ResvSize=s.main_data_begin*8),k>1e9){var _;for(_=0;_<h.MAX_HEADER_BUF;++_)a.header[_].write_timing-=k;k=0}return 0},this.copy_buffer=function(l,a,s,c,W){var _=i+1;if(_<=0)return 0;if(c!=0&&_>c)return-1;if(e.arraycopy(w,0,a,s,_),i=-1,u=0,W!=0){var nt=y(1);if(nt[0]=l.nMusicCRC,g.updateMusicCRC(nt,a,s,_),l.nMusicCRC=nt[0],_>0&&(l.VBR_seek_table.nBytesWritten+=_),l.decode_on_the_fly){for(var X=b([2,1152]),R=_,at=-1,pt;at!=0;)if(at=E.hip_decode1_unclipped(l.hip,a,s,R,X[0],X[1]),R=0,at==-1&&(at=0),at>0){if(l.findPeakSample){for(pt=0;pt<at;pt++)X[0][pt]>l.PeakSample?l.PeakSample=X[0][pt]:-X[0][pt]>l.PeakSample&&(l.PeakSample=-X[0][pt]);if(l.channels_out>1)for(pt=0;pt<at;pt++)X[1][pt]>l.PeakSample?l.PeakSample=X[1][pt]:-X[1][pt]>l.PeakSample&&(l.PeakSample=-X[1][pt])}if(l.findReplayGain&&I.AnalyzeSamples(l.rgdata,X[0],0,X[1],0,at,l.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return _},this.init_bit_stream_w=function(l){w=C(F.LAME_MAXMP3BUFFER),l.h_ptr=l.w_ptr=0,l.header[l.h_ptr].write_timing=0,i=-1,u=0,k=0}}return Ve=d,Ve}var Ne,Kn;function nn(){if(Kn)return Ne;Kn=1;var t=Ht,e=t.System,n=t.VbrMode,C=t.ShortBlock,b=t.new_float,y=t.new_int_n,j=t.new_short_n,z=t.assert,Z=cs,B=gs,h=ke,d=Ls,F=Os,q=Ns,L=en(),I=tn,E=si();function D(){var g=ce,w=this,k=131072;D.V9=410,D.V8=420,D.V7=430,D.V6=440,D.V5=450,D.V4=460,D.V3=470,D.V2=480,D.V1=490,D.V0=500,D.R3MIX=1000,D.STANDARD=1001,D.EXTREME=1002,D.INSANE=1003,D.STANDARD_FAST=1004,D.EXTREME_FAST=1005,D.MEDIUM=1006,D.MEDIUM_FAST=1007;var i=16384+k;D.LAME_MAXMP3BUFFER=i;var u,Y,M,S,$,x=new Z,dt,P,r;this.enc=new E,this.setModules=function(o,p,ft,yt,Ft,$t,Jt,zt,xt){u=o,Y=p,M=ft,S=yt,$=Ft,dt=$t,P=zt,r=xt,this.enc.setModules(Y,x,S,dt)};function J(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=b(E.SBMAX_l),this.bo_s_weight=b(E.SBMAX_s)}function O(){this.lowerlimit=0}function T(o,p){this.lowpass=p}var K=4294479419;function tt(o){var p;return o.class_id=K,p=o.internal_flags=new h,o.mode=g.NOT_SET,o.original=1,o.in_samplerate=44100,o.num_channels=2,o.num_samples=-1,o.bWriteVbrTag=!0,o.quality=-1,o.short_blocks=null,p.subblock_gain=-1,o.lowpassfreq=0,o.highpassfreq=0,o.lowpasswidth=-1,o.highpasswidth=-1,o.VBR=n.vbr_off,o.VBR_q=4,o.ATHcurve=-1,o.VBR_mean_bitrate_kbps=128,o.VBR_min_bitrate_kbps=0,o.VBR_max_bitrate_kbps=0,o.VBR_hard_min=0,p.VBR_min_bitrate=1,p.VBR_max_bitrate=13,o.quant_comp=-1,o.quant_comp_short=-1,o.msfix=-1,p.resample_ratio=1,p.OldValue[0]=180,p.OldValue[1]=180,p.CurrentStep[0]=4,p.CurrentStep[1]=4,p.masking_lower=1,p.nsPsy.attackthre=-1,p.nsPsy.attackthre_s=-1,o.scale=-1,o.athaa_type=-1,o.ATHtype=-1,o.athaa_loudapprox=-1,o.athaa_sensitivity=0,o.useTemporal=null,o.interChRatio=-1,p.mf_samples_to_encode=E.ENCDELAY+E.POSTDELAY,o.encoder_padding=0,p.mf_size=E.ENCDELAY-E.MDCTDELAY,o.findReplayGain=!1,o.decode_on_the_fly=!1,p.decode_on_the_fly=!1,p.findReplayGain=!1,p.findPeakSample=!1,p.RadioGain=0,p.AudiophileGain=0,p.noclipGainChange=0,p.noclipScale=-1,o.preset=0,o.write_id3tag_automatic=!0,0}this.lame_init=function(){var o=new B;return tt(o),o.lame_allocated_gfp=1,o};function Q(o){return o>1?0:o<=0?1:Math.cos(Math.PI/2*o)}this.nearestBitrateFullIndex=function(o){var p=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],ft=0,yt=0,Ft=0,$t=0;$t=p[16],Ft=16,yt=p[16],ft=16;for(var Jt=0;Jt<16;Jt++)if(Math.max(o,p[Jt+1])!=o){$t=p[Jt+1],Ft=Jt+1,yt=p[Jt],ft=Jt;break}return $t-o>o-yt?ft:Ft};function l(o,p){var ft=44100;return p>=48000?ft=48000:p>=44100?ft=44100:p>=32000?ft=32000:p>=24000?ft=24000:p>=22050?ft=22050:p>=16000?ft=16000:p>=12000?ft=12000:p>=11025?ft=11025:p>=8000&&(ft=8000),o==-1?ft:(o<=15960&&(ft=44100),o<=15250&&(ft=32000),o<=11220&&(ft=24000),o<=9970&&(ft=22050),o<=7230&&(ft=16000),o<=5420&&(ft=12000),o<=4510&&(ft=11025),o<=3970&&(ft=8000),p<ft?p>44100?48000:p>32000?44100:p>24000?32000:p>22050?24000:p>16000?22050:p>12000?16000:p>11025?12000:p>8000?11025:8000:ft)}function a(o,p){switch(o){case 44100:return p.version=1,0;case 48000:return p.version=1,1;case 32000:return p.version=1,2;case 22050:return p.version=0,0;case 24000:return p.version=0,1;case 16000:return p.version=0,2;case 11025:return p.version=0,0;case 12000:return p.version=0,1;case 8000:return p.version=0,2;default:return p.version=0,-1}}function s(o,p,ft){ft<16000&&(p=2);for(var yt=I.bitrate_table[p][1],Ft=2;Ft<=14;Ft++)I.bitrate_table[p][Ft]>0&&Math.abs(I.bitrate_table[p][Ft]-o)<Math.abs(yt-o)&&(yt=I.bitrate_table[p][Ft]);return yt}function c(o,p,ft){ft<16000&&(p=2);for(var yt=0;yt<=14;yt++)if(I.bitrate_table[p][yt]>0&&I.bitrate_table[p][yt]==o)return yt;return-1}function W(o,p){var ft=[new T(8,2000),new T(16,3700),new T(24,3900),new T(32,5500),new T(40,7000),new T(48,7500),new T(56,1e4),new T(64,11000),new T(80,13500),new T(96,15100),new T(112,15600),new T(128,17000),new T(160,17500),new T(192,18600),new T(224,19400),new T(256,19700),new T(320,20500)],yt=w.nearestBitrateFullIndex(p);o.lowerlimit=ft[yt].lowpass}function _(o){var p=o.internal_flags,ft=32,yt=-1;if(p.lowpass1>0){for(var Ft=999,$t=0;$t<=31;$t++){var Jt=$t/31;Jt>=p.lowpass2&&(ft=Math.min(ft,$t)),p.lowpass1<Jt&&Jt<p.lowpass2&&(Ft=Math.min(Ft,$t))}Ft==999?p.lowpass1=(ft-0.75)/31:p.lowpass1=(Ft-0.75)/31,p.lowpass2=ft/31}if(p.highpass2>0&&p.highpass2<0.021774193548387097&&(p.highpass1=0,p.highpass2=0,e.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),p.highpass2>0){for(var zt=-1,$t=0;$t<=31;$t++){var Jt=$t/31;Jt<=p.highpass1&&(yt=Math.max(yt,$t)),p.highpass1<Jt&&Jt<p.highpass2&&(zt=Math.max(zt,$t))}p.highpass1=yt/31,zt==-1?p.highpass2=(yt+0.75)/31:p.highpass2=(zt+0.75)/31}for(var $t=0;$t<32;$t++){var xt,Gt,Jt=$t/31;p.highpass2>p.highpass1?xt=Q((p.highpass2-Jt)/(p.highpass2-p.highpass1+0.00000000000000000001)):xt=1,p.lowpass2>p.lowpass1?Gt=Q((Jt-p.lowpass1)/(p.lowpass2-p.lowpass1+0.00000000000000000001)):Gt=1,p.amp_filter[$t]=xt*Gt}}function nt(o){var p=o.internal_flags;switch(o.quality){default:case 9:p.psymodel=0,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 8:o.quality=7;case 7:p.psymodel=1,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 6:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 5:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 4:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 3:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 2:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 1:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 0:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break}}function X(o){var p=o.internal_flags;o.frameNum=0,o.write_id3tag_automatic&&P.id3tag_write_v2(o),p.bitrate_stereoMode_Hist=y([16,5]),p.bitrate_blockType_Hist=y([16,6]),p.PeakSample=0,o.bWriteVbrTag&&dt.InitVbrTag(o)}this.lame_init_params=function(o){var p=o.internal_flags;if(p.Class_ID=0,p.ATH==null&&(p.ATH=new d),p.PSY==null&&(p.PSY=new J),p.rgdata==null&&(p.rgdata=new F),p.channels_in=o.num_channels,p.channels_in==1&&(o.mode=g.MONO),p.channels_out=o.mode==g.MONO?1:2,p.mode_ext=E.MPG_MD_MS_LR,o.mode==g.MONO&&(o.force_ms=!1),o.VBR==n.vbr_off&&o.VBR_mean_bitrate_kbps!=128&&o.brate==0&&(o.brate=o.VBR_mean_bitrate_kbps),o.VBR==n.vbr_off||o.VBR==n.vbr_mtrh||o.VBR==n.vbr_mt||(o.free_format=!1),o.VBR==n.vbr_off&&o.brate==0&&L.EQ(o.compression_ratio,0)&&(o.compression_ratio=11.025),o.VBR==n.vbr_off&&o.compression_ratio>0&&(o.out_samplerate==0&&(o.out_samplerate=map2MP3Frequency(int(0.97*o.in_samplerate))),o.brate=0|o.out_samplerate*16*p.channels_out/(1000*o.compression_ratio),p.samplerate_index=a(o.out_samplerate,o),o.free_format||(o.brate=s(o.brate,o.version,o.out_samplerate))),o.out_samplerate!=0&&(o.out_samplerate<16000?(o.VBR_mean_bitrate_kbps=Math.max(o.VBR_mean_bitrate_kbps,8),o.VBR_mean_bitrate_kbps=Math.min(o.VBR_mean_bitrate_kbps,64)):o.out_samplerate<32000?(o.VBR_mean_bitrate_kbps=Math.max(o.VBR_mean_bitrate_kbps,8),o.VBR_mean_bitrate_kbps=Math.min(o.VBR_mean_bitrate_kbps,160)):(o.VBR_mean_bitrate_kbps=Math.max(o.VBR_mean_bitrate_kbps,32),o.VBR_mean_bitrate_kbps=Math.min(o.VBR_mean_bitrate_kbps,320))),o.lowpassfreq==0){var ft=16000;switch(o.VBR){case n.vbr_off:{var yt=new O;W(yt,o.brate),ft=yt.lowerlimit;break}case n.vbr_abr:{var yt=new O;W(yt,o.VBR_mean_bitrate_kbps),ft=yt.lowerlimit;break}case n.vbr_rh:{var Ft=[19500,19000,18600,18000,17500,16000,15600,14900,12500,1e4,3950];if(0<=o.VBR_q&&o.VBR_q<=9){var $t=Ft[o.VBR_q],Jt=Ft[o.VBR_q+1],zt=o.VBR_q_frac;ft=linear_int($t,Jt,zt)}else ft=19500;break}default:{var Ft=[19500,19000,18500,18000,17500,16500,15500,14500,12500,9500,3950];if(0<=o.VBR_q&&o.VBR_q<=9){var $t=Ft[o.VBR_q],Jt=Ft[o.VBR_q+1],zt=o.VBR_q_frac;ft=linear_int($t,Jt,zt)}else ft=19500}}o.mode==g.MONO&&(o.VBR==n.vbr_off||o.VBR==n.vbr_abr)&&(ft*=1.5),o.lowpassfreq=ft|0}if(o.out_samplerate==0&&(2*o.lowpassfreq>o.in_samplerate&&(o.lowpassfreq=o.in_samplerate/2),o.out_samplerate=l(o.lowpassfreq|0,o.in_samplerate)),o.lowpassfreq=Math.min(20500,o.lowpassfreq),o.lowpassfreq=Math.min(o.out_samplerate/2,o.lowpassfreq),o.VBR==n.vbr_off&&(o.compression_ratio=o.out_samplerate*16*p.channels_out/(1000*o.brate)),o.VBR==n.vbr_abr&&(o.compression_ratio=o.out_samplerate*16*p.channels_out/(1000*o.VBR_mean_bitrate_kbps)),o.bWriteVbrTag||(o.findReplayGain=!1,o.decode_on_the_fly=!1,p.findPeakSample=!1),p.findReplayGain=o.findReplayGain,p.decode_on_the_fly=o.decode_on_the_fly,p.decode_on_the_fly&&(p.findPeakSample=!0),p.findReplayGain&&u.InitGainAnalysis(p.rgdata,o.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return o.internal_flags=null,-6;switch(p.decode_on_the_fly&&!o.decode_only&&(p.hip!=null&&r.hip_decode_exit(p.hip),p.hip=r.hip_decode_init()),p.mode_gr=o.out_samplerate<=24000?1:2,o.framesize=576*p.mode_gr,o.encoder_delay=E.ENCDELAY,p.resample_ratio=o.in_samplerate/o.out_samplerate,o.VBR){case n.vbr_mt:case n.vbr_rh:case n.vbr_mtrh:{var xt=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];o.compression_ratio=xt[o.VBR_q]}break;case n.vbr_abr:o.compression_ratio=o.out_samplerate*16*p.channels_out/(1000*o.VBR_mean_bitrate_kbps);break;default:o.compression_ratio=o.out_samplerate*16*p.channels_out/(1000*o.brate);break}if(o.mode==g.NOT_SET&&(o.mode=g.JOINT_STEREO),o.highpassfreq>0?(p.highpass1=2*o.highpassfreq,o.highpasswidth>=0?p.highpass2=2*(o.highpassfreq+o.highpasswidth):p.highpass2=2*o.highpassfreq,p.highpass1/=o.out_samplerate,p.highpass2/=o.out_samplerate):(p.highpass1=0,p.highpass2=0),o.lowpassfreq>0?(p.lowpass2=2*o.lowpassfreq,o.lowpasswidth>=0?(p.lowpass1=2*(o.lowpassfreq-o.lowpasswidth),p.lowpass1<0&&(p.lowpass1=0)):p.lowpass1=2*o.lowpassfreq,p.lowpass1/=o.out_samplerate,p.lowpass2/=o.out_samplerate):(p.lowpass1=0,p.lowpass2=0),_(o),p.samplerate_index=a(o.out_samplerate,o),p.samplerate_index<0)return o.internal_flags=null,-1;if(o.VBR==n.vbr_off){if(o.free_format)p.bitrate_index=0;else if(o.brate=s(o.brate,o.version,o.out_samplerate),p.bitrate_index=c(o.brate,o.version,o.out_samplerate),p.bitrate_index<=0)return o.internal_flags=null,-1}else p.bitrate_index=1;o.analysis&&(o.bWriteVbrTag=!1),p.pinfo!=null&&(o.bWriteVbrTag=!1),Y.init_bit_stream_w(p);for(var Gt=p.samplerate_index+3*o.version+6*(o.out_samplerate<16000?1:0),mt=0;mt<E.SBMAX_l+1;mt++)p.scalefac_band.l[mt]=S.sfBandIndex[Gt].l[mt];for(var mt=0;mt<E.PSFB21+1;mt++){var qt=(p.scalefac_band.l[22]-p.scalefac_band.l[21])/E.PSFB21,ei=p.scalefac_band.l[21]+mt*qt;p.scalefac_band.psfb21[mt]=ei}p.scalefac_band.psfb21[E.PSFB21]=576;for(var mt=0;mt<E.SBMAX_s+1;mt++)p.scalefac_band.s[mt]=S.sfBandIndex[Gt].s[mt];for(var mt=0;mt<E.PSFB12+1;mt++){var qt=(p.scalefac_band.s[13]-p.scalefac_band.s[12])/E.PSFB12,ei=p.scalefac_band.s[12]+mt*qt;p.scalefac_band.psfb12[mt]=ei}p.scalefac_band.psfb12[E.PSFB12]=192,o.version==1?p.sideinfo_len=p.channels_out==1?21:36:p.sideinfo_len=p.channels_out==1?13:21,o.error_protection&&(p.sideinfo_len+=2),X(o),p.Class_ID=K;{var Ut;for(Ut=0;Ut<19;Ut++)p.nsPsy.pefirbuf[Ut]=700*p.mode_gr*p.channels_out;o.ATHtype==-1&&(o.ATHtype=4)}switch(z(o.VBR_q<=9),z(o.VBR_q>=0),o.VBR){case n.vbr_mt:o.VBR=n.vbr_mtrh;case n.vbr_mtrh:{o.useTemporal==null&&(o.useTemporal=!1),M.apply_preset(o,500-o.VBR_q*10,0),o.quality<0&&(o.quality=LAME_DEFAULT_QUALITY),o.quality<5&&(o.quality=0),o.quality>5&&(o.quality=5),p.PSY.mask_adjust=o.maskingadjust,p.PSY.mask_adjust_short=o.maskingadjust_short,o.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=o.out_samplerate>44000,p.iteration_loop=new VBRNewIterationLoop($);break}case n.vbr_rh:{M.apply_preset(o,500-o.VBR_q*10,0),p.PSY.mask_adjust=o.maskingadjust,p.PSY.mask_adjust_short=o.maskingadjust_short,o.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=o.out_samplerate>44000,o.quality>6&&(o.quality=6),o.quality<0&&(o.quality=LAME_DEFAULT_QUALITY),p.iteration_loop=new VBROldIterationLoop($);break}default:{var m;p.sfb21_extra=!1,o.quality<0&&(o.quality=LAME_DEFAULT_QUALITY),m=o.VBR,m==n.vbr_off&&(o.VBR_mean_bitrate_kbps=o.brate),M.apply_preset(o,o.VBR_mean_bitrate_kbps,0),o.VBR=m,p.PSY.mask_adjust=o.maskingadjust,p.PSY.mask_adjust_short=o.maskingadjust_short,m==n.vbr_off?p.iteration_loop=new q($):p.iteration_loop=new ABRIterationLoop($);break}}if(z(o.scale>=0),o.VBR!=n.vbr_off){if(p.VBR_min_bitrate=1,p.VBR_max_bitrate=14,o.out_samplerate<16000&&(p.VBR_max_bitrate=8),o.VBR_min_bitrate_kbps!=0&&(o.VBR_min_bitrate_kbps=s(o.VBR_min_bitrate_kbps,o.version,o.out_samplerate),p.VBR_min_bitrate=c(o.VBR_min_bitrate_kbps,o.version,o.out_samplerate),p.VBR_min_bitrate<0)||o.VBR_max_bitrate_kbps!=0&&(o.VBR_max_bitrate_kbps=s(o.VBR_max_bitrate_kbps,o.version,o.out_samplerate),p.VBR_max_bitrate=c(o.VBR_max_bitrate_kbps,o.version,o.out_samplerate),p.VBR_max_bitrate<0))return-1;o.VBR_min_bitrate_kbps=I.bitrate_table[o.version][p.VBR_min_bitrate],o.VBR_max_bitrate_kbps=I.bitrate_table[o.version][p.VBR_max_bitrate],o.VBR_mean_bitrate_kbps=Math.min(I.bitrate_table[o.version][p.VBR_max_bitrate],o.VBR_mean_bitrate_kbps),o.VBR_mean_bitrate_kbps=Math.max(I.bitrate_table[o.version][p.VBR_min_bitrate],o.VBR_mean_bitrate_kbps)}return o.tune&&(p.PSY.mask_adjust+=o.tune_value_a,p.PSY.mask_adjust_short+=o.tune_value_a),nt(o),z(o.scale>=0),o.athaa_type<0?p.ATH.useAdjust=3:p.ATH.useAdjust=o.athaa_type,p.ATH.aaSensitivityP=Math.pow(10,o.athaa_sensitivity/-10),o.short_blocks==null&&(o.short_blocks=C.short_block_allowed),o.short_blocks==C.short_block_allowed&&(o.mode==g.JOINT_STEREO||o.mode==g.STEREO)&&(o.short_blocks=C.short_block_coupled),o.quant_comp<0&&(o.quant_comp=1),o.quant_comp_short<0&&(o.quant_comp_short=0),o.msfix<0&&(o.msfix=0),o.exp_nspsytune=o.exp_nspsytune|1,o.internal_flags.nsPsy.attackthre<0&&(o.internal_flags.nsPsy.attackthre=Z.NSATTACKTHRE),o.internal_flags.nsPsy.attackthre_s<0&&(o.internal_flags.nsPsy.attackthre_s=Z.NSATTACKTHRE_S),z(o.scale>=0),o.scale<0&&(o.scale=1),o.ATHtype<0&&(o.ATHtype=4),o.ATHcurve<0&&(o.ATHcurve=4),o.athaa_loudapprox<0&&(o.athaa_loudapprox=2),o.interChRatio<0&&(o.interChRatio=0),o.useTemporal==null&&(o.useTemporal=!0),p.slot_lag=p.frac_SpF=0,o.VBR==n.vbr_off&&(p.slot_lag=p.frac_SpF=(o.version+1)*72000*o.brate%o.out_samplerate|0),S.iteration_init(o),x.psymodel_init(o),z(o.scale>=0),0};function R(o,p){(o.in_buffer_0==null||o.in_buffer_nsamples<p)&&(o.in_buffer_0=b(p),o.in_buffer_1=b(p),o.in_buffer_nsamples=p)}this.lame_encode_flush=function(o,p,ft,yt){var Ft=o.internal_flags,$t=j([2,1152]),Jt=0,zt,xt,Gt,mt,qt=Ft.mf_samples_to_encode-E.POSTDELAY,ei=at(o);if(Ft.mf_samples_to_encode<1)return 0;for(zt=0,o.in_samplerate!=o.out_samplerate&&(qt+=16*o.out_samplerate/o.in_samplerate),Gt=o.framesize-qt%o.framesize,Gt<576&&(Gt+=o.framesize),o.encoder_padding=Gt,mt=(qt+Gt)/o.framesize;mt>0&&Jt>=0;){var Ut=ei-Ft.mf_size,m=o.frameNum;Ut*=o.in_samplerate,Ut/=o.out_samplerate,Ut>1152&&(Ut=1152),Ut<1&&(Ut=1),xt=yt-zt,yt==0&&(xt=0),Jt=this.lame_encode_buffer(o,$t[0],$t[1],Ut,p,ft,xt),ft+=Jt,zt+=Jt,mt-=m!=o.frameNum?1:0}if(Ft.mf_samples_to_encode=0,Jt<0||(xt=yt-zt,yt==0&&(xt=0),Y.flush_bitstream(o),Jt=Y.copy_buffer(Ft,p,ft,xt,1),Jt<0))return Jt;if(ft+=Jt,zt+=Jt,xt=yt-zt,yt==0&&(xt=0),o.write_id3tag_automatic){if(P.id3tag_write_v1(o),Jt=Y.copy_buffer(Ft,p,ft,xt,0),Jt<0)return Jt;zt+=Jt}return zt},this.lame_encode_buffer=function(o,p,ft,yt,Ft,$t,Jt){var zt=o.internal_flags,xt=[null,null];if(zt.Class_ID!=K)return-3;if(yt==0)return 0;R(zt,yt),xt[0]=zt.in_buffer_0,xt[1]=zt.in_buffer_1;for(var Gt=0;Gt<yt;Gt++)xt[0][Gt]=p[Gt],zt.channels_in>1&&(xt[1][Gt]=ft[Gt]);return pt(o,xt[0],xt[1],yt,Ft,$t,Jt)};function at(o){var p=E.BLKSIZE+o.framesize-E.FFTOFFSET;return p=Math.max(p,512+o.framesize-32),p}function pt(o,p,ft,yt,Ft,$t,Jt){var zt=o.internal_flags,xt=0,Gt,mt,qt,ei,Ut,m=[null,null],f=[null,null];if(zt.Class_ID!=K)return-3;if(yt==0)return 0;if(Ut=Y.copy_buffer(zt,Ft,$t,Jt,0),Ut<0)return Ut;if($t+=Ut,xt+=Ut,f[0]=p,f[1]=ft,L.NEQ(o.scale,0)&&L.NEQ(o.scale,1))for(mt=0;mt<yt;++mt)f[0][mt]*=o.scale,zt.channels_out==2&&(f[1][mt]*=o.scale);if(L.NEQ(o.scale_left,0)&&L.NEQ(o.scale_left,1))for(mt=0;mt<yt;++mt)f[0][mt]*=o.scale_left;if(L.NEQ(o.scale_right,0)&&L.NEQ(o.scale_right,1))for(mt=0;mt<yt;++mt)f[1][mt]*=o.scale_right;if(o.num_channels==2&&zt.channels_out==1)for(mt=0;mt<yt;++mt)f[0][mt]=0.5*(f[0][mt]+f[1][mt]),f[1][mt]=0;ei=at(o),m[0]=zt.mfbuf[0],m[1]=zt.mfbuf[1];for(var G=0;yt>0;){var U=[null,null],H=0,v=0;U[0]=f[0],U[1]=f[1];var V=new Dt;if(wi(o,m,U,G,yt,V),H=V.n_in,v=V.n_out,zt.findReplayGain&&!zt.decode_on_the_fly&&u.AnalyzeSamples(zt.rgdata,m[0],zt.mf_size,m[1],zt.mf_size,v,zt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(yt-=H,G+=H,zt.channels_out==0,zt.mf_size+=v,z(zt.mf_size<=h.MFSIZE),zt.mf_samples_to_encode<1&&(zt.mf_samples_to_encode=E.ENCDELAY+E.POSTDELAY),zt.mf_samples_to_encode+=v,zt.mf_size>=ei){var A=Jt-xt;if(Jt==0&&(A=0),Gt=Ct(o,m[0],m[1],Ft,$t,A),Gt<0)return Gt;for($t+=Gt,xt+=Gt,zt.mf_size-=o.framesize,zt.mf_samples_to_encode-=o.framesize,qt=0;qt<zt.channels_out;qt++)for(mt=0;mt<zt.mf_size;mt++)m[qt][mt]=m[qt][mt+o.framesize]}}return xt}function Ct(o,p,ft,yt,Ft,$t){var Jt=w.enc.lame_encode_mp3_frame(o,p,ft,yt,Ft,$t);return o.frameNum++,Jt}function Dt(){this.n_in=0,this.n_out=0}function Wt(){this.num_used=0}function Pt(o,p){return p!=0?Pt(p,o%p):o}function Yt(o,p,ft){var yt=Math.PI*p;o/=ft,o<0&&(o=0),o>1&&(o=1);var Ft=o-0.5,$t=0.42-0.5*Math.cos(2*o*Math.PI)+0.08*Math.cos(4*o*Math.PI);return Math.abs(Ft)<0.000000001?yt/Math.PI:$t*Math.sin(ft*yt*Ft)/(Math.PI*ft*Ft)}function St(o,p,ft,yt,Ft,$t,Jt,zt,xt){var Gt=o.internal_flags,mt,qt=0,ei,Ut=o.out_samplerate/Pt(o.out_samplerate,o.in_samplerate);Ut>h.BPC&&(Ut=h.BPC);var m=Math.abs(Gt.resample_ratio-Math.floor(0.5+Gt.resample_ratio))<0.0001?1:0,f=1/Gt.resample_ratio;f>1&&(f=1);var G=31;G%2==0&&--G,G+=m;var U=G+1;if(Gt.fill_buffer_resample_init==0){for(Gt.inbuf_old[0]=b(U),Gt.inbuf_old[1]=b(U),mt=0;mt<=2*Ut;++mt)Gt.blackfilt[mt]=b(U);for(Gt.itime[0]=0,Gt.itime[1]=0,qt=0;qt<=2*Ut;qt++){var H=0,v=(qt-Ut)/(2*Ut);for(mt=0;mt<=G;mt++)H+=Gt.blackfilt[qt][mt]=Yt(mt-v,f,G);for(mt=0;mt<=G;mt++)Gt.blackfilt[qt][mt]/=H}Gt.fill_buffer_resample_init=1}var V=Gt.inbuf_old[xt];for(ei=0;ei<yt;ei++){var A,N;if(A=ei*Gt.resample_ratio,qt=0|Math.floor(A-Gt.itime[xt]),G+qt-G/2>=Jt)break;var v=A-Gt.itime[xt]-(qt+0.5*(G%2));N=0|Math.floor(v*2*Ut+Ut+0.5);var rt=0;for(mt=0;mt<=G;++mt){var it=0|mt+qt-G/2,st;st=it<0?V[U+it]:Ft[$t+it],rt+=st*Gt.blackfilt[N][mt]}p[ft+ei]=rt}if(zt.num_used=Math.min(Jt,G+qt-G/2),Gt.itime[xt]+=zt.num_used-ei*Gt.resample_ratio,zt.num_used>=U)for(mt=0;mt<U;mt++)V[mt]=Ft[$t+zt.num_used+mt-U];else{var gt=U-zt.num_used;for(mt=0;mt<gt;++mt)V[mt]=V[mt+zt.num_used];for(qt=0;mt<U;++mt,++qt)V[mt]=Ft[$t+qt];z(qt==zt.num_used)}return ei}function wi(o,p,ft,yt,Ft,$t){var Jt=o.internal_flags;if(Jt.resample_ratio<0.9999||Jt.resample_ratio>1.0001)for(var zt=0;zt<Jt.channels_out;zt++){var xt=new Wt;$t.n_out=St(o,p[zt],Jt.mf_size,o.framesize,ft[zt],yt,Ft,xt,zt),$t.n_in=xt.num_used}else{$t.n_out=Math.min(o.framesize,Ft),$t.n_in=$t.n_out;for(var Gt=0;Gt<$t.n_out;++Gt)p[0][Jt.mf_size+Gt]=ft[0][yt+Gt],Jt.channels_out==2&&(p[1][Jt.mf_size+Gt]=ft[1][yt+Gt])}}}return Ne=D,Ne}var Hs=Ht,Yi=Hs.VbrMode;function Is(){var t=nn();function e(h,d,F,q,L,I,E,D,g,w,k,i,u,Y,M){this.vbr_q=h,this.quant_comp=d,this.quant_comp_s=F,this.expY=q,this.st_lrm=L,this.st_s=I,this.masking_adj=E,this.masking_adj_short=D,this.ath_lower=g,this.ath_curve=w,this.ath_sensitivity=k,this.interch=i,this.safejoint=u,this.sfb21mod=Y,this.msfix=M}function n(h,d,F,q,L,I,E,D,g,w,k,i,u,Y){this.quant_comp=d,this.quant_comp_s=F,this.safejoint=q,this.nsmsfix=L,this.st_lrm=I,this.st_s=E,this.nsbass=D,this.scale=g,this.masking_adj=w,this.ath_lower=k,this.ath_curve=i,this.interch=u,this.sfscale=Y}var C;this.setModules=function(h){C=h};var b=[new e(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,0.97),new e(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new e(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new e(4,9,9,1,6,135,-0.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new e(5,9,9,1,6.4,140,0.5,0.4,-7.5,4,-12,0.0002,0,0,1.95),new e(6,9,9,1,6.6,145,0.67,0.65,-14.7,6.5,-19,0.0004,0,0,2.3),new e(7,9,9,1,6.6,145,0.8,0.75,-19.7,8,-22,0.0006,0,0,2.7),new e(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,0.0007,0,0,0),new e(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,0.0008,0,0,0),new e(10,9,9,1,6.6,145,2,2,-36,12,-25,0.0008,0,0,0)],y=[new e(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,0.97),new e(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new e(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new e(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new e(4,9,9,1,4.2,25,-2.2,0.1,0,3.5,-8,0,2,0,1.79),new e(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,0.0002,0,0,1.95),new e(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,0.0004,0,0,2),new e(7,9,9,1,4.2,25,0.5,2,-14.5,8,-22,0.0006,0,0,2),new e(8,9,9,1,4.2,25,1,2.4,-22,10,-23,0.0007,0,0,2),new e(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,0.0008,0,0,2),new e(10,9,9,1,4.2,25,2,2.95,-36,12,-30,0.0008,0,0,2)];function j(h,d,F){var q=h.VBR==Yi.vbr_rh?b:y,L=h.VBR_q_frac,I=q[d],E=q[d+1],D=I;I.st_lrm=I.st_lrm+L*(E.st_lrm-I.st_lrm),I.st_s=I.st_s+L*(E.st_s-I.st_s),I.masking_adj=I.masking_adj+L*(E.masking_adj-I.masking_adj),I.masking_adj_short=I.masking_adj_short+L*(E.masking_adj_short-I.masking_adj_short),I.ath_lower=I.ath_lower+L*(E.ath_lower-I.ath_lower),I.ath_curve=I.ath_curve+L*(E.ath_curve-I.ath_curve),I.ath_sensitivity=I.ath_sensitivity+L*(E.ath_sensitivity-I.ath_sensitivity),I.interch=I.interch+L*(E.interch-I.interch),I.msfix=I.msfix+L*(E.msfix-I.msfix),B(h,D.vbr_q),F!=0?h.quant_comp=D.quant_comp:Math.abs(h.quant_comp- -1)>0||(h.quant_comp=D.quant_comp),F!=0?h.quant_comp_short=D.quant_comp_s:Math.abs(h.quant_comp_short- -1)>0||(h.quant_comp_short=D.quant_comp_s),D.expY!=0&&(h.experimentalY=D.expY!=0),F!=0?h.internal_flags.nsPsy.attackthre=D.st_lrm:Math.abs(h.internal_flags.nsPsy.attackthre- -1)>0||(h.internal_flags.nsPsy.attackthre=D.st_lrm),F!=0?h.internal_flags.nsPsy.attackthre_s=D.st_s:Math.abs(h.internal_flags.nsPsy.attackthre_s- -1)>0||(h.internal_flags.nsPsy.attackthre_s=D.st_s),F!=0?h.maskingadjust=D.masking_adj:Math.abs(h.maskingadjust-0)>0||(h.maskingadjust=D.masking_adj),F!=0?h.maskingadjust_short=D.masking_adj_short:Math.abs(h.maskingadjust_short-0)>0||(h.maskingadjust_short=D.masking_adj_short),F!=0?h.ATHlower=-D.ath_lower/10:Math.abs(-h.ATHlower*10-0)>0||(h.ATHlower=-D.ath_lower/10),F!=0?h.ATHcurve=D.ath_curve:Math.abs(h.ATHcurve- -1)>0||(h.ATHcurve=D.ath_curve),F!=0?h.athaa_sensitivity=D.ath_sensitivity:Math.abs(h.athaa_sensitivity- -1)>0||(h.athaa_sensitivity=D.ath_sensitivity),D.interch>0&&(F!=0?h.interChRatio=D.interch:Math.abs(h.interChRatio- -1)>0||(h.interChRatio=D.interch)),D.safejoint>0&&(h.exp_nspsytune=h.exp_nspsytune|D.safejoint),D.sfb21mod>0&&(h.exp_nspsytune=h.exp_nspsytune|D.sfb21mod<<20),F!=0?h.msfix=D.msfix:Math.abs(h.msfix- -1)>0||(h.msfix=D.msfix),F==0&&(h.VBR_q=d,h.VBR_q_frac=L)}var z=[new n(8,9,9,0,0,6.6,145,0,0.95,0,-30,11,0.0012,1),new n(16,9,9,0,0,6.6,145,0,0.95,0,-25,11,0.001,1),new n(24,9,9,0,0,6.6,145,0,0.95,0,-20,11,0.001,1),new n(32,9,9,0,0,6.6,145,0,0.95,0,-15,11,0.001,1),new n(40,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new n(48,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new n(56,9,9,0,0,6.6,145,0,0.95,0,-6,11,0.0008,1),new n(64,9,9,0,0,6.6,145,0,0.95,0,-2,11,0.0008,1),new n(80,9,9,0,0,6.6,145,0,0.95,0,0,8,0.0007,1),new n(96,9,9,0,2.5,6.6,145,0,0.95,0,1,5.5,0.0006,1),new n(112,9,9,0,2.25,6.6,145,0,0.95,0,2,4.5,0.0005,1),new n(128,9,9,0,1.95,6.4,140,0,0.95,0,3,4,0.0002,1),new n(160,9,9,1,1.79,6,135,0,0.95,-2,5,3.5,0,1),new n(192,9,9,1,1.49,5.6,125,0,0.97,-4,7,3,0,0),new n(224,9,9,1,1.25,5.2,125,0,0.98,-6,9,2,0,0),new n(256,9,9,1,0.97,5.2,125,0,1,-8,10,1,0,0),new n(320,9,9,1,0.9,5.2,125,0,1,-10,12,0,0,0)];function Z(h,d,F){var q=d,L=C.nearestBitrateFullIndex(d);if(h.VBR=Yi.vbr_abr,h.VBR_mean_bitrate_kbps=q,h.VBR_mean_bitrate_kbps=Math.min(h.VBR_mean_bitrate_kbps,320),h.VBR_mean_bitrate_kbps=Math.max(h.VBR_mean_bitrate_kbps,8),h.brate=h.VBR_mean_bitrate_kbps,h.VBR_mean_bitrate_kbps>320&&(h.disable_reservoir=!0),z[L].safejoint>0&&(h.exp_nspsytune=h.exp_nspsytune|2),z[L].sfscale>0&&(h.internal_flags.noise_shaping=2),Math.abs(z[L].nsbass)>0){var I=int(z[L].nsbass*4);I<0&&(I+=64),h.exp_nspsytune=h.exp_nspsytune|I<<2}return F!=0?h.quant_comp=z[L].quant_comp:Math.abs(h.quant_comp- -1)>0||(h.quant_comp=z[L].quant_comp),F!=0?h.quant_comp_short=z[L].quant_comp_s:Math.abs(h.quant_comp_short- -1)>0||(h.quant_comp_short=z[L].quant_comp_s),F!=0?h.msfix=z[L].nsmsfix:Math.abs(h.msfix- -1)>0||(h.msfix=z[L].nsmsfix),F!=0?h.internal_flags.nsPsy.attackthre=z[L].st_lrm:Math.abs(h.internal_flags.nsPsy.attackthre- -1)>0||(h.internal_flags.nsPsy.attackthre=z[L].st_lrm),F!=0?h.internal_flags.nsPsy.attackthre_s=z[L].st_s:Math.abs(h.internal_flags.nsPsy.attackthre_s- -1)>0||(h.internal_flags.nsPsy.attackthre_s=z[L].st_s),F!=0?h.scale=z[L].scale:Math.abs(h.scale- -1)>0||(h.scale=z[L].scale),F!=0?h.maskingadjust=z[L].masking_adj:Math.abs(h.maskingadjust-0)>0||(h.maskingadjust=z[L].masking_adj),z[L].masking_adj>0?F!=0?h.maskingadjust_short=z[L].masking_adj*0.9:Math.abs(h.maskingadjust_short-0)>0||(h.maskingadjust_short=z[L].masking_adj*0.9):F!=0?h.maskingadjust_short=z[L].masking_adj*1.1:Math.abs(h.maskingadjust_short-0)>0||(h.maskingadjust_short=z[L].masking_adj*1.1),F!=0?h.ATHlower=-z[L].ath_lower/10:Math.abs(-h.ATHlower*10-0)>0||(h.ATHlower=-z[L].ath_lower/10),F!=0?h.ATHcurve=z[L].ath_curve:Math.abs(h.ATHcurve- -1)>0||(h.ATHcurve=z[L].ath_curve),F!=0?h.interChRatio=z[L].interch:Math.abs(h.interChRatio- -1)>0||(h.interChRatio=z[L].interch),d}this.apply_preset=function(h,d,F){switch(d){case t.R3MIX:{d=t.V3,h.VBR=Yi.vbr_mtrh;break}case t.MEDIUM:{d=t.V4,h.VBR=Yi.vbr_rh;break}case t.MEDIUM_FAST:{d=t.V4,h.VBR=Yi.vbr_mtrh;break}case t.STANDARD:{d=t.V2,h.VBR=Yi.vbr_rh;break}case t.STANDARD_FAST:{d=t.V2,h.VBR=Yi.vbr_mtrh;break}case t.EXTREME:{d=t.V0,h.VBR=Yi.vbr_rh;break}case t.EXTREME_FAST:{d=t.V0,h.VBR=Yi.vbr_mtrh;break}case t.INSANE:return d=320,h.preset=d,Z(h,d,F),h.VBR=Yi.vbr_off,d}switch(h.preset=d,d){case t.V9:return j(h,9,F),d;case t.V8:return j(h,8,F),d;case t.V7:return j(h,7,F),d;case t.V6:return j(h,6,F),d;case t.V5:return j(h,5,F),d;case t.V4:return j(h,4,F),d;case t.V3:return j(h,3,F),d;case t.V2:return j(h,2,F),d;case t.V1:return j(h,1,F),d;case t.V0:return j(h,0,F),d}return 8<=d&&d<=320?Z(h,d,F):(h.preset=0,d)};function B(h,d){var F=0;return 0>d&&(F=-1,d=0),9<d&&(F=-1,d=9),h.VBR_q=d,h.VBR_q_frac=0,F}}var _s=Is;function Bs(){this.setModules=function(t,e){}}var Rs=Bs;function As(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var to=As,fr=Ht,qn=fr.new_float,io=fr.new_int;function eo(){this.global_gain=0,this.sfb_count1=0,this.step=io(39),this.noise=qn(39),this.noise_log=qn(39)}var no=eo,Ri=Ht,$i=Ri.System,Sn=Ri.VbrMode,He=Ri.Util,_i=Ri.Arrays,ae=Ri.new_float,de=Ri.assert,ro=Rs,Ie=to,so=no,Kt=si(),Tn=Be,En=De;function oo(){var t;this.rv=null;var e;this.qupvt=null;var n,C=new ro,b;this.setModules=function(D,g,w,k){t=D,e=g,this.rv=g,n=w,this.qupvt=w,b=k,C.setModules(n,b)},this.ms_convert=function(D,g){for(var w=0;w<576;++w){var k=D.tt[g][0].xr[w],i=D.tt[g][1].xr[w];D.tt[g][0].xr[w]=(k+i)*(He.SQRT2*0.5),D.tt[g][1].xr[w]=(k-i)*(He.SQRT2*0.5)}};function y(D,g,w,k){k=0;for(var i=0;i<=w;++i){var u=Math.abs(D.xr[i]);k+=u,g[i]=Math.sqrt(u*Math.sqrt(u)),g[i]>D.xrpow_max&&(D.xrpow_max=g[i])}return k}this.init_xrpow=function(D,g,w){var k=0,i=0|g.max_nonzero_coeff;if(g.xrpow_max=0,_i.fill(w,i,576,0),k=y(g,w,i,k),k>0.00000000000000000001){var u=0;D.substep_shaping&2&&(u=1);for(var Y=0;Y<g.psymax;Y++)D.pseudohalf[Y]=u;return!0}return _i.fill(g.l3_enc,0,576,0),!1};function j(D,g){var w=D.ATH,k=g.xr;if(g.block_type!=Kt.SHORT_TYPE)for(var i=!1,u=Kt.PSFB21-1;u>=0&&!i;u--){var Y=D.scalefac_band.psfb21[u],M=D.scalefac_band.psfb21[u+1],S=n.athAdjust(w.adjust,w.psfb21[u],w.floor);D.nsPsy.longfact[21]>0.000000000001&&(S*=D.nsPsy.longfact[21]);for(var $=M-1;$>=Y;$--)if(Math.abs(k[$])<S)k[$]=0;else{i=!0;break}}else for(var x=0;x<3;x++)for(var i=!1,u=Kt.PSFB12-1;u>=0&&!i;u--){var Y=D.scalefac_band.s[12]*3+(D.scalefac_band.s[13]-D.scalefac_band.s[12])*x+(D.scalefac_band.psfb12[u]-D.scalefac_band.psfb12[0]),M=Y+(D.scalefac_band.psfb12[u+1]-D.scalefac_band.psfb12[u]),dt=n.athAdjust(w.adjust,w.psfb12[u],w.floor);D.nsPsy.shortfact[12]>0.000000000001&&(dt*=D.nsPsy.shortfact[12]);for(var $=M-1;$>=Y;$--)if(Math.abs(k[$])<dt)k[$]=0;else{i=!0;break}}}this.init_outer_loop=function(D,g){g.part2_3_length=0,g.big_values=0,g.count1=0,g.global_gain=210,g.scalefac_compress=0,g.table_select[0]=0,g.table_select[1]=0,g.table_select[2]=0,g.subblock_gain[0]=0,g.subblock_gain[1]=0,g.subblock_gain[2]=0,g.subblock_gain[3]=0,g.region0_count=0,g.region1_count=0,g.preflag=0,g.scalefac_scale=0,g.count1table_select=0,g.part2_length=0,g.sfb_lmax=Kt.SBPSY_l,g.sfb_smin=Kt.SBPSY_s,g.psy_lmax=D.sfb21_extra?Kt.SBMAX_l:Kt.SBPSY_l,g.psymax=g.psy_lmax,g.sfbmax=g.sfb_lmax,g.sfbdivide=11;for(var w=0;w<Kt.SBMAX_l;w++)g.width[w]=D.scalefac_band.l[w+1]-D.scalefac_band.l[w],g.window[w]=3;if(g.block_type==Kt.SHORT_TYPE){var k=ae(576);g.sfb_smin=0,g.sfb_lmax=0,g.mixed_block_flag!=0&&(g.sfb_smin=3,g.sfb_lmax=D.mode_gr*2+4),g.psymax=g.sfb_lmax+3*((D.sfb21_extra?Kt.SBMAX_s:Kt.SBPSY_s)-g.sfb_smin),g.sfbmax=g.sfb_lmax+3*(Kt.SBPSY_s-g.sfb_smin),g.sfbdivide=g.sfbmax-18,g.psy_lmax=g.sfb_lmax;var i=D.scalefac_band.l[g.sfb_lmax];$i.arraycopy(g.xr,0,k,0,576);for(var w=g.sfb_smin;w<Kt.SBMAX_s;w++)for(var u=D.scalefac_band.s[w],Y=D.scalefac_band.s[w+1],M=0;M<3;M++)for(var S=u;S<Y;S++)g.xr[i++]=k[3*S+M];for(var{sfb_lmax:$,sfb_smin:w}=g;w<Kt.SBMAX_s;w++)g.width[$]=g.width[$+1]=g.width[$+2]=D.scalefac_band.s[w+1]-D.scalefac_band.s[w],g.window[$]=0,g.window[$+1]=1,g.window[$+2]=2,$+=3}g.count1bits=0,g.sfb_partition_table=n.nr_of_sfb_block[0][0],g.slen[0]=0,g.slen[1]=0,g.slen[2]=0,g.slen[3]=0,g.max_nonzero_coeff=575,_i.fill(g.scalefac,0),j(D,g)};function z(D){this.ordinal=D}z.BINSEARCH_NONE=new z(0),z.BINSEARCH_UP=new z(1),z.BINSEARCH_DOWN=new z(2);function Z(D,g,w,k,i){var u,Y=D.CurrentStep[k],M=!1,S=D.OldValue[k],$=z.BINSEARCH_NONE;for(g.global_gain=S,w-=g.part2_length;;){var x;if(u=b.count_bits(D,i,g,null),Y==1||u==w)break;u>w?($==z.BINSEARCH_DOWN&&(M=!0),M&&(Y/=2),$=z.BINSEARCH_UP,x=Y):($==z.BINSEARCH_UP&&(M=!0),M&&(Y/=2),$=z.BINSEARCH_DOWN,x=-Y),g.global_gain+=x,g.global_gain<0&&(g.global_gain=0,M=!0),g.global_gain>255&&(g.global_gain=255,M=!0)}for(de(g.global_gain>=0),de(g.global_gain<256);u>w&&g.global_gain<255;)g.global_gain++,u=b.count_bits(D,i,g,null);return D.CurrentStep[k]=S-g.global_gain>=4?4:2,D.OldValue[k]=g.global_gain,g.part2_3_length=u,u}this.trancate_smallspectrums=function(D,g,w,k){var i=ae(En.SFBMAX);if(!(!(D.substep_shaping&4)&&g.block_type==Kt.SHORT_TYPE||D.substep_shaping&128)){n.calc_noise(g,w,i,new Ie,null);for(var Y=0;Y<576;Y++){var u=0;g.l3_enc[Y]!=0&&(u=Math.abs(g.xr[Y])),k[Y]=u}var Y=0,M=8;g.block_type==Kt.SHORT_TYPE&&(M=6);do{var S,$,x,dt,P=g.width[M];if(Y+=P,!(i[M]>=1)&&(_i.sort(k,Y-P,P),!BitStream.EQ(k[Y-1],0))){S=(1-i[M])*w[M],$=0,dt=0;do{var r;for(x=1;dt+x<P&&!BitStream.NEQ(k[dt+Y-P],k[dt+Y+x-P]);x++);if(r=k[dt+Y-P]*k[dt+Y-P]*x,S<r){dt!=0&&($=k[dt+Y-P-1]);break}S-=r,dt+=x}while(dt<P);if(!BitStream.EQ($,0))do Math.abs(g.xr[Y-P])<=$&&(g.l3_enc[Y-P]=0);while(--P>0)}}while(++M<g.psymax);g.part2_3_length=b.noquant_count_bits(D,g,null)}};function B(D){for(var g=0;g<D.sfbmax;g++)if(D.scalefac[g]+D.subblock_gain[D.window[g]]==0)return!1;return!0}function h(D){return He.FAST_LOG10(0.368+0.632*D*D*D)}function d(D,g){for(var w=0.0000000000000000000000000000000000001,k=0;k<g.psymax;k++)w+=h(D[k]);return Math.max(0.00000000000000000001,w)}function F(D,g,w,k,i){var u;switch(D){default:case 9:{g.over_count>0?(u=w.over_SSD<=g.over_SSD,w.over_SSD==g.over_SSD&&(u=w.bits<g.bits)):u=w.max_noise<0&&w.max_noise*10+w.bits<=g.max_noise*10+g.bits;break}case 0:u=w.over_count<g.over_count||w.over_count==g.over_count&&w.over_noise<g.over_noise||w.over_count==g.over_count&&BitStream.EQ(w.over_noise,g.over_noise)&&w.tot_noise<g.tot_noise;break;case 8:w.max_noise=d(i,k);case 1:u=w.max_noise<g.max_noise;break;case 2:u=w.tot_noise<g.tot_noise;break;case 3:u=w.tot_noise<g.tot_noise&&w.max_noise<g.max_noise;break;case 4:u=w.max_noise<=0&&g.max_noise>0.2||w.max_noise<=0&&g.max_noise<0&&g.max_noise>w.max_noise-0.2&&w.tot_noise<g.tot_noise||w.max_noise<=0&&g.max_noise>0&&g.max_noise>w.max_noise-0.2&&w.tot_noise<g.tot_noise+g.over_noise||w.max_noise>0&&g.max_noise>-0.05&&g.max_noise>w.max_noise-0.1&&w.tot_noise+w.over_noise<g.tot_noise+g.over_noise||w.max_noise>0&&g.max_noise>-0.1&&g.max_noise>w.max_noise-0.15&&w.tot_noise+w.over_noise+w.over_noise<g.tot_noise+g.over_noise+g.over_noise;break;case 5:u=w.over_noise<g.over_noise||BitStream.EQ(w.over_noise,g.over_noise)&&w.tot_noise<g.tot_noise;break;case 6:u=w.over_noise<g.over_noise||BitStream.EQ(w.over_noise,g.over_noise)&&(w.max_noise<g.max_noise||BitStream.EQ(w.max_noise,g.max_noise)&&w.tot_noise<=g.tot_noise);break;case 7:u=w.over_count<g.over_count||w.over_noise<g.over_noise;break}return g.over_count==0&&(u=u&&w.bits<g.bits),u}function q(D,g,w,k,i){var u=D.internal_flags,Y;g.scalefac_scale==0?Y=1.2968395546510096:Y=1.6817928305074292;for(var M=0,S=0;S<g.sfbmax;S++)M<w[S]&&(M=w[S]);var $=u.noise_shaping_amp;switch($==3&&(i?$=2:$=1),$){case 2:break;case 1:M>1?M=Math.pow(M,0.5):M*=0.95;break;case 0:default:M>1?M=1:M*=0.95;break}for(var x=0,S=0;S<g.sfbmax;S++){var dt=g.width[S],P;if(x+=dt,!(w[S]<M)){if(u.substep_shaping&2&&(u.pseudohalf[S]=u.pseudohalf[S]==0?1:0,u.pseudohalf[S]==0&&u.noise_shaping_amp==2))return;for(g.scalefac[S]++,P=-dt;P<0;P++)k[x+P]*=Y,k[x+P]>g.xrpow_max&&(g.xrpow_max=k[x+P]);if(u.noise_shaping_amp==2)return}}}function L(D,g){for(var w=1.2968395546510096,k=0,i=0;i<D.sfbmax;i++){var u=D.width[i],Y=D.scalefac[i];if(D.preflag!=0&&(Y+=n.pretab[i]),k+=u,Y&1){Y++;for(var M=-u;M<0;M++)g[k+M]*=w,g[k+M]>D.xrpow_max&&(D.xrpow_max=g[k+M])}D.scalefac[i]=Y>>1}D.preflag=0,D.scalefac_scale=1}function I(D,g,w){var k,i=g.scalefac;for(k=0;k<g.sfb_lmax;k++)if(i[k]>=16)return!0;for(var u=0;u<3;u++){var Y=0,M=0;for(k=g.sfb_lmax+u;k<g.sfbdivide;k+=3)Y<i[k]&&(Y=i[k]);for(;k<g.sfbmax;k+=3)M<i[k]&&(M=i[k]);if(!(Y<16&&M<8)){if(g.subblock_gain[u]>=7)return!0;g.subblock_gain[u]++;var S=D.scalefac_band.l[g.sfb_lmax];for(k=g.sfb_lmax+u;k<g.sfbmax;k+=3){var $,x=g.width[k],dt=i[k];if(dt=dt-(4>>g.scalefac_scale),dt>=0){i[k]=dt,S+=x*3;continue}i[k]=0;{var P=210+(dt<<g.scalefac_scale+1);$=n.IPOW20(P)}S+=x*(u+1);for(var r=-x;r<0;r++)w[S+r]*=$,w[S+r]>g.xrpow_max&&(g.xrpow_max=w[S+r]);S+=x*(3-u-1)}{var $=n.IPOW20(202);S+=g.width[k]*(u+1);for(var r=-g.width[k];r<0;r++)w[S+r]*=$,w[S+r]>g.xrpow_max&&(g.xrpow_max=w[S+r])}}}return!1}function E(D,g,w,k,i){var u=D.internal_flags;q(D,g,w,k,i);var Y=B(g);return Y?!1:(u.mode_gr==2?Y=b.scale_bitcount(g):Y=b.scale_bitcount_lsf(u,g),Y?(u.noise_shaping>1&&(_i.fill(u.pseudohalf,0),g.scalefac_scale==0?(L(g,k),Y=!1):g.block_type==Kt.SHORT_TYPE&&u.subblock_gain>0&&(Y=I(u,g,k)||B(g))),Y||(u.mode_gr==2?Y=b.scale_bitcount(g):Y=b.scale_bitcount_lsf(u,g)),!Y):!0)}this.outer_loop=function(D,g,w,k,i,u){var Y=D.internal_flags,M=new Tn,S=ae(576),$=ae(En.SFBMAX),x=new Ie,dt,P=new so,r=9999999,J=!1,O=!1,T=0;if(Z(Y,g,u,i,k),Y.noise_shaping==0)return 100;n.calc_noise(g,w,$,x,P),x.bits=g.part2_3_length,M.assign(g);var K=0;for($i.arraycopy(k,0,S,0,576);!J;){do{var tt=new Ie,Q,l=255;if(Y.substep_shaping&2?Q=20:Q=3,Y.sfb21_extra&&($[M.sfbmax]>1||M.block_type==Kt.SHORT_TYPE&&($[M.sfbmax+1]>1||$[M.sfbmax+2]>1))||!E(D,M,$,k,O))break;M.scalefac_scale!=0&&(l=254);var a=u-M.part2_length;if(a<=0)break;for(;(M.part2_3_length=b.count_bits(Y,k,M,P))>a&&M.global_gain<=l;)M.global_gain++;if(M.global_gain>l)break;if(x.over_count==0){for(;(M.part2_3_length=b.count_bits(Y,k,M,P))>r&&M.global_gain<=l;)M.global_gain++;if(M.global_gain>l)break}if(n.calc_noise(M,w,$,tt,P),tt.bits=M.part2_3_length,g.block_type!=Kt.SHORT_TYPE?dt=D.quant_comp:dt=D.quant_comp_short,dt=F(dt,x,tt,M,$)?1:0,dt!=0)r=g.part2_3_length,x=tt,g.assign(M),K=0,$i.arraycopy(k,0,S,0,576);else if(Y.full_outer_loop==0&&(++K>Q&&x.over_count==0||Y.noise_shaping_amp==3&&O&&K>30||Y.noise_shaping_amp==3&&O&&M.global_gain-T>15))break}while(M.global_gain+M.scalefac_scale<255);Y.noise_shaping_amp==3?O?J=!0:(M.assign(g),$i.arraycopy(S,0,k,0,576),K=0,T=M.global_gain,O=!0):J=!0}return de(g.global_gain+g.scalefac_scale<=255),D.VBR==Sn.vbr_rh||D.VBR==Sn.vbr_mtrh?$i.arraycopy(S,0,k,0,576):Y.substep_shaping&1&&trancate_smallspectrums(Y,g,w,k),x.over_count},this.iteration_finish_one=function(D,g,w){var k=D.l3_side,i=k.tt[g][w];b.best_scalefac_store(D,g,w,k),D.use_best_huffman==1&&b.best_huffman_divide(D,i),e.ResvAdjust(D,i)},this.VBR_encode_granule=function(D,g,w,k,i,u,Y){var M=D.internal_flags,S=new Tn,$=ae(576),x=Y,dt=Y+1,P=(Y+u)/2,r,J,O=0,T=M.sfb21_extra;de(x<=LameInternalFlags.MAX_BITS_PER_CHANNEL),_i.fill(S.l3_enc,0);do P>x-42?M.sfb21_extra=!1:M.sfb21_extra=T,J=outer_loop(D,g,w,k,i,P),J<=0?(O=1,dt=g.part2_3_length,S.assign(g),$i.arraycopy(k,0,$,0,576),Y=dt-32,r=Y-u,P=(Y+u)/2):(u=P+32,r=Y-u,P=(Y+u)/2,O!=0&&(O=2,g.assign(S),$i.arraycopy($,0,k,0,576)));while(r>12);M.sfb21_extra=T,O==2&&$i.arraycopy(S.l3_enc,0,g.l3_enc,0,576),de(g.part2_3_length<=x)},this.get_framebits=function(D,g){var w=D.internal_flags;w.bitrate_index=w.VBR_min_bitrate;var k=t.getframebits(D);w.bitrate_index=1,k=t.getframebits(D);for(var i=1;i<=w.VBR_max_bitrate;i++){w.bitrate_index=i;var u=new MeanBits(k);g[i]=e.ResvFrameBegin(D,u),k=u.bits}},this.VBR_old_prepare=function(D,g,w,k,i,u,Y,M,S){var $=D.internal_flags,x,dt=0,P=1,r=0;$.bitrate_index=$.VBR_max_bitrate;var J=e.ResvFrameBegin(D,new MeanBits(0))/$.mode_gr;get_framebits(D,u);for(var O=0;O<$.mode_gr;O++){var T=n.on_pe(D,g,M[O],J,O,0);$.mode_ext==Kt.MPG_MD_MS_LR&&(ms_convert($.l3_side,O),n.reduce_side(M[O],w[O],J,T));for(var K=0;K<$.channels_out;++K){var tt=$.l3_side.tt[O][K];tt.block_type!=Kt.SHORT_TYPE?(dt=1.28/(1+Math.exp(3.5-g[O][K]/300))-0.05,x=$.PSY.mask_adjust-dt):(dt=2.56/(1+Math.exp(3.5-g[O][K]/300))-0.14,x=$.PSY.mask_adjust_short-dt),$.masking_lower=Math.pow(10,x*0.1),init_outer_loop($,tt),S[O][K]=n.calc_xmin(D,k[O][K],tt,i[O][K]),S[O][K]!=0&&(P=0),Y[O][K]=126,r+=M[O][K]}}for(var O=0;O<$.mode_gr;O++)for(var K=0;K<$.channels_out;K++)r>u[$.VBR_max_bitrate]&&(M[O][K]*=u[$.VBR_max_bitrate],M[O][K]/=r),Y[O][K]>M[O][K]&&(Y[O][K]=M[O][K]);return P},this.bitpressure_strategy=function(D,g,w,k){for(var i=0;i<D.mode_gr;i++)for(var u=0;u<D.channels_out;u++){for(var Y=D.l3_side.tt[i][u],M=g[i][u],S=0,$=0;$<Y.psy_lmax;$++)M[S++]*=1+0.029*$*$/Kt.SBMAX_l/Kt.SBMAX_l;if(Y.block_type==Kt.SHORT_TYPE)for(var $=Y.sfb_smin;$<Kt.SBMAX_s;$++)M[S++]*=1+0.029*$*$/Kt.SBMAX_s/Kt.SBMAX_s,M[S++]*=1+0.029*$*$/Kt.SBMAX_s/Kt.SBMAX_s,M[S++]*=1+0.029*$*$/Kt.SBMAX_s/Kt.SBMAX_s;k[i][u]=0|Math.max(w[i][u],0.9*k[i][u])}},this.VBR_new_prepare=function(D,g,w,k,i,u){var Y=D.internal_flags,M=1,S=0,$=0,x;if(D.free_format){Y.bitrate_index=0;var dt=new MeanBits(S);x=e.ResvFrameBegin(D,dt),S=dt.bits,i[0]=x}else{Y.bitrate_index=Y.VBR_max_bitrate;var dt=new MeanBits(S);e.ResvFrameBegin(D,dt),S=dt.bits,get_framebits(D,i),x=i[Y.VBR_max_bitrate]}for(var P=0;P<Y.mode_gr;P++){n.on_pe(D,g,u[P],S,P,0),Y.mode_ext==Kt.MPG_MD_MS_LR&&ms_convert(Y.l3_side,P);for(var r=0;r<Y.channels_out;++r){var J=Y.l3_side.tt[P][r];Y.masking_lower=Math.pow(10,Y.PSY.mask_adjust*0.1),init_outer_loop(Y,J),n.calc_xmin(D,w[P][r],J,k[P][r])!=0&&(M=0),$+=u[P][r]}}for(var P=0;P<Y.mode_gr;P++)for(var r=0;r<Y.channels_out;r++)$>x&&(u[P][r]*=x,u[P][r]/=$);return M},this.calc_target_bits=function(D,g,w,k,i,u){var Y=D.internal_flags,M=Y.l3_side,S,$,x,dt,P=0;Y.bitrate_index=Y.VBR_max_bitrate;var r=new MeanBits(P);for(u[0]=e.ResvFrameBegin(D,r),P=r.bits,Y.bitrate_index=1,P=t.getframebits(D)-Y.sideinfo_len*8,i[0]=P/(Y.mode_gr*Y.channels_out),P=D.VBR_mean_bitrate_kbps*D.framesize*1000,Y.substep_shaping&1&&(P*=1.09),P/=D.out_samplerate,P-=Y.sideinfo_len*8,P/=Y.mode_gr*Y.channels_out,S=0.93+0.07*(11-D.compression_ratio)/5.5,S<0.9&&(S=0.9),S>1&&(S=1),$=0;$<Y.mode_gr;$++){var J=0;for(x=0;x<Y.channels_out;x++){if(k[$][x]=int(S*P),g[$][x]>700){var O=int((g[$][x]-700)/1.4),T=M.tt[$][x];k[$][x]=int(S*P),T.block_type==Kt.SHORT_TYPE&&O<P/2&&(O=P/2),O>P*3/2?O=P*3/2:O<0&&(O=0),k[$][x]+=O}k[$][x]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(k[$][x]=LameInternalFlags.MAX_BITS_PER_CHANNEL),J+=k[$][x]}if(J>LameInternalFlags.MAX_BITS_PER_GRANULE)for(x=0;x<Y.channels_out;++x)k[$][x]*=LameInternalFlags.MAX_BITS_PER_GRANULE,k[$][x]/=J}if(Y.mode_ext==Kt.MPG_MD_MS_LR)for($=0;$<Y.mode_gr;$++)n.reduce_side(k[$],w[$],P*Y.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(dt=0,$=0;$<Y.mode_gr;$++)for(x=0;x<Y.channels_out;x++)k[$][x]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(k[$][x]=LameInternalFlags.MAX_BITS_PER_CHANNEL),dt+=k[$][x];if(dt>u[0])for($=0;$<Y.mode_gr;$++)for(x=0;x<Y.channels_out;x++)k[$][x]*=u[0],k[$][x]/=dt}}var ao=oo,lo=Ht,Vn=lo.assert;function ho(){var t;this.setModules=function(e){t=e},this.ResvFrameBegin=function(e,n){var C=e.internal_flags,b,y=C.l3_side,j=t.getframebits(e);n.bits=(j-C.sideinfo_len*8)/C.mode_gr;var z=2048*C.mode_gr-8;e.brate>320?b=8*int(e.brate*1000/(e.out_samplerate/1152)/8+0.5):(b=11520,e.strict_ISO&&(b=8*int(320000/(e.out_samplerate/1152)/8+0.5))),C.ResvMax=b-j,C.ResvMax>z&&(C.ResvMax=z),(C.ResvMax<0||e.disable_reservoir)&&(C.ResvMax=0);var Z=n.bits*C.mode_gr+Math.min(C.ResvSize,C.ResvMax);return Z>b&&(Z=b),Vn(C.ResvMax%8==0),Vn(C.ResvMax>=0),y.resvDrain_pre=0,C.pinfo!=null&&(C.pinfo.mean_bits=n.bits/2,C.pinfo.resvsize=C.ResvSize),Z},this.ResvMaxBits=function(e,n,C,b){var y=e.internal_flags,j,z=y.ResvSize,Z=y.ResvMax;b!=0&&(z+=n),y.substep_shaping&1&&(Z*=0.9),C.bits=n,z*10>Z*9?(j=z-Z*9/10,C.bits+=j,y.substep_shaping|=128):(j=0,y.substep_shaping&=127,!e.disable_reservoir&&!(y.substep_shaping&1)&&(C.bits-=0.1*n));var B=z<y.ResvMax*6/10?z:y.ResvMax*6/10;return B-=j,B<0&&(B=0),B},this.ResvAdjust=function(e,n){e.ResvSize-=n.part2_3_length+n.part2_length},this.ResvFrameEnd=function(e,n){var C,b=e.l3_side;e.ResvSize+=n*e.mode_gr;var y=0;b.resvDrain_post=0,b.resvDrain_pre=0,(C=e.ResvSize%8)!=0&&(y+=C),C=e.ResvSize-y-e.ResvMax,C>0&&(y+=C);{var j=Math.min(b.main_data_begin*8,y)/8;b.resvDrain_pre+=8*j,y-=8*j,e.ResvSize-=8*j,b.main_data_begin-=j}b.resvDrain_post+=y,e.ResvSize-=y}}var co=ho;function uo(){var t="http://www.mp3dev.org/",e=3,n=98,C=4,b=0,y=93;this.getLameVersion=function(){return e+"."+n+"."+C},this.getLameShortVersion=function(){return e+"."+n+"."+C},this.getLameVeryShortVersion=function(){return"LAME"+e+"."+n+"r"},this.getPsyVersion=function(){return b+"."+y},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var po=uo,Ai=Ht,go=Ai.System,_e=Ai.VbrMode,Nn=Ai.ShortBlock,mo=Ai.Arrays,Pe=Ai.new_byte,wo=Ai.assert;le.NUMTOCENTRIES=100;le.MAXFRAMESIZE=2880;function le(){var t,e,n;this.setModules=function(P,r,J){t=P,e=r,n=J};var C=1,b=2,y=4,j=8,z=le.NUMTOCENTRIES,Z=le.MAXFRAMESIZE,B=z+4+4+4+4+4,h=B+9+1+1+8+1+1+3+1+1+2+4+2+2,d=128,F=64,q=32,L=null,I="Xing",E="Info",D=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8000,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16000,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32000,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function g(P,r){if(P.nVbrNumFrames++,P.sum+=r,P.seen++,!(P.seen<P.want)&&(P.pos<P.size&&(P.bag[P.pos]=P.sum,P.pos++,P.seen=0),P.pos==P.size)){for(var J=1;J<P.size;J+=2)P.bag[J/2]=P.bag[J];P.want*=2,P.pos/=2}}function w(P,r){if(!(P.pos<=0))for(var J=1;J<z;++J){var O=J/z,T,K,tt=0|Math.floor(O*P.pos);tt>P.pos-1&&(tt=P.pos-1),T=P.bag[tt],K=P.sum;var Q=0|256*T/K;Q>255&&(Q=255),r[J]=255&Q}}this.addVbrFrame=function(P){var r=P.internal_flags,J=Tables.bitrate_table[P.version][r.bitrate_index];wo(r.VBR_seek_table.bag!=null),g(r.VBR_seek_table,J)};function k(P,r){var J=P[r+0]&255;return J<<=8,J|=P[r+1]&255,J<<=8,J|=P[r+2]&255,J<<=8,J|=P[r+3]&255,J}function i(P,r,J){P[r+0]=255&(J>>24&255),P[r+1]=255&(J>>16&255),P[r+2]=255&(J>>8&255),P[r+3]=255&(J&255)}function u(P,r,J){P[r+0]=255&(J>>8&255),P[r+1]=255&(J&255)}function Y(P,r){return new String(P,r,I.length(),L).equals(I)||new String(P,r,E.length(),L).equals(E)}function M(P,r,J){return 255&(P<<r|J&~(-1<<r))}function S(P,r){var J=P.internal_flags;r[0]=M(r[0],8,255),r[1]=M(r[1],3,7),r[1]=M(r[1],1,P.out_samplerate<16000?0:1),r[1]=M(r[1],1,P.version),r[1]=M(r[1],2,1),r[1]=M(r[1],1,P.error_protection?0:1),r[2]=M(r[2],4,J.bitrate_index),r[2]=M(r[2],2,J.samplerate_index),r[2]=M(r[2],1,0),r[2]=M(r[2],1,P.extension),r[3]=M(r[3],2,P.mode.ordinal()),r[3]=M(r[3],2,J.mode_ext),r[3]=M(r[3],1,P.copyright),r[3]=M(r[3],1,P.original),r[3]=M(r[3],2,P.emphasis),r[0]=255;var O=255&(r[1]&241),T;P.version==1?T=d:P.out_samplerate<16000?T=q:T=F,P.VBR==_e.vbr_off&&(T=P.brate);var K;P.free_format?K=0:K=255&16*t.BitrateIndex(T,P.version,P.out_samplerate),P.version==1?(r[1]=255&(O|10),O=255&(r[2]&13),r[2]=255&(K|O)):(r[1]=255&(O|2),O=255&(r[2]&13),r[2]=255&(K|O))}this.getVbrTag=function(P){var r=new VBRTagData,J=0;r.flags=0;var O=P[J+1]>>3&1,T=P[J+2]>>2&3,K=P[J+3]>>6&3,tt=P[J+2]>>4&15;if(tt=Tables.bitrate_table[O][tt],P[J+1]>>4==14?r.samprate=Tables.samplerate_table[2][T]:r.samprate=Tables.samplerate_table[O][T],O!=0?K!=3?J+=36:J+=21:K!=3?J+=21:J+=13,!Y(P,J))return null;J+=4,r.hId=O;var Q=r.flags=k(P,J);if(J+=4,Q&C&&(r.frames=k(P,J),J+=4),Q&b&&(r.bytes=k(P,J),J+=4),Q&y){if(r.toc!=null)for(var l=0;l<z;l++)r.toc[l]=P[J+l];J+=z}r.vbrScale=-1,Q&j&&(r.vbrScale=k(P,J),J+=4),r.headersize=(O+1)*72000*tt/r.samprate,J+=21;var a=P[J+0]<<4;a+=P[J+1]>>4;var s=(P[J+1]&15)<<8;return s+=P[J+2]&255,(a<0||a>3000)&&(a=-1),(s<0||s>3000)&&(s=-1),r.encDelay=a,r.encPadding=s,r},this.InitVbrTag=function(P){var r=P.internal_flags,J;P.version==1?J=d:P.out_samplerate<16000?J=q:J=F,P.VBR==_e.vbr_off&&(J=P.brate);var O=(P.version+1)*72000*J/P.out_samplerate,T=r.sideinfo_len+h;if(r.VBR_seek_table.TotalFrameSize=O,O<T||O>Z){P.bWriteVbrTag=!1;return}r.VBR_seek_table.nVbrNumFrames=0,r.VBR_seek_table.nBytesWritten=0,r.VBR_seek_table.sum=0,r.VBR_seek_table.seen=0,r.VBR_seek_table.want=1,r.VBR_seek_table.pos=0,r.VBR_seek_table.bag==null&&(r.VBR_seek_table.bag=new int[400],r.VBR_seek_table.size=400);var K=Pe(Z);S(P,K);for(var tt=r.VBR_seek_table.TotalFrameSize,Q=0;Q<tt;++Q)e.add_dummy_byte(P,K[Q]&255,1)};function $(P,r){var J=r^P;return r=r>>8^D[J&255],r}this.updateMusicCRC=function(P,r,J,O){for(var T=0;T<O;++T)P[0]=$(r[J+T],P[0])};function x(P,r,J,O,T){var K=P.internal_flags,tt=0,Q=P.encoder_delay,l=P.encoder_padding,a=100-10*P.VBR_q-P.quality,s=n.getLameVeryShortVersion(),c,W=0,_,nt=[1,5,3,2,4,0,3],X=0|(P.lowpassfreq/100+0.5>255?255:P.lowpassfreq/100+0.5),R=0,at=0,pt=0,Ct=P.internal_flags.noise_shaping,Dt=0,Wt=0,Pt=0,Yt=0,St=0,wi=(P.exp_nspsytune&1)!=0,o=(P.exp_nspsytune&2)!=0,p=!1,ft=!1,yt=P.internal_flags.nogap_total,Ft=P.internal_flags.nogap_current,$t=P.ATHtype,Jt=0,zt;switch(P.VBR){case vbr_abr:zt=P.VBR_mean_bitrate_kbps;break;case vbr_off:zt=P.brate;break;default:zt=P.VBR_min_bitrate_kbps}switch(P.VBR.ordinal()<nt.length?c=nt[P.VBR.ordinal()]:c=0,_=16*W+c,K.findReplayGain&&(K.RadioGain>510&&(K.RadioGain=510),K.RadioGain<-510&&(K.RadioGain=-510),at=8192,at|=3072,K.RadioGain>=0?at|=K.RadioGain:(at|=512,at|=-K.RadioGain)),K.findPeakSample&&(R=Math.abs(0|K.PeakSample/32767*Math.pow(2,23)+0.5)),yt!=-1&&(Ft>0&&(ft=!0),Ft<yt-1&&(p=!0)),Jt=$t+((wi?1:0)<<4)+((o?1:0)<<5)+((p?1:0)<<6)+((ft?1:0)<<7),a<0&&(a=0),P.mode){case MONO:Dt=0;break;case STEREO:Dt=1;break;case DUAL_CHANNEL:Dt=2;break;case JOINT_STEREO:P.force_ms?Dt=4:Dt=3;break;case NOT_SET:default:Dt=7;break}P.in_samplerate<=32000?Pt=0:P.in_samplerate==48000?Pt=2:P.in_samplerate>48000?Pt=3:Pt=1,(P.short_blocks==Nn.short_block_forced||P.short_blocks==Nn.short_block_dispensed||P.lowpassfreq==-1&&P.highpassfreq==-1||P.scale_left<P.scale_right||P.scale_left>P.scale_right||P.disable_reservoir&&P.brate<320||P.noATH||P.ATHonly||$t==0||P.in_samplerate<=32000)&&(Wt=1),Yt=Ct+(Dt<<2)+(Wt<<5)+(Pt<<6),St=K.nMusicCRC,i(J,O+tt,a),tt+=4;for(var xt=0;xt<9;xt++)J[O+tt+xt]=255&s.charAt(xt);tt+=9,J[O+tt]=255&_,tt++,J[O+tt]=255&X,tt++,i(J,O+tt,R),tt+=4,u(J,O+tt,at),tt+=2,u(J,O+tt,pt),tt+=2,J[O+tt]=255&Jt,tt++,zt>=255?J[O+tt]=255:J[O+tt]=255&zt,tt++,J[O+tt]=255&Q>>4,J[O+tt+1]=255&(Q<<4)+(l>>8),J[O+tt+2]=255&l,tt+=3,J[O+tt]=255&Yt,tt++,J[O+tt++]=0,u(J,O+tt,P.preset),tt+=2,i(J,O+tt,r),tt+=4,u(J,O+tt,St),tt+=2;for(var Gt=0;Gt<tt;Gt++)T=$(J[O+Gt],T);return u(J,O+tt,T),tt+=2,tt}function dt(P){P.seek(0);var r=Pe(10);P.readFully(r);var J;return new String(r,"ISO-8859-1").startsWith("ID3")?J=0:J=((r[6]&127)<<21|(r[7]&127)<<14|(r[8]&127)<<7|r[9]&127)+r.length,J}this.getLameTagFrame=function(P,r){var J=P.internal_flags;if(!P.bWriteVbrTag||J.Class_ID!=Lame.LAME_ID||J.VBR_seek_table.pos<=0)return 0;if(r.length<J.VBR_seek_table.TotalFrameSize)return J.VBR_seek_table.TotalFrameSize;mo.fill(r,0,J.VBR_seek_table.TotalFrameSize,0),S(P,r);var O=Pe(z);if(P.free_format)for(var T=1;T<z;++T)O[T]=255&255*T/100;else w(J.VBR_seek_table,O);var K=J.sideinfo_len;P.error_protection&&(K-=2),P.VBR==_e.vbr_off?(r[K++]=255&E.charAt(0),r[K++]=255&E.charAt(1),r[K++]=255&E.charAt(2),r[K++]=255&E.charAt(3)):(r[K++]=255&I.charAt(0),r[K++]=255&I.charAt(1),r[K++]=255&I.charAt(2),r[K++]=255&I.charAt(3)),i(r,K,C+b+y+j),K+=4,i(r,K,J.VBR_seek_table.nVbrNumFrames),K+=4;var tt=J.VBR_seek_table.nBytesWritten+J.VBR_seek_table.TotalFrameSize;i(r,K,0|tt),K+=4,go.arraycopy(O,0,r,K,O.length),K+=O.length,P.error_protection&&e.CRC_writeheader(J,r);for(var Q=0,T=0;T<K;T++)Q=$(r[T],Q);return K+=x(P,tt,r,K,Q),J.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(P,r){var J=P.internal_flags;if(J.VBR_seek_table.pos<=0||(r.seek(r.length()),r.length()==0))return-1;var O=dt(r);r.seek(O);var T=Pe(Z),K=getLameTagFrame(P,T);return K>T.length?-1:(K<1||r.write(T,0,K),0)}}var fo=le,Cr=Ht,Hn=Cr.new_byte,Co=Cr.assert,Po=nn(),Wo=_s,Do=ur,ko=mr(),yo=ao,vo=wr(),zo=co,Jo=ce,Yo=en();si();var Go=po,bo=fo;function jo(){this.setModules=function(t,e){}}function Zo(){this.setModules=function(t,e,n){}}function $o(){}function Fo(){this.setModules=function(t,e){}}function Qo(t,e,n){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,e=44100,n=128);var C=new Po,b=new jo,y=new Do,j=new Yo,z=new Wo,Z=new ko,B=new yo,h=new bo,d=new Go,F=new Fo,q=new zo,L=new vo,I=new Zo,E=new $o;C.setModules(y,j,z,Z,B,h,d,F,E),j.setModules(y,E,d,h),F.setModules(j,d),z.setModules(C),B.setModules(j,q,Z,L),Z.setModules(L,q,C.enc.psy),q.setModules(j),L.setModules(Z),h.setModules(C,j,d),b.setModules(I,E),I.setModules(d,F,z);var D=C.lame_init();D.num_channels=t,D.in_samplerate=e,D.brate=n,D.mode=Jo.STEREO,D.quality=3,D.bWriteVbrTag=!1,D.disable_reservoir=!0,D.write_id3tag_automatic=!1,C.lame_init_params(D);var g=1152,w=0|1.25*g+7200,k=Hn(w);this.encodeBuffer=function(i,u){t==1&&(u=i),Co(i.length==u.length),i.length>g&&(g=i.length,w=0|1.25*g+7200,k=Hn(w));var Y=C.lame_encode_buffer(D,i,u,i.length,k,0,w);return new Int8Array(k.subarray(0,Y))},this.flush=function(){var i=C.lame_encode_flush(D,k,0,w);return new Int8Array(k.subarray(0,i))}}function ki(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function ye(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}ki.RIFF=ye("RIFF");ki.WAVE=ye("WAVE");ki.fmt_=ye("fmt ");ki.data=ye("data");ki.readHeader=function(t){var e=new ki,n=t.getUint32(0,!1);if(ki.RIFF==n&&(t.getUint32(4,!0),ki.WAVE==t.getUint32(8,!1)&&ki.fmt_==t.getUint32(12,!1))){var C=t.getUint32(16,!0),b=20;switch(C){case 16:case 18:e.channels=t.getUint16(b+2,!0),e.sampleRate=t.getUint32(b+4,!0);break;default:throw"extended fmt chunk not implemented"}b+=C;for(var y=ki.data,j=0;y!=n&&(n=t.getUint32(b,!1),j=t.getUint32(b+4,!0),y!=n);)b+=j+8;return e.dataLen=j,e.dataOffset=b+8,e}};var Pr=In.Mp3Encoder=Qo,J0=In.WavHeader=ki;var Mo=32767,ve=1152;function Wr(t,e,n){let C=t.numberOfChannels;if(C!==1&&C!==2)throw Error("Expecting mono or stereo audioBuffer");if(e=e??128,e<96)C=1;let b=t.length,y=[],j,z,Z;for(let h=0;h<C;h++){j=t.getChannelData(h),z=new Int16Array(b);for(let d=0;d<b;++d)Z=j[d],Z=Math.min(1,Math.max(-1,Z)),Z=Math.round(Z*Mo),z[d]=Z;y.push(z)}let B=new Pr(C,t.sampleRate,e);return new Promise((h,d)=>{let F=[],q=0,L=()=>{let I;if(q>=b){if(I=B.flush(),I.length>0)F.push(I);let w=new Blob(F,{type:"audio/mp3"});return h(w)}let E,D,g=performance.now();try{while(q<b&&performance.now()-g<15){if(C===1)E=y[0].subarray(q,q+ve),I=B.encodeBuffer(E);else E=y[0].subarray(q,q+ve),D=y[1].subarray(q,q+ve),I=B.encodeBuffer(E,D);if(I.length>0)F.push(I);q+=ve}}catch(w){d(w)}n&&n(q/b),setTimeout(L,16.7)};L()})}var xo=22050,Xo=32,Lo=22,rn=new AudioContext({sampleRate:xo}),sn=(t)=>new Promise(async(e)=>{let n=await Wr(t,Xo),C=new FileReader;C.readAsDataURL(n),C.addEventListener("load",(b)=>e({data:b.target.result.slice(Lo),type:"audio/mp3",rate:t.sampleRate,sampleCount:t.length}))});function on(t){return new Promise((e,n)=>{let C=new FileReader;C.readAsArrayBuffer(t),C.addEventListener("load",async()=>{try{let b=await rn.decodeAudioData(C.result),y=sn(b);e(y)}catch(b){n(b)}})})}async function Uo(t){let n=await(await fetch(t)).arrayBuffer(),C=await rn.decodeAudioData(n);return sn(C)}async function Dr(t){let e=await t.arrayBuffer(),n=await rn.decodeAudioData(e);return sn(n)}import{useCallback as ue,useMemo as S0}from"preact/hooks";import{batch as Gr}from"@preact/signals";import{nanoid as an}from"@blockcode/utils";import{useProjectContext as Vo,translate as No,setAlert as br,delAlert as Ho,openAsset as dn,addAsset as jr,delAsset as Io}from"@blockcode/core";function kr(t){let e=Math.floor(t/60),n=Math.floor(t%60);return`${e}:${`00${n}`.slice(-2)}.${t.toFixed(3).slice(-3)}`}import{Text as Fi,IconSelector as _o,ActionButton as Bo}from"@blockcode/core";function Si(t){let e=globalThis.document,n=e.createElement("style");n.appendChild(e.createTextNode(t)),e.head.append(n)}Si("._YzM_q_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}._YzM_q_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}._YzM_q_selector-item{width:5rem;height:5rem;margin:.5rem auto}._YzM_q_delete-menu-item:hover{background:var(--error-primary)}._YzM_q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}._YzM_q_add-button{margin:.75rem auto}");var Ti={selectorWrapper:"_YzM_q_selector-wrapper",deleteMenuItem:"_YzM_q_delete-menu-item",selectorItem:"_YzM_q_selector-item",addButtonWrapper:"_YzM_q_add-button-wrapper",selectorItemsWrapper:"_YzM_q_selector-items-wrapper",addButton:"_YzM_q_add-button"};var yr="./assets/icon-thumb-jy4n8115.svg";var vr="./assets/icon-sound-56nbc8vm.svg";var zr="./assets/icon-search-6g8kgvdt.svg";var te="./assets/icon-record-k0kczk8k.svg";var Jr="./assets/icon-surprise-d5t4529a.svg";var Yr="./assets/icon-file-upload-0z25chr6.svg";import{jsx as vi,jsxs as Ro}from"preact/jsx-runtime";function Zr({onShowLibrary:t,onSurprise:e,onSoundsFilter:n}){let{assets:C,assetId:b}=Vo(),y=ue(()=>{return C.value.filter((h)=>{if(!/^audio\//.test(h.type))return!1;if(!n)return!0;return n(h)})},[n]),j=ue(()=>{let h=document.createElement("input");h.type="file",h.accept=".wav,.mp3",h.multiple=!0,h.click(),h.addEventListener("change",async(d)=>{let F=an();br("importing",{id:F});try{for(let q of d.target.files){let L=an(),I=q.name.slice(0,q.name.lastIndexOf(".")),E=await on(q);jr({...E,id:L,name:I})}}catch(q){br({id:F,message:vi(Fi,{id:"sound.error.formatNotSupperted",defaultMessage:"This wav format is not supported."})},2000)}Ho(F)})},[]),z=ue(()=>{let h=an();Gr(()=>{jr({id:h,type:"audio/mp3",name:No("sound.sound","Sound"),data:"",rate:22050,sampleCount:0,record:!0}),dn(h)})},[]),Z=ue((h)=>{let d=y(),F=d[h];Gr(()=>{let q=b.value;if(F.id===b.value){if(h===0)q=d[1]?.id;else if(h+1<d.length)q=d[h+1].id;else if(h-1>-1)q=d[h-1].id}Io(F.id),dn(q)})},[]),B=ue((h,d)=>{dn(d.id)},[]);return Ro("div",{className:Ti.selectorWrapper,children:[vi(_o,{displayOrder:!0,id:"sound-selector",className:Ti.selectorItemsWrapper,items:y().map((h,d)=>({...h,details:`${kr(h.sampleCount/h.rate)||0}`,icon:yr,order:d,className:Ti.selectorItem,contextMenu:[[{label:vi(Fi,{id:"sound.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:vi(Fi,{id:"sound.contextMenu.delete",defaultMessage:"delete"}),className:Ti.deleteMenuItem,onClick:()=>Z(d)}]]})),selectedId:b.value,onSelect:B,onDelete:Z}),vi("div",{className:Ti.addButtonWrapper,children:vi(Bo,{tooltipPlacement:"right",className:Ti.addButton,icon:vr,tooltip:vi(Fi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t,moreButtons:[{icon:Yr,tooltip:vi(Fi,{id:"sound.actionButton.upload",defaultMessage:"Upload Sound"}),onClick:j},{icon:Jr,tooltip:vi(Fi,{id:"sound.actionButton.surprise",defaultMessage:"Surprise"}),onClick:e},{icon:te,tooltip:vi(Fi,{id:"sound.actionButton.record",defaultMessage:"Record"}),onClick:z},{icon:zr,tooltip:vi(Fi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t}]})})]})}import{useRef as pn,useEffect as Tr,useCallback as Mi}from"preact/hooks";import{classNames as be}from"@blockcode/utils";import{useProjectContext as d0,translate as zi,maybeTranslate as l0,setAsset as Er}from"@blockcode/core";function oi(t,e,n,C){return new(n||(n=Promise))(function(b,y){function j(B){try{Z(C.next(B))}catch(h){y(h)}}function z(B){try{Z(C.throw(B))}catch(h){y(h)}}function Z(B){var h;B.done?b(B.value):(h=B.value,h instanceof n?h:new n(function(d){d(h)})).then(j,z)}Z((C=C.apply(t,e||[])).next())})}class ee{constructor(){this.listeners={}}on(t,e,n){if(this.listeners[t]||(this.listeners[t]=new Set),n==null?void 0:n.once){let C=(...b)=>{this.un(t,C),e(...b)};return this.listeners[t].add(C),()=>this.un(t,C)}return this.listeners[t].add(e),()=>this.un(t,e)}un(t,e){var n;(n=this.listeners[t])===null||n===void 0||n.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((n)=>n(...e))}}var ze={decode:function(t,e){return oi(this,void 0,void 0,function*(){let n=new AudioContext({sampleRate:e});try{return yield n.decodeAudioData(t)}finally{n.close()}})},createBuffer:function(t,e){if(!t||t.length===0)throw Error("channelData must be a non-empty array");if(e<=0)throw Error("duration must be greater than 0");if(typeof t[0]=="number"&&(t=[t]),!t[0]||t[0].length===0)throw Error("channelData must contain non-empty channel arrays");(function(C){let b=C[0];if(b.some((y)=>y>1||y<-1)){let y=b.length,j=0;for(let z=0;z<y;z++){let Z=Math.abs(b[z]);Z>j&&(j=Z)}for(let z of C)for(let Z=0;Z<y;Z++)z[Z]/=j}})(t);let n=t.map((C)=>C instanceof Float32Array?C:Float32Array.from(C));return{duration:e,length:n[0].length,sampleRate:n[0].length/e,numberOfChannels:n.length,getChannelData:(C)=>{let b=n[C];if(!b)throw Error(`Channel ${C} not found`);return b},copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function xr(t,e){let n=e.xmlns?document.createElementNS(e.xmlns,t):document.createElement(t);for(let[C,b]of Object.entries(e))if(C==="children"&&b)for(let[y,j]of Object.entries(b))j instanceof Node?n.appendChild(j):typeof j=="string"?n.appendChild(document.createTextNode(j)):n.appendChild(xr(y,j));else C==="style"?Object.assign(n.style,b):C==="textContent"?n.textContent=b:n.setAttribute(C,b.toString());return n}function $r(t,e,n){let C=xr(t,e||{});return n==null||n.appendChild(C),C}var Ao=Object.freeze({__proto__:null,createElement:$r,default:$r}),t0={fetchBlob:function(t,e,n){return oi(this,void 0,void 0,function*(){let C=yield fetch(t,n);if(C.status>=400)throw Error(`Failed to fetch ${t}: ${C.status} (${C.statusText})`);return function(b,y){oi(this,void 0,void 0,function*(){if(!b.body||!b.headers)return;let j=b.body.getReader(),z=Number(b.headers.get("Content-Length"))||0,Z=0,B=(h)=>{Z+=(h==null?void 0:h.length)||0;let d=Math.round(Z/z*100);y(d)};try{for(;;){let h=yield j.read();if(h.done)break;B(h.value)}}catch(h){console.warn("Progress tracking error:",h)}})}(C.clone(),e),C.blob()})}};function ti(t){let e=t,n=new Set;return{get value(){return e},set(C){Object.is(e,C)||(e=C,n.forEach((b)=>b(e)))},update(C){this.set(C(e))},subscribe:(C)=>(n.add(C),()=>n.delete(C))}}function Ei(t,e){let n=ti(t());return e.forEach((C)=>C.subscribe(()=>{let b=t();Object.is(n.value,b)||n.set(b)})),{get value(){return n.value},subscribe:(C)=>n.subscribe(C)}}function Qi(t,e){let n,C=()=>{n&&(n(),n=void 0),n=t()},b=e.map((y)=>y.subscribe(C));return C(),()=>{n&&(n(),n=void 0),b.forEach((y)=>y())}}class Xr extends ee{get isPlayingSignal(){return this._isPlaying}get currentTimeSignal(){return this._currentTime}get durationSignal(){return this._duration}get volumeSignal(){return this._volume}get mutedSignal(){return this._muted}get playbackRateSignal(){return this._playbackRate}get seekingSignal(){return this._seeking}constructor(t){super(),this.isExternalMedia=!1,this.reactiveMediaEventCleanups=[],t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),this._isPlaying=ti(!1),this._currentTime=ti(0),this._duration=ti(0),this._volume=ti(this.media.volume),this._muted=ti(this.media.muted),this._playbackRate=ti(this.media.playbackRate||1),this._seeking=ti(!1),this.setupReactiveMediaEvents(),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)},{once:!0})}setupReactiveMediaEvents(){this.reactiveMediaEventCleanups.push(this.onMediaEvent("play",()=>{this._isPlaying.set(!0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("pause",()=>{this._isPlaying.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("ended",()=>{this._isPlaying.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("timeupdate",()=>{this._currentTime.set(this.media.currentTime)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("durationchange",()=>{this._duration.set(this.media.duration||0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("loadedmetadata",()=>{this._duration.set(this.media.duration||0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("seeking",()=>{this._seeking.set(!0)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("seeked",()=>{this._seeking.set(!1)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("volumechange",()=>{this._volume.set(this.media.volume),this._muted.set(this.media.muted)})),this.reactiveMediaEventCleanups.push(this.onMediaEvent("ratechange",()=>{this._playbackRate.set(this.media.playbackRate)}))}onMediaEvent(t,e,n){return this.media.addEventListener(t,e,n),()=>this.media.removeEventListener(t,e,n)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return this.media.canPlayType(t)!==""}setSrc(t,e){let n=this.getSrc();if(t&&n===t)return;this.revokeSrc();let C=e instanceof Blob&&(this.canPlayType(e.type)||!t)?URL.createObjectURL(e):t;if(n&&this.media.removeAttribute("src"),C||t)try{this.media.src=C}catch(b){this.media.src=t}}destroy(){this.reactiveMediaEventCleanups.forEach((t)=>t()),this.reactiveMediaEventCleanups=[],this.isExternalMedia||(this.media.pause(),this.revokeSrc(),this.media.removeAttribute("src"),this.media.load(),this.media.remove())}setMediaElement(t){this.reactiveMediaEventCleanups.forEach((e)=>e()),this.reactiveMediaEventCleanups=[],this.media=t,this.setupReactiveMediaEvents()}play(){return oi(this,void 0,void 0,function*(){try{return yield this.media.play()}catch(t){if(t instanceof DOMException&&t.name==="AbortError")return;throw t}})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=Math.max(0,Math.min(t,this.getDuration()))}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,e){e!=null&&(this.media.preservesPitch=e),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}function i0({maxTop:t,maxBottom:e,halfHeight:n,vScale:C,barMinHeight:b=0,barAlign:y}){let j=Math.round(t*n*C),z=j+Math.round(e*n*C)||1;return z<b&&(z=b,y||(j=z/2)),{topHeight:j,totalHeight:z}}function e0({barAlign:t,halfHeight:e,topHeight:n,totalHeight:C,canvasHeight:b}){return t==="top"?0:t==="bottom"?b-C:e-n}function Fr(t,e,n){let C=e-t.left,b=n-t.top;return[C/t.width,b/t.height]}function Lr(t){return Boolean(t.barWidth||t.barGap||t.barAlign)}function Qr(t,e){if(!Lr(e))return t;let n=e.barWidth||0.5,C=n+(e.barGap||n/2);return C===0?t:Math.floor(t/C)*C}function Mr({scrollLeft:t,totalWidth:e,numCanvases:n}){if(e===0)return[0];let C=t/e,b=Math.floor(C*n);return[b-1,b,b+1]}function Ur(t){let e=t._cleanup;typeof e=="function"&&e()}function n0(t){let e=ti({scrollLeft:t.scrollLeft,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth}),n=Ei(()=>function(y){let{scrollLeft:j,scrollWidth:z,clientWidth:Z}=y;if(z===0)return{startX:0,endX:1};let B=j/z,h=(j+Z)/z;return{startX:Math.max(0,Math.min(1,B)),endX:Math.max(0,Math.min(1,h))}}(e.value),[e]),C=Ei(()=>function(y){return{left:y.scrollLeft,right:y.scrollLeft+y.clientWidth}}(e.value),[e]),b=()=>{e.set({scrollLeft:t.scrollLeft,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth})};return t.addEventListener("scroll",b,{passive:!0}),{scrollData:e,percentages:n,bounds:C,cleanup:()=>{t.removeEventListener("scroll",b),Ur(e)}}}class Or extends ee{constructor(t,e){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.dragStream=null,this.scrollStream=null,this.subscriptions=[],this.options=t;let n=this.parentFromOptionsContainer(t.container);this.parent=n;let[C,b]=this.initHtml();n.appendChild(C),this.container=C,this.scrollContainer=b.querySelector(".scroll"),this.wrapper=b.querySelector(".wrapper"),this.canvasWrapper=b.querySelector(".canvases"),this.progressWrapper=b.querySelector(".progress"),this.cursor=b.querySelector(".cursor"),e&&b.appendChild(e),this.initEvents()}parentFromOptionsContainer(t){let e;if(typeof t=="string"?e=document.querySelector(t):t instanceof HTMLElement&&(e=t),!e)throw Error("Container not found");return e}initEvents(){this.wrapper.addEventListener("click",(e)=>{let n=this.wrapper.getBoundingClientRect(),[C,b]=Fr(n,e.clientX,e.clientY);this.emit("click",C,b)}),this.wrapper.addEventListener("dblclick",(e)=>{let n=this.wrapper.getBoundingClientRect(),[C,b]=Fr(n,e.clientX,e.clientY);this.emit("dblclick",C,b)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollStream=n0(this.scrollContainer);let t=Qi(()=>{let{startX:e,endX:n}=this.scrollStream.percentages.value,{left:C,right:b}=this.scrollStream.bounds.value;this.emit("scroll",e,n,C,b)},[this.scrollStream.percentages,this.scrollStream.bounds]);if(this.subscriptions.push(t),typeof ResizeObserver=="function"){let e=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{e().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let t=this.parent.clientWidth;t===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=t,this.reRender(),this.emit("resize"))}initDrag(){if(this.dragStream)return;this.dragStream=function(e,n={}){let{threshold:C=3,mouseButton:b=0,touchDelay:y=100}=n,j=ti(null),z=new Map,Z=matchMedia("(pointer: coarse)").matches,B=()=>{},h=(d)=>{if(d.button!==b)return;if(z.set(d.pointerId,d),z.size>1)return;let{clientX:F,clientY:q}=d,L=!1,I=Date.now(),E=e.getBoundingClientRect(),{left:D,top:g}=E,w=(M)=>{if(M.defaultPrevented||z.size>1)return;if(Z&&Date.now()-I<y)return;let{clientX:S,clientY:$}=M,x=S-F,dt=$-q;(L||Math.abs(x)>C||Math.abs(dt)>C)&&(M.preventDefault(),M.stopPropagation(),L||(j.set({type:"start",x:F-D,y:q-g}),L=!0),j.set({type:"move",x:S-D,y:$-g,deltaX:x,deltaY:dt}),F=S,q=$)},k=(M)=>{if(z.delete(M.pointerId),L){let{clientX:S,clientY:$}=M;j.set({type:"end",x:S-D,y:$-g})}B()},i=(M)=>{z.delete(M.pointerId),M.relatedTarget&&M.relatedTarget!==document.documentElement||k(M)},u=(M)=>{L&&(M.stopPropagation(),M.preventDefault())},Y=(M)=>{M.defaultPrevented||z.size>1||L&&M.preventDefault()};document.addEventListener("pointermove",w),document.addEventListener("pointerup",k),document.addEventListener("pointerout",i),document.addEventListener("pointercancel",i),document.addEventListener("touchmove",Y,{passive:!1}),document.addEventListener("click",u,{capture:!0}),B=()=>{document.removeEventListener("pointermove",w),document.removeEventListener("pointerup",k),document.removeEventListener("pointerout",i),document.removeEventListener("pointercancel",i),document.removeEventListener("touchmove",Y),setTimeout(()=>{document.removeEventListener("click",u,{capture:!0})},10)}};return e.addEventListener("pointerdown",h),{signal:j,cleanup:()=>{B(),e.removeEventListener("pointerdown",h),z.clear(),Ur(j)}}}(this.wrapper);let t=Qi(()=>{let e=this.dragStream.signal.value;if(!e)return;let n=this.wrapper.getBoundingClientRect().width,C=(b=e.x/n)<0?0:b>1?1:b;var b;e.type==="start"?(this.isDragging=!0,this.emit("dragstart",C)):e.type==="move"?this.emit("drag",C):e.type==="end"&&(this.isDragging=!1,this.emit("dragend",C))},[this.dragStream.signal]);this.subscriptions.push(t)}initHtml(){let t=document.createElement("div"),e=t.attachShadow({mode:"open"}),n=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return e.innerHTML=`
      <style${n?` nonce="${n}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
          pointer-events: none;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,e]}setOptions(t){if(this.options.container!==t.container){let e=this.parentFromOptionsContainer(t.container);e.appendChild(this.container),this.parent=e}t.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){let{scrollWidth:e}=this.scrollContainer,n=e*t;this.setScroll(n)}destroy(){var t;this.subscriptions.forEach((e)=>e()),this.container.remove(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),(t=this.unsubscribeOnScroll)===null||t===void 0||t.forEach((e)=>e()),this.unsubscribeOnScroll=[],this.dragStream&&(this.dragStream.cleanup(),this.dragStream=null),this.scrollStream&&(this.scrollStream.cleanup(),this.scrollStream=null)}createDelay(t=10){let e,n,C=()=>{e&&(clearTimeout(e),e=void 0),n&&(n(),n=void 0)};return this.timeouts.push(C),()=>new Promise((b,y)=>{C(),n=y,e=setTimeout(()=>{e=void 0,n=void 0,b()},t)})}getHeight(t,e){var n;let C=((n=this.audioData)===null||n===void 0?void 0:n.numberOfChannels)||1;return function({optionsHeight:b,optionsSplitChannels:y,parentHeight:j,numberOfChannels:z,defaultHeight:Z=128}){if(b==null)return Z;let B=Number(b);if(!isNaN(B))return B;if(b==="auto"){let h=j||Z;return(y==null?void 0:y.every((d)=>!d.overlay))?h/z:h}return Z}({optionsHeight:t,optionsSplitChannels:e,parentHeight:this.parent.clientHeight,numberOfChannels:C,defaultHeight:128})}convertColorValues(t,e){return function(n,C,b){if(!Array.isArray(n))return n||"";if(n.length===0)return"#999";if(n.length<2)return n[0]||"";let y=document.createElement("canvas"),j=y.getContext("2d"),z=b!=null?b:y.height*C,Z=j.createLinearGradient(0,0,0,z||C),B=1/(n.length-1);return n.forEach((h,d)=>{Z.addColorStop(d*B,h)}),Z}(t,this.getPixelRatio(),e==null?void 0:e.canvas.height)}getPixelRatio(){return t=window.devicePixelRatio,Math.max(1,t||1);var t}renderBarWaveform(t,e,n,C){let{width:b,height:y}=n.canvas,{halfHeight:j,barWidth:z,barRadius:Z,barIndexScale:B,barSpacing:h,barMinHeight:d}=function({width:q,height:L,length:I,options:E,pixelRatio:D}){let g=L/2,w=E.barWidth?E.barWidth*D:1,k=E.barGap?E.barGap*D:E.barWidth?w/2:0,i=w+k||1;return{halfHeight:g,barWidth:w,barGap:k,barRadius:E.barRadius||0,barMinHeight:E.barMinHeight?E.barMinHeight*D:0,barIndexScale:I>0?q/i/I:0,barSpacing:i}}({width:b,height:y,length:(t[0]||[]).length,options:e,pixelRatio:this.getPixelRatio()}),F=function({channelData:q,barIndexScale:L,barSpacing:I,barWidth:E,halfHeight:D,vScale:g,canvasHeight:w,barAlign:k,barMinHeight:i}){let u=q[0]||[],Y=q[1]||u,M=u.length,S=[],$=0,x=0,dt=0;for(let P=0;P<=M;P++){let r=Math.round(P*L);if(r>$){let{topHeight:T,totalHeight:K}=i0({maxTop:x,maxBottom:dt,halfHeight:D,vScale:g,barMinHeight:i,barAlign:k}),tt=e0({barAlign:k,halfHeight:D,topHeight:T,totalHeight:K,canvasHeight:w});S.push({x:$*I,y:tt,width:E,height:K}),$=r,x=0,dt=0}let J=Math.abs(u[P]||0),O=Math.abs(Y[P]||0);J>x&&(x=J),O>dt&&(dt=O)}return S}({channelData:t,barIndexScale:B,barSpacing:h,barWidth:z,halfHeight:j,vScale:C,canvasHeight:y,barAlign:e.barAlign,barMinHeight:d});n.beginPath();for(let q of F)Z&&"roundRect"in n?n.roundRect(q.x,q.y,q.width,q.height,Z):n.rect(q.x,q.y,q.width,q.height);n.fill(),n.closePath()}renderLineWaveform(t,e,n,C){let{width:b,height:y}=n.canvas,j=function({channelData:z,width:Z,height:B,vScale:h}){let d=B/2,F=z[0]||[];return[F,z[1]||F].map((q,L)=>{let I=q.length,E=I?Z/I:0,D=d,g=L===0?-1:1,w=[{x:0,y:D}],k=0,i=0;for(let u=0;u<=I;u++){let Y=Math.round(u*E);if(Y>k){let S=D+(Math.round(i*d*h)||1)*g;w.push({x:k,y:S}),k=Y,i=0}let M=Math.abs(q[u]||0);M>i&&(i=M)}return w.push({x:k,y:D}),w})}({channelData:t,width:b,height:y,vScale:C});n.beginPath();for(let z of j)if(z.length){n.moveTo(z[0].x,z[0].y);for(let Z=1;Z<z.length;Z++){let B=z[Z];n.lineTo(B.x,B.y)}}n.fill(),n.closePath()}renderWaveform(t,e,n){if(n.fillStyle=this.convertColorValues(e.waveColor,n),e.renderFunction)return void e.renderFunction(t,n);let C=function({channelData:b,barHeight:y,normalize:j,maxPeak:z}){var Z;let B=y||1;if(!j)return B;let h=b[0];if(!h||h.length===0)return B;let d=z!=null?z:0;if(!z)for(let F=0;F<h.length;F++){let q=(Z=h[F])!==null&&Z!==void 0?Z:0,L=Math.abs(q);L>d&&(d=L)}return d?B/d:B}({channelData:t,barHeight:e.barHeight,normalize:e.normalize,maxPeak:e.maxPeak});Lr(e)?this.renderBarWaveform(t,e,n,C):this.renderLineWaveform(t,e,n,C)}renderSingleCanvas(t,e,n,C,b,y,j){let z=this.getPixelRatio(),Z=document.createElement("canvas");Z.width=Math.round(n*z),Z.height=Math.round(C*z),Z.style.width=`${n}px`,Z.style.height=`${C}px`,Z.style.left=`${Math.round(b)}px`,y.appendChild(Z);let B=Z.getContext("2d");if(e.renderFunction?(B.fillStyle=this.convertColorValues(e.waveColor,B),e.renderFunction(t,B)):this.renderWaveform(t,e,B),Z.width>0&&Z.height>0){let h=Z.cloneNode(),d=h.getContext("2d");d.drawImage(Z,0,0),d.globalCompositeOperation="source-in",d.fillStyle=this.convertColorValues(e.progressColor,d),d.fillRect(0,0,Z.width,Z.height),j.appendChild(h)}}renderMultiCanvas(t,e,n,C,b,y){let j=this.getPixelRatio(),{clientWidth:z}=this.scrollContainer,Z=n/j,B=function({clientWidth:q,totalWidth:L,options:I}){return Qr(Math.min(8000,q,L),I)}({clientWidth:z,totalWidth:Z,options:e}),h={};if(B===0)return;let d=(q)=>{if(q<0||q>=F)return;if(h[q])return;h[q]=!0;let L=q*B,I=Math.min(Z-L,B);if(I=Qr(I,e),I<=0)return;let E=function({channelData:D,offset:g,clampedWidth:w,totalWidth:k}){return D.map((i)=>{let u=Math.floor(g/k*i.length),Y=Math.floor((g+w)/k*i.length);return i.slice(u,Y)})}({channelData:t,offset:L,clampedWidth:I,totalWidth:Z});this.renderSingleCanvas(E,e,I,C,L,b,y)},F=Math.ceil(Z/B);if(!this.isScrollable){for(let q=0;q<F;q++)d(q);return}if(Mr({scrollLeft:this.scrollContainer.scrollLeft,totalWidth:Z,numCanvases:F}).forEach((q)=>d(q)),F>1){let q=this.on("scroll",()=>{let{scrollLeft:L}=this.scrollContainer;Object.keys(h).length>10&&(b.innerHTML="",y.innerHTML="",h={}),Mr({scrollLeft:L,totalWidth:Z,numCanvases:F}).forEach((I)=>d(I))});this.unsubscribeOnScroll.push(q)}}renderChannel(t,e,n,C){var{overlay:b}=e,y=function(B,h){var d={};for(var F in B)Object.prototype.hasOwnProperty.call(B,F)&&h.indexOf(F)<0&&(d[F]=B[F]);if(B!=null&&typeof Object.getOwnPropertySymbols=="function"){var q=0;for(F=Object.getOwnPropertySymbols(B);q<F.length;q++)h.indexOf(F[q])<0&&Object.prototype.propertyIsEnumerable.call(B,F[q])&&(d[F[q]]=B[F[q]])}return d}(e,["overlay"]);let j=document.createElement("div"),z=this.getHeight(y.height,y.splitChannels);j.style.height=`${z}px`,b&&C>0&&(j.style.marginTop=`-${z}px`),this.canvasWrapper.style.minHeight=`${z}px`,this.canvasWrapper.appendChild(j);let Z=j.cloneNode();this.progressWrapper.appendChild(Z),this.renderMultiCanvas(t,y,n,z,j,Z)}render(t){return oi(this,void 0,void 0,function*(){var e;this.timeouts.forEach((Z)=>Z()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);let n=this.getPixelRatio(),C=this.scrollContainer.clientWidth,{scrollWidth:b,isScrollable:y,useParentWidth:j,width:z}=function({duration:Z,minPxPerSec:B=0,parentWidth:h,fillParent:d,pixelRatio:F}){let q=Math.ceil(Z*B),L=q>h,I=Boolean(d&&!L);return{scrollWidth:q,isScrollable:L,useParentWidth:I,width:(I?h:q)*F}}({duration:t.duration,minPxPerSec:this.options.minPxPerSec||0,parentWidth:C,fillParent:this.options.fillParent,pixelRatio:n});if(this.isScrollable=y,this.wrapper.style.width=j?"100%":`${b}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let Z=0;Z<t.numberOfChannels;Z++){let B=Object.assign(Object.assign({},this.options),(e=this.options.splitChannels)===null||e===void 0?void 0:e[Z]);this.renderChannel([t.getChannelData(Z)],B,z,Z)}else{let Z=[t.getChannelData(0)];t.numberOfChannels>1&&Z.push(t.getChannelData(1)),this.renderChannel(Z,this.options,z,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach((n)=>n()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:t}=this.scrollContainer,{right:e}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){let{right:n}=this.progressWrapper.getBoundingClientRect(),C=function(b){let y=2*b;return(y<0?Math.floor(y):Math.ceil(y))/2}(n-e);this.scrollContainer.scrollLeft+=C}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,e=!1){let{scrollLeft:n,scrollWidth:C,clientWidth:b}=this.scrollContainer,y=t*C,j=n,z=n+b,Z=b/2;if(this.isDragging)y+30>z?this.scrollContainer.scrollLeft+=30:y-30<j&&(this.scrollContainer.scrollLeft-=30);else{(y<j||y>z)&&(this.scrollContainer.scrollLeft=y-(this.options.autoCenter?Z:0));let B=y-n-Z;e&&this.options.autoCenter&&B>0&&(this.scrollContainer.scrollLeft+=B)}}renderProgress(t,e){if(isNaN(t))return;let n=100*t;this.canvasWrapper.style.clipPath=`polygon(${n}% 0%, 100% 0%, 100% 100%, ${n}% 100%)`,this.progressWrapper.style.width=`${n}%`,this.cursor.style.left=`${n}%`,this.cursor.style.transform=this.options.cursorWidth?`translateX(-${t*this.options.cursorWidth}px)`:"",this.isScrollable&&this.options.autoScroll&&this.audioData&&this.audioData.duration>0&&this.scrollIntoView(t,e)}exportImage(t,e,n){return oi(this,void 0,void 0,function*(){let C=this.canvasWrapper.querySelectorAll("canvas");if(!C.length)throw Error("No waveform data");if(n==="dataURL"){let b=Array.from(C).map((y)=>y.toDataURL(t,e));return Promise.resolve(b)}return Promise.all(Array.from(C).map((b)=>new Promise((y,j)=>{b.toBlob((z)=>{z?y(z):j(Error("Could not export image"))},t,e)})))})}}class Kr extends ee{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;let t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}class Je extends ee{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return oi(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((e)=>{if(e.status>=400)throw Error(`Failed to fetch ${t}: ${e.status} (${e.statusText})`);return e.arrayBuffer()}).then((e)=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(e)).then((e)=>{this.currentSrc===t&&(this.buffer=e,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())}).catch((e)=>{console.error("WebAudioPlayer load error:",e)})}_play(){if(!this.paused)return;this.paused=!1,this.bufferNode&&(this.bufferNode.onended=null,this.bufferNode.disconnect()),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let t=this.playedDuration*this._playbackRate;(t>=this.duration||t<0)&&(t=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,t),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,(t=this.bufferNode)===null||t===void 0||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return oi(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){let e=t-this.currentTime,n=this.bufferNode;n==null||n.stop(this.audioContext.currentTime+e),n==null||n.addEventListener("ended",()=>{n===this.bufferNode&&(this.bufferNode=null,this.pause())},{once:!0})}setSinkId(t){return oi(this,void 0,void 0,function*(){return this.audioContext.setSinkId(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){let e=!this.paused;e&&this._pause(),this.playedDuration=t/this._playbackRate,e&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,e;return(t=this._duration)!==null&&t!==void 0?t:((e=this.buffer)===null||e===void 0?void 0:e.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){let t=[];if(!this.buffer)return t;let e=this.buffer.numberOfChannels;for(let n=0;n<e;n++)t.push(this.buffer.getChannelData(n));return t}removeAttribute(t){switch(t){case"src":this.src="";break;case"playbackRate":this.playbackRate=0;break;case"currentTime":this.currentTime=0;break;case"duration":this.duration=0;break;case"volume":this.volume=0;break;case"muted":this.muted=!1}}}var r0={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8000};class ie extends Xr{static create(t){return new ie(t)}getState(){return this.wavesurferState}getRenderer(){return this.renderer}constructor(t){let e=t.media||(t.backend==="WebAudio"?new Je:void 0);super({media:e,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.stopAtPosition=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.reactiveCleanups=[],this.options=Object.assign({},r0,t);let{state:n,actions:C}=function(j){var z,Z,B,h,d,F;let q=(z=j==null?void 0:j.currentTime)!==null&&z!==void 0?z:ti(0),L=(Z=j==null?void 0:j.duration)!==null&&Z!==void 0?Z:ti(0),I=(B=j==null?void 0:j.isPlaying)!==null&&B!==void 0?B:ti(!1),E=(h=j==null?void 0:j.isSeeking)!==null&&h!==void 0?h:ti(!1),D=(d=j==null?void 0:j.volume)!==null&&d!==void 0?d:ti(1),g=(F=j==null?void 0:j.playbackRate)!==null&&F!==void 0?F:ti(1),w=ti(null),k=ti(null),i=ti(""),u=ti(0),Y=ti(0),M=Ei(()=>!I.value,[I]),S=Ei(()=>w.value!==null,[w]),$=Ei(()=>S.value&&L.value>0,[S,L]),x=Ei(()=>q.value,[q]),dt=Ei(()=>L.value>0?q.value/L.value:0,[q,L]);return{state:{currentTime:q,duration:L,isPlaying:I,isPaused:M,isSeeking:E,volume:D,playbackRate:g,audioBuffer:w,peaks:k,url:i,zoom:u,scrollPosition:Y,canPlay:S,isReady:$,progress:x,progressPercent:dt},actions:{setCurrentTime:(P)=>{let r=Math.max(0,Math.min(L.value||1/0,P));q.set(r)},setDuration:(P)=>{L.set(Math.max(0,P))},setPlaying:(P)=>{I.set(P)},setSeeking:(P)=>{E.set(P)},setVolume:(P)=>{let r=Math.max(0,Math.min(1,P));D.set(r)},setPlaybackRate:(P)=>{let r=Math.max(0.1,Math.min(16,P));g.set(r)},setAudioBuffer:(P)=>{w.set(P),P&&L.set(P.duration)},setPeaks:(P)=>{k.set(P)},setUrl:(P)=>{i.set(P)},setZoom:(P)=>{u.set(Math.max(0,P))},setScrollPosition:(P)=>{Y.set(Math.max(0,P))}}}}({isPlaying:this.isPlayingSignal,currentTime:this.currentTimeSignal,duration:this.durationSignal,volume:this.volumeSignal,playbackRate:this.playbackRateSignal,isSeeking:this.seekingSignal});this.wavesurferState=n,this.wavesurferActions=C,this.timer=new Kr;let b=e?void 0:this.getMediaElement();this.renderer=new Or(this.options,b),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initReactiveState(),this.initPlugins();let y=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:j,duration:z}=this.options;(y||j&&z)&&this.load(y,j,z).catch((Z)=>{this.emit("error",Z instanceof Error?Z:Error(String(Z)))})})}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t),this.stopAtPosition!=null&&this.isPlaying()&&t>=this.stopAtPosition&&this.pause()}}))}initReactiveState(){this.reactiveCleanups.push(function(t,e){let n=[];n.push(Qi(()=>{let y=t.isPlaying.value;e.emit(y?"play":"pause")},[t.isPlaying])),n.push(Qi(()=>{let y=t.currentTime.value;e.emit("timeupdate",y),t.isPlaying.value&&e.emit("audioprocess",y)},[t.currentTime,t.isPlaying])),n.push(Qi(()=>{t.isSeeking.value&&e.emit("seeking",t.currentTime.value)},[t.isSeeking,t.currentTime]));let C=!1;n.push(Qi(()=>{t.isReady.value&&!C&&(C=!0,e.emit("ready",t.duration.value))},[t.isReady,t.duration]));let b=!1;return n.push(Qi(()=>{let y=t.isPlaying.value,j=t.currentTime.value,z=t.duration.value,Z=z>0&&j>=z;b&&!y&&Z&&e.emit("finish"),b=y&&Z},[t.isPlaying,t.currentTime,t.duration])),n.push(Qi(()=>{let y=t.zoom.value;y>0&&e.emit("zoom",y)},[t.zoom])),()=>{n.forEach((y)=>y())}}(this.wavesurferState,{emit:this.emit.bind(this)}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let t=this.updateProgress();this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("emptied",()=>{this.timer.stop(),this.stopAtPosition=null}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish"),this.stopAtPosition=null}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",()=>{var t;this.emit("error",(t=this.getMediaElement().error)!==null&&t!==void 0?t:Error("Media error")),this.stopAtPosition=null}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,e)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,e))}),this.renderer.on("dblclick",(t,e)=>{this.emit("dblclick",t,e)}),this.renderer.on("scroll",(t,e,n,C)=>{let b=this.getDuration();this.emit("scroll",t*b,e*b,n,C)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",(t)=>{this.emit("dragstart",t)}),this.renderer.on("dragend",(t)=>{this.emit("dragend",t)}),this.renderer.on("resize",()=>{this.emit("resize")}));{let t,e=this.renderer.on("drag",(n)=>{var C;if(!this.options.interact)return;this.renderer.renderProgress(n),clearTimeout(t);let b=0,y=this.options.dragToSeek;this.isPlaying()?b=0:y===!0?b=200:y&&typeof y=="object"&&(b=(C=y.debounceTime)!==null&&C!==void 0?C:200),t=setTimeout(()=>{this.seekTo(n)},b),this.emit("interaction",n*this.getDuration()),this.emit("drag",n)});this.subscriptions.push(()=>{clearTimeout(t),e()})}}initPlugins(){var t;((t=this.options.plugins)===null||t===void 0?void 0:t.length)&&this.options.plugins.forEach((e)=>{this.registerPlugin(e)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t)=>t()),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=ze.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=ze.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){if(this.plugins.includes(t))return t;t._init(this),this.plugins.push(t);let e=t.once("destroy",()=>{this.plugins=this.plugins.filter((n)=>n!==t),this.subscriptions=this.subscriptions.filter((n)=>n!==e)});return this.subscriptions.push(e),t}unregisterPlugin(t){this.plugins=this.plugins.filter((e)=>e!==t),t.destroy()}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){let e=t/this.getDuration();this.renderer.setScrollPercentage(e)}getActivePlugins(){return this.plugins}loadAudio(t,e,n,C){return oi(this,void 0,void 0,function*(){var b;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,this.stopAtPosition=null,(b=this.abortController)===null||b===void 0||b.abort(),this.abortController=null,!e&&!n){let j=this.options.fetchParams||{};window.AbortController&&!j.signal&&(this.abortController=new AbortController,j.signal=this.abortController.signal);let z=(B)=>this.emit("loading",B);e=yield t0.fetchBlob(t,z,j);let Z=this.options.blobMimeType;Z&&(e=new Blob([e],{type:Z}))}this.setSrc(t,e);let y=yield new Promise((j)=>{let z=C||this.getDuration();z?j(z):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>j(this.getDuration()),{once:!0}))});if(!t&&!e){let j=this.getMediaElement();j instanceof Je&&(j.duration=y)}if(n)this.decodedData=ze.createBuffer(n,y||0);else if(e){let j=yield e.arrayBuffer();this.decodedData=yield ze.decode(j,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(t,e,n){return oi(this,void 0,void 0,function*(){try{return yield this.loadAudio(t,void 0,e,n)}catch(C){throw this.emit("error",C),C}})}loadBlob(t,e,n){return oi(this,void 0,void 0,function*(){try{return yield this.loadAudio("",t,e,n)}catch(C){throw this.emit("error",C),C}})}zoom(t){if(!this.decodedData)throw Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:e=8000,precision:n=1e4}={}){if(!this.decodedData)throw Error("The audio has not been decoded yet");let C=Math.min(t,this.decodedData.numberOfChannels),b=[];for(let y=0;y<C;y++){let j=this.decodedData.getChannelData(y),z=[],Z=j.length/e;for(let B=0;B<e;B++){let h=j.slice(Math.floor(B*Z),Math.ceil((B+1)*Z)),d=0;for(let F=0;F<h.length;F++){let q=h[F];Math.abs(q)>Math.abs(d)&&(d=q)}z.push(Math.round(d*n)/n)}b.push(z)}return b}getDuration(){let t=super.getDuration()||0;return t!==0&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){this.stopAtPosition=null,super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){let e=this.getDuration()*t;this.setTime(e)}play(t,e){let n=Object.create(null,{play:{get:()=>super.play}});return oi(this,void 0,void 0,function*(){t!=null&&this.setTime(t);let C=yield n.play.call(this);return e!=null&&(this.media instanceof Je?this.media.stopAt(e):this.stopAtPosition=e),C})}playPause(){return oi(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],0.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return oi(this,arguments,void 0,function*(t="image/png",e=1,n="dataURL"){return this.renderer.exportImage(t,e,n)})}destroy(){var t;this.emit("destroy"),(t=this.abortController)===null||t===void 0||t.abort(),this.plugins.forEach((e)=>e.destroy()),this.subscriptions.forEach((e)=>e()),this.unsubscribePlayerEvents(),this.reactiveCleanups.forEach((e)=>e()),this.reactiveCleanups=[],this.timer.destroy(),this.renderer.destroy(),super.destroy()}}ie.BasePlugin=class extends ee{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}},ie.dom=Ao;function ln(t,e,n,C){return new(n||(n=Promise))(function(b,y){function j(B){try{Z(C.next(B))}catch(h){y(h)}}function z(B){try{Z(C.throw(B))}catch(h){y(h)}}function Z(B){var h;B.done?b(B.value):(h=B.value,h instanceof n?h:new n(function(d){d(h)})).then(j,z)}Z((C=C.apply(t,e||[])).next())})}class cn{constructor(){this.listeners={}}on(t,e,n){if(this.listeners[t]||(this.listeners[t]=new Set),n==null?void 0:n.once){let C=(...b)=>{this.un(t,C),e(...b)};return this.listeners[t].add(C),()=>this.un(t,C)}return this.listeners[t].add(e),()=>this.un(t,e)}un(t,e){var n;(n=this.listeners[t])===null||n===void 0||n.delete(e)}once(t,e){return this.on(t,e,{once:!0})}unAll(){this.listeners={}}emit(t,...e){this.listeners[t]&&this.listeners[t].forEach((n)=>n(...e))}}class qr extends cn{constructor(t){super(),this.subscriptions=[],this.isDestroyed=!1,this.options=t}onInit(){}_init(t){this.isDestroyed&&(this.subscriptions=[],this.isDestroyed=!1),this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t()),this.subscriptions=[],this.isDestroyed=!0,this.wavesurfer=void 0}}class Sr extends cn{constructor(){super(...arguments),this.animationFrameId=null,this.isRunning=!1}start(){if(this.isRunning)return;this.isRunning=!0;let t=()=>{this.isRunning&&(this.emit("tick"),this.animationFrameId=requestAnimationFrame(t))};t()}stop(){this.isRunning=!1,this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}destroy(){this.stop()}}var hn=100,s0=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class Ye extends qr{constructor(t){var e,n,C,b,y,j;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(e=t.audioBitsPerSecond)!==null&&e!==void 0?e:128000,scrollingWaveform:(n=t.scrollingWaveform)!==null&&n!==void 0&&n,scrollingWaveformWindow:(C=t.scrollingWaveformWindow)!==null&&C!==void 0?C:5,continuousWaveform:(b=t.continuousWaveform)!==null&&b!==void 0&&b,renderRecordedAudio:(y=t.renderRecordedAudio)===null||y===void 0||y,mediaRecorderTimeslice:(j=t.mediaRecorderTimeslice)!==null&&j!==void 0?j:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.micStream=null,this.recordedBlobUrl=null,this.timer=new Sr,this.subscriptions.push(this.timer.on("tick",()=>{let z=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+z,this.emit("record-progress",this.duration)}))}static create(t){return new Ye(t||{})}renderMicStream(t){var e;let n=new AudioContext,C=n.createMediaStreamSource(t),b=n.createAnalyser();C.connect(b),(this.options.continuousWaveform||this.options.scrollingWaveform)&&(b.fftSize=32);let y=b.frequencyBinCount,j=new Float32Array(y),z=0;this.wavesurfer&&((e=this.originalOptions)!==null&&e!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0,this.wavesurfer.options.normalize=!0,this.wavesurfer.options.maxPeak=1));let Z=setInterval(()=>{var B,h,d,F;if(!this.isWaveformPaused){if(b.getFloatTimeDomainData(j),this.options.scrollingWaveform){let q=Math.floor((this.options.scrollingWaveformWindow||0)*hn),L=0;for(let E=0;E<y;E++){let D=Math.abs(j[E]);D>L&&(L=D)}this.dataWindow||(this.dataWindow=new Float32Array(q));let I=new Float32Array(q);if(this.dataWindow&&this.dataWindow.length>0){let E=q-1,D=this.dataWindow.slice(-E);I.set(D,0)}I[q-1]=L,this.dataWindow=I}else if(this.options.continuousWaveform){if(!this.dataWindow){let L=this.options.continuousWaveformDuration?Math.round(this.options.continuousWaveformDuration*hn):((h=(B=this.wavesurfer)===null||B===void 0?void 0:B.getWidth())!==null&&h!==void 0?h:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(L)}let q=0;for(let L=0;L<y;L++){let I=Math.abs(j[L]);I>q&&(q=I)}if(z+1>this.dataWindow.length){let L=new Float32Array(2*this.dataWindow.length);L.set(this.dataWindow,0),this.dataWindow=L}this.dataWindow[z]=q,z++}else this.dataWindow=j;if(this.wavesurfer){let q=((F=(d=this.dataWindow)===null||d===void 0?void 0:d.length)!==null&&F!==void 0?F:0)/hn;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:q).then(()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1000),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))}).catch((L)=>{console.error("Error rendering real-time recording data:",L)})}}},10);return{onDestroy:()=>{clearInterval(Z),C==null||C.disconnect(),n==null||n.close()},onEnd:()=>{this.isWaveformPaused=!0,this.stopMic()}}}startMic(t){return ln(this,void 0,void 0,function*(){let e;this.micStream&&this.stopMic();try{e=yield navigator.mediaDevices.getUserMedia({audio:t==null||t})}catch(C){throw Error("Error accessing the microphone: "+C.message)}let n=this.renderMicStream(e);return this.micStream=n,this.unsubscribeDestroy=this.once("destroy",n.onDestroy),this.unsubscribeRecordEnd=this.once("record-end",n.onEnd),this.stream=e,e})}stopMic(){var t,e,n;(t=this.micStream)===null||t===void 0||t.onDestroy(),(e=this.unsubscribeDestroy)===null||e===void 0||e.call(this),(n=this.unsubscribeRecordEnd)===null||n===void 0||n.call(this),this.micStream=null,this.unsubscribeDestroy=void 0,this.unsubscribeRecordEnd=void 0,this.stream&&(this.stream.getTracks().forEach((C)=>C.stop()),this.stream=null,this.mediaRecorder=null)}startRecording(t){return ln(this,void 0,void 0,function*(){let e=this.stream||(yield this.startMic(t));this.dataWindow=null;let n=this.mediaRecorder||new MediaRecorder(e,{mimeType:this.options.mimeType||s0.find((y)=>MediaRecorder.isTypeSupported(y)),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=n,this.stopRecording();let C=[];n.ondataavailable=(y)=>{y.data.size>0&&C.push(y.data),this.emit("record-data-available",y.data)};let b=(y)=>{var j;let z=new Blob(C,{type:n.mimeType});this.emit(y,z),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),this.recordedBlobUrl&&URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=URL.createObjectURL(z),(j=this.wavesurfer)===null||j===void 0||j.load(this.recordedBlobUrl))};n.onpause=()=>b("record-pause"),n.onstop=()=>b("record-end"),n.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")})}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,e;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(e=this.mediaRecorder)===null||e===void 0||e.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return ln(this,void 0,void 0,function*(){return navigator.mediaDevices.enumerateDevices().then((t)=>t.filter((e)=>e.kind==="audioinput"))})}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic(),this.recordedBlobUrl&&(URL.revokeObjectURL(this.recordedBlobUrl),this.recordedBlobUrl=null)}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}import{Label as h0,BufferedInput as c0,Button as Vr}from"@blockcode/core";Si("._32PlYG_wave-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._32PlYG_wave-wrapper._32PlYG_disabled{opacity:.5;pointer-events:none}._32PlYG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._32PlYG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._32PlYG_row-right{margin-right:var(--space);justify-content:right}._32PlYG_row:last-child{min-height:unset;margin-bottom:0}._32PlYG_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._32PlYG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._32PlYG_name-input{width:8rem}._32PlYG_large-input{width:4rem}._32PlYG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._32PlYG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._32PlYG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._32PlYG_button-icon{width:100%;height:100%;margin:auto}._32PlYG_group-button{border-left:none;border-radius:0}._32PlYG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._32PlYG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._32PlYG_group-button-toggled-off{filter:saturate(0)}._32PlYG_label-button{border:0;font-weight:400}._32PlYG_label-button._32PlYG_selected{background:var(--theme-primary);color:var(--ui-white)}._32PlYG_label-button._32PlYG_selected ._32PlYG_button-icon{filter:brightness(0)invert()}._32PlYG_play-button,._32PlYG_record-button{cursor:pointer;width:3rem;height:3rem;margin:0 var(--space);border:0;border-radius:100%;padding:.75rem}._32PlYG_play-button{background:var(--theme-primary)}._32PlYG_record-button{background:var(--error-primary)}._32PlYG_wave-box-wrapper{margin:20px var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)*.8);background:hsl(from var(--blocks-sounds-primary)h s l/.15);flex:1;min-height:160px;position:relative;overflow:hidden}._32PlYG_wave-box-wrapper._32PlYG_hidden>div{visibility:hidden}");var It={rowRight:"_32PlYG_row-right",waveBoxWrapper:"_32PlYG_wave-box-wrapper",playButton:"_32PlYG_play-button",rowFill:"_32PlYG_row-fill",waveWrapper:"_32PlYG_wave-wrapper",button:"_32PlYG_button",groupButtonLast:"_32PlYG_group-button-last",hidden:"_32PlYG_hidden",buttonIcon:"_32PlYG_button-icon",disabled:"_32PlYG_disabled",selected:"_32PlYG_selected",group:"_32PlYG_group",nameInput:"_32PlYG_name-input",labelImage:"_32PlYG_label-image",groupButton:"_32PlYG_group-button",groupButtonFirst:"_32PlYG_group-button-first",groupButtonToggledOff:"_32PlYG_group-button-toggled-off",dashedBorder:"_32PlYG_dashed-border",row:"_32PlYG_row",largeInput:"_32PlYG_large-input",toolIcon:"_32PlYG_tool-icon",labelButton:"_32PlYG_label-button",recordButton:"_32PlYG_record-button"};var Ge="./assets/icon-play-mnpftarf.svg";var un="./assets/icon-stop-547qvw0a.svg";import{jsx as Gi,jsxs as Hr}from"preact/jsx-runtime";var u0=Ye.create(),Nr;function Ir(){let t=pn(),e=pn(),n=pn(),{asset:C}=d0(),b=C.value,y=!b||!/^audio\//.test(b.type);Tr(()=>{if(!t.ws)return;if(t.ws.isPlaying())t.ws.stop();if(t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})}),t.ws.empty(),b?.sampleCount>0)t.ws.load(`data:${b.type};base64,${b.data}`);if(t.record.sound=b,e.current)e.current.src=Ge,e.current.title=zi("sound.play","Play");if(n.current)n.current.src=te,n.current.title=zi("sound.record","Record")},[b,y]);let j=Mi((L,I)=>{Er({[L]:I})},[]),z=Mi(()=>{if(t.ws){if(t.ws.isPlaying())t.ws.stop();else if(b.sampleCount>0)t.ws.play()}if(n.current)setTimeout(()=>{let L=n.current.parentElement.parentElement;if(L.disabled=t.ws.isPlaying(),t.ws.isPlaying())L.classList.add(It.groupButtonToggledOff);else L.classList.remove(It.groupButtonToggledOff)})},[b]),Z=Mi(()=>{if(e.current)e.current.src=un,e.current.title=zi("sound.stop","Stop");if(t.ws)t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1});if(n.current){let L=n.current.parentElement.parentElement;L.disabled=!1,L.classList.remove(It.groupButtonToggledOff)}},[]),B=Mi(()=>{if(e.current){if(e.current.src=Ge,e.current.title=zi("sound.play","Play"),t.ws)t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})})}if(n.current){n.current.src=te,n.current.title=zi("sound.record","Record");let L=n.current.parentElement.parentElement;L.disabled=!1,L.classList.remove(It.groupButtonToggledOff)}},[]),h=Mi(()=>{if(t.ws&&!t.record.isRecording())t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1})},[]),d=Mi(()=>{if(n.current)n.current.src=un,n.current.title=zi("sound.stop","Stop");if(e.current){let L=e.current.parentElement.parentElement;L.disabled=!0,L.classList.add(It.groupButtonToggledOff)}},[]),F=Mi(()=>{if(t.record)if(t.record.isRecording())t.record.stopRecording(),t.record.stopMic(),clearTimeout(Nr);else t.record.startRecording(),Nr=setTimeout(F,1e4)},[]),q=Mi(async(L)=>{let I=await Dr(L);if(Er(I),e.current){let E=e.current.parentElement.parentElement;E.disabled=!1,E.classList.remove(It.groupButtonToggledOff)}},[]);return Tr(()=>{if(t.current){if(t.ws=ie.create({container:t.current,dragToSeek:!0,height:"auto",waveColor:"hsla(300, 48%, 50%, 1)",progressColor:"hsla(300, 48%, 50%, 0.8)",cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0}),t.record=t.ws.registerPlugin(u0),t.record.on("record-start",d),t.record.on("record-end",q),t.ws.on("play",Z),t.ws.on("pause",B),t.ws.on("finish",B),t.ws.on("seeking",h),b?.sampleCount>0)t.ws.empty(),t.ws.load(`data:${b.type};base64,${b.data}`);t.record.sound=b}return()=>{if(t.ws)t.ws.destroy()}},[]),Hr("div",{className:be(It.waveWrapper,{[It.disabled]:y}),children:[Gi("div",{className:It.row,children:Gi("div",{className:It.group,children:Gi(h0,{text:zi("sound.sound","Sound"),children:Gi(c0,{disabled:y,className:It.nameInput,placeholder:zi("sound.name","name"),onSubmit:(L)=>j("name",L),value:y||!b?zi("sound.sound","Sound"):l0(b.name)})})})}),Gi("div",{className:It.row,children:Gi("div",{ref:t,className:be(It.waveBoxWrapper,{[It.hidden]:y})})}),Hr("div",{className:It.row,children:[Gi(Vr,{className:be(It.button,It.playButton,{[It.groupButtonToggledOff]:y}),onClick:z,children:Gi("img",{ref:e,src:Ge,className:It.buttonIcon,title:zi("sound.play","Play")})}),b?.record&&Gi(Vr,{className:be(It.button,It.recordButton,{[It.groupButtonToggledOff]:y}),onClick:F,children:Gi("img",{ref:n,src:te,className:It.buttonIcon,title:zi("sound.record","Record")})})]})]})}Si(".cPknva_wave-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var _r={waveEditorWrapper:"cPknva_wave-editor-wrapper"};import{jsx as Br,jsxs as g0}from"preact/jsx-runtime";function p0({onShowLibrary:t,onSurprise:e,onSoundsFilter:n}){return g0("div",{className:_r.waveEditorWrapper,children:[Br(Zr,{onShowLibrary:t,onSurprise:e,onSoundsFilter:n}),Br(Ir,{})]})}import{Text as w0}from"@blockcode/core";var Rr="./assets/icon-sound-ajkz0had.svg";import{jsx as C0}from"preact/jsx-runtime";var f0={icon:Rr,label:C0(w0,{id:"sound.sound",defaultMessage:"Sound"})};export{f0 as soundTab,Uo as loadSoundFromURL,on as loadSoundFromFile,p0 as SoundEditor};
