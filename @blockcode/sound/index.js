import{addLocalesMessages as Se}from"@blockcode/core";var fo={"sound.sound":"Sound","sound.play":"Play","sound.record":"Record","sound.stop":"Stop","sound.name":"name","sound.contextMenu.export":"export","sound.contextMenu.delete":"delete","sound.actionButton.upload":"Upload Sound","sound.actionButton.surprise":"Surprise","sound.actionButton.record":"Record","sound.actionButton.sound":"Choose a Sound","sound.error.formatNotSupperted":"This wav format is not supported."};var Wo={"sound.sound":"声音","sound.play":"播放","sound.record":"录音","sound.stop":"停止","sound.name":"名称","sound.contextMenu.export":"导出","sound.contextMenu.delete":"删除","sound.actionButton.upload":"上传声音","sound.actionButton.surprise":"随机","sound.actionButton.record":"录制","sound.actionButton.sound":"选择一个声音","sound.error.formatNotSupperted":"声音文件格式不支持。"};var Po={"sound.sound":"聲音","sound.play":"播放","sound.record":"録音","sound.stop":"停止","sound.name":"名稱","sound.contextMenu.export":"導齣","sound.contextMenu.delete":"刪除","sound.actionButton.upload":"上傳聲音","sound.actionButton.surprise":"隨機","sound.actionButton.record":"録製","sound.actionButton.sound":"選擇一個聲音","sound.error.formatNotSupperted":"聲音文件格式不支持。"};Se({en:fo,"zh-Hans":Wo,"zh-Hant":Po});var Eo={};function Ee(t){return new Int8Array(t)}function Ho(t){return new Int16Array(t)}function Io(t){return new Int32Array(t)}function _o(t){return new Float32Array(t)}function He(t){return new Float64Array(t)}function Bo(t){if(t.length==1)return _o(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(Bo(t));return d}function Ro(t){if(t.length==1)return Io(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(Ro(t));return d}function Ao(t){if(t.length==1)return Ho(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(Ao(t));return d}function te(t){if(t.length==1)return new Array(t[0]);var r=t[0];t=t.slice(1);for(var d=[],W=0;W<r;W++)d.push(te(t));return d}var ie={};ie.fill=function(t,r,d,W){if(arguments.length==2)for(var b=0;b<t.length;b++)t[b]=arguments[1];else for(var b=r;b<d;b++)t[b]=W};var cn={};cn.arraycopy=function(t,r,d,W,b){for(var z=r+b;r<z;)d[W++]=t[r++]};cn.out={};cn.out.println=function(t){console.log(t)};cn.out.printf=function(){console.log.apply(console,arguments)};var Wn={};Wn.SQRT2=1.4142135623730951;Wn.FAST_LOG10=function(t){return Math.log10(t)};Wn.FAST_LOG10_X=function(t,r){return Math.log10(t)*r};function $i(t){this.ordinal=t}$i.short_block_allowed=new $i(0);$i.short_block_coupled=new $i(1);$i.short_block_dispensed=new $i(2);$i.short_block_forced=new $i(3);var ne={};ne.MAX_VALUE=340282350000000000000000000000000000000;function ui(t){this.ordinal=t}ui.vbr_off=new ui(0);ui.vbr_mt=new ui(1);ui.vbr_rh=new ui(2);ui.vbr_abr=new ui(3);ui.vbr_mtrh=new ui(4);ui.vbr_default=ui.vbr_mtrh;var Ie=function(t){},Ht={System:cn,VbrMode:ui,Float:ne,ShortBlock:$i,Util:Wn,Arrays:ie,new_array_n:te,new_byte:Ee,new_double:He,new_float:_o,new_float_n:Bo,new_int:Io,new_int_n:Ro,new_short:Ho,new_short_n:Ao,assert:Ie},Kn,Do;function _e(){if(Do)return Kn;Do=1;var t=Ht,r=t.System,d=t.Util,W=t.Arrays,b=t.new_float,z=ei();function X(){var j=[-0.1482523854003001,32.308141959636465,296.40344946382766,883.1344870032432,11113.947376231741,1057.2713659324597,305.7402417275812,30.825928907280012,3.8533188138216365,59.42900443849514,709.5899960123345,5281.91112291017,-5829.66483675846,-817.6293103748613,-76.91656988279972,-4.594269939176596,0.9063471690191471,0.1960342806591213,-0.15466694054279598,34.324387823855965,301.8067566458425,817.599602898885,11573.795901679885,1181.2520595540152,321.59731579894424,31.232021761053772,3.7107095756221318,53.650946155329365,684.167428119626,5224.56624370173,-6366.391851890084,-908.9766368219582,-89.83068876699639,-5.411397422890401,0.8206787908286602,0.3901806440322567,-0.16070888947830023,36.147034243915876,304.11815768187864,732.7429163887613,11989.60988270091,1300.012278487897,335.28490093152146,31.48816102859945,3.373875931311736,47.232241542899175,652.7371796173471,5132.414255594984,-6909.087078780055,-1001.9990371107289,-103.62185754286375,-6.104916304710272,0.7416505462720353,0.5805693545089249,-0.16636367662261495,37.751650073343995,303.01103387567713,627.9747488785183,12358.763425278165,1412.2779918482834,346.7496836825721,31.598286663170416,3.1598635433980946,40.57878626349686,616.1671130880391,5007.833007176154,-7454.040671756168,-1095.7960341867115,-118.24411666465777,-6.818469345853504,0.6681786379192989,0.7653668647301797,-0.1716176790982088,39.11551877123304,298.3413246578966,503.5259106886539,12679.589408408976,1516.5821921214542,355.9850766329023,31.395241710249053,2.9164211881972335,33.79716964664243,574.8943997801362,4853.234992253242,-7997.57021486075,-1189.7624067269965,-133.6444792601766,-7.7202770609839915,0.5993769336819237,0.9427934736519954,-0.17645823955292173,40.21879108166477,289.9982036694474,359.3226160751053,12950.259102786438,1612.1013903507662,362.85067106591504,31.045922092242872,2.822222032597987,26.988862316190684,529.8996541764288,4671.371946949588,-8535.899136645805,-1282.5898586244496,-149.58553632943463,-8.643494270763135,0.5345111359507916,1.111140466039205,-0.36174739330527045,41.04429910497807,277.5463268268618,195.6386023135583,13169.43812144731,1697.6433561479398,367.40983966190305,30.557037410382826,2.531473372857427,20.070154905927314,481.50208566532336,4464.970341588308,-9065.36882077239,-1373.62841526722,-166.1660487028118,-9.58289321133207,0.4729647758913199,1.268786568327291,-0.36970682634889585,41.393213350082036,261.2935935556502,12.935476055240873,13336.131683328815,1772.508612059496,369.76534388639965,29.751323653701338,2.4023193045459172,13.304795348228817,430.5615775526625,4237.0568611071185,-9581.931701634761,-1461.6913552409758,-183.12733958476446,-10.718010163869403,0.41421356237309503,1.414213562373095,-0.37677560326535325,41.619486213528496,241.05423794991074,-187.94665032361226,13450.063605744153,1836.153896465782,369.4908799925761,29.001847876923147,2.0714759319987186,6.779591200894186,377.7767837205709,3990.386575512536,-10081.709459700915,-1545.947424837898,-200.3762958015653,-11.864482073055006,0.3578057213145241,1.546020906725474,-0.3829366947518991,41.1516456456653,216.47684307105183,-406.1569483347166,13511.136535077321,1887.8076599260432,367.3025214564151,28.136213436723654,1.913880671464418,0.3829366947518991,323.85365704338597,3728.1472257487526,-10561.233882199509,-1625.2025997821418,-217.62525175416,-13.015432208941645,0.3033466836073424,1.66293922460509,-0.5822628872992417,40.35639251440489,188.20071124269245,-640.2706748618148,13519.21490106562,1927.6022433578062,362.8197642637487,26.968821921868447,1.7463817695935329,-5.62650678237171,269.3016715297017,3453.386536448852,-11016.145278780888,-1698.6569643425091,-234.7658734267683,-14.16351421663124,0.2504869601913055,1.76384252869671,-0.5887180101749253,39.23429103868072,155.76096234403798,-889.2492977967378,13475.470561874661,1955.0535223723712,356.4450994756727,25.894952980042156,1.5695032905781554,-11.181939564328772,214.80884394039484,3169.1640829158237,-11443.321309975563,-1765.1588461316153,-251.68908574481912,-15.49755935939164,0.198912367379658,1.847759065022573,-0.7912582233652842,37.39369355329111,119.699486012458,-1151.0956593239027,13380.446257078214,1970.3952110853447,348.01959814116185,24.731487364283044,1.3850130831637748,-16.421408865300393,161.05030052864092,2878.3322807850063,-11838.991423510031,-1823.985884688674,-268.2854986386903,-16.81724543849939,0.1483359875383474,1.913880671464418,-0.7960642926861912,35.2322109610459,80.01928065061526,-1424.0212633405113,13235.794061869668,1973.804052543835,337.9908651258184,23.289159354463873,1.3934255946442087,-21.099669467133474,108.48348407242611,2583.700758091299,-12199.726194855148,-1874.2780658979746,-284.2467154529415,-18.11369784385905,0.09849140335716425,1.961570560806461,-0.998795456205172,32.56307803611191,36.958364584370486,-1706.075448829146,13043.287458812016,1965.3831106103316,326.43182772364605,22.175018750622293,1.198638339011324,-25.371248002043963,57.53505923036915,2288.41886619975,-12522.674544337233,-1914.8400385312243,-299.26241273417224,-19.37805630698734,0.04912684976946725,1.990369453344394,0.035780907*d.SQRT2*0.5/0.000002384,0.017876148*d.SQRT2*0.5/0.000002384,0.003134727*d.SQRT2*0.5/0.000002384,0.002457142*d.SQRT2*0.5/0.000002384,0.000971317*d.SQRT2*0.5/0.000002384,0.000218868*d.SQRT2*0.5/0.000002384,0.000101566*d.SQRT2*0.5/0.000002384,0.000013828*d.SQRT2*0.5/0.000002384,12804.797818791945,1945.5515939597317,313.4244966442953,20.801593959731544,1995.1556208053692,9.000838926174497,-29.20218120805369],O=12,A=36,w=[[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.000000000000940084909404969,0.0000000000006423305872147839,0.0000000000002382191739347918,0.000000000005456116108943412,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758252,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558783,0.0000000000008371015190102974,0.0000000000002599706096327376,-0.000000000005456116108943412,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758252,-0.000000000002858043359288076,-0.000000000002156177623817898,-0.000000000001475637723558783,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347923,-0.0000000000006423305872147843,-0.0000000000009400849094049696,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049694,-0.000000000000642330587214784,-0.0000000000002382191739347918],[0.0000000000002382191739347913,0.0000000000006423305872147834,0.0000000000009400849094049688,0.000000000001122435026096556,0.000000000001183840321267481,0.000000000001122435026096556,0.0000000000009400849094049688,0.0000000000006423305872147841,0.0000000000002382191739347918,0.000000000005456116108943413,0.000000000004878985199565852,0.000000000004240448995017367,0.000000000003559909094758253,0.000000000002858043359288075,0.000000000002156177623817898,0.000000000001475637723558782,0.0000000000008371015190102975,0.0000000000002599706096327376,-0.000000000005461314069809755,-0.000000000004921085770524055,-0.000000000004343405037091838,-0.000000000003732668368707687,-0.000000000003093523840190885,-0.000000000002430835727329465,-0.000000000001734679010007751,-0.000000000000974825365660928,-0.0000000000002797435120168326,0,0,0,0,0,0,-0.0000000000002283748241799531,-0.0000000000004037858874020686,-0.0000000000002146547464825323],[0.1316524975873958,0.414213562373095,0.7673269879789602,1.091308501069271,1.303225372841206,1.56968557711749,1.920982126971166,2.414213562373094,3.171594802363212,4.510708503662055,7.595754112725146,22.90376554843115,0.984807753012208,0.6427876096865394,0.3420201433256688,0.9396926207859084,-0.1736481776669303,-0.7660444431189779,0.8660254037844387,0.5,-0.5144957554275265,-0.4717319685649723,-0.3133774542039019,-0.1819131996109812,-0.09457419252642064,-0.04096558288530405,-0.01419856857247115,-0.003699974673760037,0.8574929257125442,0.8817419973177052,0.9496286491027329,0.9833145924917901,0.9955178160675857,0.9991605581781475,0.999899195244447,0.9999931550702802],[0,0,0,0,0,0,0.0000000000002283748241799531,0.0000000000004037858874020686,0.0000000000002146547464825323,0.000000000005461314069809755,0.000000000004921085770524055,0.000000000004343405037091838,0.000000000003732668368707687,0.000000000003093523840190885,0.000000000002430835727329466,0.000000000001734679010007751,0.000000000000974825365660928,0.0000000000002797435120168326,-0.000000000005456116108943413,-0.000000000004878985199565852,-0.000000000004240448995017367,-0.000000000003559909094758253,-0.000000000002858043359288075,-0.000000000002156177623817898,-0.000000000001475637723558782,-0.0000000000008371015190102975,-0.0000000000002599706096327376,-0.0000000000002382191739347913,-0.0000000000006423305872147834,-0.0000000000009400849094049688,-0.000000000001122435026096556,-0.000000000001183840321267481,-0.000000000001122435026096556,-0.0000000000009400849094049688,-0.0000000000006423305872147841,-0.0000000000002382191739347918]],h=w[z.SHORT_TYPE],$=w[z.SHORT_TYPE],_=w[z.SHORT_TYPE],v=w[z.SHORT_TYPE],T=[0,1,16,17,8,9,24,25,4,5,20,21,12,13,28,29,2,3,18,19,10,11,26,27,6,7,22,23,14,15,30,31];function E(C,P,i){for(var a=10,Z=P+238-14-286,U=-15;U<0;U++){var x,F,L;x=j[a+-10],F=C[Z+-224]*x,L=C[P+224]*x,x=j[a+-9],F+=C[Z+-160]*x,L+=C[P+160]*x,x=j[a+-8],F+=C[Z+-96]*x,L+=C[P+96]*x,x=j[a+-7],F+=C[Z+-32]*x,L+=C[P+32]*x,x=j[a+-6],F+=C[Z+32]*x,L+=C[P+-32]*x,x=j[a+-5],F+=C[Z+96]*x,L+=C[P+-96]*x,x=j[a+-4],F+=C[Z+160]*x,L+=C[P+-160]*x,x=j[a+-3],F+=C[Z+224]*x,L+=C[P+-224]*x,x=j[a+-2],F+=C[P+-256]*x,L-=C[Z+256]*x,x=j[a+-1],F+=C[P+-192]*x,L-=C[Z+192]*x,x=j[a+0],F+=C[P+-128]*x,L-=C[Z+128]*x,x=j[a+1],F+=C[P+-64]*x,L-=C[Z+64]*x,x=j[a+2],F+=C[P+0]*x,L-=C[Z+0]*x,x=j[a+3],F+=C[P+64]*x,L-=C[Z+-64]*x,x=j[a+4],F+=C[P+128]*x,L-=C[Z+-128]*x,x=j[a+5],F+=C[P+192]*x,L-=C[Z+-192]*x,F*=j[a+6],x=L-F,i[30+U*2]=L+F,i[31+U*2]=j[a+7]*x,a+=18,P--,Z++}{var F,L,at,k;L=C[P+-16]*j[a+-10],F=C[P+-32]*j[a+-2],L+=(C[P+-48]-C[P+16])*j[a+-9],F+=C[P+-96]*j[a+-1],L+=(C[P+-80]+C[P+48])*j[a+-8],F+=C[P+-160]*j[a+0],L+=(C[P+-112]-C[P+80])*j[a+-7],F+=C[P+-224]*j[a+1],L+=(C[P+-144]+C[P+112])*j[a+-6],F-=C[P+32]*j[a+2],L+=(C[P+-176]-C[P+144])*j[a+-5],F-=C[P+96]*j[a+3],L+=(C[P+-208]+C[P+176])*j[a+-4],F-=C[P+160]*j[a+4],L+=(C[P+-240]-C[P+208])*j[a+-3],F-=C[P+224],at=F-L,k=F+L,L=i[14],F=i[15]-L,i[31]=k+L,i[30]=at+F,i[15]=at-F,i[14]=k-L}{var n;n=i[28]-i[0],i[0]+=i[28],i[28]=n*j[a+-36+7],n=i[29]-i[1],i[1]+=i[29],i[29]=n*j[a+-36+7],n=i[26]-i[2],i[2]+=i[26],i[26]=n*j[a+-72+7],n=i[27]-i[3],i[3]+=i[27],i[27]=n*j[a+-72+7],n=i[24]-i[4],i[4]+=i[24],i[24]=n*j[a+-108+7],n=i[25]-i[5],i[5]+=i[25],i[25]=n*j[a+-108+7],n=i[22]-i[6],i[6]+=i[22],i[22]=n*d.SQRT2,n=i[23]-i[7],i[7]+=i[23],i[23]=n*d.SQRT2-i[7],i[7]-=i[6],i[22]-=i[7],i[23]-=i[22],n=i[6],i[6]=i[31]-n,i[31]=i[31]+n,n=i[7],i[7]=i[30]-n,i[30]=i[30]+n,n=i[22],i[22]=i[15]-n,i[15]=i[15]+n,n=i[23],i[23]=i[14]-n,i[14]=i[14]+n,n=i[20]-i[8],i[8]+=i[20],i[20]=n*j[a+-180+7],n=i[21]-i[9],i[9]+=i[21],i[21]=n*j[a+-180+7],n=i[18]-i[10],i[10]+=i[18],i[18]=n*j[a+-216+7],n=i[19]-i[11],i[11]+=i[19],i[19]=n*j[a+-216+7],n=i[16]-i[12],i[12]+=i[16],i[16]=n*j[a+-252+7],n=i[17]-i[13],i[13]+=i[17],i[17]=n*j[a+-252+7],n=-i[20]+i[24],i[20]+=i[24],i[24]=n*j[a+-216+7],n=-i[21]+i[25],i[21]+=i[25],i[25]=n*j[a+-216+7],n=i[4]-i[8],i[4]+=i[8],i[8]=n*j[a+-216+7],n=i[5]-i[9],i[5]+=i[9],i[9]=n*j[a+-216+7],n=i[0]-i[12],i[0]+=i[12],i[12]=n*j[a+-72+7],n=i[1]-i[13],i[1]+=i[13],i[13]=n*j[a+-72+7],n=i[16]-i[28],i[16]+=i[28],i[28]=n*j[a+-72+7],n=-i[17]+i[29],i[17]+=i[29],i[29]=n*j[a+-72+7],n=d.SQRT2*(i[2]-i[10]),i[2]+=i[10],i[10]=n,n=d.SQRT2*(i[3]-i[11]),i[3]+=i[11],i[11]=n,n=d.SQRT2*(-i[18]+i[26]),i[18]+=i[26],i[26]=n-i[18],n=d.SQRT2*(-i[19]+i[27]),i[19]+=i[27],i[27]=n-i[19],n=i[2],i[19]-=i[3],i[3]-=n,i[2]=i[31]-n,i[31]+=n,n=i[3],i[11]-=i[19],i[18]-=n,i[3]=i[30]-n,i[30]+=n,n=i[18],i[27]-=i[11],i[19]-=n,i[18]=i[15]-n,i[15]+=n,n=i[19],i[10]-=n,i[19]=i[14]-n,i[14]+=n,n=i[10],i[11]-=n,i[10]=i[23]-n,i[23]+=n,n=i[11],i[26]-=n,i[11]=i[22]-n,i[22]+=n,n=i[26],i[27]-=n,i[26]=i[7]-n,i[7]+=n,n=i[27],i[27]=i[6]-n,i[6]+=n,n=d.SQRT2*(i[0]-i[4]),i[0]+=i[4],i[4]=n,n=d.SQRT2*(i[1]-i[5]),i[1]+=i[5],i[5]=n,n=d.SQRT2*(i[16]-i[20]),i[16]+=i[20],i[20]=n,n=d.SQRT2*(i[17]-i[21]),i[17]+=i[21],i[21]=n,n=-d.SQRT2*(i[8]-i[12]),i[8]+=i[12],i[12]=n-i[8],n=-d.SQRT2*(i[9]-i[13]),i[9]+=i[13],i[13]=n-i[9],n=-d.SQRT2*(i[25]-i[29]),i[25]+=i[29],i[29]=n-i[25],n=-d.SQRT2*(i[24]+i[28]),i[24]-=i[28],i[28]=n-i[24],n=i[24]-i[16],i[24]=n,n=i[20]-n,i[20]=n,n=i[28]-n,i[28]=n,n=i[25]-i[17],i[25]=n,n=i[21]-n,i[21]=n,n=i[29]-n,i[29]=n,n=i[17]-i[1],i[17]=n,n=i[9]-n,i[9]=n,n=i[25]-n,i[25]=n,n=i[5]-n,i[5]=n,n=i[21]-n,i[21]=n,n=i[13]-n,i[13]=n,n=i[29]-n,i[29]=n,n=i[1]-i[0],i[1]=n,n=i[16]-n,i[16]=n,n=i[17]-n,i[17]=n,n=i[8]-n,i[8]=n,n=i[9]-n,i[9]=n,n=i[24]-n,i[24]=n,n=i[25]-n,i[25]=n,n=i[4]-n,i[4]=n,n=i[5]-n,i[5]=n,n=i[20]-n,i[20]=n,n=i[21]-n,i[21]=n,n=i[12]-n,i[12]=n,n=i[13]-n,i[13]=n,n=i[28]-n,i[28]=n,n=i[29]-n,i[29]=n,n=i[0],i[0]+=i[31],i[31]-=n,n=i[1],i[1]+=i[30],i[30]-=n,n=i[16],i[16]+=i[15],i[15]-=n,n=i[17],i[17]+=i[14],i[14]-=n,n=i[8],i[8]+=i[23],i[23]-=n,n=i[9],i[9]+=i[22],i[22]-=n,n=i[24],i[24]+=i[7],i[7]-=n,n=i[25],i[25]+=i[6],i[6]-=n,n=i[4],i[4]+=i[27],i[27]-=n,n=i[5],i[5]+=i[26],i[26]-=n,n=i[20],i[20]+=i[11],i[11]-=n,n=i[21],i[21]+=i[10],i[10]-=n,n=i[12],i[12]+=i[19],i[19]-=n,n=i[13],i[13]+=i[18],i[18]-=n,n=i[28],i[28]+=i[3],i[3]-=n,n=i[29],i[29]+=i[2],i[2]-=n}}function D(C,P){for(var i=0;i<3;i++){var a,Z,U,x,F,L;x=C[P+6]*w[z.SHORT_TYPE][0]-C[P+15],a=C[P+0]*w[z.SHORT_TYPE][2]-C[P+9],Z=x+a,U=x-a,x=C[P+15]*w[z.SHORT_TYPE][0]+C[P+6],a=C[P+9]*w[z.SHORT_TYPE][2]+C[P+0],F=x+a,L=-x+a,a=(C[P+3]*w[z.SHORT_TYPE][1]-C[P+12])*0.00000000002069978111953089,x=(C[P+12]*w[z.SHORT_TYPE][1]+C[P+3])*0.00000000002069978111953089,C[P+0]=Z*0.0000000000190752519173728+a,C[P+15]=-F*0.0000000000190752519173728+x,U=U*0.8660254037844387*0.00000000001907525191737281,F=F*0.5*0.00000000001907525191737281+x,C[P+3]=U-F,C[P+6]=U+F,Z=Z*0.5*0.00000000001907525191737281-a,L=L*0.8660254037844387*0.00000000001907525191737281,C[P+9]=Z+L,C[P+12]=Z-L,P++}}function g(C,P,i){var a,Z;{var U,x,F,L,at,k,n,G;U=i[17]-i[9],F=i[15]-i[11],L=i[14]-i[12],at=i[0]+i[8],k=i[1]+i[7],n=i[2]+i[6],G=i[3]+i[5],C[P+17]=at+n-G-(k-i[4]),Z=(at+n-G)*$[19]+(k-i[4]),a=(U-F-L)*$[18],C[P+5]=a+Z,C[P+6]=a-Z,x=(i[16]-i[10])*$[18],k=k*$[19]+i[4],a=U*$[12]+x+F*$[13]+L*$[14],Z=-at*$[16]+k-n*$[17]+G*$[15],C[P+1]=a+Z,C[P+2]=a-Z,a=U*$[13]-x-F*$[14]+L*$[12],Z=-at*$[17]+k-n*$[15]+G*$[16],C[P+9]=a+Z,C[P+10]=a-Z,a=U*$[14]-x+F*$[12]-L*$[13],Z=at*$[15]-k+n*$[16]-G*$[17],C[P+13]=a+Z,C[P+14]=a-Z}{var K,V,q,it,Q,c,s,o;K=i[8]-i[0],q=i[6]-i[2],it=i[5]-i[3],Q=i[17]+i[9],c=i[16]+i[10],s=i[15]+i[11],o=i[14]+i[12],C[P+0]=Q+s+o+(c+i[13]),a=(Q+s+o)*$[19]-(c+i[13]),Z=(K-q+it)*$[18],C[P+11]=a+Z,C[P+12]=a-Z,V=(i[7]-i[1])*$[18],c=i[13]-c*$[19],a=Q*$[15]-c+s*$[16]+o*$[17],Z=K*$[14]+V+q*$[12]+it*$[13],C[P+3]=a+Z,C[P+4]=a-Z,a=-Q*$[17]+c-s*$[15]-o*$[16],Z=K*$[13]+V-q*$[14]-it*$[12],C[P+7]=a+Z,C[P+8]=a-Z,a=-Q*$[16]+c-s*$[17]-o*$[15],Z=K*$[12]-V+q*$[13]-it*$[14],C[P+15]=a+Z,C[P+16]=a-Z}}this.mdct_sub48=function(C,P,i){for(var a=P,Z=286,U=0;U<C.channels_out;U++){for(var x=0;x<C.mode_gr;x++){for(var F,L=C.l3_side.tt[x][U],at=L.xr,k=0,n=C.sb_sample[U][1-x],G=0,K=0;K<9;K++)for(E(a,Z,n[G]),E(a,Z+32,n[G+1]),G+=2,Z+=64,F=1;F<32;F+=2)n[G-1][F]*=-1;for(F=0;F<32;F++,k+=18){var V=L.block_type,q=C.sb_sample[U][x],it=C.sb_sample[U][1-x];if(L.mixed_block_flag!=0&&F<2&&(V=0),C.amp_filter[F]<0.000000000001)W.fill(at,k+0,k+18,0);else{if(C.amp_filter[F]<1)for(var K=0;K<18;K++)it[K][T[F]]*=C.amp_filter[F];if(V==z.SHORT_TYPE){for(var K=-O/4;K<0;K++){var Q=w[z.SHORT_TYPE][K+3];at[k+K*3+9]=q[9+K][T[F]]*Q-q[8-K][T[F]],at[k+K*3+18]=q[14-K][T[F]]*Q+q[15+K][T[F]],at[k+K*3+10]=q[15+K][T[F]]*Q-q[14-K][T[F]],at[k+K*3+19]=it[2-K][T[F]]*Q+it[3+K][T[F]],at[k+K*3+11]=it[3+K][T[F]]*Q-it[2-K][T[F]],at[k+K*3+20]=it[8-K][T[F]]*Q+it[9+K][T[F]]}D(at,k)}else{for(var c=b(18),K=-A/4;K<0;K++){var s,o;s=w[V][K+27]*it[K+9][T[F]]+w[V][K+36]*it[8-K][T[F]],o=w[V][K+9]*q[K+9][T[F]]-w[V][K+18]*q[8-K][T[F]],c[K+9]=s-o*h[3+K+9],c[K+18]=s*h[3+K+9]+o}g(at,k,c)}}if(V!=z.SHORT_TYPE&&F!=0)for(var K=7;K>=0;--K){var l,f;l=at[k+K]*_[20+K]+at[k+-1-K]*v[28+K],f=at[k+K]*v[28+K]-at[k+-1-K]*_[20+K],at[k+-1-K]=l,at[k+K]=f}}}if(a=i,Z=286,C.mode_gr==1)for(var I=0;I<18;I++)r.arraycopy(C.sb_sample[U][1][I],0,C.sb_sample[U][0][I],0,32)}}}return Kn=X,Kn}var Un,ko;function oe(){if(ko)return Un;ko=1;var t=ei(),r=Ht,d=r.System,W=r.new_float,b=r.new_float_n;function z(){this.l=W(t.SBMAX_l),this.s=b([t.SBMAX_s,3]);var X=this;this.assign=function(j){d.arraycopy(j.l,0,X.l,0,t.SBMAX_l);for(var O=0;O<t.SBMAX_s;O++)for(var A=0;A<3;A++)X.s[O][A]=j.s[O][A]}}return Un=z,Un}var qn,Jo;function Be(){if(Jo)return qn;Jo=1;var t=oe();function r(){this.thm=new t,this.en=new t}return qn=r,qn}function ki(t){var r=t;this.ordinal=function(){return r}}ki.STEREO=new ki(0);ki.JOINT_STEREO=new ki(1);ki.DUAL_CHANNEL=new ki(2);ki.MONO=new ki(3);ki.NOT_SET=new ki(4);var ln=ki,On,Go;function ei(){if(Go)return On;Go=1;var t=Ht,r=t.System,d=t.VbrMode,W=t.new_array_n,b=t.new_float,z=t.new_float_n,X=t.new_int,j=t.assert;O.ENCDELAY=576,O.POSTDELAY=1152,O.MDCTDELAY=48,O.FFTOFFSET=224+O.MDCTDELAY,O.DECDELAY=528,O.SBLIMIT=32,O.CBANDS=64,O.SBPSY_l=21,O.SBPSY_s=12,O.SBMAX_l=22,O.SBMAX_s=13,O.PSFB21=6,O.PSFB12=6,O.BLKSIZE=1024,O.HBLKSIZE=O.BLKSIZE/2+1,O.BLKSIZE_s=256,O.HBLKSIZE_s=O.BLKSIZE_s/2+1,O.NORM_TYPE=0,O.START_TYPE=1,O.SHORT_TYPE=2,O.STOP_TYPE=3,O.MPG_MD_LR_LR=0,O.MPG_MD_LR_I=1,O.MPG_MD_MS_LR=2,O.MPG_MD_MS_I=3,O.fircoef=[-0.1039435,-0.1892065,-0.21623599999999998,-0.155915,0.00000000000000003898045,0.23387249999999998,0.50455,0.756825,0.9354899999999999];function O(){var A=_e(),w=Be(),h=ln,$=O.FFTOFFSET,_=O.MPG_MD_MS_LR,v=null;this.psy=null;var T=null,E=null,D=null;this.setModules=function(a,Z,U,x){v=a,this.psy=Z,T=Z,E=x,D=U};var g=new A;function C(a){var Z,U;if(a.ATH.useAdjust==0){a.ATH.adjust=1;return}if(U=a.loudness_sq[0][0],Z=a.loudness_sq[1][0],a.channels_out==2?(U+=a.loudness_sq[0][1],Z+=a.loudness_sq[1][1]):(U+=U,Z+=Z),a.mode_gr==2&&(U=Math.max(U,Z)),U*=0.5,U*=a.ATH.aaSensitivityP,U>0.03125)a.ATH.adjust>=1?a.ATH.adjust=1:a.ATH.adjust<a.ATH.adjustLimit&&(a.ATH.adjust=a.ATH.adjustLimit),a.ATH.adjustLimit=1;else{var x=31.98*U+0.000625;a.ATH.adjust>=x?(a.ATH.adjust*=x*0.075+0.925,a.ATH.adjust<x&&(a.ATH.adjust=x)):a.ATH.adjustLimit>=x?a.ATH.adjust=x:a.ATH.adjust<a.ATH.adjustLimit&&(a.ATH.adjust=a.ATH.adjustLimit),a.ATH.adjustLimit=x}}function P(a){var Z,U;for(j(0<=a.bitrate_index&&a.bitrate_index<16),j(0<=a.mode_ext&&a.mode_ext<4),a.bitrate_stereoMode_Hist[a.bitrate_index][4]++,a.bitrate_stereoMode_Hist[15][4]++,a.channels_out==2&&(a.bitrate_stereoMode_Hist[a.bitrate_index][a.mode_ext]++,a.bitrate_stereoMode_Hist[15][a.mode_ext]++),Z=0;Z<a.mode_gr;++Z)for(U=0;U<a.channels_out;++U){var x=a.l3_side.tt[Z][U].block_type|0;a.l3_side.tt[Z][U].mixed_block_flag!=0&&(x=4),a.bitrate_blockType_Hist[a.bitrate_index][x]++,a.bitrate_blockType_Hist[a.bitrate_index][5]++,a.bitrate_blockType_Hist[15][x]++,a.bitrate_blockType_Hist[15][5]++}}function i(a,Z){var U=a.internal_flags,x,F;if(U.lame_encode_frame_init==0){var L,at,k=b(2014),n=b(2014);for(U.lame_encode_frame_init=1,L=0,at=0;L<286+576*(1+U.mode_gr);++L)L<576*U.mode_gr?(k[L]=0,U.channels_out==2&&(n[L]=0)):(k[L]=Z[0][at],U.channels_out==2&&(n[L]=Z[1][at]),++at);for(F=0;F<U.mode_gr;F++)for(x=0;x<U.channels_out;x++)U.l3_side.tt[F][x].block_type=O.SHORT_TYPE;g.mdct_sub48(U,k,n),j(576>=O.FFTOFFSET),j(U.mf_size>=O.BLKSIZE+a.framesize-O.FFTOFFSET),j(U.mf_size>=512+a.framesize-32)}}this.lame_encode_mp3_frame=function(a,Z,U,x,F,L){var at,k=W([2,2]);k[0][0]=new w,k[0][1]=new w,k[1][0]=new w,k[1][1]=new w;var n=W([2,2]);n[0][0]=new w,n[0][1]=new w,n[1][0]=new w,n[1][1]=new w;var G,K=[null,null],V=a.internal_flags,q=z([2,4]),it=[0.5,0.5],Q=[[0,0],[0,0]],c=[[0,0],[0,0]],s,o,l;if(K[0]=Z,K[1]=U,V.lame_encode_frame_init==0&&i(a,K),V.padding=0,(V.slot_lag-=V.frac_SpF)<0&&(V.slot_lag+=a.out_samplerate,V.padding=1),V.psymodel!=0){var f,I=[null,null],ot=0,y=X(2);for(l=0;l<V.mode_gr;l++){for(o=0;o<V.channels_out;o++)I[o]=K[o],ot=576+l*576-O.FFTOFFSET;if(a.VBR==d.vbr_mtrh||a.VBR==d.vbr_mt?f=T.L3psycho_anal_vbr(a,I,ot,l,k,n,Q[l],c[l],q[l],y):f=T.L3psycho_anal_ns(a,I,ot,l,k,n,Q[l],c[l],q[l],y),f!=0)return-4;for(a.mode==h.JOINT_STEREO&&(it[l]=q[l][2]+q[l][3],it[l]>0&&(it[l]=q[l][3]/it[l])),o=0;o<V.channels_out;o++){var B=V.l3_side.tt[l][o];B.block_type=y[o],B.mixed_block_flag=0}}}else for(l=0;l<V.mode_gr;l++)for(o=0;o<V.channels_out;o++)V.l3_side.tt[l][o].block_type=O.NORM_TYPE,V.l3_side.tt[l][o].mixed_block_flag=0,c[l][o]=Q[l][o]=700;if(C(V),g.mdct_sub48(V,K[0],K[1]),V.mode_ext=O.MPG_MD_LR_LR,a.force_ms)V.mode_ext=O.MPG_MD_MS_LR;else if(a.mode==h.JOINT_STEREO){var dt=0,gt=0;for(l=0;l<V.mode_gr;l++)for(o=0;o<V.channels_out;o++)dt+=c[l][o],gt+=Q[l][o];if(dt<=1*gt){var ft=V.l3_side.tt[0],Dt=V.l3_side.tt[V.mode_gr-1];ft[0].block_type==ft[1].block_type&&Dt[0].block_type==Dt[1].block_type&&(V.mode_ext=O.MPG_MD_MS_LR)}}if(V.mode_ext==_?(G=n,s=c):(G=k,s=Q),a.analysis&&V.pinfo!=null)for(l=0;l<V.mode_gr;l++)for(o=0;o<V.channels_out;o++)V.pinfo.ms_ratio[l]=V.ms_ratio[l],V.pinfo.ms_ener_ratio[l]=it[l],V.pinfo.blocktype[l][o]=V.l3_side.tt[l][o].block_type,V.pinfo.pe[l][o]=s[l][o],r.arraycopy(V.l3_side.tt[l][o].xr,0,V.pinfo.xr[l][o],0,576),V.mode_ext==_&&(V.pinfo.ers[l][o]=V.pinfo.ers[l][o+2],r.arraycopy(V.pinfo.energy[l][o+2],0,V.pinfo.energy[l][o],0,V.pinfo.energy[l][o].length));if(a.VBR==d.vbr_off||a.VBR==d.vbr_abr){var Pt,Wt;for(Pt=0;Pt<18;Pt++)V.nsPsy.pefirbuf[Pt]=V.nsPsy.pefirbuf[Pt+1];for(Wt=0,l=0;l<V.mode_gr;l++)for(o=0;o<V.channels_out;o++)Wt+=s[l][o];for(V.nsPsy.pefirbuf[18]=Wt,Wt=V.nsPsy.pefirbuf[9],Pt=0;Pt<9;Pt++)Wt+=(V.nsPsy.pefirbuf[Pt]+V.nsPsy.pefirbuf[18-Pt])*O.fircoef[Pt];for(Wt=3350*V.mode_gr*V.channels_out/Wt,l=0;l<V.mode_gr;l++)for(o=0;o<V.channels_out;o++)s[l][o]*=Wt}if(V.iteration_loop.iteration_loop(a,s,it,G),v.format_bitstream(a),at=v.copy_buffer(V,x,F,L,1),a.bWriteVbrTag&&E.addVbrFrame(a),a.analysis&&V.pinfo!=null){for(o=0;o<V.channels_out;o++){var Zt;for(Zt=0;Zt<$;Zt++)V.pinfo.pcmdata[o][Zt]=V.pinfo.pcmdata[o][Zt+a.framesize];for(Zt=$;Zt<1600;Zt++)V.pinfo.pcmdata[o][Zt]=K[o][Zt-$]}D.set_frame_pinfo(a,G)}return P(V),at}}return On=O,On}var ee=Ht,Yo=ee.Util,zo=ee.new_float,At=ei();function Re(){var t=zo(At.BLKSIZE),r=zo(At.BLKSIZE_s/2),d=[0.9238795325112867,0.3826834323650898,0.9951847266721969,0.0980171403295606,0.9996988186962042,0.02454122852291229,0.9999811752826011,0.006135884649154475];function W(z,X,j){var O=0,A,w,h;j<<=1;var $=X+j;A=4;do{var _,v,T,E,D,g,C;C=A>>1,E=A,D=A<<1,g=D+E,A=D<<1,w=X,h=w+C;do{var P,i,a,Z;i=z[w+0]-z[w+E],P=z[w+0]+z[w+E],Z=z[w+D]-z[w+g],a=z[w+D]+z[w+g],z[w+D]=P-a,z[w+0]=P+a,z[w+g]=i-Z,z[w+E]=i+Z,i=z[h+0]-z[h+E],P=z[h+0]+z[h+E],Z=Yo.SQRT2*z[h+g],a=Yo.SQRT2*z[h+D],z[h+D]=P-a,z[h+0]=P+a,z[h+g]=i-Z,z[h+E]=i+Z,h+=A,w+=A}while(w<$);for(v=d[O+0],_=d[O+1],T=1;T<C;T++){var U,x;U=1-2*_*_,x=2*_*v,w=X+T,h=X+E-T;do{var F,L,at,P,i,k,a,n,Z,G;L=x*z[w+E]-U*z[h+E],F=U*z[w+E]+x*z[h+E],i=z[w+0]-F,P=z[w+0]+F,k=z[h+0]-L,at=z[h+0]+L,L=x*z[w+g]-U*z[h+g],F=U*z[w+g]+x*z[h+g],Z=z[w+D]-F,a=z[w+D]+F,G=z[h+D]-L,n=z[h+D]+L,L=_*a-v*G,F=v*a+_*G,z[w+D]=P-F,z[w+0]=P+F,z[h+g]=k-L,z[h+E]=k+L,L=v*n-_*Z,F=_*n+v*Z,z[h+D]=at-F,z[h+0]=at+F,z[w+g]=i-L,z[w+E]=i+L,h+=A,w+=A}while(w<$);U=v,v=U*d[O+0]-_*d[O+1],_=U*d[O+1]+_*d[O+0]}O+=2}while(A<j)}var b=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254];this.fft_short=function(z,X,j,O,A){for(var w=0;w<3;w++){var h=At.BLKSIZE_s/2,$=65535&192*(w+1),_=At.BLKSIZE_s/8-1;do{var v,T,E,D,g,C=b[_<<2]&255;v=r[C]*O[j][A+C+$],g=r[127-C]*O[j][A+C+$+128],T=v-g,v=v+g,E=r[C+64]*O[j][A+C+$+64],g=r[63-C]*O[j][A+C+$+192],D=E-g,E=E+g,h-=4,X[w][h+0]=v+E,X[w][h+2]=v-E,X[w][h+1]=T+D,X[w][h+3]=T-D,v=r[C+1]*O[j][A+C+$+1],g=r[126-C]*O[j][A+C+$+129],T=v-g,v=v+g,E=r[C+65]*O[j][A+C+$+65],g=r[62-C]*O[j][A+C+$+193],D=E-g,E=E+g,X[w][h+At.BLKSIZE_s/2+0]=v+E,X[w][h+At.BLKSIZE_s/2+2]=v-E,X[w][h+At.BLKSIZE_s/2+1]=T+D,X[w][h+At.BLKSIZE_s/2+3]=T-D}while(--_>=0);W(X[w],h,At.BLKSIZE_s/2)}},this.fft_long=function(z,X,j,O,A){var w=At.BLKSIZE/8-1,h=At.BLKSIZE/2;do{var $,_,v,T,E,D=b[w]&255;$=t[D]*O[j][A+D],E=t[D+512]*O[j][A+D+512],_=$-E,$=$+E,v=t[D+256]*O[j][A+D+256],E=t[D+768]*O[j][A+D+768],T=v-E,v=v+E,h-=4,X[h+0]=$+v,X[h+2]=$-v,X[h+1]=_+T,X[h+3]=_-T,$=t[D+1]*O[j][A+D+1],E=t[D+513]*O[j][A+D+513],_=$-E,$=$+E,v=t[D+257]*O[j][A+D+257],E=t[D+769]*O[j][A+D+769],T=v-E,v=v+E,X[h+At.BLKSIZE/2+0]=$+v,X[h+At.BLKSIZE/2+2]=$-v,X[h+At.BLKSIZE/2+1]=_+T,X[h+At.BLKSIZE/2+3]=_-T}while(--w>=0);W(X,h,At.BLKSIZE/2)},this.init_fft=function(z){for(var X=0;X<At.BLKSIZE;X++)t[X]=0.42-0.5*Math.cos(2*Math.PI*(X+0.5)/At.BLKSIZE)+0.08*Math.cos(4*Math.PI*(X+0.5)/At.BLKSIZE);for(var X=0;X<At.BLKSIZE_s/2;X++)r[X]=0.5*(1-Math.cos(2*Math.PI*(X+0.5)/At.BLKSIZE_s))}}var Ae=Re,Qi=Ht,Ti=Qi.VbrMode,Zo=Qi.Float,Ni=Qi.ShortBlock,hi=Qi.Util,tr=Qi.Arrays,ti=Qi.new_float,wi=Qi.new_float_n,Ki=Qi.new_int,Lt=Qi.assert,ir=Ae,st=ei();function nr(){var t=ln,r=new ir,d=2.302585092994046,W=2,b=16,z=2,X=16,j=0.34,O=0.000000004595134127921476/(st.BLKSIZE/2),A=0.01,w=0.8,h=0.6,$=0.3,_=3.5,v=21,T=0.2302585093;function E(u){return u}function D(u,m){for(var Y=0,M=0;M<st.BLKSIZE/2;++M)Y+=u[M]*m.ATH.eql_w[M];return Y*=O,Y}function g(u,m,Y,M,H,J,N,R,S,et,tt){var rt=u.internal_flags;if(S<2)r.fft_long(rt,M[H],S,et,tt),r.fft_short(rt,J[N],S,et,tt);else if(S==2){for(var ut=st.BLKSIZE-1;ut>=0;--ut){var Qt=M[H+0][ut],ht=M[H+1][ut];M[H+0][ut]=(Qt+ht)*hi.SQRT2*0.5,M[H+1][ut]=(Qt-ht)*hi.SQRT2*0.5}for(var $t=2;$t>=0;--$t)for(var ut=st.BLKSIZE_s-1;ut>=0;--ut){var Qt=J[N+0][$t][ut],ht=J[N+1][$t][ut];J[N+0][$t][ut]=(Qt+ht)*hi.SQRT2*0.5,J[N+1][$t][ut]=(Qt-ht)*hi.SQRT2*0.5}}m[0]=M[H+0][0],m[0]*=m[0];for(var ut=st.BLKSIZE/2-1;ut>=0;--ut){var nt=M[H+0][st.BLKSIZE/2-ut],kt=M[H+0][st.BLKSIZE/2+ut];m[st.BLKSIZE/2-ut]=(nt*nt+kt*kt)*0.5}for(var $t=2;$t>=0;--$t){Y[$t][0]=J[N+0][$t][0],Y[$t][0]*=Y[$t][0];for(var ut=st.BLKSIZE_s/2-1;ut>=0;--ut){var nt=J[N+0][$t][st.BLKSIZE_s/2-ut],kt=J[N+0][$t][st.BLKSIZE_s/2+ut];Y[$t][st.BLKSIZE_s/2-ut]=(nt*nt+kt*kt)*0.5}}{for(var Ut=0,ut=11;ut<st.HBLKSIZE;ut++)Ut+=m[ut];rt.tot_ener[S]=Ut}if(u.analysis){for(var ut=0;ut<st.HBLKSIZE;ut++)rt.pinfo.energy[R][S][ut]=rt.pinfo.energy_save[S][ut],rt.pinfo.energy_save[S][ut]=m[ut];rt.pinfo.pe[R][S]=rt.pe[S]}u.athaa_loudapprox==2&&S<2&&(rt.loudness_sq[R][S]=rt.loudness_sq_save[S],rt.loudness_sq_save[S]=D(m,rt))}var C=8,P=23,i=15,a,Z,U,x=[1,0.79433,0.63096,0.63096,0.63096,0.63096,0.63096,0.25119,0.11749];function F(){a=Math.pow(10,(C+1)/16),Z=Math.pow(10,(P+1)/16),U=Math.pow(10,i/10)}var L=[11.052965160000001,10.487040256900002,9.9500500969,9.0247369744,8.1854926609,7.0440875649,6.061887168099999,5.2166559999999995,4.4892710641,3.8632688703999998,3.3246052225000002,2.8610369315999997,2.4621061921,2.1508568964,1.8789281476000002,1.7170433295999998,1.5691069696,1.4555939904,1.3503137208999998,1.2715945225,1.1974487183999998,1.1361428100000002,1.0779838276,1.0382591025,1],at=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1],k=[5.5396212496,5.255968908100001,4.9868695969,4.523065562499999,4.102447702500001,3.5304155236000003,3.0381535809000004,2.6145273025000004,2.2499700001,1.9362165904000002,1.6662420888999998,1.4339104515999999,1.2339655056,1.0779838276];function n(u,m,Y,M,H,J){var N;if(m>u)if(m<u*Z)N=m/u;else return u+m;else{if(u>=m*Z)return u+m;N=u/m}if(u+=m,M+3<=6){if(N>=a)return u;var R=0|hi.FAST_LOG10_X(N,16);return u*at[R]}var R=0|hi.FAST_LOG10_X(N,16);if(J!=0?m=H.ATH.cb_s[Y]*H.ATH.adjust:m=H.ATH.cb_l[Y]*H.ATH.adjust,u<U*m){if(u>m){var S,et;return S=1,R<=13&&(S=k[R]),et=hi.FAST_LOG10_X(u/m,0.6666666666666666),u*((L[R]-S)*et+S)}return R>13?u:u*k[R]}return u*L[R]}var G=[1.7782755904,1.8463102640999998,1.9169510116000004,1.9459413009000002,1.9753740304000003,1.8325036899999998,1.6999465924,1.4962427040999997,1.3169398564,1];function K(u,m,Y){var M;if(u<0&&(u=0),m<0&&(m=0),u<=0)return m;if(m<=0)return u;if(m>u?M=m/u:M=u/m,-2<=Y&&Y<=2){if(M>=a)return u+m;var H=0|hi.FAST_LOG10_X(M,16);return(u+m)*G[H]}return M<Z?u+m:(u<m&&(u=m),u)}function V(u,m){var Y=u.internal_flags;if(Y.channels_out>1){for(var M=0;M<st.SBMAX_l;M++){var H=Y.thm[0].l[M],J=Y.thm[1].l[M];Y.thm[0].l[M]+=J*m,Y.thm[1].l[M]+=H*m}for(var M=0;M<st.SBMAX_s;M++)for(var N=0;N<3;N++){var H=Y.thm[0].s[M][N],J=Y.thm[1].s[M][N];Y.thm[0].s[M][N]+=J*m,Y.thm[1].s[M][N]+=H*m}}}function q(u){for(var m=0;m<st.SBMAX_l;m++)if(!(u.thm[0].l[m]>1.58*u.thm[1].l[m]||u.thm[1].l[m]>1.58*u.thm[0].l[m])){var Y=u.mld_l[m]*u.en[3].l[m],M=Math.max(u.thm[2].l[m],Math.min(u.thm[3].l[m],Y));Y=u.mld_l[m]*u.en[2].l[m];var H=Math.max(u.thm[3].l[m],Math.min(u.thm[2].l[m],Y));u.thm[2].l[m]=M,u.thm[3].l[m]=H}for(var m=0;m<st.SBMAX_s;m++)for(var J=0;J<3;J++)if(!(u.thm[0].s[m][J]>1.58*u.thm[1].s[m][J]||u.thm[1].s[m][J]>1.58*u.thm[0].s[m][J])){var Y=u.mld_s[m]*u.en[3].s[m][J],M=Math.max(u.thm[2].s[m][J],Math.min(u.thm[3].s[m][J],Y));Y=u.mld_s[m]*u.en[2].s[m][J];var H=Math.max(u.thm[3].s[m][J],Math.min(u.thm[2].s[m][J],Y));u.thm[2].s[m][J]=M,u.thm[3].s[m][J]=H}}function it(u,m,Y){var M=m,H=Math.pow(10,Y);m*=2,M*=2;for(var J=0;J<st.SBMAX_l;J++){var N,R,S,et;if(et=u.ATH.cb_l[u.bm_l[J]]*H,N=Math.min(Math.max(u.thm[0].l[J],et),Math.max(u.thm[1].l[J],et)),R=Math.max(u.thm[2].l[J],et),S=Math.max(u.thm[3].l[J],et),N*m<R+S){var tt=N*M/(R+S);R*=tt,S*=tt}u.thm[2].l[J]=Math.min(R,u.thm[2].l[J]),u.thm[3].l[J]=Math.min(S,u.thm[3].l[J])}H*=st.BLKSIZE_s/st.BLKSIZE;for(var J=0;J<st.SBMAX_s;J++)for(var rt=0;rt<3;rt++){var N,R,S,et;if(et=u.ATH.cb_s[u.bm_s[J]]*H,N=Math.min(Math.max(u.thm[0].s[J][rt],et),Math.max(u.thm[1].s[J][rt],et)),R=Math.max(u.thm[2].s[J][rt],et),S=Math.max(u.thm[3].s[J][rt],et),N*m<R+S){var tt=N*m/(R+S);R*=tt,S*=tt}u.thm[2].s[J][rt]=Math.min(u.thm[2].s[J][rt],R),u.thm[3].s[J][rt]=Math.min(u.thm[3].s[J][rt],S)}}function Q(u,m,Y,M,H){var J,N,R=0,S=0;for(J=N=0;J<st.SBMAX_s;++N,++J){for(var et=u.bo_s[J],tt=u.npart_s,rt=et<tt?et:tt;N<rt;)Lt(m[N]>=0),Lt(Y[N]>=0),R+=m[N],S+=Y[N],N++;if(u.en[M].s[J][H]=R,u.thm[M].s[J][H]=S,N>=tt){++J;break}Lt(m[N]>=0),Lt(Y[N]>=0);{var ut=u.PSY.bo_s_weight[J],Qt=1-ut;R=ut*m[N],S=ut*Y[N],u.en[M].s[J][H]+=R,u.thm[M].s[J][H]+=S,R=Qt*m[N],S=Qt*Y[N]}}for(;J<st.SBMAX_s;++J)u.en[M].s[J][H]=0,u.thm[M].s[J][H]=0}function c(u,m,Y,M){var H,J,N=0,R=0;for(H=J=0;H<st.SBMAX_l;++J,++H){for(var S=u.bo_l[H],et=u.npart_l,tt=S<et?S:et;J<tt;)Lt(m[J]>=0),Lt(Y[J]>=0),N+=m[J],R+=Y[J],J++;if(u.en[M].l[H]=N,u.thm[M].l[H]=R,J>=et){++H;break}Lt(m[J]>=0),Lt(Y[J]>=0);{var rt=u.PSY.bo_l_weight[H],ut=1-rt;N=rt*m[J],R=rt*Y[J],u.en[M].l[H]+=N,u.thm[M].l[H]+=R,N=ut*m[J],R=ut*Y[J]}}for(;H<st.SBMAX_l;++H)u.en[M].l[H]=0,u.thm[M].l[H]=0}function s(u,m,Y,M,H,J){var N=u.internal_flags,R,S;for(S=R=0;S<N.npart_s;++S){for(var et=0,tt=N.numlines_s[S],rt=0;rt<tt;++rt,++R){var ut=m[J][R];et+=ut}Y[S]=et}for(Lt(S==N.npart_s),R=S=0;S<N.npart_s;S++){var Qt=N.s3ind_s[S][0],ht=N.s3_ss[R++]*Y[Qt];for(++Qt;Qt<=N.s3ind_s[S][1];)ht+=N.s3_ss[R]*Y[Qt],++R,++Qt;{var $t=z*N.nb_s1[H][S];M[S]=Math.min(ht,$t)}if(N.blocktype_old[H&1]==st.SHORT_TYPE){var $t=X*N.nb_s2[H][S],nt=M[S];M[S]=Math.min($t,nt)}N.nb_s2[H][S]=N.nb_s1[H][S],N.nb_s1[H][S]=ht,Lt(M[S]>=0)}for(;S<=st.CBANDS;++S)Y[S]=0,M[S]=0}function o(u,m,Y,M){var H=u.internal_flags;u.short_blocks==Ni.short_block_coupled&&!(m[0]!=0&&m[1]!=0)&&(m[0]=m[1]=0);for(var J=0;J<H.channels_out;J++)M[J]=st.NORM_TYPE,u.short_blocks==Ni.short_block_dispensed&&(m[J]=1),u.short_blocks==Ni.short_block_forced&&(m[J]=0),m[J]!=0?(Lt(H.blocktype_old[J]!=st.START_TYPE),H.blocktype_old[J]==st.SHORT_TYPE&&(M[J]=st.STOP_TYPE)):(M[J]=st.SHORT_TYPE,H.blocktype_old[J]==st.NORM_TYPE&&(H.blocktype_old[J]=st.START_TYPE),H.blocktype_old[J]==st.STOP_TYPE&&(H.blocktype_old[J]=st.SHORT_TYPE)),Y[J]=H.blocktype_old[J],H.blocktype_old[J]=M[J]}function l(u,m,Y){return Y>=1?u:Y<=0?m:m>0?Math.pow(u/m,Y)*m:0}var f=[11.8,13.6,17.2,32,46.5,51.3,57.5,67.1,71.5,84.6,97.6,130];function I(u,m){for(var Y=309.07,M=0;M<st.SBMAX_s-1;M++)for(var H=0;H<3;H++){var J=u.thm.s[M][H];if(J>0){var N=J*m,R=u.en.s[M][H];R>N&&(R>N*10000000000?Y+=f[M]*(10*d):Y+=f[M]*hi.FAST_LOG10(R/N))}}return Y}var ot=[6.8,5.8,5.8,6.4,6.5,9.9,12.1,14.4,15,18.9,21.6,26.9,34.2,40.2,46.8,56.5,60.7,73.9,85.7,93.4,126.1];function y(u,m){for(var Y=281.0575,M=0;M<st.SBMAX_l-1;M++){var H=u.thm.l[M];if(H>0){var J=H*m,N=u.en.l[M];N>J&&(N>J*10000000000?Y+=ot[M]*(10*d):Y+=ot[M]*hi.FAST_LOG10(N/J))}}return Y}function B(u,m,Y,M,H){var J,N;for(J=N=0;J<u.npart_l;++J){var R=0,S=0,et;for(et=0;et<u.numlines_l[J];++et,++N){var tt=m[N];R+=tt,S<tt&&(S=tt)}Y[J]=R,M[J]=S,H[J]=R*u.rnumlines_l[J],Lt(u.rnumlines_l[J]>=0),Lt(Y[J]>=0),Lt(M[J]>=0),Lt(H[J]>=0)}}function dt(u,m,Y,M){var H=x.length-1,J=0,N=Y[J]+Y[J+1];if(N>0){var R=m[J];R<m[J+1]&&(R=m[J+1]),Lt(u.numlines_l[J]+u.numlines_l[J+1]-1>0),N=20*(R*2-N)/(N*(u.numlines_l[J]+u.numlines_l[J+1]-1));var S=0|N;S>H&&(S=H),M[J]=S}else M[J]=0;for(J=1;J<u.npart_l-1;J++)if(N=Y[J-1]+Y[J]+Y[J+1],N>0){var R=m[J-1];R<m[J]&&(R=m[J]),R<m[J+1]&&(R=m[J+1]),Lt(u.numlines_l[J-1]+u.numlines_l[J]+u.numlines_l[J+1]-1>0),N=20*(R*3-N)/(N*(u.numlines_l[J-1]+u.numlines_l[J]+u.numlines_l[J+1]-1));var S=0|N;S>H&&(S=H),M[J]=S}else M[J]=0;if(Lt(J==u.npart_l-1),N=Y[J-1]+Y[J],N>0){var R=m[J-1];R<m[J]&&(R=m[J]),Lt(u.numlines_l[J-1]+u.numlines_l[J]-1>0),N=20*(R*2-N)/(N*(u.numlines_l[J-1]+u.numlines_l[J]-1));var S=0|N;S>H&&(S=H),M[J]=S}else M[J]=0;Lt(J==u.npart_l-1)}var gt=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];this.L3psycho_anal_ns=function(u,m,Y,M,H,J,N,R,S,et){var tt=u.internal_flags,rt=wi([2,st.BLKSIZE]),ut=wi([2,3,st.BLKSIZE_s]),Qt=ti(st.CBANDS+1),ht=ti(st.CBANDS+1),$t=ti(st.CBANDS+2),nt=Ki(2),kt=Ki(2),Ut,ct,Gt,lt,Ft,Tt,wt,Mt,qt=wi([2,576]),Nt,ai=Ki(st.CBANDS+2),Rt=Ki(st.CBANDS+2);for(tr.fill(Rt,0),Ut=tt.channels_out,u.mode==t.JOINT_STEREO&&(Ut=4),u.VBR==Ti.vbr_off?Nt=tt.ResvMax==0?0:tt.ResvSize/tt.ResvMax*0.5:u.VBR==Ti.vbr_rh||u.VBR==Ti.vbr_mtrh||u.VBR==Ti.vbr_mt?Nt=0.6:Nt=1,ct=0;ct<tt.channels_out;ct++){var St=m[ct],si=Y+576-350-v+192;for(lt=0;lt<576;lt++){var pi,gi;for(pi=St[si+lt+10],gi=0,Ft=0;Ft<(v-1)/2-1;Ft+=2)pi+=gt[Ft]*(St[si+lt+Ft]+St[si+lt+v-Ft]),gi+=gt[Ft+1]*(St[si+lt+Ft+1]+St[si+lt+v-Ft-1]);qt[ct][lt]=pi+gi}H[M][ct].en.assign(tt.en[ct]),H[M][ct].thm.assign(tt.thm[ct]),Ut>2&&(J[M][ct].en.assign(tt.en[ct+2]),J[M][ct].thm.assign(tt.thm[ct+2]))}for(ct=0;ct<Ut;ct++){var fi,Wi,oi=ti(12),Yi=[0,0,0,0],Vi=ti(12),jn=1,po,go=ti(st.CBANDS),uo=ti(st.CBANDS),Et=[0,0,0,0],mo=ti(st.HBLKSIZE),wo=wi([3,st.HBLKSIZE_s]);for(Lt(tt.npart_s<=st.CBANDS),Lt(tt.npart_l<=st.CBANDS),lt=0;lt<3;lt++)oi[lt]=tt.nsPsy.last_en_subshort[ct][lt+6],Lt(tt.nsPsy.last_en_subshort[ct][lt+4]>0),Vi[lt]=oi[lt]/tt.nsPsy.last_en_subshort[ct][lt+4],Yi[0]+=oi[lt];if(ct==2)for(lt=0;lt<576;lt++){var $n,Qn;$n=qt[0][lt],Qn=qt[1][lt],qt[0][lt]=$n+Qn,qt[1][lt]=$n-Qn}{var Co=qt[ct&1],nn=0;for(lt=0;lt<9;lt++){for(var Ne=nn+64,ni=1;nn<Ne;nn++)ni<Math.abs(Co[nn])&&(ni=Math.abs(Co[nn]));tt.nsPsy.last_en_subshort[ct][lt]=oi[lt+3]=ni,Yi[1+lt/3]+=ni,ni>oi[lt+3-2]?(Lt(oi[lt+3-2]>0),ni=ni/oi[lt+3-2]):oi[lt+3-2]>ni*10?ni=oi[lt+3-2]/(ni*10):ni=0,Vi[lt+3]=ni}}if(u.analysis){var Fn=Vi[0];for(lt=1;lt<12;lt++)Fn<Vi[lt]&&(Fn=Vi[lt]);tt.pinfo.ers[M][ct]=tt.pinfo.ers_save[ct],tt.pinfo.ers_save[ct]=Fn}for(po=ct==3?tt.nsPsy.attackthre_s:tt.nsPsy.attackthre,lt=0;lt<12;lt++)Et[lt/3]==0&&Vi[lt]>po&&(Et[lt/3]=lt%3+1);for(lt=1;lt<4;lt++){var yn;Yi[lt-1]>Yi[lt]?(Lt(Yi[lt]>0),yn=Yi[lt-1]/Yi[lt]):(Lt(Yi[lt-1]>0),yn=Yi[lt]/Yi[lt-1]),yn<1.7&&(Et[lt]=0,lt==1&&(Et[0]=0))}for(Et[0]!=0&&tt.nsPsy.lastAttacks[ct]!=0&&(Et[0]=0),(tt.nsPsy.lastAttacks[ct]==3||Et[0]+Et[1]+Et[2]+Et[3]!=0)&&(jn=0,Et[1]!=0&&Et[0]!=0&&(Et[1]=0),Et[2]!=0&&Et[1]!=0&&(Et[2]=0),Et[3]!=0&&Et[2]!=0&&(Et[3]=0)),ct<2?kt[ct]=jn:jn==0&&(kt[0]=kt[1]=0),S[ct]=tt.tot_ener[ct],Wi=ut,fi=rt,g(u,mo,wo,fi,ct&1,Wi,ct&1,M,ct,m,Y),B(tt,mo,Qt,go,uo),dt(tt,go,uo,ai),Mt=0;Mt<3;Mt++){var Xn,di;for(s(u,wo,ht,$t,ct,Mt),Q(tt,ht,$t,ct,Mt),wt=0;wt<st.SBMAX_s;wt++){if(di=tt.thm[ct].s[wt][Mt],di*=w,Et[Mt]>=2||Et[Mt+1]==1){var on=Mt!=0?Mt-1:2,ni=l(tt.thm[ct].s[wt][on],di,h*Nt);di=Math.min(di,ni)}if(Et[Mt]==1){var on=Mt!=0?Mt-1:2,ni=l(tt.thm[ct].s[wt][on],di,$*Nt);di=Math.min(di,ni)}else if(Mt!=0&&Et[Mt-1]==3||Mt==0&&tt.nsPsy.lastAttacks[ct]==3){var on=Mt!=2?Mt+1:0,ni=l(tt.thm[ct].s[wt][on],di,$*Nt);di=Math.min(di,ni)}Xn=oi[Mt*3+3]+oi[Mt*3+4]+oi[Mt*3+5],oi[Mt*3+5]*6<Xn&&(di*=0.5,oi[Mt*3+4]*6<Xn&&(di*=0.5)),tt.thm[ct].s[wt][Mt]=di}}for(tt.nsPsy.lastAttacks[ct]=Et[2],Tt=0,Gt=0;Gt<tt.npart_l;Gt++){for(var Mi=tt.s3ind[Gt][0],Mn=Qt[Mi]*x[ai[Mi]],Li=tt.s3_ll[Tt++]*Mn;++Mi<=tt.s3ind[Gt][1];)Mn=Qt[Mi]*x[ai[Mi]],Li=n(Li,tt.s3_ll[Tt++]*Mn,Mi,Mi-Gt,tt,0);Li*=0.158489319246111,tt.blocktype_old[ct&1]==st.SHORT_TYPE?$t[Gt]=Li:$t[Gt]=l(Math.min(Li,Math.min(W*tt.nb_1[ct][Gt],b*tt.nb_2[ct][Gt])),Li,Nt),tt.nb_2[ct][Gt]=tt.nb_1[ct][Gt],tt.nb_1[ct][Gt]=Li}for(;Gt<=st.CBANDS;++Gt)Qt[Gt]=0,$t[Gt]=0;c(tt,Qt,$t,ct)}if((u.mode==t.STEREO||u.mode==t.JOINT_STEREO)&&u.interChRatio>0&&V(u,u.interChRatio),u.mode==t.JOINT_STEREO){var Ln;q(tt),Ln=u.msfix,Math.abs(Ln)>0&&it(tt,Ln,u.ATHlower*tt.ATH.adjust)}for(o(u,kt,et,nt),ct=0;ct<Ut;ct++){var en,rn=0,pn,gn;ct>1?(en=R,rn=-2,pn=st.NORM_TYPE,(et[0]==st.SHORT_TYPE||et[1]==st.SHORT_TYPE)&&(pn=st.SHORT_TYPE),gn=J[M][ct-2]):(en=N,rn=0,pn=et[ct],gn=H[M][ct]),pn==st.SHORT_TYPE?en[rn+ct]=I(gn,tt.masking_lower):en[rn+ct]=y(gn,tt.masking_lower),u.analysis&&(tt.pinfo.pe[M][ct]=en[rn+ct])}return 0};function ft(u,m,Y,M,H,J,N,R){var S=u.internal_flags;if(M<2)r.fft_long(S,N[R],M,m,Y);else if(M==2)for(var et=st.BLKSIZE-1;et>=0;--et){var tt=N[R+0][et],rt=N[R+1][et];N[R+0][et]=(tt+rt)*hi.SQRT2*0.5,N[R+1][et]=(tt-rt)*hi.SQRT2*0.5}J[0]=N[R+0][0],J[0]*=J[0];for(var et=st.BLKSIZE/2-1;et>=0;--et){var ut=N[R+0][st.BLKSIZE/2-et],Qt=N[R+0][st.BLKSIZE/2+et];J[st.BLKSIZE/2-et]=(ut*ut+Qt*Qt)*0.5}{for(var ht=0,et=11;et<st.HBLKSIZE;et++)ht+=J[et];S.tot_ener[M]=ht}if(u.analysis){for(var et=0;et<st.HBLKSIZE;et++)S.pinfo.energy[H][M][et]=S.pinfo.energy_save[M][et],S.pinfo.energy_save[M][et]=J[et];S.pinfo.pe[H][M]=S.pe[M]}}function Dt(u,m,Y,M,H,J,N,R){var S=u.internal_flags;if(H==0&&M<2&&r.fft_short(S,N[R],M,m,Y),M==2)for(var et=st.BLKSIZE_s-1;et>=0;--et){var tt=N[R+0][H][et],rt=N[R+1][H][et];N[R+0][H][et]=(tt+rt)*hi.SQRT2*0.5,N[R+1][H][et]=(tt-rt)*hi.SQRT2*0.5}J[H][0]=N[R+0][H][0],J[H][0]*=J[H][0];for(var et=st.BLKSIZE_s/2-1;et>=0;--et){var ut=N[R+0][H][st.BLKSIZE_s/2-et],Qt=N[R+0][H][st.BLKSIZE_s/2+et];J[H][st.BLKSIZE_s/2-et]=(ut*ut+Qt*Qt)*0.5}}function Pt(u,m,Y,M){var H=u.internal_flags;u.athaa_loudapprox==2&&Y<2&&(H.loudness_sq[m][Y]=H.loudness_sq_save[Y],H.loudness_sq_save[Y]=D(M,H))}var Wt=[-0.00000000000000001730326,-0.01703172,-0.00000000000000001349528,0.0418072,-0.0000000000000000673278,-0.0876324,-0.000000000000000030835,0.1863476,-0.0000000000000001104424,-0.627638];function Zt(u,m,Y,M,H,J,N,R,S,et){for(var tt=wi([2,576]),rt=u.internal_flags,ut=rt.channels_out,Qt=u.mode==t.JOINT_STEREO?4:ut,ht=0;ht<ut;ht++){firbuf=m[ht];for(var $t=Y+576-350-v+192,nt=0;nt<576;nt++){var kt,Ut;kt=firbuf[$t+nt+10],Ut=0;for(var ct=0;ct<(v-1)/2-1;ct+=2)kt+=Wt[ct]*(firbuf[$t+nt+ct]+firbuf[$t+nt+v-ct]),Ut+=Wt[ct+1]*(firbuf[$t+nt+ct+1]+firbuf[$t+nt+v-ct-1]);tt[ht][nt]=kt+Ut}H[M][ht].en.assign(rt.en[ht]),H[M][ht].thm.assign(rt.thm[ht]),Qt>2&&(J[M][ht].en.assign(rt.en[ht+2]),J[M][ht].thm.assign(rt.thm[ht+2]))}for(var ht=0;ht<Qt;ht++){var Gt=ti(12),lt=ti(12),Ft=[0,0,0,0],Tt=tt[ht&1],wt=0,Mt=ht==3?rt.nsPsy.attackthre_s:rt.nsPsy.attackthre,qt=1;if(ht==2)for(var nt=0,ct=576;ct>0;++nt,--ct){var Nt=tt[0][nt],ai=tt[1][nt];tt[0][nt]=Nt+ai,tt[1][nt]=Nt-ai}for(var nt=0;nt<3;nt++)lt[nt]=rt.nsPsy.last_en_subshort[ht][nt+6],Lt(rt.nsPsy.last_en_subshort[ht][nt+4]>0),Gt[nt]=lt[nt]/rt.nsPsy.last_en_subshort[ht][nt+4],Ft[0]+=lt[nt];for(var nt=0;nt<9;nt++){for(var Rt=wt+64,St=1;wt<Rt;wt++)St<Math.abs(Tt[wt])&&(St=Math.abs(Tt[wt]));rt.nsPsy.last_en_subshort[ht][nt]=lt[nt+3]=St,Ft[1+nt/3]+=St,St>lt[nt+3-2]?(Lt(lt[nt+3-2]>0),St=St/lt[nt+3-2]):lt[nt+3-2]>St*10?St=lt[nt+3-2]/(St*10):St=0,Gt[nt+3]=St}for(var nt=0;nt<3;++nt){var si=lt[nt*3+3]+lt[nt*3+4]+lt[nt*3+5],pi=1;lt[nt*3+5]*6<si&&(pi*=0.5,lt[nt*3+4]*6<si&&(pi*=0.5)),R[ht][nt]=pi}if(u.analysis){for(var gi=Gt[0],nt=1;nt<12;nt++)gi<Gt[nt]&&(gi=Gt[nt]);rt.pinfo.ers[M][ht]=rt.pinfo.ers_save[ht],rt.pinfo.ers_save[ht]=gi}for(var nt=0;nt<12;nt++)S[ht][nt/3]==0&&Gt[nt]>Mt&&(S[ht][nt/3]=nt%3+1);for(var nt=1;nt<4;nt++){var fi=Ft[nt-1],Wi=Ft[nt],oi=Math.max(fi,Wi);oi<40000&&fi<1.7*Wi&&Wi<1.7*fi&&(nt==1&&S[ht][0]<=S[ht][nt]&&(S[ht][0]=0),S[ht][nt]=0)}S[ht][0]<=rt.nsPsy.lastAttacks[ht]&&(S[ht][0]=0),(rt.nsPsy.lastAttacks[ht]==3||S[ht][0]+S[ht][1]+S[ht][2]+S[ht][3]!=0)&&(qt=0,S[ht][1]!=0&&S[ht][0]!=0&&(S[ht][1]=0),S[ht][2]!=0&&S[ht][1]!=0&&(S[ht][2]=0),S[ht][3]!=0&&S[ht][2]!=0&&(S[ht][3]=0)),ht<2?et[ht]=qt:qt==0&&(et[0]=et[1]=0),N[ht]=rt.tot_ener[ht]}}function Vt(u,m,Y){if(Y==0)for(var M=0;M<u.npart_s;M++)u.nb_s2[m][M]=u.nb_s1[m][M],u.nb_s1[m][M]=0}function mi(u,m){for(var Y=0;Y<u.npart_l;Y++)u.nb_2[m][Y]=u.nb_1[m][Y],u.nb_1[m][Y]=0}function e(u,m,Y,M){var H=x.length-1,J=0,N=Y[J]+Y[J+1];if(N>0){var R=m[J];R<m[J+1]&&(R=m[J+1]),Lt(u.numlines_s[J]+u.numlines_s[J+1]-1>0),N=20*(R*2-N)/(N*(u.numlines_s[J]+u.numlines_s[J+1]-1));var S=0|N;S>H&&(S=H),M[J]=S}else M[J]=0;for(J=1;J<u.npart_s-1;J++)if(N=Y[J-1]+Y[J]+Y[J+1],Lt(J+1<u.npart_s),N>0){var R=m[J-1];R<m[J]&&(R=m[J]),R<m[J+1]&&(R=m[J+1]),Lt(u.numlines_s[J-1]+u.numlines_s[J]+u.numlines_s[J+1]-1>0),N=20*(R*3-N)/(N*(u.numlines_s[J-1]+u.numlines_s[J]+u.numlines_s[J+1]-1));var S=0|N;S>H&&(S=H),M[J]=S}else M[J]=0;if(Lt(J==u.npart_s-1),N=Y[J-1]+Y[J],N>0){var R=m[J-1];R<m[J]&&(R=m[J]),Lt(u.numlines_s[J-1]+u.numlines_s[J]-1>0),N=20*(R*2-N)/(N*(u.numlines_s[J-1]+u.numlines_s[J]-1));var S=0|N;S>H&&(S=H),M[J]=S}else M[J]=0;Lt(J==u.npart_s-1)}function p(u,m,Y,M,H,J){var N=u.internal_flags,R=new float[st.CBANDS],S=ti(st.CBANDS),et,tt,rt,ut=new int[st.CBANDS];for(rt=tt=0;rt<N.npart_s;++rt){var Qt=0,ht=0,$t=N.numlines_s[rt];for(et=0;et<$t;++et,++tt){var nt=m[J][tt];Qt+=nt,ht<nt&&(ht=nt)}Y[rt]=Qt,R[rt]=ht,S[rt]=Qt/$t,Lt(S[rt]>=0)}for(Lt(rt==N.npart_s);rt<st.CBANDS;++rt)R[rt]=0,S[rt]=0;for(e(N,R,S,ut),tt=rt=0;rt<N.npart_s;rt++){var kt=N.s3ind_s[rt][0],Ut=N.s3ind_s[rt][1],ct,Gt,lt,Ft,Tt;for(ct=ut[kt],Gt=1,Ft=N.s3_ss[tt]*Y[kt]*x[ut[kt]],++tt,++kt;kt<=Ut;)ct+=ut[kt],Gt+=1,lt=N.s3_ss[tt]*Y[kt]*x[ut[kt]],Ft=K(Ft,lt,kt-rt),++tt,++kt;ct=(1+2*ct)/(2*Gt),Tt=x[ct]*0.5,Ft*=Tt,M[rt]=Ft,N.nb_s2[H][rt]=N.nb_s1[H][rt],N.nb_s1[H][rt]=Ft,lt=R[rt],lt*=N.minval_s[rt],lt*=Tt,M[rt]>lt&&(M[rt]=lt),N.masking_lower>1&&(M[rt]*=N.masking_lower),M[rt]>Y[rt]&&(M[rt]=Y[rt]),N.masking_lower<1&&(M[rt]*=N.masking_lower),Lt(M[rt]>=0)}for(;rt<st.CBANDS;++rt)Y[rt]=0,M[rt]=0}function Ct(u,m,Y,M,H){var J=ti(st.CBANDS),N=ti(st.CBANDS),R=Ki(st.CBANDS+2),S;B(u,m,Y,J,N),dt(u,J,N,R);var et=0;for(S=0;S<u.npart_l;S++){var tt,rt,ut,Qt,ht=u.s3ind[S][0],$t=u.s3ind[S][1],nt=0,kt=0;for(nt=R[ht],kt+=1,rt=u.s3_ll[et]*Y[ht]*x[R[ht]],++et,++ht;ht<=$t;)nt+=R[ht],kt+=1,tt=u.s3_ll[et]*Y[ht]*x[R[ht]],Qt=K(rt,tt,ht-S),rt=Qt,++et,++ht;if(nt=(1+2*nt)/(2*kt),ut=x[nt]*0.5,rt*=ut,u.blocktype_old[H&1]==st.SHORT_TYPE){var Ut=W*u.nb_1[H][S];Ut>0?M[S]=Math.min(rt,Ut):M[S]=Math.min(rt,Y[S]*$)}else{var ct=b*u.nb_2[H][S],Gt=W*u.nb_1[H][S],Ut;ct<=0&&(ct=rt),Gt<=0&&(Gt=rt),u.blocktype_old[H&1]==st.NORM_TYPE?Ut=Math.min(Gt,ct):Ut=Gt,M[S]=Math.min(rt,Ut)}u.nb_2[H][S]=u.nb_1[H][S],u.nb_1[H][S]=rt,tt=J[S],tt*=u.minval_l[S],tt*=ut,M[S]>tt&&(M[S]=tt),u.masking_lower>1&&(M[S]*=u.masking_lower),M[S]>Y[S]&&(M[S]=Y[S]),u.masking_lower<1&&(M[S]*=u.masking_lower),Lt(M[S]>=0)}for(;S<st.CBANDS;++S)Y[S]=0,M[S]=0}function Jt(u,m){var Y=u.internal_flags;u.short_blocks==Ni.short_block_coupled&&!(m[0]!=0&&m[1]!=0)&&(m[0]=m[1]=0);for(var M=0;M<Y.channels_out;M++)u.short_blocks==Ni.short_block_dispensed&&(m[M]=1),u.short_blocks==Ni.short_block_forced&&(m[M]=0)}function Xt(u,m,Y){for(var M=u.internal_flags,H=0;H<M.channels_out;H++){var J=st.NORM_TYPE;m[H]!=0?(Lt(M.blocktype_old[H]!=st.START_TYPE),M.blocktype_old[H]==st.SHORT_TYPE&&(J=st.STOP_TYPE)):(J=st.SHORT_TYPE,M.blocktype_old[H]==st.NORM_TYPE&&(M.blocktype_old[H]=st.START_TYPE),M.blocktype_old[H]==st.STOP_TYPE&&(M.blocktype_old[H]=st.SHORT_TYPE)),Y[H]=M.blocktype_old[H],M.blocktype_old[H]=J}}function yt(u,m,Y,M,H,J,N){for(var R=J*2,S=J>0?Math.pow(10,H):1,et,tt,rt=0;rt<N;++rt){var ut=u[2][rt],Qt=u[3][rt],ht=m[0][rt],$t=m[1][rt],nt=m[2][rt],kt=m[3][rt];if(ht<=1.58*$t&&$t<=1.58*ht){var Ut=Y[rt]*Qt,ct=Y[rt]*ut;tt=Math.max(nt,Math.min(kt,Ut)),et=Math.max(kt,Math.min(nt,ct))}else tt=nt,et=kt;if(J>0){var Gt,lt,Ft=M[rt]*S;if(Gt=Math.min(Math.max(ht,Ft),Math.max($t,Ft)),nt=Math.max(tt,Ft),kt=Math.max(et,Ft),lt=nt+kt,lt>0&&Gt*R<lt){var Tt=Gt*R/lt;nt*=Tt,kt*=Tt}tt=Math.min(nt,tt),et=Math.min(kt,et)}tt>ut&&(tt=ut),et>Qt&&(et=Qt),m[2][rt]=tt,m[3][rt]=et}}this.L3psycho_anal_vbr=function(u,m,Y,M,H,J,N,R,S,et){var tt=u.internal_flags,rt,ut,Qt=ti(st.HBLKSIZE),ht=wi([3,st.HBLKSIZE_s]),$t=wi([2,st.BLKSIZE]),nt=wi([2,3,st.BLKSIZE_s]),kt=wi([4,st.CBANDS]),Ut=wi([4,st.CBANDS]),ct=wi([4,3]),Gt=0.6,lt=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],Ft=Ki(2),Tt=u.mode==t.JOINT_STEREO?4:tt.channels_out;Zt(u,m,Y,M,H,J,S,ct,lt,Ft),Jt(u,Ft);{for(var wt=0;wt<Tt;wt++){var Mt=wt&1;rt=$t,ft(u,m,Y,wt,M,Qt,rt,Mt),Pt(u,M,wt,Qt),Ft[Mt]!=0?Ct(tt,Qt,kt[wt],Ut[wt],wt):mi(tt,wt)}Ft[0]+Ft[1]==2&&u.mode==t.JOINT_STEREO&&yt(kt,Ut,tt.mld_cb_l,tt.ATH.cb_l,u.ATHlower*tt.ATH.adjust,u.msfix,tt.npart_l);for(var wt=0;wt<Tt;wt++){var Mt=wt&1;Ft[Mt]!=0&&c(tt,kt[wt],Ut[wt],wt)}}{for(var qt=0;qt<3;qt++){for(var wt=0;wt<Tt;++wt){var Mt=wt&1;Ft[Mt]!=0?Vt(tt,wt,qt):(ut=nt,Dt(u,m,Y,wt,qt,ht,ut,Mt),p(u,ht,kt[wt],Ut[wt],wt,qt))}Ft[0]+Ft[1]==0&&u.mode==t.JOINT_STEREO&&yt(kt,Ut,tt.mld_cb_s,tt.ATH.cb_s,u.ATHlower*tt.ATH.adjust,u.msfix,tt.npart_s);for(var wt=0;wt<Tt;++wt){var Mt=wt&1;Ft[Mt]==0&&Q(tt,kt[wt],Ut[wt],wt,qt)}}for(var wt=0;wt<Tt;wt++){var Mt=wt&1;if(Ft[Mt]==0)for(var Nt=0;Nt<st.SBMAX_s;Nt++){for(var ai=ti(3),qt=0;qt<3;qt++){var Rt=tt.thm[wt].s[Nt][qt];if(Rt*=w,lt[wt][qt]>=2||lt[wt][qt+1]==1){var St=qt!=0?qt-1:2,si=l(tt.thm[wt].s[Nt][St],Rt,h*Gt);Rt=Math.min(Rt,si)}else if(lt[wt][qt]==1){var St=qt!=0?qt-1:2,si=l(tt.thm[wt].s[Nt][St],Rt,$*Gt);Rt=Math.min(Rt,si)}else if(qt!=0&&lt[wt][qt-1]==3||qt==0&&tt.nsPsy.lastAttacks[wt]==3){var St=qt!=2?qt+1:0,si=l(tt.thm[wt].s[Nt][St],Rt,$*Gt);Rt=Math.min(Rt,si)}Rt*=ct[wt][qt],ai[qt]=Rt}for(var qt=0;qt<3;qt++)tt.thm[wt].s[Nt][qt]=ai[qt]}}}for(var wt=0;wt<Tt;wt++)tt.nsPsy.lastAttacks[wt]=lt[wt][2];Xt(u,Ft,et);for(var wt=0;wt<Tt;wt++){var pi,gi,fi,Wi;wt>1?(pi=R,gi=-2,fi=st.NORM_TYPE,(et[0]==st.SHORT_TYPE||et[1]==st.SHORT_TYPE)&&(fi=st.SHORT_TYPE),Wi=J[M][wt-2]):(pi=N,gi=0,fi=et[wt],Wi=H[M][wt]),fi==st.SHORT_TYPE?pi[gi+wt]=I(Wi,tt.masking_lower):pi[gi+wt]=y(Wi,tt.masking_lower),u.analysis&&(tt.pinfo.pe[M][wt]=pi[gi+wt])}return 0};function zt(u,m){var Y=u,M;return Y>=0?M=-Y*27:M=Y*m,M<=-72?0:Math.exp(M*T)}function Yt(u){var m=0,Y=0;{var M=0,H,J;for(M=0;zt(M,u)>0.00000000000000000001;M-=1);for(H=M,J=0;Math.abs(J-H)>0.000000000001;)M=(J+H)/2,zt(M,u)>0?J=M:H=M;m=H}{var M=0,H,J;for(M=0;zt(M,u)>0.00000000000000000001;M+=1);for(H=0,J=M;Math.abs(J-H)>0.000000000001;)M=(J+H)/2,zt(M,u)>0?H=M:J=M;Y=J}{var N=0,R=1000,S;for(S=0;S<=R;++S){var M=m+S*(Y-m)/R,et=zt(M,u);N+=et}{var tt=(R+1)/(N*(Y-m));return tt}}}function Kt(u){var m,Y,M,H;return m=u,m>=0?m*=3:m*=1.5,m>=0.5&&m<=2.5?(H=m-0.5,Y=8*(H*H-2*H)):Y=0,m+=0.474,M=15.811389+7.5*m-17.5*Math.sqrt(1+m*m),M<=-60?0:(m=Math.exp((Y+M)*T),m/=0.6609193,m)}function jt(u){return u<0&&(u=0),u=u*0.001,13*Math.atan(0.76*u)+3.5*Math.atan(u*u/56.25)}function mt(u,m,Y,M,H,J,N,R,S,et,tt,rt){var ut=ti(st.CBANDS+1),Qt=R/(rt>15?1152:384),ht=Ki(st.HBLKSIZE),$t;R/=S;var nt=0,kt=0;for($t=0;$t<st.CBANDS;$t++){var Ut,ct;for(Ut=jt(R*nt),ut[$t]=R*nt,ct=nt;jt(R*ct)-Ut<j&&ct<=S/2;ct++);for(u[$t]=ct-nt,kt=$t+1;nt<ct;)Lt(nt<st.HBLKSIZE),ht[nt++]=$t;if(nt>S/2){nt=S/2,++$t;break}}Lt($t<st.CBANDS),ut[$t]=R*nt;for(var Gt=0;Gt<rt;Gt++){var lt,Ft,Tt,wt,Mt;Tt=et[Gt],wt=et[Gt+1],lt=0|Math.floor(0.5+tt*(Tt-0.5)),lt<0&&(lt=0),Ft=0|Math.floor(0.5+tt*(wt-0.5)),Ft>S/2&&(Ft=S/2),Y[Gt]=(ht[lt]+ht[Ft])/2,m[Gt]=ht[Ft];var qt=Qt*wt;N[Gt]=(qt-ut[m[Gt]])/(ut[m[Gt]+1]-ut[m[Gt]]),N[Gt]<0?N[Gt]=0:N[Gt]>1&&(N[Gt]=1),Mt=jt(R*et[Gt]*tt),Mt=Math.min(Mt,15.5)/15.5,J[Gt]=Math.pow(10,1.25*(1-Math.cos(Math.PI*Mt))-2.5)}nt=0;for(var Nt=0;Nt<kt;Nt++){var ai=u[Nt],Ut,Rt;Ut=jt(R*nt),Rt=jt(R*(nt+ai-1)),M[Nt]=0.5*(Ut+Rt),Ut=jt(R*(nt-0.5)),Rt=jt(R*(nt+ai-0.5)),H[Nt]=Rt-Ut,nt+=ai}return kt}function vt(u,m,Y,M,H,J){var N=wi([st.CBANDS,st.CBANDS]),R,S=0;if(J)for(var et=0;et<m;et++)for(R=0;R<m;R++){var tt=Kt(Y[et]-Y[R])*M[R];N[et][R]=tt*H[et]}else for(R=0;R<m;R++)for(var rt=15+Math.min(21/Y[R],12),ut=Yt(rt),et=0;et<m;et++){var tt=ut*zt(Y[et]-Y[R],rt)*M[R];N[et][R]=tt*H[et]}for(var et=0;et<m;et++){for(R=0;R<m&&!(N[et][R]>0);R++);for(u[et][0]=R,R=m-1;R>0&&!(N[et][R]>0);R--);u[et][1]=R,S+=u[et][1]-u[et][0]+1}for(var Qt=ti(S),ht=0,et=0;et<m;et++)for(R=u[et][0];R<=u[et][1];R++)Qt[ht++]=N[et][R];return Qt}function ii(u){var m=jt(u);return m=Math.min(m,15.5)/15.5,Math.pow(10,1.25*(1-Math.cos(Math.PI*m))-2.5)}this.psymodel_init=function(u){var m=u.internal_flags,Y,M=!0,H=13,J=24,N=0,R=0,S=-8.25,et=-4.5,tt=ti(st.CBANDS),rt=ti(st.CBANDS),ut=ti(st.CBANDS),Qt=u.out_samplerate;switch(u.experimentalZ){default:case 0:M=!0;break;case 1:M=!(u.VBR==Ti.vbr_mtrh||u.VBR==Ti.vbr_mt);break;case 2:M=!1;break;case 3:H=8,N=-1.75,R=-0.0125,S=-8.25,et=-2.25;break}for(m.ms_ener_ratio_old=0.25,m.blocktype_old[0]=m.blocktype_old[1]=st.NORM_TYPE,Y=0;Y<4;++Y){for(var nt=0;nt<st.CBANDS;++nt)m.nb_1[Y][nt]=100000000000000000000,m.nb_2[Y][nt]=100000000000000000000,m.nb_s1[Y][nt]=m.nb_s2[Y][nt]=1;for(var ht=0;ht<st.SBMAX_l;ht++)m.en[Y].l[ht]=100000000000000000000,m.thm[Y].l[ht]=100000000000000000000;for(var nt=0;nt<3;++nt){for(var ht=0;ht<st.SBMAX_s;ht++)m.en[Y].s[ht][nt]=100000000000000000000,m.thm[Y].s[ht][nt]=100000000000000000000;m.nsPsy.lastAttacks[Y]=0}for(var nt=0;nt<9;nt++)m.nsPsy.last_en_subshort[Y][nt]=10}for(m.loudness_sq_save[0]=m.loudness_sq_save[1]=0,m.npart_l=mt(m.numlines_l,m.bo_l,m.bm_l,tt,rt,m.mld_l,m.PSY.bo_l_weight,Qt,st.BLKSIZE,m.scalefac_band.l,st.BLKSIZE/1152,st.SBMAX_l),Lt(m.npart_l<st.CBANDS),Y=0;Y<m.npart_l;Y++){var $t=N;tt[Y]>=H&&($t=R*(tt[Y]-H)/(J-H)+N*(J-tt[Y])/(J-H)),ut[Y]=Math.pow(10,$t/10),m.numlines_l[Y]>0?m.rnumlines_l[Y]=1/m.numlines_l[Y]:m.rnumlines_l[Y]=0}m.s3_ll=vt(m.s3ind,m.npart_l,tt,rt,ut,M);var nt=0;for(Y=0;Y<m.npart_l;Y++){var kt=Zo.MAX_VALUE;for(var Ut=0;Ut<m.numlines_l[Y];Ut++,nt++){var ct=Qt*nt/(1000*st.BLKSIZE),Gt;Gt=this.ATHformula(ct*1000,u)-20,Gt=Math.pow(10,0.1*Gt),Gt*=m.numlines_l[Y],kt>Gt&&(kt=Gt)}m.ATH.cb_l[Y]=kt,kt=-20+tt[Y]*20/10,kt>6&&(kt=100),kt<-15&&(kt=-15),kt-=8,m.minval_l[Y]=Math.pow(10,kt/10)*m.numlines_l[Y]}for(m.npart_s=mt(m.numlines_s,m.bo_s,m.bm_s,tt,rt,m.mld_s,m.PSY.bo_s_weight,Qt,st.BLKSIZE_s,m.scalefac_band.s,st.BLKSIZE_s/384,st.SBMAX_s),Lt(m.npart_s<st.CBANDS),nt=0,Y=0;Y<m.npart_s;Y++){var kt,$t=S;tt[Y]>=H&&($t=et*(tt[Y]-H)/(J-H)+S*(J-tt[Y])/(J-H)),ut[Y]=Math.pow(10,$t/10),kt=Zo.MAX_VALUE;for(var Ut=0;Ut<m.numlines_s[Y];Ut++,nt++){var ct=Qt*nt/(1000*st.BLKSIZE_s),Gt;Gt=this.ATHformula(ct*1000,u)-20,Gt=Math.pow(10,0.1*Gt),Gt*=m.numlines_s[Y],kt>Gt&&(kt=Gt)}m.ATH.cb_s[Y]=kt,kt=-7+tt[Y]*7/12,tt[Y]>12&&(kt*=1+Math.log(1+kt)*3.1),tt[Y]<12&&(kt*=1+Math.log(1-kt)*2.3),kt<-15&&(kt=-15),kt-=8,m.minval_s[Y]=Math.pow(10,kt/10)*m.numlines_s[Y]}m.s3_ss=vt(m.s3ind_s,m.npart_s,tt,rt,ut,M),F(),r.init_fft(m),m.decay=Math.exp(-1*d/(A*Qt/192));{var lt;lt=_,u.exp_nspsytune&2&&(lt=1),Math.abs(u.msfix)>0&&(lt=u.msfix),u.msfix=lt;for(var Ft=0;Ft<m.npart_l;Ft++)m.s3ind[Ft][1]>m.npart_l-1&&(m.s3ind[Ft][1]=m.npart_l-1)}var Tt=576*m.mode_gr/Qt;if(m.ATH.decay=Math.pow(10,-1.2*Tt),m.ATH.adjust=0.01,m.ATH.adjustLimit=1,Lt(m.bo_l[st.SBMAX_l-1]<=m.npart_l),Lt(m.bo_s[st.SBMAX_s-1]<=m.npart_s),u.ATHtype!=-1){var ct,wt=u.out_samplerate/st.BLKSIZE,Mt=0;for(ct=0,Y=0;Y<st.BLKSIZE/2;++Y)ct+=wt,m.ATH.eql_w[Y]=1/Math.pow(10,this.ATHformula(ct,u)/10),Mt+=m.ATH.eql_w[Y];for(Mt=1/Mt,Y=st.BLKSIZE/2;--Y>=0;)m.ATH.eql_w[Y]*=Mt}{for(var Ft=nt=0;Ft<m.npart_s;++Ft)for(Y=0;Y<m.numlines_s[Ft];++Y)++nt;for(var Ft=nt=0;Ft<m.npart_l;++Ft)for(Y=0;Y<m.numlines_l[Ft];++Y)++nt}for(nt=0,Y=0;Y<m.npart_l;Y++){var ct=Qt*(nt+m.numlines_l[Y]/2)/(1*st.BLKSIZE);m.mld_cb_l[Y]=ii(ct),nt+=m.numlines_l[Y]}for(;Y<st.CBANDS;++Y)m.mld_cb_l[Y]=1;for(nt=0,Y=0;Y<m.npart_s;Y++){var ct=Qt*(nt+m.numlines_s[Y]/2)/(1*st.BLKSIZE_s);m.mld_cb_s[Y]=ii(ct),nt+=m.numlines_s[Y]}for(;Y<st.CBANDS;++Y)m.mld_cb_s[Y]=1;return 0};function Ot(u,m){u<-0.3&&(u=3410),u/=1000,u=Math.max(0.1,u);var Y=3.64*Math.pow(u,-0.8)-6.8*Math.exp(-0.6*Math.pow(u-3.4,2))+6*Math.exp(-0.15*Math.pow(u-8.7,2))+(0.6+0.04*m)*0.001*Math.pow(u,4);return Y}this.ATHformula=function(u,m){var Y;switch(m.ATHtype){case 0:Y=Ot(u,9);break;case 1:Y=Ot(u,-1);break;case 2:Y=Ot(u,0);break;case 3:Y=Ot(u,1)+6;break;case 4:Y=Ot(u,m.ATHcurve);break;default:Y=Ot(u,0);break}return Y}}var or=nr,er=ln;function rr(){this.class_id=0,this.num_samples=0,this.num_channels=0,this.in_samplerate=0,this.out_samplerate=0,this.scale=0,this.scale_left=0,this.scale_right=0,this.analysis=!1,this.bWriteVbrTag=!1,this.decode_only=!1,this.quality=0,this.mode=er.STEREO,this.force_ms=!1,this.free_format=!1,this.findReplayGain=!1,this.decode_on_the_fly=!1,this.write_id3tag_automatic=!1,this.brate=0,this.compression_ratio=0,this.copyright=0,this.original=0,this.extension=0,this.emphasis=0,this.error_protection=0,this.strict_ISO=!1,this.disable_reservoir=!1,this.quant_comp=0,this.quant_comp_short=0,this.experimentalY=!1,this.experimentalZ=0,this.exp_nspsytune=0,this.preset=0,this.VBR=null,this.VBR_q_frac=0,this.VBR_q=0,this.VBR_mean_bitrate_kbps=0,this.VBR_min_bitrate_kbps=0,this.VBR_max_bitrate_kbps=0,this.VBR_hard_min=0,this.lowpassfreq=0,this.highpassfreq=0,this.lowpasswidth=0,this.highpasswidth=0,this.maskingadjust=0,this.maskingadjust_short=0,this.ATHonly=!1,this.ATHshort=!1,this.noATH=!1,this.ATHtype=0,this.ATHcurve=0,this.ATHlower=0,this.athaa_type=0,this.athaa_loudapprox=0,this.athaa_sensitivity=0,this.short_blocks=null,this.useTemporal=!1,this.interChRatio=0,this.msfix=0,this.tune=!1,this.tune_value_a=0,this.version=0,this.encoder_delay=0,this.encoder_padding=0,this.framesize=0,this.frameNum=0,this.lame_allocated_gfp=0,this.internal_flags=null}var sr=rr,dr=ei(),re={};re.SFBMAX=dr.SBMAX_s*3;var Pn=re,se=Ht,hr=se.new_float,Ui=se.new_int,xn=Pn;function cr(){this.xr=hr(576),this.l3_enc=Ui(576),this.scalefac=Ui(xn.SFBMAX),this.xrpow_max=0,this.part2_3_length=0,this.big_values=0,this.count1=0,this.global_gain=0,this.scalefac_compress=0,this.block_type=0,this.mixed_block_flag=0,this.table_select=Ui(3),this.subblock_gain=Ui(4),this.region0_count=0,this.region1_count=0,this.preflag=0,this.scalefac_scale=0,this.count1table_select=0,this.part2_length=0,this.sfb_lmax=0,this.sfb_smin=0,this.psy_lmax=0,this.sfbmax=0,this.psymax=0,this.sfbdivide=0,this.width=Ui(xn.SFBMAX),this.window=Ui(xn.SFBMAX),this.count1bits=0,this.sfb_partition_table=null,this.slen=Ui(4),this.max_nonzero_coeff=0;var t=this;function r(W){return new Int32Array(W)}function d(W){return new Float32Array(W)}this.assign=function(W){t.xr=d(W.xr),t.l3_enc=r(W.l3_enc),t.scalefac=r(W.scalefac),t.xrpow_max=W.xrpow_max,t.part2_3_length=W.part2_3_length,t.big_values=W.big_values,t.count1=W.count1,t.global_gain=W.global_gain,t.scalefac_compress=W.scalefac_compress,t.block_type=W.block_type,t.mixed_block_flag=W.mixed_block_flag,t.table_select=r(W.table_select),t.subblock_gain=r(W.subblock_gain),t.region0_count=W.region0_count,t.region1_count=W.region1_count,t.preflag=W.preflag,t.scalefac_scale=W.scalefac_scale,t.count1table_select=W.count1table_select,t.part2_length=W.part2_length,t.sfb_lmax=W.sfb_lmax,t.sfb_smin=W.sfb_smin,t.psy_lmax=W.psy_lmax,t.sfbmax=W.sfbmax,t.psymax=W.psymax,t.sfbdivide=W.sfbdivide,t.width=r(W.width),t.window=r(W.window),t.count1bits=W.count1bits,t.sfb_partition_table=W.sfb_partition_table.slice(0),t.slen=r(W.slen),t.max_nonzero_coeff=W.max_nonzero_coeff}}var In=cr,lr=Ht,jo=lr.new_int,ar=In;function pr(){this.tt=[[null,null],[null,null]],this.main_data_begin=0,this.private_bits=0,this.resvDrain_pre=0,this.resvDrain_post=0,this.scfsi=[jo(4),jo(4)];for(var t=0;t<2;t++)for(var r=0;r<2;r++)this.tt[t][r]=new ar}var gr=pr,de=Ht,un=de.System,mn=de.new_int,wn=ei();function ur(t,r,d,W){this.l=mn(1+wn.SBMAX_l),this.s=mn(1+wn.SBMAX_s),this.psfb21=mn(1+wn.PSFB21),this.psfb12=mn(1+wn.PSFB12);var b=this.l,z=this.s;arguments.length==4&&(this.arrL=arguments[0],this.arrS=arguments[1],this.arr21=arguments[2],this.arr12=arguments[3],un.arraycopy(this.arrL,0,b,0,Math.min(this.arrL.length,this.l.length)),un.arraycopy(this.arrS,0,z,0,Math.min(this.arrS.length,this.s.length)),un.arraycopy(this.arr21,0,this.psfb21,0,Math.min(this.arr21.length,this.psfb21.length)),un.arraycopy(this.arr12,0,this.psfb12,0,Math.min(this.arr12.length,this.psfb12.length)))}var he=ur,_n=Ht,bn=_n.new_float,mr=_n.new_float_n,wr=_n.new_int,$o=ei();function Cr(){this.last_en_subshort=mr([4,9]),this.lastAttacks=wr(4),this.pefirbuf=bn(19),this.longfact=bn($o.SBMAX_l),this.shortfact=bn($o.SBMAX_s),this.attackthre=0,this.attackthre_s=0}var fr=Cr;function Wr(){this.sum=0,this.seen=0,this.want=0,this.pos=0,this.size=0,this.bag=null,this.nVbrNumFrames=0,this.nBytesWritten=0,this.TotalFrameSize=0}var Pr=Wr,Hi=Ht,Dr=Hi.new_byte,kr=Hi.new_double,Ci=Hi.new_float,qi=Hi.new_float_n,Pi=Hi.new_int,Cn=Hi.new_int_n,Jr=gr,Gr=he,Yr=fr,zr=Pr,Qo=oe(),_t=ei(),Zr=Pn;ji.MFSIZE=3456+_t.ENCDELAY-_t.MDCTDELAY;ji.MAX_HEADER_BUF=256;ji.MAX_BITS_PER_CHANNEL=4095;ji.MAX_BITS_PER_GRANULE=7680;ji.BPC=320;function ji(){var t=40;this.Class_ID=0,this.lame_encode_frame_init=0,this.iteration_init_init=0,this.fill_buffer_resample_init=0,this.mfbuf=qi([2,ji.MFSIZE]),this.mode_gr=0,this.channels_in=0,this.channels_out=0,this.resample_ratio=0,this.mf_samples_to_encode=0,this.mf_size=0,this.VBR_min_bitrate=0,this.VBR_max_bitrate=0,this.bitrate_index=0,this.samplerate_index=0,this.mode_ext=0,this.lowpass1=0,this.lowpass2=0,this.highpass1=0,this.highpass2=0,this.noise_shaping=0,this.noise_shaping_amp=0,this.substep_shaping=0,this.psymodel=0,this.noise_shaping_stop=0,this.subblock_gain=0,this.use_best_huffman=0,this.full_outer_loop=0,this.l3_side=new Jr,this.ms_ratio=Ci(2),this.padding=0,this.frac_SpF=0,this.slot_lag=0,this.tag_spec=null,this.nMusicCRC=0,this.OldValue=Pi(2),this.CurrentStep=Pi(2),this.masking_lower=0,this.bv_scf=Pi(576),this.pseudohalf=Pi(Zr.SFBMAX),this.sfb21_extra=!1,this.inbuf_old=new Array(2),this.blackfilt=new Array(2*ji.BPC+1),this.itime=kr(2),this.sideinfo_len=0,this.sb_sample=qi([2,2,18,_t.SBLIMIT]),this.amp_filter=Ci(32);function r(){this.write_timing=0,this.ptr=0,this.buf=Dr(t)}this.header=new Array(ji.MAX_HEADER_BUF),this.h_ptr=0,this.w_ptr=0,this.ancillary_flag=0,this.ResvSize=0,this.ResvMax=0,this.scalefac_band=new Gr,this.minval_l=Ci(_t.CBANDS),this.minval_s=Ci(_t.CBANDS),this.nb_1=qi([4,_t.CBANDS]),this.nb_2=qi([4,_t.CBANDS]),this.nb_s1=qi([4,_t.CBANDS]),this.nb_s2=qi([4,_t.CBANDS]),this.s3_ss=null,this.s3_ll=null,this.decay=0,this.thm=new Array(4),this.en=new Array(4),this.tot_ener=Ci(4),this.loudness_sq=qi([2,2]),this.loudness_sq_save=Ci(2),this.mld_l=Ci(_t.SBMAX_l),this.mld_s=Ci(_t.SBMAX_s),this.bm_l=Pi(_t.SBMAX_l),this.bo_l=Pi(_t.SBMAX_l),this.bm_s=Pi(_t.SBMAX_s),this.bo_s=Pi(_t.SBMAX_s),this.npart_l=0,this.npart_s=0,this.s3ind=Cn([_t.CBANDS,2]),this.s3ind_s=Cn([_t.CBANDS,2]),this.numlines_s=Pi(_t.CBANDS),this.numlines_l=Pi(_t.CBANDS),this.rnumlines_l=Ci(_t.CBANDS),this.mld_cb_l=Ci(_t.CBANDS),this.mld_cb_s=Ci(_t.CBANDS),this.numlines_s_num1=0,this.numlines_l_num1=0,this.pe=Ci(4),this.ms_ratio_s_old=0,this.ms_ratio_l_old=0,this.ms_ener_ratio_old=0,this.blocktype_old=Pi(2),this.nsPsy=new Yr,this.VBR_seek_table=new zr,this.ATH=null,this.PSY=null,this.nogap_total=0,this.nogap_current=0,this.decode_on_the_fly=!0,this.findReplayGain=!0,this.findPeakSample=!0,this.PeakSample=0,this.RadioGain=0,this.AudiophileGain=0,this.rgdata=null,this.noclipGainChange=0,this.noclipScale=0,this.bitrate_stereoMode_Hist=Cn([16,5]),this.bitrate_blockType_Hist=Cn([16,6]),this.pinfo=null,this.hip=null,this.in_buffer_nsamples=0,this.in_buffer_0=null,this.in_buffer_1=null,this.iteration_loop=null;for(var d=0;d<this.en.length;d++)this.en[d]=new Qo;for(var d=0;d<this.thm.length;d++)this.thm[d]=new Qo;for(var d=0;d<this.header.length;d++)this.header[d]=new r}var Dn=ji,jr=Ht,Oi=jr.new_float,xi=ei();function $r(){this.useAdjust=0,this.aaSensitivityP=0,this.adjust=0,this.adjustLimit=0,this.decay=0,this.floor=0,this.l=Oi(xi.SBMAX_l),this.s=Oi(xi.SBMAX_s),this.psfb21=Oi(xi.PSFB21),this.psfb12=Oi(xi.PSFB12),this.cb_l=Oi(xi.CBANDS),this.cb_s=Oi(xi.CBANDS),this.eql_w=Oi(xi.BLKSIZE/2)}var Qr=$r,ce=Ht,ci=ce.System,Fo=ce.Arrays;Bt.STEPS_per_dB=100;Bt.MAX_dB=120;Bt.GAIN_NOT_ENOUGH_SAMPLES=-24601;Bt.GAIN_ANALYSIS_ERROR=0;Bt.GAIN_ANALYSIS_OK=1;Bt.INIT_GAIN_ANALYSIS_ERROR=0;Bt.INIT_GAIN_ANALYSIS_OK=1;Bt.YULE_ORDER=10;Bt.MAX_ORDER=Bt.YULE_ORDER;Bt.MAX_SAMP_FREQ=48000;Bt.RMS_WINDOW_TIME_NUMERATOR=1;Bt.RMS_WINDOW_TIME_DENOMINATOR=20;Bt.MAX_SAMPLES_PER_WINDOW=Bt.MAX_SAMP_FREQ*Bt.RMS_WINDOW_TIME_NUMERATOR/Bt.RMS_WINDOW_TIME_DENOMINATOR+1;function Bt(){var t=64.82,r=0.95,d=Bt.RMS_WINDOW_TIME_NUMERATOR,W=Bt.RMS_WINDOW_TIME_DENOMINATOR,b=[[0.038575994352,-3.84664617118067,-0.02160367184185,7.81501653005538,-0.00123395316851,-11.34170355132042,-0.00009291677959,13.05504219327545,-0.01655260341619,-12.28759895145294,0.02161526843274,9.4829380631979,-0.02074045215285,-5.87257861775999,0.00594298065125,2.75465861874613,0.00306428023191,-0.86984376593551,0.00012025322027,0.13919314567432,0.00288463683916],[0.0541865640643,-3.47845948550071,-0.02911007808948,6.36317777566148,-0.00848709379851,-8.54751527471874,-0.00851165645469,9.4769360780128,-0.00834990904936,-8.81498681370155,0.02245293253339,6.85401540936998,-0.02596338512915,-4.39470996079559,0.01624864962975,2.19611684890774,-0.00240879051584,-0.75104302451432,0.00674613682247,0.13149317958808,-0.00187763777362],[0.15457299681924,-2.37898834973084,-0.09331049056315,2.84868151156327,-0.06247880153653,-2.64577170229825,0.02163541888798,2.23697657451713,-0.05588393329856,-1.67148153367602,0.04781476674921,1.00595954808547,0.00222312597743,-0.45953458054983,0.03174092540049,0.16378164858596,-0.01390589421898,-0.05032077717131,0.00651420667831,0.0234789740702,-0.00881362733839],[0.30296907319327,-1.61273165137247,-0.22613988682123,1.0797749225997,-0.08587323730772,-0.2565625775407,0.03282930172664,-0.1627671912044,-0.00915702933434,-0.22638893773906,-0.02364141202522,0.39120800788284,-0.00584456039913,-0.22138138954925,0.06276101321749,0.04500235387352,-0.00000828086748,0.02005851806501,0.00205861885564,0.00302439095741,-0.02950134983287],[0.33642304856132,-1.49858979367799,-0.2557224142557,0.87350271418188,-0.11828570177555,0.12205022308084,0.11921148675203,-0.80774944671438,-0.07834489609479,0.47854794562326,-0.0046997791438,-0.12453458140019,-0.0058950022444,-0.04067510197014,0.05724228140351,0.08333755284107,0.00832043980773,-0.04237348025746,-0.0163538138454,0.02977207319925,-0.0176017656815],[0.4491525660845,-0.62820619233671,-0.14351757464547,0.29661783706366,-0.22784394429749,-0.372563729424,-0.01419140100551,0.00213767857124,0.04078262797139,-0.42029820170918,-0.12398163381748,0.22199650564824,0.04097565135648,0.00613424350682,0.10478503600251,0.06747620744683,-0.01863887810927,0.05784820375801,-0.03193428438915,0.03222754072173,0.00541907748707],[0.56619470757641,-1.04800335126349,-0.75464456939302,0.29156311971249,0.1624213774223,-0.26806001042947,0.16744243493672,0.00819999645858,-0.18901604199609,0.45054734505008,0.3093178284183,-0.33032403314006,-0.27562961986224,0.0673936833311,0.00647310677246,-0.04784254229033,0.08647503780351,0.01639907836189,-0.0378898455484,0.01807364323573,-0.00588215443421],[0.58100494960553,-0.51035327095184,-0.53174909058578,-0.31863563325245,-0.14289799034253,-0.20256413484477,0.17520704835522,0.1472815413433,0.02377945217615,0.38952639978999,0.15558449135573,-0.23313271880868,-0.25344790059353,-0.05246019024463,0.01628462406333,-0.02505961724053,0.06920467763959,0.02442357316099,-0.03721611395801,0.01818801111503,-0.00749618797172],[0.53648789255105,-0.2504987195602,-0.42163034350696,-0.43193942311114,-0.00275953611929,-0.03424681017675,0.04267842219415,-0.04678328784242,-0.10214864179676,0.26408300200955,0.14590772289388,0.15113130533216,-0.02459864859345,-0.17556493366449,-0.11202315195388,-0.18823009262115,-0.04060034127,0.05477720428674,0.0478866554818,0.0470440968812,-0.02217936801134]],z=[[0.98621192462708,-1.97223372919527,-1.97242384925416,0.97261396931306,0.98621192462708],[0.98500175787242,-1.96977855582618,-1.97000351574484,0.9702284756635,0.98500175787242],[0.97938932735214,-1.95835380975398,-1.95877865470428,0.95920349965459,0.97938932735214],[0.97531843204928,-1.95002759149878,-1.95063686409857,0.95124613669835,0.97531843204928],[0.97316523498161,-1.94561023566527,-1.94633046996323,0.94705070426118,0.97316523498161],[0.96454515552826,-1.92783286977036,-1.92909031105652,0.93034775234268,0.96454515552826],[0.96009142950541,-1.91858953033784,-1.92018285901082,0.92177618768381,0.96009142950541],[0.95856916599601,-1.9154210807478,-1.91713833199203,0.91885558323625,0.95856916599601],[0.94597685600279,-1.88903307939452,-1.89195371200558,0.89487434461664,0.94597685600279]];function X(h,$,_,v,T,E){for(;T--!=0;)_[v]=0.0000000001+h[$+0]*E[0]-_[v-1]*E[1]+h[$-1]*E[2]-_[v-2]*E[3]+h[$-2]*E[4]-_[v-3]*E[5]+h[$-3]*E[6]-_[v-4]*E[7]+h[$-4]*E[8]-_[v-5]*E[9]+h[$-5]*E[10]-_[v-6]*E[11]+h[$-6]*E[12]-_[v-7]*E[13]+h[$-7]*E[14]-_[v-8]*E[15]+h[$-8]*E[16]-_[v-9]*E[17]+h[$-9]*E[18]-_[v-10]*E[19]+h[$-10]*E[20],++v,++$}function j(h,$,_,v,T,E){for(;T--!=0;)_[v]=h[$+0]*E[0]-_[v-1]*E[1]+h[$-1]*E[2]-_[v-2]*E[3]+h[$-2]*E[4],++v,++$}function O(h,$){for(var _=0;_<MAX_ORDER;_++)h.linprebuf[_]=h.lstepbuf[_]=h.loutbuf[_]=h.rinprebuf[_]=h.rstepbuf[_]=h.routbuf[_]=0;switch(0|$){case 48000:h.reqindex=0;break;case 44100:h.reqindex=1;break;case 32000:h.reqindex=2;break;case 24000:h.reqindex=3;break;case 22050:h.reqindex=4;break;case 16000:h.reqindex=5;break;case 12000:h.reqindex=6;break;case 11025:h.reqindex=7;break;case 8000:h.reqindex=8;break;default:return INIT_GAIN_ANALYSIS_ERROR}return h.sampleWindow=0|($*d+W-1)/W,h.lsum=0,h.rsum=0,h.totsamp=0,Fo.ill(h.A,0),INIT_GAIN_ANALYSIS_OK}this.InitGainAnalysis=function(h,$){return O(h,$)!=INIT_GAIN_ANALYSIS_OK?INIT_GAIN_ANALYSIS_ERROR:(h.linpre=MAX_ORDER,h.rinpre=MAX_ORDER,h.lstep=MAX_ORDER,h.rstep=MAX_ORDER,h.lout=MAX_ORDER,h.rout=MAX_ORDER,Fo.fill(h.B,0),INIT_GAIN_ANALYSIS_OK)};function A(h){return h*h}this.AnalyzeSamples=function(h,$,_,v,T,E,D){var g,C,P,i,a,Z,U;if(E==0)return GAIN_ANALYSIS_OK;switch(U=0,a=E,D){case 1:v=$,T=_;break;case 2:break;default:return GAIN_ANALYSIS_ERROR}for(E<MAX_ORDER?(ci.arraycopy($,_,h.linprebuf,MAX_ORDER,E),ci.arraycopy(v,T,h.rinprebuf,MAX_ORDER,E)):(ci.arraycopy($,_,h.linprebuf,MAX_ORDER,MAX_ORDER),ci.arraycopy(v,T,h.rinprebuf,MAX_ORDER,MAX_ORDER));a>0;){Z=a>h.sampleWindow-h.totsamp?h.sampleWindow-h.totsamp:a,U<MAX_ORDER?(g=h.linpre+U,C=h.linprebuf,P=h.rinpre+U,i=h.rinprebuf,Z>MAX_ORDER-U&&(Z=MAX_ORDER-U)):(g=_+U,C=$,P=T+U,i=v),X(C,g,h.lstepbuf,h.lstep+h.totsamp,Z,b[h.reqindex]),X(i,P,h.rstepbuf,h.rstep+h.totsamp,Z,b[h.reqindex]),j(h.lstepbuf,h.lstep+h.totsamp,h.loutbuf,h.lout+h.totsamp,Z,z[h.reqindex]),j(h.rstepbuf,h.rstep+h.totsamp,h.routbuf,h.rout+h.totsamp,Z,z[h.reqindex]),g=h.lout+h.totsamp,C=h.loutbuf,P=h.rout+h.totsamp,i=h.routbuf;for(var x=Z%8;x--!=0;)h.lsum+=A(C[g++]),h.rsum+=A(i[P++]);for(x=Z/8;x--!=0;)h.lsum+=A(C[g+0])+A(C[g+1])+A(C[g+2])+A(C[g+3])+A(C[g+4])+A(C[g+5])+A(C[g+6])+A(C[g+7]),g+=8,h.rsum+=A(i[P+0])+A(i[P+1])+A(i[P+2])+A(i[P+3])+A(i[P+4])+A(i[P+5])+A(i[P+6])+A(i[P+7]),P+=8;if(a-=Z,U+=Z,h.totsamp+=Z,h.totsamp==h.sampleWindow){var F=Bt.STEPS_per_dB*10*Math.log10((h.lsum+h.rsum)/h.totsamp*0.5+0.0000000000000000000000000000000000001),L=F<=0?0:0|F;L>=h.A.length&&(L=h.A.length-1),h.A[L]++,h.lsum=h.rsum=0,ci.arraycopy(h.loutbuf,h.totsamp,h.loutbuf,0,MAX_ORDER),ci.arraycopy(h.routbuf,h.totsamp,h.routbuf,0,MAX_ORDER),ci.arraycopy(h.lstepbuf,h.totsamp,h.lstepbuf,0,MAX_ORDER),ci.arraycopy(h.rstepbuf,h.totsamp,h.rstepbuf,0,MAX_ORDER),h.totsamp=0}if(h.totsamp>h.sampleWindow)return GAIN_ANALYSIS_ERROR}return E<MAX_ORDER?(ci.arraycopy(h.linprebuf,E,h.linprebuf,0,MAX_ORDER-E),ci.arraycopy(h.rinprebuf,E,h.rinprebuf,0,MAX_ORDER-E),ci.arraycopy($,_,h.linprebuf,MAX_ORDER-E,E),ci.arraycopy(v,T,h.rinprebuf,MAX_ORDER-E,E)):(ci.arraycopy($,_+E-MAX_ORDER,h.linprebuf,0,MAX_ORDER),ci.arraycopy(v,T+E-MAX_ORDER,h.rinprebuf,0,MAX_ORDER)),GAIN_ANALYSIS_OK};function w(h,$){var _,v=0;for(_=0;_<$;_++)v+=h[_];if(v==0)return GAIN_NOT_ENOUGH_SAMPLES;var T=0|Math.ceil(v*(1-r));for(_=$;_-- >0&&!((T-=h[_])<=0););return t-_/Bt.STEPS_per_dB}this.GetTitleGain=function(h){for(var $=w(h.A,h.A.length),_=0;_<h.A.length;_++)h.B[_]+=h.A[_],h.A[_]=0;for(var _=0;_<MAX_ORDER;_++)h.linprebuf[_]=h.lstepbuf[_]=h.loutbuf[_]=h.rinprebuf[_]=h.rstepbuf[_]=h.routbuf[_]=0;return h.totsamp=0,h.lsum=h.rsum=0,$}}var le=Bt,ae=Ht,Si=ae.new_float,yo=ae.new_int,li=le;function Fr(){this.linprebuf=Si(li.MAX_ORDER*2),this.linpre=0,this.lstepbuf=Si(li.MAX_SAMPLES_PER_WINDOW+li.MAX_ORDER),this.lstep=0,this.loutbuf=Si(li.MAX_SAMPLES_PER_WINDOW+li.MAX_ORDER),this.lout=0,this.rinprebuf=Si(li.MAX_ORDER*2),this.rinpre=0,this.rstepbuf=Si(li.MAX_SAMPLES_PER_WINDOW+li.MAX_ORDER),this.rstep=0,this.routbuf=Si(li.MAX_SAMPLES_PER_WINDOW+li.MAX_ORDER),this.rout=0,this.sampleWindow=0,this.totsamp=0,this.lsum=0,this.rsum=0,this.freqindex=0,this.first=0,this.A=yo(0|li.STEPS_per_dB*li.MAX_dB),this.B=yo(0|li.STEPS_per_dB*li.MAX_dB)}var yr=Fr;function Xr(t){this.bits=t}var pe=Xr,Bn=Ht,Xo=Bn.new_float,Mr=Bn.new_int,Mo=Bn.assert,Lr=pe,Lo=ei(),Kr=Pn,Ur=Dn;function qr(t){var r=t;this.quantize=r,this.iteration_loop=function(d,W,b,z){var X=d.internal_flags,j=Xo(Kr.SFBMAX),O=Xo(576),A=Mr(2),w=0,h,$=X.l3_side,_=new Lr(w);this.quantize.rv.ResvFrameBegin(d,_),w=_.bits;for(var v=0;v<X.mode_gr;v++){h=this.quantize.qupvt.on_pe(d,W,A,w,v,v),X.mode_ext==Lo.MPG_MD_MS_LR&&(this.quantize.ms_convert(X.l3_side,v),this.quantize.qupvt.reduce_side(A,b[v],w,h));for(var T=0;T<X.channels_out;T++){var E,D,g=$.tt[v][T];g.block_type!=Lo.SHORT_TYPE?(E=0,D=X.PSY.mask_adjust-E):(E=0,D=X.PSY.mask_adjust_short-E),X.masking_lower=Math.pow(10,D*0.1),this.quantize.init_outer_loop(X,g),this.quantize.init_xrpow(X,g,O)&&(this.quantize.qupvt.calc_xmin(d,z[v][T],g,j),this.quantize.outer_loop(d,g,j,O,T,A[T])),this.quantize.iteration_finish_one(X,v,T),Mo(g.part2_3_length<=Ur.MAX_BITS_PER_CHANNEL),Mo(g.part2_3_length<=A[T])}}this.quantize.rv.ResvFrameEnd(X,w)}}var Or=qr;function xt(t,r,d,W){this.xlen=t,this.linmax=r,this.table=d,this.hlen=W}var pt={};pt.t1HB=[1,1,1,0];pt.t2HB=[1,2,1,3,1,1,3,2,0];pt.t3HB=[3,2,1,1,1,1,3,2,0];pt.t5HB=[1,2,6,5,3,1,4,4,7,5,7,1,6,1,1,0];pt.t6HB=[7,3,5,1,6,2,3,2,5,4,4,1,3,3,2,0];pt.t7HB=[1,2,10,19,16,10,3,3,7,10,5,3,11,4,13,17,8,4,12,11,18,15,11,2,7,6,9,14,3,1,6,4,5,3,2,0];pt.t8HB=[3,4,6,18,12,5,5,1,2,16,9,3,7,3,5,14,7,3,19,17,15,13,10,4,13,5,8,11,5,1,12,4,4,1,1,0];pt.t9HB=[7,5,9,14,15,7,6,4,5,5,6,7,7,6,8,8,8,5,15,6,9,10,5,1,11,7,9,6,4,1,14,4,6,2,6,0];pt.t10HB=[1,2,10,23,35,30,12,17,3,3,8,12,18,21,12,7,11,9,15,21,32,40,19,6,14,13,22,34,46,23,18,7,20,19,33,47,27,22,9,3,31,22,41,26,21,20,5,3,14,13,10,11,16,6,5,1,9,8,7,8,4,4,2,0];pt.t11HB=[3,4,10,24,34,33,21,15,5,3,4,10,32,17,11,10,11,7,13,18,30,31,20,5,25,11,19,59,27,18,12,5,35,33,31,58,30,16,7,5,28,26,32,19,17,15,8,14,14,12,9,13,14,9,4,1,11,4,6,6,6,3,2,0];pt.t12HB=[9,6,16,33,41,39,38,26,7,5,6,9,23,16,26,11,17,7,11,14,21,30,10,7,17,10,15,12,18,28,14,5,32,13,22,19,18,16,9,5,40,17,31,29,17,13,4,2,27,12,11,15,10,7,4,1,27,12,8,12,6,3,1,0];pt.t13HB=[1,5,14,21,34,51,46,71,42,52,68,52,67,44,43,19,3,4,12,19,31,26,44,33,31,24,32,24,31,35,22,14,15,13,23,36,59,49,77,65,29,40,30,40,27,33,42,16,22,20,37,61,56,79,73,64,43,76,56,37,26,31,25,14,35,16,60,57,97,75,114,91,54,73,55,41,48,53,23,24,58,27,50,96,76,70,93,84,77,58,79,29,74,49,41,17,47,45,78,74,115,94,90,79,69,83,71,50,59,38,36,15,72,34,56,95,92,85,91,90,86,73,77,65,51,44,43,42,43,20,30,44,55,78,72,87,78,61,46,54,37,30,20,16,53,25,41,37,44,59,54,81,66,76,57,54,37,18,39,11,35,33,31,57,42,82,72,80,47,58,55,21,22,26,38,22,53,25,23,38,70,60,51,36,55,26,34,23,27,14,9,7,34,32,28,39,49,75,30,52,48,40,52,28,18,17,9,5,45,21,34,64,56,50,49,45,31,19,12,15,10,7,6,3,48,23,20,39,36,35,53,21,16,23,13,10,6,1,4,2,16,15,17,27,25,20,29,11,17,12,16,8,1,1,0,1];pt.t15HB=[7,12,18,53,47,76,124,108,89,123,108,119,107,81,122,63,13,5,16,27,46,36,61,51,42,70,52,83,65,41,59,36,19,17,15,24,41,34,59,48,40,64,50,78,62,80,56,33,29,28,25,43,39,63,55,93,76,59,93,72,54,75,50,29,52,22,42,40,67,57,95,79,72,57,89,69,49,66,46,27,77,37,35,66,58,52,91,74,62,48,79,63,90,62,40,38,125,32,60,56,50,92,78,65,55,87,71,51,73,51,70,30,109,53,49,94,88,75,66,122,91,73,56,42,64,44,21,25,90,43,41,77,73,63,56,92,77,66,47,67,48,53,36,20,71,34,67,60,58,49,88,76,67,106,71,54,38,39,23,15,109,53,51,47,90,82,58,57,48,72,57,41,23,27,62,9,86,42,40,37,70,64,52,43,70,55,42,25,29,18,11,11,118,68,30,55,50,46,74,65,49,39,24,16,22,13,14,7,91,44,39,38,34,63,52,45,31,52,28,19,14,8,9,3,123,60,58,53,47,43,32,22,37,24,17,12,15,10,2,1,71,37,34,30,28,20,17,26,21,16,10,6,8,6,2,0];pt.t16HB=[1,5,14,44,74,63,110,93,172,149,138,242,225,195,376,17,3,4,12,20,35,62,53,47,83,75,68,119,201,107,207,9,15,13,23,38,67,58,103,90,161,72,127,117,110,209,206,16,45,21,39,69,64,114,99,87,158,140,252,212,199,387,365,26,75,36,68,65,115,101,179,164,155,264,246,226,395,382,362,9,66,30,59,56,102,185,173,265,142,253,232,400,388,378,445,16,111,54,52,100,184,178,160,133,257,244,228,217,385,366,715,10,98,48,91,88,165,157,148,261,248,407,397,372,380,889,884,8,85,84,81,159,156,143,260,249,427,401,392,383,727,713,708,7,154,76,73,141,131,256,245,426,406,394,384,735,359,710,352,11,139,129,67,125,247,233,229,219,393,743,737,720,885,882,439,4,243,120,118,115,227,223,396,746,742,736,721,712,706,223,436,6,202,224,222,218,216,389,386,381,364,888,443,707,440,437,1728,4,747,211,210,208,370,379,734,723,714,1735,883,877,876,3459,865,2,377,369,102,187,726,722,358,711,709,866,1734,871,3458,870,434,0,12,10,7,11,10,17,11,9,13,12,10,7,5,3,1,3];pt.t24HB=[15,13,46,80,146,262,248,434,426,669,653,649,621,517,1032,88,14,12,21,38,71,130,122,216,209,198,327,345,319,297,279,42,47,22,41,74,68,128,120,221,207,194,182,340,315,295,541,18,81,39,75,70,134,125,116,220,204,190,178,325,311,293,271,16,147,72,69,135,127,118,112,210,200,188,352,323,306,285,540,14,263,66,129,126,119,114,214,202,192,180,341,317,301,281,262,12,249,123,121,117,113,215,206,195,185,347,330,308,291,272,520,10,435,115,111,109,211,203,196,187,353,332,313,298,283,531,381,17,427,212,208,205,201,193,186,177,169,320,303,286,268,514,377,16,335,199,197,191,189,181,174,333,321,305,289,275,521,379,371,11,668,184,183,179,175,344,331,314,304,290,277,530,383,373,366,10,652,346,171,168,164,318,309,299,287,276,263,513,375,368,362,6,648,322,316,312,307,302,292,284,269,261,512,376,370,364,359,4,620,300,296,294,288,282,273,266,515,380,374,369,365,361,357,2,1033,280,278,274,267,264,259,382,378,372,367,363,360,358,356,0,43,20,19,17,15,13,11,9,7,6,4,7,5,3,1,3];pt.t32HB=[1,10,8,20,12,20,16,32,14,12,24,0,28,16,24,16];pt.t33HB=[15,28,26,48,22,40,36,64,14,24,20,32,12,16,8,0];pt.t1l=[1,4,3,5];pt.t2l=[1,4,7,4,5,7,6,7,8];pt.t3l=[2,3,7,4,4,7,6,7,8];pt.t5l=[1,4,7,8,4,5,8,9,7,8,9,10,8,8,9,10];pt.t6l=[3,4,6,8,4,4,6,7,5,6,7,8,7,7,8,9];pt.t7l=[1,4,7,9,9,10,4,6,8,9,9,10,7,7,9,10,10,11,8,9,10,11,11,11,8,9,10,11,11,12,9,10,11,12,12,12];pt.t8l=[2,4,7,9,9,10,4,4,6,10,10,10,7,6,8,10,10,11,9,10,10,11,11,12,9,9,10,11,12,12,10,10,11,11,13,13];pt.t9l=[3,4,6,7,9,10,4,5,6,7,8,10,5,6,7,8,9,10,7,7,8,9,9,10,8,8,9,9,10,11,9,9,10,10,11,11];pt.t10l=[1,4,7,9,10,10,10,11,4,6,8,9,10,11,10,10,7,8,9,10,11,12,11,11,8,9,10,11,12,12,11,12,9,10,11,12,12,12,12,12,10,11,12,12,13,13,12,13,9,10,11,12,12,12,13,13,10,10,11,12,12,13,13,13];pt.t11l=[2,4,6,8,9,10,9,10,4,5,6,8,10,10,9,10,6,7,8,9,10,11,10,10,8,8,9,11,10,12,10,11,9,10,10,11,11,12,11,12,9,10,11,12,12,13,12,13,9,9,9,10,11,12,12,12,9,9,10,11,12,12,12,12];pt.t12l=[4,4,6,8,9,10,10,10,4,5,6,7,9,9,10,10,6,6,7,8,9,10,9,10,7,7,8,8,9,10,10,10,8,8,9,9,10,10,10,11,9,9,10,10,10,11,10,11,9,9,9,10,10,11,11,12,10,10,10,11,11,11,11,12];pt.t13l=[1,5,7,8,9,10,10,11,10,11,12,12,13,13,14,14,4,6,8,9,10,10,11,11,11,11,12,12,13,14,14,14,7,8,9,10,11,11,12,12,11,12,12,13,13,14,15,15,8,9,10,11,11,12,12,12,12,13,13,13,13,14,15,15,9,9,11,11,12,12,13,13,12,13,13,14,14,15,15,16,10,10,11,12,12,12,13,13,13,13,14,13,15,15,16,16,10,11,12,12,13,13,13,13,13,14,14,14,15,15,16,16,11,11,12,13,13,13,14,14,14,14,15,15,15,16,18,18,10,10,11,12,12,13,13,14,14,14,14,15,15,16,17,17,11,11,12,12,13,13,13,15,14,15,15,16,16,16,18,17,11,12,12,13,13,14,14,15,14,15,16,15,16,17,18,19,12,12,12,13,14,14,14,14,15,15,15,16,17,17,17,18,12,13,13,14,14,15,14,15,16,16,17,17,17,18,18,18,13,13,14,15,15,15,16,16,16,16,16,17,18,17,18,18,14,14,14,15,15,15,17,16,16,19,17,17,17,19,18,18,13,14,15,16,16,16,17,16,17,17,18,18,21,20,21,18];pt.t15l=[3,5,6,8,8,9,10,10,10,11,11,12,12,12,13,14,5,5,7,8,9,9,10,10,10,11,11,12,12,12,13,13,6,7,7,8,9,9,10,10,10,11,11,12,12,13,13,13,7,8,8,9,9,10,10,11,11,11,12,12,12,13,13,13,8,8,9,9,10,10,11,11,11,11,12,12,12,13,13,13,9,9,9,10,10,10,11,11,11,11,12,12,13,13,13,14,10,9,10,10,10,11,11,11,11,12,12,12,13,13,14,14,10,10,10,11,11,11,11,12,12,12,12,12,13,13,13,14,10,10,10,11,11,11,11,12,12,12,12,13,13,14,14,14,10,10,11,11,11,11,12,12,12,13,13,13,13,14,14,14,11,11,11,11,12,12,12,12,12,13,13,13,13,14,15,14,11,11,11,11,12,12,12,12,13,13,13,13,14,14,14,15,12,12,11,12,12,12,13,13,13,13,13,13,14,14,15,15,12,12,12,12,12,13,13,13,13,14,14,14,14,14,15,15,13,13,13,13,13,13,13,13,14,14,14,14,15,15,14,15,13,13,13,13,13,13,13,14,14,14,14,14,15,15,15,15];pt.t16_5l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,11,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,11,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,12,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,13,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,12,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,13,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,13,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,13,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,13,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,14,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,13,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,14,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,14,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,14,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,14,11,11,11,12,12,13,13,13,14,14,14,14,14,14,14,12];pt.t16l=[1,5,7,9,10,10,11,11,12,12,12,13,13,13,14,10,4,6,8,9,10,11,11,11,12,12,12,13,14,13,14,10,7,8,9,10,11,11,12,12,13,12,13,13,13,14,14,11,9,9,10,11,11,12,12,12,13,13,14,14,14,15,15,12,10,10,11,11,12,12,13,13,13,14,14,14,15,15,15,11,10,10,11,11,12,13,13,14,13,14,14,15,15,15,16,12,11,11,11,12,13,13,13,13,14,14,14,14,15,15,16,12,11,11,12,12,13,13,13,14,14,15,15,15,15,17,17,12,11,12,12,13,13,13,14,14,15,15,15,15,16,16,16,12,12,12,12,13,13,14,14,15,15,15,15,16,15,16,15,13,12,13,12,13,14,14,14,14,15,16,16,16,17,17,16,12,13,13,13,13,14,14,15,16,16,16,16,16,16,15,16,13,13,14,14,14,14,15,15,15,15,17,16,16,16,16,18,13,15,14,14,14,15,15,16,16,16,18,17,17,17,19,17,13,14,15,13,14,16,16,15,16,16,17,18,17,19,17,16,13,10,10,10,11,11,12,12,12,13,13,13,13,13,13,13,10];pt.t24l=[4,5,7,8,9,10,10,11,11,12,12,12,12,12,13,10,5,6,7,8,9,10,10,11,11,11,12,12,12,12,12,10,7,7,8,9,9,10,10,11,11,11,11,12,12,12,13,9,8,8,9,9,10,10,10,11,11,11,11,12,12,12,12,9,9,9,9,10,10,10,10,11,11,11,12,12,12,12,13,9,10,9,10,10,10,10,11,11,11,11,12,12,12,12,12,9,10,10,10,10,10,11,11,11,11,12,12,12,12,12,13,9,11,10,10,10,11,11,11,11,12,12,12,12,12,13,13,10,11,11,11,11,11,11,11,11,11,12,12,12,12,13,13,10,11,11,11,11,11,11,11,12,12,12,12,12,13,13,13,10,12,11,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,11,11,11,12,12,12,12,12,12,13,13,13,13,10,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,10,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,10,13,12,12,12,12,12,12,13,13,13,13,13,13,13,13,10,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,6];pt.t32l=[1,5,5,7,5,8,7,9,5,7,7,9,7,9,9,10];pt.t33l=[4,5,5,6,5,6,6,7,5,6,6,7,6,7,7,8];pt.ht=[new xt(0,0,null,null),new xt(2,0,pt.t1HB,pt.t1l),new xt(3,0,pt.t2HB,pt.t2l),new xt(3,0,pt.t3HB,pt.t3l),new xt(0,0,null,null),new xt(4,0,pt.t5HB,pt.t5l),new xt(4,0,pt.t6HB,pt.t6l),new xt(6,0,pt.t7HB,pt.t7l),new xt(6,0,pt.t8HB,pt.t8l),new xt(6,0,pt.t9HB,pt.t9l),new xt(8,0,pt.t10HB,pt.t10l),new xt(8,0,pt.t11HB,pt.t11l),new xt(8,0,pt.t12HB,pt.t12l),new xt(16,0,pt.t13HB,pt.t13l),new xt(0,0,null,pt.t16_5l),new xt(16,0,pt.t15HB,pt.t15l),new xt(1,1,pt.t16HB,pt.t16l),new xt(2,3,pt.t16HB,pt.t16l),new xt(3,7,pt.t16HB,pt.t16l),new xt(4,15,pt.t16HB,pt.t16l),new xt(6,63,pt.t16HB,pt.t16l),new xt(8,255,pt.t16HB,pt.t16l),new xt(10,1023,pt.t16HB,pt.t16l),new xt(13,8191,pt.t16HB,pt.t16l),new xt(4,15,pt.t24HB,pt.t24l),new xt(5,31,pt.t24HB,pt.t24l),new xt(6,63,pt.t24HB,pt.t24l),new xt(7,127,pt.t24HB,pt.t24l),new xt(8,255,pt.t24HB,pt.t24l),new xt(9,511,pt.t24HB,pt.t24l),new xt(11,2047,pt.t24HB,pt.t24l),new xt(13,8191,pt.t24HB,pt.t24l),new xt(0,0,pt.t32HB,pt.t32l),new xt(0,0,pt.t33HB,pt.t33l)];pt.largetbl=[65540,327685,458759,589832,655369,655370,720906,720907,786443,786444,786444,851980,851980,851980,917517,655370,262149,393222,524295,589832,655369,720906,720906,720907,786443,786443,786444,851980,917516,851980,917516,655370,458759,524295,589832,655369,720905,720906,786442,786443,851979,786443,851979,851980,851980,917516,917517,720905,589832,589832,655369,720905,720906,786442,786442,786443,851979,851979,917515,917516,917516,983052,983052,786441,655369,655369,720905,720906,786442,786442,851978,851979,851979,917515,917516,917516,983052,983052,983053,720905,655370,655369,720906,720906,786442,851978,851979,917515,851979,917515,917516,983052,983052,983052,1048588,786441,720906,720906,720906,786442,851978,851979,851979,851979,917515,917516,917516,917516,983052,983052,1048589,786441,720907,720906,786442,786442,851979,851979,851979,917515,917516,983052,983052,983052,983052,1114125,1114125,786442,720907,786443,786443,851979,851979,851979,917515,917515,983051,983052,983052,983052,1048588,1048589,1048589,786442,786443,786443,786443,851979,851979,917515,917515,983052,983052,983052,983052,1048588,983053,1048589,983053,851978,786444,851979,786443,851979,917515,917516,917516,917516,983052,1048588,1048588,1048589,1114125,1114125,1048589,786442,851980,851980,851979,851979,917515,917516,983052,1048588,1048588,1048588,1048588,1048589,1048589,983053,1048589,851978,851980,917516,917516,917516,917516,983052,983052,983052,983052,1114124,1048589,1048589,1048589,1048589,1179661,851978,983052,917516,917516,917516,983052,983052,1048588,1048588,1048589,1179661,1114125,1114125,1114125,1245197,1114125,851978,917517,983052,851980,917516,1048588,1048588,983052,1048589,1048589,1114125,1179661,1114125,1245197,1114125,1048589,851978,655369,655369,655369,720905,720905,786441,786441,786441,851977,851977,851977,851978,851978,851978,851978,655366];pt.table23=[65538,262147,458759,262148,327684,458759,393222,458759,524296];pt.table56=[65539,262148,458758,524296,262148,327684,524294,589831,458757,524294,589831,655368,524295,524295,589832,655369];pt.bitrate_table=[[0,8,16,24,32,40,48,56,64,80,96,112,128,144,160,-1],[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],[0,8,16,24,32,40,48,56,64,-1,-1,-1,-1,-1,-1,-1]];pt.samplerate_table=[[22050,24000,16000,-1],[44100,48000,32000,-1],[11025,12000,8000,-1]];pt.scfsi_band=[0,6,11,16,21];var Rn=pt,vn,Ko;function ge(){if(Ko)return vn;Ko=1;var t=he,r=Ht,d=r.VbrMode,W=r.Float,b=r.Util,z=r.new_float,X=r.new_int,j=r.assert,O=ei(),A=pe,w=Dn;h.Q_MAX=257,h.Q_MAX2=116,h.LARGE_BITS=1e5,h.IXMAX_VAL=8206;function h(){var $=An(),_=null,v=null,T=null;this.setModules=function(G,K,V){_=G,v=K,T=V};function E(G){return j(0<=G+h.Q_MAX2&&G<h.Q_MAX),U[G+h.Q_MAX2]}this.IPOW20=function(G){return j(0<=G&&G<h.Q_MAX),x[G]};var D=0.0000000000000002220446049250313,g=h.IXMAX_VAL,C=g+2,P=h.Q_MAX,i=h.Q_MAX2;h.LARGE_BITS;var a=100;this.nr_of_sfb_block=[[[6,5,5,5],[9,9,9,9],[6,9,9,9]],[[6,5,7,3],[9,9,12,6],[6,9,12,6]],[[11,10,0,0],[18,18,0,0],[15,18,0,0]],[[7,7,7,0],[12,12,12,0],[6,15,12,0]],[[6,6,6,3],[12,9,9,6],[6,12,9,6]],[[8,8,5,0],[15,12,9,0],[6,18,9,0]]];var Z=[0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,2,2,3,3,3,2,0];this.pretab=Z,this.sfBandIndex=[new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,24,32,42,56,74,100,132,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,332,394,464,540,576],[0,4,8,12,18,26,36,48,62,80,104,136,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576],[0,4,8,12,16,22,30,40,52,66,84,106,136,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576],[0,4,8,12,16,22,28,38,50,64,80,100,126,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576],[0,4,8,12,16,22,30,42,58,78,104,138,180,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576],[0,4,8,12,18,26,36,48,62,80,104,134,174,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]),new t([0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576],[0,8,16,24,36,52,72,96,124,160,162,164,166,192],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0])];var U=z(P+i+1),x=z(P),F=z(C),L=z(C);this.adj43=L;function at(G,K){var V=T.ATHformula(K,G);return V-=a,V=Math.pow(10,V/10+G.ATHlower),V}function k(G){for(var K=G.internal_flags.ATH.l,V=G.internal_flags.ATH.psfb21,q=G.internal_flags.ATH.s,it=G.internal_flags.ATH.psfb12,Q=G.internal_flags,c=G.out_samplerate,s=0;s<O.SBMAX_l;s++){var o=Q.scalefac_band.l[s],l=Q.scalefac_band.l[s+1];K[s]=W.MAX_VALUE;for(var f=o;f<l;f++){var I=f*c/1152,ot=at(G,I);K[s]=Math.min(K[s],ot)}}for(var s=0;s<O.PSFB21;s++){var o=Q.scalefac_band.psfb21[s],l=Q.scalefac_band.psfb21[s+1];V[s]=W.MAX_VALUE;for(var f=o;f<l;f++){var I=f*c/1152,ot=at(G,I);V[s]=Math.min(V[s],ot)}}for(var s=0;s<O.SBMAX_s;s++){var o=Q.scalefac_band.s[s],l=Q.scalefac_band.s[s+1];q[s]=W.MAX_VALUE;for(var f=o;f<l;f++){var I=f*c/384,ot=at(G,I);q[s]=Math.min(q[s],ot)}q[s]*=Q.scalefac_band.s[s+1]-Q.scalefac_band.s[s]}for(var s=0;s<O.PSFB12;s++){var o=Q.scalefac_band.psfb12[s],l=Q.scalefac_band.psfb12[s+1];it[s]=W.MAX_VALUE;for(var f=o;f<l;f++){var I=f*c/384,ot=at(G,I);it[s]=Math.min(it[s],ot)}it[s]*=Q.scalefac_band.s[13]-Q.scalefac_band.s[12]}if(G.noATH){for(var s=0;s<O.SBMAX_l;s++)K[s]=0.00000000000000000001;for(var s=0;s<O.PSFB21;s++)V[s]=0.00000000000000000001;for(var s=0;s<O.SBMAX_s;s++)q[s]=0.00000000000000000001;for(var s=0;s<O.PSFB12;s++)it[s]=0.00000000000000000001}Q.ATH.floor=10*Math.log10(at(G,-1))}this.iteration_init=function(G){var K=G.internal_flags,V=K.l3_side,q;if(K.iteration_init_init==0){for(K.iteration_init_init=1,V.main_data_begin=0,k(G),F[0]=0,q=1;q<C;q++)F[q]=Math.pow(q,1.3333333333333333);for(q=0;q<C-1;q++)L[q]=q+1-Math.pow(0.5*(F[q]+F[q+1]),0.75);for(L[q]=0.5,q=0;q<P;q++)x[q]=Math.pow(2,(q-210)*-0.1875);for(q=0;q<=P+i;q++)U[q]=Math.pow(2,(q-210-i)*0.25);_.huffman_init(K);{var it,Q,c,s;for(q=G.exp_nspsytune>>2&63,q>=32&&(q-=64),it=Math.pow(10,q/4/10),q=G.exp_nspsytune>>8&63,q>=32&&(q-=64),Q=Math.pow(10,q/4/10),q=G.exp_nspsytune>>14&63,q>=32&&(q-=64),c=Math.pow(10,q/4/10),q=G.exp_nspsytune>>20&63,q>=32&&(q-=64),s=c*Math.pow(10,q/4/10),q=0;q<O.SBMAX_l;q++){var o;q<=6?o=it:q<=13?o=Q:q<=20?o=c:o=s,K.nsPsy.longfact[q]=o}for(q=0;q<O.SBMAX_s;q++){var o;q<=5?o=it:q<=10?o=Q:q<=11?o=c:o=s,K.nsPsy.shortfact[q]=o}}}},this.on_pe=function(G,K,V,q,it,Q){var c=G.internal_flags,s=0,o,l=X(2),f,I=new A(s),ot=v.ResvMaxBits(G,q,I,Q);s=I.bits;var y=s+ot;for(y>w.MAX_BITS_PER_GRANULE&&(y=w.MAX_BITS_PER_GRANULE),o=0,f=0;f<c.channels_out;++f)V[f]=Math.min(w.MAX_BITS_PER_CHANNEL,s/c.channels_out),l[f]=0|V[f]*K[it][f]/700-V[f],l[f]>q*3/4&&(l[f]=q*3/4),l[f]<0&&(l[f]=0),l[f]+V[f]>w.MAX_BITS_PER_CHANNEL&&(l[f]=Math.max(0,w.MAX_BITS_PER_CHANNEL-V[f])),o+=l[f];if(o>ot)for(f=0;f<c.channels_out;++f)l[f]=ot*l[f]/o;for(f=0;f<c.channels_out;++f)V[f]+=l[f],ot-=l[f];for(o=0,f=0;f<c.channels_out;++f)o+=V[f];if(o>w.MAX_BITS_PER_GRANULE){var B=0;for(f=0;f<c.channels_out;++f)V[f]*=w.MAX_BITS_PER_GRANULE,V[f]/=o,B+=V[f]}return y},this.reduce_side=function(G,K,V,q){j(G[0]+G[1]<=w.MAX_BITS_PER_GRANULE);var it=0.33*(0.5-K)/0.5;it<0&&(it=0),it>0.5&&(it=0.5);var Q=0|it*0.5*(G[0]+G[1]);Q>w.MAX_BITS_PER_CHANNEL-G[0]&&(Q=w.MAX_BITS_PER_CHANNEL-G[0]),Q<0&&(Q=0),G[1]>=125&&(G[1]-Q>125?(G[0]<V&&(G[0]+=Q),G[1]-=Q):(G[0]+=G[1]-125,G[1]=125)),Q=G[0]+G[1],Q>q&&(G[0]=q*G[0]/Q,G[1]=q*G[1]/Q),j(G[0]<=w.MAX_BITS_PER_CHANNEL),j(G[1]<=w.MAX_BITS_PER_CHANNEL),j(G[0]+G[1]<=w.MAX_BITS_PER_GRANULE)},this.athAdjust=function(G,K,V){var q=90.30873362,it=94.82444863,Q=b.FAST_LOG10_X(K,10),c=G*G,s=0;return Q-=V,c>0.00000000000000000001&&(s=1+b.FAST_LOG10_X(c,10/q)),s<0&&(s=0),Q*=s,Q+=V+q-it,Math.pow(10,0.1*Q)},this.calc_xmin=function(G,K,V,q){var it=0,Q=G.internal_flags,c,s=0,o=0,l=Q.ATH,f=V.xr,I=G.VBR==d.vbr_mtrh?1:0,ot=Q.masking_lower;for((G.VBR==d.vbr_mtrh||G.VBR==d.vbr_mt)&&(ot=1),c=0;c<V.psy_lmax;c++){var y,B,dt,gt,ft,Dt;G.VBR==d.vbr_rh||G.VBR==d.vbr_mtrh?B=athAdjust(l.adjust,l.l[c],l.floor):B=l.adjust*l.l[c],ft=V.width[c],dt=B/ft,gt=D,Dt=ft>>1,y=0;do{var Pt,Wt;Pt=f[s]*f[s],y+=Pt,gt+=Pt<dt?Pt:dt,s++,Wt=f[s]*f[s],y+=Wt,gt+=Wt<dt?Wt:dt,s++}while(--Dt>0);if(y>B&&o++,c==O.SBPSY_l){var Zt=B*Q.nsPsy.longfact[c];gt<Zt&&(gt=Zt)}if(I!=0&&(B=gt),!G.ATHonly){var Vt=K.en.l[c];if(Vt>0){var Zt;Zt=y*K.thm.l[c]*ot/Vt,I!=0&&(Zt*=Q.nsPsy.longfact[c]),B<Zt&&(B=Zt)}}I!=0?q[it++]=B:q[it++]=B*Q.nsPsy.longfact[c]}var mi=575;if(V.block_type!=O.SHORT_TYPE)for(var e=576;e--!=0&&$.EQ(f[e],0);)mi=e;V.max_nonzero_coeff=mi;for(var p=V.sfb_smin;c<V.psymax;p++,c+=3){var ft,Ct,Jt;for(G.VBR==d.vbr_rh||G.VBR==d.vbr_mtrh?Jt=athAdjust(l.adjust,l.s[p],l.floor):Jt=l.adjust*l.s[p],ft=V.width[c],Ct=0;Ct<3;Ct++){var y=0,B,dt,gt,Dt=ft>>1;dt=Jt/ft,gt=D;do{var Pt,Wt;Pt=f[s]*f[s],y+=Pt,gt+=Pt<dt?Pt:dt,s++,Wt=f[s]*f[s],y+=Wt,gt+=Wt<dt?Wt:dt,s++}while(--Dt>0);if(y>Jt&&o++,p==O.SBPSY_s){var Zt=Jt*Q.nsPsy.shortfact[p];gt<Zt&&(gt=Zt)}if(I!=0?B=gt:B=Jt,!G.ATHonly&&!G.ATHshort){var Vt=K.en.s[p][Ct];if(Vt>0){var Zt;Zt=y*K.thm.s[p][Ct]*ot/Vt,I!=0&&(Zt*=Q.nsPsy.shortfact[p]),B<Zt&&(B=Zt)}}I!=0?q[it++]=B:q[it++]=B*Q.nsPsy.shortfact[p]}G.useTemporal&&(q[it-3]>q[it-3+1]&&(q[it-3+1]+=(q[it-3]-q[it-3+1])*Q.decay),q[it-3+1]>q[it-3+2]&&(q[it-3+2]+=(q[it-3+1]-q[it-3+2])*Q.decay))}return o};function n(G){this.s=G}this.calc_noise_core=function(G,K,V,q){var it=0,Q=K.s,c=G.l3_enc;if(Q>G.count1)for(;V--!=0;){var s;s=G.xr[Q],Q++,it+=s*s,s=G.xr[Q],Q++,it+=s*s}else if(Q>G.big_values){var o=z(2);for(o[0]=0,o[1]=q;V--!=0;){var s;s=Math.abs(G.xr[Q])-o[c[Q]],Q++,it+=s*s,s=Math.abs(G.xr[Q])-o[c[Q]],Q++,it+=s*s}}else for(;V--!=0;){var s;s=Math.abs(G.xr[Q])-F[c[Q]]*q,Q++,it+=s*s,s=Math.abs(G.xr[Q])-F[c[Q]]*q,Q++,it+=s*s}return K.s=Q,it},this.calc_noise=function(G,K,V,q,it){var Q=0,c=0,s,o,l=0,f=0,I=0,ot=-20,y=0,B=G.scalefac,dt=0;for(q.over_SSD=0,s=0;s<G.psymax;s++){var gt=G.global_gain-(B[dt++]+(G.preflag!=0?Z[s]:0)<<G.scalefac_scale+1)-G.subblock_gain[G.window[s]]*8,ft=0;if(it!=null&&it.step[s]==gt)ft=it.noise[s],y+=G.width[s],V[Q++]=ft/K[c++],ft=it.noise_log[s];else{var Dt=E(gt);if(o=G.width[s]>>1,y+G.width[s]>G.max_nonzero_coeff){var Pt;Pt=G.max_nonzero_coeff-y+1,Pt>0?o=Pt>>1:o=0}var Wt=new n(y);ft=this.calc_noise_core(G,Wt,o,Dt),y=Wt.s,it!=null&&(it.step[s]=gt,it.noise[s]=ft),ft=V[Q++]=ft/K[c++],ft=b.FAST_LOG10(Math.max(ft,0.00000000000000000001)),it!=null&&(it.noise_log[s]=ft)}if(it!=null&&(it.global_gain=G.global_gain),I+=ft,ft>0){var Zt;Zt=Math.max(0|ft*10+0.5,1),q.over_SSD+=Zt*Zt,l++,f+=ft}ot=Math.max(ot,ft)}return q.over_count=l,q.tot_noise=I,q.over_noise=f,q.max_noise=ot,l},this.set_pinfo=function(G,K,V,q,it){var Q=G.internal_flags,c,s,o,l,f,I=K.scalefac_scale==0?0.5:1,ot=K.scalefac,y=z(L3Side.SFBMAX),B=z(L3Side.SFBMAX),dt=new CalcNoiseResult;calc_xmin(G,V,K,y),calc_noise(K,y,B,dt,null);var gt=0;for(s=K.sfb_lmax,K.block_type!=O.SHORT_TYPE&&K.mixed_block_flag==0&&(s=22),c=0;c<s;c++){var ft=Q.scalefac_band.l[c],Dt=Q.scalefac_band.l[c+1],Pt=Dt-ft;for(l=0;gt<Dt;gt++)l+=K.xr[gt]*K.xr[gt];l/=Pt,f=1000000000000000,Q.pinfo.en[q][it][c]=f*l,Q.pinfo.xfsf[q][it][c]=f*y[c]*B[c]/Pt,V.en.l[c]>0&&!G.ATHonly?l=l/V.en.l[c]:l=0,Q.pinfo.thr[q][it][c]=f*Math.max(l*V.thm.l[c],Q.ATH.l[c]),Q.pinfo.LAMEsfb[q][it][c]=0,K.preflag!=0&&c>=11&&(Q.pinfo.LAMEsfb[q][it][c]=-I*Z[c]),c<O.SBPSY_l&&(j(ot[c]>=0),Q.pinfo.LAMEsfb[q][it][c]-=I*ot[c])}if(K.block_type==O.SHORT_TYPE)for(s=c,c=K.sfb_smin;c<O.SBMAX_s;c++)for(var ft=Q.scalefac_band.s[c],Dt=Q.scalefac_band.s[c+1],Pt=Dt-ft,Wt=0;Wt<3;Wt++){for(l=0,o=ft;o<Dt;o++)l+=K.xr[gt]*K.xr[gt],gt++;l=Math.max(l/Pt,0.00000000000000000001),f=1000000000000000,Q.pinfo.en_s[q][it][3*c+Wt]=f*l,Q.pinfo.xfsf_s[q][it][3*c+Wt]=f*y[s]*B[s]/Pt,V.en.s[c][Wt]>0?l=l/V.en.s[c][Wt]:l=0,(G.ATHonly||G.ATHshort)&&(l=0),Q.pinfo.thr_s[q][it][3*c+Wt]=f*Math.max(l*V.thm.s[c][Wt],Q.ATH.s[c]),Q.pinfo.LAMEsfb_s[q][it][3*c+Wt]=-2*K.subblock_gain[Wt],c<O.SBPSY_s&&(Q.pinfo.LAMEsfb_s[q][it][3*c+Wt]-=I*ot[s]),s++}Q.pinfo.LAMEqss[q][it]=K.global_gain,Q.pinfo.LAMEmainbits[q][it]=K.part2_3_length+K.part2_length,Q.pinfo.LAMEsfbits[q][it]=K.part2_length,Q.pinfo.over[q][it]=dt.over_count,Q.pinfo.max_noise[q][it]=dt.max_noise*10,Q.pinfo.over_noise[q][it]=dt.over_noise*10,Q.pinfo.tot_noise[q][it]=dt.tot_noise*10,Q.pinfo.over_SSD[q][it]=dt.over_SSD}}return vn=h,vn}var Vn,Uo;function ue(){if(Uo)return Vn;Uo=1;var t=Ht,r=t.System,d=t.Arrays,W=t.new_int,b=t.assert,z=ei(),X=Rn,j=In,O=ge();function A(){var w=null;this.qupvt=null,this.setModules=function(Q){this.qupvt=Q,w=Q};function h(Q){this.bits=0|Q}var $=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,1],[1,1],[1,1],[1,2],[2,2],[2,3],[2,3],[3,4],[3,4],[3,4],[4,5],[4,5],[4,6],[5,6],[5,6],[5,7],[6,7],[6,7]];function _(Q,c,s,o,l,f){var I=0.5946/c;for(Q=Q>>1;Q--!=0;)l[f++]=I>s[o++]?0:1,l[f++]=I>s[o++]?0:1}function v(Q,c,s,o,l,f){Q=Q>>1;var I=Q%2;for(Q=Q>>1;Q--!=0;){var ot,y,B,dt,gt,ft,Dt,Pt;ot=s[o++]*c,y=s[o++]*c,gt=0|ot,B=s[o++]*c,ft=0|y,dt=s[o++]*c,Dt=0|B,ot+=w.adj43[gt],Pt=0|dt,y+=w.adj43[ft],l[f++]=0|ot,B+=w.adj43[Dt],l[f++]=0|y,dt+=w.adj43[Pt],l[f++]=0|B,l[f++]=0|dt}if(I!=0){var ot,y,gt,ft;ot=s[o++]*c,y=s[o++]*c,gt=0|ot,ft=0|y,ot+=w.adj43[gt],y+=w.adj43[ft],l[f++]=0|ot,l[f++]=0|y}}function T(Q,c,s,o,l){var f,I,ot=0,y,B=0,dt=0,gt=0,ft=c,Dt=0,Pt=ft,Wt=0,Zt=Q,Vt=0;for(y=l!=null&&o.global_gain==l.global_gain,o.block_type==z.SHORT_TYPE?I=38:I=21,f=0;f<=I;f++){var mi=-1;if((y||o.block_type==z.NORM_TYPE)&&(mi=o.global_gain-(o.scalefac[f]+(o.preflag!=0?w.pretab[f]:0)<<o.scalefac_scale+1)-o.subblock_gain[o.window[f]]*8),b(o.width[f]>=0),y&&l.step[f]==mi)B!=0&&(v(B,s,Zt,Vt,Pt,Wt),B=0),dt!=0&&(_(dt,s,Zt,Vt,Pt,Wt),dt=0);else{var e=o.width[f];if(ot+o.width[f]>o.max_nonzero_coeff){var p;p=o.max_nonzero_coeff-ot+1,d.fill(c,o.max_nonzero_coeff,576,0),e=p,e<0&&(e=0),f=I+1}if(B==0&&dt==0&&(Pt=ft,Wt=Dt,Zt=Q,Vt=gt),l!=null&&l.sfb_count1>0&&f>=l.sfb_count1&&l.step[f]>0&&mi>=l.step[f]?(B!=0&&(v(B,s,Zt,Vt,Pt,Wt),B=0,Pt=ft,Wt=Dt,Zt=Q,Vt=gt),dt+=e):(dt!=0&&(_(dt,s,Zt,Vt,Pt,Wt),dt=0,Pt=ft,Wt=Dt,Zt=Q,Vt=gt),B+=e),e<=0){dt!=0&&(_(dt,s,Zt,Vt,Pt,Wt),dt=0),B!=0&&(v(B,s,Zt,Vt,Pt,Wt),B=0);break}}f<=I&&(Dt+=o.width[f],gt+=o.width[f],ot+=o.width[f])}B!=0&&(v(B,s,Zt,Vt,Pt,Wt),B=0),dt!=0&&(_(dt,s,Zt,Vt,Pt,Wt),dt=0)}function E(Q,c,s){var o=0,l=0;do{var f=Q[c++],I=Q[c++];o<f&&(o=f),l<I&&(l=I)}while(c<s);return o<l&&(o=l),o}function D(Q,c,s,o,l,f){var I=X.ht[o].xlen*65536+X.ht[l].xlen,ot=0,y;do{var B=Q[c++],dt=Q[c++];B!=0&&(B>14&&(B=15,ot+=I),B*=16),dt!=0&&(dt>14&&(dt=15,ot+=I),B+=dt),ot+=X.largetbl[B]}while(c<s);return y=ot&65535,ot>>=16,ot>y&&(ot=y,o=l),f.bits+=ot,o}function g(Q,c,s,o){var l=0,f=X.ht[1].hlen;do{var I=Q[c+0]*2+Q[c+1];c+=2,l+=f[I]}while(c<s);return o.bits+=l,1}function C(Q,c,s,o,l){var f=0,I,ot=X.ht[o].xlen,y;o==2?y=X.table23:y=X.table56;do{var B=Q[c+0]*ot+Q[c+1];c+=2,f+=y[B]}while(c<s);return I=f&65535,f>>=16,f>I&&(f=I,o++),l.bits+=f,o}function P(Q,c,s,o,l){var f=0,I=0,ot=0,y=X.ht[o].xlen,B=X.ht[o].hlen,dt=X.ht[o+1].hlen,gt=X.ht[o+2].hlen;do{var ft=Q[c+0]*y+Q[c+1];c+=2,f+=B[ft],I+=dt[ft],ot+=gt[ft]}while(c<s);var Dt=o;return f>I&&(f=I,Dt++),f>ot&&(f=ot,Dt=o+2),l.bits+=f,Dt}var i=[1,2,5,7,7,10,10,13,13,13,13,13,13,13,13];function a(Q,c,s,o){var l=E(Q,c,s);switch(l){case 0:return l;case 1:return g(Q,c,s,o);case 2:case 3:return C(Q,c,s,i[l-1],o);case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:return P(Q,c,s,i[l-1],o);default:if(l>O.IXMAX_VAL)return o.bits=O.LARGE_BITS,-1;l-=15;var f;for(f=24;f<32&&!(X.ht[f].linmax>=l);f++);var I;for(I=f-8;I<24&&!(X.ht[I].linmax>=l);I++);return D(Q,c,s,I,f,o)}}this.noquant_count_bits=function(Q,c,s){var o=c.l3_enc,l=Math.min(576,c.max_nonzero_coeff+2>>1<<1);for(s!=null&&(s.sfb_count1=0);l>1&&!(o[l-1]|o[l-2]);l-=2);c.count1=l;for(var f=0,I=0;l>3;l-=4){var ot;if(((o[l-1]|o[l-2]|o[l-3]|o[l-4])&2147483647)>1)break;ot=((o[l-4]*2+o[l-3])*2+o[l-2])*2+o[l-1],f+=X.t32l[ot],I+=X.t33l[ot]}var y=f;if(c.count1table_select=0,f>I&&(y=I,c.count1table_select=1),c.count1bits=y,c.big_values=l,l==0)return y;if(c.block_type==z.SHORT_TYPE)f=3*Q.scalefac_band.s[3],f>c.big_values&&(f=c.big_values),I=c.big_values;else if(c.block_type==z.NORM_TYPE){if(f=c.region0_count=Q.bv_scf[l-2],I=c.region1_count=Q.bv_scf[l-1],b(f+I+2<z.SBPSY_l),I=Q.scalefac_band.l[f+I+2],f=Q.scalefac_band.l[f+1],I<l){var B=new h(y);c.table_select[2]=a(o,I,l,B),y=B.bits}}else c.region0_count=7,c.region1_count=z.SBMAX_l-1-7-1,f=Q.scalefac_band.l[8],I=l,f>I&&(f=I);if(f=Math.min(f,l),I=Math.min(I,l),0<f){var B=new h(y);c.table_select[0]=a(o,0,f,B),y=B.bits}if(f<I){var B=new h(y);c.table_select[1]=a(o,f,I,B),y=B.bits}if(Q.use_best_huffman==2&&(c.part2_3_length=y,best_huffman_divide(Q,c),y=c.part2_3_length),s!=null&&c.block_type==z.NORM_TYPE){for(var dt=0;Q.scalefac_band.l[dt]<c.big_values;)dt++;s.sfb_count1=dt}return y},this.count_bits=function(Q,c,s,o){var l=s.l3_enc,f=O.IXMAX_VAL/w.IPOW20(s.global_gain);if(s.xrpow_max>f)return O.LARGE_BITS;if(T(c,l,w.IPOW20(s.global_gain),s,o),Q.substep_shaping&2)for(var I=0,ot=s.global_gain+s.scalefac_scale,y=0.634521682242439/w.IPOW20(ot),B=0;B<s.sfbmax;B++){var dt=s.width[B];if(Q.pseudohalf[B]==0)I+=dt;else{var gt;for(gt=I,I+=dt;gt<I;++gt)l[gt]=c[gt]>=y?l[gt]:0}}return this.noquant_count_bits(Q,s,o)};function Z(Q,c,s,o,l,f,I){for(var ot=c.big_values,y=0;y<=22;y++)o[y]=O.LARGE_BITS;for(var y=0;y<16;y++){var B=Q.scalefac_band.l[y+1];if(B>=ot)break;var dt=0,gt=new h(dt),ft=a(s,0,B,gt);dt=gt.bits;for(var Dt=0;Dt<8;Dt++){var Pt=Q.scalefac_band.l[y+Dt+2];if(Pt>=ot)break;var Wt=dt;gt=new h(Wt);var Zt=a(s,B,Pt,gt);Wt=gt.bits,o[y+Dt]>Wt&&(o[y+Dt]=Wt,l[y+Dt]=y,f[y+Dt]=ft,I[y+Dt]=Zt)}}}function U(Q,c,s,o,l,f,I,ot){for(var y=c.big_values,B=2;B<z.SBMAX_l+1;B++){var dt=Q.scalefac_band.l[B];if(dt>=y)break;var gt=l[B-2]+c.count1bits;if(s.part2_3_length<=gt)break;var ft=new h(gt),Dt=a(o,dt,y,ft);gt=ft.bits,!(s.part2_3_length<=gt)&&(s.assign(c),s.part2_3_length=gt,s.region0_count=f[B-2],s.region1_count=B-2-f[B-2],s.table_select[0]=I[B-2],s.table_select[1]=ot[B-2],s.table_select[2]=Dt)}}this.best_huffman_divide=function(Q,c){var s=new j,o=c.l3_enc,l=W(23),f=W(23),I=W(23),ot=W(23);if(!(c.block_type==z.SHORT_TYPE&&Q.mode_gr==1)){s.assign(c),c.block_type==z.NORM_TYPE&&(Z(Q,c,o,l,f,I,ot),U(Q,s,c,o,l,f,I,ot));var y=s.big_values;if(!(y==0||(o[y-2]|o[y-1])>1)&&(y=c.count1+2,!(y>576))){s.assign(c),s.count1=y;for(var B=0,dt=0;y>s.big_values;y-=4){var gt=((o[y-4]*2+o[y-3])*2+o[y-2])*2+o[y-1];B+=X.t32l[gt],dt+=X.t33l[gt]}if(s.big_values=y,s.count1table_select=0,B>dt&&(B=dt,s.count1table_select=1),s.count1bits=B,s.block_type==z.NORM_TYPE)U(Q,s,c,o,l,f,I,ot);else{if(s.part2_3_length=B,B=Q.scalefac_band.l[8],B>y&&(B=y),B>0){var ft=new h(s.part2_3_length);s.table_select[0]=a(o,0,B,ft),s.part2_3_length=ft.bits}if(y>B){var ft=new h(s.part2_3_length);s.table_select[1]=a(o,B,y,ft),s.part2_3_length=ft.bits}c.part2_3_length>s.part2_3_length&&c.assign(s)}}}};var x=[1,1,1,1,8,2,2,2,4,4,4,8,8,8,16,16],F=[1,2,4,8,1,2,4,8,2,4,8,2,4,8,4,8],L=[0,0,0,0,3,1,1,1,2,2,2,3,3,3,4,4],at=[0,1,2,3,0,1,2,3,1,2,3,1,2,3,2,3];A.slen1_tab=L,A.slen2_tab=at;function k(Q,c){for(var s,o=c.tt[1][Q],l=c.tt[0][Q],f=0;f<X.scfsi_band.length-1;f++){for(s=X.scfsi_band[f];s<X.scfsi_band[f+1]&&!(l.scalefac[s]!=o.scalefac[s]&&o.scalefac[s]>=0);s++);if(s==X.scfsi_band[f+1]){for(s=X.scfsi_band[f];s<X.scfsi_band[f+1];s++)o.scalefac[s]=-1;c.scfsi[Q][f]=1}}var I=0,ot=0;for(s=0;s<11;s++)o.scalefac[s]!=-1&&(ot++,I<o.scalefac[s]&&(I=o.scalefac[s]));for(var y=0,B=0;s<z.SBPSY_l;s++)o.scalefac[s]!=-1&&(B++,y<o.scalefac[s]&&(y=o.scalefac[s]));for(var f=0;f<16;f++)if(I<x[f]&&y<F[f]){var dt=L[f]*ot+at[f]*B;o.part2_length>dt&&(o.part2_length=dt,o.scalefac_compress=f)}}this.best_scalefac_store=function(Q,c,s,o){var l=o.tt[c][s],f,I,ot,y,B=0;for(ot=0,f=0;f<l.sfbmax;f++){var dt=l.width[f];for(ot+=dt,y=-dt;y<0&&l.l3_enc[y+ot]==0;y++);y==0&&(l.scalefac[f]=B=-2)}if(l.scalefac_scale==0&&l.preflag==0){var gt=0;for(f=0;f<l.sfbmax;f++)l.scalefac[f]>0&&(gt|=l.scalefac[f]);if(!(gt&1)&&gt!=0){for(f=0;f<l.sfbmax;f++)l.scalefac[f]>0&&(l.scalefac[f]>>=1);l.scalefac_scale=B=1}}if(l.preflag==0&&l.block_type!=z.SHORT_TYPE&&Q.mode_gr==2){for(f=11;f<z.SBPSY_l&&!(l.scalefac[f]<w.pretab[f]&&l.scalefac[f]!=-2);f++);if(f==z.SBPSY_l){for(f=11;f<z.SBPSY_l;f++)l.scalefac[f]>0&&(l.scalefac[f]-=w.pretab[f]);l.preflag=B=1}}for(I=0;I<4;I++)o.scfsi[s][I]=0;for(Q.mode_gr==2&&c==1&&o.tt[0][s].block_type!=z.SHORT_TYPE&&o.tt[1][s].block_type!=z.SHORT_TYPE&&(k(s,o),B=0),f=0;f<l.sfbmax;f++)l.scalefac[f]==-2&&(l.scalefac[f]=0);B!=0&&(Q.mode_gr==2?this.scale_bitcount(l):this.scale_bitcount_lsf(Q,l))};function n(Q,c){for(var s=0;s<c;++s)if(Q[s]<0)return!1;return!0}var G=[0,18,36,54,54,36,54,72,54,72,90,72,90,108,108,126],K=[0,18,36,54,51,35,53,71,52,70,88,69,87,105,104,122],V=[0,10,20,30,33,21,31,41,32,42,52,43,53,63,64,74];this.scale_bitcount=function(Q){var c,s,o=0,l=0,f,I=Q.scalefac;if(b(n(I,Q.sfbmax)),Q.block_type==z.SHORT_TYPE)f=G,Q.mixed_block_flag!=0&&(f=K);else if(f=V,Q.preflag==0){for(s=11;s<z.SBPSY_l&&!(I[s]<w.pretab[s]);s++);if(s==z.SBPSY_l)for(Q.preflag=1,s=11;s<z.SBPSY_l;s++)I[s]-=w.pretab[s]}for(s=0;s<Q.sfbdivide;s++)o<I[s]&&(o=I[s]);for(;s<Q.sfbmax;s++)l<I[s]&&(l=I[s]);for(Q.part2_length=O.LARGE_BITS,c=0;c<16;c++)o<x[c]&&l<F[c]&&Q.part2_length>f[c]&&(Q.part2_length=f[c],Q.scalefac_compress=c);return Q.part2_length==O.LARGE_BITS};var q=[[15,15,7,7],[15,15,7,0],[7,3,0,0],[15,31,31,0],[7,7,7,0],[3,3,0,0]];this.scale_bitcount_lsf=function(Q,c){var s,o,l,f,I,ot,y,B,dt=W(4),gt=c.scalefac;for(c.preflag!=0?s=2:s=0,y=0;y<4;y++)dt[y]=0;if(c.block_type==z.SHORT_TYPE){o=1;var ft=w.nr_of_sfb_block[s][o];for(B=0,l=0;l<4;l++)for(f=ft[l]/3,y=0;y<f;y++,B++)for(I=0;I<3;I++)gt[B*3+I]>dt[l]&&(dt[l]=gt[B*3+I])}else{o=0;var ft=w.nr_of_sfb_block[s][o];for(B=0,l=0;l<4;l++)for(f=ft[l],y=0;y<f;y++,B++)gt[B]>dt[l]&&(dt[l]=gt[B])}for(ot=!1,l=0;l<4;l++)dt[l]>q[s][l]&&(ot=!0);if(!ot){var Dt,Pt,Wt,Zt;for(c.sfb_partition_table=w.nr_of_sfb_block[s][o],l=0;l<4;l++)c.slen[l]=it[dt[l]];switch(Dt=c.slen[0],Pt=c.slen[1],Wt=c.slen[2],Zt=c.slen[3],s){case 0:c.scalefac_compress=(Dt*5+Pt<<4)+(Wt<<2)+Zt;break;case 1:c.scalefac_compress=400+(Dt*5+Pt<<2)+Wt;break;case 2:c.scalefac_compress=500+Dt*3+Pt;break;default:r.err.printf(`intensity stereo not implemented yet
`);break}}if(!ot)for(b(c.sfb_partition_table!=null),c.part2_length=0,l=0;l<4;l++)c.part2_length+=c.slen[l]*c.sfb_partition_table[l];return ot};var it=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4];this.huffman_init=function(Q){for(var c=2;c<=576;c+=2){for(var s=0,o;Q.scalefac_band.l[++s]<c;);for(o=$[s][0];Q.scalefac_band.l[o+1]>c;)o--;for(o<0&&(o=$[s][0]),Q.bv_scf[c-2]=o,o=$[s][1];Q.scalefac_band.l[o+Q.bv_scf[c-2]+2]>c;)o--;o<0&&(o=$[s][1]),Q.bv_scf[c-1]=o}}}return Vn=A,Vn}var Tn,qo;function An(){if(qo)return Tn;qo=1;var t=Ht,r=t.System,d=t.Arrays,W=t.new_byte,b=t.new_float_n,z=t.new_int,X=t.assert,j=ue(),O=Rn,A=ei(),w=Dn;h.EQ=function($,_){return Math.abs($)>Math.abs(_)?Math.abs($-_)<=Math.abs($)*0.000001:Math.abs($-_)<=Math.abs(_)*0.000001},h.NEQ=function($,_){return!h.EQ($,_)};function h(){var $=to(),_=this,v=32773,T=null,E=null,D=null,g=null;this.setModules=function(c,s,o,l){T=c,E=s,D=o,g=l};var C=null,P=0,i=0,a=0;this.getframebits=function(c){var s=c.internal_flags,o;s.bitrate_index!=0?o=O.bitrate_table[c.version][s.bitrate_index]:o=c.brate;var l=0|(c.version+1)*72000*o/c.out_samplerate+s.padding;return 8*l};function Z(c){r.arraycopy(c.header[c.w_ptr].buf,0,C,i,c.sideinfo_len),i+=c.sideinfo_len,P+=c.sideinfo_len*8,c.w_ptr=c.w_ptr+1&w.MAX_HEADER_BUF-1}function U(c,s,o){for(;o>0;){var l;a==0&&(a=8,i++,X(i<$.LAME_MAXMP3BUFFER),X(c.header[c.w_ptr].write_timing>=P),c.header[c.w_ptr].write_timing==P&&Z(c),C[i]=0),l=Math.min(o,a),o-=l,a-=l,C[i]|=s>>o<<a,P+=l}}function x(c,s,o){for(;o>0;){var l;a==0&&(a=8,i++,X(i<$.LAME_MAXMP3BUFFER),C[i]=0),l=Math.min(o,a),o-=l,a-=l,C[i]|=s>>o<<a,P+=l}}function F(c,s){var o=c.internal_flags,l;if(s>=8&&(U(o,76,8),s-=8),s>=8&&(U(o,65,8),s-=8),s>=8&&(U(o,77,8),s-=8),s>=8&&(U(o,69,8),s-=8),s>=32){var f=D.getLameShortVersion();if(s>=32)for(l=0;l<f.length&&s>=8;++l)s-=8,U(o,f.charAt(l),8)}for(;s>=1;s-=1)U(o,o.ancillary_flag,1),o.ancillary_flag^=c.disable_reservoir?0:1}function L(c,s,o){for(var l=c.header[c.h_ptr].ptr;o>0;){var f=Math.min(o,8-(l&7));o-=f,c.header[c.h_ptr].buf[l>>3]|=s>>o<<8-(l&7)-f,l+=f}c.header[c.h_ptr].ptr=l}function at(c,s){c<<=8;for(var o=0;o<8;o++)c<<=1,s<<=1,(s^c)&65536&&(s^=v);return s}this.CRC_writeheader=function(c,s){var o=65535;o=at(s[2]&255,o),o=at(s[3]&255,o);for(var l=6;l<c.sideinfo_len;l++)o=at(s[l]&255,o);s[4]=byte(o>>8),s[5]=byte(o&255)};function k(c,s){var o=c.internal_flags,l,f,I;if(l=o.l3_side,o.header[o.h_ptr].ptr=0,d.fill(o.header[o.h_ptr].buf,0,o.sideinfo_len,0),c.out_samplerate<16000?L(o,4094,12):L(o,4095,12),L(o,c.version,1),L(o,1,2),L(o,c.error_protection?0:1,1),L(o,o.bitrate_index,4),L(o,o.samplerate_index,2),L(o,o.padding,1),L(o,c.extension,1),L(o,c.mode.ordinal(),2),L(o,o.mode_ext,2),L(o,c.copyright,1),L(o,c.original,1),L(o,c.emphasis,2),c.error_protection&&L(o,0,16),c.version==1){for(X(l.main_data_begin>=0),L(o,l.main_data_begin,9),o.channels_out==2?L(o,l.private_bits,3):L(o,l.private_bits,5),I=0;I<o.channels_out;I++){var ot;for(ot=0;ot<4;ot++)L(o,l.scfsi[I][ot],1)}for(f=0;f<2;f++)for(I=0;I<o.channels_out;I++){var y=l.tt[f][I];L(o,y.part2_3_length+y.part2_length,12),L(o,y.big_values/2,9),L(o,y.global_gain,8),L(o,y.scalefac_compress,4),y.block_type!=A.NORM_TYPE?(L(o,1,1),L(o,y.block_type,2),L(o,y.mixed_block_flag,1),y.table_select[0]==14&&(y.table_select[0]=16),L(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),L(o,y.table_select[1],5),L(o,y.subblock_gain[0],3),L(o,y.subblock_gain[1],3),L(o,y.subblock_gain[2],3)):(L(o,0,1),y.table_select[0]==14&&(y.table_select[0]=16),L(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),L(o,y.table_select[1],5),y.table_select[2]==14&&(y.table_select[2]=16),L(o,y.table_select[2],5),X(0<=y.region0_count&&y.region0_count<16),X(0<=y.region1_count&&y.region1_count<8),L(o,y.region0_count,4),L(o,y.region1_count,3)),L(o,y.preflag,1),L(o,y.scalefac_scale,1),L(o,y.count1table_select,1)}}else for(X(l.main_data_begin>=0),L(o,l.main_data_begin,8),L(o,l.private_bits,o.channels_out),f=0,I=0;I<o.channels_out;I++){var y=l.tt[f][I];L(o,y.part2_3_length+y.part2_length,12),L(o,y.big_values/2,9),L(o,y.global_gain,8),L(o,y.scalefac_compress,9),y.block_type!=A.NORM_TYPE?(L(o,1,1),L(o,y.block_type,2),L(o,y.mixed_block_flag,1),y.table_select[0]==14&&(y.table_select[0]=16),L(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),L(o,y.table_select[1],5),L(o,y.subblock_gain[0],3),L(o,y.subblock_gain[1],3),L(o,y.subblock_gain[2],3)):(L(o,0,1),y.table_select[0]==14&&(y.table_select[0]=16),L(o,y.table_select[0],5),y.table_select[1]==14&&(y.table_select[1]=16),L(o,y.table_select[1],5),y.table_select[2]==14&&(y.table_select[2]=16),L(o,y.table_select[2],5),X(0<=y.region0_count&&y.region0_count<16),X(0<=y.region1_count&&y.region1_count<8),L(o,y.region0_count,4),L(o,y.region1_count,3)),L(o,y.scalefac_scale,1),L(o,y.count1table_select,1)}c.error_protection&&CRC_writeheader(o,o.header[o.h_ptr].buf);{var B=o.h_ptr;X(o.header[B].ptr==o.sideinfo_len*8),o.h_ptr=B+1&w.MAX_HEADER_BUF-1,o.header[o.h_ptr].write_timing=o.header[B].write_timing+s,o.h_ptr==o.w_ptr&&r.err.println(`Error: MAX_HEADER_BUF too small in bitstream.c 
`)}}function n(c,s){var o=O.ht[s.count1table_select+32],l,f=0,I=s.big_values,ot=s.big_values;for(X(s.count1table_select<2),l=(s.count1-s.big_values)/4;l>0;--l){var y=0,B=0,dt;dt=s.l3_enc[I+0],dt!=0&&(B+=8,s.xr[ot+0]<0&&y++),dt=s.l3_enc[I+1],dt!=0&&(B+=4,y*=2,s.xr[ot+1]<0&&y++),dt=s.l3_enc[I+2],dt!=0&&(B+=2,y*=2,s.xr[ot+2]<0&&y++),dt=s.l3_enc[I+3],dt!=0&&(B++,y*=2,s.xr[ot+3]<0&&y++),I+=4,ot+=4,U(c,y+o.table[B],o.hlen[B]),f+=o.hlen[B]}return f}function G(c,s,o,l,f){var I=O.ht[s],ot=0;if(s==0)return ot;for(var y=o;y<l;y+=2){var B=0,dt=0,gt=I.xlen,ft=I.xlen,Dt=0,Pt=f.l3_enc[y],Wt=f.l3_enc[y+1];if(Pt!=0&&(f.xr[y]<0&&Dt++,B--),s>15){if(Pt>14){var Zt=Pt-15;X(Zt<=I.linmax),Dt|=Zt<<1,dt=gt,Pt=15}if(Wt>14){var Vt=Wt-15;X(Vt<=I.linmax),Dt<<=gt,Dt|=Vt,dt+=gt,Wt=15}ft=16}Wt!=0&&(Dt<<=1,f.xr[y+1]<0&&Dt++,B--),Pt=Pt*ft+Wt,dt-=B,B+=I.hlen[Pt],U(c,I.table[Pt],B),U(c,Dt,dt),ot+=B+dt}return ot}function K(c,s){var o=3*c.scalefac_band.s[3];o>s.big_values&&(o=s.big_values);var l=G(c,s.table_select[0],0,o,s);return l+=G(c,s.table_select[1],o,s.big_values,s),l}function V(c,s){var o,l,f,I;o=s.big_values;var ot=s.region0_count+1;return X(ot<c.scalefac_band.l.length),f=c.scalefac_band.l[ot],ot+=s.region1_count+1,X(ot<c.scalefac_band.l.length),I=c.scalefac_band.l[ot],f>o&&(f=o),I>o&&(I=o),l=G(c,s.table_select[0],0,f,s),l+=G(c,s.table_select[1],f,I,s),l+=G(c,s.table_select[2],I,o,s),l}function q(c){var s,o,l,f,I=0,ot=c.internal_flags,y=ot.l3_side;if(c.version==1)for(s=0;s<2;s++)for(o=0;o<ot.channels_out;o++){var B=y.tt[s][o],dt=j.slen1_tab[B.scalefac_compress],gt=j.slen2_tab[B.scalefac_compress];for(f=0,l=0;l<B.sfbdivide;l++)B.scalefac[l]!=-1&&(U(ot,B.scalefac[l],dt),f+=dt);for(;l<B.sfbmax;l++)B.scalefac[l]!=-1&&(U(ot,B.scalefac[l],gt),f+=gt);X(f==B.part2_length),B.block_type==A.SHORT_TYPE?f+=K(ot,B):f+=V(ot,B),f+=n(ot,B),X(f==B.part2_3_length+B.part2_length),I+=f}else for(s=0,o=0;o<ot.channels_out;o++){var B=y.tt[s][o],ft,Dt,Pt=0;if(X(B.sfb_partition_table!=null),f=0,l=0,Dt=0,B.block_type==A.SHORT_TYPE){for(;Dt<4;Dt++){var Wt=B.sfb_partition_table[Dt]/3,Zt=B.slen[Dt];for(ft=0;ft<Wt;ft++,l++)U(ot,Math.max(B.scalefac[l*3+0],0),Zt),U(ot,Math.max(B.scalefac[l*3+1],0),Zt),U(ot,Math.max(B.scalefac[l*3+2],0),Zt),Pt+=3*Zt}f+=K(ot,B)}else{for(;Dt<4;Dt++){var Wt=B.sfb_partition_table[Dt],Zt=B.slen[Dt];for(ft=0;ft<Wt;ft++,l++)U(ot,Math.max(B.scalefac[l],0),Zt),Pt+=Zt}f+=V(ot,B)}f+=n(ot,B),X(f==B.part2_3_length),X(Pt==B.part2_length),I+=Pt+f}return I}function it(){this.total=0}function Q(c,s){var o=c.internal_flags,l,f,I,ot,y;return y=o.w_ptr,ot=o.h_ptr-1,ot==-1&&(ot=w.MAX_HEADER_BUF-1),l=o.header[ot].write_timing-P,s.total=l,l>=0&&(f=1+ot-y,ot<y&&(f=1+ot-y+w.MAX_HEADER_BUF),l-=f*8*o.sideinfo_len),I=_.getframebits(c),l+=I,s.total+=I,s.total%8!=0?s.total=1+s.total/8:s.total=s.total/8,s.total+=i+1,l<0&&r.err.println(`strange error flushing buffer ... 
`),l}this.flush_bitstream=function(c){var s=c.internal_flags,o,l,f=s.h_ptr-1;if(f==-1&&(f=w.MAX_HEADER_BUF-1),o=s.l3_side,!((l=Q(c,new it))<0)){if(F(c,l),X(s.header[f].write_timing+this.getframebits(c)==P),s.ResvSize=0,o.main_data_begin=0,s.findReplayGain){var I=T.GetTitleGain(s.rgdata);X(NEQ(I,GainAnalysis.GAIN_NOT_ENOUGH_SAMPLES)),s.RadioGain=Math.floor(I*10+0.5)|0}s.findPeakSample&&(s.noclipGainChange=Math.ceil(Math.log10(s.PeakSample/32767)*20*10)|0,s.noclipGainChange>0&&(EQ(c.scale,1)||EQ(c.scale,0))?s.noclipScale=Math.floor(32767/s.PeakSample*100)/100:s.noclipScale=-1)}},this.add_dummy_byte=function(c,s,o){for(var l=c.internal_flags,f;o-- >0;)for(x(l,s,8),f=0;f<w.MAX_HEADER_BUF;++f)l.header[f].write_timing+=8},this.format_bitstream=function(c){var s=c.internal_flags,o;o=s.l3_side;var l=this.getframebits(c);F(c,o.resvDrain_pre),k(c,l);var f=8*s.sideinfo_len;if(f+=q(c),F(c,o.resvDrain_post),f+=o.resvDrain_post,o.main_data_begin+=(l-f)/8,Q(c,new it)!=s.ResvSize&&r.err.println("Internal buffer inconsistency. flushbits <> ResvSize"),o.main_data_begin*8!=s.ResvSize&&(r.err.printf(`bit reservoir error: 
l3_side.main_data_begin: %d 
Resvoir size:             %d 
resv drain (post)         %d 
resv drain (pre)          %d 
header and sideinfo:      %d 
data bits:                %d 
total bits:               %d (remainder: %d) 
bitsperframe:             %d 
`,8*o.main_data_begin,s.ResvSize,o.resvDrain_post,o.resvDrain_pre,8*s.sideinfo_len,f-o.resvDrain_post-8*s.sideinfo_len,f,f%8,l),r.err.println("This is a fatal error.  It has several possible causes:"),r.err.println("90%%  LAME compiled with buggy version of gcc using advanced optimizations"),r.err.println(" 9%%  Your system is overclocked"),r.err.println(" 1%%  bug in LAME encoding library"),s.ResvSize=o.main_data_begin*8),P>1e9){var I;for(I=0;I<w.MAX_HEADER_BUF;++I)s.header[I].write_timing-=P;P=0}return 0},this.copy_buffer=function(c,s,o,l,f){var I=i+1;if(I<=0)return 0;if(l!=0&&I>l)return-1;if(r.arraycopy(C,0,s,o,I),i=-1,a=0,f!=0){var ot=z(1);if(ot[0]=c.nMusicCRC,g.updateMusicCRC(ot,s,o,I),c.nMusicCRC=ot[0],I>0&&(c.VBR_seek_table.nBytesWritten+=I),c.decode_on_the_fly){for(var y=b([2,1152]),B=I,dt=-1,gt;dt!=0;)if(dt=E.hip_decode1_unclipped(c.hip,s,o,B,y[0],y[1]),B=0,dt==-1&&(dt=0),dt>0){if(c.findPeakSample){for(gt=0;gt<dt;gt++)y[0][gt]>c.PeakSample?c.PeakSample=y[0][gt]:-y[0][gt]>c.PeakSample&&(c.PeakSample=-y[0][gt]);if(c.channels_out>1)for(gt=0;gt<dt;gt++)y[1][gt]>c.PeakSample?c.PeakSample=y[1][gt]:-y[1][gt]>c.PeakSample&&(c.PeakSample=-y[1][gt])}if(c.findReplayGain&&T.AnalyzeSamples(c.rgdata,y[0],0,y[1],0,dt,c.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6}}}return I},this.init_bit_stream_w=function(c){C=W($.LAME_MAXMP3BUFFER),c.h_ptr=c.w_ptr=0,c.header[c.h_ptr].write_timing=0,i=-1,a=0,P=0}}return Tn=h,Tn}var Nn,Oo;function to(){if(Oo)return Nn;Oo=1;var t=Ht,r=t.System,d=t.VbrMode,W=t.ShortBlock,b=t.new_float,z=t.new_int_n,X=t.new_short_n,j=t.assert,O=or,A=sr,w=Dn,h=Qr,$=yr,_=Or,v=An(),T=Rn,E=ei();function D(){var g=ln,C=this,P=131072;D.V9=410,D.V8=420,D.V7=430,D.V6=440,D.V5=450,D.V4=460,D.V3=470,D.V2=480,D.V1=490,D.V0=500,D.R3MIX=1000,D.STANDARD=1001,D.EXTREME=1002,D.INSANE=1003,D.STANDARD_FAST=1004,D.EXTREME_FAST=1005,D.MEDIUM=1006,D.MEDIUM_FAST=1007;var i=16384+P;D.LAME_MAXMP3BUFFER=i;var a,Z,U,x,F,L=new O,at,k,n;this.enc=new E,this.setModules=function(e,p,Ct,Jt,Xt,yt,zt,Yt,Kt){a=e,Z=p,U=Ct,x=Jt,F=Xt,at=yt,k=Yt,n=Kt,this.enc.setModules(Z,L,x,at)};function G(){this.mask_adjust=0,this.mask_adjust_short=0,this.bo_l_weight=b(E.SBMAX_l),this.bo_s_weight=b(E.SBMAX_s)}function K(){this.lowerlimit=0}function V(e,p){this.lowpass=p}var q=4294479419;function it(e){var p;return e.class_id=q,p=e.internal_flags=new w,e.mode=g.NOT_SET,e.original=1,e.in_samplerate=44100,e.num_channels=2,e.num_samples=-1,e.bWriteVbrTag=!0,e.quality=-1,e.short_blocks=null,p.subblock_gain=-1,e.lowpassfreq=0,e.highpassfreq=0,e.lowpasswidth=-1,e.highpasswidth=-1,e.VBR=d.vbr_off,e.VBR_q=4,e.ATHcurve=-1,e.VBR_mean_bitrate_kbps=128,e.VBR_min_bitrate_kbps=0,e.VBR_max_bitrate_kbps=0,e.VBR_hard_min=0,p.VBR_min_bitrate=1,p.VBR_max_bitrate=13,e.quant_comp=-1,e.quant_comp_short=-1,e.msfix=-1,p.resample_ratio=1,p.OldValue[0]=180,p.OldValue[1]=180,p.CurrentStep[0]=4,p.CurrentStep[1]=4,p.masking_lower=1,p.nsPsy.attackthre=-1,p.nsPsy.attackthre_s=-1,e.scale=-1,e.athaa_type=-1,e.ATHtype=-1,e.athaa_loudapprox=-1,e.athaa_sensitivity=0,e.useTemporal=null,e.interChRatio=-1,p.mf_samples_to_encode=E.ENCDELAY+E.POSTDELAY,e.encoder_padding=0,p.mf_size=E.ENCDELAY-E.MDCTDELAY,e.findReplayGain=!1,e.decode_on_the_fly=!1,p.decode_on_the_fly=!1,p.findReplayGain=!1,p.findPeakSample=!1,p.RadioGain=0,p.AudiophileGain=0,p.noclipGainChange=0,p.noclipScale=-1,e.preset=0,e.write_id3tag_automatic=!0,0}this.lame_init=function(){var e=new A;return it(e),e.lame_allocated_gfp=1,e};function Q(e){return e>1?0:e<=0?1:Math.cos(Math.PI/2*e)}this.nearestBitrateFullIndex=function(e){var p=[8,16,24,32,40,48,56,64,80,96,112,128,160,192,224,256,320],Ct=0,Jt=0,Xt=0,yt=0;yt=p[16],Xt=16,Jt=p[16],Ct=16;for(var zt=0;zt<16;zt++)if(Math.max(e,p[zt+1])!=e){yt=p[zt+1],Xt=zt+1,Jt=p[zt],Ct=zt;break}return yt-e>e-Jt?Ct:Xt};function c(e,p){var Ct=44100;return p>=48000?Ct=48000:p>=44100?Ct=44100:p>=32000?Ct=32000:p>=24000?Ct=24000:p>=22050?Ct=22050:p>=16000?Ct=16000:p>=12000?Ct=12000:p>=11025?Ct=11025:p>=8000&&(Ct=8000),e==-1?Ct:(e<=15960&&(Ct=44100),e<=15250&&(Ct=32000),e<=11220&&(Ct=24000),e<=9970&&(Ct=22050),e<=7230&&(Ct=16000),e<=5420&&(Ct=12000),e<=4510&&(Ct=11025),e<=3970&&(Ct=8000),p<Ct?p>44100?48000:p>32000?44100:p>24000?32000:p>22050?24000:p>16000?22050:p>12000?16000:p>11025?12000:p>8000?11025:8000:Ct)}function s(e,p){switch(e){case 44100:return p.version=1,0;case 48000:return p.version=1,1;case 32000:return p.version=1,2;case 22050:return p.version=0,0;case 24000:return p.version=0,1;case 16000:return p.version=0,2;case 11025:return p.version=0,0;case 12000:return p.version=0,1;case 8000:return p.version=0,2;default:return p.version=0,-1}}function o(e,p,Ct){Ct<16000&&(p=2);for(var Jt=T.bitrate_table[p][1],Xt=2;Xt<=14;Xt++)T.bitrate_table[p][Xt]>0&&Math.abs(T.bitrate_table[p][Xt]-e)<Math.abs(Jt-e)&&(Jt=T.bitrate_table[p][Xt]);return Jt}function l(e,p,Ct){Ct<16000&&(p=2);for(var Jt=0;Jt<=14;Jt++)if(T.bitrate_table[p][Jt]>0&&T.bitrate_table[p][Jt]==e)return Jt;return-1}function f(e,p){var Ct=[new V(8,2000),new V(16,3700),new V(24,3900),new V(32,5500),new V(40,7000),new V(48,7500),new V(56,1e4),new V(64,11000),new V(80,13500),new V(96,15100),new V(112,15600),new V(128,17000),new V(160,17500),new V(192,18600),new V(224,19400),new V(256,19700),new V(320,20500)],Jt=C.nearestBitrateFullIndex(p);e.lowerlimit=Ct[Jt].lowpass}function I(e){var p=e.internal_flags,Ct=32,Jt=-1;if(p.lowpass1>0){for(var Xt=999,yt=0;yt<=31;yt++){var zt=yt/31;zt>=p.lowpass2&&(Ct=Math.min(Ct,yt)),p.lowpass1<zt&&zt<p.lowpass2&&(Xt=Math.min(Xt,yt))}Xt==999?p.lowpass1=(Ct-0.75)/31:p.lowpass1=(Xt-0.75)/31,p.lowpass2=Ct/31}if(p.highpass2>0&&p.highpass2<0.021774193548387097&&(p.highpass1=0,p.highpass2=0,r.err.println(`Warning: highpass filter disabled.  highpass frequency too small
`)),p.highpass2>0){for(var Yt=-1,yt=0;yt<=31;yt++){var zt=yt/31;zt<=p.highpass1&&(Jt=Math.max(Jt,yt)),p.highpass1<zt&&zt<p.highpass2&&(Yt=Math.max(Yt,yt))}p.highpass1=Jt/31,Yt==-1?p.highpass2=(Jt+0.75)/31:p.highpass2=(Yt+0.75)/31}for(var yt=0;yt<32;yt++){var Kt,jt,zt=yt/31;p.highpass2>p.highpass1?Kt=Q((p.highpass2-zt)/(p.highpass2-p.highpass1+0.00000000000000000001)):Kt=1,p.lowpass2>p.lowpass1?jt=Q((zt-p.lowpass1)/(p.lowpass2-p.lowpass1+0.00000000000000000001)):jt=1,p.amp_filter[yt]=Kt*jt}}function ot(e){var p=e.internal_flags;switch(e.quality){default:case 9:p.psymodel=0,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 8:e.quality=7;case 7:p.psymodel=1,p.noise_shaping=0,p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.use_best_huffman=0,p.full_outer_loop=0;break;case 6:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 5:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=0,p.full_outer_loop=0;break;case 4:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=0,p.noise_shaping_stop=0,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 3:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 2:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=1,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 1:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break;case 0:p.psymodel=1,p.noise_shaping==0&&(p.noise_shaping=1),p.substep_shaping==0&&(p.substep_shaping=2),p.noise_shaping_amp=2,p.noise_shaping_stop=1,p.subblock_gain==-1&&(p.subblock_gain=1),p.use_best_huffman=1,p.full_outer_loop=0;break}}function y(e){var p=e.internal_flags;e.frameNum=0,e.write_id3tag_automatic&&k.id3tag_write_v2(e),p.bitrate_stereoMode_Hist=z([16,5]),p.bitrate_blockType_Hist=z([16,6]),p.PeakSample=0,e.bWriteVbrTag&&at.InitVbrTag(e)}this.lame_init_params=function(e){var p=e.internal_flags;if(p.Class_ID=0,p.ATH==null&&(p.ATH=new h),p.PSY==null&&(p.PSY=new G),p.rgdata==null&&(p.rgdata=new $),p.channels_in=e.num_channels,p.channels_in==1&&(e.mode=g.MONO),p.channels_out=e.mode==g.MONO?1:2,p.mode_ext=E.MPG_MD_MS_LR,e.mode==g.MONO&&(e.force_ms=!1),e.VBR==d.vbr_off&&e.VBR_mean_bitrate_kbps!=128&&e.brate==0&&(e.brate=e.VBR_mean_bitrate_kbps),e.VBR==d.vbr_off||e.VBR==d.vbr_mtrh||e.VBR==d.vbr_mt||(e.free_format=!1),e.VBR==d.vbr_off&&e.brate==0&&v.EQ(e.compression_ratio,0)&&(e.compression_ratio=11.025),e.VBR==d.vbr_off&&e.compression_ratio>0&&(e.out_samplerate==0&&(e.out_samplerate=map2MP3Frequency(int(0.97*e.in_samplerate))),e.brate=0|e.out_samplerate*16*p.channels_out/(1000*e.compression_ratio),p.samplerate_index=s(e.out_samplerate,e),e.free_format||(e.brate=o(e.brate,e.version,e.out_samplerate))),e.out_samplerate!=0&&(e.out_samplerate<16000?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,64)):e.out_samplerate<32000?(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,8),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,160)):(e.VBR_mean_bitrate_kbps=Math.max(e.VBR_mean_bitrate_kbps,32),e.VBR_mean_bitrate_kbps=Math.min(e.VBR_mean_bitrate_kbps,320))),e.lowpassfreq==0){var Ct=16000;switch(e.VBR){case d.vbr_off:{var Jt=new K;f(Jt,e.brate),Ct=Jt.lowerlimit;break}case d.vbr_abr:{var Jt=new K;f(Jt,e.VBR_mean_bitrate_kbps),Ct=Jt.lowerlimit;break}case d.vbr_rh:{var Xt=[19500,19000,18600,18000,17500,16000,15600,14900,12500,1e4,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var yt=Xt[e.VBR_q],zt=Xt[e.VBR_q+1],Yt=e.VBR_q_frac;Ct=linear_int(yt,zt,Yt)}else Ct=19500;break}default:{var Xt=[19500,19000,18500,18000,17500,16500,15500,14500,12500,9500,3950];if(0<=e.VBR_q&&e.VBR_q<=9){var yt=Xt[e.VBR_q],zt=Xt[e.VBR_q+1],Yt=e.VBR_q_frac;Ct=linear_int(yt,zt,Yt)}else Ct=19500}}e.mode==g.MONO&&(e.VBR==d.vbr_off||e.VBR==d.vbr_abr)&&(Ct*=1.5),e.lowpassfreq=Ct|0}if(e.out_samplerate==0&&(2*e.lowpassfreq>e.in_samplerate&&(e.lowpassfreq=e.in_samplerate/2),e.out_samplerate=c(e.lowpassfreq|0,e.in_samplerate)),e.lowpassfreq=Math.min(20500,e.lowpassfreq),e.lowpassfreq=Math.min(e.out_samplerate/2,e.lowpassfreq),e.VBR==d.vbr_off&&(e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.brate)),e.VBR==d.vbr_abr&&(e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.VBR_mean_bitrate_kbps)),e.bWriteVbrTag||(e.findReplayGain=!1,e.decode_on_the_fly=!1,p.findPeakSample=!1),p.findReplayGain=e.findReplayGain,p.decode_on_the_fly=e.decode_on_the_fly,p.decode_on_the_fly&&(p.findPeakSample=!0),p.findReplayGain&&a.InitGainAnalysis(p.rgdata,e.out_samplerate)==GainAnalysis.INIT_GAIN_ANALYSIS_ERROR)return e.internal_flags=null,-6;switch(p.decode_on_the_fly&&!e.decode_only&&(p.hip!=null&&n.hip_decode_exit(p.hip),p.hip=n.hip_decode_init()),p.mode_gr=e.out_samplerate<=24000?1:2,e.framesize=576*p.mode_gr,e.encoder_delay=E.ENCDELAY,p.resample_ratio=e.in_samplerate/e.out_samplerate,e.VBR){case d.vbr_mt:case d.vbr_rh:case d.vbr_mtrh:{var Kt=[5.7,6.5,7.3,8.2,10,11.9,13,14,15,16.5];e.compression_ratio=Kt[e.VBR_q]}break;case d.vbr_abr:e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.VBR_mean_bitrate_kbps);break;default:e.compression_ratio=e.out_samplerate*16*p.channels_out/(1000*e.brate);break}if(e.mode==g.NOT_SET&&(e.mode=g.JOINT_STEREO),e.highpassfreq>0?(p.highpass1=2*e.highpassfreq,e.highpasswidth>=0?p.highpass2=2*(e.highpassfreq+e.highpasswidth):p.highpass2=2*e.highpassfreq,p.highpass1/=e.out_samplerate,p.highpass2/=e.out_samplerate):(p.highpass1=0,p.highpass2=0),e.lowpassfreq>0?(p.lowpass2=2*e.lowpassfreq,e.lowpasswidth>=0?(p.lowpass1=2*(e.lowpassfreq-e.lowpasswidth),p.lowpass1<0&&(p.lowpass1=0)):p.lowpass1=2*e.lowpassfreq,p.lowpass1/=e.out_samplerate,p.lowpass2/=e.out_samplerate):(p.lowpass1=0,p.lowpass2=0),I(e),p.samplerate_index=s(e.out_samplerate,e),p.samplerate_index<0)return e.internal_flags=null,-1;if(e.VBR==d.vbr_off){if(e.free_format)p.bitrate_index=0;else if(e.brate=o(e.brate,e.version,e.out_samplerate),p.bitrate_index=l(e.brate,e.version,e.out_samplerate),p.bitrate_index<=0)return e.internal_flags=null,-1}else p.bitrate_index=1;e.analysis&&(e.bWriteVbrTag=!1),p.pinfo!=null&&(e.bWriteVbrTag=!1),Z.init_bit_stream_w(p);for(var jt=p.samplerate_index+3*e.version+6*(e.out_samplerate<16000?1:0),mt=0;mt<E.SBMAX_l+1;mt++)p.scalefac_band.l[mt]=x.sfBandIndex[jt].l[mt];for(var mt=0;mt<E.PSFB21+1;mt++){var vt=(p.scalefac_band.l[22]-p.scalefac_band.l[21])/E.PSFB21,ii=p.scalefac_band.l[21]+mt*vt;p.scalefac_band.psfb21[mt]=ii}p.scalefac_band.psfb21[E.PSFB21]=576;for(var mt=0;mt<E.SBMAX_s+1;mt++)p.scalefac_band.s[mt]=x.sfBandIndex[jt].s[mt];for(var mt=0;mt<E.PSFB12+1;mt++){var vt=(p.scalefac_band.s[13]-p.scalefac_band.s[12])/E.PSFB12,ii=p.scalefac_band.s[12]+mt*vt;p.scalefac_band.psfb12[mt]=ii}p.scalefac_band.psfb12[E.PSFB12]=192,e.version==1?p.sideinfo_len=p.channels_out==1?21:36:p.sideinfo_len=p.channels_out==1?13:21,e.error_protection&&(p.sideinfo_len+=2),y(e),p.Class_ID=q;{var Ot;for(Ot=0;Ot<19;Ot++)p.nsPsy.pefirbuf[Ot]=700*p.mode_gr*p.channels_out;e.ATHtype==-1&&(e.ATHtype=4)}switch(j(e.VBR_q<=9),j(e.VBR_q>=0),e.VBR){case d.vbr_mt:e.VBR=d.vbr_mtrh;case d.vbr_mtrh:{e.useTemporal==null&&(e.useTemporal=!1),U.apply_preset(e,500-e.VBR_q*10,0),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),e.quality<5&&(e.quality=0),e.quality>5&&(e.quality=5),p.PSY.mask_adjust=e.maskingadjust,p.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=e.out_samplerate>44000,p.iteration_loop=new VBRNewIterationLoop(F);break}case d.vbr_rh:{U.apply_preset(e,500-e.VBR_q*10,0),p.PSY.mask_adjust=e.maskingadjust,p.PSY.mask_adjust_short=e.maskingadjust_short,e.experimentalY?p.sfb21_extra=!1:p.sfb21_extra=e.out_samplerate>44000,e.quality>6&&(e.quality=6),e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),p.iteration_loop=new VBROldIterationLoop(F);break}default:{var u;p.sfb21_extra=!1,e.quality<0&&(e.quality=LAME_DEFAULT_QUALITY),u=e.VBR,u==d.vbr_off&&(e.VBR_mean_bitrate_kbps=e.brate),U.apply_preset(e,e.VBR_mean_bitrate_kbps,0),e.VBR=u,p.PSY.mask_adjust=e.maskingadjust,p.PSY.mask_adjust_short=e.maskingadjust_short,u==d.vbr_off?p.iteration_loop=new _(F):p.iteration_loop=new ABRIterationLoop(F);break}}if(j(e.scale>=0),e.VBR!=d.vbr_off){if(p.VBR_min_bitrate=1,p.VBR_max_bitrate=14,e.out_samplerate<16000&&(p.VBR_max_bitrate=8),e.VBR_min_bitrate_kbps!=0&&(e.VBR_min_bitrate_kbps=o(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),p.VBR_min_bitrate=l(e.VBR_min_bitrate_kbps,e.version,e.out_samplerate),p.VBR_min_bitrate<0)||e.VBR_max_bitrate_kbps!=0&&(e.VBR_max_bitrate_kbps=o(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),p.VBR_max_bitrate=l(e.VBR_max_bitrate_kbps,e.version,e.out_samplerate),p.VBR_max_bitrate<0))return-1;e.VBR_min_bitrate_kbps=T.bitrate_table[e.version][p.VBR_min_bitrate],e.VBR_max_bitrate_kbps=T.bitrate_table[e.version][p.VBR_max_bitrate],e.VBR_mean_bitrate_kbps=Math.min(T.bitrate_table[e.version][p.VBR_max_bitrate],e.VBR_mean_bitrate_kbps),e.VBR_mean_bitrate_kbps=Math.max(T.bitrate_table[e.version][p.VBR_min_bitrate],e.VBR_mean_bitrate_kbps)}return e.tune&&(p.PSY.mask_adjust+=e.tune_value_a,p.PSY.mask_adjust_short+=e.tune_value_a),ot(e),j(e.scale>=0),e.athaa_type<0?p.ATH.useAdjust=3:p.ATH.useAdjust=e.athaa_type,p.ATH.aaSensitivityP=Math.pow(10,e.athaa_sensitivity/-10),e.short_blocks==null&&(e.short_blocks=W.short_block_allowed),e.short_blocks==W.short_block_allowed&&(e.mode==g.JOINT_STEREO||e.mode==g.STEREO)&&(e.short_blocks=W.short_block_coupled),e.quant_comp<0&&(e.quant_comp=1),e.quant_comp_short<0&&(e.quant_comp_short=0),e.msfix<0&&(e.msfix=0),e.exp_nspsytune=e.exp_nspsytune|1,e.internal_flags.nsPsy.attackthre<0&&(e.internal_flags.nsPsy.attackthre=O.NSATTACKTHRE),e.internal_flags.nsPsy.attackthre_s<0&&(e.internal_flags.nsPsy.attackthre_s=O.NSATTACKTHRE_S),j(e.scale>=0),e.scale<0&&(e.scale=1),e.ATHtype<0&&(e.ATHtype=4),e.ATHcurve<0&&(e.ATHcurve=4),e.athaa_loudapprox<0&&(e.athaa_loudapprox=2),e.interChRatio<0&&(e.interChRatio=0),e.useTemporal==null&&(e.useTemporal=!0),p.slot_lag=p.frac_SpF=0,e.VBR==d.vbr_off&&(p.slot_lag=p.frac_SpF=(e.version+1)*72000*e.brate%e.out_samplerate|0),x.iteration_init(e),L.psymodel_init(e),j(e.scale>=0),0};function B(e,p){(e.in_buffer_0==null||e.in_buffer_nsamples<p)&&(e.in_buffer_0=b(p),e.in_buffer_1=b(p),e.in_buffer_nsamples=p)}this.lame_encode_flush=function(e,p,Ct,Jt){var Xt=e.internal_flags,yt=X([2,1152]),zt=0,Yt,Kt,jt,mt,vt=Xt.mf_samples_to_encode-E.POSTDELAY,ii=dt(e);if(Xt.mf_samples_to_encode<1)return 0;for(Yt=0,e.in_samplerate!=e.out_samplerate&&(vt+=16*e.out_samplerate/e.in_samplerate),jt=e.framesize-vt%e.framesize,jt<576&&(jt+=e.framesize),e.encoder_padding=jt,mt=(vt+jt)/e.framesize;mt>0&&zt>=0;){var Ot=ii-Xt.mf_size,u=e.frameNum;Ot*=e.in_samplerate,Ot/=e.out_samplerate,Ot>1152&&(Ot=1152),Ot<1&&(Ot=1),Kt=Jt-Yt,Jt==0&&(Kt=0),zt=this.lame_encode_buffer(e,yt[0],yt[1],Ot,p,Ct,Kt),Ct+=zt,Yt+=zt,mt-=u!=e.frameNum?1:0}if(Xt.mf_samples_to_encode=0,zt<0||(Kt=Jt-Yt,Jt==0&&(Kt=0),Z.flush_bitstream(e),zt=Z.copy_buffer(Xt,p,Ct,Kt,1),zt<0))return zt;if(Ct+=zt,Yt+=zt,Kt=Jt-Yt,Jt==0&&(Kt=0),e.write_id3tag_automatic){if(k.id3tag_write_v1(e),zt=Z.copy_buffer(Xt,p,Ct,Kt,0),zt<0)return zt;Yt+=zt}return Yt},this.lame_encode_buffer=function(e,p,Ct,Jt,Xt,yt,zt){var Yt=e.internal_flags,Kt=[null,null];if(Yt.Class_ID!=q)return-3;if(Jt==0)return 0;B(Yt,Jt),Kt[0]=Yt.in_buffer_0,Kt[1]=Yt.in_buffer_1;for(var jt=0;jt<Jt;jt++)Kt[0][jt]=p[jt],Yt.channels_in>1&&(Kt[1][jt]=Ct[jt]);return gt(e,Kt[0],Kt[1],Jt,Xt,yt,zt)};function dt(e){var p=E.BLKSIZE+e.framesize-E.FFTOFFSET;return p=Math.max(p,512+e.framesize-32),p}function gt(e,p,Ct,Jt,Xt,yt,zt){var Yt=e.internal_flags,Kt=0,jt,mt,vt,ii,Ot,u=[null,null],m=[null,null];if(Yt.Class_ID!=q)return-3;if(Jt==0)return 0;if(Ot=Z.copy_buffer(Yt,Xt,yt,zt,0),Ot<0)return Ot;if(yt+=Ot,Kt+=Ot,m[0]=p,m[1]=Ct,v.NEQ(e.scale,0)&&v.NEQ(e.scale,1))for(mt=0;mt<Jt;++mt)m[0][mt]*=e.scale,Yt.channels_out==2&&(m[1][mt]*=e.scale);if(v.NEQ(e.scale_left,0)&&v.NEQ(e.scale_left,1))for(mt=0;mt<Jt;++mt)m[0][mt]*=e.scale_left;if(v.NEQ(e.scale_right,0)&&v.NEQ(e.scale_right,1))for(mt=0;mt<Jt;++mt)m[1][mt]*=e.scale_right;if(e.num_channels==2&&Yt.channels_out==1)for(mt=0;mt<Jt;++mt)m[0][mt]=0.5*(m[0][mt]+m[1][mt]),m[1][mt]=0;ii=dt(e),u[0]=Yt.mfbuf[0],u[1]=Yt.mfbuf[1];for(var Y=0;Jt>0;){var M=[null,null],H=0,J=0;M[0]=m[0],M[1]=m[1];var N=new Dt;if(mi(e,u,M,Y,Jt,N),H=N.n_in,J=N.n_out,Yt.findReplayGain&&!Yt.decode_on_the_fly&&a.AnalyzeSamples(Yt.rgdata,u[0],Yt.mf_size,u[1],Yt.mf_size,J,Yt.channels_out)==GainAnalysis.GAIN_ANALYSIS_ERROR)return-6;if(Jt-=H,Y+=H,Yt.channels_out==2,Yt.mf_size+=J,j(Yt.mf_size<=w.MFSIZE),Yt.mf_samples_to_encode<1&&(Yt.mf_samples_to_encode=E.ENCDELAY+E.POSTDELAY),Yt.mf_samples_to_encode+=J,Yt.mf_size>=ii){var R=zt-Kt;if(zt==0&&(R=0),jt=ft(e,u[0],u[1],Xt,yt,R),jt<0)return jt;for(yt+=jt,Kt+=jt,Yt.mf_size-=e.framesize,Yt.mf_samples_to_encode-=e.framesize,vt=0;vt<Yt.channels_out;vt++)for(mt=0;mt<Yt.mf_size;mt++)u[vt][mt]=u[vt][mt+e.framesize]}}return Kt}function ft(e,p,Ct,Jt,Xt,yt){var zt=C.enc.lame_encode_mp3_frame(e,p,Ct,Jt,Xt,yt);return e.frameNum++,zt}function Dt(){this.n_in=0,this.n_out=0}function Pt(){this.num_used=0}function Wt(e,p){return p!=0?Wt(p,e%p):e}function Zt(e,p,Ct){var Jt=Math.PI*p;e/=Ct,e<0&&(e=0),e>1&&(e=1);var Xt=e-0.5,yt=0.42-0.5*Math.cos(2*e*Math.PI)+0.08*Math.cos(4*e*Math.PI);return Math.abs(Xt)<0.000000001?Jt/Math.PI:yt*Math.sin(Ct*Jt*Xt)/(Math.PI*Ct*Xt)}function Vt(e,p,Ct,Jt,Xt,yt,zt,Yt,Kt){var jt=e.internal_flags,mt,vt=0,ii,Ot=e.out_samplerate/Wt(e.out_samplerate,e.in_samplerate);Ot>w.BPC&&(Ot=w.BPC);var u=Math.abs(jt.resample_ratio-Math.floor(0.5+jt.resample_ratio))<0.0001?1:0,m=1/jt.resample_ratio;m>1&&(m=1);var Y=31;Y%2==0&&--Y,Y+=u;var M=Y+1;if(jt.fill_buffer_resample_init==0){for(jt.inbuf_old[0]=b(M),jt.inbuf_old[1]=b(M),mt=0;mt<=2*Ot;++mt)jt.blackfilt[mt]=b(M);for(jt.itime[0]=0,jt.itime[1]=0,vt=0;vt<=2*Ot;vt++){var H=0,J=(vt-Ot)/(2*Ot);for(mt=0;mt<=Y;mt++)H+=jt.blackfilt[vt][mt]=Zt(mt-J,m,Y);for(mt=0;mt<=Y;mt++)jt.blackfilt[vt][mt]/=H}jt.fill_buffer_resample_init=1}var N=jt.inbuf_old[Kt];for(ii=0;ii<Jt;ii++){var R,S;if(R=ii*jt.resample_ratio,vt=0|Math.floor(R-jt.itime[Kt]),Y+vt-Y/2>=zt)break;var J=R-jt.itime[Kt]-(vt+0.5*(Y%2));S=0|Math.floor(J*2*Ot+Ot+0.5);var et=0;for(mt=0;mt<=Y;++mt){var tt=0|mt+vt-Y/2,rt;rt=tt<0?N[M+tt]:Xt[yt+tt],et+=rt*jt.blackfilt[S][mt]}p[Ct+ii]=et}if(Yt.num_used=Math.min(zt,Y+vt-Y/2),jt.itime[Kt]+=Yt.num_used-ii*jt.resample_ratio,Yt.num_used>=M)for(mt=0;mt<M;mt++)N[mt]=Xt[yt+Yt.num_used+mt-M];else{var ut=M-Yt.num_used;for(mt=0;mt<ut;++mt)N[mt]=N[mt+Yt.num_used];for(vt=0;mt<M;++mt,++vt)N[mt]=Xt[yt+vt];j(vt==Yt.num_used)}return ii}function mi(e,p,Ct,Jt,Xt,yt){var zt=e.internal_flags;if(zt.resample_ratio<0.9999||zt.resample_ratio>1.0001)for(var Yt=0;Yt<zt.channels_out;Yt++){var Kt=new Pt;yt.n_out=Vt(e,p[Yt],zt.mf_size,e.framesize,Ct[Yt],Jt,Xt,Kt,Yt),yt.n_in=Kt.num_used}else{yt.n_out=Math.min(e.framesize,Xt),yt.n_in=yt.n_out;for(var jt=0;jt<yt.n_out;++jt)p[0][zt.mf_size+jt]=Ct[0][Jt+jt],zt.channels_out==2&&(p[1][zt.mf_size+jt]=Ct[1][Jt+jt])}}}return Nn=D,Nn}var xr=Ht,zi=xr.VbrMode;function br(){var t=to();function r(w,h,$,_,v,T,E,D,g,C,P,i,a,Z,U){this.vbr_q=w,this.quant_comp=h,this.quant_comp_s=$,this.expY=_,this.st_lrm=v,this.st_s=T,this.masking_adj=E,this.masking_adj_short=D,this.ath_lower=g,this.ath_curve=C,this.ath_sensitivity=P,this.interch=i,this.safejoint=a,this.sfb21mod=Z,this.msfix=U}function d(w,h,$,_,v,T,E,D,g,C,P,i,a,Z){this.quant_comp=h,this.quant_comp_s=$,this.safejoint=_,this.nsmsfix=v,this.st_lrm=T,this.st_s=E,this.nsbass=D,this.scale=g,this.masking_adj=C,this.ath_lower=P,this.ath_curve=i,this.interch=a,this.sfscale=Z}var W;this.setModules=function(w){W=w};var b=[new r(0,9,9,0,5.2,125,-4.2,-6.3,4.8,1,0,0,2,21,0.97),new r(1,9,9,0,5.3,125,-3.6,-5.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,5.6,125,-2.2,-3.5,2.8,2,0,0,2,21,1.49),new r(3,9,9,1,5.8,130,-1.8,-2.8,2.6,3,-4,0,2,20,1.64),new r(4,9,9,1,6,135,-0.7,-1.1,1.1,3.5,-8,0,2,0,1.79),new r(5,9,9,1,6.4,140,0.5,0.4,-7.5,4,-12,0.0002,0,0,1.95),new r(6,9,9,1,6.6,145,0.67,0.65,-14.7,6.5,-19,0.0004,0,0,2.3),new r(7,9,9,1,6.6,145,0.8,0.75,-19.7,8,-22,0.0006,0,0,2.7),new r(8,9,9,1,6.6,145,1.2,1.15,-27.5,10,-23,0.0007,0,0,0),new r(9,9,9,1,6.6,145,1.6,1.6,-36,11,-25,0.0008,0,0,0),new r(10,9,9,1,6.6,145,2,2,-36,12,-25,0.0008,0,0,0)],z=[new r(0,9,9,0,4.2,25,-7,-4,7.5,1,0,0,2,26,0.97),new r(1,9,9,0,4.2,25,-5.6,-3.6,4.5,1.5,0,0,2,21,1.35),new r(2,9,9,0,4.2,25,-4.4,-1.8,2,2,0,0,2,18,1.49),new r(3,9,9,1,4.2,25,-3.4,-1.25,1.1,3,-4,0,2,15,1.64),new r(4,9,9,1,4.2,25,-2.2,0.1,0,3.5,-8,0,2,0,1.79),new r(5,9,9,1,4.2,25,-1,1.65,-7.7,4,-12,0.0002,0,0,1.95),new r(6,9,9,1,4.2,25,-0,2.47,-7.7,6.5,-19,0.0004,0,0,2),new r(7,9,9,1,4.2,25,0.5,2,-14.5,8,-22,0.0006,0,0,2),new r(8,9,9,1,4.2,25,1,2.4,-22,10,-23,0.0007,0,0,2),new r(9,9,9,1,4.2,25,1.5,2.95,-30,11,-25,0.0008,0,0,2),new r(10,9,9,1,4.2,25,2,2.95,-36,12,-30,0.0008,0,0,2)];function X(w,h,$){var _=w.VBR==zi.vbr_rh?b:z,v=w.VBR_q_frac,T=_[h],E=_[h+1],D=T;T.st_lrm=T.st_lrm+v*(E.st_lrm-T.st_lrm),T.st_s=T.st_s+v*(E.st_s-T.st_s),T.masking_adj=T.masking_adj+v*(E.masking_adj-T.masking_adj),T.masking_adj_short=T.masking_adj_short+v*(E.masking_adj_short-T.masking_adj_short),T.ath_lower=T.ath_lower+v*(E.ath_lower-T.ath_lower),T.ath_curve=T.ath_curve+v*(E.ath_curve-T.ath_curve),T.ath_sensitivity=T.ath_sensitivity+v*(E.ath_sensitivity-T.ath_sensitivity),T.interch=T.interch+v*(E.interch-T.interch),T.msfix=T.msfix+v*(E.msfix-T.msfix),A(w,D.vbr_q),$!=0?w.quant_comp=D.quant_comp:Math.abs(w.quant_comp- -1)>0||(w.quant_comp=D.quant_comp),$!=0?w.quant_comp_short=D.quant_comp_s:Math.abs(w.quant_comp_short- -1)>0||(w.quant_comp_short=D.quant_comp_s),D.expY!=0&&(w.experimentalY=D.expY!=0),$!=0?w.internal_flags.nsPsy.attackthre=D.st_lrm:Math.abs(w.internal_flags.nsPsy.attackthre- -1)>0||(w.internal_flags.nsPsy.attackthre=D.st_lrm),$!=0?w.internal_flags.nsPsy.attackthre_s=D.st_s:Math.abs(w.internal_flags.nsPsy.attackthre_s- -1)>0||(w.internal_flags.nsPsy.attackthre_s=D.st_s),$!=0?w.maskingadjust=D.masking_adj:Math.abs(w.maskingadjust-0)>0||(w.maskingadjust=D.masking_adj),$!=0?w.maskingadjust_short=D.masking_adj_short:Math.abs(w.maskingadjust_short-0)>0||(w.maskingadjust_short=D.masking_adj_short),$!=0?w.ATHlower=-D.ath_lower/10:Math.abs(-w.ATHlower*10-0)>0||(w.ATHlower=-D.ath_lower/10),$!=0?w.ATHcurve=D.ath_curve:Math.abs(w.ATHcurve- -1)>0||(w.ATHcurve=D.ath_curve),$!=0?w.athaa_sensitivity=D.ath_sensitivity:Math.abs(w.athaa_sensitivity- -1)>0||(w.athaa_sensitivity=D.ath_sensitivity),D.interch>0&&($!=0?w.interChRatio=D.interch:Math.abs(w.interChRatio- -1)>0||(w.interChRatio=D.interch)),D.safejoint>0&&(w.exp_nspsytune=w.exp_nspsytune|D.safejoint),D.sfb21mod>0&&(w.exp_nspsytune=w.exp_nspsytune|D.sfb21mod<<20),$!=0?w.msfix=D.msfix:Math.abs(w.msfix- -1)>0||(w.msfix=D.msfix),$==0&&(w.VBR_q=h,w.VBR_q_frac=v)}var j=[new d(8,9,9,0,0,6.6,145,0,0.95,0,-30,11,0.0012,1),new d(16,9,9,0,0,6.6,145,0,0.95,0,-25,11,0.001,1),new d(24,9,9,0,0,6.6,145,0,0.95,0,-20,11,0.001,1),new d(32,9,9,0,0,6.6,145,0,0.95,0,-15,11,0.001,1),new d(40,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new d(48,9,9,0,0,6.6,145,0,0.95,0,-10,11,0.0009,1),new d(56,9,9,0,0,6.6,145,0,0.95,0,-6,11,0.0008,1),new d(64,9,9,0,0,6.6,145,0,0.95,0,-2,11,0.0008,1),new d(80,9,9,0,0,6.6,145,0,0.95,0,0,8,0.0007,1),new d(96,9,9,0,2.5,6.6,145,0,0.95,0,1,5.5,0.0006,1),new d(112,9,9,0,2.25,6.6,145,0,0.95,0,2,4.5,0.0005,1),new d(128,9,9,0,1.95,6.4,140,0,0.95,0,3,4,0.0002,1),new d(160,9,9,1,1.79,6,135,0,0.95,-2,5,3.5,0,1),new d(192,9,9,1,1.49,5.6,125,0,0.97,-4,7,3,0,0),new d(224,9,9,1,1.25,5.2,125,0,0.98,-6,9,2,0,0),new d(256,9,9,1,0.97,5.2,125,0,1,-8,10,1,0,0),new d(320,9,9,1,0.9,5.2,125,0,1,-10,12,0,0,0)];function O(w,h,$){var _=h,v=W.nearestBitrateFullIndex(h);if(w.VBR=zi.vbr_abr,w.VBR_mean_bitrate_kbps=_,w.VBR_mean_bitrate_kbps=Math.min(w.VBR_mean_bitrate_kbps,320),w.VBR_mean_bitrate_kbps=Math.max(w.VBR_mean_bitrate_kbps,8),w.brate=w.VBR_mean_bitrate_kbps,w.VBR_mean_bitrate_kbps>320&&(w.disable_reservoir=!0),j[v].safejoint>0&&(w.exp_nspsytune=w.exp_nspsytune|2),j[v].sfscale>0&&(w.internal_flags.noise_shaping=2),Math.abs(j[v].nsbass)>0){var T=int(j[v].nsbass*4);T<0&&(T+=64),w.exp_nspsytune=w.exp_nspsytune|T<<2}return $!=0?w.quant_comp=j[v].quant_comp:Math.abs(w.quant_comp- -1)>0||(w.quant_comp=j[v].quant_comp),$!=0?w.quant_comp_short=j[v].quant_comp_s:Math.abs(w.quant_comp_short- -1)>0||(w.quant_comp_short=j[v].quant_comp_s),$!=0?w.msfix=j[v].nsmsfix:Math.abs(w.msfix- -1)>0||(w.msfix=j[v].nsmsfix),$!=0?w.internal_flags.nsPsy.attackthre=j[v].st_lrm:Math.abs(w.internal_flags.nsPsy.attackthre- -1)>0||(w.internal_flags.nsPsy.attackthre=j[v].st_lrm),$!=0?w.internal_flags.nsPsy.attackthre_s=j[v].st_s:Math.abs(w.internal_flags.nsPsy.attackthre_s- -1)>0||(w.internal_flags.nsPsy.attackthre_s=j[v].st_s),$!=0?w.scale=j[v].scale:Math.abs(w.scale- -1)>0||(w.scale=j[v].scale),$!=0?w.maskingadjust=j[v].masking_adj:Math.abs(w.maskingadjust-0)>0||(w.maskingadjust=j[v].masking_adj),j[v].masking_adj>0?$!=0?w.maskingadjust_short=j[v].masking_adj*0.9:Math.abs(w.maskingadjust_short-0)>0||(w.maskingadjust_short=j[v].masking_adj*0.9):$!=0?w.maskingadjust_short=j[v].masking_adj*1.1:Math.abs(w.maskingadjust_short-0)>0||(w.maskingadjust_short=j[v].masking_adj*1.1),$!=0?w.ATHlower=-j[v].ath_lower/10:Math.abs(-w.ATHlower*10-0)>0||(w.ATHlower=-j[v].ath_lower/10),$!=0?w.ATHcurve=j[v].ath_curve:Math.abs(w.ATHcurve- -1)>0||(w.ATHcurve=j[v].ath_curve),$!=0?w.interChRatio=j[v].interch:Math.abs(w.interChRatio- -1)>0||(w.interChRatio=j[v].interch),h}this.apply_preset=function(w,h,$){switch(h){case t.R3MIX:{h=t.V3,w.VBR=zi.vbr_mtrh;break}case t.MEDIUM:{h=t.V4,w.VBR=zi.vbr_rh;break}case t.MEDIUM_FAST:{h=t.V4,w.VBR=zi.vbr_mtrh;break}case t.STANDARD:{h=t.V2,w.VBR=zi.vbr_rh;break}case t.STANDARD_FAST:{h=t.V2,w.VBR=zi.vbr_mtrh;break}case t.EXTREME:{h=t.V0,w.VBR=zi.vbr_rh;break}case t.EXTREME_FAST:{h=t.V0,w.VBR=zi.vbr_mtrh;break}case t.INSANE:return h=320,w.preset=h,O(w,h,$),w.VBR=zi.vbr_off,h}switch(w.preset=h,h){case t.V9:return X(w,9,$),h;case t.V8:return X(w,8,$),h;case t.V7:return X(w,7,$),h;case t.V6:return X(w,6,$),h;case t.V5:return X(w,5,$),h;case t.V4:return X(w,4,$),h;case t.V3:return X(w,3,$),h;case t.V2:return X(w,2,$),h;case t.V1:return X(w,1,$),h;case t.V0:return X(w,0,$),h}return 8<=h&&h<=320?O(w,h,$):(w.preset=0,h)};function A(w,h){var $=0;return 0>h&&($=-1,h=0),9<h&&($=-1,h=9),w.VBR_q=h,w.VBR_q_frac=0,$}}var vr=br;function Vr(){this.setModules=function(t,r){}}var Tr=Vr;function Nr(){this.over_noise=0,this.tot_noise=0,this.max_noise=0,this.over_count=0,this.over_SSD=0,this.bits=0}var Sr=Nr,me=Ht,xo=me.new_float,Er=me.new_int;function Hr(){this.global_gain=0,this.sfb_count1=0,this.step=Er(39),this.noise=xo(39),this.noise_log=xo(39)}var Ir=Hr,Ii=Ht,Fi=Ii.System,bo=Ii.VbrMode,Sn=Ii.Util,Ei=Ii.Arrays,sn=Ii.new_float,dn=Ii.assert,_r=Tr,En=Sr,Br=Ir,bt=ei(),vo=In,Vo=Pn;function Rr(){var t;this.rv=null;var r;this.qupvt=null;var d,W=new _r,b;this.setModules=function(D,g,C,P){t=D,r=g,this.rv=g,d=C,this.qupvt=C,b=P,W.setModules(d,b)},this.ms_convert=function(D,g){for(var C=0;C<576;++C){var P=D.tt[g][0].xr[C],i=D.tt[g][1].xr[C];D.tt[g][0].xr[C]=(P+i)*(Sn.SQRT2*0.5),D.tt[g][1].xr[C]=(P-i)*(Sn.SQRT2*0.5)}};function z(D,g,C,P){P=0;for(var i=0;i<=C;++i){var a=Math.abs(D.xr[i]);P+=a,g[i]=Math.sqrt(a*Math.sqrt(a)),g[i]>D.xrpow_max&&(D.xrpow_max=g[i])}return P}this.init_xrpow=function(D,g,C){var P=0,i=0|g.max_nonzero_coeff;if(g.xrpow_max=0,Ei.fill(C,i,576,0),P=z(g,C,i,P),P>0.00000000000000000001){var a=0;D.substep_shaping&2&&(a=1);for(var Z=0;Z<g.psymax;Z++)D.pseudohalf[Z]=a;return!0}return Ei.fill(g.l3_enc,0,576,0),!1};function X(D,g){var C=D.ATH,P=g.xr;if(g.block_type!=bt.SHORT_TYPE)for(var i=!1,a=bt.PSFB21-1;a>=0&&!i;a--){var Z=D.scalefac_band.psfb21[a],U=D.scalefac_band.psfb21[a+1],x=d.athAdjust(C.adjust,C.psfb21[a],C.floor);D.nsPsy.longfact[21]>0.000000000001&&(x*=D.nsPsy.longfact[21]);for(var F=U-1;F>=Z;F--)if(Math.abs(P[F])<x)P[F]=0;else{i=!0;break}}else for(var L=0;L<3;L++)for(var i=!1,a=bt.PSFB12-1;a>=0&&!i;a--){var Z=D.scalefac_band.s[12]*3+(D.scalefac_band.s[13]-D.scalefac_band.s[12])*L+(D.scalefac_band.psfb12[a]-D.scalefac_band.psfb12[0]),U=Z+(D.scalefac_band.psfb12[a+1]-D.scalefac_band.psfb12[a]),at=d.athAdjust(C.adjust,C.psfb12[a],C.floor);D.nsPsy.shortfact[12]>0.000000000001&&(at*=D.nsPsy.shortfact[12]);for(var F=U-1;F>=Z;F--)if(Math.abs(P[F])<at)P[F]=0;else{i=!0;break}}}this.init_outer_loop=function(D,g){g.part2_3_length=0,g.big_values=0,g.count1=0,g.global_gain=210,g.scalefac_compress=0,g.table_select[0]=0,g.table_select[1]=0,g.table_select[2]=0,g.subblock_gain[0]=0,g.subblock_gain[1]=0,g.subblock_gain[2]=0,g.subblock_gain[3]=0,g.region0_count=0,g.region1_count=0,g.preflag=0,g.scalefac_scale=0,g.count1table_select=0,g.part2_length=0,g.sfb_lmax=bt.SBPSY_l,g.sfb_smin=bt.SBPSY_s,g.psy_lmax=D.sfb21_extra?bt.SBMAX_l:bt.SBPSY_l,g.psymax=g.psy_lmax,g.sfbmax=g.sfb_lmax,g.sfbdivide=11;for(var C=0;C<bt.SBMAX_l;C++)g.width[C]=D.scalefac_band.l[C+1]-D.scalefac_band.l[C],g.window[C]=3;if(g.block_type==bt.SHORT_TYPE){var P=sn(576);g.sfb_smin=0,g.sfb_lmax=0,g.mixed_block_flag!=0&&(g.sfb_smin=3,g.sfb_lmax=D.mode_gr*2+4),g.psymax=g.sfb_lmax+3*((D.sfb21_extra?bt.SBMAX_s:bt.SBPSY_s)-g.sfb_smin),g.sfbmax=g.sfb_lmax+3*(bt.SBPSY_s-g.sfb_smin),g.sfbdivide=g.sfbmax-18,g.psy_lmax=g.sfb_lmax;var i=D.scalefac_band.l[g.sfb_lmax];Fi.arraycopy(g.xr,0,P,0,576);for(var C=g.sfb_smin;C<bt.SBMAX_s;C++)for(var a=D.scalefac_band.s[C],Z=D.scalefac_band.s[C+1],U=0;U<3;U++)for(var x=a;x<Z;x++)g.xr[i++]=P[3*x+U];for(var{sfb_lmax:F,sfb_smin:C}=g;C<bt.SBMAX_s;C++)g.width[F]=g.width[F+1]=g.width[F+2]=D.scalefac_band.s[C+1]-D.scalefac_band.s[C],g.window[F]=0,g.window[F+1]=1,g.window[F+2]=2,F+=3}g.count1bits=0,g.sfb_partition_table=d.nr_of_sfb_block[0][0],g.slen[0]=0,g.slen[1]=0,g.slen[2]=0,g.slen[3]=0,g.max_nonzero_coeff=575,Ei.fill(g.scalefac,0),X(D,g)};function j(D){this.ordinal=D}j.BINSEARCH_NONE=new j(0),j.BINSEARCH_UP=new j(1),j.BINSEARCH_DOWN=new j(2);function O(D,g,C,P,i){var a,Z=D.CurrentStep[P],U=!1,x=D.OldValue[P],F=j.BINSEARCH_NONE;for(g.global_gain=x,C-=g.part2_length;;){var L;if(a=b.count_bits(D,i,g,null),Z==1||a==C)break;a>C?(F==j.BINSEARCH_DOWN&&(U=!0),U&&(Z/=2),F=j.BINSEARCH_UP,L=Z):(F==j.BINSEARCH_UP&&(U=!0),U&&(Z/=2),F=j.BINSEARCH_DOWN,L=-Z),g.global_gain+=L,g.global_gain<0&&(g.global_gain=0,U=!0),g.global_gain>255&&(g.global_gain=255,U=!0)}for(dn(g.global_gain>=0),dn(g.global_gain<256);a>C&&g.global_gain<255;)g.global_gain++,a=b.count_bits(D,i,g,null);return D.CurrentStep[P]=x-g.global_gain>=4?4:2,D.OldValue[P]=g.global_gain,g.part2_3_length=a,a}this.trancate_smallspectrums=function(D,g,C,P){var i=sn(Vo.SFBMAX);if(!(!(D.substep_shaping&4)&&g.block_type==bt.SHORT_TYPE||D.substep_shaping&128)){d.calc_noise(g,C,i,new En,null);for(var Z=0;Z<576;Z++){var a=0;g.l3_enc[Z]!=0&&(a=Math.abs(g.xr[Z])),P[Z]=a}var Z=0,U=8;g.block_type==bt.SHORT_TYPE&&(U=6);do{var x,F,L,at,k=g.width[U];if(Z+=k,!(i[U]>=1)&&(Ei.sort(P,Z-k,k),!BitStream.EQ(P[Z-1],0))){x=(1-i[U])*C[U],F=0,at=0;do{var n;for(L=1;at+L<k&&!BitStream.NEQ(P[at+Z-k],P[at+Z+L-k]);L++);if(n=P[at+Z-k]*P[at+Z-k]*L,x<n){at!=0&&(F=P[at+Z-k-1]);break}x-=n,at+=L}while(at<k);if(!BitStream.EQ(F,0))do Math.abs(g.xr[Z-k])<=F&&(g.l3_enc[Z-k]=0);while(--k>0)}}while(++U<g.psymax);g.part2_3_length=b.noquant_count_bits(D,g,null)}};function A(D){for(var g=0;g<D.sfbmax;g++)if(D.scalefac[g]+D.subblock_gain[D.window[g]]==0)return!1;return!0}function w(D){return Sn.FAST_LOG10(0.368+0.632*D*D*D)}function h(D,g){for(var C=0.0000000000000000000000000000000000001,P=0;P<g.psymax;P++)C+=w(D[P]);return Math.max(0.00000000000000000001,C)}function $(D,g,C,P,i){var a;switch(D){default:case 9:{g.over_count>0?(a=C.over_SSD<=g.over_SSD,C.over_SSD==g.over_SSD&&(a=C.bits<g.bits)):a=C.max_noise<0&&C.max_noise*10+C.bits<=g.max_noise*10+g.bits;break}case 0:a=C.over_count<g.over_count||C.over_count==g.over_count&&C.over_noise<g.over_noise||C.over_count==g.over_count&&BitStream.EQ(C.over_noise,g.over_noise)&&C.tot_noise<g.tot_noise;break;case 8:C.max_noise=h(i,P);case 1:a=C.max_noise<g.max_noise;break;case 2:a=C.tot_noise<g.tot_noise;break;case 3:a=C.tot_noise<g.tot_noise&&C.max_noise<g.max_noise;break;case 4:a=C.max_noise<=0&&g.max_noise>0.2||C.max_noise<=0&&g.max_noise<0&&g.max_noise>C.max_noise-0.2&&C.tot_noise<g.tot_noise||C.max_noise<=0&&g.max_noise>0&&g.max_noise>C.max_noise-0.2&&C.tot_noise<g.tot_noise+g.over_noise||C.max_noise>0&&g.max_noise>-0.05&&g.max_noise>C.max_noise-0.1&&C.tot_noise+C.over_noise<g.tot_noise+g.over_noise||C.max_noise>0&&g.max_noise>-0.1&&g.max_noise>C.max_noise-0.15&&C.tot_noise+C.over_noise+C.over_noise<g.tot_noise+g.over_noise+g.over_noise;break;case 5:a=C.over_noise<g.over_noise||BitStream.EQ(C.over_noise,g.over_noise)&&C.tot_noise<g.tot_noise;break;case 6:a=C.over_noise<g.over_noise||BitStream.EQ(C.over_noise,g.over_noise)&&(C.max_noise<g.max_noise||BitStream.EQ(C.max_noise,g.max_noise)&&C.tot_noise<=g.tot_noise);break;case 7:a=C.over_count<g.over_count||C.over_noise<g.over_noise;break}return g.over_count==0&&(a=a&&C.bits<g.bits),a}function _(D,g,C,P,i){var a=D.internal_flags,Z;g.scalefac_scale==0?Z=1.2968395546510096:Z=1.6817928305074292;for(var U=0,x=0;x<g.sfbmax;x++)U<C[x]&&(U=C[x]);var F=a.noise_shaping_amp;switch(F==3&&(i?F=2:F=1),F){case 2:break;case 1:U>1?U=Math.pow(U,0.5):U*=0.95;break;case 0:default:U>1?U=1:U*=0.95;break}for(var L=0,x=0;x<g.sfbmax;x++){var at=g.width[x],k;if(L+=at,!(C[x]<U)){if(a.substep_shaping&2&&(a.pseudohalf[x]=a.pseudohalf[x]==0?1:0,a.pseudohalf[x]==0&&a.noise_shaping_amp==2))return;for(g.scalefac[x]++,k=-at;k<0;k++)P[L+k]*=Z,P[L+k]>g.xrpow_max&&(g.xrpow_max=P[L+k]);if(a.noise_shaping_amp==2)return}}}function v(D,g){for(var C=1.2968395546510096,P=0,i=0;i<D.sfbmax;i++){var a=D.width[i],Z=D.scalefac[i];if(D.preflag!=0&&(Z+=d.pretab[i]),P+=a,Z&1){Z++;for(var U=-a;U<0;U++)g[P+U]*=C,g[P+U]>D.xrpow_max&&(D.xrpow_max=g[P+U])}D.scalefac[i]=Z>>1}D.preflag=0,D.scalefac_scale=1}function T(D,g,C){var P,i=g.scalefac;for(P=0;P<g.sfb_lmax;P++)if(i[P]>=16)return!0;for(var a=0;a<3;a++){var Z=0,U=0;for(P=g.sfb_lmax+a;P<g.sfbdivide;P+=3)Z<i[P]&&(Z=i[P]);for(;P<g.sfbmax;P+=3)U<i[P]&&(U=i[P]);if(!(Z<16&&U<8)){if(g.subblock_gain[a]>=7)return!0;g.subblock_gain[a]++;var x=D.scalefac_band.l[g.sfb_lmax];for(P=g.sfb_lmax+a;P<g.sfbmax;P+=3){var F,L=g.width[P],at=i[P];if(at=at-(4>>g.scalefac_scale),at>=0){i[P]=at,x+=L*3;continue}i[P]=0;{var k=210+(at<<g.scalefac_scale+1);F=d.IPOW20(k)}x+=L*(a+1);for(var n=-L;n<0;n++)C[x+n]*=F,C[x+n]>g.xrpow_max&&(g.xrpow_max=C[x+n]);x+=L*(3-a-1)}{var F=d.IPOW20(202);x+=g.width[P]*(a+1);for(var n=-g.width[P];n<0;n++)C[x+n]*=F,C[x+n]>g.xrpow_max&&(g.xrpow_max=C[x+n])}}}return!1}function E(D,g,C,P,i){var a=D.internal_flags;_(D,g,C,P,i);var Z=A(g);return Z?!1:(a.mode_gr==2?Z=b.scale_bitcount(g):Z=b.scale_bitcount_lsf(a,g),Z?(a.noise_shaping>1&&(Ei.fill(a.pseudohalf,0),g.scalefac_scale==0?(v(g,P),Z=!1):g.block_type==bt.SHORT_TYPE&&a.subblock_gain>0&&(Z=T(a,g,P)||A(g))),Z||(a.mode_gr==2?Z=b.scale_bitcount(g):Z=b.scale_bitcount_lsf(a,g)),!Z):!0)}this.outer_loop=function(D,g,C,P,i,a){var Z=D.internal_flags,U=new vo,x=sn(576),F=sn(Vo.SFBMAX),L=new En,at,k=new Br,n=9999999,G=!1,K=!1,V=0;if(O(Z,g,a,i,P),Z.noise_shaping==0)return 100;d.calc_noise(g,C,F,L,k),L.bits=g.part2_3_length,U.assign(g);var q=0;for(Fi.arraycopy(P,0,x,0,576);!G;){do{var it=new En,Q,c=255;if(Z.substep_shaping&2?Q=20:Q=3,Z.sfb21_extra&&(F[U.sfbmax]>1||U.block_type==bt.SHORT_TYPE&&(F[U.sfbmax+1]>1||F[U.sfbmax+2]>1))||!E(D,U,F,P,K))break;U.scalefac_scale!=0&&(c=254);var s=a-U.part2_length;if(s<=0)break;for(;(U.part2_3_length=b.count_bits(Z,P,U,k))>s&&U.global_gain<=c;)U.global_gain++;if(U.global_gain>c)break;if(L.over_count==0){for(;(U.part2_3_length=b.count_bits(Z,P,U,k))>n&&U.global_gain<=c;)U.global_gain++;if(U.global_gain>c)break}if(d.calc_noise(U,C,F,it,k),it.bits=U.part2_3_length,g.block_type!=bt.SHORT_TYPE?at=D.quant_comp:at=D.quant_comp_short,at=$(at,L,it,U,F)?1:0,at!=0)n=g.part2_3_length,L=it,g.assign(U),q=0,Fi.arraycopy(P,0,x,0,576);else if(Z.full_outer_loop==0&&(++q>Q&&L.over_count==0||Z.noise_shaping_amp==3&&K&&q>30||Z.noise_shaping_amp==3&&K&&U.global_gain-V>15))break}while(U.global_gain+U.scalefac_scale<255);Z.noise_shaping_amp==3?K?G=!0:(U.assign(g),Fi.arraycopy(x,0,P,0,576),q=0,V=U.global_gain,K=!0):G=!0}return dn(g.global_gain+g.scalefac_scale<=255),D.VBR==bo.vbr_rh||D.VBR==bo.vbr_mtrh?Fi.arraycopy(x,0,P,0,576):Z.substep_shaping&1&&trancate_smallspectrums(Z,g,C,P),L.over_count},this.iteration_finish_one=function(D,g,C){var P=D.l3_side,i=P.tt[g][C];b.best_scalefac_store(D,g,C,P),D.use_best_huffman==1&&b.best_huffman_divide(D,i),r.ResvAdjust(D,i)},this.VBR_encode_granule=function(D,g,C,P,i,a,Z){var U=D.internal_flags,x=new vo,F=sn(576),L=Z,at=Z+1,k=(Z+a)/2,n,G,K=0,V=U.sfb21_extra;dn(L<=LameInternalFlags.MAX_BITS_PER_CHANNEL),Ei.fill(x.l3_enc,0);do k>L-42?U.sfb21_extra=!1:U.sfb21_extra=V,G=outer_loop(D,g,C,P,i,k),G<=0?(K=1,at=g.part2_3_length,x.assign(g),Fi.arraycopy(P,0,F,0,576),Z=at-32,n=Z-a,k=(Z+a)/2):(a=k+32,n=Z-a,k=(Z+a)/2,K!=0&&(K=2,g.assign(x),Fi.arraycopy(F,0,P,0,576)));while(n>12);U.sfb21_extra=V,K==2&&Fi.arraycopy(x.l3_enc,0,g.l3_enc,0,576),dn(g.part2_3_length<=L)},this.get_framebits=function(D,g){var C=D.internal_flags;C.bitrate_index=C.VBR_min_bitrate;var P=t.getframebits(D);C.bitrate_index=1,P=t.getframebits(D);for(var i=1;i<=C.VBR_max_bitrate;i++){C.bitrate_index=i;var a=new MeanBits(P);g[i]=r.ResvFrameBegin(D,a),P=a.bits}},this.VBR_old_prepare=function(D,g,C,P,i,a,Z,U,x){var F=D.internal_flags,L,at=0,k=1,n=0;F.bitrate_index=F.VBR_max_bitrate;var G=r.ResvFrameBegin(D,new MeanBits(0))/F.mode_gr;get_framebits(D,a);for(var K=0;K<F.mode_gr;K++){var V=d.on_pe(D,g,U[K],G,K,0);F.mode_ext==bt.MPG_MD_MS_LR&&(ms_convert(F.l3_side,K),d.reduce_side(U[K],C[K],G,V));for(var q=0;q<F.channels_out;++q){var it=F.l3_side.tt[K][q];it.block_type!=bt.SHORT_TYPE?(at=1.28/(1+Math.exp(3.5-g[K][q]/300))-0.05,L=F.PSY.mask_adjust-at):(at=2.56/(1+Math.exp(3.5-g[K][q]/300))-0.14,L=F.PSY.mask_adjust_short-at),F.masking_lower=Math.pow(10,L*0.1),init_outer_loop(F,it),x[K][q]=d.calc_xmin(D,P[K][q],it,i[K][q]),x[K][q]!=0&&(k=0),Z[K][q]=126,n+=U[K][q]}}for(var K=0;K<F.mode_gr;K++)for(var q=0;q<F.channels_out;q++)n>a[F.VBR_max_bitrate]&&(U[K][q]*=a[F.VBR_max_bitrate],U[K][q]/=n),Z[K][q]>U[K][q]&&(Z[K][q]=U[K][q]);return k},this.bitpressure_strategy=function(D,g,C,P){for(var i=0;i<D.mode_gr;i++)for(var a=0;a<D.channels_out;a++){for(var Z=D.l3_side.tt[i][a],U=g[i][a],x=0,F=0;F<Z.psy_lmax;F++)U[x++]*=1+0.029*F*F/bt.SBMAX_l/bt.SBMAX_l;if(Z.block_type==bt.SHORT_TYPE)for(var F=Z.sfb_smin;F<bt.SBMAX_s;F++)U[x++]*=1+0.029*F*F/bt.SBMAX_s/bt.SBMAX_s,U[x++]*=1+0.029*F*F/bt.SBMAX_s/bt.SBMAX_s,U[x++]*=1+0.029*F*F/bt.SBMAX_s/bt.SBMAX_s;P[i][a]=0|Math.max(C[i][a],0.9*P[i][a])}},this.VBR_new_prepare=function(D,g,C,P,i,a){var Z=D.internal_flags,U=1,x=0,F=0,L;if(D.free_format){Z.bitrate_index=0;var at=new MeanBits(x);L=r.ResvFrameBegin(D,at),x=at.bits,i[0]=L}else{Z.bitrate_index=Z.VBR_max_bitrate;var at=new MeanBits(x);r.ResvFrameBegin(D,at),x=at.bits,get_framebits(D,i),L=i[Z.VBR_max_bitrate]}for(var k=0;k<Z.mode_gr;k++){d.on_pe(D,g,a[k],x,k,0),Z.mode_ext==bt.MPG_MD_MS_LR&&ms_convert(Z.l3_side,k);for(var n=0;n<Z.channels_out;++n){var G=Z.l3_side.tt[k][n];Z.masking_lower=Math.pow(10,Z.PSY.mask_adjust*0.1),init_outer_loop(Z,G),d.calc_xmin(D,C[k][n],G,P[k][n])!=0&&(U=0),F+=a[k][n]}}for(var k=0;k<Z.mode_gr;k++)for(var n=0;n<Z.channels_out;n++)F>L&&(a[k][n]*=L,a[k][n]/=F);return U},this.calc_target_bits=function(D,g,C,P,i,a){var Z=D.internal_flags,U=Z.l3_side,x,F,L,at,k=0;Z.bitrate_index=Z.VBR_max_bitrate;var n=new MeanBits(k);for(a[0]=r.ResvFrameBegin(D,n),k=n.bits,Z.bitrate_index=1,k=t.getframebits(D)-Z.sideinfo_len*8,i[0]=k/(Z.mode_gr*Z.channels_out),k=D.VBR_mean_bitrate_kbps*D.framesize*1000,Z.substep_shaping&1&&(k*=1.09),k/=D.out_samplerate,k-=Z.sideinfo_len*8,k/=Z.mode_gr*Z.channels_out,x=0.93+0.07*(11-D.compression_ratio)/5.5,x<0.9&&(x=0.9),x>1&&(x=1),F=0;F<Z.mode_gr;F++){var G=0;for(L=0;L<Z.channels_out;L++){if(P[F][L]=int(x*k),g[F][L]>700){var K=int((g[F][L]-700)/1.4),V=U.tt[F][L];P[F][L]=int(x*k),V.block_type==bt.SHORT_TYPE&&K<k/2&&(K=k/2),K>k*3/2?K=k*3/2:K<0&&(K=0),P[F][L]+=K}P[F][L]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[F][L]=LameInternalFlags.MAX_BITS_PER_CHANNEL),G+=P[F][L]}if(G>LameInternalFlags.MAX_BITS_PER_GRANULE)for(L=0;L<Z.channels_out;++L)P[F][L]*=LameInternalFlags.MAX_BITS_PER_GRANULE,P[F][L]/=G}if(Z.mode_ext==bt.MPG_MD_MS_LR)for(F=0;F<Z.mode_gr;F++)d.reduce_side(P[F],C[F],k*Z.channels_out,LameInternalFlags.MAX_BITS_PER_GRANULE);for(at=0,F=0;F<Z.mode_gr;F++)for(L=0;L<Z.channels_out;L++)P[F][L]>LameInternalFlags.MAX_BITS_PER_CHANNEL&&(P[F][L]=LameInternalFlags.MAX_BITS_PER_CHANNEL),at+=P[F][L];if(at>a[0])for(F=0;F<Z.mode_gr;F++)for(L=0;L<Z.channels_out;L++)P[F][L]*=a[0],P[F][L]/=at}}var Ar=Rr,ts=Ht,To=ts.assert;function is(){var t;this.setModules=function(r){t=r},this.ResvFrameBegin=function(r,d){var W=r.internal_flags,b,z=W.l3_side,X=t.getframebits(r);d.bits=(X-W.sideinfo_len*8)/W.mode_gr;var j=2048*W.mode_gr-8;r.brate>320?b=8*int(r.brate*1000/(r.out_samplerate/1152)/8+0.5):(b=11520,r.strict_ISO&&(b=8*int(320000/(r.out_samplerate/1152)/8+0.5))),W.ResvMax=b-X,W.ResvMax>j&&(W.ResvMax=j),(W.ResvMax<0||r.disable_reservoir)&&(W.ResvMax=0);var O=d.bits*W.mode_gr+Math.min(W.ResvSize,W.ResvMax);return O>b&&(O=b),To(W.ResvMax%8==0),To(W.ResvMax>=0),z.resvDrain_pre=0,W.pinfo!=null&&(W.pinfo.mean_bits=d.bits/2,W.pinfo.resvsize=W.ResvSize),O},this.ResvMaxBits=function(r,d,W,b){var z=r.internal_flags,X,j=z.ResvSize,O=z.ResvMax;b!=0&&(j+=d),z.substep_shaping&1&&(O*=0.9),W.bits=d,j*10>O*9?(X=j-O*9/10,W.bits+=X,z.substep_shaping|=128):(X=0,z.substep_shaping&=127,!r.disable_reservoir&&!(z.substep_shaping&1)&&(W.bits-=0.1*d));var A=j<z.ResvMax*6/10?j:z.ResvMax*6/10;return A-=X,A<0&&(A=0),A},this.ResvAdjust=function(r,d){r.ResvSize-=d.part2_3_length+d.part2_length},this.ResvFrameEnd=function(r,d){var W,b=r.l3_side;r.ResvSize+=d*r.mode_gr;var z=0;b.resvDrain_post=0,b.resvDrain_pre=0,(W=r.ResvSize%8)!=0&&(z+=W),W=r.ResvSize-z-r.ResvMax,W>0&&(z+=W);{var X=Math.min(b.main_data_begin*8,z)/8;b.resvDrain_pre+=8*X,z-=8*X,r.ResvSize-=8*X,b.main_data_begin-=X}b.resvDrain_post+=z,r.ResvSize-=z}}var ns=is;function os(){var t="http://www.mp3dev.org/",r=3,d=98,W=4,b=0,z=93;this.getLameVersion=function(){return r+"."+d+"."+W},this.getLameShortVersion=function(){return r+"."+d+"."+W},this.getLameVeryShortVersion=function(){return"LAME"+r+"."+d+"r"},this.getPsyVersion=function(){return b+"."+z},this.getLameUrl=function(){return t},this.getLameOsBitness=function(){return"32bits"}}var es=os,_i=Ht,rs=_i.System,Hn=_i.VbrMode,No=_i.ShortBlock,ss=_i.Arrays,fn=_i.new_byte,ds=_i.assert;hn.NUMTOCENTRIES=100;hn.MAXFRAMESIZE=2880;function hn(){var t,r,d;this.setModules=function(k,n,G){t=k,r=n,d=G};var W=1,b=2,z=4,X=8,j=hn.NUMTOCENTRIES,O=hn.MAXFRAMESIZE,A=j+4+4+4+4+4,w=A+9+1+1+8+1+1+3+1+1+2+4+2+2,h=128,$=64,_=32,v=null,T="Xing",E="Info",D=[0,49345,49537,320,49921,960,640,49729,50689,1728,1920,51009,1280,50625,50305,1088,52225,3264,3456,52545,3840,53185,52865,3648,2560,51905,52097,2880,51457,2496,2176,51265,55297,6336,6528,55617,6912,56257,55937,6720,7680,57025,57217,8000,56577,7616,7296,56385,5120,54465,54657,5440,55041,6080,5760,54849,53761,4800,4992,54081,4352,53697,53377,4160,61441,12480,12672,61761,13056,62401,62081,12864,13824,63169,63361,14144,62721,13760,13440,62529,15360,64705,64897,15680,65281,16320,16000,65089,64001,15040,15232,64321,14592,63937,63617,14400,10240,59585,59777,10560,60161,11200,10880,59969,60929,11968,12160,61249,11520,60865,60545,11328,58369,9408,9600,58689,9984,59329,59009,9792,8704,58049,58241,9024,57601,8640,8320,57409,40961,24768,24960,41281,25344,41921,41601,25152,26112,42689,42881,26432,42241,26048,25728,42049,27648,44225,44417,27968,44801,28608,28288,44609,43521,27328,27520,43841,26880,43457,43137,26688,30720,47297,47489,31040,47873,31680,31360,47681,48641,32448,32640,48961,32000,48577,48257,31808,46081,29888,30080,46401,30464,47041,46721,30272,29184,45761,45953,29504,45313,29120,28800,45121,20480,37057,37249,20800,37633,21440,21120,37441,38401,22208,22400,38721,21760,38337,38017,21568,39937,23744,23936,40257,24320,40897,40577,24128,23040,39617,39809,23360,39169,22976,22656,38977,34817,18624,18816,35137,19200,35777,35457,19008,19968,36545,36737,20288,36097,19904,19584,35905,17408,33985,34177,17728,34561,18368,18048,34369,33281,17088,17280,33601,16640,33217,32897,16448];function g(k,n){if(k.nVbrNumFrames++,k.sum+=n,k.seen++,!(k.seen<k.want)&&(k.pos<k.size&&(k.bag[k.pos]=k.sum,k.pos++,k.seen=0),k.pos==k.size)){for(var G=1;G<k.size;G+=2)k.bag[G/2]=k.bag[G];k.want*=2,k.pos/=2}}function C(k,n){if(!(k.pos<=0))for(var G=1;G<j;++G){var K=G/j,V,q,it=0|Math.floor(K*k.pos);it>k.pos-1&&(it=k.pos-1),V=k.bag[it],q=k.sum;var Q=0|256*V/q;Q>255&&(Q=255),n[G]=255&Q}}this.addVbrFrame=function(k){var n=k.internal_flags,G=Tables.bitrate_table[k.version][n.bitrate_index];ds(n.VBR_seek_table.bag!=null),g(n.VBR_seek_table,G)};function P(k,n){var G=k[n+0]&255;return G<<=8,G|=k[n+1]&255,G<<=8,G|=k[n+2]&255,G<<=8,G|=k[n+3]&255,G}function i(k,n,G){k[n+0]=255&(G>>24&255),k[n+1]=255&(G>>16&255),k[n+2]=255&(G>>8&255),k[n+3]=255&(G&255)}function a(k,n,G){k[n+0]=255&(G>>8&255),k[n+1]=255&(G&255)}function Z(k,n){return new String(k,n,T.length(),v).equals(T)||new String(k,n,E.length(),v).equals(E)}function U(k,n,G){return 255&(k<<n|G&~(-1<<n))}function x(k,n){var G=k.internal_flags;n[0]=U(n[0],8,255),n[1]=U(n[1],3,7),n[1]=U(n[1],1,k.out_samplerate<16000?0:1),n[1]=U(n[1],1,k.version),n[1]=U(n[1],2,1),n[1]=U(n[1],1,k.error_protection?0:1),n[2]=U(n[2],4,G.bitrate_index),n[2]=U(n[2],2,G.samplerate_index),n[2]=U(n[2],1,0),n[2]=U(n[2],1,k.extension),n[3]=U(n[3],2,k.mode.ordinal()),n[3]=U(n[3],2,G.mode_ext),n[3]=U(n[3],1,k.copyright),n[3]=U(n[3],1,k.original),n[3]=U(n[3],2,k.emphasis),n[0]=255;var K=255&(n[1]&241),V;k.version==1?V=h:k.out_samplerate<16000?V=_:V=$,k.VBR==Hn.vbr_off&&(V=k.brate);var q;k.free_format?q=0:q=255&16*t.BitrateIndex(V,k.version,k.out_samplerate),k.version==1?(n[1]=255&(K|10),K=255&(n[2]&13),n[2]=255&(q|K)):(n[1]=255&(K|2),K=255&(n[2]&13),n[2]=255&(q|K))}this.getVbrTag=function(k){var n=new VBRTagData,G=0;n.flags=0;var K=k[G+1]>>3&1,V=k[G+2]>>2&3,q=k[G+3]>>6&3,it=k[G+2]>>4&15;if(it=Tables.bitrate_table[K][it],k[G+1]>>4==14?n.samprate=Tables.samplerate_table[2][V]:n.samprate=Tables.samplerate_table[K][V],K!=0?q!=3?G+=36:G+=21:q!=3?G+=21:G+=13,!Z(k,G))return null;G+=4,n.hId=K;var Q=n.flags=P(k,G);if(G+=4,Q&W&&(n.frames=P(k,G),G+=4),Q&b&&(n.bytes=P(k,G),G+=4),Q&z){if(n.toc!=null)for(var c=0;c<j;c++)n.toc[c]=k[G+c];G+=j}n.vbrScale=-1,Q&X&&(n.vbrScale=P(k,G),G+=4),n.headersize=(K+1)*72000*it/n.samprate,G+=21;var s=k[G+0]<<4;s+=k[G+1]>>4;var o=(k[G+1]&15)<<8;return o+=k[G+2]&255,(s<0||s>3000)&&(s=-1),(o<0||o>3000)&&(o=-1),n.encDelay=s,n.encPadding=o,n},this.InitVbrTag=function(k){var n=k.internal_flags,G;k.version==1?G=h:k.out_samplerate<16000?G=_:G=$,k.VBR==Hn.vbr_off&&(G=k.brate);var K=(k.version+1)*72000*G/k.out_samplerate,V=n.sideinfo_len+w;if(n.VBR_seek_table.TotalFrameSize=K,K<V||K>O){k.bWriteVbrTag=!1;return}n.VBR_seek_table.nVbrNumFrames=0,n.VBR_seek_table.nBytesWritten=0,n.VBR_seek_table.sum=0,n.VBR_seek_table.seen=0,n.VBR_seek_table.want=1,n.VBR_seek_table.pos=0,n.VBR_seek_table.bag==null&&(n.VBR_seek_table.bag=new int[400],n.VBR_seek_table.size=400);var q=fn(O);x(k,q);for(var it=n.VBR_seek_table.TotalFrameSize,Q=0;Q<it;++Q)r.add_dummy_byte(k,q[Q]&255,1)};function F(k,n){var G=n^k;return n=n>>8^D[G&255],n}this.updateMusicCRC=function(k,n,G,K){for(var V=0;V<K;++V)k[0]=F(n[G+V],k[0])};function L(k,n,G,K,V){var q=k.internal_flags,it=0,Q=k.encoder_delay,c=k.encoder_padding,s=100-10*k.VBR_q-k.quality,o=d.getLameVeryShortVersion(),l,f=0,I,ot=[1,5,3,2,4,0,3],y=0|(k.lowpassfreq/100+0.5>255?255:k.lowpassfreq/100+0.5),B=0,dt=0,gt=0,ft=k.internal_flags.noise_shaping,Dt=0,Pt=0,Wt=0,Zt=0,Vt=0,mi=(k.exp_nspsytune&1)!=0,e=(k.exp_nspsytune&2)!=0,p=!1,Ct=!1,Jt=k.internal_flags.nogap_total,Xt=k.internal_flags.nogap_current,yt=k.ATHtype,zt=0,Yt;switch(k.VBR){case vbr_abr:Yt=k.VBR_mean_bitrate_kbps;break;case vbr_off:Yt=k.brate;break;default:Yt=k.VBR_min_bitrate_kbps}switch(k.VBR.ordinal()<ot.length?l=ot[k.VBR.ordinal()]:l=0,I=16*f+l,q.findReplayGain&&(q.RadioGain>510&&(q.RadioGain=510),q.RadioGain<-510&&(q.RadioGain=-510),dt=8192,dt|=3072,q.RadioGain>=0?dt|=q.RadioGain:(dt|=512,dt|=-q.RadioGain)),q.findPeakSample&&(B=Math.abs(0|q.PeakSample/32767*Math.pow(2,23)+0.5)),Jt!=-1&&(Xt>0&&(Ct=!0),Xt<Jt-1&&(p=!0)),zt=yt+((mi?1:0)<<4)+((e?1:0)<<5)+((p?1:0)<<6)+((Ct?1:0)<<7),s<0&&(s=0),k.mode){case MONO:Dt=0;break;case STEREO:Dt=1;break;case DUAL_CHANNEL:Dt=2;break;case JOINT_STEREO:k.force_ms?Dt=4:Dt=3;break;case NOT_SET:default:Dt=7;break}k.in_samplerate<=32000?Wt=0:k.in_samplerate==48000?Wt=2:k.in_samplerate>48000?Wt=3:Wt=1,(k.short_blocks==No.short_block_forced||k.short_blocks==No.short_block_dispensed||k.lowpassfreq==-1&&k.highpassfreq==-1||k.scale_left<k.scale_right||k.scale_left>k.scale_right||k.disable_reservoir&&k.brate<320||k.noATH||k.ATHonly||yt==0||k.in_samplerate<=32000)&&(Pt=1),Zt=ft+(Dt<<2)+(Pt<<5)+(Wt<<6),Vt=q.nMusicCRC,i(G,K+it,s),it+=4;for(var Kt=0;Kt<9;Kt++)G[K+it+Kt]=255&o.charAt(Kt);it+=9,G[K+it]=255&I,it++,G[K+it]=255&y,it++,i(G,K+it,B),it+=4,a(G,K+it,dt),it+=2,a(G,K+it,gt),it+=2,G[K+it]=255&zt,it++,Yt>=255?G[K+it]=255:G[K+it]=255&Yt,it++,G[K+it]=255&Q>>4,G[K+it+1]=255&(Q<<4)+(c>>8),G[K+it+2]=255&c,it+=3,G[K+it]=255&Zt,it++,G[K+it++]=0,a(G,K+it,k.preset),it+=2,i(G,K+it,n),it+=4,a(G,K+it,Vt),it+=2;for(var jt=0;jt<it;jt++)V=F(G[K+jt],V);return a(G,K+it,V),it+=2,it}function at(k){k.seek(0);var n=fn(10);k.readFully(n);var G;return new String(n,"ISO-8859-1").startsWith("ID3")?G=0:G=((n[6]&127)<<21|(n[7]&127)<<14|(n[8]&127)<<7|n[9]&127)+n.length,G}this.getLameTagFrame=function(k,n){var G=k.internal_flags;if(!k.bWriteVbrTag||G.Class_ID!=Lame.LAME_ID||G.VBR_seek_table.pos<=0)return 0;if(n.length<G.VBR_seek_table.TotalFrameSize)return G.VBR_seek_table.TotalFrameSize;ss.fill(n,0,G.VBR_seek_table.TotalFrameSize,0),x(k,n);var K=fn(j);if(k.free_format)for(var V=1;V<j;++V)K[V]=255&255*V/100;else C(G.VBR_seek_table,K);var q=G.sideinfo_len;k.error_protection&&(q-=2),k.VBR==Hn.vbr_off?(n[q++]=255&E.charAt(0),n[q++]=255&E.charAt(1),n[q++]=255&E.charAt(2),n[q++]=255&E.charAt(3)):(n[q++]=255&T.charAt(0),n[q++]=255&T.charAt(1),n[q++]=255&T.charAt(2),n[q++]=255&T.charAt(3)),i(n,q,W+b+z+X),q+=4,i(n,q,G.VBR_seek_table.nVbrNumFrames),q+=4;var it=G.VBR_seek_table.nBytesWritten+G.VBR_seek_table.TotalFrameSize;i(n,q,0|it),q+=4,rs.arraycopy(K,0,n,q,K.length),q+=K.length,k.error_protection&&r.CRC_writeheader(G,n);for(var Q=0,V=0;V<q;V++)Q=F(n[V],Q);return q+=L(k,it,n,q,Q),G.VBR_seek_table.TotalFrameSize},this.putVbrTag=function(k,n){var G=k.internal_flags;if(G.VBR_seek_table.pos<=0||(n.seek(n.length()),n.length()==0))return-1;var K=at(n);n.seek(K);var V=fn(O),q=getLameTagFrame(k,V);return q>V.length?-1:(q<1||n.write(V,0,q),0)}}var hs=hn,we=Ht,So=we.new_byte,cs=we.assert,ls=to(),as=vr,ps=le,gs=ge(),us=Ar,ms=ue(),ws=ns,Cs=ln,fs=An();ei();var Ws=es,Ps=hs;function Ds(){this.setModules=function(t,r){}}function ks(){this.setModules=function(t,r,d){}}function Js(){}function Gs(){this.setModules=function(t,r){}}function Ys(t,r,d){arguments.length!=3&&(console.error("WARN: Mp3Encoder(channels, samplerate, kbps) not specified"),t=1,r=44100,d=128);var W=new ls,b=new Ds,z=new ps,X=new fs,j=new as,O=new gs,A=new us,w=new Ps,h=new Ws,$=new Gs,_=new ws,v=new ms,T=new ks,E=new Js;W.setModules(z,X,j,O,A,w,h,$,E),X.setModules(z,E,h,w),$.setModules(X,h),j.setModules(W),A.setModules(X,_,O,v),O.setModules(v,_,W.enc.psy),_.setModules(X),v.setModules(O),w.setModules(W,X,h),b.setModules(T,E),T.setModules(h,$,j);var D=W.lame_init();D.num_channels=t,D.in_samplerate=r,D.brate=d,D.mode=Cs.STEREO,D.quality=3,D.bWriteVbrTag=!1,D.disable_reservoir=!0,D.write_id3tag_automatic=!1,W.lame_init_params(D);var g=1152,C=0|1.25*g+7200,P=So(C);this.encodeBuffer=function(i,a){t==1&&(a=i),cs(i.length==a.length),i.length>g&&(g=i.length,C=0|1.25*g+7200,P=So(C));var Z=W.lame_encode_buffer(D,i,a,i.length,P,0,C);return new Int8Array(P.subarray(0,Z))},this.flush=function(){var i=W.lame_encode_flush(D,P,0,C);return new Int8Array(P.subarray(0,i))}}function Di(){this.dataOffset=0,this.dataLen=0,this.channels=0,this.sampleRate=0}function kn(t){return t.charCodeAt(0)<<24|t.charCodeAt(1)<<16|t.charCodeAt(2)<<8|t.charCodeAt(3)}Di.RIFF=kn("RIFF");Di.WAVE=kn("WAVE");Di.fmt_=kn("fmt ");Di.data=kn("data");Di.readHeader=function(t){var r=new Di,d=t.getUint32(0,!1);if(Di.RIFF==d&&(t.getUint32(4,!0),Di.WAVE==t.getUint32(8,!1)&&Di.fmt_==t.getUint32(12,!1))){var W=t.getUint32(16,!0),b=20;switch(W){case 16:case 18:r.channels=t.getUint16(b+2,!0),r.sampleRate=t.getUint32(b+4,!0);break;default:throw"extended fmt chunk not implemented"}b+=W;for(var z=Di.data,X=0;z!=d&&(d=t.getUint32(b,!1),X=t.getUint32(b+4,!0),z!=d);)b+=X+8;return r.dataLen=X,r.dataOffset=b+8,r}};var Ce=Eo.Mp3Encoder=Ys,w0=Eo.WavHeader=Di;var zs=32767,Jn=1152;function fe(t,r,d){let W=t.numberOfChannels;if(W!==1&&W!==2)throw new Error("Expecting mono or stereo audioBuffer");if(r=r??128,r<96)W=1;let b=t.length,z=[],X,j,O;for(let w=0;w<W;w++){X=t.getChannelData(w),j=new Int16Array(b);for(let h=0;h<b;++h)O=X[h],O=Math.min(1,Math.max(-1,O)),O=Math.round(O*zs),j[h]=O;z.push(j)}let A=new Ce(W,t.sampleRate,r);return new Promise((w,h)=>{let $=[],_=0,v=()=>{let T;if(_>=b){if(T=A.flush(),T.length>0)$.push(T);let C=new Blob($,{type:"audio/mp3"});return w(C)}let E,D,g=performance.now();try{while(_<b&&performance.now()-g<15){if(W===1)E=z[0].subarray(_,_+Jn),T=A.encodeBuffer(E);else E=z[0].subarray(_,_+Jn),D=z[1].subarray(_,_+Jn),T=A.encodeBuffer(E,D);if(T.length>0)$.push(T);_+=Jn}}catch(C){h(C)}d&&d(_/b),setTimeout(v,16.7)};v()})}var Zs=22050,js=32,$s=22,io=new AudioContext({sampleRate:Zs}),no=(t)=>new Promise(async(r)=>{let d=await fe(t,js),W=new FileReader;W.readAsDataURL(d),W.addEventListener("load",(b)=>r({data:b.target.result.slice($s),type:"audio/mp3",rate:t.sampleRate,sampleCount:t.length}))});function oo(t){return new Promise((r,d)=>{let W=new FileReader;W.readAsArrayBuffer(t),W.addEventListener("load",async()=>{try{let b=await io.decodeAudioData(W.result),z=no(b);r(z)}catch(b){d(b)}})})}async function Qs(t){let d=await(await fetch(t)).arrayBuffer(),W=await io.decodeAudioData(d);return no(W)}async function We(t){let r=await t.arrayBuffer(),d=await io.decodeAudioData(r);return no(d)}import{useCallback as an,useMemo as X0}from"preact/hooks";import{batch as ze}from"@preact/signals";import{nanoid as eo}from"@blockcode/utils";import{useLocalesContext as Us,useProjectContext as qs,translate as Os,setAlert as Ze,delAlert as xs,openAsset as ro,addAsset as je,delAsset as bs}from"@blockcode/core";function Pe(t){let r=Math.floor(t/60),d=Math.floor(t%60);return`${r}:${`00${d}`.slice(-2)}.${t.toFixed(3).slice(-3)}`}import{Text as yi,IconSelector as vs,ActionButton as Vs}from"@blockcode/core";function bi(t){let r=globalThis.document,d=r.createElement("style");d.appendChild(r.createTextNode(t)),r.head.append(d)}bi("._YzM_q_selector-wrapper{background:var(--ui-secondary);width:130px;position:relative}._YzM_q_selector-items-wrapper{width:100%;height:0;min-height:100%;padding-bottom:100px}._YzM_q_selector-item{width:5rem;height:5rem;margin:.5rem auto}._YzM_q_delete-menu-item:hover{background:var(--error-primary)}._YzM_q_add-button-wrapper{background:linear-gradient(transparent,var(--ui-secondary));width:100%;height:100px;display:flex;position:absolute;bottom:0;left:0;right:0}._YzM_q_add-button{margin:.75rem auto}");var vi={selectorItemsWrapper:"_YzM_q_selector-items-wrapper",addButton:"_YzM_q_add-button",addButtonWrapper:"_YzM_q_add-button-wrapper",selectorItem:"_YzM_q_selector-item",deleteMenuItem:"_YzM_q_delete-menu-item",selectorWrapper:"_YzM_q_selector-wrapper"};var De="./assets/icon-thumb-jy4n8115.svg";var ke="./assets/icon-sound-56nbc8vm.svg";var Je="./assets/icon-search-6g8kgvdt.svg";var Bi="./assets/icon-record-k0kczk8k.svg";var Ge="./assets/icon-surprise-d5t4529a.svg";var Ye="./assets/icon-file-upload-0z25chr6.svg";import{jsx as Ji,jsxs as Ts}from"preact/jsx-runtime";function $e({onShowLibrary:t,onSurprise:r,onSoundsFilter:d}){let{translator:W}=Us(),{assets:b,assetId:z}=qs(),X=an(()=>{return b.value.filter((h)=>{if(!/^audio\//.test(h.type))return!1;if(!d)return!0;return d(h)})},[d]),j=an(()=>{let h=document.createElement("input");h.type="file",h.accept=".wav,.mp3",h.multiple=!0,h.click(),h.addEventListener("change",async($)=>{let _=eo();Ze("importing",{id:_});try{for(let v of $.target.files){let T=eo(),E=v.name.slice(0,v.name.lastIndexOf(".")),D=await oo(v);je({...D,id:T,name:E})}}catch(v){Ze({id:_,message:Ji(yi,{id:"sound.error.formatNotSupperted",defaultMessage:"This wav format is not supported."})},2000)}xs(_)})},[]),O=an(()=>{let h=eo();ze(()=>{je({id:h,type:"audio/mp3",name:Os("sound.sound","Sound",W),data:"",rate:22050,sampleCount:0,record:!0}),ro(h)})},[]),A=an((h)=>{let $=X(),_=$[h];ze(()=>{let v=z.value;if(_.id===z.value){if(h===0)v=$[1]?.id;else if(h+1<$.length)v=$[h+1].id;else if(h-1>-1)v=$[h-1].id}bs(_.id),ro(v)})},[]),w=an((h,$)=>{ro($.id)},[]);return Ts("div",{className:vi.selectorWrapper,children:[Ji(vs,{displayOrder:!0,id:"sound-selector",className:vi.selectorItemsWrapper,items:X().map((h,$)=>({...h,details:`${Pe(h.sampleCount/h.rate)||0}`,icon:De,order:$,className:vi.selectorItem,contextMenu:[[{label:Ji(yi,{id:"sound.contextMenu.export",defaultMessage:"export"}),disabled:!0}],[{label:Ji(yi,{id:"sound.contextMenu.delete",defaultMessage:"delete"}),className:vi.deleteMenuItem,onClick:()=>A($)}]]})),selectedId:z.value,onSelect:w,onDelete:A}),Ji("div",{className:vi.addButtonWrapper,children:Ji(Vs,{tooltipPlacement:"right",className:vi.addButton,icon:ke,tooltip:Ji(yi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t,moreButtons:[{icon:Ye,tooltip:Ji(yi,{id:"sound.actionButton.upload",defaultMessage:"Upload Sound"}),onClick:j},{icon:Ge,tooltip:Ji(yi,{id:"sound.actionButton.surprise",defaultMessage:"Surprise"}),onClick:r},{icon:Bi,tooltip:Ji(yi,{id:"sound.actionButton.record",defaultMessage:"Record"}),onClick:O},{icon:Je,tooltip:Ji(yi,{id:"sound.actionButton.sound",defaultMessage:"Choose a Sound"}),onClick:t}]})})]})}import{useRef as ao,useEffect as Ke,useCallback as Xi}from"preact/hooks";import{classNames as Zn}from"@blockcode/utils";import{useLocalesContext as Bs,useProjectContext as Rs,translate as Gi,maybeTranslate as As,setAsset as Ue}from"@blockcode/core";function ri(t,r,d,W){return new(d||(d=Promise))(function(b,z){function X(A){try{O(W.next(A))}catch(w){z(w)}}function j(A){try{O(W.throw(A))}catch(w){z(w)}}function O(A){var w;A.done?b(A.value):(w=A.value,w instanceof d?w:new d(function(h){h(w)})).then(X,j)}O((W=W.apply(t,r||[])).next())})}class tn{constructor(){this.listeners={}}on(t,r,d){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(r),d==null?void 0:d.once){let W=()=>{this.un(t,W),this.un(t,r)};return this.on(t,W),W}return()=>this.un(t,r)}un(t,r){var d;(d=this.listeners[t])===null||d===void 0||d.delete(r)}once(t,r){return this.on(t,r,{once:!0})}unAll(){this.listeners={}}emit(t,...r){this.listeners[t]&&this.listeners[t].forEach((d)=>d(...r))}}var Gn={decode:function(t,r){return ri(this,void 0,void 0,function*(){let d=new AudioContext({sampleRate:r});return d.decodeAudioData(t).finally(()=>d.close())})},createBuffer:function(t,r){return typeof t[0]=="number"&&(t=[t]),function(d){let W=d[0];if(W.some((b)=>b>1||b<-1)){let b=W.length,z=0;for(let X=0;X<b;X++){let j=Math.abs(W[X]);j>z&&(z=j)}for(let X of d)for(let j=0;j<b;j++)X[j]/=z}}(t),{duration:r,length:t[0].length,sampleRate:t[0].length/r,numberOfChannels:t.length,getChannelData:(d)=>t==null?void 0:t[d],copyFromChannel:AudioBuffer.prototype.copyFromChannel,copyToChannel:AudioBuffer.prototype.copyToChannel}}};function Fe(t,r){let d=r.xmlns?document.createElementNS(r.xmlns,t):document.createElement(t);for(let[W,b]of Object.entries(r))if(W==="children")for(let[z,X]of Object.entries(r))typeof X=="string"?d.appendChild(document.createTextNode(X)):d.appendChild(Fe(z,X));else W==="style"?Object.assign(d.style,b):W==="textContent"?d.textContent=b:d.setAttribute(W,b.toString());return d}function Qe(t,r,d){let W=Fe(t,r||{});return d==null||d.appendChild(W),W}var Ns=Object.freeze({__proto__:null,createElement:Qe,default:Qe}),Ss={fetchBlob:function(t,r,d){return ri(this,void 0,void 0,function*(){let W=yield fetch(t,d);if(W.status>=400)throw new Error(`Failed to fetch ${t}: ${W.status} (${W.statusText})`);return function(b,z){ri(this,void 0,void 0,function*(){if(!b.body||!b.headers)return;let X=b.body.getReader(),j=Number(b.headers.get("Content-Length"))||0,O=0,A=(h)=>ri(this,void 0,void 0,function*(){O+=(h==null?void 0:h.length)||0;let $=Math.round(O/j*100);z($)}),w=()=>ri(this,void 0,void 0,function*(){let h;try{h=yield X.read()}catch($){return}h.done||(A(h.value),yield w())});w()})}(W.clone(),r),W.blob()})}};class ye extends tn{constructor(t){super(),this.isExternalMedia=!1,t.media?(this.media=t.media,this.isExternalMedia=!0):this.media=document.createElement("audio"),t.mediaControls&&(this.media.controls=!0),t.autoplay&&(this.media.autoplay=!0),t.playbackRate!=null&&this.onMediaEvent("canplay",()=>{t.playbackRate!=null&&(this.media.playbackRate=t.playbackRate)},{once:!0})}onMediaEvent(t,r,d){return this.media.addEventListener(t,r,d),()=>this.media.removeEventListener(t,r,d)}getSrc(){return this.media.currentSrc||this.media.src||""}revokeSrc(){let t=this.getSrc();t.startsWith("blob:")&&URL.revokeObjectURL(t)}canPlayType(t){return this.media.canPlayType(t)!==""}setSrc(t,r){let d=this.getSrc();if(t&&d===t)return;this.revokeSrc();let W=r instanceof Blob&&(this.canPlayType(r.type)||!t)?URL.createObjectURL(r):t;d&&(this.media.src="");try{this.media.src=W}catch(b){this.media.src=t}}destroy(){this.isExternalMedia||(this.media.pause(),this.media.remove(),this.revokeSrc(),this.media.src="",this.media.load())}setMediaElement(t){this.media=t}play(){return ri(this,void 0,void 0,function*(){return this.media.play()})}pause(){this.media.pause()}isPlaying(){return!this.media.paused&&!this.media.ended}setTime(t){this.media.currentTime=t}getDuration(){return this.media.duration}getCurrentTime(){return this.media.currentTime}getVolume(){return this.media.volume}setVolume(t){this.media.volume=t}getMuted(){return this.media.muted}setMuted(t){this.media.muted=t}getPlaybackRate(){return this.media.playbackRate}isSeeking(){return this.media.seeking}setPlaybackRate(t,r){r!=null&&(this.media.preservesPitch=r),this.media.playbackRate=t}getMediaElement(){return this.media}setSinkId(t){return this.media.setSinkId(t)}}class Ri extends tn{constructor(t,r){super(),this.timeouts=[],this.isScrollable=!1,this.audioData=null,this.resizeObserver=null,this.lastContainerWidth=0,this.isDragging=!1,this.subscriptions=[],this.unsubscribeOnScroll=[],this.subscriptions=[],this.options=t;let d=this.parentFromOptionsContainer(t.container);this.parent=d;let[W,b]=this.initHtml();d.appendChild(W),this.container=W,this.scrollContainer=b.querySelector(".scroll"),this.wrapper=b.querySelector(".wrapper"),this.canvasWrapper=b.querySelector(".canvases"),this.progressWrapper=b.querySelector(".progress"),this.cursor=b.querySelector(".cursor"),r&&b.appendChild(r),this.initEvents()}parentFromOptionsContainer(t){let r;if(typeof t=="string"?r=document.querySelector(t):t instanceof HTMLElement&&(r=t),!r)throw new Error("Container not found");return r}initEvents(){let t=(r)=>{let d=this.wrapper.getBoundingClientRect(),W=r.clientX-d.left,b=r.clientY-d.top;return[W/d.width,b/d.height]};if(this.wrapper.addEventListener("click",(r)=>{let[d,W]=t(r);this.emit("click",d,W)}),this.wrapper.addEventListener("dblclick",(r)=>{let[d,W]=t(r);this.emit("dblclick",d,W)}),this.options.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.scrollContainer.addEventListener("scroll",()=>{let{scrollLeft:r,scrollWidth:d,clientWidth:W}=this.scrollContainer,b=r/d,z=(r+W)/d;this.emit("scroll",b,z,r,r+W)}),typeof ResizeObserver=="function"){let r=this.createDelay(100);this.resizeObserver=new ResizeObserver(()=>{r().then(()=>this.onContainerResize()).catch(()=>{})}),this.resizeObserver.observe(this.scrollContainer)}}onContainerResize(){let t=this.parent.clientWidth;t===this.lastContainerWidth&&this.options.height!=="auto"||(this.lastContainerWidth=t,this.reRender())}initDrag(){this.subscriptions.push(function(t,r,d,W,b=3,z=0,X=100){if(!t)return()=>{};let j=matchMedia("(pointer: coarse)").matches,O=()=>{},A=(w)=>{if(w.button!==z)return;w.preventDefault(),w.stopPropagation();let{clientX:h,clientY:$}=w,_=!1,v=Date.now(),T=(P)=>{if(P.preventDefault(),P.stopPropagation(),j&&Date.now()-v<X)return;let{clientX:i,clientY:a}=P,Z=i-h,U=a-$;if(_||Math.abs(Z)>b||Math.abs(U)>b){let x=t.getBoundingClientRect(),{left:F,top:L}=x;_||(d==null||d(h-F,$-L),_=!0),r(Z,U,i-F,a-L),h=i,$=a}},E=(P)=>{if(_){let{clientX:i,clientY:a}=P,Z=t.getBoundingClientRect(),{left:U,top:x}=Z;W==null||W(i-U,a-x)}O()},D=(P)=>{P.relatedTarget&&P.relatedTarget!==document.documentElement||E(P)},g=(P)=>{_&&(P.stopPropagation(),P.preventDefault())},C=(P)=>{_&&P.preventDefault()};document.addEventListener("pointermove",T),document.addEventListener("pointerup",E),document.addEventListener("pointerout",D),document.addEventListener("pointercancel",D),document.addEventListener("touchmove",C,{passive:!1}),document.addEventListener("click",g,{capture:!0}),O=()=>{document.removeEventListener("pointermove",T),document.removeEventListener("pointerup",E),document.removeEventListener("pointerout",D),document.removeEventListener("pointercancel",D),document.removeEventListener("touchmove",C),setTimeout(()=>{document.removeEventListener("click",g,{capture:!0})},10)}};return t.addEventListener("pointerdown",A),()=>{O(),t.removeEventListener("pointerdown",A)}}(this.wrapper,(t,r,d)=>{this.emit("drag",Math.max(0,Math.min(1,d/this.wrapper.getBoundingClientRect().width)))},(t)=>{this.isDragging=!0,this.emit("dragstart",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))},(t)=>{this.isDragging=!1,this.emit("dragend",Math.max(0,Math.min(1,t/this.wrapper.getBoundingClientRect().width)))}))}getHeight(t,r){var d;let W=((d=this.audioData)===null||d===void 0?void 0:d.numberOfChannels)||1;if(t==null)return 128;if(!isNaN(Number(t)))return Number(t);if(t==="auto"){let b=this.parent.clientHeight||128;return(r==null?void 0:r.every((z)=>!z.overlay))?b/W:b}return 128}initHtml(){let t=document.createElement("div"),r=t.attachShadow({mode:"open"}),d=this.options.cspNonce&&typeof this.options.cspNonce=="string"?this.options.cspNonce.replace(/"/g,""):"";return r.innerHTML=`
      <style${d?` nonce="${d}"`:""}>
        :host {
          user-select: none;
          min-width: 1px;
        }
        :host audio {
          display: block;
          width: 100%;
        }
        :host .scroll {
          overflow-x: auto;
          overflow-y: hidden;
          width: 100%;
          position: relative;
        }
        :host .noScrollbar {
          scrollbar-color: transparent;
          scrollbar-width: none;
        }
        :host .noScrollbar::-webkit-scrollbar {
          display: none;
          -webkit-appearance: none;
        }
        :host .wrapper {
          position: relative;
          overflow: visible;
          z-index: 2;
        }
        :host .canvases {
          min-height: ${this.getHeight(this.options.height,this.options.splitChannels)}px;
        }
        :host .canvases > div {
          position: relative;
        }
        :host canvas {
          display: block;
          position: absolute;
          top: 0;
          image-rendering: pixelated;
        }
        :host .progress {
          pointer-events: none;
          position: absolute;
          z-index: 2;
          top: 0;
          left: 0;
          width: 0;
          height: 100%;
          overflow: hidden;
        }
        :host .progress > div {
          position: relative;
        }
        :host .cursor {
          pointer-events: none;
          position: absolute;
          z-index: 5;
          top: 0;
          left: 0;
          height: 100%;
          border-radius: 2px;
        }
      </style>

      <div class="scroll" part="scroll">
        <div class="wrapper" part="wrapper">
          <div class="canvases" part="canvases"></div>
          <div class="progress" part="progress"></div>
          <div class="cursor" part="cursor"></div>
        </div>
      </div>
    `,[t,r]}setOptions(t){if(this.options.container!==t.container){let r=this.parentFromOptionsContainer(t.container);r.appendChild(this.container),this.parent=r}t.dragToSeek!==!0&&typeof this.options.dragToSeek!="object"||this.initDrag(),this.options=t,this.reRender()}getWrapper(){return this.wrapper}getWidth(){return this.scrollContainer.clientWidth}getScroll(){return this.scrollContainer.scrollLeft}setScroll(t){this.scrollContainer.scrollLeft=t}setScrollPercentage(t){let{scrollWidth:r}=this.scrollContainer,d=r*t;this.setScroll(d)}destroy(){var t,r;this.subscriptions.forEach((d)=>d()),this.container.remove(),(t=this.resizeObserver)===null||t===void 0||t.disconnect(),(r=this.unsubscribeOnScroll)===null||r===void 0||r.forEach((d)=>d()),this.unsubscribeOnScroll=[]}createDelay(t=10){let r,d,W=()=>{r&&clearTimeout(r),d&&d()};return this.timeouts.push(W),()=>new Promise((b,z)=>{W(),d=z,r=setTimeout(()=>{r=void 0,d=void 0,b()},t)})}convertColorValues(t){if(!Array.isArray(t))return t||"";if(t.length<2)return t[0]||"";let r=document.createElement("canvas"),d=r.getContext("2d"),W=r.height*(window.devicePixelRatio||1),b=d.createLinearGradient(0,0,0,W),z=1/(t.length-1);return t.forEach((X,j)=>{let O=j*z;b.addColorStop(O,X)}),b}getPixelRatio(){return Math.max(1,window.devicePixelRatio||1)}renderBarWaveform(t,r,d,W){let b=t[0],z=t[1]||t[0],X=b.length,{width:j,height:O}=d.canvas,A=O/2,w=this.getPixelRatio(),h=r.barWidth?r.barWidth*w:1,$=r.barGap?r.barGap*w:r.barWidth?h/2:0,_=r.barRadius||0,v=j/(h+$)/X,T=_&&"roundRect"in d?"roundRect":"rect";d.beginPath();let E=0,D=0,g=0;for(let C=0;C<=X;C++){let P=Math.round(C*v);if(P>E){let Z=Math.round(D*A*W),U=Z+Math.round(g*A*W)||1,x=A-Z;r.barAlign==="top"?x=0:r.barAlign==="bottom"&&(x=O-U),d[T](E*(h+$),x,h,U,_),E=P,D=0,g=0}let i=Math.abs(b[C]||0),a=Math.abs(z[C]||0);i>D&&(D=i),a>g&&(g=a)}d.fill(),d.closePath()}renderLineWaveform(t,r,d,W){let b=(z)=>{let X=t[z]||t[0],j=X.length,{height:O}=d.canvas,A=O/2,w=d.canvas.width/j;d.moveTo(0,A);let h=0,$=0;for(let _=0;_<=j;_++){let v=Math.round(_*w);if(v>h){let E=A+(Math.round($*A*W)||1)*(z===0?-1:1);d.lineTo(h,E),h=v,$=0}let T=Math.abs(X[_]||0);T>$&&($=T)}d.lineTo(h,A)};d.beginPath(),b(0),b(1),d.fill(),d.closePath()}renderWaveform(t,r,d){if(d.fillStyle=this.convertColorValues(r.waveColor),r.renderFunction)return void r.renderFunction(t,d);let W=r.barHeight||1;if(r.normalize){let b=Array.from(t[0]).reduce((z,X)=>Math.max(z,Math.abs(X)),0);W=b?1/b:1}r.barWidth||r.barGap||r.barAlign?this.renderBarWaveform(t,r,d,W):this.renderLineWaveform(t,r,d,W)}renderSingleCanvas(t,r,d,W,b,z,X){let j=this.getPixelRatio(),O=document.createElement("canvas");O.width=Math.round(d*j),O.height=Math.round(W*j),O.style.width=`${d}px`,O.style.height=`${W}px`,O.style.left=`${Math.round(b)}px`,z.appendChild(O);let A=O.getContext("2d");if(this.renderWaveform(t,r,A),O.width>0&&O.height>0){let w=O.cloneNode(),h=w.getContext("2d");h.drawImage(O,0,0),h.globalCompositeOperation="source-in",h.fillStyle=this.convertColorValues(r.progressColor),h.fillRect(0,0,O.width,O.height),X.appendChild(w)}}renderMultiCanvas(t,r,d,W,b,z){let X=this.getPixelRatio(),{clientWidth:j}=this.scrollContainer,O=d/X,A=Math.min(Ri.MAX_CANVAS_WIDTH,j,O),w={};if(A===0)return;if(r.barWidth||r.barGap){let T=r.barWidth||0.5,E=T+(r.barGap||T/2);A%E!=0&&(A=Math.floor(A/E)*E)}let h=(T)=>{if(T<0||T>=$)return;if(w[T])return;w[T]=!0;let E=T*A,D=Math.min(O-E,A);if(D<=0)return;let g=t.map((C)=>{let P=Math.floor(E/O*C.length),i=Math.floor((E+D)/O*C.length);return C.slice(P,i)});this.renderSingleCanvas(g,r,D,W,E,b,z)},$=Math.ceil(O/A);if(!this.isScrollable){for(let T=0;T<$;T++)h(T);return}let _=this.scrollContainer.scrollLeft/O,v=Math.floor(_*$);if(h(v-1),h(v),h(v+1),$>1){let T=this.on("scroll",()=>{let{scrollLeft:E}=this.scrollContainer,D=Math.floor(E/O*$);Object.keys(w).length>Ri.MAX_NODES&&(b.innerHTML="",z.innerHTML="",w={}),h(D-1),h(D),h(D+1)});this.unsubscribeOnScroll.push(T)}}renderChannel(t,r,d,W){var{overlay:b}=r,z=function(A,w){var h={};for(var $ in A)Object.prototype.hasOwnProperty.call(A,$)&&w.indexOf($)<0&&(h[$]=A[$]);if(A!=null&&typeof Object.getOwnPropertySymbols=="function"){var _=0;for($=Object.getOwnPropertySymbols(A);_<$.length;_++)w.indexOf($[_])<0&&Object.prototype.propertyIsEnumerable.call(A,$[_])&&(h[$[_]]=A[$[_]])}return h}(r,["overlay"]);let X=document.createElement("div"),j=this.getHeight(z.height,z.splitChannels);X.style.height=`${j}px`,b&&W>0&&(X.style.marginTop=`-${j}px`),this.canvasWrapper.style.minHeight=`${j}px`,this.canvasWrapper.appendChild(X);let O=X.cloneNode();this.progressWrapper.appendChild(O),this.renderMultiCanvas(t,z,d,j,X,O)}render(t){return ri(this,void 0,void 0,function*(){var r;this.timeouts.forEach((j)=>j()),this.timeouts=[],this.canvasWrapper.innerHTML="",this.progressWrapper.innerHTML="",this.options.width!=null&&(this.scrollContainer.style.width=typeof this.options.width=="number"?`${this.options.width}px`:this.options.width);let d=this.getPixelRatio(),W=this.scrollContainer.clientWidth,b=Math.ceil(t.duration*(this.options.minPxPerSec||0));this.isScrollable=b>W;let z=this.options.fillParent&&!this.isScrollable,X=(z?W:b)*d;if(this.wrapper.style.width=z?"100%":`${b}px`,this.scrollContainer.style.overflowX=this.isScrollable?"auto":"hidden",this.scrollContainer.classList.toggle("noScrollbar",!!this.options.hideScrollbar),this.cursor.style.backgroundColor=`${this.options.cursorColor||this.options.progressColor}`,this.cursor.style.width=`${this.options.cursorWidth}px`,this.audioData=t,this.emit("render"),this.options.splitChannels)for(let j=0;j<t.numberOfChannels;j++){let O=Object.assign(Object.assign({},this.options),(r=this.options.splitChannels)===null||r===void 0?void 0:r[j]);this.renderChannel([t.getChannelData(j)],O,X,j)}else{let j=[t.getChannelData(0)];t.numberOfChannels>1&&j.push(t.getChannelData(1)),this.renderChannel(j,this.options,X,0)}Promise.resolve().then(()=>this.emit("rendered"))})}reRender(){if(this.unsubscribeOnScroll.forEach((d)=>d()),this.unsubscribeOnScroll=[],!this.audioData)return;let{scrollWidth:t}=this.scrollContainer,{right:r}=this.progressWrapper.getBoundingClientRect();if(this.render(this.audioData),this.isScrollable&&t!==this.scrollContainer.scrollWidth){let{right:d}=this.progressWrapper.getBoundingClientRect(),W=d-r;W*=2,W=W<0?Math.floor(W):Math.ceil(W),W/=2,this.scrollContainer.scrollLeft+=W}}zoom(t){this.options.minPxPerSec=t,this.reRender()}scrollIntoView(t,r=!1){let{scrollLeft:d,scrollWidth:W,clientWidth:b}=this.scrollContainer,z=t*W,X=d,j=d+b,O=b/2;if(this.isDragging)z+30>j?this.scrollContainer.scrollLeft+=30:z-30<X&&(this.scrollContainer.scrollLeft-=30);else{(z<X||z>j)&&(this.scrollContainer.scrollLeft=z-(this.options.autoCenter?O:0));let A=z-d-O;r&&this.options.autoCenter&&A>0&&(this.scrollContainer.scrollLeft+=Math.min(A,10))}{let A=this.scrollContainer.scrollLeft,w=A/W,h=(A+b)/W;this.emit("scroll",w,h,A,A+b)}}renderProgress(t,r){if(isNaN(t))return;let d=100*t;this.canvasWrapper.style.clipPath=`polygon(${d}% 0, 100% 0, 100% 100%, ${d}% 100%)`,this.progressWrapper.style.width=`${d}%`,this.cursor.style.left=`${d}%`,this.cursor.style.transform=`translateX(-${Math.round(d)===100?this.options.cursorWidth:0}px)`,this.isScrollable&&this.options.autoScroll&&this.scrollIntoView(t,r)}exportImage(t,r,d){return ri(this,void 0,void 0,function*(){let W=this.canvasWrapper.querySelectorAll("canvas");if(!W.length)throw new Error("No waveform data");if(d==="dataURL"){let b=Array.from(W).map((z)=>z.toDataURL(t,r));return Promise.resolve(b)}return Promise.all(Array.from(W).map((b)=>new Promise((z,X)=>{b.toBlob((j)=>{j?z(j):X(new Error("Could not export image"))},t,r)})))})}}Ri.MAX_CANVAS_WIDTH=8000,Ri.MAX_NODES=10;class Xe extends tn{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}class so extends tn{constructor(t=new AudioContext){super(),this.bufferNode=null,this.playStartTime=0,this.playedDuration=0,this._muted=!1,this._playbackRate=1,this._duration=void 0,this.buffer=null,this.currentSrc="",this.paused=!0,this.crossOrigin=null,this.seeking=!1,this.autoplay=!1,this.addEventListener=this.on,this.removeEventListener=this.un,this.audioContext=t,this.gainNode=this.audioContext.createGain(),this.gainNode.connect(this.audioContext.destination)}load(){return ri(this,void 0,void 0,function*(){})}get src(){return this.currentSrc}set src(t){if(this.currentSrc=t,this._duration=void 0,!t)return this.buffer=null,void this.emit("emptied");fetch(t).then((r)=>{if(r.status>=400)throw new Error(`Failed to fetch ${t}: ${r.status} (${r.statusText})`);return r.arrayBuffer()}).then((r)=>this.currentSrc!==t?null:this.audioContext.decodeAudioData(r)).then((r)=>{this.currentSrc===t&&(this.buffer=r,this.emit("loadedmetadata"),this.emit("canplay"),this.autoplay&&this.play())})}_play(){var t;if(!this.paused)return;this.paused=!1,(t=this.bufferNode)===null||t===void 0||t.disconnect(),this.bufferNode=this.audioContext.createBufferSource(),this.buffer&&(this.bufferNode.buffer=this.buffer),this.bufferNode.playbackRate.value=this._playbackRate,this.bufferNode.connect(this.gainNode);let r=this.playedDuration*this._playbackRate;r>=this.duration&&(r=0,this.playedDuration=0),this.bufferNode.start(this.audioContext.currentTime,r),this.playStartTime=this.audioContext.currentTime,this.bufferNode.onended=()=>{this.currentTime>=this.duration&&(this.pause(),this.emit("ended"))}}_pause(){var t;this.paused=!0,(t=this.bufferNode)===null||t===void 0||t.stop(),this.playedDuration+=this.audioContext.currentTime-this.playStartTime}play(){return ri(this,void 0,void 0,function*(){this.paused&&(this._play(),this.emit("play"))})}pause(){this.paused||(this._pause(),this.emit("pause"))}stopAt(t){var r,d;let W=t-this.currentTime;(r=this.bufferNode)===null||r===void 0||r.stop(this.audioContext.currentTime+W),(d=this.bufferNode)===null||d===void 0||d.addEventListener("ended",()=>{this.bufferNode=null,this.pause()},{once:!0})}setSinkId(t){return ri(this,void 0,void 0,function*(){return this.audioContext.setSinkId(t)})}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this.bufferNode&&(this.bufferNode.playbackRate.value=t)}get currentTime(){return(this.paused?this.playedDuration:this.playedDuration+(this.audioContext.currentTime-this.playStartTime))*this._playbackRate}set currentTime(t){let r=!this.paused;r&&this._pause(),this.playedDuration=t/this._playbackRate,r&&this._play(),this.emit("seeking"),this.emit("timeupdate")}get duration(){var t,r;return(t=this._duration)!==null&&t!==void 0?t:((r=this.buffer)===null||r===void 0?void 0:r.duration)||0}set duration(t){this._duration=t}get volume(){return this.gainNode.gain.value}set volume(t){this.gainNode.gain.value=t,this.emit("volumechange")}get muted(){return this._muted}set muted(t){this._muted!==t&&(this._muted=t,this._muted?this.gainNode.disconnect():this.gainNode.connect(this.audioContext.destination))}canPlayType(t){return/^(audio|video)\//.test(t)}getGainNode(){return this.gainNode}getChannelData(){let t=[];if(!this.buffer)return t;let r=this.buffer.numberOfChannels;for(let d=0;d<r;d++)t.push(this.buffer.getChannelData(d));return t}}var Es={waveColor:"#999",progressColor:"#555",cursorWidth:1,minPxPerSec:0,fillParent:!0,interact:!0,dragToSeek:!1,autoScroll:!0,autoCenter:!0,sampleRate:8000};class Ai extends ye{static create(t){return new Ai(t)}constructor(t){let r=t.media||(t.backend==="WebAudio"?new so:void 0);super({media:r,mediaControls:t.mediaControls,autoplay:t.autoplay,playbackRate:t.audioRate}),this.plugins=[],this.decodedData=null,this.subscriptions=[],this.mediaSubscriptions=[],this.abortController=null,this.options=Object.assign({},Es,t),this.timer=new Xe;let d=r?void 0:this.getMediaElement();this.renderer=new Ri(this.options,d),this.initPlayerEvents(),this.initRendererEvents(),this.initTimerEvents(),this.initPlugins();let W=this.options.url||this.getSrc()||"";Promise.resolve().then(()=>{this.emit("init");let{peaks:b,duration:z}=this.options;(W||b&&z)&&this.load(W,b,z).catch(()=>null)})}updateProgress(t=this.getCurrentTime()){return this.renderer.renderProgress(t/this.getDuration(),this.isPlaying()),t}initTimerEvents(){this.subscriptions.push(this.timer.on("tick",()=>{if(!this.isSeeking()){let t=this.updateProgress();this.emit("timeupdate",t),this.emit("audioprocess",t)}}))}initPlayerEvents(){this.isPlaying()&&(this.emit("play"),this.timer.start()),this.mediaSubscriptions.push(this.onMediaEvent("timeupdate",()=>{let t=this.updateProgress();this.emit("timeupdate",t)}),this.onMediaEvent("play",()=>{this.emit("play"),this.timer.start()}),this.onMediaEvent("pause",()=>{this.emit("pause"),this.timer.stop()}),this.onMediaEvent("emptied",()=>{this.timer.stop()}),this.onMediaEvent("ended",()=>{this.emit("timeupdate",this.getDuration()),this.emit("finish")}),this.onMediaEvent("seeking",()=>{this.emit("seeking",this.getCurrentTime())}),this.onMediaEvent("error",(t)=>{var r;this.emit("error",(r=this.getMediaElement().error)!==null&&r!==void 0?r:new Error("Media error"))}))}initRendererEvents(){this.subscriptions.push(this.renderer.on("click",(t,r)=>{this.options.interact&&(this.seekTo(t),this.emit("interaction",t*this.getDuration()),this.emit("click",t,r))}),this.renderer.on("dblclick",(t,r)=>{this.emit("dblclick",t,r)}),this.renderer.on("scroll",(t,r,d,W)=>{let b=this.getDuration();this.emit("scroll",t*b,r*b,d,W)}),this.renderer.on("render",()=>{this.emit("redraw")}),this.renderer.on("rendered",()=>{this.emit("redrawcomplete")}),this.renderer.on("dragstart",(t)=>{this.emit("dragstart",t)}),this.renderer.on("dragend",(t)=>{this.emit("dragend",t)}));{let t;this.subscriptions.push(this.renderer.on("drag",(r)=>{if(!this.options.interact)return;let d;this.renderer.renderProgress(r),clearTimeout(t),this.isPlaying()?d=0:this.options.dragToSeek===!0?d=200:typeof this.options.dragToSeek=="object"&&this.options.dragToSeek!==void 0&&(d=this.options.dragToSeek.debounceTime),t=setTimeout(()=>{this.seekTo(r)},d),this.emit("interaction",r*this.getDuration()),this.emit("drag",r)}))}}initPlugins(){var t;((t=this.options.plugins)===null||t===void 0?void 0:t.length)&&this.options.plugins.forEach((r)=>{this.registerPlugin(r)})}unsubscribePlayerEvents(){this.mediaSubscriptions.forEach((t)=>t()),this.mediaSubscriptions=[]}setOptions(t){this.options=Object.assign({},this.options,t),t.duration&&!t.peaks&&(this.decodedData=Gn.createBuffer(this.exportPeaks(),t.duration)),t.peaks&&t.duration&&(this.decodedData=Gn.createBuffer(t.peaks,t.duration)),this.renderer.setOptions(this.options),t.audioRate&&this.setPlaybackRate(t.audioRate),t.mediaControls!=null&&(this.getMediaElement().controls=t.mediaControls)}registerPlugin(t){return t._init(this),this.plugins.push(t),this.subscriptions.push(t.once("destroy",()=>{this.plugins=this.plugins.filter((r)=>r!==t)})),t}getWrapper(){return this.renderer.getWrapper()}getWidth(){return this.renderer.getWidth()}getScroll(){return this.renderer.getScroll()}setScroll(t){return this.renderer.setScroll(t)}setScrollTime(t){let r=t/this.getDuration();this.renderer.setScrollPercentage(r)}getActivePlugins(){return this.plugins}loadAudio(t,r,d,W){return ri(this,void 0,void 0,function*(){var b;if(this.emit("load",t),!this.options.media&&this.isPlaying()&&this.pause(),this.decodedData=null,!r&&!d){let X=this.options.fetchParams||{};window.AbortController&&!X.signal&&(this.abortController=new AbortController,X.signal=(b=this.abortController)===null||b===void 0?void 0:b.signal);let j=(A)=>this.emit("loading",A);r=yield Ss.fetchBlob(t,j,X);let O=this.options.blobMimeType;O&&(r=new Blob([r],{type:O}))}this.setSrc(t,r);let z=yield new Promise((X)=>{let j=W||this.getDuration();j?X(j):this.mediaSubscriptions.push(this.onMediaEvent("loadedmetadata",()=>X(this.getDuration()),{once:!0}))});if(!t&&!r){let X=this.getMediaElement();X instanceof so&&(X.duration=z)}if(d)this.decodedData=Gn.createBuffer(d,z||0);else if(r){let X=yield r.arrayBuffer();this.decodedData=yield Gn.decode(X,this.options.sampleRate)}this.decodedData&&(this.emit("decode",this.getDuration()),this.renderer.render(this.decodedData)),this.emit("ready",this.getDuration())})}load(t,r,d){return ri(this,void 0,void 0,function*(){try{return yield this.loadAudio(t,void 0,r,d)}catch(W){throw this.emit("error",W),W}})}loadBlob(t,r,d){return ri(this,void 0,void 0,function*(){try{return yield this.loadAudio("",t,r,d)}catch(W){throw this.emit("error",W),W}})}zoom(t){if(!this.decodedData)throw new Error("No audio loaded");this.renderer.zoom(t),this.emit("zoom",t)}getDecodedData(){return this.decodedData}exportPeaks({channels:t=2,maxLength:r=8000,precision:d=1e4}={}){if(!this.decodedData)throw new Error("The audio has not been decoded yet");let W=Math.min(t,this.decodedData.numberOfChannels),b=[];for(let z=0;z<W;z++){let X=this.decodedData.getChannelData(z),j=[],O=X.length/r;for(let A=0;A<r;A++){let w=X.slice(Math.floor(A*O),Math.ceil((A+1)*O)),h=0;for(let $=0;$<w.length;$++){let _=w[$];Math.abs(_)>Math.abs(h)&&(h=_)}j.push(Math.round(h*d)/d)}b.push(j)}return b}getDuration(){let t=super.getDuration()||0;return t!==0&&t!==1/0||!this.decodedData||(t=this.decodedData.duration),t}toggleInteraction(t){this.options.interact=t}setTime(t){super.setTime(t),this.updateProgress(t),this.emit("timeupdate",t)}seekTo(t){let r=this.getDuration()*t;this.setTime(r)}playPause(){return ri(this,void 0,void 0,function*(){return this.isPlaying()?this.pause():this.play()})}stop(){this.pause(),this.setTime(0)}skip(t){this.setTime(this.getCurrentTime()+t)}empty(){this.load("",[[0]],0.001)}setMediaElement(t){this.unsubscribePlayerEvents(),super.setMediaElement(t),this.initPlayerEvents()}exportImage(){return ri(this,arguments,void 0,function*(t="image/png",r=1,d="dataURL"){return this.renderer.exportImage(t,r,d)})}destroy(){var t;this.emit("destroy"),(t=this.abortController)===null||t===void 0||t.abort(),this.plugins.forEach((r)=>r.destroy()),this.subscriptions.forEach((r)=>r()),this.unsubscribePlayerEvents(),this.timer.destroy(),this.renderer.destroy(),super.destroy()}}Ai.BasePlugin=class extends tn{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t())}},Ai.dom=Ns;function ho(t,r,d,W){return new(d||(d=Promise))(function(b,z){function X(A){try{O(W.next(A))}catch(w){z(w)}}function j(A){try{O(W.throw(A))}catch(w){z(w)}}function O(A){var w;A.done?b(A.value):(w=A.value,w instanceof d?w:new d(function(h){h(w)})).then(X,j)}O((W=W.apply(t,r||[])).next())})}class co{constructor(){this.listeners={}}on(t,r,d){if(this.listeners[t]||(this.listeners[t]=new Set),this.listeners[t].add(r),d==null?void 0:d.once){let W=()=>{this.un(t,W),this.un(t,r)};return this.on(t,W),W}return()=>this.un(t,r)}un(t,r){var d;(d=this.listeners[t])===null||d===void 0||d.delete(r)}once(t,r){return this.on(t,r,{once:!0})}unAll(){this.listeners={}}emit(t,...r){this.listeners[t]&&this.listeners[t].forEach((d)=>d(...r))}}class Me extends co{constructor(t){super(),this.subscriptions=[],this.options=t}onInit(){}_init(t){this.wavesurfer=t,this.onInit()}destroy(){this.emit("destroy"),this.subscriptions.forEach((t)=>t())}}class Le extends co{constructor(){super(...arguments),this.unsubscribe=()=>{}}start(){this.unsubscribe=this.on("tick",()=>{requestAnimationFrame(()=>{this.emit("tick")})}),this.emit("tick")}stop(){this.unsubscribe()}destroy(){this.unsubscribe()}}var Hs=["audio/webm","audio/wav","audio/mpeg","audio/mp4","audio/mp3"];class Yn extends Me{constructor(t){var r,d,W,b,z,X;super(Object.assign(Object.assign({},t),{audioBitsPerSecond:(r=t.audioBitsPerSecond)!==null&&r!==void 0?r:128000,scrollingWaveform:(d=t.scrollingWaveform)!==null&&d!==void 0&&d,scrollingWaveformWindow:(W=t.scrollingWaveformWindow)!==null&&W!==void 0?W:5,continuousWaveform:(b=t.continuousWaveform)!==null&&b!==void 0&&b,renderRecordedAudio:(z=t.renderRecordedAudio)===null||z===void 0||z,mediaRecorderTimeslice:(X=t.mediaRecorderTimeslice)!==null&&X!==void 0?X:void 0})),this.stream=null,this.mediaRecorder=null,this.dataWindow=null,this.isWaveformPaused=!1,this.lastStartTime=0,this.lastDuration=0,this.duration=0,this.timer=new Le,this.subscriptions.push(this.timer.on("tick",()=>{let j=performance.now()-this.lastStartTime;this.duration=this.isPaused()?this.duration:this.lastDuration+j,this.emit("record-progress",this.duration)}))}static create(t){return new Yn(t||{})}renderMicStream(t){var r;let d=new AudioContext,W=d.createMediaStreamSource(t),b=d.createAnalyser();W.connect(b),this.options.continuousWaveform&&(b.fftSize=32);let z=b.frequencyBinCount,X=new Float32Array(z),j=0;this.wavesurfer&&((r=this.originalOptions)!==null&&r!==void 0||(this.originalOptions=Object.assign({},this.wavesurfer.options)),this.wavesurfer.options.interact=!1,this.options.scrollingWaveform&&(this.wavesurfer.options.cursorWidth=0));let O=setInterval(()=>{var A,w,h,$;if(!this.isWaveformPaused){if(b.getFloatTimeDomainData(X),this.options.scrollingWaveform){let _=Math.floor((this.options.scrollingWaveformWindow||0)*d.sampleRate),v=Math.min(_,this.dataWindow?this.dataWindow.length+z:z),T=new Float32Array(_);if(this.dataWindow){let E=Math.max(0,_-this.dataWindow.length);T.set(this.dataWindow.slice(-v+z),E)}T.set(X,_-z),this.dataWindow=T}else if(this.options.continuousWaveform){if(!this.dataWindow){let v=this.options.continuousWaveformDuration?Math.round(100*this.options.continuousWaveformDuration):((w=(A=this.wavesurfer)===null||A===void 0?void 0:A.getWidth())!==null&&w!==void 0?w:0)*window.devicePixelRatio;this.dataWindow=new Float32Array(v)}let _=0;for(let v=0;v<z;v++){let T=Math.abs(X[v]);T>_&&(_=T)}if(j+1>this.dataWindow.length){let v=new Float32Array(2*this.dataWindow.length);v.set(this.dataWindow,0),this.dataWindow=v}this.dataWindow[j]=_,j++}else this.dataWindow=X;if(this.wavesurfer){let _=(($=(h=this.dataWindow)===null||h===void 0?void 0:h.length)!==null&&$!==void 0?$:0)/100;this.wavesurfer.load("",[this.dataWindow],this.options.scrollingWaveform?this.options.scrollingWaveformWindow:_).then(()=>{this.wavesurfer&&this.options.continuousWaveform&&(this.wavesurfer.setTime(this.getDuration()/1000),this.wavesurfer.options.minPxPerSec||this.wavesurfer.setOptions({minPxPerSec:this.wavesurfer.getWidth()/this.wavesurfer.getDuration()}))}).catch((v)=>{console.error("Error rendering real-time recording data:",v)})}}},10);return{onDestroy:()=>{clearInterval(O),W==null||W.disconnect(),d==null||d.close()},onEnd:()=>{this.isWaveformPaused=!0,clearInterval(O),this.stopMic()}}}startMic(t){return ho(this,void 0,void 0,function*(){let r;try{r=yield navigator.mediaDevices.getUserMedia({audio:!(t==null?void 0:t.deviceId)||{deviceId:t.deviceId}})}catch(b){throw new Error("Error accessing the microphone: "+b.message)}let{onDestroy:d,onEnd:W}=this.renderMicStream(r);return this.subscriptions.push(this.once("destroy",d)),this.subscriptions.push(this.once("record-end",W)),this.stream=r,r})}stopMic(){this.stream&&(this.stream.getTracks().forEach((t)=>t.stop()),this.stream=null,this.mediaRecorder=null)}startRecording(t){return ho(this,void 0,void 0,function*(){let r=this.stream||(yield this.startMic(t));this.dataWindow=null;let d=this.mediaRecorder||new MediaRecorder(r,{mimeType:this.options.mimeType||Hs.find((z)=>MediaRecorder.isTypeSupported(z)),audioBitsPerSecond:this.options.audioBitsPerSecond});this.mediaRecorder=d,this.stopRecording();let W=[];d.ondataavailable=(z)=>{z.data.size>0&&W.push(z.data),this.emit("record-data-available",z.data)};let b=(z)=>{var X;let j=new Blob(W,{type:d.mimeType});this.emit(z,j),this.options.renderRecordedAudio&&(this.applyOriginalOptionsIfNeeded(),(X=this.wavesurfer)===null||X===void 0||X.load(URL.createObjectURL(j)))};d.onpause=()=>b("record-pause"),d.onstop=()=>b("record-end"),d.start(this.options.mediaRecorderTimeslice),this.lastStartTime=performance.now(),this.lastDuration=0,this.duration=0,this.isWaveformPaused=!1,this.timer.start(),this.emit("record-start")})}getDuration(){return this.duration}isRecording(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="recording"}isPaused(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)==="paused"}isActive(){var t;return((t=this.mediaRecorder)===null||t===void 0?void 0:t.state)!=="inactive"}stopRecording(){var t;this.isActive()&&((t=this.mediaRecorder)===null||t===void 0||t.stop(),this.timer.stop())}pauseRecording(){var t,r;this.isRecording()&&(this.isWaveformPaused=!0,(t=this.mediaRecorder)===null||t===void 0||t.requestData(),(r=this.mediaRecorder)===null||r===void 0||r.pause(),this.timer.stop(),this.lastDuration=this.duration)}resumeRecording(){var t;this.isPaused()&&(this.isWaveformPaused=!1,(t=this.mediaRecorder)===null||t===void 0||t.resume(),this.timer.start(),this.lastStartTime=performance.now(),this.emit("record-resume"))}static getAvailableAudioDevices(){return ho(this,void 0,void 0,function*(){return navigator.mediaDevices.enumerateDevices().then((t)=>t.filter((r)=>r.kind==="audioinput"))})}destroy(){this.applyOriginalOptionsIfNeeded(),super.destroy(),this.stopRecording(),this.stopMic()}applyOriginalOptionsIfNeeded(){this.wavesurfer&&this.originalOptions&&(this.wavesurfer.setOptions(this.originalOptions),delete this.originalOptions)}}import{Label as t0,BufferedInput as i0,Button as qe}from"@blockcode/core";bi("._32PlYG_wave-wrapper{padding:calc(var(--space)*1.5);border-left:1px solid var(--ui-black-transparent);color:var(--text-primary);flex-direction:column;flex:1;display:flex}._32PlYG_wave-wrapper._32PlYG_disabled{opacity:.5;pointer-events:none}._32PlYG_row{min-height:3rem;margin-bottom:.5rem;display:flex}._32PlYG_row-fill{padding-top:calc(var(--space)*2.5);border-top:1px dashed var(--ui-black-transparent);flex-direction:row;flex:1}._32PlYG_row-right{margin-right:var(--space);justify-content:right}._32PlYG_row:last-child{min-height:unset;margin-bottom:0}._32PlYG_group{margin-right:calc(var(--space)*1.5);flex-direction:row;align-items:center;display:inline-flex}._32PlYG_dashed-border{border-right:1px dashed var(--ui-black-transparent);padding-right:var(--space)}._32PlYG_name-input{width:8rem}._32PlYG_large-input{width:4rem}._32PlYG_tool-icon{margin-right:var(--space);width:2rem;height:2rem}._32PlYG_label-image{vertical-align:middle;margin-right:calc(var(--space)/2)}._32PlYG_button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem}._32PlYG_button-icon{width:100%;height:100%;margin:auto}._32PlYG_group-button{border-left:none;border-radius:0}._32PlYG_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._32PlYG_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._32PlYG_group-button-toggled-off{filter:saturate(0)}._32PlYG_label-button{border:0;font-weight:400}._32PlYG_label-button._32PlYG_selected{background:var(--theme-primary);color:var(--ui-white)}._32PlYG_label-button._32PlYG_selected ._32PlYG_button-icon{filter:brightness(0)invert()}._32PlYG_play-button,._32PlYG_record-button{cursor:pointer;width:3rem;height:3rem;margin:0 var(--space);border:0;border-radius:100%;padding:.75rem}._32PlYG_play-button{background:var(--theme-primary)}._32PlYG_record-button{background:var(--error-primary)}._32PlYG_wave-box-wrapper{margin:20px var(--space);border:1px solid var(--ui-black-transparent);border-radius:calc(var(--space)*.8);background:hsl(from var(--blocks-sounds-primary)h s l/.15);flex:1;min-height:160px;position:relative;overflow:hidden}._32PlYG_wave-box-wrapper._32PlYG_hidden>div{visibility:hidden}");var It={buttonIcon:"_32PlYG_button-icon",dashedBorder:"_32PlYG_dashed-border",disabled:"_32PlYG_disabled",recordButton:"_32PlYG_record-button",rowRight:"_32PlYG_row-right",hidden:"_32PlYG_hidden",labelImage:"_32PlYG_label-image",rowFill:"_32PlYG_row-fill",groupButtonToggledOff:"_32PlYG_group-button-toggled-off",waveWrapper:"_32PlYG_wave-wrapper",largeInput:"_32PlYG_large-input",groupButton:"_32PlYG_group-button",playButton:"_32PlYG_play-button",waveBoxWrapper:"_32PlYG_wave-box-wrapper",row:"_32PlYG_row",groupButtonLast:"_32PlYG_group-button-last",labelButton:"_32PlYG_label-button",nameInput:"_32PlYG_name-input",toolIcon:"_32PlYG_tool-icon",selected:"_32PlYG_selected",group:"_32PlYG_group",button:"_32PlYG_button",groupButtonFirst:"_32PlYG_group-button-first"};var zn="./assets/icon-play-mnpftarf.svg";var lo="./assets/icon-stop-547qvw0a.svg";import{jsx as Zi,jsxs as xe}from"preact/jsx-runtime";var n0=Yn.create(),Oe;function be(){let t=ao(),r=ao(),d=ao(),{translator:W}=Bs(),{asset:b}=Rs(),z=b.value,X=!z||!/^audio\//.test(z.type);Ke(()=>{if(!t.ws)return;if(t.ws.isPlaying())t.ws.stop();if(t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})}),t.ws.empty(),z?.sampleCount>0)t.ws.load(`data:${z.type};base64,${z.data}`);if(t.record.sound=z,r.current)r.current.src=zn,r.current.title=Gi("sound.play","Play",W);if(d.current)d.current.src=Bi,d.current.title=Gi("sound.record","Record",W)},[z,X]);let j=Xi((T,E)=>{Ue({[T]:E})},[]),O=Xi(()=>{if(t.ws){if(t.ws.isPlaying())t.ws.stop();else if(z.sampleCount>0)t.ws.play()}if(d.current)setTimeout(()=>{let T=d.current.parentElement.parentElement;if(T.disabled=t.ws.isPlaying(),t.ws.isPlaying())T.classList.add(It.groupButtonToggledOff);else T.classList.remove(It.groupButtonToggledOff)})},[z]),A=Xi(()=>{if(r.current)r.current.src=lo,r.current.title=Gi("sound.stop","Stop",W);if(t.ws)t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1});if(d.current){let T=d.current.parentElement.parentElement;T.disabled=!1,T.classList.remove(It.groupButtonToggledOff)}},[]),w=Xi(()=>{if(r.current){if(r.current.src=zn,r.current.title=Gi("sound.play","Play",W),t.ws)t.ws.setTime(0),setTimeout(()=>{t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0})})}if(d.current){d.current.src=Bi,d.current.title=Gi("sound.record","Record",W);let T=d.current.parentElement.parentElement;T.disabled=!1,T.classList.remove(It.groupButtonToggledOff)}},[]),h=Xi(()=>{if(t.ws&&!t.record.isRecording())t.ws.setOptions({cursorColor:"hsla(215, 100%, 65%, 1)",cursorWidth:1})},[]),$=Xi(()=>{if(d.current)d.current.src=lo,d.current.title=Gi("sound.stop","Stop",W);if(r.current){let T=r.current.parentElement.parentElement;T.disabled=!0,T.classList.add(It.groupButtonToggledOff)}},[]),_=Xi(()=>{if(t.record)if(t.record.isRecording())t.record.stopRecording(),t.record.stopMic(),clearTimeout(Oe);else t.record.startRecording(),Oe=setTimeout(_,1e4)},[]),v=Xi(async(T)=>{let E=await We(T);if(Ue(E),r.current){let D=r.current.parentElement.parentElement;D.disabled=!1,D.classList.remove(It.groupButtonToggledOff)}},[]);return Ke(()=>{if(t.current){if(t.ws=Ai.create({container:t.current,dragToSeek:!0,height:"auto",waveColor:"hsla(300, 48%, 50%, 1)",progressColor:"hsla(300, 48%, 50%, 0.8)",cursorColor:"hsla(215, 100%, 65%, 0)",cursorWidth:0}),t.record=t.ws.registerPlugin(n0),t.record.on("record-start",$),t.record.on("record-end",v),t.ws.on("play",A),t.ws.on("pause",w),t.ws.on("finish",w),t.ws.on("seeking",h),z?.sampleCount>0)t.ws.empty(),t.ws.load(`data:${z.type};base64,${z.data}`);t.record.sound=z}return()=>{if(t.ws)t.ws.destroy()}},[t]),xe("div",{className:Zn(It.waveWrapper,{[It.disabled]:X}),children:[Zi("div",{className:It.row,children:Zi("div",{className:It.group,children:Zi(t0,{text:Gi("sound.sound","Sound"),children:Zi(i0,{disabled:X,className:It.nameInput,placeholder:Gi("sound.name","name"),onSubmit:(T)=>j("name",T),value:X||!z?Gi("sound.sound","Sound"):As(z.name)})})})}),Zi("div",{className:It.row,children:Zi("div",{ref:t,className:Zn(It.waveBoxWrapper,{[It.hidden]:X})})}),xe("div",{className:It.row,children:[Zi(qe,{className:Zn(It.button,It.playButton,{[It.groupButtonToggledOff]:X}),onClick:O,children:Zi("img",{ref:r,src:zn,className:It.buttonIcon,title:Gi("sound.play","Play")})}),z?.record&&Zi(qe,{className:Zn(It.button,It.recordButton,{[It.groupButtonToggledOff]:X}),onClick:_,children:Zi("img",{ref:d,src:Bi,className:It.buttonIcon,title:Gi("sound.record","Record")})})]})]})}bi(".cPknva_wave-editor-wrapper{background:var(--ui-white);border-radius:inherit;flex-grow:1;display:flex}");var ve={waveEditorWrapper:"cPknva_wave-editor-wrapper"};import{jsx as Ve,jsxs as e0}from"preact/jsx-runtime";function o0({onShowLibrary:t,onSurprise:r,onSoundsFilter:d}){return e0("div",{className:ve.waveEditorWrapper,children:[Ve($e,{onShowLibrary:t,onSurprise:r,onSoundsFilter:d}),Ve(be,{})]})}import{Text as s0}from"@blockcode/core";var Te="./assets/icon-sound-ajkz0had.svg";import{jsx as h0}from"preact/jsx-runtime";var d0={icon:Te,label:h0(s0,{id:"sound.sound",defaultMessage:"Sound"})};export{d0 as soundTab,Qs as loadSoundFromURL,oo as loadSoundFromFile,o0 as SoundEditor};
