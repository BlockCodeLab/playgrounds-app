import{addLocalesMessages as ro}from"@blockcode/core";var fc={"tankwar.player.greenFlag":"Fight","tankwar.player.stopAll":"Stop","tankwar.stage.small":"Switch to small stage","tankwar.stage.large":"Switch to large stage","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health","tankwar.blocks.event_damage":"damage"};var ic={"tankwar.player.greenFlag":"开战","tankwar.player.stopAll":"停战","tankwar.stage.small":"缩小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"昵称","tankwar.stageInfo.enemies":"敌方数量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"红","tankwar.stageInfo.enemy.yellow":"黄","tankwar.stageInfo.enemy.green":"绿","tankwar.stageInfo.mode.local":"本机 AI","tankwar.stageInfo.mode.remote":"联网玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"简单","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高级","tankwar.blocks.motion_attack":"面向 %1 方向距离 %2 步发射炮弹","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前进","tankwar.blocks.motion_setspeed":"将速度设为 %1 %","tankwar.blocks.motion_stop":"停止前进","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"将雷达扫描宽度设为 %1","tankwar.blocks.sensing_scan":"雷达扫描 %1 方向有敌人？","tankwar.blocks.sensing_distance":"雷达测量 %1 方向敌人的距离","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"伤害"};var bc={"tankwar.player.greenFlag":"開戰","tankwar.player.stopAll":"停戰","tankwar.stage.small":"縮小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"暱稱","tankwar.stageInfo.enemies":"敵方數量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"紅","tankwar.stageInfo.enemy.yellow":"黃","tankwar.stageInfo.enemy.green":"綠","tankwar.stageInfo.mode.local":"本機 AI","tankwar.stageInfo.mode.remote":"聯網玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"簡單","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高級","tankwar.blocks.motion_attack":"面向 %1 方向距離 %2 步發射炮彈","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前進","tankwar.blocks.motion_setspeed":"將速度設為 %1 %","tankwar.blocks.motion_stop":"停止前進","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"將雷達掃描寬度設為 %1","tankwar.blocks.sensing_scan":"雷達掃描 %1 方向有敵人？","tankwar.blocks.sensing_distance":"雷達測量 %1 方向敵人的距離","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"傷害"};ro({en:fc,"zh-Hans":ic,"zh-Hant":bc});import{html2canvas as $s}from"@blockcode/utils";import{ScratchBlocks as n,blocksTab as Ms,codeReviewTab as Da}from"@blockcode/blocks";import{CodeReview as fa}from"@blockcode/blocks";import{BlocksEditor as po}from"@blockcode/blocks";import{translate as J,themeColors as z}from"@blockcode/core";import{ScratchBlocks as h}from"@blockcode/blocks";var _c=()=>({id:"motion",name:"%{BKY_CATEGORY_MOTION}",themeColor:z.blocks.motion.primary,inputColor:z.blocks.motion.secondary,otherColor:z.blocks.motion.tertiary,order:0,blocks:[{id:"attack",text:J("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),inputs:{DIRECTION:{type:"angle",defaultValue:90},DISTANCE:{shadow:"distancevalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",s=this.valueToCode(c,"DISTANCE",this.ORDER_NONE)||"100";return`await tankUtils.attack(target, signal, ${o}, ${s});
`}},{id:"move",text:J("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),inputs:{DIRECTION:{type:"angle",defaultValue:90},SPEED:{shadow:"speedvalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",s=this.valueToCode(c,"SPEED",this.ORDER_NONE)||"100";return`await tankUtils.move(target, signal, ${o}, ${s});
`}},"---",{id:"turnright",text:h.Msg.MOTION_TURNRIGHT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-right.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnRight(target, signal, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"turnleft",text:h.Msg.MOTION_TURNLEFT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-left.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnLeft(target, signal, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"pointindirection",text:h.Msg.MOTION_POINTINDIRECTION,inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return`await tankUtils.setDirection(target, signal, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0"});
`}},"---",{id:"setspeed",text:J("tankwar.blocks.motion_setspeed","set speed to %1 %"),inputs:{SPEED:{shadow:"speedvalue",defaultValue:50}},emu(c){return`tankUtils.setSpeed(target, ${this.valueToCode(c,"SPEED",this.ORDER_NONE)||"0"});
`}},{id:"stop",text:J("tankwar.blocks.motion_stop","stop"),emu(c){return`tankUtils.stop(target);
`}},"---",{id:"speed",text:J("tankwar.blocks.motion_speed","speed"),output:"number",monitoring:!0,emu(c){return["tankUtils.getSpeed(target)",this.ORDER_FUNCTION_CALL]}},{id:"xposition",text:h.Msg.MOTION_XPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.x())",this.ORDER_FUNCTION_CALL]}},{id:"yposition",text:h.Msg.MOTION_YPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.y())",this.ORDER_FUNCTION_CALL]}},{id:"direction",text:h.Msg.MOTION_DIRECTION,output:"number",monitoring:!0,emu(c){return["tankUtils.getDirection(target)",this.ORDER_FUNCTION_CALL]}},{id:"distancevalue",inline:!0,output:"number",inputs:{DISTANCE:{type:"slider",min:50,max:200}},emu(c){return[c.getFieldValue("DISTANCE")||0,this.ORDER_NONE]}},{id:"speedvalue",inline:!0,output:"number",inputs:{SPEED:{type:"slider",min:-100,max:100}},emu(c){return[c.getFieldValue("SPEED")||0,this.ORDER_NONE]}}]});import{translate as mo,themeColors as S}from"@blockcode/core";import{ScratchBlocks as C}from"@blockcode/blocks";var rc=()=>({id:"event",name:"%{BKY_CATEGORY_EVENTS}",themeColor:S.blocks.events.primary,inputColor:S.blocks.events.secondary,otherColor:S.blocks.events.tertiary,blocks:[{id:"whenflagclicked",text:C.Msg.EVENT_WHENFLAGCLICKED,hat:!0,inputs:{FLAG:{type:"image",src:"./assets/blocks-media/green-flag.svg"}}},"---",{id:"whengreaterthan",text:C.Msg.EVENT_WHENGREATERTHAN,hat:!0,inputs:{WHENGREATERTHANMENU:{type:"string",menu:[[C.Msg.EVENT_WHENGREATERTHAN_TIMER,"TIMER"],[mo("tankwar.blocks.event_damage","damage"),"DAMAGE"]]},VALUE:{type:"number",defaultValue:10}}}]});import{translate as A,themeColors as G}from"@blockcode/core";import{ScratchBlocks as mc}from"@blockcode/blocks";var Nc=()=>({id:"sensing",name:"%{BKY_CATEGORY_SENSING}",themeColor:G.blocks.sensing.primary,inputColor:G.blocks.sensing.secondary,otherColor:G.blocks.sensing.tertiary,blocks:[{id:"scan",text:A("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),output:"boolean",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}) !== Infinity)`,this.ORDER_EQUALITY]}},{id:"scandistance",text:A("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),output:"number",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}))`,this.ORDER_FUNCTION_CALL]}},"---",{id:"scanwidth",text:A("tankwar.blocks.sensing_scanwidth","set scan width to %1"),inputs:{WIDTH:{type:"number",defaultValue:5}},emu(c){return`target.setAttr('scanWidth', ${this.valueToCode(c,"WIDTH",this.ORDER_NONE)||5});
`}},"---",{id:"health",text:A("tankwar.blocks.sensing_health","health"),output:"number",monitoring:!0,emu(c){return["target.getAttr('health')",this.ORDER_FUNCTION_CALL]}},"---",{id:"timer",text:mc.Msg.SENSING_TIMER,output:"number",monitoring:!0,emu(c){return["runtime.times",this.ORDER_MEMBER]}},{id:"resettimer",text:mc.Msg.SENSING_RESETTIMER,emu(c){return`runtime.resetTimes()
`}}]});import{EmulatorGenerator as No}from"@blockcode/blocks";class T extends No{}function pc(){let c=_c(),o=rc(),s=Nc();return[c,o,s]}import{jsx as qo}from"preact/jsx-runtime";var uo=new T;function uc(){return qo(po,{enableMonitor:!0,disableExtensionButton:!0,emulator:uo,onBuildinExtensions:pc})}import{useEffect as Xs}from"preact/hooks";import{translate as V,setAppState as Qs}from"@blockcode/core";import{classNames as qs}from"@blockcode/utils";import{useAppContext as ds}from"@blockcode/core";import{useCallback as Gc,useEffect as cc}from"preact/hooks";import{useSignal as ks}from"@preact/signals";import{Konva as Rs}from"@blockcode/utils";import{useAppContext as ws,useProjectContext as Ds,setAppState as Is}from"@blockcode/core";import{Emulator as fs}from"@blockcode/blocks";import{sleepMs as u1,MathUtils as Co}from"@blockcode/utils";import{Runtime as Go}from"@blockcode/blocks";var U=Symbol.for,g=Symbol("kCapture"),gc=U("events.errorMonitor"),Fo=Symbol("events.maxEventTargetListeners"),go=Symbol("events.maxEventTargetListenersWarned"),qc=U("nodejs.rejection"),xo=U("nodejs.rejection"),dc=Array.prototype.slice,x=10,q=function(o){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[g]=o?.captureRejections?Boolean(o?.captureRejections):f[g])this.emit=Yo},f=q.prototype={};f._events=void 0;f._eventsCount=0;f._maxListeners=void 0;f.setMaxListeners=function(o){return e(o,"setMaxListeners",0),this._maxListeners=o,this};f.constructor=q;f.getMaxListeners=function(){return this?._maxListeners??x};function xc(c,o){var{_events:s}=c;if(o[0]??=Error("Unhandled error."),!s)throw o[0];var a=s[gc];if(a)for(var l of dc.call(a))l.apply(c,o);var k=s.error;if(!k)throw o[0];for(var l of dc.call(k))l.apply(c,o);return!0}function Eo(c,o,s,a){o.then(void 0,function(l){queueMicrotask(()=>ho(c,l,s,a))})}function ho(c,o,s,a){if(typeof c[qc]==="function")c[qc](o,s,...a);else try{c[g]=!1,c.emit("error",o)}finally{c[g]=!0}}var vo=function(o,...s){if(o==="error")return xc(this,s);var{_events:a}=this;if(a===void 0)return!1;var l=a[o];if(l===void 0)return!1;let k=l.length>1?l.slice():l;for(let Z=0,{length:w}=k;Z<w;Z++){let R=k[Z];switch(s.length){case 0:R.call(this);break;case 1:R.call(this,s[0]);break;case 2:R.call(this,s[0],s[1]);break;case 3:R.call(this,s[0],s[1],s[2]);break;default:R.apply(this,s);break}}return!0},Yo=function(o,...s){if(o==="error")return xc(this,s);var{_events:a}=this;if(a===void 0)return!1;var l=a[o];if(l===void 0)return!1;let k=l.length>1?l.slice():l;for(let Z=0,{length:w}=k;Z<w;Z++){let R=k[Z],D;switch(s.length){case 0:D=R.call(this);break;case 1:D=R.call(this,s[0]);break;case 2:D=R.call(this,s[0],s[1]);break;case 3:D=R.call(this,s[0],s[1],s[2]);break;default:D=R.apply(this,s);break}if(D!==void 0&&typeof D?.then==="function"&&D.then===Promise.prototype.then)Eo(this,D,o,s)}return!0};f.emit=vo;f.addListener=function(o,s){X(s);var a=this._events;if(!a)a=this._events={__proto__:null},this._eventsCount=0;else if(a.newListener)this.emit("newListener",o,s.listener??s);var l=a[o];if(!l)a[o]=[s],this._eventsCount++;else{l.push(s);var k=this._maxListeners??x;if(k>0&&l.length>k&&!l.warned)Ec(this,o,l)}return this};f.on=f.addListener;f.prependListener=function(o,s){X(s);var a=this._events;if(!a)a=this._events={__proto__:null},this._eventsCount=0;else if(a.newListener)this.emit("newListener",o,s.listener??s);var l=a[o];if(!l)a[o]=[s],this._eventsCount++;else{l.unshift(s);var k=this._maxListeners??x;if(k>0&&l.length>k&&!l.warned)Ec(this,o,l)}return this};function Ec(c,o,s){s.warned=!0;let a=Error(`Possible EventEmitter memory leak detected. ${s.length} ${String(o)} listeners added to [${c.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);a.name="MaxListenersExceededWarning",a.emitter=c,a.type=o,a.count=s.length,console.warn(a)}function hc(c,o,...s){this.removeListener(c,o),o.apply(this,s)}f.once=function(o,s){X(s);let a=hc.bind(this,o,s);return a.listener=s,this.addListener(o,a),this};f.prependOnceListener=function(o,s){X(s);let a=hc.bind(this,o,s);return a.listener=s,this.prependListener(o,a),this};f.removeListener=function(o,s){X(s);var{_events:a}=this;if(!a)return this;var l=a[o];if(!l)return this;var k=l.length;let Z=-1;for(let w=k-1;w>=0;w--)if(l[w]===s||l[w].listener===s){Z=w;break}if(Z<0)return this;if(Z===0)l.shift();else l.splice(Z,1);if(l.length===0)delete a[o],this._eventsCount--;return this};f.off=f.removeListener;f.removeAllListeners=function(o){var{_events:s}=this;if(o&&s){if(s[o])delete s[o],this._eventsCount--}else this._events={__proto__:null};return this};f.listeners=function(o){var{_events:s}=this;if(!s)return[];var a=s[o];if(!a)return[];return a.map((l)=>l.listener??l)};f.rawListeners=function(o){var{_events:s}=this;if(!s)return[];var a=s[o];if(!a)return[];return a.slice()};f.listenerCount=function(o){var{_events:s}=this;if(!s)return 0;return s[o]?.length??0};f.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};f[g]=!1;function Jo(c,o,s){var a=s?.signal;if(vc(a,"options.signal"),a?.aborted)throw new j(void 0,{cause:a?.reason});let{resolve:l,reject:k,promise:Z}=$newPromiseCapability(Promise),w=(I)=>{if(c.removeListener(o,R),a!=null)$(a,"abort",D);k(I)},R=(...I)=>{if(typeof c.removeListener==="function")c.removeListener("error",w);if(a!=null)$(a,"abort",D);l(I)};if(Fc(c,o,R,{once:!0}),o!=="error"&&typeof c.once==="function")c.once("error",w);function D(){$(c,o,R),$(c,"error",w),k(new j(void 0,{cause:a?.reason}))}if(a!=null)Fc(a,"abort",D,{once:!0});return Z}function Xo(c,o){return c.listeners(o)}function Qo(c,...o){e(c,"setMaxListeners",0);var s;if(o&&(s=o.length))for(let a=0;a<s;a++)o[a].setMaxListeners(c);else x=c}function Wo(c,o){return c.listenerCount(o)}function $(c,o,s,a){if(typeof c.removeListener==="function")c.removeListener(o,s);else c.removeEventListener(o,s,a)}function Fc(c,o,s,a){if(typeof c.on==="function")if(a.once)c.once(o,s);else c.on(o,s);else c.addEventListener(o,s,a)}class j extends Error{constructor(c="The operation was aborted",o=void 0){if(o!==void 0&&typeof o!=="object")throw v("options","Object",o);super(c,o);this.code="ABORT_ERR",this.name="AbortError"}}function v(c,o,s){let a=TypeError(`The "${c}" argument must be of type ${o}. Received ${s}`);return a.code="ERR_INVALID_ARG_TYPE",a}function Ao(c,o,s){let a=RangeError(`The "${c}" argument is out of range. It must be ${o}. Received ${s}`);return a.code="ERR_OUT_OF_RANGE",a}function vc(c,o){if(c!==void 0&&(c===null||typeof c!=="object"||!("aborted"in c)))throw v(o,"AbortSignal",c)}function e(c,o,s,a){if(typeof c!=="number")throw v(o,"number",c);if(s!=null&&c<s||a!=null&&c>a||(s!=null||a!=null)&&Number.isNaN(c))throw Ao(o,`${s!=null?`>= ${s}`:""}${s!=null&&a!=null?" && ":""}${a!=null?`<= ${a}`:""}`,c)}function X(c){if(typeof c!=="function")throw TypeError("The listener must be a function")}function To(c,o){if(typeof c!=="boolean")throw v(o,"boolean",c)}function $o(c){return c?._maxListeners??x}function Mo(c,o){if(c===void 0)throw v("signal","AbortSignal",c);if(vc(c,"signal"),typeof o!=="function")throw v("listener","function",o);let s;if(c.aborted)queueMicrotask(()=>o());else c.addEventListener("abort",o,{__proto__:null,once:!0}),s=()=>{c.removeEventListener("abort",o)};return{__proto__:null,[Symbol.dispose](){s?.()}}}Object.defineProperties(q,{captureRejections:{get(){return f[g]},set(c){To(c,"EventEmitter.captureRejections"),f[g]=c},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return x},set:(c)=>{e(c,"defaultMaxListeners",0),x=c}},kMaxEventTargetListeners:{value:Fo,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:go,enumerable:!1,configurable:!1,writable:!1}});Object.assign(q,{once:Jo,getEventListeners:Xo,getMaxListeners:$o,setMaxListeners:Qo,EventEmitter:q,usingDomains:!1,captureRejectionSymbol:xo,errorMonitor:gc,addAbortListener:Mo,init:q,listenerCount:Wo});import{sleep as Xc,MathUtils as i,Konva as Y,KonvaUtils as yo}from"@blockcode/utils";var Yc="./assets/bullet-82yt94q7.png";var Jc="./assets/boom-0p27yacb.png";var Bo=2,Qc=0.013888888888888888,Vo=1000,no=50,to=200,Wc=20,Ko=200,zo=2,So=30,Ac=400;class P extends q{constructor(c){super();this._runtime=c,this._speedRatio=Bo*c.fps,this._bulletSpeed=Ko/c.fps,this._bulletImage=new Image,this._bulletImage.src=Yc,this._boomImage=new Image,this._boomImage.src=Jc}get runtime(){return this._runtime}get running(){return this.runtime.running}get stage(){return this.runtime.stage}get backdropLayer(){return this.runtime.backdropLayer}get paintLayer(){return this.runtime.paintLayer}get spritesLayer(){return this.runtime.spritesLayer}get boardLayer(){return this.runtime.boardLayer}get tanks(){return this.runtime.tanks}_findNearestEdge(c){let o=c.getClientRect(),s=this.stage.width(),a=this.stage.height(),l=o.x,k=o.y,Z=s-(o.x+o.width),w=a-(o.y+o.height),R,D=1/0;if(l<D)D=l,R="left";if(k<D)D=k,R="top";if(Z<D)D=Z,R="right";if(w<D)D=w,R="bottom";if(D>0)return;return R}drive(c,o){if(!this.running)return;if(!c.visible())return;let s=c.getAttr("tank"),a=c.getAttr("turret");if(c.getAttr("health")<=0){c.getAttr("broken").visible(!0),s.visible(!1),a.visible(!1);return}if(!c.getAttr("cooldown")&&!a.getAttr("tween")&&s.rotation()!==a.rotation())this._turn(a,o,s.rotation());if(this._findNearestEdge(s))this.setSpeed(c,0);this.spritesLayer.children.some((F)=>{if(F===c||!F.visible())return;if(yo.checkConvexHullsCollision(c,F))this.setSpeed(c,0)});let k=c.getAttr("speed");if(!k)return;let Z=c.getAttr("tank").rotation(),w=i.degToRad(Z-90),R=-k*Math.cos(w),D=-k*Math.sin(w),I=c.x()+R,b=c.y()+D;c.position({x:I,y:b}),this.runtime.setMonitorValueById(`${c.id()}.motion_xposition`,Math.round(I)),this.runtime.setMonitorValueById(`${c.id()}.motion_yposition`,Math.round(b))}move(c,o,s,a){if(!this.running)return;if(!c.visible())return;if(c.getAttr("health")<=0)return;return this.setSpeed(c,a),this.setDirection(c,o,s)}_turn(c,o,s){if(!this.running)return;if(!c.visible())return;if(c.getAttr("tween"))return;let a=Math.abs(s-c.rotation());if(a>180)a=360-a,s=c.rotation()+a;return new Promise((l)=>{let k=()=>{let w=c.getAttr("tween");if(w)c.setAttr("tween",null),w.reset(),w.destroy();o.off("abort",k),l()};o.once("abort",k);let Z=new Y.Tween({node:c,rotation:s,duration:Qc*Math.abs(s-c.rotation()),easing:Y.Easings.Linear,onFinish:()=>{let w=c.getAttr("tween");if(w)c.setAttr("tween",null),w.destroy();o.off("abort",k),l()},onUpdate:()=>{let w=c.getAttr("tankUnit");if(c.hasName("tank"))this.runtime.setMonitorValueById(`${w.id()}.motion_direction`,this.getDirection(w))}});c.setAttr("tween",Z),Z.play()})}setDirection(c,o,s){if(!this.running)return;if(!c.visible())return;if(c.getAttr("health")<=0)return;let a=-i.toNumber(s);return this._turn(c.getAttr("tank"),o,a)}getDirection(c){return Math.round(i.wrapClamp(-c.getAttr("tank").rotation(),-179,180))}turnRight(c,o,s){if(!this.running)return;if(!c.visible())return;if(c.getAttr("health")<=0)return;let a=i.toNumber(s),l=-c.getAttr("tank").rotation()+a;return this.setDirection(c,o,l)}turnLeft(c,o,s){let a=i.toNumber(s);return this.turnRight(c,o,-a)}setSpeed(c,o){if(!this.running)return;if(!c.visible())return;if(c.getAttr("health")<=0)return;let s=i.toNumber(o);c.setAttr("speed",s/this._speedRatio),this.runtime.setMonitorValueById(`${c.id()}.motion_speed`,Math.round(s))}getSpeed(c){let o=c.getAttr("speed");return Math.round(o*this._speedRatio)}stop(c){this.setSpeed(c,0)}_hit(c,o){if(!this.running)return;if(!c.visible())return;if(c===o.getAttr("tankUnit"))return;let s=c.getAttr("tank"),a=c.position(),l=o.position(),k=i.distanceTo(a,l),Z=Math.min(s.width(),s.height())*s.scaleX();if(k<Z/2){let w=c.getAttr("health")-10;c.setAttr("health",w);return}if(k<Z/1.414215){let w=c.getAttr("health")-5;c.setAttr("health",w);return}}_boom(c){if(!this.running)return;let o=new Y.Sprite({x:c.x(),y:c.y(),name:"boom",image:this._boomImage,scale:c.scale(),rotation:c.rotation(),offsetX:this._boomImage.width/4/2,offsetY:this._boomImage.height/2,animation:"ready",animations:{boom:[80,0,80,80,160,0,80,80,240,0,80,80],ready:[0,0,80,80]},frameRate:6,frameIndex:0});this.boardLayer.add(o),o.start(),o.animation("boom"),o.on("frameIndexChange.button",()=>{if(o.frameIndex()===2)setTimeout(()=>{o.off(".button"),o.destroy()},1000/o.frameRate())}),c.visible(!1),this._hit(this.tanks.player,c),this._hit(this.tanks.red,c),this._hit(this.tanks.yellow,c),this._hit(this.tanks.green,c),c.destroy(),this.runtime.watchHealth([this.tanks.player.getAttr("health"),this.tanks.red.getAttr("health"),this.tanks.yellow.getAttr("health"),this.tanks.green.getAttr("health")])}attack(c,o,s,a){if(!this.running)return;if(!c.visible())return;if(c.getAttr("health")<=0)return;let l=c.getAttr("tank"),k=c.getAttr("turret");return new Promise(async(Z)=>{let w=()=>{w.stopped=!0;let m=k.getAttr("bullet"),K=m.getAttr("tween");if(K)K.pause(),K.destroy(),m.destroy();o.off("abort",w),Z()};o.once("abort",w);let R=new Y.Image({tankUnit:c,name:"boom",image:this._bulletImage,offsetX:this._bulletImage.width/2,offsetY:this._bulletImage.height/2,scale:l.scale(),visible:!1});if(this.boardLayer.add(R),k.setAttr("bullet",R),k.getAttr("tween")){let m=k.getAttr("tween");k.setAttr("tween",null),m.pause(),m.destroy()}let D=-i.toNumber(s);if(await this._turn(k,o,D),w.stopped)return;if(c.getAttr("cooldown"))clearTimeout(c.getAttr("cooldown"));c.setAttr("cooldown",setTimeout(()=>c.setAttr("cooldown",null),Vo));let I=i.degToRad(D-90);R.setAttrs({x:c.x()+-Wc*Math.cos(I),y:c.y()+-Wc*Math.sin(I),visible:!0});let b=i.clamp(i.toNumber(a),no,to),F=-b*Math.cos(I),t=-b*Math.sin(I),io=R.x()+F,bo=R.y()+t,wc=b/this._bulletSpeed/this.runtime.fps,_o=Date.now(),Dc=this._bulletSpeed/b/2,Ic=new Y.Tween({x:io,y:bo,duration:wc,node:R,easing:Y.Easings.EaseInOut,onUpdate:()=>{let m=R.scaleX()+Dc;if(Date.now()-_o>wc/2*1000)m=R.scaleX()-Dc;R.setAttrs({scaleX:m,scaleY:m})},onFinish:()=>{this._boom(R);let m=R.getAttr("tween");R.setAttr("tween",null),m.destroy()}});R.setAttr("tween",Ic),Ic.play(),await Xc(1),o.off("abort",w),Z()})}_catch(c,o){if(!this.running)return;if(!c.visible())return;let s=o.getAttr("tankUnit");if(c===s)return;let a=o.rotation(),l=a+o.angle(),k=Math.min(a,l),Z=Math.max(a,l),w=s.position(),R=c.position(),D=i.distanceTo(w,R),I=i.directionTo(w,R);if(I>k&&I<Z&&D<Ac)return D}async scan(c,o){if(!this.running)return;if(!c.visible())return;if(c.getAttr("health")<=0)return;let s=-i.toNumber(o)+90,a=i.clamp(c.getAttr("scanWidth"),zo,So),l=Ac,k=c.getAttr("radar");k.setAttrs({tankUnit:c,angle:a,radius:l,rotation:s-a/2,fillRadialGradientEndRadius:l*0.7,visible:!0}),await Xc(Qc*a*1.5),k.visible(!1);let Z=this._catch(this.tanks.player,k)??1/0,w=this._catch(this.tanks.red,k)??1/0,R=this._catch(this.tanks.yellow,k)??1/0,D=this._catch(this.tanks.green,k)??1/0;return Math.min(Z,w,R,D)}}class H extends Go{constructor(c,o){super(c,!1);this._onWatchHealth=o,this._tankUtils=new P(this),this._tanks=new Proxy(c,{get(s,a){return c.findOne(`#${a}`)}})}get tanks(){return this._tanks}get tankUtils(){return this._tankUtils}get watchHealth(){return this._onWatchHealth}_updateThresholds(){let c=this._thresholds.keys();for(let o of c){let[s,a]=o.split(">"),l;if(s==="TIMER")l=this.times>parseFloat(a);if(s==="DAMAGE")l=100-this.tanks.player.getAttr("health")>parseFloat(a);if(typeof l==="boolean"){if(l&&!this._thresholds.get(o))this.run(`threshold:${o}`);this._thresholds.set(o,l)}}this.setMonitorValueById("sensing_health",this.tanks.player.getAttr("health")),this.setMonitorValueById("sensing_timer",this.times)}stop(){this.querySelectorAll(".boom").forEach((c)=>c.destroy()),super.stop()}drives(c){this.tankUtils.drive(this.tanks.player,c),this.tankUtils.drive(this.tanks.red,c),this.tankUtils.drive(this.tanks.yellow,c),this.tankUtils.drive(this.tanks.green,c)}setMonitorValue(c,o){if(c){let s=c.getAttr("monitor");if(!o){let a=this.querySelector(`#${s.groupId}`);if(a)switch(s.id){case"motion_xposition":o=Math.round(a.x());break;case"motion_yposition":o=Math.round(a.y());break;case"motion_direction":o=Math.round(Co.wrapClamp(-a.getAttr("tank").rotation(),-179,180));break;default:o=0;break}}super.setMonitorValue(c,o)}}}import{Konva as Q,KonvaUtils as ls}from"@blockcode/utils";var Tc="./assets/tank-blue-b8ae4cvd.png";var $c="./assets/turret-blue-dyrb04zn.png";var Mc="./assets/tank-red-ns7w7tad.png";var Lc="./assets/turret-red-ndwfv9ra.png";var Oc="./assets/tank-yellow-0ggp5pb0.png";var yc="./assets/turret-yellow-hzayg6vn.png";var Bc="./assets/tank-green-raz947mc.png";var Vc="./assets/turret-green-mg7ymk6e.png";var nc="./assets/broken-0zqvhcjc.png";var p=(c)=>{return new Promise((o)=>{let s=new Image;s.src=c,s.onload=()=>o(s)})},tc={player:{tank:p(Tc),turret:p($c)},red:{tank:p(Mc),turret:p(Lc)},yellow:{tank:p(Oc),turret:p(yc)},green:{tank:p(Bc),turret:p(Vc)},broken:p(nc)};function W(c,o,s,a=!1){let l=new Q.Group({id:s,visible:a}),k=tc[s],Z=new Q.Image({tankUnit:l,name:"tank",scaleX:c,scaleY:o});k.tank.then((I)=>{Z.setAttrs({image:I,offsetX:I.width/2,offsetY:I.height/2}),ls.computeConvexHulls(l,I),l.onUpdateConvexHulls=()=>({x:l.x(),y:l.y(),offsetX:Z.offsetX(),offsetY:Z.offsetY(),scaleX:Z.scaleX(),scaleY:Z.scaleY(),rotation:Z.rotation()})}),l.add(Z),l.setAttr("tank",Z);let w=new Q.Wedge({strokeWidth:0,fillRadialGradientStartRadius:0,fillRadialGradientColorStops:[0,"rgba(255 0 0 / 0.5)",1,"rgba(255 0 0 / 0)"],visible:!1});l.add(w),l.setAttr("radar",w);let R=new Q.Image({tankUnit:l,name:"turret",scaleX:c,scaleY:o});k.turret.then((I)=>{R.setAttrs({image:I,offsetX:I.width/2,offsetY:I.height/2})}),l.add(R),l.setAttr("turret",R);let D=new Q.Image({tankUnit:l,scaleX:c,scaleY:o,visible:!1});return tc.broken.then((I)=>{D.setAttrs({image:I,offsetX:I.width/2,offsetY:I.height/2})}),l.add(D),l.setAttr("broken",D),l}var Kc=`
const controller = runtime.createAbortController();
const signal = controller.signal;

runtime.when('start', (done) => {
  const funcId = 'simple-ai-tank';
  const warpMode = runtime.warpMode;
  return new Promise(async (resolve) => {
    let forceWait = Date.now();
    let renderMode = false;
    const handleAbort = (skipId) => {
      if (funcId === skipId) return;
      signal.off('abort', handleAbort);
      handleAbort.stopped = true;
      resolve();
    };
    signal.once('abort', handleAbort);
    while (true) {
      if (renderMode && !warpMode) {
        await runtime.nextFrame();
        forceWait = Date.now();
        renderMode = false;
      }
      await tankUtils.attack(target, signal, 0, MathUtils.random(5, 15) * 10);
      await tankUtils.attack(target, signal, 330, MathUtils.random(5, 15) * 10);
      await tankUtils.attack(target, signal, 300, MathUtils.random(5, 15) * 10);
      await tankUtils.attack(target, signal, 270, MathUtils.random(5, 15) * 10);
      await tankUtils.attack(target, signal, 300, MathUtils.random(5, 15) * 10);
      await tankUtils.attack(target, signal, 330, MathUtils.random(5, 15) * 10);
      if (handleAbort.stopped) break;
      if ((!renderMode && !warpMode) || Date.now() - forceWait > 300) {
        await runtime.nextTick();
        forceWait = Date.now();
      }
    }
    signal.off('abort', handleAbort);
    resolve();
  }).then(done).catch(done);
});
`;var zc="";var Sc="";var Cc="./assets/background-5h37gty1.png";import{jsx as bs}from"preact/jsx-runtime";var is={simple:Kc,medium:zc,senior:Sc},M=(c,o,s,a)=>{if(!c)return;c.setAttrs({x:o,y:s,health:100,speed:0,scanWidth:4,cooldown:null}),c.getAttr("broken")?.setAttr("visible",!1),c.getAttr("radar")?.setAttr("visible",!1);let l=c.getAttr("tank"),k=c.getAttr("turret");if(l){l.setAttrs({rotation:a,visible:!0});let Z=l.getAttr("tween");if(Z)Z.reset(),Z.destroy(),setTimeout(()=>l.setAttr("tween",null))}if(k){k.setAttrs({rotation:a,visible:!0});let Z=k.getAttr("tween");if(Z)Z.reset(),Z.destroy(),setTimeout(()=>k.setAttr("tween",null))}return c};function jc(){let{appState:c}=ws(),{meta:o,file:s}=Ds(),a=ks(null),l=Gc(()=>{if(!c.value)return;if(!a.value?.tanks)return;M(a.value.tanks.player,-180,180,-135)?.setAttrs({name:s.value.name,zIndex:3}),M(a.value.tanks.red,180,-180,45)?.setAttr("visible",c.value.enemies>0),M(a.value.tanks.yellow,180,180,135)?.setAttr("visible",c.value.enemies>1),M(a.value.tanks.green,-180,-180,-45)?.setAttr("visible",c.value.enemies>2),a.value.updateMonitors(o.value.monitors)},[]);cc(async()=>{a.value?.updateMonitors(o.value.monitors)},[o.value]),cc(async()=>{if(!a.value)return;if(c.value?.running===!0){let Z="";Z+=`const tankUtils = runtime.tankUtils;
`,Z+=`(target => {
${s.value.script}})(runtime.tanks.player);

`;for(let w=1;w<=c.value.enemies;w++){let R=c.value.tanks[w];Z+=`(target => {
${is[R.ai]}})(runtime.tanks.${R.id});

`}a.value.launch(`${Z}runtime.start();`)}else if(c.value?.running===!1){if(a.value.running)a.value.stop(),l()}},[c.value?.running]),cc(l,[a.value,c.value?.enemies]);let k=Gc((Z)=>{let w=(b)=>{Is({tanks:b.map((F,t)=>({...c.value.tanks[t],health:F}))})};a.value=new H(Z,w);let R=0.5,D=R*Z.scaleY();Rs.Image.fromURL(Cc,(b)=>{b.setAttrs({x:0,y:0,offsetX:b.width()/2,offsetY:b.height()/2,scaleX:R,scaleY:D}),a.value.backdropLayer.add(b)}),a.value.spritesLayer.add(W(R,D,"player",!0)),a.value.spritesLayer.add(W(R,D,"red")),a.value.spritesLayer.add(W(R,D,"yellow")),a.value.spritesLayer.add(W(R,D,"green"));let I=a.value.createAbortController();return a.value.on("frame",()=>a.value.drives(I.signal)),()=>{a.value=null}},[]);return bs(fs,{zoom:c.value?.stageSize!=="large"?0.8:1,width:480,height:480,onRuntime:k})}import{useCallback as oc}from"preact/hooks";import{classNames as co}from"@blockcode/utils";import{useAppContext as ps,translate as L,setAppState as sc,ToggleButtons as us}from"@blockcode/core";function u(c){let o=globalThis.document,s=o.createElement("style");s.appendChild(o.createTextNode(c)),o.head.append(s)}u(".bEtDYa_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.bEtDYa_green-flag,.bEtDYa_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.bEtDYa_green-flag:hover,.bEtDYa_stop-all:hover{background:var(--theme-light-transparent)}.bEtDYa_green-flag.bEtDYa_actived{background:var(--theme-transparent)}.bEtDYa_stop-all{opacity:.5}.bEtDYa_stop-all.bEtDYa_actived{opacity:1}.bEtDYa_green-flag.bEtDYa_disabled,.bEtDYa_stop-all.bEtDYa_disabled{opacity:.5}.bEtDYa_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.bEtDYa_space{margin-left:.2rem}.bEtDYa_toolbar-buttons-group{display:flex}.bEtDYa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.bEtDYa_group-button{border-left:none;border-radius:0}.bEtDYa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var d={space:"bEtDYa_space",toolbarButtonsGroup:"bEtDYa_toolbar-buttons-group",groupButton:"bEtDYa_group-button",toolbarWrapper:"bEtDYa_toolbar-wrapper",disabled:"bEtDYa_disabled",greenFlag:"bEtDYa_green-flag",stopAll:"bEtDYa_stop-all",actived:"bEtDYa_actived",groupButtonFirst:"bEtDYa_group-button-first",groupButtonLast:"bEtDYa_group-button-last",toolbarButton:"bEtDYa_toolbar-button"};var Uc="./assets/icon-green-flag-tz1g77je.svg";var ec="./assets/icon-stop-all-zrx3gxr1.svg";var Pc="./assets/icon-small-stage-anyzs7w9.svg";var Hc="./assets/icon-large-stage-f6hyxzdr.svg";import{jsx as O,jsxs as oo}from"preact/jsx-runtime";function so(){let{appState:c}=ps(),o=oc(()=>{let l=c.value?.tanks.map((k)=>({...k,health:100}));sc({tanks:l,running:!!l})},[]),s=oc(()=>{sc("running",!1)},[]),a=oc((l)=>{sc("stageSize",l)},[]);return oo("div",{className:d.toolbarWrapper,children:[oo("div",{className:d.toolbarButtonsGroup,children:[O("img",{className:co(d.greenFlag,{[d.actived]:c.value?.running}),src:Uc,title:L("tankwar.player.greenFlag","Fight"),onClick:o}),O("img",{className:co(d.stopAll,{[d.actived]:c.value?.running}),src:ec,title:L("tankwar.player.stopAll","Stop"),onClick:s})]}),O("div",{className:d.toolbarButtonsGroup,children:O(us,{items:[{icon:Pc,title:L("tankwar.stage.small","Switch to small stage"),value:"small"},{icon:Hc,title:L("tankwar.stage.large","Switch to large stage"),value:"large"}],value:c.value?.stageSize??"small",onChange:a})})]})}u(".ReTkdW_stage-wrapper{position:relative}.ReTkdW_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}.ReTkdW_small{width:386px;height:386px}");var y={stage:"ReTkdW_stage",small:"ReTkdW_small",stageWrapper:"ReTkdW_stage-wrapper"};import{jsx as ac,jsxs as Fs}from"preact/jsx-runtime";function ao(){let{appState:c}=ds();return Fs("div",{className:y.stageWrapper,children:[ac(so,{}),ac("div",{className:qs(y.stage,{[y.small]:c.value?.stageSize!=="large"}),children:ac(jc,{})})]})}import{useAppContext as hs,useProjectContext as vs,translate as N,setAppState as Ro}from"@blockcode/core";import{classNames as lc}from"@blockcode/utils";import{Label as E,BufferedInput as Ys,ToggleButtons as Zc}from"@blockcode/core";u("._OnGaW_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}._OnGaW_row{justify-content:space-between;margin-top:.5rem;display:flex}._OnGaW_row-primary{margin-top:0}._OnGaW_group{flex-direction:row;align-items:center;display:inline-flex}._OnGaW_full-input{flex:1}._OnGaW_name-input{width:8rem}._OnGaW_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}._OnGaW_button-icon{margin:auto}._OnGaW_space{margin-left:.2rem}._OnGaW_toolbar-button-group{display:flex}._OnGaW_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._OnGaW_group-button{border-left:none;border-radius:0}._OnGaW_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._OnGaW_button-text{flex:auto}._OnGaW_group-button-toggled-on ._OnGaW_button-text{color:#4c97ff}._OnGaW_tank-image{width:1.65rem}._OnGaW_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}._OnGaW_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress)\"% \";height:20px;width:calc(12rem*var(--percent,0)/100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;font-size:12px;line-height:20px;display:block;overflow:hidden}._OnGaW_health-progress._OnGaW_small{width:8rem}._OnGaW_health-progress._OnGaW_small:before{width:calc(8rem*var(--percent,0)/100)}");var r={button:"_OnGaW_button",toolbarButtonGroup:"_OnGaW_toolbar-button-group",fullInput:"_OnGaW_full-input",small:"_OnGaW_small",row:"_OnGaW_row",group:"_OnGaW_group",stageInfoWrapper:"_OnGaW_stage-info-wrapper",groupButton:"_OnGaW_group-button",healthProgress:"_OnGaW_health-progress",groupButtonFirst:"_OnGaW_group-button-first",buttonIcon:"_OnGaW_button-icon",tankImage:"_OnGaW_tank-image",buttonText:"_OnGaW_button-text",nameInput:"_OnGaW_name-input",rowPrimary:"_OnGaW_row-primary",space:"_OnGaW_space",groupButtonToggledOn:"_OnGaW_group-button-toggled-on",groupButtonLast:"_OnGaW_group-button-last"};var lo="./assets/icon-tank-red-tq1cemhn.png";var Zo="./assets/icon-tank-yellow-5vq6mndw.png";var ko="./assets/icon-tank-green-4r293h2s.png";import{useCallback as kc,useMemo as z0}from"preact/hooks";import{jsx as _,jsxs as B}from"preact/jsx-runtime";var Js=[lo,Zo,ko];function wo(){let{appState:c}=hs(),{file:o,setFile:s}=vs(),a=kc((Z)=>{s({name:Z})},[]),l=kc((Z)=>{Ro("enemies",Z)},[]),k=kc((Z)=>(w)=>{Ro("tanks",c.value.tanks.map((R)=>Z===R.id?{...R,ai:w}:R))},[]);return B("div",{className:r.stageInfoWrapper,children:[B("div",{className:lc(r.row,r.rowPrimary),children:[_(E,{text:N("tankwar.stageInfo.player","Player"),children:_(Ys,{disabled:c.value?.running,className:r.nameInput,placeholder:N("tankwar.stageInfo.nickname","Nickname"),onSubmit:a,value:o.value.name})}),_(E,{secondary:!0,className:r.health,text:N("tankwar.stageInfo.health","Health"),children:_("div",{className:lc(r.healthProgress,{[r.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?c.value?.tanks[0]?.health:100}`})})]}),B("div",{className:r.row,children:[_(E,{secondary:!0,text:N("tankwar.stageInfo.enemies","Enemies"),children:_(Zc,{disabled:c.value?.running,items:[{value:0,title:"0"},{value:1,title:"1"},{value:3,title:"3"}],value:c.value?.enemies??1,onChange:l})}),c.value?.enemies>0&&_(E,{secondary:!0,children:_(Zc,{disabled:c.value?.running,items:[{value:"local",title:N("tankwar.stageInfo.mode.local","Local AI")},{value:"remote",title:N("tankwar.stageInfo.mode.remote","Remote Players"),disabled:!0}],value:"local"})})]}),c.value?.tanks.slice(1,c.value?.enemies+1)?.map((Z,w)=>B("div",{className:r.row,children:[_(E,{secondary:!0,children:_("img",{className:r.tankImage,src:Js[w],alt:Z.name,title:Z.name})}),_(E,{secondary:!0,children:_("div",{className:lc(r.healthProgress,{[r.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?Z.health:100}`})}),_(E,{secondary:!0,text:N("tankwar.stageInfo.ai","AI"),children:_(Zc,{disabled:c.value?.running,items:[{value:"simple",title:N("tankwar.stageInfo.ai.simple","Simple")},{value:"medium",title:N("tankwar.stageInfo.ai.medium","Medium")},{value:"senior",title:N("tankwar.stageInfo.ai.senior","Senior")}],value:Z.ai??"simple",onChange:k(Z.id)})})]},w))]})}u(".yg_RPq_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.yg_RPq_stage-wrapper{display:flex}.yg_RPq_selector-wrapper{height:100%;margin-top:var(--space);flex-direction:row;display:flex}");var Rc={selectorWrapper:"yg_RPq_selector-wrapper",stageWrapper:"yg_RPq_stage-wrapper",sidebarWrapper:"yg_RPq_sidebar-wrapper"};import{jsx as Do,jsxs as Ws}from"preact/jsx-runtime";function Io(){return Xs(()=>{Qs({enemies:1,tanks:[{id:"player",name:V("tankwar.stageInfo.player","Player"),health:100},{id:"red",name:V("tankwar.stageInfo.enemy.red","Red"),health:100,ai:"simple"},{id:"yellow",name:V("tankwar.stageInfo.enemy.yellow","Yellow"),health:100,ai:"simple"},{id:"green",name:V("tankwar.stageInfo.enemy.green","Green"),health:100,ai:"simple"}]})},[]),Ws("div",{className:Rc.sidebarWrapper,children:[Do(ao,{className:Rc.stageWrapper}),Do(wo,{})]})}import{Text as As}from"@blockcode/core";import{jsx as Ts}from"preact/jsx-runtime";var fo={files:[{id:"player",name:Ts(As,{id:"tankwar.stageInfo.player",defaultMessage:"Player"})}]};import{jsx as Na}from"preact/jsx-runtime";var ra={onNew(){return fo},onSave(c){return{files:c.map((o)=>({id:o.id,name:o.name,xml:o.xml}))}},async onThumb(){let c=document.querySelector(".konvajs-content");return(await $s(c))?.toDataURL()},onUndo(c){if(c instanceof MouseEvent)n.getMainWorkspace()?.undo(!1)},onRedo(c){if(c instanceof MouseEvent)n.getMainWorkspace()?.undo(!0)},onEnableUndo(){let c=n.getMainWorkspace();return c?.undoStack_&&c.undoStack_.length!==0},onEnableRedo(){let c=n.getMainWorkspace();return c?.redoStack_&&c.redoStack_.length!==0},tabs:[{...Ms,Content:uc}].concat([]),docks:[{expand:"right",Content:Io}]};export{ra as default};
