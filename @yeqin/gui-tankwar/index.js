import{addLocalesMessages as ko}from"@blockcode/core";var kc={"tankwar.player.greenFlag":"Fight","tankwar.player.stopAll":"Stop","tankwar.stage.small":"Switch to small stage","tankwar.stage.large":"Switch to large stage","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health","tankwar.blocks.event_damage":"damage"};var Dc={"tankwar.player.greenFlag":"开战","tankwar.player.stopAll":"停战","tankwar.stage.small":"缩小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"昵称","tankwar.stageInfo.enemies":"敌方数量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"红","tankwar.stageInfo.enemy.yellow":"黄","tankwar.stageInfo.enemy.green":"绿","tankwar.stageInfo.mode.local":"本机 AI","tankwar.stageInfo.mode.remote":"联网玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"简单","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高级","tankwar.blocks.motion_attack":"面向 %1 方向距离 %2 步发射炮弹","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前进","tankwar.blocks.motion_setspeed":"将速度设为 %1 %","tankwar.blocks.motion_stop":"停止前进","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"将雷达扫描宽度设为 %1","tankwar.blocks.sensing_scan":"雷达扫描 %1 方向有敌人？","tankwar.blocks.sensing_distance":"雷达测量 %1 方向敌人的距离","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"伤害"};var wc={"tankwar.player.greenFlag":"開戰","tankwar.player.stopAll":"停戰","tankwar.stage.small":"縮小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"暱稱","tankwar.stageInfo.enemies":"敵方數量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"紅","tankwar.stageInfo.enemy.yellow":"黃","tankwar.stageInfo.enemy.green":"綠","tankwar.stageInfo.mode.local":"本機 AI","tankwar.stageInfo.mode.remote":"聯網玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"簡單","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高級","tankwar.blocks.motion_attack":"面向 %1 方向距離 %2 步發射炮彈","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前進","tankwar.blocks.motion_setspeed":"將速度設為 %1 %","tankwar.blocks.motion_stop":"停止前進","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"將雷達掃描寬度設為 %1","tankwar.blocks.sensing_scan":"雷達掃描 %1 方向有敵人？","tankwar.blocks.sensing_distance":"雷達測量 %1 方向敵人的距離","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"傷害"};ko({en:kc,"zh-Hans":Dc,"zh-Hant":wc});import{html2canvas as J1}from"@blockcode/utils";import{ScratchBlocks as V,blocksTab as X1,codeReviewTab as sl}from"@blockcode/blocks";import{CodeReview as Zl}from"@blockcode/blocks";import{BlocksEditor as Io}from"@blockcode/blocks";import{translate as Y,themeColors as z}from"@blockcode/core";import{ScratchBlocks as E}from"@blockcode/blocks";var Ic=()=>({id:"motion",name:"%{BKY_CATEGORY_MOTION}",themeColor:z.blocks.motion.primary,inputColor:z.blocks.motion.secondary,otherColor:z.blocks.motion.tertiary,order:0,blocks:[{id:"attack",text:Y("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),inputs:{DIRECTION:{type:"angle",defaultValue:90},DISTANCE:{shadow:"distancevalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",s=this.valueToCode(c,"DISTANCE",this.ORDER_NONE)||"100";return`await tankUtils.attack(userscript, target, ${o}, ${s});
`}},{id:"move",text:Y("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),inputs:{DIRECTION:{type:"angle",defaultValue:90},SPEED:{shadow:"speedvalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",s=this.valueToCode(c,"SPEED",this.ORDER_NONE)||"100";return`await tankUtils.move(userscript, target, ${o}, ${s});
`}},"---",{id:"turnright",text:E.Msg.MOTION_TURNRIGHT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-right.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnRight(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"turnleft",text:E.Msg.MOTION_TURNLEFT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-left.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnLeft(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"pointindirection",text:E.Msg.MOTION_POINTINDIRECTION,inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return`await tankUtils.setDirection(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0"});
`}},"---",{id:"setspeed",text:Y("tankwar.blocks.motion_setspeed","set speed to %1 %"),inputs:{SPEED:{shadow:"speedvalue",defaultValue:50}},emu(c){return`tankUtils.setSpeed(userscript, target, ${this.valueToCode(c,"SPEED",this.ORDER_NONE)||"0"});
`}},{id:"stop",text:Y("tankwar.blocks.motion_stop","stop"),emu(c){return`tankUtils.stop(target);
`}},"---",{id:"speed",text:Y("tankwar.blocks.motion_speed","speed"),output:"number",monitoring:!0,emu(c){return["tankUtils.getSpeed(target)",this.ORDER_FUNCTION_CALL]}},{id:"xposition",text:E.Msg.MOTION_XPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.x())",this.ORDER_FUNCTION_CALL]}},{id:"yposition",text:E.Msg.MOTION_YPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.y())",this.ORDER_FUNCTION_CALL]}},{id:"direction",text:E.Msg.MOTION_DIRECTION,output:"number",monitoring:!0,emu(c){return["tankUtils.getDirection(target)",this.ORDER_FUNCTION_CALL]}},{id:"distancevalue",inline:!0,output:"number",inputs:{DISTANCE:{type:"slider",min:50,max:200}},emu(c){return[c.getFieldValue("DISTANCE")||0,this.ORDER_NONE]}},{id:"speedvalue",inline:!0,output:"number",inputs:{SPEED:{type:"slider",min:-100,max:100}},emu(c){return[c.getFieldValue("SPEED")||0,this.ORDER_NONE]}}]});import{translate as Do,themeColors as S}from"@blockcode/core";import{ScratchBlocks as n}from"@blockcode/blocks";var fc=()=>({id:"event",name:"%{BKY_CATEGORY_EVENTS}",themeColor:S.blocks.events.primary,inputColor:S.blocks.events.secondary,otherColor:S.blocks.events.tertiary,blocks:[{id:"whenflagclicked",text:n.Msg.EVENT_WHENFLAGCLICKED,hat:!0,inputs:{FLAG:{type:"image",src:"./assets/blocks-media/green-flag.svg"}}},"---",{id:"whengreaterthan",text:n.Msg.EVENT_WHENGREATERTHAN,hat:!0,inputs:{WHENGREATERTHANMENU:{type:"string",menu:[[n.Msg.EVENT_WHENGREATERTHAN_TIMER,"TIMER"],[Do("tankwar.blocks.event_damage","damage"),"DAMAGE"]]},VALUE:{type:"number",defaultValue:10}}}]});import{translate as W,themeColors as C}from"@blockcode/core";import{ScratchBlocks as _c}from"@blockcode/blocks";var bc=()=>({id:"sensing",name:"%{BKY_CATEGORY_SENSING}",themeColor:C.blocks.sensing.primary,inputColor:C.blocks.sensing.secondary,otherColor:C.blocks.sensing.tertiary,blocks:[{id:"scan",text:W("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),output:"boolean",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}) !== Infinity)`,this.ORDER_EQUALITY]}},{id:"scandistance",text:W("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),output:"number",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}))`,this.ORDER_FUNCTION_CALL]}},"---",{id:"scanwidth",text:W("tankwar.blocks.sensing_scanwidth","set scan width to %1"),inputs:{WIDTH:{type:"number",defaultValue:5}},emu(c){return`target.setAttr('scanWidth', ${this.valueToCode(c,"WIDTH",this.ORDER_NONE)||5});
`}},"---",{id:"health",text:W("tankwar.blocks.sensing_health","health"),output:"number",monitoring:!0,emu(c){return["target.getAttr('health')",this.ORDER_FUNCTION_CALL]}},"---",{id:"timer",text:_c.Msg.SENSING_TIMER,output:"number",monitoring:!0,emu(c){return["runtime.times",this.ORDER_MEMBER]}},{id:"resettimer",text:_c.Msg.SENSING_RESETTIMER,emu(c){return`runtime.resetTimes()
`}}]});import{EmulatorGenerator as wo}from"@blockcode/blocks";class A extends wo{}function Nc(){let c=Ic(),o=fc(),s=bc();return[c,o,s]}import{jsx as _o}from"preact/jsx-runtime";var fo=new A;function mc(){return _o(Io,{enableMonitor:!0,disableExtensionButton:!0,emulator:fo,onBuildinExtensions:Nc})}import{useEffect as r1}from"preact/hooks";import{translate as B,setAppState as E1}from"@blockcode/core";import{classNames as N1}from"@blockcode/utils";import{useAppContext as m1}from"@blockcode/core";import{useCallback as zc,useEffect as H}from"preact/hooks";import{useSignal as c1}from"@preact/signals";import{Konva as o1}from"@blockcode/utils";import{useAppContext as s1,useProjectContext as l1,setAppState as Z1}from"@blockcode/core";import{Emulator as a1}from"@blockcode/blocks";import{MathUtils as Bo,ScriptController as Vo}from"@blockcode/utils";import{Runtime as Ko}from"@blockcode/blocks";var j=Symbol.for,g=Symbol("kCapture"),Fc=j("events.errorMonitor"),bo=Symbol("events.maxEventTargetListeners"),No=Symbol("events.maxEventTargetListenersWarned"),ic=j("nodejs.rejection"),mo=j("nodejs.rejection"),qc=Array.prototype.slice,u=10,F=function(o){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[g]=o?.captureRejections?Boolean(o?.captureRejections):f[g])this.emit=Fo},f=F.prototype={};f._events=void 0;f._eventsCount=0;f._maxListeners=void 0;f.setMaxListeners=function(o){return U(o,"setMaxListeners",0),this._maxListeners=o,this};f.constructor=F;f.getMaxListeners=function(){return this?._maxListeners??u};function dc(c,o){var{_events:s}=c;if(o[0]??=Error("Unhandled error."),!s)throw o[0];var l=s[Fc];if(l)for(var Z of qc.call(l))Z.apply(c,o);var R=s.error;if(!R)throw o[0];for(var Z of qc.call(R))Z.apply(c,o);return!0}function io(c,o,s,l){o.then(void 0,function(Z){queueMicrotask(()=>qo(c,Z,s,l))})}function qo(c,o,s,l){if(typeof c[ic]==="function")c[ic](o,s,...l);else try{c[g]=!1,c.emit("error",o)}finally{c[g]=!0}}var po=function(o,...s){if(o==="error")return dc(this,s);var{_events:l}=this;if(l===void 0)return!1;var Z=l[o];if(Z===void 0)return!1;let R=Z.length>1?Z.slice():Z;for(let a=0,{length:w}=R;a<w;a++){let D=R[a];switch(s.length){case 0:D.call(this);break;case 1:D.call(this,s[0]);break;case 2:D.call(this,s[0],s[1]);break;case 3:D.call(this,s[0],s[1],s[2]);break;default:D.apply(this,s);break}}return!0},Fo=function(o,...s){if(o==="error")return dc(this,s);var{_events:l}=this;if(l===void 0)return!1;var Z=l[o];if(Z===void 0)return!1;let R=Z.length>1?Z.slice():Z;for(let a=0,{length:w}=R;a<w;a++){let D=R[a],k;switch(s.length){case 0:k=D.call(this);break;case 1:k=D.call(this,s[0]);break;case 2:k=D.call(this,s[0],s[1]);break;case 3:k=D.call(this,s[0],s[1],s[2]);break;default:k=D.apply(this,s);break}if(k!==void 0&&typeof k?.then==="function"&&k.then===Promise.prototype.then)io(this,k,o,s)}return!0};f.emit=po;f.addListener=function(o,s){J(s);var l=this._events;if(!l)l=this._events={__proto__:null},this._eventsCount=0;else if(l.newListener)this.emit("newListener",o,s.listener??s);var Z=l[o];if(!Z)l[o]=[s],this._eventsCount++;else{Z.push(s);var R=this._maxListeners??u;if(R>0&&Z.length>R&&!Z.warned)gc(this,o,Z)}return this};f.on=f.addListener;f.prependListener=function(o,s){J(s);var l=this._events;if(!l)l=this._events={__proto__:null},this._eventsCount=0;else if(l.newListener)this.emit("newListener",o,s.listener??s);var Z=l[o];if(!Z)l[o]=[s],this._eventsCount++;else{Z.unshift(s);var R=this._maxListeners??u;if(R>0&&Z.length>R&&!Z.warned)gc(this,o,Z)}return this};function gc(c,o,s){s.warned=!0;let l=Error(`Possible EventEmitter memory leak detected. ${s.length} ${String(o)} listeners added to [${c.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);l.name="MaxListenersExceededWarning",l.emitter=c,l.type=o,l.count=s.length,console.warn(l)}function uc(c,o,...s){this.removeListener(c,o),o.apply(this,s)}f.once=function(o,s){J(s);let l=uc.bind(this,o,s);return l.listener=s,this.addListener(o,l),this};f.prependOnceListener=function(o,s){J(s);let l=uc.bind(this,o,s);return l.listener=s,this.prependListener(o,l),this};f.removeListener=function(o,s){J(s);var{_events:l}=this;if(!l)return this;var Z=l[o];if(!Z)return this;var R=Z.length;let a=-1;for(let w=R-1;w>=0;w--)if(Z[w]===s||Z[w].listener===s){a=w;break}if(a<0)return this;if(a===0)Z.shift();else Z.splice(a,1);if(Z.length===0)delete l[o],this._eventsCount--;return this};f.off=f.removeListener;f.removeAllListeners=function(o){var{_events:s}=this;if(o&&s){if(s[o])delete s[o],this._eventsCount--}else this._events={__proto__:null};return this};f.listeners=function(o){var{_events:s}=this;if(!s)return[];var l=s[o];if(!l)return[];return l.map((Z)=>Z.listener??Z)};f.rawListeners=function(o){var{_events:s}=this;if(!s)return[];var l=s[o];if(!l)return[];return l.slice()};f.listenerCount=function(o){var{_events:s}=this;if(!s)return 0;return s[o]?.length??0};f.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};f[g]=!1;function go(c,o,s){var l=s?.signal;if(xc(l,"options.signal"),l?.aborted)throw new G(void 0,{cause:l?.reason});let{resolve:Z,reject:R,promise:a}=$newPromiseCapability(Promise),w=(I)=>{if(c.removeListener(o,D),l!=null)T(l,"abort",k);R(I)},D=(...I)=>{if(typeof c.removeListener==="function")c.removeListener("error",w);if(l!=null)T(l,"abort",k);Z(I)};if(pc(c,o,D,{once:!0}),o!=="error"&&typeof c.once==="function")c.once("error",w);function k(){T(c,o,D),T(c,"error",w),R(new G(void 0,{cause:l?.reason}))}if(l!=null)pc(l,"abort",k,{once:!0});return a}function uo(c,o){return c.listeners(o)}function xo(c,...o){U(c,"setMaxListeners",0);var s;if(o&&(s=o.length))for(let l=0;l<s;l++)o[l].setMaxListeners(c);else u=c}function ro(c,o){return c.listenerCount(o)}function T(c,o,s,l){if(typeof c.removeListener==="function")c.removeListener(o,s);else c.removeEventListener(o,s,l)}function pc(c,o,s,l){if(typeof c.on==="function")if(l.once)c.once(o,s);else c.on(o,s);else c.addEventListener(o,s,l)}class G extends Error{constructor(c="The operation was aborted",o=void 0){if(o!==void 0&&typeof o!=="object")throw v("options","Object",o);super(c,o);this.code="ABORT_ERR",this.name="AbortError"}}function v(c,o,s){let l=TypeError(`The "${c}" argument must be of type ${o}. Received ${s}`);return l.code="ERR_INVALID_ARG_TYPE",l}function Eo(c,o,s){let l=RangeError(`The "${c}" argument is out of range. It must be ${o}. Received ${s}`);return l.code="ERR_OUT_OF_RANGE",l}function xc(c,o){if(c!==void 0&&(c===null||typeof c!=="object"||!("aborted"in c)))throw v(o,"AbortSignal",c)}function U(c,o,s,l){if(typeof c!=="number")throw v(o,"number",c);if(s!=null&&c<s||l!=null&&c>l||(s!=null||l!=null)&&Number.isNaN(c))throw Eo(o,`${s!=null?`>= ${s}`:""}${s!=null&&l!=null?" && ":""}${l!=null?`<= ${l}`:""}`,c)}function J(c){if(typeof c!=="function")throw TypeError("The listener must be a function")}function vo(c,o){if(typeof c!=="boolean")throw v(o,"boolean",c)}function ho(c){return c?._maxListeners??u}function Yo(c,o){if(c===void 0)throw v("signal","AbortSignal",c);if(xc(c,"signal"),typeof o!=="function")throw v("listener","function",o);let s;if(c.aborted)queueMicrotask(()=>o());else c.addEventListener("abort",o,{__proto__:null,once:!0}),s=()=>{c.removeEventListener("abort",o)};return{__proto__:null,[Symbol.dispose](){s?.()}}}Object.defineProperties(F,{captureRejections:{get(){return f[g]},set(c){vo(c,"EventEmitter.captureRejections"),f[g]=c},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return u},set:(c)=>{U(c,"defaultMaxListeners",0),u=c}},kMaxEventTargetListeners:{value:bo,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:No,enumerable:!1,configurable:!1,writable:!1}});Object.assign(F,{once:go,getEventListeners:uo,getMaxListeners:ho,setMaxListeners:xo,EventEmitter:F,usingDomains:!1,captureRejectionSymbol:mo,errorMonitor:Fc,addAbortListener:Yo,init:F,listenerCount:ro});import{sleep as Qo,MathUtils as _,Konva as h,KonvaUtils as Wo}from"@blockcode/utils";var rc="./assets/bullet-82yt94q7.png";var Ec="./assets/boom-0p27yacb.png";var Ao=2,vc=0.013888888888888888,To=1000,$o=50,Lo=200,hc=20,Oo=200,Mo=2,yo=30,Yc=400;class P extends F{constructor(c){super();this._runtime=c,this._speedRatio=Ao*c.fps,this._bulletSpeed=Oo/c.fps,this._bulletImage=new Image,this._bulletImage.src=rc,this._boomImage=new Image,this._boomImage.src=Ec}get runtime(){return this._runtime}get running(){return this.runtime.running}get stage(){return this.runtime.stage}get backdropLayer(){return this.runtime.backdropLayer}get paintLayer(){return this.runtime.paintLayer}get spritesLayer(){return this.runtime.spritesLayer}get boardLayer(){return this.runtime.boardLayer}get tanks(){return this.runtime.tanks}_findNearestEdge(c){let o=c.getClientRect(),s=this.stage.width(),l=this.stage.height(),Z=o.x,R=o.y,a=s-(o.x+o.width),w=l-(o.y+o.height),D,k=1/0;if(Z<k)k=Z,D="left";if(R<k)k=R,D="top";if(a<k)k=a,D="right";if(w<k)k=w,D="bottom";if(k>0)return;return D}drive(c,o){if(c.aborted)return;if(!o.visible())return;let s=o.getAttr("tank"),l=o.getAttr("turret");if(o.getAttr("health")<=0){o.getAttr("broken").visible(!0),s.visible(!1),l.visible(!1);return}let Z=s.rotation();if(!o.getAttr("cooldown")&&!l.getAttr("tween")&&Z!==l.rotation())c.execute(this._turn.bind(this),l,Z).then(()=>{let m=l.getAttr("tween");if(l.setAttr("tween",null),m)m.pause();if(!this.running)l.rotation(s.rotation())});if(this._findNearestEdge(s))this.stop(o);this.spritesLayer.children.some((m)=>{if(m===o||!m.visible())return;if(Wo.checkConvexHullsCollision(o,m))this.stop(o)});let a=o.getAttr("speed");if(!a)return;let w=_.degToRad(Z-90),D=-a*Math.cos(w),k=-a*Math.sin(w),I=o.x()+D,r=o.y()+k;o.position({x:I,y:r}),this.runtime.setMonitorValueById(`${o.id()}.motion_xposition`,Math.round(I)),this.runtime.setMonitorValueById(`${o.id()}.motion_yposition`,Math.round(r))}move(c,o,s,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;return this.setSpeed(c,o,l),this.setDirection(c,o,s)}_turn(c,o){if(!c.visible())return;if(c.getAttr("tween"))return;let s=Math.abs(o-c.rotation());if(s>180)s=360-s,o=c.rotation()+s;return new Promise((l)=>{let Z=new h.Tween({node:c,rotation:o,duration:vc*Math.abs(o-c.rotation()),easing:h.Easings.Linear,onFinish:()=>l(),onUpdate:()=>{let R=c.getAttr("tankUnit");if(c.hasName("tank"))this.runtime.setMonitorValueById(`${R.id()}.motion_direction`,this.getDirection(R))}});c.setAttr("tween",Z),Z.play()})}async setDirection(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=-_.toNumber(s),Z=o.getAttr("tank");if(await c.scripter.execute(this._turn.bind(this),Z,l),Z.getAttr("tween")){let R=Z.getAttr("tween");Z.setAttr("tween",null),R.pause()}}getDirection(c){return Math.round(_.wrapClamp(-c.getAttr("tank").rotation(),-179,180))}turnRight(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=_.toNumber(s),Z=-o.getAttr("tank").rotation()+l;return this.setDirection(c,o,Z)}turnLeft(c,o,s){if(c.aborted)return;let l=_.toNumber(s);return this.turnRight(c,o,-l)}setSpeed(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=_.toNumber(s);o.setAttr("speed",l/this._speedRatio),this.runtime.setMonitorValueById(`${o.id()}.motion_speed`,Math.round(l))}getSpeed(c){let o=c.getAttr("speed");return Math.round(o*this._speedRatio)}stop(c){c.setAttr("speed",0),this.runtime.setMonitorValueById(`${c.id()}.motion_speed`,0)}_hit(c,o){if(!c.visible())return;if(c===o.getAttr("tankUnit"))return;let s=c.getAttr("tank"),l=c.position(),Z=o.position(),R=_.distanceTo(l,Z),a=Math.min(s.width(),s.height())*s.scaleX();if(R<a/2){let w=c.getAttr("health")-10;c.setAttr("health",w);return}if(R<a/1.414215){let w=c.getAttr("health")-5;c.setAttr("health",w);return}}_boom(c){let o=new h.Sprite({x:c.x(),y:c.y(),name:"boom",image:this._boomImage,scale:c.scale(),rotation:c.rotation(),offsetX:this._boomImage.width/4/2,offsetY:this._boomImage.height/2,animation:"ready",animations:{boom:[80,0,80,80,160,0,80,80,240,0,80,80],ready:[0,0,80,80]},frameRate:6,frameIndex:0});return this.boardLayer.add(o),c.setAttr("boom",o),new Promise((s)=>{c.visible(!1),o.on("frameIndexChange.button",()=>{if(o.frameIndex()===2)setTimeout(s,1000/o.frameRate())}),o.animation("boom"),o.start(),this._hit(this.tanks.player,c),this._hit(this.tanks.red,c),this._hit(this.tanks.yellow,c),this._hit(this.tanks.green,c),this.runtime.watchHealth([this.tanks.player.getAttr("health"),this.tanks.red.getAttr("health"),this.tanks.yellow.getAttr("health"),this.tanks.green.getAttr("health")])})}_ballistic(c,o,s,l){return new Promise(async(Z)=>{if(c.getAttr("cooldown"))clearTimeout(c.getAttr("cooldown"));c.setAttr("cooldown",setTimeout(()=>c.setAttr("cooldown",null),To));let R=_.degToRad(s-90);o.setAttrs({x:c.x()+-hc*Math.cos(R),y:c.y()+-hc*Math.sin(R),visible:!0});let a=-l*Math.cos(R),w=-l*Math.sin(R),D=o.x()+a,k=o.y()+w,I=l/this._bulletSpeed/this.runtime.fps,r=Date.now(),m=this._bulletSpeed/l/2,Rc=new h.Tween({x:D,y:k,duration:I,node:o,easing:h.Easings.EaseInOut,onFinish:()=>Z(),onUpdate:()=>{let K=o.scaleX()+m;if(Date.now()-r>I/2*1000)K=o.scaleX()-m;o.setAttrs({scaleX:K,scaleY:K})}});o.setAttr("tween",Rc),Rc.play()})}async attack(c,o,s,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let Z=o.getAttr("tank"),R=o.getAttr("turret"),a=c.scripter,w=-_.toNumber(s),D=_.clamp(_.toNumber(l),$o,Lo);if(R.getAttr("tween")){let I=R.getAttr("tween");R.setAttr("tween",null),I.pause()}if(await a.execute(this._turn.bind(this),R,w),R.getAttr("tween")){let I=R.getAttr("tween");R.setAttr("tween",null),I.pause()}if(c.aborted)return;let k=new h.Image({tankUnit:o,name:"boom",image:this._bulletImage,offsetX:this._bulletImage.width/2,offsetY:this._bulletImage.height/2,scale:Z.scale(),visible:!1});if(this.boardLayer.add(k),await a.execute(this._ballistic.bind(this),o,k,w,D),k.getAttr("tween")){let I=k.getAttr("tween");k.setAttr("tween",null),I.pause()}if(c.aborted)return;if(await a.execute(this._boom.bind(this),k),k.getAttr("boom")){let I=k.getAttr("boom");I.off(".button"),I.destroy(),k.destroy()}}_catch(c,o){if(!c.visible())return;let s=o.getAttr("tankUnit");if(c===s)return;let l=o.rotation(),Z=l+o.angle(),R=Math.min(l,Z),a=Math.max(l,Z),w=s.position(),D=c.position(),k=_.distanceTo(w,D),I=_.directionTo(w,D);if(I>R&&I<a&&k<Yc)return k}async scan(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=-_.toNumber(s)+90,Z=_.clamp(o.getAttr("scanWidth"),Mo,yo),R=Yc,a=o.getAttr("radar");a.setAttrs({tankUnit:o,angle:Z,radius:R,rotation:l-Z/2,fillRadialGradientEndRadius:R*0.7,visible:!0}),await Qo(vc*Z*1.5),a.visible(!1);let w=this._catch(this.tanks.player,a)??1/0,D=this._catch(this.tanks.red,a)??1/0,k=this._catch(this.tanks.yellow,a)??1/0,I=this._catch(this.tanks.green,a)??1/0;return Math.min(w,D,k,I)}}class t extends Ko{constructor(c,o){super(c,!1);this._onWatchHealth=o,this._tankUtils=new P(this),this._tanks=new Proxy(c,{get:(s,l)=>c.findOne(`#${l}`)})}get tanks(){return this._tanks}get tankUtils(){return this._tankUtils}get watchHealth(){return this._onWatchHealth}_updateThresholds(){let c=this._thresholds.keys();for(let o of c){let[s,l]=o.split(">"),Z;if(s==="TIMER")Z=this.times>parseFloat(l);if(s==="DAMAGE")Z=100-this.tanks.player.getAttr("health")>parseFloat(l);if(typeof Z==="boolean"){if(Z&&!this._thresholds.get(o))this.call(`threshold:${o}`);this._thresholds.set(o,Z)}}this.setMonitorValueById("sensing_health",this.tanks.player.getAttr("health")),this.setMonitorValueById("sensing_timer",this.times)}stop(){this.querySelectorAll(".boom").forEach((c)=>c.destroy()),super.stop()}drives(){let c=new Vo;this.tankUtils.drive(c,this.tanks.player),this.tankUtils.drive(c,this.tanks.red),this.tankUtils.drive(c,this.tanks.yellow),this.tankUtils.drive(c,this.tanks.green)}setMonitorValue(c,o){if(c){let s=c.getAttr("monitor");if(!o){let l=this.querySelector(`#${s.groupId}`);if(l)switch(s.id){case"motion_xposition":o=Math.round(l.x());break;case"motion_yposition":o=Math.round(l.y());break;case"motion_direction":o=Math.round(Bo.wrapClamp(-l.getAttr("tank").rotation(),-179,180));break;default:o=0;break}}super.setMonitorValue(c,o)}}}import{Konva as X,KonvaUtils as Ho}from"@blockcode/utils";var Jc="./assets/tank-blue-b8ae4cvd.png";var Xc="./assets/turret-blue-dyrb04zn.png";var Qc="./assets/tank-red-ns7w7tad.png";var Wc="./assets/turret-red-ndwfv9ra.png";var Ac="./assets/tank-yellow-0ggp5pb0.png";var Tc="./assets/turret-yellow-hzayg6vn.png";var $c="./assets/tank-green-raz947mc.png";var Lc="./assets/turret-green-mg7ymk6e.png";var Oc="./assets/broken-0zqvhcjc.png";var q=(c)=>{return new Promise((o)=>{let s=new Image;s.src=c,s.onload=()=>o(s)})},Mc={player:{tank:q(Jc),turret:q(Xc)},red:{tank:q(Qc),turret:q(Wc)},yellow:{tank:q(Ac),turret:q(Tc)},green:{tank:q($c),turret:q(Lc)},broken:q(Oc)};function Q(c,o,s,l=!1){let Z=new X.Group({id:s,visible:l}),R=Mc[s],a=new X.Image({tankUnit:Z,name:"tank",scaleX:c,scaleY:o});R.tank.then((I)=>{a.setAttrs({image:I,offsetX:I.width/2,offsetY:I.height/2}),Ho.computeConvexHulls(Z,I),Z.onUpdateConvexHulls=()=>({x:Z.x(),y:Z.y(),offsetX:a.offsetX(),offsetY:a.offsetY(),scaleX:a.scaleX(),scaleY:a.scaleY(),rotation:a.rotation()})}),Z.add(a),Z.setAttr("tank",a);let w=new X.Wedge({strokeWidth:0,fillRadialGradientStartRadius:0,fillRadialGradientColorStops:[0,"rgba(255 0 0 / 0.5)",1,"rgba(255 0 0 / 0)"],visible:!1});Z.add(w),Z.setAttr("radar",w);let D=new X.Image({tankUnit:Z,name:"turret",scaleX:c,scaleY:o});R.turret.then((I)=>{D.setAttrs({image:I,offsetX:I.width/2,offsetY:I.height/2})}),Z.add(D),Z.setAttr("turret",D);let k=new X.Image({tankUnit:Z,scaleX:c,scaleY:o,visible:!1});return Mc.broken.then((I)=>{k.setAttrs({image:I,offsetX:I.width/2,offsetY:I.height/2})}),Z.add(k),Z.setAttr("broken",k),Z}var yc=`
`;var Bc="";var Vc="";var Kc="./assets/background-5h37gty1.png";import{jsx as k1}from"preact/jsx-runtime";var R1={simple:yc,medium:Bc,senior:Vc},$=(c,o,s,l)=>{if(!c)return;c.setAttrs({x:o,y:s,health:100,speed:0,scanWidth:4,cooldown:null}),c.getAttr("broken")?.setAttr("visible",!1),c.getAttr("radar")?.setAttr("visible",!1);let Z=c.getAttr("tank"),R=c.getAttr("turret");if(Z){Z.setAttrs({rotation:l,visible:!0});let a=Z.getAttr("tween");if(a)a.reset(),a.destroy(),setTimeout(()=>Z.setAttr("tween",null))}if(R){R.setAttrs({rotation:l,visible:!0});let a=R.getAttr("tween");if(a)a.reset(),a.destroy(),setTimeout(()=>R.setAttr("tween",null))}return c};function Sc(){let{appState:c}=s1(),{meta:o,file:s}=l1(),l=c1(null),Z=zc(()=>{if(!c.value)return;if(!l.value?.tanks)return;$(l.value.tanks.player,-180,180,-135)?.setAttrs({name:s.value.name,zIndex:3}),$(l.value.tanks.red,180,-180,45)?.setAttr("visible",c.value.enemies>0),$(l.value.tanks.yellow,180,180,135)?.setAttr("visible",c.value.enemies>1),$(l.value.tanks.green,-180,-180,-45)?.setAttr("visible",c.value.enemies>2),l.value.updateMonitors(o.value.monitors)},[]);H(async()=>{l.value?.updateMonitors(o.value.monitors)},[o.value]),H(async()=>{if(!l.value)return;if(c.value?.running===!0){let a="";a+=`const tankUtils = runtime.tankUtils;
`,a+=`(target => {
${s.value.script}})(runtime.tanks.player);

`;for(let w=1;w<=c.value.enemies;w++){let D=c.value.tanks[w];a+=`(target => {
${R1[D.ai]}})(runtime.tanks.${D.id});

`}l.value.launch(`${a}runtime.start();`)}else if(c.value?.running===!1){if(l.value.running)l.value.stop(),Z()}},[c.value?.running]),H(Z,[l.value,c.value?.enemies]);let R=zc((a)=>{let w=(I)=>{Z1({tanks:I.map((r,m)=>({...c.value.tanks[m],health:r}))})};l.value=new t(a,w);let D=0.5,k=D*a.scaleY();return o1.Image.fromURL(Kc,(I)=>{I.setAttrs({x:0,y:0,offsetX:I.width()/2,offsetY:I.height()/2,scaleX:D,scaleY:k}),l.value.backdropLayer.add(I)}),l.value.spritesLayer.add(Q(D,k,"player",!0)),l.value.spritesLayer.add(Q(D,k,"red")),l.value.spritesLayer.add(Q(D,k,"yellow")),l.value.spritesLayer.add(Q(D,k,"green")),l.value.on("frame",()=>l.value.drives()),()=>{l.value=null}},[]);return k1(a1,{zoom:c.value?.stageSize!=="large"?0.8:1,width:480,height:480,onRuntime:R})}import{useCallback as e}from"preact/hooks";import{classNames as Uc}from"@blockcode/utils";import{useAppContext as _1,translate as L,setAppState as cc,ToggleButtons as b1}from"@blockcode/core";function p(c){let o=globalThis.document,s=o.createElement("style");s.appendChild(o.createTextNode(c)),o.head.append(s)}p(".bEtDYa_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.bEtDYa_green-flag,.bEtDYa_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.bEtDYa_green-flag:hover,.bEtDYa_stop-all:hover{background:var(--theme-light-transparent)}.bEtDYa_green-flag.bEtDYa_actived{background:var(--theme-transparent)}.bEtDYa_stop-all{opacity:.5}.bEtDYa_stop-all.bEtDYa_actived{opacity:1}.bEtDYa_green-flag.bEtDYa_disabled,.bEtDYa_stop-all.bEtDYa_disabled{opacity:.5}.bEtDYa_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.bEtDYa_space{margin-left:.2rem}.bEtDYa_toolbar-buttons-group{display:flex}.bEtDYa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.bEtDYa_group-button{border-left:none;border-radius:0}.bEtDYa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var d={groupButtonLast:"bEtDYa_group-button-last",greenFlag:"bEtDYa_green-flag",groupButtonFirst:"bEtDYa_group-button-first",disabled:"bEtDYa_disabled",space:"bEtDYa_space",groupButton:"bEtDYa_group-button",toolbarWrapper:"bEtDYa_toolbar-wrapper",toolbarButtonsGroup:"bEtDYa_toolbar-buttons-group",toolbarButton:"bEtDYa_toolbar-button",stopAll:"bEtDYa_stop-all",actived:"bEtDYa_actived"};var nc="./assets/icon-green-flag-tz1g77je.svg";var Cc="./assets/icon-stop-all-zrx3gxr1.svg";var Gc="./assets/icon-small-stage-anyzs7w9.svg";var jc="./assets/icon-large-stage-f6hyxzdr.svg";import{jsx as O,jsxs as Pc}from"preact/jsx-runtime";function tc(){let{appState:c}=_1(),o=e(()=>{let Z=c.value?.tanks.map((R)=>({...R,health:100}));cc({tanks:Z,running:!!Z})},[]),s=e(()=>{cc("running",!1)},[]),l=e((Z)=>{cc("stageSize",Z)},[]);return Pc("div",{className:d.toolbarWrapper,children:[Pc("div",{className:d.toolbarButtonsGroup,children:[O("img",{className:Uc(d.greenFlag,{[d.actived]:c.value?.running}),src:nc,title:L("tankwar.player.greenFlag","Fight"),onClick:o}),O("img",{className:Uc(d.stopAll,{[d.actived]:c.value?.running}),src:Cc,title:L("tankwar.player.stopAll","Stop"),onClick:s})]}),O("div",{className:d.toolbarButtonsGroup,children:O(b1,{items:[{icon:Gc,title:L("tankwar.stage.small","Switch to small stage"),value:"small"},{icon:jc,title:L("tankwar.stage.large","Switch to large stage"),value:"large"}],value:c.value?.stageSize??"small",onChange:l})})]})}p(".ReTkdW_stage-wrapper{position:relative}.ReTkdW_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}.ReTkdW_small{width:386px;height:386px}");var M={small:"ReTkdW_small",stageWrapper:"ReTkdW_stage-wrapper",stage:"ReTkdW_stage"};import{jsx as oc,jsxs as i1}from"preact/jsx-runtime";function Hc(){let{appState:c}=m1();return i1("div",{className:M.stageWrapper,children:[oc(tc,{}),oc("div",{className:N1(M.stage,{[M.small]:c.value?.stageSize!=="large"}),children:oc(Sc,{})})]})}import{useAppContext as d1,useProjectContext as g1,translate as i,setAppState as so}from"@blockcode/core";import{classNames as sc}from"@blockcode/utils";import{Label as x,BufferedInput as u1,ToggleButtons as lc}from"@blockcode/core";p("._OnGaW_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}._OnGaW_row{justify-content:space-between;margin-top:.5rem;display:flex}._OnGaW_row-primary{margin-top:0}._OnGaW_group{flex-direction:row;align-items:center;display:inline-flex}._OnGaW_full-input{flex:1}._OnGaW_name-input{width:8rem}._OnGaW_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}._OnGaW_button-icon{margin:auto}._OnGaW_space{margin-left:.2rem}._OnGaW_toolbar-button-group{display:flex}._OnGaW_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._OnGaW_group-button{border-left:none;border-radius:0}._OnGaW_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._OnGaW_button-text{flex:auto}._OnGaW_group-button-toggled-on ._OnGaW_button-text{color:#4c97ff}._OnGaW_tank-image{width:1.65rem}._OnGaW_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}._OnGaW_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress)\"% \";height:20px;width:calc(12rem*var(--percent,0)/100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;font-size:12px;line-height:20px;display:block;overflow:hidden}._OnGaW_health-progress._OnGaW_small{width:8rem}._OnGaW_health-progress._OnGaW_small:before{width:calc(8rem*var(--percent,0)/100)}");var N={nameInput:"_OnGaW_name-input",buttonText:"_OnGaW_button-text",groupButtonToggledOn:"_OnGaW_group-button-toggled-on",buttonIcon:"_OnGaW_button-icon",rowPrimary:"_OnGaW_row-primary",tankImage:"_OnGaW_tank-image",row:"_OnGaW_row",toolbarButtonGroup:"_OnGaW_toolbar-button-group",space:"_OnGaW_space",button:"_OnGaW_button",groupButtonLast:"_OnGaW_group-button-last",group:"_OnGaW_group",groupButtonFirst:"_OnGaW_group-button-first",groupButton:"_OnGaW_group-button",small:"_OnGaW_small",healthProgress:"_OnGaW_health-progress",stageInfoWrapper:"_OnGaW_stage-info-wrapper",fullInput:"_OnGaW_full-input"};var ec="./assets/icon-tank-red-tq1cemhn.png";var co="./assets/icon-tank-yellow-5vq6mndw.png";var oo="./assets/icon-tank-green-4r293h2s.png";import{useCallback as Zc,useMemo as M0}from"preact/hooks";import{jsx as b,jsxs as y}from"preact/jsx-runtime";var x1=[ec,co,oo];function lo(){let{appState:c}=d1(),{file:o,setFile:s}=g1(),l=Zc((a)=>{s({name:a})},[]),Z=Zc((a)=>{so("enemies",a)},[]),R=Zc((a)=>(w)=>{so("tanks",c.value.tanks.map((D)=>a===D.id?{...D,ai:w}:D))},[]);return y("div",{className:N.stageInfoWrapper,children:[y("div",{className:sc(N.row,N.rowPrimary),children:[b(x,{text:i("tankwar.stageInfo.player","Player"),children:b(u1,{disabled:c.value?.running,className:N.nameInput,placeholder:i("tankwar.stageInfo.nickname","Nickname"),onSubmit:l,value:o.value.name})}),b(x,{secondary:!0,className:N.health,text:i("tankwar.stageInfo.health","Health"),children:b("div",{className:sc(N.healthProgress,{[N.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?c.value?.tanks[0]?.health:100}`})})]}),y("div",{className:N.row,children:[b(x,{secondary:!0,text:i("tankwar.stageInfo.enemies","Enemies"),children:b(lc,{disabled:c.value?.running,items:[{value:0,title:"0"},{value:1,title:"1"},{value:3,title:"3"}],value:c.value?.enemies??1,onChange:Z})}),c.value?.enemies>0&&b(x,{secondary:!0,children:b(lc,{disabled:c.value?.running,items:[{value:"local",title:i("tankwar.stageInfo.mode.local","Local AI")},{value:"remote",title:i("tankwar.stageInfo.mode.remote","Remote Players"),disabled:!0}],value:"local"})})]}),c.value?.tanks.slice(1,c.value?.enemies+1)?.map((a,w)=>y("div",{className:N.row,children:[b(x,{secondary:!0,children:b("img",{className:N.tankImage,src:x1[w],alt:a.name,title:a.name})}),b(x,{secondary:!0,children:b("div",{className:sc(N.healthProgress,{[N.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?a.health:100}`})}),b(x,{secondary:!0,text:i("tankwar.stageInfo.ai","AI"),children:b(lc,{disabled:c.value?.running,items:[{value:"simple",title:i("tankwar.stageInfo.ai.simple","Simple")},{value:"medium",title:i("tankwar.stageInfo.ai.medium","Medium")},{value:"senior",title:i("tankwar.stageInfo.ai.senior","Senior")}],value:a.ai??"simple",onChange:R(a.id)})})]},w))]})}p(".yg_RPq_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.yg_RPq_stage-wrapper{display:flex}.yg_RPq_selector-wrapper{height:100%;margin-top:var(--space);flex-direction:row;display:flex}");var ac={selectorWrapper:"yg_RPq_selector-wrapper",stageWrapper:"yg_RPq_stage-wrapper",sidebarWrapper:"yg_RPq_sidebar-wrapper"};import{jsx as Zo,jsxs as v1}from"preact/jsx-runtime";function ao(){return r1(()=>{E1({enemies:1,tanks:[{id:"player",name:B("tankwar.stageInfo.player","Player"),health:100},{id:"red",name:B("tankwar.stageInfo.enemy.red","Red"),health:100,ai:"simple"},{id:"yellow",name:B("tankwar.stageInfo.enemy.yellow","Yellow"),health:100,ai:"simple"},{id:"green",name:B("tankwar.stageInfo.enemy.green","Green"),health:100,ai:"simple"}]})},[]),v1("div",{className:ac.sidebarWrapper,children:[Zo(Hc,{className:ac.stageWrapper}),Zo(lo,{})]})}import{Text as h1}from"@blockcode/core";import{jsx as Y1}from"preact/jsx-runtime";var Ro={files:[{id:"player",name:Y1(h1,{id:"tankwar.stageInfo.player",defaultMessage:"Player"})}]};import{jsx as Il}from"preact/jsx-runtime";var Dl={onNew(){return Ro},onSave(c){return{files:c.map((o)=>({id:o.id,name:o.name,xml:o.xml}))}},async onThumb(){let c=document.querySelector(".konvajs-content");return(await J1(c))?.toDataURL()},onUndo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!1)},onRedo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!0)},onEnableUndo(){let c=V.getMainWorkspace();return c?.undoStack_&&c.undoStack_.length!==0},onEnableRedo(){let c=V.getMainWorkspace();return c?.redoStack_&&c.redoStack_.length!==0},tabs:[{...X1,Content:mc}].concat([]),docks:[{expand:"right",Content:ao}]};export{Dl as default};
