import{addLocalesMessages as Do}from"@blockcode/core";var Dc={"tankwar.player.greenFlag":"Fight","tankwar.player.stopAll":"Stop","tankwar.stage.small":"Switch to small stage","tankwar.stage.large":"Switch to large stage","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health","tankwar.blocks.event_damage":"damage"};var kc={"tankwar.player.greenFlag":"开战","tankwar.player.stopAll":"停战","tankwar.stage.small":"缩小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"昵称","tankwar.stageInfo.enemies":"敌方数量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"红","tankwar.stageInfo.enemy.yellow":"黄","tankwar.stageInfo.enemy.green":"绿","tankwar.stageInfo.mode.local":"本机 AI","tankwar.stageInfo.mode.remote":"联网玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"简单","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高级","tankwar.blocks.motion_attack":"面向 %1 方向距离 %2 步发射炮弹","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前进","tankwar.blocks.motion_setspeed":"将速度设为 %1 %","tankwar.blocks.motion_stop":"停止前进","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"将雷达扫描宽度设为 %1","tankwar.blocks.sensing_scan":"雷达扫描 %1 方向有敌人？","tankwar.blocks.sensing_distance":"雷达测量 %1 方向敌人的距离","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"伤害"};var Ic={"tankwar.player.greenFlag":"開戰","tankwar.player.stopAll":"停戰","tankwar.stage.small":"縮小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"暱稱","tankwar.stageInfo.enemies":"敵方數量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"紅","tankwar.stageInfo.enemy.yellow":"黃","tankwar.stageInfo.enemy.green":"綠","tankwar.stageInfo.mode.local":"本機 AI","tankwar.stageInfo.mode.remote":"聯網玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"簡單","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高級","tankwar.blocks.motion_attack":"面向 %1 方向距離 %2 步發射炮彈","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前進","tankwar.blocks.motion_setspeed":"將速度設為 %1 %","tankwar.blocks.motion_stop":"停止前進","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"將雷達掃描寬度設為 %1","tankwar.blocks.sensing_scan":"雷達掃描 %1 方向有敵人？","tankwar.blocks.sensing_distance":"雷達測量 %1 方向敵人的距離","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"傷害"};Do({en:Dc,"zh-Hans":kc,"zh-Hant":Ic});import{html2canvas as J1}from"@blockcode/utils";import{ScratchBlocks as V,blocksTab as X1,codeReviewTab as sl}from"@blockcode/blocks";import{CodeReview as Zl}from"@blockcode/blocks";import{BlocksEditor as wo}from"@blockcode/blocks";import{translate as Y,themeColors as K}from"@blockcode/core";import{ScratchBlocks as E}from"@blockcode/blocks";var wc=()=>({id:"motion",name:"%{BKY_CATEGORY_MOTION}",themeColor:K.blocks.motion.primary,inputColor:K.blocks.motion.secondary,otherColor:K.blocks.motion.tertiary,order:0,blocks:[{id:"attack",text:Y("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),inputs:{DIRECTION:{type:"angle",defaultValue:90},DISTANCE:{shadow:"distancevalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",s=this.valueToCode(c,"DISTANCE",this.ORDER_NONE)||"100",l=`await tankUtils.attack(userscript, target, ${o}, ${s});
`;return this._guardLoop=this.GUARD_LOOP_DISABLE,l}},{id:"move",text:Y("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),inputs:{DIRECTION:{type:"angle",defaultValue:90},SPEED:{shadow:"speedvalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",s=this.valueToCode(c,"SPEED",this.ORDER_NONE)||"100",l=`await tankUtils.move(userscript, target, ${o}, ${s});
`;return this._guardLoop=this.GUARD_LOOP_DISABLE,l}},"---",{id:"turnright",text:E.Msg.MOTION_TURNRIGHT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-right.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){let s=`await tankUtils.turnRight(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`;return this._guardLoop=this.GUARD_LOOP_DISABLE,s}},{id:"turnleft",text:E.Msg.MOTION_TURNLEFT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-left.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){let s=`await tankUtils.turnLeft(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`;return this._guardLoop=this.GUARD_LOOP_DISABLE,s}},{id:"pointindirection",text:E.Msg.MOTION_POINTINDIRECTION,inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){let s=`await tankUtils.setDirection(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0"});
`;return this._guardLoop=this.GUARD_LOOP_DISABLE,s}},"---",{id:"setspeed",text:Y("tankwar.blocks.motion_setspeed","set speed to %1 %"),inputs:{SPEED:{shadow:"speedvalue",defaultValue:50}},emu(c){return`tankUtils.setSpeed(userscript, target, ${this.valueToCode(c,"SPEED",this.ORDER_NONE)||"0"});
`}},{id:"stop",text:Y("tankwar.blocks.motion_stop","stop"),emu(c){return`tankUtils.stop(target);
`}},"---",{id:"speed",text:Y("tankwar.blocks.motion_speed","speed"),output:"number",monitoring:!0,emu(c){return["tankUtils.getSpeed(target)",this.ORDER_FUNCTION_CALL]}},{id:"xposition",text:E.Msg.MOTION_XPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.x())",this.ORDER_FUNCTION_CALL]}},{id:"yposition",text:E.Msg.MOTION_YPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.y())",this.ORDER_FUNCTION_CALL]}},{id:"direction",text:E.Msg.MOTION_DIRECTION,output:"number",monitoring:!0,emu(c){return["tankUtils.getDirection(target)",this.ORDER_FUNCTION_CALL]}},{id:"distancevalue",inline:!0,output:"number",inputs:{DISTANCE:{type:"slider",min:50,max:200}},emu(c){return[c.getFieldValue("DISTANCE")||0,this.ORDER_NONE]}},{id:"speedvalue",inline:!0,output:"number",inputs:{SPEED:{type:"slider",min:-100,max:100}},emu(c){return[c.getFieldValue("SPEED")||0,this.ORDER_NONE]}}]});import{translate as ko,themeColors as z}from"@blockcode/core";import{ScratchBlocks as n}from"@blockcode/blocks";var _c=()=>({id:"event",name:"%{BKY_CATEGORY_EVENTS}",themeColor:z.blocks.events.primary,inputColor:z.blocks.events.secondary,otherColor:z.blocks.events.tertiary,blocks:[{id:"whenflagclicked",text:n.Msg.EVENT_WHENFLAGCLICKED,hat:!0,inputs:{FLAG:{type:"image",src:"./assets/blocks-media/green-flag.svg"}}},"---",{id:"whengreaterthan",text:n.Msg.EVENT_WHENGREATERTHAN,hat:!0,inputs:{WHENGREATERTHANMENU:{type:"string",menu:[[n.Msg.EVENT_WHENGREATERTHAN_TIMER,"TIMER"],[ko("tankwar.blocks.event_damage","damage"),"DAMAGE"]]},VALUE:{type:"number",defaultValue:10}}}]});import{translate as A,themeColors as C}from"@blockcode/core";import{ScratchBlocks as fc}from"@blockcode/blocks";var bc=()=>({id:"sensing",name:"%{BKY_CATEGORY_SENSING}",themeColor:C.blocks.sensing.primary,inputColor:C.blocks.sensing.secondary,otherColor:C.blocks.sensing.tertiary,blocks:[{id:"scan",text:A("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),output:"boolean",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){let s=`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}) !== Infinity)`;return this._guardLoop=this.GUARD_LOOP_DISABLE,[s,this.ORDER_EQUALITY]}},{id:"scandistance",text:A("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),output:"number",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){let s=`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}))`;return this._guardLoop=this.GUARD_LOOP_DISABLE,[s,this.ORDER_FUNCTION_CALL]}},"---",{id:"scanwidth",text:A("tankwar.blocks.sensing_scanwidth","set scan width to %1"),inputs:{WIDTH:{type:"number",defaultValue:5}},emu(c){return`target.setAttr('scanWidth', ${this.valueToCode(c,"WIDTH",this.ORDER_NONE)||5});
`}},"---",{id:"health",text:A("tankwar.blocks.sensing_health","health"),output:"number",monitoring:!0,emu(c){return["target.getAttr('health')",this.ORDER_FUNCTION_CALL]}},"---",{id:"timer",text:fc.Msg.SENSING_TIMER,output:"number",monitoring:!0,emu(c){return["runtime.times",this.ORDER_MEMBER]}},{id:"resettimer",text:fc.Msg.SENSING_RESETTIMER,emu(c){return`runtime.resetTimes()
`}}]});import{EmulatorGenerator as Io}from"@blockcode/blocks";class W extends Io{}function Nc(){let c=wc(),o=_c(),s=bc();return[c,o,s]}import{jsx as fo}from"preact/jsx-runtime";var _o=new W;function mc(){return fo(wo,{enableMonitor:!0,disableExtensionButton:!0,emulator:_o,onBuildinExtensions:Nc})}import{useEffect as x1}from"preact/hooks";import{translate as B,setAppState as E1}from"@blockcode/core";import{classNames as N1}from"@blockcode/utils";import{useAppContext as m1}from"@blockcode/core";import{useCallback as Kc,useEffect as H}from"preact/hooks";import{useSignal as c1}from"@preact/signals";import{Konva as o1}from"@blockcode/utils";import{useAppContext as s1,useProjectContext as l1,setAppState as Z1}from"@blockcode/core";import{Emulator as a1}from"@blockcode/blocks";import{MathUtils as Bo,ScriptController as Vo}from"@blockcode/utils";import{Runtime as So}from"@blockcode/blocks";var j=Symbol.for,F=Symbol("kCapture"),gc=j("events.errorMonitor"),bo=Symbol("events.maxEventTargetListeners"),No=Symbol("events.maxEventTargetListenersWarned"),ic=j("nodejs.rejection"),mo=j("nodejs.rejection"),qc=Array.prototype.slice,d=10,g=function(o){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[F]=o?.captureRejections?Boolean(o?.captureRejections):_[F])this.emit=go},_=g.prototype={};_._events=void 0;_._eventsCount=0;_._maxListeners=void 0;_.setMaxListeners=function(o){return U(o,"setMaxListeners",0),this._maxListeners=o,this};_.constructor=g;_.getMaxListeners=function(){return this?._maxListeners??d};function uc(c,o){var{_events:s}=c;if(o[0]??=Error("Unhandled error."),!s)throw o[0];var l=s[gc];if(l)for(var Z of qc.call(l))Z.apply(c,o);var R=s.error;if(!R)throw o[0];for(var Z of qc.call(R))Z.apply(c,o);return!0}function io(c,o,s,l){o.then(void 0,function(Z){queueMicrotask(()=>qo(c,Z,s,l))})}function qo(c,o,s,l){if(typeof c[ic]==="function")c[ic](o,s,...l);else try{c[F]=!1,c.emit("error",o)}finally{c[F]=!0}}var po=function(o,...s){if(o==="error")return uc(this,s);var{_events:l}=this;if(l===void 0)return!1;var Z=l[o];if(Z===void 0)return!1;let R=Z.length>1?Z.slice():Z;for(let a=0,{length:I}=R;a<I;a++){let k=R[a];switch(s.length){case 0:k.call(this);break;case 1:k.call(this,s[0]);break;case 2:k.call(this,s[0],s[1]);break;case 3:k.call(this,s[0],s[1],s[2]);break;default:k.apply(this,s);break}}return!0},go=function(o,...s){if(o==="error")return uc(this,s);var{_events:l}=this;if(l===void 0)return!1;var Z=l[o];if(Z===void 0)return!1;let R=Z.length>1?Z.slice():Z;for(let a=0,{length:I}=R;a<I;a++){let k=R[a],D;switch(s.length){case 0:D=k.call(this);break;case 1:D=k.call(this,s[0]);break;case 2:D=k.call(this,s[0],s[1]);break;case 3:D=k.call(this,s[0],s[1],s[2]);break;default:D=k.apply(this,s);break}if(D!==void 0&&typeof D?.then==="function"&&D.then===Promise.prototype.then)io(this,D,o,s)}return!0};_.emit=po;_.addListener=function(o,s){J(s);var l=this._events;if(!l)l=this._events={__proto__:null},this._eventsCount=0;else if(l.newListener)this.emit("newListener",o,s.listener??s);var Z=l[o];if(!Z)l[o]=[s],this._eventsCount++;else{Z.push(s);var R=this._maxListeners??d;if(R>0&&Z.length>R&&!Z.warned)Fc(this,o,Z)}return this};_.on=_.addListener;_.prependListener=function(o,s){J(s);var l=this._events;if(!l)l=this._events={__proto__:null},this._eventsCount=0;else if(l.newListener)this.emit("newListener",o,s.listener??s);var Z=l[o];if(!Z)l[o]=[s],this._eventsCount++;else{Z.unshift(s);var R=this._maxListeners??d;if(R>0&&Z.length>R&&!Z.warned)Fc(this,o,Z)}return this};function Fc(c,o,s){s.warned=!0;let l=Error(`Possible EventEmitter memory leak detected. ${s.length} ${String(o)} listeners added to [${c.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);l.name="MaxListenersExceededWarning",l.emitter=c,l.type=o,l.count=s.length,console.warn(l)}function dc(c,o,...s){this.removeListener(c,o),o.apply(this,s)}_.once=function(o,s){J(s);let l=dc.bind(this,o,s);return l.listener=s,this.addListener(o,l),this};_.prependOnceListener=function(o,s){J(s);let l=dc.bind(this,o,s);return l.listener=s,this.prependListener(o,l),this};_.removeListener=function(o,s){J(s);var{_events:l}=this;if(!l)return this;var Z=l[o];if(!Z)return this;var R=Z.length;let a=-1;for(let I=R-1;I>=0;I--)if(Z[I]===s||Z[I].listener===s){a=I;break}if(a<0)return this;if(a===0)Z.shift();else Z.splice(a,1);if(Z.length===0)delete l[o],this._eventsCount--;return this};_.off=_.removeListener;_.removeAllListeners=function(o){var{_events:s}=this;if(o&&s){if(s[o])delete s[o],this._eventsCount--}else this._events={__proto__:null};return this};_.listeners=function(o){var{_events:s}=this;if(!s)return[];var l=s[o];if(!l)return[];return l.map((Z)=>Z.listener??Z)};_.rawListeners=function(o){var{_events:s}=this;if(!s)return[];var l=s[o];if(!l)return[];return l.slice()};_.listenerCount=function(o){var{_events:s}=this;if(!s)return 0;return s[o]?.length??0};_.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};_[F]=!1;function uo(c,o,s){var l=s?.signal;if(rc(l,"options.signal"),l?.aborted)throw new G(void 0,{cause:l?.reason});let{resolve:Z,reject:R,promise:a}=$newPromiseCapability(Promise),I=(w)=>{if(c.removeListener(o,k),l!=null)T(l,"abort",D);R(w)},k=(...w)=>{if(typeof c.removeListener==="function")c.removeListener("error",I);if(l!=null)T(l,"abort",D);Z(w)};if(pc(c,o,k,{once:!0}),o!=="error"&&typeof c.once==="function")c.once("error",I);function D(){T(c,o,k),T(c,"error",I),R(new G(void 0,{cause:l?.reason}))}if(l!=null)pc(l,"abort",D,{once:!0});return a}function Fo(c,o){return c.listeners(o)}function ro(c,...o){U(c,"setMaxListeners",0);var s;if(o&&(s=o.length))for(let l=0;l<s;l++)o[l].setMaxListeners(c);else d=c}function xo(c,o){return c.listenerCount(o)}function T(c,o,s,l){if(typeof c.removeListener==="function")c.removeListener(o,s);else c.removeEventListener(o,s,l)}function pc(c,o,s,l){if(typeof c.on==="function")if(l.once)c.once(o,s);else c.on(o,s);else c.addEventListener(o,s,l)}class G extends Error{constructor(c="The operation was aborted",o=void 0){if(o!==void 0&&typeof o!=="object")throw h("options","Object",o);super(c,o);this.code="ABORT_ERR",this.name="AbortError"}}function h(c,o,s){let l=TypeError(`The "${c}" argument must be of type ${o}. Received ${s}`);return l.code="ERR_INVALID_ARG_TYPE",l}function Eo(c,o,s){let l=RangeError(`The "${c}" argument is out of range. It must be ${o}. Received ${s}`);return l.code="ERR_OUT_OF_RANGE",l}function rc(c,o){if(c!==void 0&&(c===null||typeof c!=="object"||!("aborted"in c)))throw h(o,"AbortSignal",c)}function U(c,o,s,l){if(typeof c!=="number")throw h(o,"number",c);if(s!=null&&c<s||l!=null&&c>l||(s!=null||l!=null)&&Number.isNaN(c))throw Eo(o,`${s!=null?`>= ${s}`:""}${s!=null&&l!=null?" && ":""}${l!=null?`<= ${l}`:""}`,c)}function J(c){if(typeof c!=="function")throw TypeError("The listener must be a function")}function ho(c,o){if(typeof c!=="boolean")throw h(o,"boolean",c)}function vo(c){return c?._maxListeners??d}function Yo(c,o){if(c===void 0)throw h("signal","AbortSignal",c);if(rc(c,"signal"),typeof o!=="function")throw h("listener","function",o);let s;if(c.aborted)queueMicrotask(()=>o());else c.addEventListener("abort",o,{__proto__:null,once:!0}),s=()=>{c.removeEventListener("abort",o)};return{__proto__:null,[Symbol.dispose](){s?.()}}}Object.defineProperties(g,{captureRejections:{get(){return _[F]},set(c){ho(c,"EventEmitter.captureRejections"),_[F]=c},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return d},set:(c)=>{U(c,"defaultMaxListeners",0),d=c}},kMaxEventTargetListeners:{value:bo,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:No,enumerable:!1,configurable:!1,writable:!1}});Object.assign(g,{once:uo,getEventListeners:Fo,getMaxListeners:vo,setMaxListeners:ro,EventEmitter:g,usingDomains:!1,captureRejectionSymbol:mo,errorMonitor:gc,addAbortListener:Yo,init:g,listenerCount:xo});import{sleep as Qo,MathUtils as f,Konva as v,KonvaUtils as Ao}from"@blockcode/utils";var xc="./assets/bullet-82yt94q7.png";var Ec="./assets/boom-0p27yacb.png";var Wo=2,hc=0.013888888888888888,To=1000,Lo=50,$o=200,vc=20,Oo=200,Mo=2,yo=30,Yc=400;class P extends g{constructor(c){super();this._runtime=c,this._speedRatio=Wo*c.fps,this._bulletSpeed=Oo/c.fps,this._bulletImage=new Image,this._bulletImage.src=xc,this._boomImage=new Image,this._boomImage.src=Ec}get runtime(){return this._runtime}get running(){return this.runtime.running}get stage(){return this.runtime.stage}get backdropLayer(){return this.runtime.backdropLayer}get paintLayer(){return this.runtime.paintLayer}get spritesLayer(){return this.runtime.spritesLayer}get boardLayer(){return this.runtime.boardLayer}get tanks(){return this.runtime.tanks}_findNearestEdge(c){let o=c.getClientRect(),s=this.stage.width(),l=this.stage.height(),Z=o.x,R=o.y,a=s-(o.x+o.width),I=l-(o.y+o.height),k,D=1/0;if(Z<D)D=Z,k="left";if(R<D)D=R,k="top";if(a<D)D=a,k="right";if(I<D)D=I,k="bottom";if(D>0)return;return k}drive(c,o){if(c.aborted)return;if(!o.visible())return;let s=o.getAttr("tank"),l=o.getAttr("turret");if(o.getAttr("health")<=0){o.getAttr("broken").visible(!0),s.visible(!1),l.visible(!1);return}let Z=s.rotation();if(!o.getAttr("cooldown")&&!l.getAttr("tween")&&Z!==l.rotation())c.execute(this._turn.bind(this),l,Z).then(()=>{let m=l.getAttr("tween");if(l.setAttr("tween",null),m)m.pause();if(!this.running)l.rotation(s.rotation())});if(this._findNearestEdge(s))this.stop(o);this.spritesLayer.children.some((m)=>{if(m===o||!m.visible())return;if(Ao.checkConvexHullsCollision(o,m))this.stop(o)});let a=o.getAttr("speed");if(!a)return;let I=f.degToRad(Z-90),k=-a*Math.cos(I),D=-a*Math.sin(I),w=o.x()+k,x=o.y()+D;o.position({x:w,y:x}),this.runtime.setMonitorValueById(`${o.id()}.motion_xposition`,Math.round(w)),this.runtime.setMonitorValueById(`${o.id()}.motion_yposition`,Math.round(x))}move(c,o,s,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;return this.setSpeed(c,o,l),this.setDirection(c,o,s)}_turn(c,o){if(!c.visible())return;if(c.getAttr("tween"))return;let s=Math.abs(o-c.rotation());if(s>180)s=360-s,o=c.rotation()+s;return new Promise((l)=>{let Z=new v.Tween({node:c,rotation:o,duration:hc*Math.abs(o-c.rotation()),easing:v.Easings.Linear,onFinish:()=>l(),onUpdate:()=>{let R=c.getAttr("tankUnit");if(c.hasName("tank"))this.runtime.setMonitorValueById(`${R.id()}.motion_direction`,this.getDirection(R))}});c.setAttr("tween",Z),Z.play()})}async setDirection(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=-f.toNumber(s),Z=o.getAttr("tank");if(await c.scripter.execute(this._turn.bind(this),Z,l),Z.getAttr("tween")){let R=Z.getAttr("tween");Z.setAttr("tween",null),R.pause()}}getDirection(c){return Math.round(f.wrapClamp(-c.getAttr("tank").rotation(),-179,180))}turnRight(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=f.toNumber(s),Z=-o.getAttr("tank").rotation()+l;return this.setDirection(c,o,Z)}turnLeft(c,o,s){if(c.aborted)return;let l=f.toNumber(s);return this.turnRight(c,o,-l)}setSpeed(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=f.toNumber(s);o.setAttr("speed",l/this._speedRatio),this.runtime.setMonitorValueById(`${o.id()}.motion_speed`,Math.round(l))}getSpeed(c){let o=c.getAttr("speed");return Math.round(o*this._speedRatio)}stop(c){c.setAttr("speed",0),this.runtime.setMonitorValueById(`${c.id()}.motion_speed`,0)}_hit(c,o){if(!c.visible())return;if(c===o.getAttr("tankUnit"))return;let s=c.getAttr("tank"),l=c.position(),Z=o.position(),R=f.distanceTo(l,Z),a=Math.min(s.width(),s.height())*s.scaleX();if(R<a/2){let I=c.getAttr("health")-10;c.setAttr("health",I);return}if(R<a/1.414215){let I=c.getAttr("health")-5;c.setAttr("health",I);return}}_boom(c){let o=new v.Sprite({x:c.x(),y:c.y(),name:"boom",image:this._boomImage,scale:c.scale(),rotation:c.rotation(),offsetX:this._boomImage.width/4/2,offsetY:this._boomImage.height/2,animation:"ready",animations:{boom:[80,0,80,80,160,0,80,80,240,0,80,80],ready:[0,0,80,80]},frameRate:6,frameIndex:0});return this.boardLayer.add(o),c.setAttr("boom",o),new Promise((s)=>{c.visible(!1),o.on("frameIndexChange.button",()=>{if(o.frameIndex()===2)setTimeout(s,1000/o.frameRate())}),o.animation("boom"),o.start(),this._hit(this.tanks.player,c),this._hit(this.tanks.red,c),this._hit(this.tanks.yellow,c),this._hit(this.tanks.green,c),this.runtime.watchHealth([this.tanks.player.getAttr("health"),this.tanks.red.getAttr("health"),this.tanks.yellow.getAttr("health"),this.tanks.green.getAttr("health")])})}_ballistic(c,o,s,l){return new Promise(async(Z)=>{if(c.getAttr("cooldown"))clearTimeout(c.getAttr("cooldown"));c.setAttr("cooldown",setTimeout(()=>c.setAttr("cooldown",null),To));let R=f.degToRad(s-90);o.setAttrs({x:c.x()+-vc*Math.cos(R),y:c.y()+-vc*Math.sin(R),visible:!0});let a=-l*Math.cos(R),I=-l*Math.sin(R),k=o.x()+a,D=o.y()+I,w=l/this._bulletSpeed/this.runtime.fps,x=Date.now(),m=this._bulletSpeed/l/2,Rc=new v.Tween({x:k,y:D,duration:w,node:o,easing:v.Easings.EaseInOut,onFinish:()=>Z(),onUpdate:()=>{let S=o.scaleX()+m;if(Date.now()-x>w/2*1000)S=o.scaleX()-m;o.setAttrs({scaleX:S,scaleY:S})}});o.setAttr("tween",Rc),Rc.play()})}async attack(c,o,s,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let Z=o.getAttr("tank"),R=o.getAttr("turret"),a=c.scripter,I=-f.toNumber(s),k=f.clamp(f.toNumber(l),Lo,$o);if(R.getAttr("tween")){let w=R.getAttr("tween");R.setAttr("tween",null),w.pause()}if(await a.execute(this._turn.bind(this),R,I),R.getAttr("tween")){let w=R.getAttr("tween");R.setAttr("tween",null),w.pause()}if(c.aborted)return;let D=new v.Image({tankUnit:o,name:"boom",image:this._bulletImage,offsetX:this._bulletImage.width/2,offsetY:this._bulletImage.height/2,scale:Z.scale(),visible:!1});if(this.boardLayer.add(D),await a.execute(this._ballistic.bind(this),o,D,I,k),D.getAttr("tween")){let w=D.getAttr("tween");D.setAttr("tween",null),w.pause()}if(c.aborted)return;if(await a.execute(this._boom.bind(this),D),D.getAttr("boom")){let w=D.getAttr("boom");w.off(".button"),w.destroy(),D.destroy()}}_catch(c,o){if(!c.visible())return;let s=o.getAttr("tankUnit");if(c===s)return;let l=o.rotation(),Z=l+o.angle(),R=Math.min(l,Z),a=Math.max(l,Z),I=s.position(),k=c.position(),D=f.distanceTo(I,k),w=f.directionTo(I,k);if(w>R&&w<a&&D<Yc)return D}async scan(c,o,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=-f.toNumber(s)+90,Z=f.clamp(o.getAttr("scanWidth"),Mo,yo),R=Yc,a=o.getAttr("radar");a.setAttrs({tankUnit:o,angle:Z,radius:R,rotation:l-Z/2,fillRadialGradientEndRadius:R*0.7,visible:!0}),await Qo(hc*Z*1.5),a.visible(!1);let I=this._catch(this.tanks.player,a)??1/0,k=this._catch(this.tanks.red,a)??1/0,D=this._catch(this.tanks.yellow,a)??1/0,w=this._catch(this.tanks.green,a)??1/0;return Math.min(I,k,D,w)}}class t extends So{constructor(c,o){super(c,!1);this._onWatchHealth=o,this._tankUtils=new P(this),this._tanks=new Proxy(c,{get:(s,l)=>c.findOne(`#${l}`)})}get tanks(){return this._tanks}get tankUtils(){return this._tankUtils}get watchHealth(){return this._onWatchHealth}_updateThresholds(){let c=this._thresholds.keys();for(let o of c){let[s,l]=o.split(">"),Z;if(s==="TIMER")Z=this.times>parseFloat(l);if(s==="DAMAGE")Z=100-this.tanks.player.getAttr("health")>parseFloat(l);if(typeof Z==="boolean"){if(Z&&!this._thresholds.get(o))this.call(`threshold:${o}`);this._thresholds.set(o,Z)}}this.setMonitorValueById("sensing_health",this.tanks.player.getAttr("health")),this.setMonitorValueById("sensing_timer",this.times)}stop(){this.querySelectorAll(".boom").forEach((c)=>c.destroy()),super.stop()}drives(){let c=new Vo;this.tankUtils.drive(c,this.tanks.player),this.tankUtils.drive(c,this.tanks.red),this.tankUtils.drive(c,this.tanks.yellow),this.tankUtils.drive(c,this.tanks.green)}setMonitorValue(c,o){if(c){let s=c.getAttr("monitor");if(!o){let l=this.querySelector(`#${s.groupId}`);if(l)switch(s.id){case"motion_xposition":o=Math.round(l.x());break;case"motion_yposition":o=Math.round(l.y());break;case"motion_direction":o=Math.round(Bo.wrapClamp(-l.getAttr("tank").rotation(),-179,180));break;default:o=0;break}}super.setMonitorValue(c,o)}}}import{Konva as X,KonvaUtils as Ho}from"@blockcode/utils";var Jc="./assets/tank-blue-b8ae4cvd.png";var Xc="./assets/turret-blue-dyrb04zn.png";var Qc="./assets/tank-red-ns7w7tad.png";var Ac="./assets/turret-red-ndwfv9ra.png";var Wc="./assets/tank-yellow-0ggp5pb0.png";var Tc="./assets/turret-yellow-hzayg6vn.png";var Lc="./assets/tank-green-raz947mc.png";var $c="./assets/turret-green-mg7ymk6e.png";var Oc="./assets/broken-0zqvhcjc.png";var q=(c)=>{return new Promise((o)=>{let s=new Image;s.src=c,s.onload=()=>o(s)})},Mc={player:{tank:q(Jc),turret:q(Xc)},red:{tank:q(Qc),turret:q(Ac)},yellow:{tank:q(Wc),turret:q(Tc)},green:{tank:q(Lc),turret:q($c)},broken:q(Oc)};function Q(c,o,s,l=!1){let Z=new X.Group({id:s,visible:l}),R=Mc[s],a=new X.Image({tankUnit:Z,name:"tank",scaleX:c,scaleY:o});R.tank.then((w)=>{a.setAttrs({image:w,offsetX:w.width/2,offsetY:w.height/2}),Ho.computeConvexHulls(Z,w),Z.onUpdateConvexHulls=()=>({x:Z.x(),y:Z.y(),offsetX:a.offsetX(),offsetY:a.offsetY(),scaleX:a.scaleX(),scaleY:a.scaleY(),rotation:a.rotation()})}),Z.add(a),Z.setAttr("tank",a);let I=new X.Wedge({strokeWidth:0,fillRadialGradientStartRadius:0,fillRadialGradientColorStops:[0,"rgba(255 0 0 / 0.5)",1,"rgba(255 0 0 / 0)"],visible:!1});Z.add(I),Z.setAttr("radar",I);let k=new X.Image({tankUnit:Z,name:"turret",scaleX:c,scaleY:o});R.turret.then((w)=>{k.setAttrs({image:w,offsetX:w.width/2,offsetY:w.height/2})}),Z.add(k),Z.setAttr("turret",k);let D=new X.Image({tankUnit:Z,scaleX:c,scaleY:o,visible:!1});return Mc.broken.then((w)=>{D.setAttrs({image:w,offsetX:w.width/2,offsetY:w.height/2})}),Z.add(D),Z.setAttr("broken",D),Z}var yc=`
`;var Bc="";var Vc="";var Sc="./assets/background-5h37gty1.png";import{jsx as D1}from"preact/jsx-runtime";var R1={simple:yc,medium:Bc,senior:Vc},L=(c,o,s,l)=>{if(!c)return;c.setAttrs({x:o,y:s,health:100,speed:0,scanWidth:4,cooldown:null}),c.getAttr("broken")?.setAttr("visible",!1),c.getAttr("radar")?.setAttr("visible",!1);let Z=c.getAttr("tank"),R=c.getAttr("turret");if(Z){Z.setAttrs({rotation:l,visible:!0});let a=Z.getAttr("tween");if(a)a.reset(),a.destroy(),setTimeout(()=>Z.setAttr("tween",null))}if(R){R.setAttrs({rotation:l,visible:!0});let a=R.getAttr("tween");if(a)a.reset(),a.destroy(),setTimeout(()=>R.setAttr("tween",null))}return c};function zc(){let{appState:c}=s1(),{meta:o,file:s}=l1(),l=c1(null),Z=Kc(()=>{if(!c.value)return;if(!l.value?.tanks)return;L(l.value.tanks.player,-180,180,-135)?.setAttrs({name:s.value.name,zIndex:3}),L(l.value.tanks.red,180,-180,45)?.setAttr("visible",c.value.enemies>0),L(l.value.tanks.yellow,180,180,135)?.setAttr("visible",c.value.enemies>1),L(l.value.tanks.green,-180,-180,-45)?.setAttr("visible",c.value.enemies>2),l.value.updateMonitors(o.value.monitors)},[]);H(async()=>{l.value?.updateMonitors(o.value.monitors)},[o.value]),H(async()=>{if(!l.value)return;if(c.value?.running===!0){let a="";a+=`const tankUtils = runtime.tankUtils;
`,a+=`(target => {
${s.value.script}})(runtime.tanks.player);

`;for(let I=1;I<=c.value.enemies;I++){let k=c.value.tanks[I];a+=`(target => {
${R1[k.ai]}})(runtime.tanks.${k.id});

`}l.value.launch(`${a}runtime.start();`)}else if(c.value?.running===!1){if(l.value.running)l.value.stop(),Z()}},[c.value?.running]),H(Z,[l.value,c.value?.enemies]);let R=Kc((a)=>{let I=(w)=>{Z1({tanks:w.map((x,m)=>({...c.value.tanks[m],health:x}))})};l.value=new t(a,I);let k=0.5,D=k*a.scaleY();return o1.Image.fromURL(Sc,(w)=>{w.setAttrs({x:0,y:0,offsetX:w.width()/2,offsetY:w.height()/2,scaleX:k,scaleY:D}),l.value.backdropLayer.add(w)}),l.value.spritesLayer.add(Q(k,D,"player",!0)),l.value.spritesLayer.add(Q(k,D,"red")),l.value.spritesLayer.add(Q(k,D,"yellow")),l.value.spritesLayer.add(Q(k,D,"green")),l.value.on("frame",()=>l.value.drives()),()=>{l.value=null}},[]);return D1(a1,{zoom:c.value?.stageSize!=="large"?0.8:1,width:480,height:480,onRuntime:R})}import{useCallback as e}from"preact/hooks";import{classNames as Uc}from"@blockcode/utils";import{useAppContext as f1,translate as $,setAppState as cc,ToggleButtons as b1}from"@blockcode/core";function p(c){let o=globalThis.document,s=o.createElement("style");s.appendChild(o.createTextNode(c)),o.head.append(s)}p(".bEtDYa_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.bEtDYa_green-flag,.bEtDYa_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.bEtDYa_green-flag:hover,.bEtDYa_stop-all:hover{background:var(--theme-light-transparent)}.bEtDYa_green-flag.bEtDYa_actived{background:var(--theme-transparent)}.bEtDYa_stop-all{opacity:.5}.bEtDYa_stop-all.bEtDYa_actived{opacity:1}.bEtDYa_green-flag.bEtDYa_disabled,.bEtDYa_stop-all.bEtDYa_disabled{opacity:.5}.bEtDYa_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.bEtDYa_space{margin-left:.2rem}.bEtDYa_toolbar-buttons-group{display:flex}.bEtDYa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.bEtDYa_group-button{border-left:none;border-radius:0}.bEtDYa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var u={stopAll:"bEtDYa_stop-all",disabled:"bEtDYa_disabled",groupButtonFirst:"bEtDYa_group-button-first",groupButtonLast:"bEtDYa_group-button-last",actived:"bEtDYa_actived",space:"bEtDYa_space",greenFlag:"bEtDYa_green-flag",toolbarButton:"bEtDYa_toolbar-button",groupButton:"bEtDYa_group-button",toolbarButtonsGroup:"bEtDYa_toolbar-buttons-group",toolbarWrapper:"bEtDYa_toolbar-wrapper"};var nc="./assets/icon-green-flag-tz1g77je.svg";var Cc="./assets/icon-stop-all-zrx3gxr1.svg";var Gc="./assets/icon-small-stage-anyzs7w9.svg";var jc="./assets/icon-large-stage-f6hyxzdr.svg";import{jsx as O,jsxs as Pc}from"preact/jsx-runtime";function tc(){let{appState:c}=f1(),o=e(()=>{let Z=c.value?.tanks.map((R)=>({...R,health:100}));cc({tanks:Z,running:!!Z})},[]),s=e(()=>{cc("running",!1)},[]),l=e((Z)=>{cc("stageSize",Z)},[]);return Pc("div",{className:u.toolbarWrapper,children:[Pc("div",{className:u.toolbarButtonsGroup,children:[O("img",{className:Uc(u.greenFlag,{[u.actived]:c.value?.running}),src:nc,title:$("tankwar.player.greenFlag","Fight"),onClick:o}),O("img",{className:Uc(u.stopAll,{[u.actived]:c.value?.running}),src:Cc,title:$("tankwar.player.stopAll","Stop"),onClick:s})]}),O("div",{className:u.toolbarButtonsGroup,children:O(b1,{items:[{icon:Gc,title:$("tankwar.stage.small","Switch to small stage"),value:"small"},{icon:jc,title:$("tankwar.stage.large","Switch to large stage"),value:"large"}],value:c.value?.stageSize??"small",onChange:l})})]})}p(".ReTkdW_stage-wrapper{position:relative}.ReTkdW_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}.ReTkdW_small{width:386px;height:386px}");var M={stage:"ReTkdW_stage",stageWrapper:"ReTkdW_stage-wrapper",small:"ReTkdW_small"};import{jsx as oc,jsxs as i1}from"preact/jsx-runtime";function Hc(){let{appState:c}=m1();return i1("div",{className:M.stageWrapper,children:[oc(tc,{}),oc("div",{className:N1(M.stage,{[M.small]:c.value?.stageSize!=="large"}),children:oc(zc,{})})]})}import{useAppContext as u1,useProjectContext as F1,translate as i,setAppState as so}from"@blockcode/core";import{classNames as sc}from"@blockcode/utils";import{Label as r,BufferedInput as d1,ToggleButtons as lc}from"@blockcode/core";p("._OnGaW_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}._OnGaW_row{justify-content:space-between;margin-top:.5rem;display:flex}._OnGaW_row-primary{margin-top:0}._OnGaW_group{flex-direction:row;align-items:center;display:inline-flex}._OnGaW_full-input{flex:1}._OnGaW_name-input{width:8rem}._OnGaW_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}._OnGaW_button-icon{margin:auto}._OnGaW_space{margin-left:.2rem}._OnGaW_toolbar-button-group{display:flex}._OnGaW_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._OnGaW_group-button{border-left:none;border-radius:0}._OnGaW_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._OnGaW_button-text{flex:auto}._OnGaW_group-button-toggled-on ._OnGaW_button-text{color:#4c97ff}._OnGaW_tank-image{width:1.65rem}._OnGaW_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}._OnGaW_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress)\"% \";height:20px;width:calc(12rem*var(--percent,0)/100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;font-size:12px;line-height:20px;display:block;overflow:hidden}._OnGaW_health-progress._OnGaW_small{width:8rem}._OnGaW_health-progress._OnGaW_small:before{width:calc(8rem*var(--percent,0)/100)}");var N={space:"_OnGaW_space",row:"_OnGaW_row",groupButtonLast:"_OnGaW_group-button-last",groupButtonToggledOn:"_OnGaW_group-button-toggled-on",button:"_OnGaW_button",stageInfoWrapper:"_OnGaW_stage-info-wrapper",fullInput:"_OnGaW_full-input",buttonIcon:"_OnGaW_button-icon",group:"_OnGaW_group",toolbarButtonGroup:"_OnGaW_toolbar-button-group",groupButtonFirst:"_OnGaW_group-button-first",rowPrimary:"_OnGaW_row-primary",tankImage:"_OnGaW_tank-image",healthProgress:"_OnGaW_health-progress",nameInput:"_OnGaW_name-input",small:"_OnGaW_small",groupButton:"_OnGaW_group-button",buttonText:"_OnGaW_button-text"};var ec="./assets/icon-tank-red-tq1cemhn.png";var co="./assets/icon-tank-yellow-5vq6mndw.png";var oo="./assets/icon-tank-green-4r293h2s.png";import{useCallback as Zc,useMemo as M0}from"preact/hooks";import{jsx as b,jsxs as y}from"preact/jsx-runtime";var r1=[ec,co,oo];function lo(){let{appState:c}=u1(),{file:o,setFile:s}=F1(),l=Zc((a)=>{s({name:a})},[]),Z=Zc((a)=>{so("enemies",a)},[]),R=Zc((a)=>(I)=>{so("tanks",c.value.tanks.map((k)=>a===k.id?{...k,ai:I}:k))},[]);return y("div",{className:N.stageInfoWrapper,children:[y("div",{className:sc(N.row,N.rowPrimary),children:[b(r,{text:i("tankwar.stageInfo.player","Player"),children:b(d1,{disabled:c.value?.running,className:N.nameInput,placeholder:i("tankwar.stageInfo.nickname","Nickname"),onSubmit:l,value:o.value.name})}),b(r,{secondary:!0,className:N.health,text:i("tankwar.stageInfo.health","Health"),children:b("div",{className:sc(N.healthProgress,{[N.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?c.value?.tanks[0]?.health:100}`})})]}),y("div",{className:N.row,children:[b(r,{secondary:!0,text:i("tankwar.stageInfo.enemies","Enemies"),children:b(lc,{disabled:c.value?.running,items:[{value:0,title:"0"},{value:1,title:"1"},{value:3,title:"3"}],value:c.value?.enemies??1,onChange:Z})}),c.value?.enemies>0&&b(r,{secondary:!0,children:b(lc,{disabled:c.value?.running,items:[{value:"local",title:i("tankwar.stageInfo.mode.local","Local AI")},{value:"remote",title:i("tankwar.stageInfo.mode.remote","Remote Players"),disabled:!0}],value:"local"})})]}),c.value?.tanks.slice(1,c.value?.enemies+1)?.map((a,I)=>y("div",{className:N.row,children:[b(r,{secondary:!0,children:b("img",{className:N.tankImage,src:r1[I],alt:a.name,title:a.name})}),b(r,{secondary:!0,children:b("div",{className:sc(N.healthProgress,{[N.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?a.health:100}`})}),b(r,{secondary:!0,text:i("tankwar.stageInfo.ai","AI"),children:b(lc,{disabled:c.value?.running,items:[{value:"simple",title:i("tankwar.stageInfo.ai.simple","Simple")},{value:"medium",title:i("tankwar.stageInfo.ai.medium","Medium")},{value:"senior",title:i("tankwar.stageInfo.ai.senior","Senior")}],value:a.ai??"simple",onChange:R(a.id)})})]},I))]})}p(".yg_RPq_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.yg_RPq_stage-wrapper{display:flex}.yg_RPq_selector-wrapper{height:100%;margin-top:var(--space);flex-direction:row;display:flex}");var ac={sidebarWrapper:"yg_RPq_sidebar-wrapper",stageWrapper:"yg_RPq_stage-wrapper",selectorWrapper:"yg_RPq_selector-wrapper"};import{jsx as Zo,jsxs as h1}from"preact/jsx-runtime";function ao(){return x1(()=>{E1({enemies:1,tanks:[{id:"player",name:B("tankwar.stageInfo.player","Player"),health:100},{id:"red",name:B("tankwar.stageInfo.enemy.red","Red"),health:100,ai:"simple"},{id:"yellow",name:B("tankwar.stageInfo.enemy.yellow","Yellow"),health:100,ai:"simple"},{id:"green",name:B("tankwar.stageInfo.enemy.green","Green"),health:100,ai:"simple"}]})},[]),h1("div",{className:ac.sidebarWrapper,children:[Zo(Hc,{className:ac.stageWrapper}),Zo(lo,{})]})}import{Text as v1}from"@blockcode/core";import{jsx as Y1}from"preact/jsx-runtime";var Ro={files:[{id:"player",name:Y1(v1,{id:"tankwar.stageInfo.player",defaultMessage:"Player"})}]};import{jsx as wl}from"preact/jsx-runtime";var kl={onNew(){return Ro},onSave(c){return{files:c.map((o)=>({id:o.id,name:o.name,xml:o.xml}))}},async onThumb(){let c=document.querySelector(".konvajs-content");return(await J1(c))?.toDataURL()},onUndo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!1)},onRedo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!0)},onEnableUndo(){let c=V.getMainWorkspace();return c?.undoStack_&&c.undoStack_.length!==0},onEnableRedo(){let c=V.getMainWorkspace();return c?.redoStack_&&c.redoStack_.length!==0},tabs:[{...X1,Content:mc}].concat([]),docks:[{expand:"right",Content:ao}]};export{kl as default};
