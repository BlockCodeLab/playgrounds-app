import{addLocalesMessages as ko}from"@blockcode/core";var kc={"tankwar.player.greenFlag":"Fight","tankwar.player.stopAll":"Stop","tankwar.stage.small":"Switch to small stage","tankwar.stage.large":"Switch to large stage","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health","tankwar.blocks.event_damage":"damage"};var Dc={"tankwar.player.greenFlag":"开战","tankwar.player.stopAll":"停战","tankwar.stage.small":"缩小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"昵称","tankwar.stageInfo.enemies":"敌方数量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"红","tankwar.stageInfo.enemy.yellow":"黄","tankwar.stageInfo.enemy.green":"绿","tankwar.stageInfo.mode.local":"本机 AI","tankwar.stageInfo.mode.remote":"联网玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"简单","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高级","tankwar.blocks.motion_attack":"面向 %1 方向距离 %2 步发射炮弹","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前进","tankwar.blocks.motion_setspeed":"将速度设为 %1 %","tankwar.blocks.motion_stop":"停止前进","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"将雷达扫描宽度设为 %1","tankwar.blocks.sensing_scan":"雷达扫描 %1 方向有敌人？","tankwar.blocks.sensing_distance":"雷达测量 %1 方向敌人的距离","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"伤害"};var wc={"tankwar.player.greenFlag":"開戰","tankwar.player.stopAll":"停戰","tankwar.stage.small":"縮小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"暱稱","tankwar.stageInfo.enemies":"敵方數量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"紅","tankwar.stageInfo.enemy.yellow":"黃","tankwar.stageInfo.enemy.green":"綠","tankwar.stageInfo.mode.local":"本機 AI","tankwar.stageInfo.mode.remote":"聯網玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"簡單","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高級","tankwar.blocks.motion_attack":"面向 %1 方向距離 %2 步發射炮彈","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前進","tankwar.blocks.motion_setspeed":"將速度設為 %1 %","tankwar.blocks.motion_stop":"停止前進","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"將雷達掃描寬度設為 %1","tankwar.blocks.sensing_scan":"雷達掃描 %1 方向有敵人？","tankwar.blocks.sensing_distance":"雷達測量 %1 方向敵人的距離","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"傷害"};ko({en:kc,"zh-Hans":Dc,"zh-Hant":wc});import{html2canvas as J1}from"@blockcode/utils";import{ScratchBlocks as V,blocksTab as X1,codeReviewTab as sl}from"@blockcode/blocks";import{CodeReview as Zl}from"@blockcode/blocks";import{BlocksEditor as Io}from"@blockcode/blocks";import{translate as Y,themeColors as z}from"@blockcode/core";import{ScratchBlocks as E}from"@blockcode/blocks";var Ic=()=>({id:"motion",name:"%{BKY_CATEGORY_MOTION}",themeColor:z.blocks.motion.primary,inputColor:z.blocks.motion.secondary,otherColor:z.blocks.motion.tertiary,order:0,blocks:[{id:"attack",text:Y("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),inputs:{DIRECTION:{type:"angle",defaultValue:90},DISTANCE:{shadow:"distancevalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",l=this.valueToCode(c,"DISTANCE",this.ORDER_NONE)||"100";return`await tankUtils.attack(userscript, target, ${o}, ${l});
`}},{id:"move",text:Y("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),inputs:{DIRECTION:{type:"angle",defaultValue:90},SPEED:{shadow:"speedvalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",l=this.valueToCode(c,"SPEED",this.ORDER_NONE)||"100";return`await tankUtils.move(userscript, target, ${o}, ${l});
`}},"---",{id:"turnright",text:E.Msg.MOTION_TURNRIGHT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-right.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnRight(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"turnleft",text:E.Msg.MOTION_TURNLEFT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-left.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnLeft(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"pointindirection",text:E.Msg.MOTION_POINTINDIRECTION,inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return`await tankUtils.setDirection(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0"});
`}},"---",{id:"setspeed",text:Y("tankwar.blocks.motion_setspeed","set speed to %1 %"),inputs:{SPEED:{shadow:"speedvalue",defaultValue:50}},emu(c){return`tankUtils.setSpeed(userscript, target, ${this.valueToCode(c,"SPEED",this.ORDER_NONE)||"0"});
`}},{id:"stop",text:Y("tankwar.blocks.motion_stop","stop"),emu(c){return`tankUtils.stop(target);
`}},"---",{id:"speed",text:Y("tankwar.blocks.motion_speed","speed"),output:"number",monitoring:!0,emu(c){return["tankUtils.getSpeed(target)",this.ORDER_FUNCTION_CALL]}},{id:"xposition",text:E.Msg.MOTION_XPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.x())",this.ORDER_FUNCTION_CALL]}},{id:"yposition",text:E.Msg.MOTION_YPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.y())",this.ORDER_FUNCTION_CALL]}},{id:"direction",text:E.Msg.MOTION_DIRECTION,output:"number",monitoring:!0,emu(c){return["tankUtils.getDirection(target)",this.ORDER_FUNCTION_CALL]}},{id:"distancevalue",shadow:!0,output:"number",inputs:{DISTANCE:{type:"slider",min:50,max:200}},emu(c){return[c.getFieldValue("DISTANCE")||0,this.ORDER_NONE]}},{id:"speedvalue",shadow:!0,output:"number",inputs:{SPEED:{type:"slider",min:-100,max:100}},emu(c){return[c.getFieldValue("SPEED")||0,this.ORDER_NONE]}}]});import{translate as Do,themeColors as S}from"@blockcode/core";import{ScratchBlocks as C}from"@blockcode/blocks";var fc=()=>({id:"event",name:"%{BKY_CATEGORY_EVENTS}",themeColor:S.blocks.events.primary,inputColor:S.blocks.events.secondary,otherColor:S.blocks.events.tertiary,blocks:[{id:"whenflagclicked",text:C.Msg.EVENT_WHENFLAGCLICKED,hat:!0,inputs:{FLAG:{type:"image",src:"./assets/blocks-media/green-flag.svg"}}},"---",{id:"whengreaterthan",text:C.Msg.EVENT_WHENGREATERTHAN,hat:!0,inputs:{WHENGREATERTHANMENU:{type:"string",menu:[[C.Msg.EVENT_WHENGREATERTHAN_TIMER,"TIMER"],[Do("tankwar.blocks.event_damage","damage"),"DAMAGE"]]},VALUE:{type:"number",defaultValue:10}}}]});import{translate as W,themeColors as n}from"@blockcode/core";import{ScratchBlocks as _c}from"@blockcode/blocks";var bc=()=>({id:"sensing",name:"%{BKY_CATEGORY_SENSING}",themeColor:n.blocks.sensing.primary,inputColor:n.blocks.sensing.secondary,otherColor:n.blocks.sensing.tertiary,blocks:[{id:"scan",text:W("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),output:"boolean",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}) !== Infinity)`,this.ORDER_EQUALITY]}},{id:"scandistance",text:W("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),output:"number",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}))`,this.ORDER_FUNCTION_CALL]}},"---",{id:"scanwidth",text:W("tankwar.blocks.sensing_scanwidth","set scan width to %1"),inputs:{WIDTH:{type:"number",defaultValue:5}},emu(c){return`target.setAttr('scanWidth', ${this.valueToCode(c,"WIDTH",this.ORDER_NONE)||5});
`}},"---",{id:"health",text:W("tankwar.blocks.sensing_health","health"),output:"number",monitoring:!0,emu(c){return["target.getAttr('health')",this.ORDER_FUNCTION_CALL]}},"---",{id:"timer",text:_c.Msg.SENSING_TIMER,output:"number",monitoring:!0,emu(c){return["runtime.times",this.ORDER_MEMBER]}},{id:"resettimer",text:_c.Msg.SENSING_RESETTIMER,emu(c){return`runtime.resetTimes()
`}}]});import{EmulatorGenerator as wo}from"@blockcode/blocks";class A extends wo{}function Nc(){let c=Ic(),o=fc(),l=bc();return[c,o,l]}import{jsx as _o}from"preact/jsx-runtime";var fo=new A;function mc(){return _o(Io,{enableMonitor:!0,disableExtensionButton:!0,emulator:fo,onBuildinExtensions:Nc})}import{useEffect as r1}from"preact/hooks";import{translate as B,setAppState as E1}from"@blockcode/core";import{classNames as N1}from"@blockcode/utils";import{useAppContext as m1}from"@blockcode/core";import{useCallback as zc,useEffect as H}from"preact/hooks";import{useSignal as c1}from"@preact/signals";import{Konva as o1}from"@blockcode/utils";import{useAppContext as s1,useProjectContext as l1,setAppState as Z1}from"@blockcode/core";import{Emulator as a1}from"@blockcode/blocks";import{MathUtils as Bo,ScriptController as Vo}from"@blockcode/utils";import{Runtime as Ko}from"@blockcode/blocks";var j=Symbol.for,g=Symbol("kCapture"),Fc=j("events.errorMonitor"),bo=Symbol("events.maxEventTargetListeners"),No=Symbol("events.maxEventTargetListenersWarned"),qc=j("nodejs.rejection"),mo=j("nodejs.rejection"),ic=Array.prototype.slice,u=10,F=function(c){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[g]=c?.captureRejections?Boolean(c?.captureRejections):f[g])this.emit=Fo},f=F.prototype={};f._events=void 0;f._eventsCount=0;f._maxListeners=void 0;f.setMaxListeners=function(c){return U(c,"setMaxListeners",0),this._maxListeners=c,this};f.constructor=F;f.getMaxListeners=function(){return this?._maxListeners??u};function dc(c,o){var{_events:l}=c;if(o[0]??=Error("Unhandled error."),!l)throw o[0];var s=l[Fc];if(s)for(var Z of ic.call(s))Z.apply(c,o);var R=l.error;if(!R)throw o[0];for(var Z of ic.call(R))Z.apply(c,o);return!0}function qo(c,o,l,s){o.then(void 0,function(Z){queueMicrotask(()=>io(c,Z,l,s))})}function io(c,o,l,s){if(typeof c[qc]==="function")c[qc](o,l,...s);else try{c[g]=!1,c.emit("error",o)}finally{c[g]=!0}}var po=function(c,...o){if(c==="error")return dc(this,o);var{_events:l}=this;if(l===void 0)return!1;var s=l[c];if(s===void 0)return!1;let Z=s.length>1?s.slice():s;for(let R=0,{length:a}=Z;R<a;R++){let k=Z[R];switch(o.length){case 0:k.call(this);break;case 1:k.call(this,o[0]);break;case 2:k.call(this,o[0],o[1]);break;case 3:k.call(this,o[0],o[1],o[2]);break;default:k.apply(this,o);break}}return!0},Fo=function(c,...o){if(c==="error")return dc(this,o);var{_events:l}=this;if(l===void 0)return!1;var s=l[c];if(s===void 0)return!1;let Z=s.length>1?s.slice():s;for(let R=0,{length:a}=Z;R<a;R++){let k=Z[R],D;switch(o.length){case 0:D=k.call(this);break;case 1:D=k.call(this,o[0]);break;case 2:D=k.call(this,o[0],o[1]);break;case 3:D=k.call(this,o[0],o[1],o[2]);break;default:D=k.apply(this,o);break}if(D!==void 0&&typeof D?.then==="function"&&D.then===Promise.prototype.then)qo(this,D,c,o)}return!0};f.emit=po;f.addListener=function(c,o){J(o);var l=this._events;if(!l)l=this._events={__proto__:null},this._eventsCount=0;else if(l.newListener)this.emit("newListener",c,o.listener??o);var s=l[c];if(!s)l[c]=[o],this._eventsCount++;else{s.push(o);var Z=this._maxListeners??u;if(Z>0&&s.length>Z&&!s.warned)gc(this,c,s)}return this};f.on=f.addListener;f.prependListener=function(c,o){J(o);var l=this._events;if(!l)l=this._events={__proto__:null},this._eventsCount=0;else if(l.newListener)this.emit("newListener",c,o.listener??o);var s=l[c];if(!s)l[c]=[o],this._eventsCount++;else{s.unshift(o);var Z=this._maxListeners??u;if(Z>0&&s.length>Z&&!s.warned)gc(this,c,s)}return this};function gc(c,o,l){l.warned=!0;let s=Error(`Possible EventEmitter memory leak detected. ${l.length} ${String(o)} listeners added to [${c.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);s.name="MaxListenersExceededWarning",s.emitter=c,s.type=o,s.count=l.length,console.warn(s)}function uc(c,o,...l){this.removeListener(c,o),o.apply(this,l)}f.once=function(c,o){J(o);let l=uc.bind(this,c,o);return l.listener=o,this.addListener(c,l),this};f.prependOnceListener=function(c,o){J(o);let l=uc.bind(this,c,o);return l.listener=o,this.prependListener(c,l),this};f.removeListener=function(c,o){J(o);var{_events:l}=this;if(!l)return this;var s=l[c];if(!s)return this;var Z=s.length;let R=-1;for(let a=Z-1;a>=0;a--)if(s[a]===o||s[a].listener===o){R=a;break}if(R<0)return this;if(R===0)s.shift();else s.splice(R,1);if(s.length===0)delete l[c],this._eventsCount--;return this};f.off=f.removeListener;f.removeAllListeners=function(c){var{_events:o}=this;if(c&&o){if(o[c])delete o[c],this._eventsCount--}else this._events={__proto__:null};return this};f.listeners=function(c){var{_events:o}=this;if(!o)return[];var l=o[c];if(!l)return[];return l.map((s)=>s.listener??s)};f.rawListeners=function(c){var{_events:o}=this;if(!o)return[];var l=o[c];if(!l)return[];return l.slice()};f.listenerCount=function(c){var{_events:o}=this;if(!o)return 0;return o[c]?.length??0};f.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};f[g]=!1;function go(c,o,l){var s=l?.signal;if(xc(s,"options.signal"),s?.aborted)throw new G(void 0,{cause:s?.reason});let{resolve:Z,reject:R,promise:a}=$newPromiseCapability(Promise),k=(w)=>{if(c.removeListener(o,D),s!=null)T(s,"abort",I);R(w)},D=(...w)=>{if(typeof c.removeListener==="function")c.removeListener("error",k);if(s!=null)T(s,"abort",I);Z(w)};if(pc(c,o,D,{once:!0}),o!=="error"&&typeof c.once==="function")c.once("error",k);function I(){T(c,o,D),T(c,"error",k),R(new G(void 0,{cause:s?.reason}))}if(s!=null)pc(s,"abort",I,{once:!0});return a}function uo(c,o){return c.listeners(o)}function xo(c,...o){U(c,"setMaxListeners",0);var l;if(o&&(l=o.length))for(let s=0;s<l;s++)o[s].setMaxListeners(c);else u=c}function ro(c,o){return c.listenerCount(o)}function T(c,o,l,s){if(typeof c.removeListener==="function")c.removeListener(o,l);else c.removeEventListener(o,l,s)}function pc(c,o,l,s){if(typeof c.on==="function")if(s.once)c.once(o,l);else c.on(o,l);else c.addEventListener(o,l,s)}class G extends Error{constructor(c="The operation was aborted",o=void 0){if(o!==void 0&&typeof o!=="object")throw h("options","Object",o);super(c,o);this.code="ABORT_ERR",this.name="AbortError"}}function h(c,o,l){let s=TypeError(`The "${c}" argument must be of type ${o}. Received ${l}`);return s.code="ERR_INVALID_ARG_TYPE",s}function Eo(c,o,l){let s=RangeError(`The "${c}" argument is out of range. It must be ${o}. Received ${l}`);return s.code="ERR_OUT_OF_RANGE",s}function xc(c,o){if(c!==void 0&&(c===null||typeof c!=="object"||!("aborted"in c)))throw h(o,"AbortSignal",c)}function U(c,o,l,s){if(typeof c!=="number")throw h(o,"number",c);if(l!=null&&c<l||s!=null&&c>s||(l!=null||s!=null)&&Number.isNaN(c))throw Eo(o,`${l!=null?`>= ${l}`:""}${l!=null&&s!=null?" && ":""}${s!=null?`<= ${s}`:""}`,c)}function J(c){if(typeof c!=="function")throw TypeError("The listener must be a function")}function ho(c,o){if(typeof c!=="boolean")throw h(o,"boolean",c)}function vo(c){return c?._maxListeners??u}function Yo(c,o){if(c===void 0)throw h("signal","AbortSignal",c);if(xc(c,"signal"),typeof o!=="function")throw h("listener","function",o);let l;if(c.aborted)queueMicrotask(()=>o());else c.addEventListener("abort",o,{__proto__:null,once:!0}),l=()=>{c.removeEventListener("abort",o)};return{__proto__:null,[Symbol.dispose](){l?.()}}}Object.defineProperties(F,{captureRejections:{get(){return f[g]},set(c){ho(c,"EventEmitter.captureRejections"),f[g]=c},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return u},set:(c)=>{U(c,"defaultMaxListeners",0),u=c}},kMaxEventTargetListeners:{value:bo,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:No,enumerable:!1,configurable:!1,writable:!1}});Object.assign(F,{once:go,getEventListeners:uo,getMaxListeners:vo,setMaxListeners:xo,EventEmitter:F,usingDomains:!1,captureRejectionSymbol:mo,errorMonitor:Fc,addAbortListener:Yo,init:F,listenerCount:ro});import{sleep as Qo,MathUtils as _,Konva as v,KonvaUtils as Wo}from"@blockcode/utils";var rc="./assets/bullet-82yt94q7.png";var Ec="./assets/boom-0p27yacb.png";var Ao=2,hc=0.013888888888888888,To=1000,$o=50,Lo=200,vc=20,Oo=200,Mo=2,yo=30,Yc=400;class P extends F{constructor(c){super();this._runtime=c,this._speedRatio=Ao*c.fps,this._bulletSpeed=Oo/c.fps,this._bulletImage=new Image,this._bulletImage.src=rc,this._boomImage=new Image,this._boomImage.src=Ec}get runtime(){return this._runtime}get running(){return this.runtime.running}get stage(){return this.runtime.stage}get backdropLayer(){return this.runtime.backdropLayer}get paintLayer(){return this.runtime.paintLayer}get spritesLayer(){return this.runtime.spritesLayer}get boardLayer(){return this.runtime.boardLayer}get tanks(){return this.runtime.tanks}_findNearestEdge(c){let o=c.getClientRect(),l=this.stage.width(),s=this.stage.height(),Z=o.x,R=o.y,a=l-(o.x+o.width),k=s-(o.y+o.height),D,I=1/0;if(Z<I)I=Z,D="left";if(R<I)I=R,D="top";if(a<I)I=a,D="right";if(k<I)I=k,D="bottom";if(I>0)return;return D}drive(c,o){if(c.aborted)return;if(!o.visible())return;let l=o.getAttr("tank"),s=o.getAttr("turret");if(o.getAttr("health")<=0){o.getAttr("broken").visible(!0),l.visible(!1),s.visible(!1);return}let Z=l.rotation();if(!o.getAttr("cooldown")&&!s.getAttr("tween")&&Z!==s.rotation())c.execute(this._turn.bind(this),s,Z).then(()=>{let m=s.getAttr("tween");if(s.setAttr("tween",null),m)m.pause();if(!this.running)s.rotation(l.rotation())});if(this._findNearestEdge(l))this.stop(o);this.spritesLayer.children.some((m)=>{if(m===o||!m.visible())return;if(Wo.checkConvexHullsCollision(o,m))this.stop(o)});let a=o.getAttr("speed");if(!a)return;let k=_.degToRad(Z-90),D=-a*Math.cos(k),I=-a*Math.sin(k),w=o.x()+D,r=o.y()+I;o.position({x:w,y:r}),this.runtime.setMonitorValueById(`${o.id()}.motion_xposition`,Math.round(w)),this.runtime.setMonitorValueById(`${o.id()}.motion_yposition`,Math.round(r))}move(c,o,l,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;return this.setSpeed(c,o,s),this.setDirection(c,o,l)}_turn(c,o){if(!c.visible())return;if(c.getAttr("tween"))return;let l=Math.abs(o-c.rotation());if(l>180)l=360-l,o=c.rotation()+l;return new Promise((s)=>{let Z=new v.Tween({node:c,rotation:o,duration:hc*Math.abs(o-c.rotation()),easing:v.Easings.Linear,onFinish:()=>s(),onUpdate:()=>{let R=c.getAttr("tankUnit");if(c.hasName("tank"))this.runtime.setMonitorValueById(`${R.id()}.motion_direction`,this.getDirection(R))}});c.setAttr("tween",Z),Z.play()})}async setDirection(c,o,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=-_.toNumber(l),Z=o.getAttr("tank");if(await c.scripter.execute(this._turn.bind(this),Z,s),Z.getAttr("tween")){let R=Z.getAttr("tween");Z.setAttr("tween",null),R.pause()}}getDirection(c){return Math.round(_.wrapClamp(-c.getAttr("tank").rotation(),-179,180))}turnRight(c,o,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=_.toNumber(l),Z=-o.getAttr("tank").rotation()+s;return this.setDirection(c,o,Z)}turnLeft(c,o,l){if(c.aborted)return;let s=_.toNumber(l);return this.turnRight(c,o,-s)}setSpeed(c,o,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=_.toNumber(l);o.setAttr("speed",s/this._speedRatio),this.runtime.setMonitorValueById(`${o.id()}.motion_speed`,Math.round(s))}getSpeed(c){let o=c.getAttr("speed");return Math.round(o*this._speedRatio)}stop(c){c.setAttr("speed",0),this.runtime.setMonitorValueById(`${c.id()}.motion_speed`,0)}_hit(c,o){if(!c.visible())return;if(c===o.getAttr("tankUnit"))return;let l=c.getAttr("tank"),s=c.position(),Z=o.position(),R=_.distanceTo(s,Z),a=Math.min(l.width(),l.height())*l.scaleX();if(R<a/2){let k=c.getAttr("health")-10;c.setAttr("health",k);return}if(R<a/1.414215){let k=c.getAttr("health")-5;c.setAttr("health",k);return}}_boom(c){let o=new v.Sprite({x:c.x(),y:c.y(),name:"boom",image:this._boomImage,scale:c.scale(),rotation:c.rotation(),offsetX:this._boomImage.width/4/2,offsetY:this._boomImage.height/2,animation:"ready",animations:{boom:[80,0,80,80,160,0,80,80,240,0,80,80],ready:[0,0,80,80]},frameRate:6,frameIndex:0});return this.boardLayer.add(o),c.setAttr("boom",o),new Promise((l)=>{c.visible(!1),o.on("frameIndexChange.button",()=>{if(o.frameIndex()===2)setTimeout(l,1000/o.frameRate())}),o.animation("boom"),o.start(),this._hit(this.tanks.player,c),this._hit(this.tanks.red,c),this._hit(this.tanks.yellow,c),this._hit(this.tanks.green,c),this.runtime.watchHealth([this.tanks.player.getAttr("health"),this.tanks.red.getAttr("health"),this.tanks.yellow.getAttr("health"),this.tanks.green.getAttr("health")])})}_ballistic(c,o,l,s){return new Promise(async(Z)=>{if(c.getAttr("cooldown"))clearTimeout(c.getAttr("cooldown"));c.setAttr("cooldown",setTimeout(()=>c.setAttr("cooldown",null),To));let R=_.degToRad(l-90);o.setAttrs({x:c.x()+-vc*Math.cos(R),y:c.y()+-vc*Math.sin(R),visible:!0});let a=-s*Math.cos(R),k=-s*Math.sin(R),D=o.x()+a,I=o.y()+k,w=s/this._bulletSpeed/this.runtime.fps,r=Date.now(),m=this._bulletSpeed/s/2,Rc=new v.Tween({x:D,y:I,duration:w,node:o,easing:v.Easings.EaseInOut,onFinish:()=>Z(),onUpdate:()=>{let K=o.scaleX()+m;if(Date.now()-r>w/2*1000)K=o.scaleX()-m;o.setAttrs({scaleX:K,scaleY:K})}});o.setAttr("tween",Rc),Rc.play()})}async attack(c,o,l,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let Z=o.getAttr("tank"),R=o.getAttr("turret"),a=c.scripter,k=-_.toNumber(l),D=_.clamp(_.toNumber(s),$o,Lo);if(R.getAttr("tween")){let w=R.getAttr("tween");R.setAttr("tween",null),w.pause()}if(await a.execute(this._turn.bind(this),R,k),R.getAttr("tween")){let w=R.getAttr("tween");R.setAttr("tween",null),w.pause()}if(c.aborted)return;let I=new v.Image({tankUnit:o,name:"boom",image:this._bulletImage,offsetX:this._bulletImage.width/2,offsetY:this._bulletImage.height/2,scale:Z.scale(),visible:!1});if(this.boardLayer.add(I),await a.execute(this._ballistic.bind(this),o,I,k,D),I.getAttr("tween")){let w=I.getAttr("tween");I.setAttr("tween",null),w.pause()}if(c.aborted)return;if(await a.execute(this._boom.bind(this),I),I.getAttr("boom")){let w=I.getAttr("boom");w.off(".button"),w.destroy(),I.destroy()}}_catch(c,o){if(!c.visible())return;let l=o.getAttr("tankUnit");if(c===l)return;let s=o.rotation(),Z=s+o.angle(),R=Math.min(s,Z),a=Math.max(s,Z),k=l.position(),D=c.position(),I=_.distanceTo(k,D),w=_.directionTo(k,D);if(w>R&&w<a&&I<Yc)return I}async scan(c,o,l){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=-_.toNumber(l)+90,Z=_.clamp(o.getAttr("scanWidth"),Mo,yo),R=Yc,a=o.getAttr("radar");a.setAttrs({tankUnit:o,angle:Z,radius:R,rotation:s-Z/2,fillRadialGradientEndRadius:R*0.7,visible:!0}),await Qo(hc*Z*1.5),a.visible(!1);let k=this._catch(this.tanks.player,a)??1/0,D=this._catch(this.tanks.red,a)??1/0,I=this._catch(this.tanks.yellow,a)??1/0,w=this._catch(this.tanks.green,a)??1/0;return Math.min(k,D,I,w)}}class t extends Ko{constructor(c,o){super(c,!1);this._onWatchHealth=o,this._tankUtils=new P(this),this._tanks=new Proxy(c,{get:(l,s)=>c.findOne(`#${s}`)})}get tanks(){return this._tanks}get tankUtils(){return this._tankUtils}get watchHealth(){return this._onWatchHealth}_updateThresholds(){let c=this._thresholds.keys();for(let o of c){let[l,s]=o.split(">"),Z;if(l==="TIMER")Z=this.times>parseFloat(s);if(l==="DAMAGE")Z=100-this.tanks.player.getAttr("health")>parseFloat(s);if(typeof Z==="boolean"){if(Z&&!this._thresholds.get(o))this.call(`threshold:${o}`);this._thresholds.set(o,Z)}}this.setMonitorValueById("sensing_health",this.tanks.player.getAttr("health")),this.setMonitorValueById("sensing_timer",this.times)}stop(){this.querySelectorAll(".boom").forEach((c)=>c.destroy()),super.stop()}drives(){let c=new Vo;this.tankUtils.drive(c,this.tanks.player),this.tankUtils.drive(c,this.tanks.red),this.tankUtils.drive(c,this.tanks.yellow),this.tankUtils.drive(c,this.tanks.green)}setMonitorValue(c,o){if(c){let l=c.getAttr("monitor");if(!o){let s=this.querySelector(`#${l.groupId}`);if(s)switch(l.id){case"motion_xposition":o=Math.round(s.x());break;case"motion_yposition":o=Math.round(s.y());break;case"motion_direction":o=Math.round(Bo.wrapClamp(-s.getAttr("tank").rotation(),-179,180));break;default:o=0;break}}super.setMonitorValue(c,o)}}}import{Konva as X,KonvaUtils as Ho}from"@blockcode/utils";var Jc="./assets/tank-blue-b8ae4cvd.png";var Xc="./assets/turret-blue-dyrb04zn.png";var Qc="./assets/tank-red-ns7w7tad.png";var Wc="./assets/turret-red-ndwfv9ra.png";var Ac="./assets/tank-yellow-0ggp5pb0.png";var Tc="./assets/turret-yellow-hzayg6vn.png";var $c="./assets/tank-green-raz947mc.png";var Lc="./assets/turret-green-mg7ymk6e.png";var Oc="./assets/broken-0zqvhcjc.png";var i=(c)=>{return new Promise((o)=>{let l=new Image;l.src=c,l.onload=()=>o(l)})},Mc={player:{tank:i(Jc),turret:i(Xc)},red:{tank:i(Qc),turret:i(Wc)},yellow:{tank:i(Ac),turret:i(Tc)},green:{tank:i($c),turret:i(Lc)},broken:i(Oc)};function Q(c,o,l,s=!1){let Z=new X.Group({id:l,visible:s}),R=Mc[l],a=new X.Image({tankUnit:Z,name:"tank",scaleX:c,scaleY:o});R.tank.then((w)=>{a.setAttrs({image:w,offsetX:w.width/2,offsetY:w.height/2}),Ho.computeConvexHulls(Z,w),Z.onUpdateConvexHulls=()=>({x:Z.x(),y:Z.y(),offsetX:a.offsetX(),offsetY:a.offsetY(),scaleX:a.scaleX(),scaleY:a.scaleY(),rotation:a.rotation()})}),Z.add(a),Z.setAttr("tank",a);let k=new X.Wedge({strokeWidth:0,fillRadialGradientStartRadius:0,fillRadialGradientColorStops:[0,"rgba(255 0 0 / 0.5)",1,"rgba(255 0 0 / 0)"],visible:!1});Z.add(k),Z.setAttr("radar",k);let D=new X.Image({tankUnit:Z,name:"turret",scaleX:c,scaleY:o});R.turret.then((w)=>{D.setAttrs({image:w,offsetX:w.width/2,offsetY:w.height/2})}),Z.add(D),Z.setAttr("turret",D);let I=new X.Image({tankUnit:Z,scaleX:c,scaleY:o,visible:!1});return Mc.broken.then((w)=>{I.setAttrs({image:w,offsetX:w.width/2,offsetY:w.height/2})}),Z.add(I),Z.setAttr("broken",I),Z}var yc=`
`;var Bc="";var Vc="";var Kc="./assets/background-5h37gty1.png";import{jsx as k1}from"preact/jsx-runtime";var R1={simple:yc,medium:Bc,senior:Vc},$=(c,o,l,s)=>{if(!c)return;c.setAttrs({x:o,y:l,health:100,speed:0,scanWidth:4,cooldown:null}),c.getAttr("broken")?.setAttr("visible",!1),c.getAttr("radar")?.setAttr("visible",!1);let Z=c.getAttr("tank"),R=c.getAttr("turret");if(Z){Z.setAttrs({rotation:s,visible:!0});let a=Z.getAttr("tween");if(a)a.reset(),a.destroy(),setTimeout(()=>Z.setAttr("tween",null))}if(R){R.setAttrs({rotation:s,visible:!0});let a=R.getAttr("tween");if(a)a.reset(),a.destroy(),setTimeout(()=>R.setAttr("tween",null))}return c};function Sc(){let{appState:c}=s1(),{meta:o,file:l}=l1(),s=c1(null),Z=zc(()=>{if(!c.value)return;if(!s.value?.tanks)return;$(s.value.tanks.player,-180,180,-135)?.setAttrs({name:l.value.name,zIndex:3}),$(s.value.tanks.red,180,-180,45)?.setAttr("visible",c.value.enemies>0),$(s.value.tanks.yellow,180,180,135)?.setAttr("visible",c.value.enemies>1),$(s.value.tanks.green,-180,-180,-45)?.setAttr("visible",c.value.enemies>2),s.value.updateMonitors(o.value.monitors)},[]);H(async()=>{s.value?.updateMonitors(o.value.monitors)},[o.value]),H(async()=>{if(!s.value)return;if(c.value?.running===!0){let a="";a+=`const tankUtils = runtime.tankUtils;
`,a+=`(target => {
${l.value.script}})(runtime.tanks.player);

`;for(let k=1;k<=c.value.enemies;k++){let D=c.value.tanks[k];a+=`(target => {
${R1[D.ai]}})(runtime.tanks.${D.id});

`}s.value.launch(`${a}runtime.start();`)}else if(c.value?.running===!1){if(s.value.running)s.value.stop(),Z()}},[c.value?.running]),H(Z,[s.value,c.value?.enemies]);let R=zc((a)=>{let k=(w)=>{Z1({tanks:w.map((r,m)=>({...c.value.tanks[m],health:r}))})};s.value=new t(a,k);let D=0.5,I=D*a.scaleY();return o1.Image.fromURL(Kc,(w)=>{w.setAttrs({x:0,y:0,offsetX:w.width()/2,offsetY:w.height()/2,scaleX:D,scaleY:I}),s.value.backdropLayer.add(w)}),s.value.spritesLayer.add(Q(D,I,"player",!0)),s.value.spritesLayer.add(Q(D,I,"red")),s.value.spritesLayer.add(Q(D,I,"yellow")),s.value.spritesLayer.add(Q(D,I,"green")),s.value.on("frame",()=>s.value.drives()),()=>{s.value=null}},[]);return k1(a1,{zoom:c.value?.stageSize!=="large"?0.8:1,width:480,height:480,onRuntime:R})}import{useCallback as e}from"preact/hooks";import{classNames as Uc}from"@blockcode/utils";import{useAppContext as _1,translate as L,setAppState as cc,ToggleButtons as b1}from"@blockcode/core";function p(c){let o=globalThis.document,l=o.createElement("style");l.appendChild(o.createTextNode(c)),o.head.append(l)}p(".bEtDYa_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space)0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.bEtDYa_green-flag,.bEtDYa_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.bEtDYa_green-flag:hover,.bEtDYa_stop-all:hover{background:var(--theme-light-transparent)}.bEtDYa_green-flag.bEtDYa_actived{background:var(--theme-transparent)}.bEtDYa_stop-all{opacity:.5}.bEtDYa_stop-all.bEtDYa_actived{opacity:1}.bEtDYa_green-flag.bEtDYa_disabled,.bEtDYa_stop-all.bEtDYa_disabled{opacity:.5}.bEtDYa_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.bEtDYa_space{margin-left:.2rem}.bEtDYa_toolbar-buttons-group{display:flex}.bEtDYa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.bEtDYa_group-button{border-left:none;border-radius:0}.bEtDYa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var d={toolbarWrapper:"bEtDYa_toolbar-wrapper",groupButtonFirst:"bEtDYa_group-button-first",groupButton:"bEtDYa_group-button",groupButtonLast:"bEtDYa_group-button-last",actived:"bEtDYa_actived",disabled:"bEtDYa_disabled",stopAll:"bEtDYa_stop-all",toolbarButton:"bEtDYa_toolbar-button",greenFlag:"bEtDYa_green-flag",space:"bEtDYa_space",toolbarButtonsGroup:"bEtDYa_toolbar-buttons-group"};var Cc="./assets/icon-green-flag-tz1g77je.svg";var nc="./assets/icon-stop-all-zrx3gxr1.svg";var Gc="./assets/icon-small-stage-anyzs7w9.svg";var jc="./assets/icon-large-stage-f6hyxzdr.svg";import{jsx as O,jsxs as Pc}from"preact/jsx-runtime";function tc(){let{appState:c}=_1(),o=e(()=>{let Z=c.value?.tanks.map((R)=>({...R,health:100}));cc({tanks:Z,running:!!Z})},[]),l=e(()=>{cc("running",!1)},[]),s=e((Z)=>{cc("stageSize",Z)},[]);return Pc("div",{className:d.toolbarWrapper,children:[Pc("div",{className:d.toolbarButtonsGroup,children:[O("img",{className:Uc(d.greenFlag,{[d.actived]:c.value?.running}),src:Cc,title:L("tankwar.player.greenFlag","Fight"),onClick:o}),O("img",{className:Uc(d.stopAll,{[d.actived]:c.value?.running}),src:nc,title:L("tankwar.player.stopAll","Stop"),onClick:l})]}),O("div",{className:d.toolbarButtonsGroup,children:O(b1,{items:[{icon:Gc,title:L("tankwar.stage.small","Switch to small stage"),value:"small"},{icon:jc,title:L("tankwar.stage.large","Switch to large stage"),value:"large"}],value:c.value?.stageSize??"small",onChange:s})})]})}p(".ReTkdW_stage-wrapper{position:relative}.ReTkdW_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}.ReTkdW_small{width:386px;height:386px}");var M={stage:"ReTkdW_stage",stageWrapper:"ReTkdW_stage-wrapper",small:"ReTkdW_small"};import{jsx as oc,jsxs as q1}from"preact/jsx-runtime";function Hc(){let{appState:c}=m1();return q1("div",{className:M.stageWrapper,children:[oc(tc,{}),oc("div",{className:N1(M.stage,{[M.small]:c.value?.stageSize!=="large"}),children:oc(Sc,{})})]})}import{useAppContext as d1,useProjectContext as g1,translate as q,setAppState as so}from"@blockcode/core";import{classNames as sc}from"@blockcode/utils";import{Label as x,BufferedInput as u1,ToggleButtons as lc}from"@blockcode/core";p("._OnGaW_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}._OnGaW_row{justify-content:space-between;margin-top:.5rem;display:flex}._OnGaW_row-primary{margin-top:0}._OnGaW_group{flex-direction:row;align-items:center;display:inline-flex}._OnGaW_full-input{flex:1}._OnGaW_name-input{width:8rem}._OnGaW_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}._OnGaW_button-icon{margin:auto}._OnGaW_space{margin-left:.2rem}._OnGaW_toolbar-button-group{display:flex}._OnGaW_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._OnGaW_group-button{border-left:none;border-radius:0}._OnGaW_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._OnGaW_button-text{flex:auto}._OnGaW_group-button-toggled-on ._OnGaW_button-text{color:#4c97ff}._OnGaW_tank-image{width:1.65rem}._OnGaW_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}._OnGaW_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress)\"% \";height:20px;width:calc(12rem*var(--percent,0)/100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;font-size:12px;line-height:20px;display:block;overflow:hidden}._OnGaW_health-progress._OnGaW_small{width:8rem}._OnGaW_health-progress._OnGaW_small:before{width:calc(8rem*var(--percent,0)/100)}");var N={buttonText:"_OnGaW_button-text",toolbarButtonGroup:"_OnGaW_toolbar-button-group",groupButtonToggledOn:"_OnGaW_group-button-toggled-on",groupButton:"_OnGaW_group-button",stageInfoWrapper:"_OnGaW_stage-info-wrapper",nameInput:"_OnGaW_name-input",space:"_OnGaW_space",tankImage:"_OnGaW_tank-image",healthProgress:"_OnGaW_health-progress",group:"_OnGaW_group",small:"_OnGaW_small",rowPrimary:"_OnGaW_row-primary",buttonIcon:"_OnGaW_button-icon",fullInput:"_OnGaW_full-input",button:"_OnGaW_button",row:"_OnGaW_row",groupButtonLast:"_OnGaW_group-button-last",groupButtonFirst:"_OnGaW_group-button-first"};var ec="./assets/icon-tank-red-tq1cemhn.png";var co="./assets/icon-tank-yellow-5vq6mndw.png";var oo="./assets/icon-tank-green-4r293h2s.png";import{useCallback as Zc,useMemo as M0}from"preact/hooks";import{jsx as b,jsxs as y}from"preact/jsx-runtime";var x1=[ec,co,oo];function lo(){let{appState:c}=d1(),{file:o,setFile:l}=g1(),s=Zc((a)=>{l({name:a})},[]),Z=Zc((a)=>{so("enemies",a)},[]),R=Zc((a)=>(k)=>{so("tanks",c.value.tanks.map((D)=>a===D.id?{...D,ai:k}:D))},[]);return y("div",{className:N.stageInfoWrapper,children:[y("div",{className:sc(N.row,N.rowPrimary),children:[b(x,{text:q("tankwar.stageInfo.player","Player"),children:b(u1,{disabled:c.value?.running,className:N.nameInput,placeholder:q("tankwar.stageInfo.nickname","Nickname"),onSubmit:s,value:o.value.name})}),b(x,{secondary:!0,className:N.health,text:q("tankwar.stageInfo.health","Health"),children:b("div",{className:sc(N.healthProgress,{[N.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?c.value?.tanks[0]?.health:100}`})})]}),y("div",{className:N.row,children:[b(x,{secondary:!0,text:q("tankwar.stageInfo.enemies","Enemies"),children:b(lc,{disabled:c.value?.running,items:[{value:0,title:"0"},{value:1,title:"1"},{value:3,title:"3"}],value:c.value?.enemies??1,onChange:Z})}),c.value?.enemies>0&&b(x,{secondary:!0,children:b(lc,{disabled:c.value?.running,items:[{value:"local",title:q("tankwar.stageInfo.mode.local","Local AI")},{value:"remote",title:q("tankwar.stageInfo.mode.remote","Remote Players"),disabled:!0}],value:"local"})})]}),c.value?.tanks.slice(1,c.value?.enemies+1)?.map((a,k)=>y("div",{className:N.row,children:[b(x,{secondary:!0,children:b("img",{className:N.tankImage,src:x1[k],alt:a.name,title:a.name})}),b(x,{secondary:!0,children:b("div",{className:sc(N.healthProgress,{[N.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?a.health:100}`})}),b(x,{secondary:!0,text:q("tankwar.stageInfo.ai","AI"),children:b(lc,{disabled:c.value?.running,items:[{value:"simple",title:q("tankwar.stageInfo.ai.simple","Simple")},{value:"medium",title:q("tankwar.stageInfo.ai.medium","Medium")},{value:"senior",title:q("tankwar.stageInfo.ai.senior","Senior")}],value:a.ai??"simple",onChange:R(a.id)})})]},k))]})}p(".yg_RPq_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.yg_RPq_stage-wrapper{display:flex}.yg_RPq_selector-wrapper{height:100%;margin-top:var(--space);flex-direction:row;display:flex}");var ac={stageWrapper:"yg_RPq_stage-wrapper",selectorWrapper:"yg_RPq_selector-wrapper",sidebarWrapper:"yg_RPq_sidebar-wrapper"};import{jsx as Zo,jsxs as h1}from"preact/jsx-runtime";function ao(){return r1(()=>{E1({enemies:1,tanks:[{id:"player",name:B("tankwar.stageInfo.player","Player"),health:100},{id:"red",name:B("tankwar.stageInfo.enemy.red","Red"),health:100,ai:"simple"},{id:"yellow",name:B("tankwar.stageInfo.enemy.yellow","Yellow"),health:100,ai:"simple"},{id:"green",name:B("tankwar.stageInfo.enemy.green","Green"),health:100,ai:"simple"}]})},[]),h1("div",{className:ac.sidebarWrapper,children:[Zo(Hc,{className:ac.stageWrapper}),Zo(lo,{})]})}import{Text as v1}from"@blockcode/core";import{jsx as Y1}from"preact/jsx-runtime";var Ro={files:[{id:"player",name:Y1(v1,{id:"tankwar.stageInfo.player",defaultMessage:"Player"})}]};import{jsx as Il}from"preact/jsx-runtime";var Dl={onNew(){return Ro},onSave(c){return{files:c.map((o)=>({id:o.id,name:o.name,xml:o.xml}))}},async onThumb(){let c=document.querySelector(".konvajs-content");return(await J1(c))?.toDataURL()},onUndo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!1)},onRedo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!0)},onEnableUndo(){let c=V.getMainWorkspace();return c?.undoStack_&&c.undoStack_.length!==0},onEnableRedo(){let c=V.getMainWorkspace();return c?.redoStack_&&c.redoStack_.length!==0},tabs:[{...X1,Content:mc}].concat([]),docks:[{expand:"right",Content:ao}]};export{Dl as default};
