import{addLocalesMessages as Io}from"@blockcode/core";var Rc={"tankwar.player.greenFlag":"Fight","tankwar.player.stopAll":"Stop","tankwar.stage.small":"Switch to small stage","tankwar.stage.large":"Switch to large stage","tankwar.stageInfo.player":"Player","tankwar.stageInfo.nickname":"Nickname","tankwar.stageInfo.enemies":"Enemies","tankwar.stageInfo.health":"Health","tankwar.stageInfo.enemy.red":"Red","tankwar.stageInfo.enemy.yellow":"Yellow","tankwar.stageInfo.enemy.green":"Green","tankwar.stageInfo.mode.local":"Local AI","tankwar.stageInfo.mode.remote":"Remote Players","tankwar.stageInfo.ai":"AI","tankwar.stageInfo.ai.simple":"Simple","tankwar.stageInfo.ai.medium":"Medium","tankwar.stageInfo.ai.senior":"Senior","tankwar.blocks.motion_attack":"fire in direction %1 at %2 steps","tankwar.blocks.motion_move":"forward in direction %1 at %2 % speed","tankwar.blocks.motion_setspeed":"set speed to %1 %","tankwar.blocks.motion_stop":"stop","tankwar.blocks.motion_speed":"speed","tankwar.blocks.sensing_scanwidth":"set scan width to %1","tankwar.blocks.sensing_scan":"scan for enemy in direction %1?","tankwar.blocks.sensing_distance":"measure distance of enemy in direction %1","tankwar.blocks.sensing_health":"health","tankwar.blocks.event_damage":"damage"};var wc={"tankwar.player.greenFlag":"开战","tankwar.player.stopAll":"停战","tankwar.stage.small":"缩小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"昵称","tankwar.stageInfo.enemies":"敌方数量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"红","tankwar.stageInfo.enemy.yellow":"黄","tankwar.stageInfo.enemy.green":"绿","tankwar.stageInfo.mode.local":"本机 AI","tankwar.stageInfo.mode.remote":"联网玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"简单","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高级","tankwar.blocks.motion_attack":"面向 %1 方向距离 %2 步发射炮弹","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前进","tankwar.blocks.motion_setspeed":"将速度设为 %1 %","tankwar.blocks.motion_stop":"停止前进","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"将雷达扫描宽度设为 %1","tankwar.blocks.sensing_scan":"雷达扫描 %1 方向有敌人？","tankwar.blocks.sensing_distance":"雷达测量 %1 方向敌人的距离","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"伤害"};var Dc={"tankwar.player.greenFlag":"開戰","tankwar.player.stopAll":"停戰","tankwar.stage.small":"縮小舞台","tankwar.stage.large":"放大舞台","tankwar.stageInfo.player":"玩家","tankwar.stageInfo.nickname":"暱稱","tankwar.stageInfo.enemies":"敵方數量","tankwar.stageInfo.health":"血量","tankwar.stageInfo.enemy.red":"紅","tankwar.stageInfo.enemy.yellow":"黃","tankwar.stageInfo.enemy.green":"綠","tankwar.stageInfo.mode.local":"本機 AI","tankwar.stageInfo.mode.remote":"聯網玩家","tankwar.stageInfo.ai":"AI 策略","tankwar.stageInfo.ai.simple":"簡單","tankwar.stageInfo.ai.medium":"中等","tankwar.stageInfo.ai.senior":"高級","tankwar.blocks.motion_attack":"面向 %1 方向距離 %2 步發射炮彈","tankwar.blocks.motion_move":"以 %2 % 速度面向 %1 方向前進","tankwar.blocks.motion_setspeed":"將速度設為 %1 %","tankwar.blocks.motion_stop":"停止前進","tankwar.blocks.motion_speed":"速度","tankwar.blocks.sensing_scanwidth":"將雷達掃描寬度設為 %1","tankwar.blocks.sensing_scan":"雷達掃描 %1 方向有敵人？","tankwar.blocks.sensing_distance":"雷達測量 %1 方向敵人的距離","tankwar.blocks.sensing_health":"血量","tankwar.blocks.event_damage":"傷害"};Io({en:Rc,"zh-Hans":wc,"zh-Hant":Dc});import{html2canvas as Ws}from"@blockcode/utils";import{ScratchBlocks as V,blocksTab as As,codeReviewTab as Za}from"@blockcode/blocks";import{CodeReview as Ra}from"@blockcode/blocks";import{BlocksEditor as _o}from"@blockcode/blocks";import{translate as Y,themeColors as K}from"@blockcode/core";import{ScratchBlocks as E}from"@blockcode/blocks";var Ic=()=>({id:"motion",name:"%{BKY_CATEGORY_MOTION}",themeColor:K.blocks.motion.primary,inputColor:K.blocks.motion.secondary,otherColor:K.blocks.motion.tertiary,order:0,blocks:[{id:"attack",text:Y("tankwar.blocks.motion_attack","fire in direction %1 at %2 steps"),inputs:{DIRECTION:{type:"angle",defaultValue:90},DISTANCE:{shadow:"distancevalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",a=this.valueToCode(c,"DISTANCE",this.ORDER_NONE)||"100";return`await tankUtils.attack(userscript, target, ${o}, ${a});
`}},{id:"move",text:Y("tankwar.blocks.motion_move","forward in direction %1 at %2 % speed"),inputs:{DIRECTION:{type:"angle",defaultValue:90},SPEED:{shadow:"speedvalue",defaultValue:100}},emu(c){let o=this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0",a=this.valueToCode(c,"SPEED",this.ORDER_NONE)||"100";return`await tankUtils.move(userscript, target, ${o}, ${a});
`}},"---",{id:"turnright",text:E.Msg.MOTION_TURNRIGHT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-right.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnRight(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"turnleft",text:E.Msg.MOTION_TURNLEFT,inputs:{IMAGE:{type:"image",src:"./assets/blocks-media/rotate-left.svg"},DEGREES:{type:"number",defaultValue:15}},emu(c){return`await tankUtils.turnLeft(userscript, target, ${this.valueToCode(c,"DEGREES",this.ORDER_NONE)||0});
`}},{id:"pointindirection",text:E.Msg.MOTION_POINTINDIRECTION,inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return`await tankUtils.setDirection(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||"0"});
`}},"---",{id:"setspeed",text:Y("tankwar.blocks.motion_setspeed","set speed to %1 %"),inputs:{SPEED:{shadow:"speedvalue",defaultValue:50}},emu(c){return`tankUtils.setSpeed(userscript, target, ${this.valueToCode(c,"SPEED",this.ORDER_NONE)||"0"});
`}},{id:"stop",text:Y("tankwar.blocks.motion_stop","stop"),emu(c){return`tankUtils.stop(target);
`}},"---",{id:"speed",text:Y("tankwar.blocks.motion_speed","speed"),output:"number",monitoring:!0,emu(c){return["tankUtils.getSpeed(target)",this.ORDER_FUNCTION_CALL]}},{id:"xposition",text:E.Msg.MOTION_XPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.x())",this.ORDER_FUNCTION_CALL]}},{id:"yposition",text:E.Msg.MOTION_YPOSITION,output:"number",monitoring:!0,emu(c){return["Math.round(target.y())",this.ORDER_FUNCTION_CALL]}},{id:"direction",text:E.Msg.MOTION_DIRECTION,output:"number",monitoring:!0,emu(c){return["tankUtils.getDirection(target)",this.ORDER_FUNCTION_CALL]}},{id:"distancevalue",shadow:!0,output:"number",inputs:{DISTANCE:{type:"slider",min:50,max:200}},emu(c){return[c.getFieldValue("DISTANCE")||0,this.ORDER_NONE]}},{id:"speedvalue",shadow:!0,output:"number",inputs:{SPEED:{type:"slider",min:-100,max:100}},emu(c){return[c.getFieldValue("SPEED")||0,this.ORDER_NONE]}}]});import{translate as fo,themeColors as z}from"@blockcode/core";import{ScratchBlocks as S}from"@blockcode/blocks";var fc=()=>({id:"event",name:"%{BKY_CATEGORY_EVENTS}",themeColor:z.blocks.events.primary,inputColor:z.blocks.events.secondary,otherColor:z.blocks.events.tertiary,blocks:[{id:"whenflagclicked",text:S.Msg.EVENT_WHENFLAGCLICKED,hat:!0,inputs:{FLAG:{type:"image",src:"./assets/blocks-media/green-flag.svg"}}},"---",{id:"whengreaterthan",text:S.Msg.EVENT_WHENGREATERTHAN,hat:!0,inputs:{WHENGREATERTHANMENU:{type:"string",menu:[[S.Msg.EVENT_WHENGREATERTHAN_TIMER,"TIMER"],[fo("tankwar.blocks.event_damage","damage"),"DAMAGE"]]},VALUE:{type:"number",defaultValue:10}}}]});import{translate as W,themeColors as t}from"@blockcode/core";import{ScratchBlocks as ic}from"@blockcode/blocks";var _c=()=>({id:"sensing",name:"%{BKY_CATEGORY_SENSING}",themeColor:t.blocks.sensing.primary,inputColor:t.blocks.sensing.secondary,otherColor:t.blocks.sensing.tertiary,blocks:[{id:"scan",text:W("tankwar.blocks.sensing_scan","scan for enemy in direction %1?"),output:"boolean",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}) !== Infinity)`,this.ORDER_EQUALITY]}},{id:"scandistance",text:W("tankwar.blocks.sensing_distance","measure distance of enemy in direction %1"),output:"number",inputs:{DIRECTION:{type:"angle",defaultValue:90}},emu(c){return[`(await tankUtils.scan(userscript, target, ${this.valueToCode(c,"DIRECTION",this.ORDER_NONE)||90}))`,this.ORDER_FUNCTION_CALL]}},"---",{id:"scanwidth",text:W("tankwar.blocks.sensing_scanwidth","set scan width to %1"),inputs:{WIDTH:{type:"number",defaultValue:5}},emu(c){return`target.setAttr('scanWidth', ${this.valueToCode(c,"WIDTH",this.ORDER_NONE)||5});
`}},"---",{id:"health",text:W("tankwar.blocks.sensing_health","health"),output:"number",monitoring:!0,emu(c){return["target.getAttr('health')",this.ORDER_FUNCTION_CALL]}},"---",{id:"timer",text:ic.Msg.SENSING_TIMER,output:"number",monitoring:!0,emu(c){return["runtime.times",this.ORDER_MEMBER]}},{id:"resettimer",text:ic.Msg.SENSING_RESETTIMER,emu(c){return`runtime.resetTimes()
`}}]});import{EmulatorGenerator as io}from"@blockcode/blocks";class A extends io{}function bc(){let c=Ic(),o=fc(),a=_c();return[c,o,a]}import{jsx as mo}from"preact/jsx-runtime";var bo=new A;function mc(){return mo(_o,{enableMonitor:!0,disableExtensionButton:!0,emulator:bo,onBuildinExtensions:bc})}import{useEffect as vs}from"preact/hooks";import{translate as B,setAppState as Ys}from"@blockcode/core";import{classNames as rs}from"@blockcode/utils";import{useAppContext as ps}from"@blockcode/core";import{useCallback as Kc,useEffect as P}from"preact/hooks";import{useSignal as as}from"@preact/signals";import{Konva as ls}from"@blockcode/utils";import{useAppContext as Zs,useProjectContext as ks,setAppState as Rs}from"@blockcode/core";import{Emulator as ws}from"@blockcode/blocks";import{MathUtils as Ko,ScriptController as zo}from"@blockcode/utils";import{Runtime as So}from"@blockcode/blocks";var G=Symbol.for,g=Symbol("kCapture"),qc=G("events.errorMonitor"),No=Symbol("events.maxEventTargetListeners"),ro=Symbol("events.maxEventTargetListenersWarned"),Nc=G("nodejs.rejection"),po=G("nodejs.rejection"),rc=Array.prototype.slice,d=10,q=function(c){if(this._events===void 0||this._events===this.__proto__._events)this._events={__proto__:null},this._eventsCount=0;if(this._maxListeners??=void 0,this[g]=c?.captureRejections?Boolean(c?.captureRejections):f[g])this.emit=Fo},f=q.prototype={};f._events=void 0;f._eventsCount=0;f._maxListeners=void 0;f.setMaxListeners=function(c){return j(c,"setMaxListeners",0),this._maxListeners=c,this};f.constructor=q;f.getMaxListeners=function(){return this?._maxListeners??d};function uc(c,o){var{_events:a}=c;if(o[0]??=Error("Unhandled error."),!a)throw o[0];var s=a[qc];if(s)for(var l of rc.call(s))l.apply(c,o);var k=a.error;if(!k)throw o[0];for(var l of rc.call(k))l.apply(c,o);return!0}function qo(c,o,a,s){o.then(void 0,function(l){queueMicrotask(()=>uo(c,l,a,s))})}function uo(c,o,a,s){if(typeof c[Nc]==="function")c[Nc](o,a,...s);else try{c[g]=!1,c.emit("error",o)}finally{c[g]=!0}}var go=function(c,...o){if(c==="error")return uc(this,o);var{_events:a}=this;if(a===void 0)return!1;var s=a[c];if(s===void 0)return!1;let l=s.length>1?s.slice():s;for(let k=0,{length:Z}=l;k<Z;k++){let R=l[k];switch(o.length){case 0:R.call(this);break;case 1:R.call(this,o[0]);break;case 2:R.call(this,o[0],o[1]);break;case 3:R.call(this,o[0],o[1],o[2]);break;default:R.apply(this,o);break}}return!0},Fo=function(c,...o){if(c==="error")return uc(this,o);var{_events:a}=this;if(a===void 0)return!1;var s=a[c];if(s===void 0)return!1;let l=s.length>1?s.slice():s;for(let k=0,{length:Z}=l;k<Z;k++){let R=l[k],w;switch(o.length){case 0:w=R.call(this);break;case 1:w=R.call(this,o[0]);break;case 2:w=R.call(this,o[0],o[1]);break;case 3:w=R.call(this,o[0],o[1],o[2]);break;default:w=R.apply(this,o);break}if(w!==void 0&&typeof w?.then==="function"&&w.then===Promise.prototype.then)qo(this,w,c,o)}return!0};f.emit=go;f.addListener=function(c,o){J(o);var a=this._events;if(!a)a=this._events={__proto__:null},this._eventsCount=0;else if(a.newListener)this.emit("newListener",c,o.listener??o);var s=a[c];if(!s)a[c]=[o],this._eventsCount++;else{s.push(o);var l=this._maxListeners??d;if(l>0&&s.length>l&&!s.warned)gc(this,c,s)}return this};f.on=f.addListener;f.prependListener=function(c,o){J(o);var a=this._events;if(!a)a=this._events={__proto__:null},this._eventsCount=0;else if(a.newListener)this.emit("newListener",c,o.listener??o);var s=a[c];if(!s)a[c]=[o],this._eventsCount++;else{s.unshift(o);var l=this._maxListeners??d;if(l>0&&s.length>l&&!s.warned)gc(this,c,s)}return this};function gc(c,o,a){a.warned=!0;let s=Error(`Possible EventEmitter memory leak detected. ${a.length} ${String(o)} listeners added to [${c.constructor.name}]. Use emitter.setMaxListeners() to increase limit`);s.name="MaxListenersExceededWarning",s.emitter=c,s.type=o,s.count=a.length,console.warn(s)}function dc(c,o,...a){this.removeListener(c,o),o.apply(this,a)}f.once=function(c,o){J(o);let a=dc.bind(this,c,o);return a.listener=o,this.addListener(c,a),this};f.prependOnceListener=function(c,o){J(o);let a=dc.bind(this,c,o);return a.listener=o,this.prependListener(c,a),this};f.removeListener=function(c,o){J(o);var{_events:a}=this;if(!a)return this;var s=a[c];if(!s)return this;var l=s.length;let k=-1;for(let Z=l-1;Z>=0;Z--)if(s[Z]===o||s[Z].listener===o){k=Z;break}if(k<0)return this;if(k===0)s.shift();else s.splice(k,1);if(s.length===0)delete a[c],this._eventsCount--;return this};f.off=f.removeListener;f.removeAllListeners=function(c){var{_events:o}=this;if(c&&o){if(o[c])delete o[c],this._eventsCount--}else this._events={__proto__:null};return this};f.listeners=function(c){var{_events:o}=this;if(!o)return[];var a=o[c];if(!a)return[];return a.map((s)=>s.listener??s)};f.rawListeners=function(c){var{_events:o}=this;if(!o)return[];var a=o[c];if(!a)return[];return a.slice()};f.listenerCount=function(c){var{_events:o}=this;if(!o)return 0;return o[c]?.length??0};f.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};f[g]=!1;function xo(c,o,a){var s=a?.signal;if(Fc(s,"options.signal"),s?.aborted)throw new C(void 0,{cause:s?.reason});let{resolve:l,reject:k,promise:Z}=$newPromiseCapability(Promise),R=(D)=>{if(c.removeListener(o,w),s!=null)T(s,"abort",I);k(D)},w=(...D)=>{if(typeof c.removeListener==="function")c.removeListener("error",R);if(s!=null)T(s,"abort",I);l(D)};if(pc(c,o,w,{once:!0}),o!=="error"&&typeof c.once==="function")c.once("error",R);function I(){T(c,o,w),T(c,"error",R),k(new C(void 0,{cause:s?.reason}))}if(s!=null)pc(s,"abort",I,{once:!0});return Z}function Eo(c,o){return c.listeners(o)}function ho(c,...o){j(c,"setMaxListeners",0);var a;if(o&&(a=o.length))for(let s=0;s<a;s++)o[s].setMaxListeners(c);else d=c}function vo(c,o){return c.listenerCount(o)}function T(c,o,a,s){if(typeof c.removeListener==="function")c.removeListener(o,a);else c.removeEventListener(o,a,s)}function pc(c,o,a,s){if(typeof c.on==="function")if(s.once)c.once(o,a);else c.on(o,a);else c.addEventListener(o,a,s)}class C extends Error{constructor(c="The operation was aborted",o=void 0){if(o!==void 0&&typeof o!=="object")throw h("options","Object",o);super(c,o);this.code="ABORT_ERR",this.name="AbortError"}}function h(c,o,a){let s=TypeError(`The "${c}" argument must be of type ${o}. Received ${a}`);return s.code="ERR_INVALID_ARG_TYPE",s}function Yo(c,o,a){let s=RangeError(`The "${c}" argument is out of range. It must be ${o}. Received ${a}`);return s.code="ERR_OUT_OF_RANGE",s}function Fc(c,o){if(c!==void 0&&(c===null||typeof c!=="object"||!("aborted"in c)))throw h(o,"AbortSignal",c)}function j(c,o,a,s){if(typeof c!=="number")throw h(o,"number",c);if(a!=null&&c<a||s!=null&&c>s||(a!=null||s!=null)&&Number.isNaN(c))throw Yo(o,`${a!=null?`>= ${a}`:""}${a!=null&&s!=null?" && ":""}${s!=null?`<= ${s}`:""}`,c)}function J(c){if(typeof c!=="function")throw TypeError("The listener must be a function")}function Jo(c,o){if(typeof c!=="boolean")throw h(o,"boolean",c)}function Xo(c){return c?._maxListeners??d}function Qo(c,o){if(c===void 0)throw h("signal","AbortSignal",c);if(Fc(c,"signal"),typeof o!=="function")throw h("listener","function",o);let a;if(c.aborted)queueMicrotask(()=>o());else c.addEventListener("abort",o,{__proto__:null,once:!0}),a=()=>{c.removeEventListener("abort",o)};return{__proto__:null,[Symbol.dispose](){a?.()}}}Object.defineProperties(q,{captureRejections:{get(){return f[g]},set(c){Jo(c,"EventEmitter.captureRejections"),f[g]=c},enumerable:!0},defaultMaxListeners:{enumerable:!0,get:()=>{return d},set:(c)=>{j(c,"defaultMaxListeners",0),d=c}},kMaxEventTargetListeners:{value:No,enumerable:!1,configurable:!1,writable:!1},kMaxEventTargetListenersWarned:{value:ro,enumerable:!1,configurable:!1,writable:!1}});Object.assign(q,{once:xo,getEventListeners:Eo,getMaxListeners:Xo,setMaxListeners:ho,EventEmitter:q,usingDomains:!1,captureRejectionSymbol:po,errorMonitor:qc,addAbortListener:Qo,init:q,listenerCount:vo});import{sleep as To,MathUtils as i,Konva as v,KonvaUtils as $o}from"@blockcode/utils";var xc="./assets/bullet-82yt94q7.png";var Ec="./assets/boom-0p27yacb.png";var Lo=2,hc=0.013888888888888888,Mo=1000,Oo=50,yo=200,vc=20,Bo=200,Vo=2,no=30,Yc=400;class U extends q{constructor(c){super();this._runtime=c,this._speedRatio=Lo*c.fps,this._bulletSpeed=Bo/c.fps,this._bulletImage=new Image,this._bulletImage.src=xc,this._boomImage=new Image,this._boomImage.src=Ec}get runtime(){return this._runtime}get running(){return this.runtime.running}get stage(){return this.runtime.stage}get backdropLayer(){return this.runtime.backdropLayer}get paintLayer(){return this.runtime.paintLayer}get spritesLayer(){return this.runtime.spritesLayer}get boardLayer(){return this.runtime.boardLayer}get tanks(){return this.runtime.tanks}_findNearestEdge(c){let o=c.getClientRect(),a=this.stage.width(),s=this.stage.height(),l=o.x,k=o.y,Z=a-(o.x+o.width),R=s-(o.y+o.height),w,I=1/0;if(l<I)I=l,w="left";if(k<I)I=k,w="top";if(Z<I)I=Z,w="right";if(R<I)I=R,w="bottom";if(I>0)return;return w}drive(c,o){if(c.aborted)return;if(!o.visible())return;let a=o.getAttr("tank"),s=o.getAttr("turret");if(o.getAttr("health")<=0){o.getAttr("broken").visible(!0),a.visible(!1),s.visible(!1);return}let l=a.rotation();if(!o.getAttr("cooldown")&&!s.getAttr("tween")&&l!==s.rotation())c.execute(this._turn.bind(this),s,l).then(()=>{let m=s.getAttr("tween");if(s.setAttr("tween",null),m)m.pause();if(!this.running)s.rotation(a.rotation())});if(this._findNearestEdge(a))this.stop(o);this.spritesLayer.children.some((m)=>{if(m===o||!m.visible())return;if($o.checkConvexHullsCollision(o,m))this.stop(o)});let Z=o.getAttr("speed");if(!Z)return;let R=i.degToRad(l-90),w=-Z*Math.cos(R),I=-Z*Math.sin(R),D=o.x()+w,x=o.y()+I;o.position({x:D,y:x}),this.runtime.setMonitorValueById(`${o.id()}.motion_xposition`,Math.round(D)),this.runtime.setMonitorValueById(`${o.id()}.motion_yposition`,Math.round(x))}move(c,o,a,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;return this.setSpeed(c,o,s),this.setDirection(c,o,a)}_turn(c,o){if(!c.visible())return;if(c.getAttr("tween"))return;let a=Math.abs(o-c.rotation());if(a>180)a=360-a,o=c.rotation()+a;return new Promise((s)=>{let l=new v.Tween({node:c,rotation:o,duration:hc*Math.abs(o-c.rotation()),easing:v.Easings.Linear,onFinish:()=>s(),onUpdate:()=>{let k=c.getAttr("tankUnit");if(c.hasName("tank"))this.runtime.setMonitorValueById(`${k.id()}.motion_direction`,this.getDirection(k))}});c.setAttr("tween",l),l.play()})}async setDirection(c,o,a){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=-i.toNumber(a),l=o.getAttr("tank");if(await c.scripter.execute(this._turn.bind(this),l,s),l.getAttr("tween")){let k=l.getAttr("tween");l.setAttr("tween",null),k.pause()}}getDirection(c){return Math.round(i.wrapClamp(-c.getAttr("tank").rotation(),-179,180))}turnRight(c,o,a){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=i.toNumber(a),l=-o.getAttr("tank").rotation()+s;return this.setDirection(c,o,l)}turnLeft(c,o,a){if(c.aborted)return;let s=i.toNumber(a);return this.turnRight(c,o,-s)}setSpeed(c,o,a){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=i.toNumber(a);o.setAttr("speed",s/this._speedRatio),this.runtime.setMonitorValueById(`${o.id()}.motion_speed`,Math.round(s))}getSpeed(c){let o=c.getAttr("speed");return Math.round(o*this._speedRatio)}stop(c){c.setAttr("speed",0),this.runtime.setMonitorValueById(`${c.id()}.motion_speed`,0)}_hit(c,o){if(!c.visible())return;if(c===o.getAttr("tankUnit"))return;let a=c.getAttr("tank"),s=c.position(),l=o.position(),k=i.distanceTo(s,l),Z=Math.min(a.width(),a.height())*a.scaleX();if(k<Z/2){let R=c.getAttr("health")-10;c.setAttr("health",R);return}if(k<Z/1.414215){let R=c.getAttr("health")-5;c.setAttr("health",R);return}}_boom(c){let o=new v.Sprite({x:c.x(),y:c.y(),name:"boom",image:this._boomImage,scale:c.scale(),rotation:c.rotation(),offsetX:this._boomImage.width/4/2,offsetY:this._boomImage.height/2,animation:"ready",animations:{boom:[80,0,80,80,160,0,80,80,240,0,80,80],ready:[0,0,80,80]},frameRate:6,frameIndex:0});return this.boardLayer.add(o),c.setAttr("boom",o),new Promise((a)=>{c.visible(!1),o.on("frameIndexChange.button",()=>{if(o.frameIndex()===2)setTimeout(a,1000/o.frameRate())}),o.animation("boom"),o.start(),this._hit(this.tanks.player,c),this._hit(this.tanks.red,c),this._hit(this.tanks.yellow,c),this._hit(this.tanks.green,c),this.runtime.watchHealth([this.tanks.player.getAttr("health"),this.tanks.red.getAttr("health"),this.tanks.yellow.getAttr("health"),this.tanks.green.getAttr("health")])})}_ballistic(c,o,a,s){return new Promise(async(l)=>{if(c.getAttr("cooldown"))clearTimeout(c.getAttr("cooldown"));c.setAttr("cooldown",setTimeout(()=>c.setAttr("cooldown",null),Mo));let k=i.degToRad(a-90);o.setAttrs({x:c.x()+-vc*Math.cos(k),y:c.y()+-vc*Math.sin(k),visible:!0});let Z=-s*Math.cos(k),R=-s*Math.sin(k),w=o.x()+Z,I=o.y()+R,D=s/this._bulletSpeed/this.runtime.fps,x=Date.now(),m=this._bulletSpeed/s/2,kc=new v.Tween({x:w,y:I,duration:D,node:o,easing:v.Easings.EaseInOut,onFinish:()=>l(),onUpdate:()=>{let n=o.scaleX()+m;if(Date.now()-x>D/2*1000)n=o.scaleX()-m;o.setAttrs({scaleX:n,scaleY:n})}});o.setAttr("tween",kc),kc.play()})}async attack(c,o,a,s){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let l=o.getAttr("tank"),k=o.getAttr("turret"),Z=c.scripter,R=-i.toNumber(a),w=i.clamp(i.toNumber(s),Oo,yo);if(k.getAttr("tween")){let D=k.getAttr("tween");k.setAttr("tween",null),D.pause()}if(await Z.execute(this._turn.bind(this),k,R),k.getAttr("tween")){let D=k.getAttr("tween");k.setAttr("tween",null),D.pause()}if(c.aborted)return;let I=new v.Image({tankUnit:o,name:"boom",image:this._bulletImage,offsetX:this._bulletImage.width/2,offsetY:this._bulletImage.height/2,scale:l.scale(),visible:!1});if(this.boardLayer.add(I),await Z.execute(this._ballistic.bind(this),o,I,R,w),I.getAttr("tween")){let D=I.getAttr("tween");I.setAttr("tween",null),D.pause()}if(c.aborted)return;if(await Z.execute(this._boom.bind(this),I),I.getAttr("boom")){let D=I.getAttr("boom");D.off(".button"),D.destroy(),I.destroy()}}_catch(c,o){if(!c.visible())return;let a=o.getAttr("tankUnit");if(c===a)return;let s=o.rotation(),l=s+o.angle(),k=Math.min(s,l),Z=Math.max(s,l),R=a.position(),w=c.position(),I=i.distanceTo(R,w),D=i.directionTo(R,w);if(D>k&&D<Z&&I<Yc)return I}async scan(c,o,a){if(c.aborted)return;if(!o.visible())return;if(o.getAttr("health")<=0)return;let s=-i.toNumber(a)+90,l=i.clamp(o.getAttr("scanWidth"),Vo,no),k=Yc,Z=o.getAttr("radar");Z.setAttrs({tankUnit:o,angle:l,radius:k,rotation:s-l/2,fillRadialGradientEndRadius:k*0.7,visible:!0}),await To(hc*l*1.5),Z.visible(!1);let R=this._catch(this.tanks.player,Z)??1/0,w=this._catch(this.tanks.red,Z)??1/0,I=this._catch(this.tanks.yellow,Z)??1/0,D=this._catch(this.tanks.green,Z)??1/0;return Math.min(R,w,I,D)}}class e extends So{constructor(c,o){super(c,!1);this._onWatchHealth=o,this._tankUtils=new U(this),this._tanks=new Proxy(c,{get:(a,s)=>c.findOne(`#${s}`)})}get tanks(){return this._tanks}get tankUtils(){return this._tankUtils}get watchHealth(){return this._onWatchHealth}_updateThresholds(){let c=this._thresholds.keys();for(let o of c){let[a,s]=o.split(">"),l;if(a==="TIMER")l=this.times>parseFloat(s);if(a==="DAMAGE")l=100-this.tanks.player.getAttr("health")>parseFloat(s);if(typeof l==="boolean"){if(l&&!this._thresholds.get(o))this.call(`threshold:${o}`);this._thresholds.set(o,l)}}this.setMonitorValueById("sensing_health",this.tanks.player.getAttr("health")),this.setMonitorValueById("sensing_timer",this.times)}stop(){this.querySelectorAll(".boom").forEach((c)=>c.destroy()),super.stop()}drives(){let c=new zo;this.tankUtils.drive(c,this.tanks.player),this.tankUtils.drive(c,this.tanks.red),this.tankUtils.drive(c,this.tanks.yellow),this.tankUtils.drive(c,this.tanks.green)}setMonitorValue(c,o){if(c){let a=c.getAttr("monitor");if(!o){let s=this.querySelector(`#${a.groupId}`);if(s)switch(a.id){case"motion_xposition":o=Math.round(s.x());break;case"motion_yposition":o=Math.round(s.y());break;case"motion_direction":o=Math.round(Ko.wrapClamp(-s.getAttr("tank").rotation(),-179,180));break;default:o=0;break}}super.setMonitorValue(c,o)}}}import{Konva as X,KonvaUtils as os}from"@blockcode/utils";var Jc="./assets/tank-blue-b8ae4cvd.png";var Xc="./assets/turret-blue-dyrb04zn.png";var Qc="./assets/tank-red-ns7w7tad.png";var Wc="./assets/turret-red-ndwfv9ra.png";var Ac="./assets/tank-yellow-0ggp5pb0.png";var Tc="./assets/turret-yellow-hzayg6vn.png";var $c="./assets/tank-green-raz947mc.png";var Lc="./assets/turret-green-mg7ymk6e.png";var Mc="./assets/broken-0zqvhcjc.png";var r=(c)=>{return new Promise((o)=>{let a=new Image;a.src=c,a.onload=()=>o(a)})},Oc={player:{tank:r(Jc),turret:r(Xc)},red:{tank:r(Qc),turret:r(Wc)},yellow:{tank:r(Ac),turret:r(Tc)},green:{tank:r($c),turret:r(Lc)},broken:r(Mc)};function Q(c,o,a,s=!1){let l=new X.Group({id:a,visible:s}),k=Oc[a],Z=new X.Image({tankUnit:l,name:"tank",scaleX:c,scaleY:o});k.tank.then((D)=>{Z.setAttrs({image:D,offsetX:D.width/2,offsetY:D.height/2}),os.computeConvexHulls(l,D),l.onUpdateConvexHulls=()=>({x:l.x(),y:l.y(),offsetX:Z.offsetX(),offsetY:Z.offsetY(),scaleX:Z.scaleX(),scaleY:Z.scaleY(),rotation:Z.rotation()})}),l.add(Z),l.setAttr("tank",Z);let R=new X.Wedge({strokeWidth:0,fillRadialGradientStartRadius:0,fillRadialGradientColorStops:[0,"rgba(255 0 0 / 0.5)",1,"rgba(255 0 0 / 0)"],visible:!1});l.add(R),l.setAttr("radar",R);let w=new X.Image({tankUnit:l,name:"turret",scaleX:c,scaleY:o});k.turret.then((D)=>{w.setAttrs({image:D,offsetX:D.width/2,offsetY:D.height/2})}),l.add(w),l.setAttr("turret",w);let I=new X.Image({tankUnit:l,scaleX:c,scaleY:o,visible:!1});return Oc.broken.then((D)=>{I.setAttrs({image:D,offsetX:D.width/2,offsetY:D.height/2})}),l.add(I),l.setAttr("broken",I),l}var yc=`
const scripter = new ScriptController();

runtime.when('start', (done) => {
const userscript = async () => {
  while (true) {
    if (userscript.aborted) return;
    for (let i0 = 0; i0 < 2; i0++) {
      if (userscript.aborted) return;
      await tankUtils.turnRight(userscript, target, 20);
      await tankUtils.attack(userscript, target, tankUtils.getDirection(target), MathUtils.random(5, 15) * 10);
    }
    for (let i1 = 0; i1 < 4; i1++) {
      if (userscript.aborted) return;
      await tankUtils.turnLeft(userscript, target, 20);
      await tankUtils.attack(userscript, target, tankUtils.getDirection(target), MathUtils.random(5, 15) * 10);
    }
    for (let i2 = 0; i2 < 2; i2++) {
      if (userscript.aborted) return;
      await tankUtils.turnRight(userscript, target, 20);
      await tankUtils.attack(userscript, target, tankUtils.getDirection(target), MathUtils.random(5, 15) * 10);
    }
  }
};
userscript.i = 0;
userscript.warpMode = runtime.warpMode;
return scripter.execute(userscript).then(done).catch(done);
});
`;var Bc="";var Vc="";var nc="./assets/background-5h37gty1.png";import{jsx as Is}from"preact/jsx-runtime";var Ds={simple:yc,medium:Bc,senior:Vc},$=(c,o,a,s)=>{if(!c)return;c.setAttrs({x:o,y:a,health:100,speed:0,scanWidth:4,cooldown:null}),c.getAttr("broken")?.setAttr("visible",!1),c.getAttr("radar")?.setAttr("visible",!1);let l=c.getAttr("tank"),k=c.getAttr("turret");if(l){l.setAttrs({rotation:s,visible:!0});let Z=l.getAttr("tween");if(Z)Z.reset(),Z.destroy(),setTimeout(()=>l.setAttr("tween",null))}if(k){k.setAttrs({rotation:s,visible:!0});let Z=k.getAttr("tween");if(Z)Z.reset(),Z.destroy(),setTimeout(()=>k.setAttr("tween",null))}return c};function zc(){let{appState:c}=Zs(),{meta:o,file:a}=ks(),s=as(null),l=Kc(()=>{if(!c.value)return;if(!s.value?.tanks)return;$(s.value.tanks.player,-180,180,-135)?.setAttrs({name:a.value.name,zIndex:3}),$(s.value.tanks.red,180,-180,45)?.setAttr("visible",c.value.enemies>0),$(s.value.tanks.yellow,180,180,135)?.setAttr("visible",c.value.enemies>1),$(s.value.tanks.green,-180,-180,-45)?.setAttr("visible",c.value.enemies>2),s.value.updateMonitors(o.value.monitors)},[]);P(async()=>{s.value?.updateMonitors(o.value.monitors)},[o.value]),P(async()=>{if(!s.value)return;if(c.value?.running===!0){let Z="";Z+=`const tankUtils = runtime.tankUtils;
`,Z+=`(target => {
${a.value.script}})(runtime.tanks.player);

`;for(let R=1;R<=c.value.enemies;R++){let w=c.value.tanks[R];Z+=`(target => {
${Ds[w.ai]}})(runtime.tanks.${w.id});

`}s.value.launch(`${Z}runtime.start();`)}else if(c.value?.running===!1){if(s.value.running)s.value.stop(),l()}},[c.value?.running]),P(l,[s.value,c.value?.enemies]);let k=Kc((Z)=>{let R=(D)=>{Rs({tanks:D.map((x,m)=>({...c.value.tanks[m],health:x}))})};s.value=new e(Z,R);let w=0.5,I=w*Z.scaleY();return ls.Image.fromURL(nc,(D)=>{D.setAttrs({x:0,y:0,offsetX:D.width()/2,offsetY:D.height()/2,scaleX:w,scaleY:I}),s.value.backdropLayer.add(D)}),s.value.spritesLayer.add(Q(w,I,"player",!0)),s.value.spritesLayer.add(Q(w,I,"red")),s.value.spritesLayer.add(Q(w,I,"yellow")),s.value.spritesLayer.add(Q(w,I,"green")),s.value.on("frame",()=>s.value.drives()),()=>{s.value=null}},[]);return Is(ws,{zoom:c.value?.stageSize!=="large"?0.8:1,width:480,height:480,onRuntime:k})}import{useCallback as H}from"preact/hooks";import{classNames as jc}from"@blockcode/utils";import{useAppContext as ms,translate as L,setAppState as cc,ToggleButtons as Ns}from"@blockcode/core";function p(c){let o=globalThis.document,a=o.createElement("style");a.appendChild(o.createTextNode(c)),o.head.append(a)}p(".bEtDYa_toolbar-wrapper{height:var(--tool-bar-height);padding:var(--space) 0;flex-shrink:0;justify-content:space-between;align-items:center;display:flex}.bEtDYa_green-flag,.bEtDYa_stop-all{user-select:none;cursor:pointer;border:0;border-radius:.25rem;width:2rem;height:2rem;padding:.375rem}.bEtDYa_green-flag:hover,.bEtDYa_stop-all:hover{background:var(--theme-light-transparent)}.bEtDYa_green-flag.bEtDYa_actived{background:var(--theme-transparent)}.bEtDYa_stop-all{opacity:.5}.bEtDYa_stop-all.bEtDYa_actived{opacity:1}.bEtDYa_green-flag.bEtDYa_disabled,.bEtDYa_stop-all.bEtDYa_disabled{opacity:.5}.bEtDYa_toolbar-button{width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}.bEtDYa_space{margin-left:.2rem}.bEtDYa_toolbar-buttons-group{display:flex}.bEtDYa_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}.bEtDYa_group-button{border-left:none;border-radius:0}.bEtDYa_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}");var u={toolbarButton:"bEtDYa_toolbar-button",space:"bEtDYa_space",stopAll:"bEtDYa_stop-all",toolbarWrapper:"bEtDYa_toolbar-wrapper",disabled:"bEtDYa_disabled",greenFlag:"bEtDYa_green-flag",toolbarButtonsGroup:"bEtDYa_toolbar-buttons-group",groupButtonFirst:"bEtDYa_group-button-first",groupButton:"bEtDYa_group-button",groupButtonLast:"bEtDYa_group-button-last",actived:"bEtDYa_actived"};var Sc="./assets/icon-green-flag-tz1g77je.svg";var tc="./assets/icon-stop-all-zrx3gxr1.svg";var Cc="./assets/icon-small-stage-anyzs7w9.svg";var Gc="./assets/icon-large-stage-f6hyxzdr.svg";import{jsx as M,jsxs as Uc}from"preact/jsx-runtime";function ec(){let{appState:c}=ms(),o=H(()=>{let l=c.value?.tanks.map((k)=>({...k,health:100}));cc({tanks:l,running:!!l})},[]),a=H(()=>{cc("running",!1)},[]),s=H((l)=>{cc("stageSize",l)},[]);return Uc("div",{className:u.toolbarWrapper,children:[Uc("div",{className:u.toolbarButtonsGroup,children:[M("img",{className:jc(u.greenFlag,{[u.actived]:c.value?.running}),src:Sc,title:L("tankwar.player.greenFlag","Fight"),onClick:o}),M("img",{className:jc(u.stopAll,{[u.actived]:c.value?.running}),src:tc,title:L("tankwar.player.stopAll","Stop"),onClick:a})]}),M("div",{className:u.toolbarButtonsGroup,children:M(Ns,{items:[{icon:Cc,title:L("tankwar.stage.small","Switch to small stage"),value:"small"},{icon:Gc,title:L("tankwar.stage.large","Switch to large stage"),value:"large"}],value:c.value?.stageSize??"small",onChange:s})})]})}p(".ReTkdW_stage-wrapper{position:relative}.ReTkdW_stage{border:1px solid var(--ui-black-transparent);border-radius:var(--space);background:var(--ui-white);width:482px;height:482px;position:relative;overflow:hidden}.ReTkdW_small{width:386px;height:386px}");var O={stage:"ReTkdW_stage",small:"ReTkdW_small",stageWrapper:"ReTkdW_stage-wrapper"};import{jsx as oc,jsxs as qs}from"preact/jsx-runtime";function Pc(){let{appState:c}=ps();return qs("div",{className:O.stageWrapper,children:[oc(ec,{}),oc("div",{className:rs(O.stage,{[O.small]:c.value?.stageSize!=="large"}),children:oc(zc,{})})]})}import{useAppContext as Fs,useProjectContext as xs,translate as N,setAppState as so}from"@blockcode/core";import{classNames as sc}from"@blockcode/utils";import{Label as F,BufferedInput as Es,ToggleButtons as ac}from"@blockcode/core";p("._OnGaW_stage-info-wrapper{margin-top:var(--space);background:var(--ui-white);color:var(--text-primary);border-radius:var(--space);border:1px solid var(--ui-black-transparent);padding:1rem}._OnGaW_row{justify-content:space-between;margin-top:.5rem;display:flex}._OnGaW_row-primary{margin-top:0}._OnGaW_group{flex-direction:row;align-items:center;display:inline-flex}._OnGaW_full-input{flex:1}._OnGaW_name-input{width:8rem}._OnGaW_button{min-width:calc(2rem + 2px);height:calc(2rem + 2px);padding:.375rem!important}._OnGaW_button-icon{margin:auto}._OnGaW_space{margin-left:.2rem}._OnGaW_toolbar-button-group{display:flex}._OnGaW_group-button-first{border-top-right-radius:0;border-bottom-right-radius:0}._OnGaW_group-button{border-left:none;border-radius:0}._OnGaW_group-button-last{border-left:none;border-top-left-radius:0;border-bottom-left-radius:0}._OnGaW_button-text{flex:auto}._OnGaW_group-button-toggled-on ._OnGaW_button-text{color:#4c97ff}._OnGaW_tank-image{width:1.65rem}._OnGaW_health-progress{background:#f5f5f5;border-radius:10px;width:12rem;height:20px}._OnGaW_health-progress:before{counter-reset:progress var(--percent,0);content:counter(progress) \"% \";height:20px;width:calc(12rem * var(--percent,0) / 100);color:var(--ui-white);text-align:right;white-space:nowrap;background:#ff6680;border-radius:10px;font-size:12px;line-height:20px;display:block;overflow:hidden}._OnGaW_health-progress._OnGaW_small{width:8rem}._OnGaW_health-progress._OnGaW_small:before{width:calc(8rem * var(--percent,0) / 100)}");var b={row:"_OnGaW_row",small:"_OnGaW_small",healthProgress:"_OnGaW_health-progress",groupButtonToggledOn:"_OnGaW_group-button-toggled-on",buttonIcon:"_OnGaW_button-icon",groupButton:"_OnGaW_group-button",nameInput:"_OnGaW_name-input",buttonText:"_OnGaW_button-text",toolbarButtonGroup:"_OnGaW_toolbar-button-group",rowPrimary:"_OnGaW_row-primary",groupButtonFirst:"_OnGaW_group-button-first",stageInfoWrapper:"_OnGaW_stage-info-wrapper",group:"_OnGaW_group",fullInput:"_OnGaW_full-input",button:"_OnGaW_button",tankImage:"_OnGaW_tank-image",groupButtonLast:"_OnGaW_group-button-last",space:"_OnGaW_space"};var Hc="./assets/icon-tank-red-tq1cemhn.png";var co="./assets/icon-tank-yellow-5vq6mndw.png";var oo="./assets/icon-tank-green-4r293h2s.png";import{useCallback as lc,useMemo as V0}from"preact/hooks";import{jsx as _,jsxs as y}from"preact/jsx-runtime";var hs=[Hc,co,oo];function ao(){let{appState:c}=Fs(),{file:o,setFile:a}=xs(),s=lc((Z)=>{a({name:Z})},[]),l=lc((Z)=>{so("enemies",Z)},[]),k=lc((Z)=>(R)=>{so("tanks",c.value.tanks.map((w)=>Z===w.id?{...w,ai:R}:w))},[]);return y("div",{className:b.stageInfoWrapper,children:[y("div",{className:sc(b.row,b.rowPrimary),children:[_(F,{text:N("tankwar.stageInfo.player","Player"),children:_(Es,{disabled:c.value?.running,className:b.nameInput,placeholder:N("tankwar.stageInfo.nickname","Nickname"),onSubmit:s,value:o.value.name})}),_(F,{secondary:!0,className:b.health,text:N("tankwar.stageInfo.health","Health"),children:_("div",{className:sc(b.healthProgress,{[b.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?c.value?.tanks[0]?.health:100}`})})]}),y("div",{className:b.row,children:[_(F,{secondary:!0,text:N("tankwar.stageInfo.enemies","Enemies"),children:_(ac,{disabled:c.value?.running,items:[{value:0,title:"0"},{value:1,title:"1"},{value:3,title:"3"}],value:c.value?.enemies??1,onChange:l})}),c.value?.enemies>0&&_(F,{secondary:!0,children:_(ac,{disabled:c.value?.running,items:[{value:"local",title:N("tankwar.stageInfo.mode.local","Local AI")},{value:"remote",title:N("tankwar.stageInfo.mode.remote","Remote Players"),disabled:!0}],value:"local"})})]}),c.value?.tanks.slice(1,c.value?.enemies+1)?.map((Z,R)=>y("div",{className:b.row,children:[_(F,{secondary:!0,children:_("img",{className:b.tankImage,src:hs[R],alt:Z.name,title:Z.name})}),_(F,{secondary:!0,children:_("div",{className:sc(b.healthProgress,{[b.small]:c.value?.stageSize!=="large"}),style:`--percent:${c.value?.running?Z.health:100}`})}),_(F,{secondary:!0,text:N("tankwar.stageInfo.ai","AI"),children:_(ac,{disabled:c.value?.running,items:[{value:"simple",title:N("tankwar.stageInfo.ai.simple","Simple")},{value:"medium",title:N("tankwar.stageInfo.ai.medium","Medium")},{value:"senior",title:N("tankwar.stageInfo.ai.senior","Senior")}],value:Z.ai??"simple",onChange:k(Z.id)})})]},R))]})}p(".yg_RPq_sidebar-wrapper{flex-direction:column;height:100%;display:flex}.yg_RPq_stage-wrapper{display:flex}.yg_RPq_selector-wrapper{height:100%;margin-top:var(--space);flex-direction:row;display:flex}");var Zc={stageWrapper:"yg_RPq_stage-wrapper",sidebarWrapper:"yg_RPq_sidebar-wrapper",selectorWrapper:"yg_RPq_selector-wrapper"};import{jsx as lo,jsxs as Js}from"preact/jsx-runtime";function Zo(){return vs(()=>{Ys({enemies:1,tanks:[{id:"player",name:B("tankwar.stageInfo.player","Player"),health:100},{id:"red",name:B("tankwar.stageInfo.enemy.red","Red"),health:100,ai:"simple"},{id:"yellow",name:B("tankwar.stageInfo.enemy.yellow","Yellow"),health:100,ai:"simple"},{id:"green",name:B("tankwar.stageInfo.enemy.green","Green"),health:100,ai:"simple"}]})},[]),Js("div",{className:Zc.sidebarWrapper,children:[lo(Pc,{className:Zc.stageWrapper}),lo(ao,{})]})}import{Text as Xs}from"@blockcode/core";import{jsx as Qs}from"preact/jsx-runtime";var ko={files:[{id:"player",name:Qs(Xs,{id:"tankwar.stageInfo.player",defaultMessage:"Player"})}]};import{jsx as _a}from"preact/jsx-runtime";var fa={onNew(){return ko},onSave(c){return{files:c.map((o)=>({id:o.id,name:o.name,xml:o.xml}))}},async onThumb(){let c=document.querySelector(".konvajs-content");return(await Ws(c))?.toDataURL()},onUndo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!1)},onRedo(c){if(c instanceof MouseEvent)V.getMainWorkspace()?.undo(!0)},onEnableUndo(){let c=V.getMainWorkspace();return c?.undoStack_&&c.undoStack_.length!==0},onEnableRedo(){let c=V.getMainWorkspace();return c?.redoStack_&&c.redoStack_.length!==0},menuItems:[{id:"edit",disabledCoding:!0},{id:"view",disabled:!0}],tabs:[{...As,Content:mc},!1].filter(Boolean),docks:[{expand:"right",Content:Zo}]};export{fa as default};
