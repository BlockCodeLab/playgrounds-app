import{addLocalesMessages as I}from"@blockcode/core";var l={"microbit.menubar.device":"micro:bit","microbit.menubar.device.sync":"Sync blocks"};var L={"microbit.menubar.device":"micro:bit","microbit.menubar.device.sync":"同步脚本"};var f={"microbit.menubar.device":"micro:bit","microbit.menubar.device.sync":"同步腳本"};I({en:l,"zh-Hans":L,"zh-Hant":f});import{svgAsDataUri as Y}from"@blockcode/utils";import{ScratchBlocks as i,MicroPythonGenerator as $,blocksTab as q,codeReviewTab as w1}from"@blockcode/blocks";import{Text as J}from"@blockcode/core";import{BlocksEditor as K,CodeReview as y1}from"@blockcode/blocks";import{useAppContext as T}from"@blockcode/core";var p="./assets/icon-device-k1eg3dd5.svg";var u="./assets/icon-device-connected-3gcajtt2.svg";import{jsx as g}from"preact/jsx-runtime";function M(){let{appState:o}=T();return o.value?.device?g("img",{src:u}):g("img",{src:p})}import{useCallback as z}from"preact/hooks";import{nanoid as H}from"@blockcode/utils";import{useProjectContext as x,setAlert as C,delAlert as F,openPromptModal as l1}from"@blockcode/core";import{MPYUtils as s}from"@blockcode/board";import{Spinner as U,Text as w,MenuSection as E,MenuItem as _}from"@blockcode/core";import{jsx as n,Fragment as G}from"preact/jsx-runtime";var r=null,h=()=>{F(r),r=null},v=(o)=>{if(!r)r=H();if(o<100)C({id:r,icon:n(U,{level:"success"}),message:n(w,{id:"gui.alert.downloadingProgress",defaultMessage:"Downloading...{progress}%",progress:o})});else C("downloadCompleted",{id:r}),setTimeout(h,2000)},b=(o)=>{if(o==="NotFoundError")return;C("connectionError",1000)};function Z({itemClassName:o}){let{files:e,assets:d}=x(),c=z(async()=>{if(r)return;let t;try{t=await s.connect([])}catch(m){b(m.name)}if(!t)return;let P=[].concat(e.value,d.value);v(0);try{await s.write(t,P,v),t.hardReset()}catch(m){b(m.name)}h()},[]);return n(G,{children:n(E,{children:n(_,{disabled:r,className:o,label:n(w,{id:"gui.menubar.device.download",defaultMessage:"Download program"}),onClick:c})})})}import{nanoid as O}from"@blockcode/utils";var y=O(),R=`
from blocks import *
import ${y}
start()
`,A={assets:[{id:"main",type:"text/x-python",content:R}],files:[{id:y,type:"text/x-python"}]};import{jsx as a}from"preact/jsx-runtime";var Q=new $,S=()=>["device"],D1={onNew(){return A},onSave(o,e){let d=[];return o=o.map((t)=>{return d.push(t.extensions),{id:t.id,type:t.type,xml:t.xml}}),{meta:{extensions:Array.from(new Set(d.flat()))},files:o,assets:e}},async onThumb(){let o=i.getMainWorkspace();if(o){let e=o.getCanvas();if(e)return await Y(e,{})}},onUndo(o){if(o instanceof MouseEvent)i.getMainWorkspace()?.undo(!1)},onRedo(o){if(o instanceof MouseEvent)i.getMainWorkspace()?.undo(!0)},onEnableUndo(){let o=i.getMainWorkspace();return o?.undoStack_&&o.undoStack_.length!==0},onEnableRedo(){let o=i.getMainWorkspace();return o?.redoStack_&&o.redoStack_.length!==0},menuItems:[{icon:a(M,{}),label:a(J,{id:"microbit.menubar.device",defaultMessage:"Device"}),Menu:Z}],tabs:[{...q,Content:()=>a(K,{generator:Q,onExtensionsFilter:S})}].concat([])};export{D1 as default};
