import{addLocalesMessages as T}from"@blockcode/core";var L={"microbit.menubar.device":"micro:bit","microbit.menubar.device.sync":"Sync blocks"};var l={"microbit.menubar.device":"micro:bit","microbit.menubar.device.sync":"同步脚本"};var f={"microbit.menubar.device":"micro:bit","microbit.menubar.device.sync":"同步腳本"};T({en:L,"zh-Hans":l,"zh-Hant":f});import{svgAsDataUri as J}from"@blockcode/utils";import{ScratchBlocks as i,MicroPythonGenerator as K,blocksTab as Q,codeReviewTab as y1}from"@blockcode/blocks";import{Text as S}from"@blockcode/core";import{BlocksEditor as V,CodeReview as I1}from"@blockcode/blocks";import{useAppContext as F}from"@blockcode/core";var p="./assets/icon-device-k1eg3dd5.svg";var g="./assets/icon-device-connected-3gcajtt2.svg";import{jsx as u}from"preact/jsx-runtime";function M(){let{appState:o}=F();return o.value?.device?u("img",{src:g}):u("img",{src:p})}import{useCallback as U}from"preact/hooks";import{nanoid as E}from"@blockcode/utils";import{useProjectContext as _,setAlert as C,delAlert as G,openPromptModal as p1}from"@blockcode/core";import{MPYUtils as s}from"@blockcode/board";import{Spinner as O,Text as w,MenuSection as R,MenuItem as Y}from"@blockcode/core";import{jsx as r,Fragment as $}from"preact/jsx-runtime";var n=null,h=()=>{G(n),n=null},v=(o)=>{if(!n)n=E();if(o<100)C({id:n,icon:r(O,{level:"success"}),message:r(w,{id:"gui.alert.downloadingProgress",defaultMessage:"Downloading...{progress}%",progress:o})});else C("downloadCompleted",{id:n}),setTimeout(h,2000)},b=(o)=>{if(o==="NotFoundError")return;C("connectionError",1000)};function Z({itemClassName:o}){let{files:e,assets:m}=_(),c=U(async()=>{if(n)return;let t;try{t=await s.connect([])}catch(d){b(d.name)}if(!t)return;let P=[].concat(e.value,m.value);v(0);try{await s.write(t,P,v),t.hardReset()}catch(d){b(d.name)}h()},[]);return r($,{children:r(R,{children:r(Y,{disabled:n,className:o,label:r(w,{id:"gui.menubar.device.download",defaultMessage:"Download program"}),onClick:c})})})}import{nanoid as q}from"@blockcode/utils";var y=q(),x=`
from blocks import *
import ${y}
start()
`,A={assets:[{id:"main",type:"text/x-python",content:x}],files:[{id:y,type:"text/x-python"}]};import{jsx as a}from"preact/jsx-runtime";var W=new K,X=()=>["device"],z1={onNew(){return A},onSave(o,e){let m=[];return o=o.map((t)=>{return m.push(t.extensions),{id:t.id,type:t.type,xml:t.xml}}),{meta:{extensions:Array.from(new Set(m.flat()))},files:o,assets:e}},async onThumb(){let o=i.getMainWorkspace();if(o){let e=o.getCanvas();if(e)return await J(e,{})}},onUndo(o){if(o instanceof MouseEvent)i.getMainWorkspace()?.undo(!1)},onRedo(o){if(o instanceof MouseEvent)i.getMainWorkspace()?.undo(!0)},onEnableUndo(){let o=i.getMainWorkspace();return o?.undoStack_&&o.undoStack_.length!==0},onEnableRedo(){let o=i.getMainWorkspace();return o?.redoStack_&&o.redoStack_.length!==0},menuItems:[{icon:a(M,{}),label:a(S,{id:"microbit.menubar.device",defaultMessage:"Device"}),Menu:Z}],tabs:[{...Q,Content:()=>a(V,{generator:W,onExtensionsFilter:X})}].concat([])};export{z1 as default};
