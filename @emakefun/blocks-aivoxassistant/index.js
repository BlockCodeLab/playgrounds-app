import{addLocalesMessages as N,Text as Y}from"@blockcode/core";import{Text as m}from"@blockcode/core";import{jsx as r}from"preact/jsx-runtime";var A=(o)=>o.editor==="@blockcode/gui-arduino",b=(o)=>[{id:"init",text:r(m,{id:"blocks.aivoxassistant.init",defaultMessage:"set pins RX:[RX] TX:[TX]"}),inputs:{RX:o.boardPins?{menu:o.boardPins.all}:{type:"positive_integer",defaultValue:2},TX:o.boardPins?{menu:o.boardPins.all}:{type:"positive_integer",defaultValue:3}},ino(e){let a=o.boardPins?e.getFieldValue("RX"):this.valueToCode(e,"RX",this.ORDER_NONE),i=o.boardPins?e.getFieldValue("TX"):this.valueToCode(e,"TX",this.ORDER_NONE);return this.definitions_.include_softwareserial="#include <SoftwareSerial.h>",this.definitions_.variable_aivoxAssistant=`SoftwareSerial aivoxAssistant(${a}, ${i});`,this.definitions_.setup_aivoxAssistant="aivoxAssistant.begin(115200);",""},mpy(e){let a=o.boardPins?e.getFieldValue("RX"):this.valueToCode(e,"RX",this.ORDER_NONE),i=o.boardPins?e.getFieldValue("TX"):this.valueToCode(e,"TX",this.ORDER_NONE);return this.definitions_.import_uart="from machine import UART",this.definitions_.aivox_assistant=`aivox_assistant = UART(1, baudrate=115200, rx=${a}, tx=${i})`,""}},"---",{id:"whenCommand",text:r(m,{id:"blocks.aivoxassistant.whenCommand",defaultMessage:"when receive [CMD] command"}),hat:!0,inputs:{CMD:{type:"string",defaultValue:"turn on led"}},ino(e){if(this.definitions_.include_regexp="#include <Regexp.h>",this.definitions_.variable_commandReg="MatchState cmdRe;",!this.definitions_.processAssistant){let t="";t+=`void processAssistant() {
`,t+=`  if (aivoxAssistant.available() == 0) return;
`,t+=`  String cmd = aivoxAssistant.readStringUntil('\\n');
`,t+=`  cmdRe.Target(cmd.c_str());
`,t+="}",this.definitions_.processAssistant=t,this.definitions_.declare_processAssistant="void processAssistant();",this.definitions_.loop_processAssistant="processAssistant();"}let a=this.createName("assistantCommand"),i=this.statementToCode(e)||"";this.definitions_[`declare_${a}`]=`void ${a}();`,this.definitions_[a]=`void ${a}() {
${i}}`;let n=this.valueToCode(e,"CMD",this.ORDER_NONE).replace(/\{\S+\}/g,"(%S+)").replace(/\s+/g,"%s+");this.definitions_.processAssistant=this.definitions_.processAssistant.replace(`;
}`,`;
  if (cmdRe.Match(${n}) > 0) return ${a}();
}`)},mpy(e){if(this.definitions_.import_re="import re",this.definitions_.assistant_matched="assistant_matched = None",!this.definitions_.assistant_received){let l="";l+=`@_tasks__.append
`,l+=`async def assistant_received():
`,l+=`  global assistant_matched
`,l+=`  while True:
`,l+=`    await asyncio.sleep_ms(5)
`,l+=`    if not aivox_assistant.any(): continue
`,l+=`    cmd = aivox_assistant.readline()
`,this.definitions_.assistant_received=l}let a=this.createName("assistant_flag");this.definitions_[a]=`${a} = asyncio.ThreadSafeFlag()`;let i=this.statementToCode(e)||"",s="";s+=`global assistant_matched
`,s+=`while True:
`,s+=`  await ${a}.wait()
`,s+=i;let n=this.valueToCode(e,"CMD",this.ORDER_NONE),t=this.getFunctionName(n);i=this.prefixLines(s,this.INDENT),i=this.addEventTrap(i,"assistant_callback"),s=`@_tasks__.append
`,s+=i,this.definitions_[t]=s;let c=n.replace(/\{\S+\}/g,"(\\S+)").replace(/\s+/g,"\\s+");s="",s+=`    assistant_matched = re.match(${c}, cmd)
`,s+=`    if assistant_matched: ${a}.set(); continue
`,this.definitions_.assistant_received+=s}},{id:"argument",text:r(m,{id:"blocks.aivoxassistant.argument",defaultMessage:"[TYPE] argument [ARG] of command"}),output:"string",inputs:{TYPE:{menu:A(o)?"ArduinoTypes":"Types"},ARG:{type:"string",defaultValue:"x"}},ino(e){let a=e.getRootBlock();if(e.parentBlock_===a)return"";let i=JSON.parse(this.valueToCode(e,"ARG",this.ORDER_NONE)),s=this.valueToCode(a,"CMD",this.ORDER_NONE),n=e.getFieldValue("TYPE");this.definitions_.include_regexp="#include <Regexp.h>",this.definitions_.variable_commandReg="MatchState cmdRe;";let t="";t+=`String getCommandArgument(uint8_t idx) {
`,t+=`  char arg[100];
`,t+=`  cmdRe.GetCapture(arg, idx);
`,t+=`  return String(arg);
`,t+="}",this.definitions_.getCommandArgument=t,this.definitions_.declare_getCommandArgument="String getCommandArgument(uint8_t idx);";let c=0,l=[...s.matchAll(/\{(\w+)\}/g)];for(let d=0;d<l.length;d++)if(l[d][1]===i){c=d;break}let v="";if(n!=="String")v=`.to${n.charAt(0).toUpperCase()}${n.slice(1)}()`;return t=`getCommandArgument(${c})${v}`,[t]},mpy(e){let a=e.getRootBlock();if(e.parentBlock_===a)return"";let i=JSON.parse(this.valueToCode(e,"ARG",this.ORDER_NONE)),s=this.valueToCode(a,"CMD",this.ORDER_NONE),n=e.getFieldValue("TYPE");this.definitions_.import_re="import re",this.definitions_.assistant_matched="assistant_matched = None";let t=0,c=[...s.matchAll(/\{(\w+)\}/g)];for(let d=0;d<c.length;d++)if(c[d][1]===i){t=d+1;break}let l="float";if(n!=="float")l=n.slice(0,3).toLowerCase();return[`${l}(${l==="str"?'""':0} if not assistant_matched else assistant_matched.group(${t}))`]}}],u={Types:{items:[[r(m,{id:"blocks.aivoxassistant.argumentInt",defaultMessage:"int"}),"int"],[r(m,{id:"blocks.aivoxassistant.argumentFloat",defaultMessage:"float"}),"float"],[r(m,{id:"blocks.aivoxassistant.argumentString",defaultMessage:"string"}),"String"]]},ArduinoTypes:{items:["int","float","String"]}};import{Text as k}from"@blockcode/core";var E="./assets/feature-77rwsnq0.svg";var y="./assets/aivoxassistant-arduino-ff59b3tm.bcp";var _="./assets/aIvoxassistant-esp32-265sqkbg.bcp";var h="./assets/aIvoxassistant-iotbit-8m7tapnp.bcp";var g="./assets/knowledge-pgs43vhg.png";var w="./assets/xiaozhi-yb70pyag.png";import{jsx as f}from"preact/jsx-runtime";var p={"aivoxassistant-help":{title:f(k,{id:"blocks.aivoxassistant.lessonTitle",defaultMessage:"AI Vox Assistant Help"}),image:E,project(o){if(o.editor==="@blockcode/gui-arduino")return y;if(o.editor==="@blockcode/gui-esp32")return _;if(o.editor==="@emakefun/gui-iotbit")return h;return},pages:[{title:f(k,{id:"blocks.aivoxassistant.lessonPage1.title",defaultMessage:"Peripheral Control Commands"}),image:g,text:f(k,{id:"blocks.aivoxassistant.lessonPage1.text",defaultMessage:"Create a new Excel file, enter the peripheral control commands for this example in the format shown above, and then save it."})},{title:f(k,{id:"blocks.aivoxassistant.lessonPage2.title",defaultMessage:"Import to Xiaozhi Knowledge Base"}),image:w,text:f(k,{id:"blocks.aivoxassistant.lessonPage2.text",defaultMessage:'Import the "Peripheral Control Commands" into the knowledge base of the Xiaozhi backend at xiaozhi.me.'})}]}};var x="///docs.emakefun.com/#/zh-cn/ph2.0_sensors/smart_module/ai_voice_assistant/ai_voice_assistant";var B={en:{"blocks.aivoxassistant.name":"AI Vox Assistant","blocks.aivoxassistant.init":"set pins RX:[RX] TX:[TX]","blocks.aivoxassistant.whenCommand":"when receive [CMD] command","blocks.aivoxassistant.argument":"[TYPE] argument [ARG] of command","blocks.aivoxassistant.argumentInt":"integer","blocks.aivoxassistant.argumentFloat":"float","blocks.aivoxassistant.argumentString":"string","blocks.aivoxassistant.lessonTitle":"AI Vox Assistant Help","blocks.aivoxassistant.lessonPage1.title":"Peripheral Control Commands","blocks.aivoxassistant.lessonPage1.text":"Create a new Excel file, enter the peripheral control commands for this example in the format shown above, and then save it.","blocks.aivoxassistant.lessonPage2.title":"Import to Xiaozhi Knowledge Base","blocks.aivoxassistant.lessonPage2.text":'Import the "Peripheral Control Commands" into the knowledge base of the Xiaozhi backend at xiaozhi.me.'},"zh-Hans":{"blocks.aivoxassistant.name":"AI 语音助手","blocks.aivoxassistant.init":"初始引脚 RX:[RX] TX:[TX]","blocks.aivoxassistant.whenCommand":"当收到 [CMD] 指令时","blocks.aivoxassistant.argument":"指令参数 [ARG] 类型 [TYPE]","blocks.aivoxassistant.argumentInt":"整数","blocks.aivoxassistant.argumentFloat":"浮点数","blocks.aivoxassistant.argumentString":"字符串","blocks.aivoxassistant.lessonTitle":"AI 语音助手帮助","blocks.aivoxassistant.lessonPage1.title":"外设控制指令表","blocks.aivoxassistant.lessonPage1.text":"新建 Excel 文件，按上面格式输入本示例的外设控制指令，然后保存。","blocks.aivoxassistant.lessonPage2.title":"导入小智知识库","blocks.aivoxassistant.lessonPage2.text":"将“外设控制指令表”导入到小智后台 xiaozhi.me 的知识库中。"},"zh-Hant":{"blocks.aivoxassistant.name":"AI 語音助手","blocks.aivoxassistant.init":"初始引腳 RX:[RX] TX:[TX]","blocks.aivoxassistant.whenCommand":"當收到 [CMD] 指令時","blocks.aivoxassistant.argument":"指令參數 [ARG] 类型 [TYPE]","blocks.aivoxassistant.argumentInt":"整数","blocks.aivoxassistant.argumentFloat":"浮点数","blocks.aivoxassistant.argumentString":"字符串","blocks.aivoxassistant.lessonTitle":"AI 語音助手幫助","blocks.aivoxassistant.lessonPage1.title":"外設控制指令表","blocks.aivoxassistant.lessonPage1.text":"新建 Excel 文件，按上面格式輸入本示例的外設控制指令，然後保存。","blocks.aivoxassistant.lessonPage2.title":"導入小智知識庫","blocks.aivoxassistant.lessonPage2.text":"將「外設控制指令表」導入到小智後台 xiaozhi.me 的知識庫中。"}};var R="./assets/icon-jep655t2.svg";import{jsx as Q}from"preact/jsx-runtime";N(B);var fe={icon:R,name:Q(Y,{id:"blocks.aivoxassistant.name",defaultMessage:"AI Vox Assistant"}),blocks:b,menus:u,readme:x,lessons:p};export{fe as default};
