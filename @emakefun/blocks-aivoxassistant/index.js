import{addLocalesMessages as M,Text as I}from"@blockcode/core";import{Text as m}from"@blockcode/core";import{jsx as r}from"preact/jsx-runtime";var A=(n)=>n.editor==="@blockcode/gui-arduino",g=(n)=>[{id:"init",text:r(m,{id:"blocks.aivoxassistant.init",defaultMessage:"set pins RX:[RX] TX:[TX]"}),inputs:{RX:n.boardPins?{menu:n.boardPins.all}:{type:"positive_integer",defaultValue:2},TX:n.boardPins?{menu:n.boardPins.all}:{type:"positive_integer",defaultValue:3}},ino(e){let s=n.boardPins?e.getFieldValue("RX"):this.valueToCode(e,"RX",this.ORDER_NONE),o=n.boardPins?e.getFieldValue("TX"):this.valueToCode(e,"TX",this.ORDER_NONE);return this.definitions_.include_softwareserial="#include <SoftwareSerial.h>",this.definitions_.variable_aivoxAssistant=`SoftwareSerial aivoxAssistant(${s}, ${o});`,this.definitions_.setup_aivoxAssistant="aivoxAssistant.begin(115200);",""},mpy(e){let s=n.boardPins?e.getFieldValue("RX"):this.valueToCode(e,"RX",this.ORDER_NONE),o=n.boardPins?e.getFieldValue("TX"):this.valueToCode(e,"TX",this.ORDER_NONE);return this.definitions_.import_uart="from machine import UART",this.definitions_.aivox_assistant=`aivox_assistant = UART(1, baudrate=115200, rx=${s}, tx=${o})`,""}},"---",{id:"whenCommand",text:r(m,{id:"blocks.aivoxassistant.whenCommand",defaultMessage:"when receive [CMD] command"}),hat:!0,inputs:{CMD:{type:"string",defaultValue:"turn on led"}},ino(e){if(this.definitions_.include_regexp="#include <Regexp.h>",this.definitions_.variable_commandReg="MatchState cmdRe;",!this.definitions_.processAssistant){let t="";t+=`void processAssistant() {
`,t+=`  if (aivoxAssistant.available() == 0) return;
`,t+=`  String cmd = aivoxAssistant.readStringUntil('\\n');
`,t+=`  cmdRe.Target(cmd.c_str());
`,t+="}",this.definitions_.processAssistant=t,this.definitions_.declare_processAssistant="void processAssistant();",this.definitions_.loop_processAssistant="processAssistant();"}let s=this.createName("assistantCommand"),o=this.statementToCode(e)||"";this.definitions_[`declare_${s}`]=`void ${s}();`,this.definitions_[s]=`void ${s}() {
${o}}`;let l=this.valueToCode(e,"CMD",this.ORDER_NONE).replace(/\{\S+\}/g,"(%S+)").replace(/\s+/g,"%s+");this.definitions_.processAssistant=this.definitions_.processAssistant.replace(`;
}`,`;
  if (cmdRe.Match(${l}) > 0) return ${s}();
}`)},mpy(e){if(this.definitions_.import_re="import re",this.definitions_.assistant_matched="assistant_matched = None",!this.definitions_.assistant_received){let i="";i+=`@_tasks__.append
`,i+=`async def assistant_received():
`,i+=`  global assistant_matched
`,i+=`  while True:
`,i+=`    await asyncio.sleep_ms(5)
`,i+=`    if not aivox_assistant.any(): continue
`,i+=`    cmd = aivox_assistant.readline()
`,this.definitions_.assistant_received=i}let s=this.createName("assistant_flag");this.definitions_[s]=`${s} = asyncio.ThreadSafeFlag()`;let o=this.statementToCode(e)||"",a="";a+=`global assistant_matched
`,a+=`while True:
`,a+=`  await ${s}.wait()
`,a+=o;let l=this.valueToCode(e,"CMD",this.ORDER_NONE),t=this.getFunctionName(l);o=this.prefixLines(a,this.INDENT),o=this.addEventTrap(o,"assistant_callback"),a=`@_tasks__.append
`,a+=o,this.definitions_[t]=a;let c=l.replace(/\{\S+\}/g,"(\\S+)").replace(/\s+/g,"\\s+");a="",a+=`    assistant_matched = re.match(${c}, cmd)
`,a+=`    if assistant_matched: ${s}.set(); continue
`,this.definitions_.assistant_received+=a}},{id:"argument",text:r(m,{id:"blocks.aivoxassistant.argument",defaultMessage:"[TYPE] argument [ARG] of command"}),output:"string",inputs:{TYPE:{menu:A(n)?"ArduinoTypes":"Types"},ARG:{type:"string",defaultValue:"x"}},ino(e){let s=e.getRootBlock();if(e.parentBlock_===s)return"";let o=JSON.parse(this.valueToCode(e,"ARG",this.ORDER_NONE)),a=this.valueToCode(s,"CMD",this.ORDER_NONE),l=e.getFieldValue("TYPE");this.definitions_.include_regexp="#include <Regexp.h>",this.definitions_.variable_commandReg="MatchState cmdRe;";let t="";t+=`String getCommandArgument(uint8_t idx) {
`,t+=`  char arg[100];
`,t+=`  cmdRe.GetCapture(arg, idx);
`,t+=`  return String(arg);
`,t+="}",this.definitions_.getCommandArgument=t,this.definitions_.declare_getCommandArgument="String getCommandArgument(uint8_t idx);";let c=0,i=[...a.matchAll(/\{(\w+)\}/g)];for(let d=0;d<i.length;d++)if(i[d][1]===o){c=d;break}let k="";if(l!=="String")k=`.to${l.charAt(0).toUpperCase()}${l.slice(1)}()`;return t=`getCommandArgument(${c})${k}`,[t]},mpy(e){let s=e.getRootBlock();if(e.parentBlock_===s)return"";let o=JSON.parse(this.valueToCode(e,"ARG",this.ORDER_NONE)),a=this.valueToCode(s,"CMD",this.ORDER_NONE),l=e.getFieldValue("TYPE");this.definitions_.import_re="import re",this.definitions_.assistant_matched="assistant_matched = None";let t=0,c=[...a.matchAll(/\{(\w+)\}/g)];for(let d=0;d<c.length;d++)if(c[d][1]===o){t=d+1;break}let i="float";if(l!=="float")i=l.slice(0,3).toLowerCase();return[`${i}(${i==="str"?'""':0} if not assistant_matched else assistant_matched.group(${t}))`]}}],E={Types:{items:[[r(m,{id:"blocks.aivoxassistant.argumentInt",defaultMessage:"int"}),"int"],[r(m,{id:"blocks.aivoxassistant.argumentFloat",defaultMessage:"float"}),"float"],[r(m,{id:"blocks.aivoxassistant.argumentString",defaultMessage:"string"}),"String"]]},ArduinoTypes:{items:["int","float","String"]}};import{Text as v}from"@blockcode/core";var u="./assets/feature-77rwsnq0.svg";var _="./assets/aivoxassistant-jx1vt89n.bcp";var b="./assets/knowledge-pgs43vhg.png";var y="./assets/xiaozhi-yb70pyag.png";import{jsx as f}from"preact/jsx-runtime";var h={"aivoxassistant-help":{title:f(v,{id:"blocks.aivoxassistant.lessonTitle",defaultMessage:"AI-Vox Assistant Help"}),image:u,project:_,pages:[{title:f(v,{id:"blocks.aivoxassistant.lessonPage1.title",defaultMessage:"AI-Vox Assistant Help"}),image:b,text:f(v,{id:"blocks.aivoxassistant.lessonPage1.text",defaultMessage:"AI-Vox Assistant Help"})},{title:f(v,{id:"blocks.aivoxassistant.lessonPage2.title",defaultMessage:"AI-Vox Assistant Help"}),image:y,text:f(v,{id:"blocks.aivoxassistant.lessonPage2.text",defaultMessage:"AI-Vox Assistant Help"})}]}};var x="///docs.emakefun.com/#/zh-cn/ph2.0_sensors/smart_module/ai_voice_assistant/ai_voice_assistant";var w={en:{"blocks.aivoxassistant.name":"AI Vox Assistant","blocks.aivoxassistant.init":"set pins RX:[RX] TX:[TX]","blocks.aivoxassistant.whenCommand":"when receive [CMD] command","blocks.aivoxassistant.argument":"[TYPE] argument [ARG] of command","blocks.aivoxassistant.argumentInt":"integer","blocks.aivoxassistant.argumentFloat":"float","blocks.aivoxassistant.argumentString":"string","blocks.aivoxassistant.lessonTitle":"AI-Vox Assistant Help","blocks.aivoxassistant.lessonPage1.title":"Peripheral Control Commands","blocks.aivoxassistant.lessonPage1.text":"Create a new Excel file, enter the peripheral control commands for this example in the format shown above, and then save it.","blocks.aivoxassistant.lessonPage2.title":"Import to Xiaozhi Knowledge Base","blocks.aivoxassistant.lessonPage2.text":'Import the "Peripheral Control Commands" into the knowledge base of the Xiaozhi backend at xiaozhi.me.'},"zh-Hans":{"blocks.aivoxassistant.name":"AI 语音助手","blocks.aivoxassistant.init":"初始引脚 RX:[RX] TX:[TX]","blocks.aivoxassistant.whenCommand":"当收到 [CMD] 指令时","blocks.aivoxassistant.argument":"指令参数 [ARG] 类型 [TYPE]","blocks.aivoxassistant.argumentInt":"整数","blocks.aivoxassistant.argumentFloat":"浮点数","blocks.aivoxassistant.argumentString":"字符串","blocks.aivoxassistant.lessonTitle":"AI 语音助手帮助","blocks.aivoxassistant.lessonPage1.title":"外设控制指令表","blocks.aivoxassistant.lessonPage1.text":"新建 Excel 文件，按上面格式输入本示例的外设控制指令，然后保存。","blocks.aivoxassistant.lessonPage2.title":"导入小智知识库","blocks.aivoxassistant.lessonPage2.text":"将“外设控制指令表”导入到小智后台 xiaozhi.me 的知识库中。"},"zh-Hant":{"blocks.aivoxassistant.name":"AI 語音助手","blocks.aivoxassistant.init":"初始引腳 RX:[RX] TX:[TX]","blocks.aivoxassistant.whenCommand":"當收到 [CMD] 指令時","blocks.aivoxassistant.argument":"指令參數 [ARG] 类型 [TYPE]","blocks.aivoxassistant.argumentInt":"整数","blocks.aivoxassistant.argumentFloat":"浮点数","blocks.aivoxassistant.argumentString":"字符串","blocks.aivoxassistant.lessonTitle":"AI 語音助手幫助","blocks.aivoxassistant.lessonPage1.title":"外設控制指令表","blocks.aivoxassistant.lessonPage1.text":"新建 Excel 文件，按上面格式輸入本示例的外設控制指令，然後保存。","blocks.aivoxassistant.lessonPage2.title":"導入小智知識庫","blocks.aivoxassistant.lessonPage2.text":"將「外設控制指令表」導入到小智後台 xiaozhi.me 的知識庫中。"}};var B="./assets/icon-jep655t2.svg";import{jsx as C}from"preact/jsx-runtime";M(w);var ie={icon:B,name:C(I,{id:"blocks.aivoxassistant.name",defaultMessage:"AI Vox Assistant"}),blocks:g,menus:E,readme:x,lessons:h};export{ie as default};
